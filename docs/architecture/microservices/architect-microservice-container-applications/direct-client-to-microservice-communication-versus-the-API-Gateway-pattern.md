---
title: Padrão de gateway de API versus comunicação direta de cliente com microsserviço
description: Entenda as diferenças e os usos do padrão de gateway de API e da comunicação direta de cliente com microsserviço.
ms.date: 01/07/2019
ms.openlocfilehash: 4b169d5a9542b10726a36b65328bc6a3dc3839ef
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/30/2019
ms.locfileid: "68673163"
---
# <a name="the-api-gateway-pattern-versus-the-direct-client-to-microservice-communication"></a><span data-ttu-id="7a882-103">Padrão de gateway de API versus comunicação direta de cliente com microsserviço</span><span class="sxs-lookup"><span data-stu-id="7a882-103">The API gateway pattern versus the Direct client-to-microservice communication</span></span>

<span data-ttu-id="7a882-104">Em uma arquitetura de microsserviços, cada microsserviço expõe um conjunto de pontos de extremidade (tipicamente) refinados.</span><span class="sxs-lookup"><span data-stu-id="7a882-104">In a microservices architecture, each microservice exposes a set of (typically) fine-grained endpoints.</span></span> <span data-ttu-id="7a882-105">Esse fato pode afetar a comunicação de cliente com microsserviço, conforme explicado nesta seção.</span><span class="sxs-lookup"><span data-stu-id="7a882-105">This fact can impact the client-to-microservice communication, as explained in this section.</span></span>

## <a name="direct-client-to-microservice-communication"></a><span data-ttu-id="7a882-106">Comunicação direta de cliente com microsserviço</span><span class="sxs-lookup"><span data-stu-id="7a882-106">Direct client-to-microservice communication</span></span>

<span data-ttu-id="7a882-107">Uma abordagem possível é usar uma arquitetura de comunicação direta de cliente com microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-107">A possible approach is to use a direct client-to-microservice communication architecture.</span></span> <span data-ttu-id="7a882-108">Nessa abordagem, um aplicativo cliente pode fazer solicitações diretamente para alguns dos microsserviços, conforme mostra a Figura 4-12.</span><span class="sxs-lookup"><span data-stu-id="7a882-108">In this approach, a client app can make requests directly to some of the microservices, as shown in Figure 4-12.</span></span>

![Diagrama mostrando a arquitetura de comunicação direta de cliente com microsserviço, em que cada aplicativo se comunica diretamente com microsserviços individuais.](./media/image12.png)

<span data-ttu-id="7a882-110">**Figura 4-12**.</span><span class="sxs-lookup"><span data-stu-id="7a882-110">**Figure 4-12**.</span></span> <span data-ttu-id="7a882-111">Usando uma arquitetura de comunicação direta de cliente com microsserviço</span><span class="sxs-lookup"><span data-stu-id="7a882-111">Using a direct client-to-microservice communication architecture</span></span>

<span data-ttu-id="7a882-112">Nessa abordagem, cada microsserviço tem um ponto de extremidade público, às vezes, com uma porta TCP diferente para cada microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-112">In this approach, each microservice has a public endpoint, sometimes with a different TCP port for each microservice.</span></span> <span data-ttu-id="7a882-113">Um exemplo de uma URL para um serviço específico pode ser a URL a seguir no Azure:</span><span class="sxs-lookup"><span data-stu-id="7a882-113">An example of a URL for a particular service could be the following URL in Azure:</span></span>

`http://eshoponcontainers.westus.cloudapp.azure.com:88/`

<span data-ttu-id="7a882-114">Em um ambiente de produção com base em um cluster, essa URL mapearia para o balanceador de carga usado no cluster, que, por sua vez, distribui as solicitações entre os microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-114">In a production environment based on a cluster, that URL would map to the load balancer used in the cluster, which in turn distributes the requests across the microservices.</span></span> <span data-ttu-id="7a882-115">Em ambientes de produção, você pode ter um ADC (Controlador de Entrega de Aplicativo) como o [Gateway de Aplicativo do Azure](https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction) entre os microsserviços e a Internet.</span><span class="sxs-lookup"><span data-stu-id="7a882-115">In production environments, you could have an Application Delivery Controller (ADC) like [Azure Application Gateway](https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction) between your microservices and the Internet.</span></span> <span data-ttu-id="7a882-116">Isso funciona como uma camada transparente que não executa balanceamento de carga, mas protege seus serviços ao oferecer terminação SSL.</span><span class="sxs-lookup"><span data-stu-id="7a882-116">This acts as a transparent tier that not only performs load balancing, but secures your services by offering SSL termination.</span></span> <span data-ttu-id="7a882-117">Isso aumenta a carga de seus hosts descarregando terminação SSL com uso intensivo de CPU e outras tarefas de roteamento para o Gateway de Aplicativo do Azure.</span><span class="sxs-lookup"><span data-stu-id="7a882-117">This improves the load of your hosts by offloading CPU-intensive SSL termination and other routing duties to the Azure Application Gateway.</span></span> <span data-ttu-id="7a882-118">Em qualquer caso, um balanceador de carga e ADC são transparentes de um ponto de vista da arquitetura do aplicativo lógico.</span><span class="sxs-lookup"><span data-stu-id="7a882-118">In any case, a load balancer and ADC are transparent from a logical application architecture point of view.</span></span>

<span data-ttu-id="7a882-119">Uma arquitetura de comunicação direta de cliente com microsserviço pode ser boa o bastante para um aplicativo baseado em microsserviço pequeno, especialmente se o aplicativo cliente for um aplicativo Web do lado do servidor como um aplicativo ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="7a882-119">A direct client-to-microservice communication architecture could be good enough for a small microservice-based application, especially if the client app is a server-side web application like an ASP.NET MVC app.</span></span> <span data-ttu-id="7a882-120">No entanto, quando você cria aplicativos grandes e complexos baseados em microsserviço (por exemplo, ao lidar com dezenas de tipos de microsserviço), e especialmente quando os aplicativos cliente são aplicativos móveis remotos ou aplicativos Web do SPA, essa abordagem enfrenta alguns problemas.</span><span class="sxs-lookup"><span data-stu-id="7a882-120">However, when you build large and complex microservice-based applications (for example, when handling dozens of microservice types), and especially when the client apps are remote mobile apps or SPA web applications, that approach faces a few issues.</span></span>

<span data-ttu-id="7a882-121">Considere as seguintes questões ao desenvolver um aplicativo grande com base em microsserviços:</span><span class="sxs-lookup"><span data-stu-id="7a882-121">Consider the following questions when developing a large application based on microservices:</span></span>

- <span data-ttu-id="7a882-122">*Como os aplicativos cliente podem minimizar o número de solicitações para o back-end e reduzir a comunicação excessiva com vários microsserviços?*</span><span class="sxs-lookup"><span data-stu-id="7a882-122">*How can client apps minimize the number of requests to the back end and reduce chatty communication to multiple microservices?*</span></span>

<span data-ttu-id="7a882-123">Interagir com vários microsserviços para criar uma única tela de interface do usuário aumenta o número de viagens de ida e volta pela Internet.</span><span class="sxs-lookup"><span data-stu-id="7a882-123">Interacting with multiple microservices to build a single UI screen increases the number of round trips across the Internet.</span></span> <span data-ttu-id="7a882-124">Isso aumenta a latência e a complexidade do lado da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="7a882-124">This increases latency and complexity on the UI side.</span></span> <span data-ttu-id="7a882-125">O ideal é que as respostas sejam agregadas com eficiência no lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="7a882-125">Ideally, responses should be efficiently aggregated in the server side.</span></span> <span data-ttu-id="7a882-126">Isso reduz a latência, já que várias partes de dados voltam em paralelo e algumas interfaces do usuário podem mostrar dados assim que eles estão prontos.</span><span class="sxs-lookup"><span data-stu-id="7a882-126">This reduces latency, since multiple pieces of data come back in parallel and some UI can show data as soon as it's ready.</span></span>

- <span data-ttu-id="7a882-127">*Como você pode lidar com preocupações abrangentes, como autorização, transformações de dados e despacho de solicitação dinâmica?*</span><span class="sxs-lookup"><span data-stu-id="7a882-127">*How can you handle cross-cutting concerns such as authorization, data transformations, and dynamic request dispatching?*</span></span>

<span data-ttu-id="7a882-128">Implementar preocupações relativas a segurança e abrangentes, como segurança e autorização em cada microsserviço, pode exigir um esforço significativo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="7a882-128">Implementing security and cross-cutting concerns like security and authorization on every microservice can require significant development effort.</span></span> <span data-ttu-id="7a882-129">Uma abordagem possível é ter esses serviços no host do Docker ou no cluster interno para restringir o acesso direto a eles do lado de fora e implementar esses interesses paralelos em um local centralizado, como um Gateway de API.</span><span class="sxs-lookup"><span data-stu-id="7a882-129">A possible approach is to have those services within the Docker host or internal cluster to restrict direct access to them from the outside, and to implement those cross-cutting concerns in a centralized place, like an API Gateway.</span></span>

- <span data-ttu-id="7a882-130">*Como os aplicativos cliente podem se comunicar com serviços que usam protocolos não amigáveis à Internet?*</span><span class="sxs-lookup"><span data-stu-id="7a882-130">*How can client apps communicate with services that use non-Internet-friendly protocols?*</span></span>

<span data-ttu-id="7a882-131">Protocolos usados no lado do servidor (como AMQP ou protocolos binários) geralmente não são compatíveis com aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-131">Protocols used on the server side (like AMQP or binary protocols) are usually not supported in client apps.</span></span> <span data-ttu-id="7a882-132">Portanto, as solicitações devem ser executadas por meio de protocolos como HTTP/HTTPS e convertidas em outros protocolos posteriormente.</span><span class="sxs-lookup"><span data-stu-id="7a882-132">Therefore, requests must be performed through protocols like HTTP/HTTPS and translated to the other protocols afterwards.</span></span> <span data-ttu-id="7a882-133">Uma abordagem *man-in-the-middle* pode ajudar nessa situação.</span><span class="sxs-lookup"><span data-stu-id="7a882-133">A *man-in-the-middle* approach can help in this situation.</span></span>

- <span data-ttu-id="7a882-134">*Como é possível moldar uma fachada feita especialmente para aplicativos móveis?*</span><span class="sxs-lookup"><span data-stu-id="7a882-134">*How can you shape a facade especially made for mobile apps?*</span></span>

<span data-ttu-id="7a882-135">A API de vários microsserviços podem não ser bem projetadas para as necessidades de diferentes aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-135">The API of multiple microservices might not be well designed for the needs of different client applications.</span></span> <span data-ttu-id="7a882-136">Por exemplo, as necessidades de um aplicativo móvel podem ser diferentes das necessidades de um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="7a882-136">For instance, the needs of a mobile app might be different than the needs of a web app.</span></span> <span data-ttu-id="7a882-137">Para aplicativos móveis, convém otimizar ainda mais para que as respostas de dados possam ser mais eficientes.</span><span class="sxs-lookup"><span data-stu-id="7a882-137">For mobile apps, you might need to optimize even further so that data responses can be more efficient.</span></span> <span data-ttu-id="7a882-138">Você pode fazer isso agregando dados de vários microsserviços e retornando um único conjunto de dados e, às vezes, eliminando os dados na resposta que não são necessários para o aplicativo móvel.</span><span class="sxs-lookup"><span data-stu-id="7a882-138">You might do this by aggregating data from multiple microservices and returning a single set of data, and sometimes eliminating any data in the response that isn't needed by the mobile app.</span></span> <span data-ttu-id="7a882-139">E, claro, você pode compactar dados.</span><span class="sxs-lookup"><span data-stu-id="7a882-139">And, of course, you might compress that data.</span></span> <span data-ttu-id="7a882-140">Novamente, uma fachada ou uma API entre o aplicativo móvel e os microsserviços pode ser conveniente para esse cenário.</span><span class="sxs-lookup"><span data-stu-id="7a882-140">Again, a facade or API in between the mobile app and the microservices can be convenient for this scenario.</span></span>

## <a name="why-consider-api-gateways-instead-of-direct-client-to-microservice-communication"></a><span data-ttu-id="7a882-141">Por que considerar o uso de Gateways de API em vez de comunicação direta de cliente com microsserviço</span><span class="sxs-lookup"><span data-stu-id="7a882-141">Why consider API Gateways instead of direct client-to-microservice communication</span></span>

<span data-ttu-id="7a882-142">Em uma arquitetura de microsserviços, os aplicativos cliente normalmente precisam consumir a funcionalidade de mais de um microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-142">In a microservices architecture, the client apps usually need to consume functionality from more than one microservice.</span></span> <span data-ttu-id="7a882-143">Se esse consumo for executado diretamente, o cliente precisará manipular várias chamadas para terminais de microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-143">If that consumption is performed directly, the client needs to handle multiple calls to microservice endpoints.</span></span> <span data-ttu-id="7a882-144">O que acontece quando o aplicativo evolui e novos microsserviços são introduzidos ou os microsserviços existentes são atualizados?</span><span class="sxs-lookup"><span data-stu-id="7a882-144">What happens when the application evolves and new microservices are introduced or existing microservices are updated?</span></span> <span data-ttu-id="7a882-145">Se o seu aplicativo tiver muitos microsserviços, lidar com tantos pontos de extremidade dos aplicativos cliente pode ser um pesadelo.</span><span class="sxs-lookup"><span data-stu-id="7a882-145">If your application has many microservices, handling so many endpoints from the client apps can be a nightmare.</span></span> <span data-ttu-id="7a882-146">Como o aplicativo cliente seria acoplado a esses pontos de extremidade internos, a evolução dos microsserviços no futuro pode causar alto impacto aos aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-146">Since the client app would be coupled to those internal endpoints, evolving the microservices in the future can cause high impact for the client apps.</span></span>

<span data-ttu-id="7a882-147">Portanto, ter um nível intermediário ou indireto (Gateway) pode ser muito conveniente para aplicativos baseados em microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-147">Therefore, having an intermediate level or tier of indirection (Gateway) can be very convenient for microservice-based applications.</span></span> <span data-ttu-id="7a882-148">Se você não tiver Gateways de API, os aplicativos do cliente deverão enviar solicitações diretamente aos microsserviços, o que causará problemas como os seguintes:</span><span class="sxs-lookup"><span data-stu-id="7a882-148">If you don't have API Gateways, the client apps must send requests directly to the microservices and that raises problems, such as the following issues:</span></span>

- <span data-ttu-id="7a882-149">**Acoplamento**: sem o padrão de Gateway de API, os aplicativos cliente são acoplados aos microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-149">**Coupling**: Without the API Gateway pattern, the client apps are coupled to the internal microservices.</span></span> <span data-ttu-id="7a882-150">Os aplicativos clientes precisam saber como as várias áreas do aplicativo são decompostas em microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-150">The client apps need to know how the multiple areas of the application are decomposed in microservices.</span></span> <span data-ttu-id="7a882-151">Ao evoluir e refatorar os microsserviços internos, essas ações afetam muito a manutenção, pois causam alterações de falha nos aplicativos cliente devido à referência direta aos microsserviços internos desses aplicativos.</span><span class="sxs-lookup"><span data-stu-id="7a882-151">When evolving and refactoring the internal microservices, those actions impact maintenance pretty badly because they cause breaking changes to the client apps due to the direct reference to the internal microservices from the client apps.</span></span> <span data-ttu-id="7a882-152">Os aplicativos clientes precisam ser atualizados com frequência,o que dificulta a evolução da solução.</span><span class="sxs-lookup"><span data-stu-id="7a882-152">Client apps need to be updated frequently, making the solution harder to evolve.</span></span>

- <span data-ttu-id="7a882-153">**Muitas viagens de ida e volta**: uma única página/tela no aplicativo cliente pode exigir diversas chamadas para vários serviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-153">**Too many round trips**: A single page/screen in the client app might require several calls to multiple services.</span></span> <span data-ttu-id="7a882-154">Isso pode resultar em várias viagens de ida e volta na rede entre o cliente e o servidor, adicionando uma latência significativa.</span><span class="sxs-lookup"><span data-stu-id="7a882-154">That can result in multiple network round trips between the client and the server, adding significant latency.</span></span> <span data-ttu-id="7a882-155">A agregação manipulada em um nível intermediário pode melhorar o desempenho e a experiência do usuário para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-155">Aggregation handled in an intermediate level could improve the performance and user experience for the client app.</span></span>

- <span data-ttu-id="7a882-156">**Problemas de segurança**: sem um gateway, todos os microsserviços precisam ser expostos ao “mundo externo”, tornando a superfície de ataque maior do que se você ocultar os microsserviços internos que não são usados ​​diretamente pelos aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-156">**Security issues**: Without a gateway, all the microservices must be exposed to the "external world", making the attack surface larger than if you hide internal microservices that aren't directly used by the client apps.</span></span> <span data-ttu-id="7a882-157">Quanto menor a superfície de ataque, mais segura sua aplicação pode ser.</span><span class="sxs-lookup"><span data-stu-id="7a882-157">The smaller the attack surface is, the more secure your application can be.</span></span>

- <span data-ttu-id="7a882-158">**Interesses paralelos**: cada microsserviço publicado abertamente deve tratar de interesses como autorização, SSL, etc. Em muitas situações, esses interessas podem ser tratados em uma única camada para que os microsserviços internos sejam simplificados.</span><span class="sxs-lookup"><span data-stu-id="7a882-158">**Cross-cutting concerns**: Each publicly published microservice must handle concerns such as authorization, SSL, etc. In many situations, those concerns could be handled in a single tier so the internal microservices are simplified.</span></span>

## <a name="what-is-the-api-gateway-pattern"></a><span data-ttu-id="7a882-159">Por que o padrão de Gateway de API?</span><span class="sxs-lookup"><span data-stu-id="7a882-159">What is the API Gateway pattern?</span></span>

<span data-ttu-id="7a882-160">Quando você projeta e cria aplicativos grandes ou complexos baseado em microsserviço com vários aplicativos cliente, uma boa abordagem a considerar pode ser um [Gateway de API](https://microservices.io/patterns/apigateway.html).</span><span class="sxs-lookup"><span data-stu-id="7a882-160">When you design and build large or complex microservice-based applications with multiple client apps, a good approach to consider can be an [API Gateway](https://microservices.io/patterns/apigateway.html).</span></span> <span data-ttu-id="7a882-161">Esse é um serviço que fornece um único ponto de entrada para determinados grupos de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-161">This is a service that provides a single-entry point for certain groups of microservices.</span></span> <span data-ttu-id="7a882-162">É semelhante ao [padrão Fachada](https://en.wikipedia.org/wiki/Facade_pattern) do design orientado a objeto, mas, neste caso, faz parte de um sistema distribuído.</span><span class="sxs-lookup"><span data-stu-id="7a882-162">It's similar to the [Facade pattern](https://en.wikipedia.org/wiki/Facade_pattern) from object-oriented design, but in this case, it's part of a distributed system.</span></span> <span data-ttu-id="7a882-163">O padrão de Gateway de API às vezes também é conhecido como [BFF](https://samnewman.io/patterns/architectural/bff/) ("back-end para front-end"), porque ele é criado pensando nas necessidades do aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-163">The API Gateway pattern is also sometimes known as the "backend for frontend" ([BFF](https://samnewman.io/patterns/architectural/bff/)) because you build it while thinking about the needs of the client app.</span></span>

<span data-ttu-id="7a882-164">Portanto, o gateway da API fica entre os aplicativos cliente e os microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-164">Therefore, the API gateway sits between the client apps and the microservices.</span></span> <span data-ttu-id="7a882-165">Ele age como um proxy reverso, roteando solicitações de clientes para serviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-165">It acts as a reverse proxy, routing requests from clients to services.</span></span> <span data-ttu-id="7a882-166">Ele também pode fornecer outros recursos paralelos, como autenticação, terminação SSL e cache.</span><span class="sxs-lookup"><span data-stu-id="7a882-166">It can also provide additional cross-cutting features such as authentication, SSL termination, and cache.</span></span>

<span data-ttu-id="7a882-167">A Figura 4-13 mostra como um Gateway de API personalizado pode se encaixar em uma arquitetura simplificada baseada em microsserviço com apenas alguns microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-167">Figure 4-13 shows how a custom API Gateway can fit into a simplified microservice-based architecture with just a few microservices.</span></span>

![Diagrama mostrando um Gateway de API implementado como um serviço personalizado, para que os aplicativos se conectem a um único ponto de extremidade, o Gateway de API, configurado para encaminhar solicitações para microsserviços individuais.](./media/image13.png)

<span data-ttu-id="7a882-169">**Figura 4-13**.</span><span class="sxs-lookup"><span data-stu-id="7a882-169">**Figure 4-13**.</span></span> <span data-ttu-id="7a882-170">Uso de um Gateway de API implementado como um serviço personalizado</span><span class="sxs-lookup"><span data-stu-id="7a882-170">Using an API Gateway implemented as a custom service</span></span>

<span data-ttu-id="7a882-171">Neste exemplo, o Gateway de API deve ser implementado como um serviço de WebHost ASP.NET Core personalizado em execução como um contêiner.</span><span class="sxs-lookup"><span data-stu-id="7a882-171">In this example, the API Gateway would be implemented as a custom ASP.NET Core WebHost service running as a container.</span></span>

<span data-ttu-id="7a882-172">É importante destacar que, neste diagrama, você usa um único serviço personalizado de Gateway de API, voltado para vários aplicativos cliente diferentes.</span><span class="sxs-lookup"><span data-stu-id="7a882-172">It's important to highlight that in that diagram, you would be using a single custom API Gateway service facing multiple and different client apps.</span></span> <span data-ttu-id="7a882-173">Esse fato pode ser um risco importante, pois seu serviço de Gateway de API estará crescendo e em evolução com base em vários requisitos diferentes dos aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-173">That fact can be an important risk because your API Gateway service will be growing and evolving based on many different requirements from the client apps.</span></span> <span data-ttu-id="7a882-174">Eventualmente, ele será inflado devido a essas necessidades diferentes e efetivamente pode ser muito semelhante a um aplicativo monolítico ou serviço monolítico.</span><span class="sxs-lookup"><span data-stu-id="7a882-174">Eventually, it will be bloated because of those different needs and effectively it could be pretty similar to a monolithic application or monolithic service.</span></span> <span data-ttu-id="7a882-175">É por isso que é muito recomendável dividir o Gateway de API em vários serviços ou vários Gateways de API menores, um por tipo de fator forma de aplicativo cliente, por exemplo.</span><span class="sxs-lookup"><span data-stu-id="7a882-175">That's why it's very much recommended to split the API Gateway in multiple services or multiple smaller API Gateways, one per client app form-factor type, for instance.</span></span>

<span data-ttu-id="7a882-176">É necessário ter cuidado ao implementar o padrão de Gateway de API.</span><span class="sxs-lookup"><span data-stu-id="7a882-176">You need to be careful when implementing the API Gateway pattern.</span></span> <span data-ttu-id="7a882-177">Geralmente, não é recomendável ter um único Gateway de API para agregar todos os microsserviços internos do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7a882-177">Usually it isn't a good idea to have a single API Gateway aggregating all the internal microservices of your application.</span></span> <span data-ttu-id="7a882-178">Em caso afirmativo, ele atua como um agregador ou orquestrador monolítico e viola a autonomia de microsserviço acoplando todos os microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-178">If it does, it acts as a monolithic aggregator or orchestrator and violates microservice autonomy by coupling all the microservices.</span></span>

<span data-ttu-id="7a882-179">Portanto, os Gateways de API devem ser segregados com base nos limites de negócios e nos aplicativos cliente, e não agir como um agregador único para todos os microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-179">Therefore, the API Gateways should be segregated based on business boundaries and the client apps and not act as a single aggregator for all the internal microservices.</span></span>

<span data-ttu-id="7a882-180">Ao dividir a camada do Gateway de API em vários Gateways de API, se o aplicativo tiver vários aplicativos cliente, isso poderá ser um fator fundamental ao identificar os vários tipos de Gateways de API, de modo que você possa ter uma fachada distinta para as necessidades de cada aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-180">When splitting the API Gateway tier into multiple API Gateways, if your application has multiple client apps, that can be a primary pivot when identifying the multiple API Gateways types, so that you can have a different facade for the needs of each client app.</span></span> <span data-ttu-id="7a882-181">Esse caso é um padrão chamado [BFF](https://samnewman.io/patterns/architectural/bff/) ("Back-end para Front-end"), em que cada Gateway de API pode fornecer uma API diferente personalizada para cada tipo de aplicativo cliente, possivelmente, até mesmo com base no fator forma do cliente, implementando um código de adaptador específico que chama, em segundo plano, vários microsserviços internos, como é mostrado na seguinte imagem:</span><span class="sxs-lookup"><span data-stu-id="7a882-181">This case is a pattern named "Backend for Frontend" ([BFF](https://samnewman.io/patterns/architectural/bff/)) where each API Gateway can provide a different API tailored for each client app type, possibly even based on the client form factor by implementing specific adapter code which underneath calls multiple internal microservices, as shown in the following image:</span></span>

![Diagrama mostrando vários Gateways de API personalizados, em que os Gateways de API são separados por tipo de cliente: um para clientes móveis e outro para clientes Web.](./media/image13.1.png)

<span data-ttu-id="7a882-184">**Figura 4-13.1**.</span><span class="sxs-lookup"><span data-stu-id="7a882-184">**Figure 4-13.1**.</span></span> <span data-ttu-id="7a882-185">Uso de mostrando vários Gateways de API personalizados</span><span class="sxs-lookup"><span data-stu-id="7a882-185">Using multiple custom API Gateways</span></span>

<span data-ttu-id="7a882-186">A imagem anterior mostra uma arquitetura simplificada com vários Gateways de API refinados.</span><span class="sxs-lookup"><span data-stu-id="7a882-186">The previous image shows a simplified architecture with multiple fine-grained API Gateways.</span></span> <span data-ttu-id="7a882-187">Nesse caso, os limites identificados para cada Gateway de API são baseados puramente no padrão [BFF](https://samnewman.io/patterns/architectural/bff/) ("Back-end para Front-end"), portanto, baseados apenas na API necessária por aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-187">In this case, the boundaries identified for each API Gateway are based purely on the "Backend for Frontend" ([BFF](https://samnewman.io/patterns/architectural/bff/)) pattern, hence based just on the API needed per client app.</span></span> <span data-ttu-id="7a882-188">Porém, em aplicativos maiores, você deve ir além e criar Gateways de API adicionais com base nos limites de negócios como um segundo fator de design.</span><span class="sxs-lookup"><span data-stu-id="7a882-188">But in larger applications you should also go further and create additional API Gateways based on business boundaries as a second design pivot.</span></span>

## <a name="main-features-in-the-api-gateway-pattern"></a><span data-ttu-id="7a882-189">Principais recursos do padrão de Gateway de API</span><span class="sxs-lookup"><span data-stu-id="7a882-189">Main features in the API Gateway pattern</span></span>

<span data-ttu-id="7a882-190">Um Gateway de API pode oferecer vários recursos.</span><span class="sxs-lookup"><span data-stu-id="7a882-190">An API Gateway can offer multiple features.</span></span> <span data-ttu-id="7a882-191">Dependendo do produto, ele pode oferecer recursos mais avançados ou mais simples, no entanto, os recursos mais importantes e fundamentais para qualquer Gateway de API são os seguintes padrões de design:</span><span class="sxs-lookup"><span data-stu-id="7a882-191">Depending on the product it might offer richer or simpler features, however, the most important and foundational features for any API Gateway are the following design patterns:</span></span>

<span data-ttu-id="7a882-192">**Proxy reverso ou roteamento de gateway.**</span><span class="sxs-lookup"><span data-stu-id="7a882-192">**Reverse proxy or gateway routing.**</span></span> <span data-ttu-id="7a882-193">O Gateway de API oferece um proxy reverso para redirecionar ou encaminhar solicitações (roteamento da camada 7, geralmente solicitações HTTP) para os pontos de extremidade dos microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-193">The API Gateway offers a reverse proxy to redirect or route requests (layer 7 routing, usually HTTP requests) to the endpoints of the internal microservices.</span></span> <span data-ttu-id="7a882-194">O gateway fornece um único ponto de extremidade ou URL para os aplicativos clientes e, em seguida, mapeia internamente as solicitações para um grupo de microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-194">The gateway provides a single endpoint or URL for the client apps and then internally maps the requests to a group of internal microservices.</span></span> <span data-ttu-id="7a882-195">Essa funcionalidade de roteamento ajuda a desacoplar os aplicativos cliente dos microsserviços, mas também é muito conveniente na modernização de uma API monolítica colocando o Gateway de API entre a API monolítica e os aplicativos cliente. Assim, você pode adicionar novas APIs como novos microsserviços enquanto ainda usa a API monolítica herdada até que ela seja dividida em muitos microsserviços no futuro.</span><span class="sxs-lookup"><span data-stu-id="7a882-195">This routing feature helps to decouple the client apps from the microservices but it's also pretty convenient when modernizing a monolithic API by sitting the API Gateway in between the monolithic API and the client apps, then you can add new APIs as new microservices while still using the legacy monolithic API until it's split into many microservices in the future.</span></span> <span data-ttu-id="7a882-196">Devido ao Gateway de API, os aplicativos cliente não notarão se as APIs em uso forem implementadas como microsserviços internos ou uma API monolítica. O mais importante é o fato que, ao evoluir e refatorar a API monolítica em microsserviços, graças ao roteamento do Gateway de API, os aplicativos cliente não serão afetados por nenhuma alteração de URI.</span><span class="sxs-lookup"><span data-stu-id="7a882-196">Because of the API Gateway, the client apps won't notice if the APIs being used are implemented as internal microservices or a monolithic API and more importantly, when evolving and refactoring the monolithic API into microservices, thanks to the API Gateway routing, client apps won't be impacted with any URI change.</span></span>

<span data-ttu-id="7a882-197">Para saber mais, confira [Padrão de roteamento do gateway](https://docs.microsoft.com/azure/architecture/patterns/gateway-routing).</span><span class="sxs-lookup"><span data-stu-id="7a882-197">For more information, see [Gateway routing pattern](https://docs.microsoft.com/azure/architecture/patterns/gateway-routing).</span></span>

<span data-ttu-id="7a882-198">**Solicitações de agregação.**</span><span class="sxs-lookup"><span data-stu-id="7a882-198">**Requests aggregation.**</span></span> <span data-ttu-id="7a882-199">Como parte do padrão de gateway, é possível agregar várias solicitações de cliente (geralmente solicitações HTTP) direcionadas a vários microsserviços internos em uma única solicitação de cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-199">As part of the gateway pattern you can aggregate multiple client requests (usually HTTP requests) targeting multiple internal microservices into a single client request.</span></span> <span data-ttu-id="7a882-200">Esse padrão é especialmente conveniente quando uma página/tela do cliente precisa de informações de vários microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7a882-200">This pattern is especially convenient when a client page/screen needs information from several microservices.</span></span> <span data-ttu-id="7a882-201">Com essa abordagem, o aplicativo cliente envia uma única solicitação ao Gateway da API, que envia várias solicitações aos microsserviços internos e, em seguida, agrega os resultados e envia tudo de volta ao aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-201">With this approach, the client app sends a single request to the API Gateway that dispatches several requests to the internal microservices and then aggregates the results and sends everything back to the client app.</span></span> <span data-ttu-id="7a882-202">O principal benefício e objetivo desse padrão de design é reduzir o caos entre os aplicativos cliente e a API de back-end, o que é especialmente importante para aplicativos remotos do datacenter em que os microsserviços residem, como aplicativos móveis ou solicitações provenientes de aplicativos SPA de Javascript em navegadores remotos do cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-202">The main benefit and goal of this design pattern is to reduce chattiness between the client apps and the backend API, which is especially important for remote apps out of the datacenter where the microservices live, like mobile apps or requests coming from SPA apps that come from Javascript in client remote browsers.</span></span> <span data-ttu-id="7a882-203">Para aplicativos Web comuns que executam as solicitações no ambiente do servidor (como um aplicativo Web ASP.NET Core MVC), esse padrão não é tão importante, já que a latência é muito menor do que em aplicativos cliente remotos.</span><span class="sxs-lookup"><span data-stu-id="7a882-203">For regular web apps performing the requests in the server environment (like an ASP.NET Core MVC web app), this pattern is not so important as the latency is very much smaller than for remote client apps.</span></span>

<span data-ttu-id="7a882-204">Dependendo do produto do Gateway de API usado, ele poderá executar essa agregação.</span><span class="sxs-lookup"><span data-stu-id="7a882-204">Depending on the API Gateway product you use, it might be able to perform this aggregation.</span></span> <span data-ttu-id="7a882-205">No entanto, em muitos casos, é mais flexível criar microsserviços de agregação no escopo do Gateway de API, de modo que você defina a agregação no código (ou seja, o código C#):</span><span class="sxs-lookup"><span data-stu-id="7a882-205">However, in many cases it's more flexible to create aggregation microservices under the scope of the API Gateway, so you define the aggregation in code (that is, C# code):</span></span>

<span data-ttu-id="7a882-206">Para saber mais, confira o [Padrão de agregação de Gateway](https://docs.microsoft.com/azure/architecture/patterns/gateway-aggregation).</span><span class="sxs-lookup"><span data-stu-id="7a882-206">For more information, see [Gateway aggregation pattern](https://docs.microsoft.com/azure/architecture/patterns/gateway-aggregation).</span></span>

<span data-ttu-id="7a882-207">**Interesses paralelos ou descarregamento de gateway.**</span><span class="sxs-lookup"><span data-stu-id="7a882-207">**Cross-cutting concerns or gateway offloading.**</span></span> <span data-ttu-id="7a882-208">Dependendo dos recursos oferecidos por cada produto do Gateway de API, você pode descarregar a funcionalidade de microsserviços individuais para o gateway, o que simplifica a implementação de cada microsserviço ao consolidar interesses paralelos em uma camada.</span><span class="sxs-lookup"><span data-stu-id="7a882-208">Depending on the features offered by each API Gateway product, you can offload functionality from individual microservices to the gateway, which simplifies the implementation of each microservice by consolidating cross-cutting concerns into one tier.</span></span> <span data-ttu-id="7a882-209">Isso é especialmente conveniente para recursos especializados que podem ser complexos de implementar adequadamente em cada microsserviço interno, como as seguintes funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="7a882-209">This is especially convenient for specialized features that can be complex to implement properly in every internal microservice, such as the following functionality:</span></span>

- <span data-ttu-id="7a882-210">Autenticação e autorização</span><span class="sxs-lookup"><span data-stu-id="7a882-210">Authentication and authorization</span></span>
- <span data-ttu-id="7a882-211">Integração de serviços de descoberta</span><span class="sxs-lookup"><span data-stu-id="7a882-211">Service discovery integration</span></span>
- <span data-ttu-id="7a882-212">Cache de resposta</span><span class="sxs-lookup"><span data-stu-id="7a882-212">Response caching</span></span>
- <span data-ttu-id="7a882-213">Políticas de repetição, disjuntor e QoS</span><span class="sxs-lookup"><span data-stu-id="7a882-213">Retry policies, circuit breaker, and QoS</span></span>
- <span data-ttu-id="7a882-214">Limitação de taxa</span><span class="sxs-lookup"><span data-stu-id="7a882-214">Rate limiting and throttling</span></span>
- <span data-ttu-id="7a882-215">Balanceamento de carga</span><span class="sxs-lookup"><span data-stu-id="7a882-215">Load balancing</span></span>
- <span data-ttu-id="7a882-216">Registrando em log, rastreamento, correlação</span><span class="sxs-lookup"><span data-stu-id="7a882-216">Logging, tracing, correlation</span></span>
- <span data-ttu-id="7a882-217">Cabeçalhos, cadeias de caracteres de consulta e transformação de declarações</span><span class="sxs-lookup"><span data-stu-id="7a882-217">Headers, query strings, and claims transformation</span></span>
- <span data-ttu-id="7a882-218">Lista de permissões de IP</span><span class="sxs-lookup"><span data-stu-id="7a882-218">IP whitelisting</span></span>

<span data-ttu-id="7a882-219">Para saber mais, confira o [Padrão de descarregamento de Gateway](https://docs.microsoft.com/azure/architecture/patterns/gateway-offloading).</span><span class="sxs-lookup"><span data-stu-id="7a882-219">For more information, see [Gateway offloading pattern](https://docs.microsoft.com/azure/architecture/patterns/gateway-offloading).</span></span>

## <a name="using-products-with-api-gateway-features"></a><span data-ttu-id="7a882-220">Uso de produtos com recursos do Gateway de API</span><span class="sxs-lookup"><span data-stu-id="7a882-220">Using products with API Gateway features</span></span>

<span data-ttu-id="7a882-221">Pode haver muitos outros interesses paralelos oferecidos pelos produtos de Gateways de API, dependendo de cada implementação.</span><span class="sxs-lookup"><span data-stu-id="7a882-221">There can be many more cross-cutting concerns offered by the API Gateways products depending on each implementation.</span></span> <span data-ttu-id="7a882-222">Exploraremos aqui:</span><span class="sxs-lookup"><span data-stu-id="7a882-222">We'll explore here:</span></span>

- [<span data-ttu-id="7a882-223">Gerenciamento de API do Azure</span><span class="sxs-lookup"><span data-stu-id="7a882-223">Azure API Management</span></span>](https://azure.microsoft.com/services/api-management/)
- [<span data-ttu-id="7a882-224">Ocelot</span><span class="sxs-lookup"><span data-stu-id="7a882-224">Ocelot</span></span>](https://github.com/ThreeMammals/Ocelot)

### <a name="azure-api-management"></a><span data-ttu-id="7a882-225">Gerenciamento de API do Azure</span><span class="sxs-lookup"><span data-stu-id="7a882-225">Azure API Management</span></span>

<span data-ttu-id="7a882-226">O [Gerenciamento de API do Azure](https://azure.microsoft.com/services/api-management/) (conforme mostrado na Figura 4-14) não apenas soluciona as necessidades do Gateway de API, mas também fornece funcionalidades como coleta de insights das APIs.</span><span class="sxs-lookup"><span data-stu-id="7a882-226">[Azure API Management](https://azure.microsoft.com/services/api-management/) (as shown in Figure 4-14) not only solves your API Gateway needs but provides features like gathering insights from your APIs.</span></span> <span data-ttu-id="7a882-227">Se você estiver usando uma solução de gerenciamento de API, um Gateway de API será apenas um componente nessa solução completa de gerenciamento de API.</span><span class="sxs-lookup"><span data-stu-id="7a882-227">If you're using an API management solution, an API Gateway is only a component within that full API management solution.</span></span>

![O Gerenciamento de API do Azure soluciona as necessidades do Gerenciamento e do Gateway de API, como log, segurança, medição, etc.](./media/image14.png)

<span data-ttu-id="7a882-229">**Figura 4-14**.</span><span class="sxs-lookup"><span data-stu-id="7a882-229">**Figure 4-14**.</span></span> <span data-ttu-id="7a882-230">Usando o Gerenciamento de API do Azure para o Gateway de API</span><span class="sxs-lookup"><span data-stu-id="7a882-230">Using Azure API Management for your API Gateway</span></span>

<span data-ttu-id="7a882-231">Neste caso, ao usar um produto como o Gerenciamento de API do Azure, o fato de que você pode ter um único Gateway de API não é tão arriscado, pois esses tipos de Gateways de API são "mais finos", o que significa que não implementam código C# personalizado que pode evoluir para um componente monolítico.</span><span class="sxs-lookup"><span data-stu-id="7a882-231">In this case, when using a product like Azure API Management, the fact that you might have a single API Gateway is not so risky because these kinds of API Gateways are "thinner", meaning that you don't implement custom C# code that could evolve towards a monolithic component.</span></span> 

<span data-ttu-id="7a882-232">Os produtos de Gateway de API costumam atuar como um proxy reverso para comunicação de entrada, em que você também pode filtrar as APIs dos microsserviços internos e aplicar a autorização para as APIs publicadas nessa camada única.</span><span class="sxs-lookup"><span data-stu-id="7a882-232">The API Gateway products usually act like a reverse proxy for ingress communication, where you can also filter the APIs from the internal microservices plus apply authorization to the published APIs in this single tier.</span></span>

<span data-ttu-id="7a882-233">As informações disponíveis do sistema Gerenciamento de API ajudam a entender como as suas APIs estão sendo usadas e como elas são executadas.</span><span class="sxs-lookup"><span data-stu-id="7a882-233">The insights available from an API Management system help you get an understanding of how your APIs are being used and how they are performing.</span></span> <span data-ttu-id="7a882-234">Isso ocorre porque você pode exibir relatórios de análise quase em tempo real e identificar tendências que podem afetar seus negócios.</span><span class="sxs-lookup"><span data-stu-id="7a882-234">They do this by letting you view near real-time analytics reports and identifying trends that might impact your business.</span></span> <span data-ttu-id="7a882-235">Além disso, você pode ter logs sobre a atividade de solicitação e resposta para mais análises online e offline.</span><span class="sxs-lookup"><span data-stu-id="7a882-235">Plus, you can have logs about request and response activity for further online and offline analysis.</span></span>

<span data-ttu-id="7a882-236">Com o Gerenciamento de API do Azure, você pode proteger suas APIs usando uma chave, um token e filtragem de IP.</span><span class="sxs-lookup"><span data-stu-id="7a882-236">With Azure API Management, you can secure your APIs using a key, a token, and IP filtering.</span></span> <span data-ttu-id="7a882-237">Esses recursos permitem que você imponha cotas flexíveis e refinadas e limites de taxa, modifique a forma e o comportamento de suas APIs usando políticas e melhore o desempenho com o cache de resposta.</span><span class="sxs-lookup"><span data-stu-id="7a882-237">These features let you enforce flexible and fine-grained quotas and rate limits, modify the shape and behavior of your APIs using policies, and improve performance with response caching.</span></span>

<span data-ttu-id="7a882-238">Neste guia e no aplicativo de exemplo de referência (eShopOnContainers), a arquitetura é limitada a uma arquitetura em contêiner mais simples e personalizada para focar em contêineres simples sem o uso de produtos PaaS como Gerenciamento de API do Azure.</span><span class="sxs-lookup"><span data-stu-id="7a882-238">In this guide and the reference sample application (eShopOnContainers), the architecture is limited to a simpler and custom-made containerized architecture in order to focus on plain containers without using PaaS products like Azure API Management.</span></span> <span data-ttu-id="7a882-239">Mas, para grandes aplicativos baseados em microsserviço implantados no Microsoft Azure, recomendamos que você avaliar o Gerenciamento de API do Azure como base para seus Gateways de API em produção.</span><span class="sxs-lookup"><span data-stu-id="7a882-239">But for large microservice-based applications that are deployed into Microsoft Azure, we encourage you to evaluate Azure API Management as the base for your API Gateways in production.</span></span>

### <a name="ocelot"></a><span data-ttu-id="7a882-240">Ocelot</span><span class="sxs-lookup"><span data-stu-id="7a882-240">Ocelot</span></span>

<span data-ttu-id="7a882-241">O [Ocelot](https://github.com/ThreeMammals/Ocelot) é um Gateway de API leve, recomendado para abordagens mais simples.</span><span class="sxs-lookup"><span data-stu-id="7a882-241">[Ocelot](https://github.com/ThreeMammals/Ocelot) is a lightweight API Gateway, recommended for simpler approaches.</span></span> <span data-ttu-id="7a882-242">O Ocelot é um Gateway de API baseado no .NET Core de Software Livre, feito especialmente para a arquitetura de microsserviços que precisa de pontos de entrada unificados no sistema.</span><span class="sxs-lookup"><span data-stu-id="7a882-242">Ocelot is an Open Source .NET Core based API Gateway especially made for microservices architecture that need unified points of entry into their system.</span></span> <span data-ttu-id="7a882-243">Ele é leve, rápido, escalonável e fornece roteamento e autenticação entre muitos outros recursos.</span><span class="sxs-lookup"><span data-stu-id="7a882-243">It's lightweight, fast, scalable and provides routing and authentication among many other features.</span></span>

<span data-ttu-id="7a882-244">A principal razão para escolher o Ocelot no [aplicativo de referência eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers) se deve ao fato de o Ocelot ser um Gateway de API leve do .NET Core que pode ser implantado no mesmo ambiente de aplicativos em que os microsserviços/contêineres são implantados, como um Host do Docker, Kubernetes etc. E, como ele é baseado no .NET Core, é uma plataforma cruzada que permite a implantação no Linux ou no Windows.</span><span class="sxs-lookup"><span data-stu-id="7a882-244">The main reason to choose Ocelot for the [eShopOnContainers reference application](https://github.com/dotnet-architecture/eShopOnContainers) is because Ocelot is a .NET Core lightweight API Gateway that you can deploy into the same application deployment environment where you're deploying your microservices/containers, such as a Docker Host, Kubernetes, etc. And since it's based on .NET Core, it's cross-platform allowing you to deploy on Linux or Windows.</span></span>

<span data-ttu-id="7a882-245">Os diagramas anteriores que mostram os Gateways de API personalizados em execução nos contêineres correspondem precisamente ao modo como você também pode executar o Ocelot em um contêiner e em um aplicativo baseado em microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-245">The previous diagrams showing custom API Gateways running in containers are precisely how you can also run Ocelot in a container and microservice-based application.</span></span>

<span data-ttu-id="7a882-246">Além disso, existem muitos outros produtos no mercado que oferecem recursos de Gateways de API, como Apigee, Kong, MuleSoft, WSO2 e outros produtos como Linkerd e Istio para recursos de controlador de entrada de malha de serviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-246">In addition, there are many other products in the market offering API Gateways features, such as Apigee, Kong, MuleSoft, WSO2, and other products like Linkerd and Istio for service mesh ingress controller features.</span></span>

<span data-ttu-id="7a882-247">Após as seções iniciais de explicação sobre arquitetura e padrões, as próximas seções explicam como implementar Gateways de API com [Ocelot](https://github.com/ThreeMammals/Ocelot).</span><span class="sxs-lookup"><span data-stu-id="7a882-247">After the initial architecture and patterns explanation sections, the next sections explain how to implement API Gateways with [Ocelot](https://github.com/ThreeMammals/Ocelot).</span></span>

## <a name="drawbacks-of-the-api-gateway-pattern"></a><span data-ttu-id="7a882-248">Desvantagens do padrão de Gateway de API</span><span class="sxs-lookup"><span data-stu-id="7a882-248">Drawbacks of the API Gateway pattern</span></span>

- <span data-ttu-id="7a882-249">A desvantagem mais importante é que, quando você implementa um Gateway de API, está acoplando essa camada aos microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-249">The most important drawback is that when you implement an API Gateway, you're coupling that tier with the internal microservices.</span></span> <span data-ttu-id="7a882-250">Um acoplamento como este pode introduzir problemas sérios no seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7a882-250">Coupling like this might introduce serious difficulties for your application.</span></span> <span data-ttu-id="7a882-251">Clemens Vaster, arquiteto na equipe do Barramento de Serviço do Azure, refere-se a essa possível dificuldade como "o novo ESB" na sessão "[Mensagens e microsserviços](https://www.youtube.com/watch?v=rXi5CLjIQ9k)" na GOTO 2016.</span><span class="sxs-lookup"><span data-stu-id="7a882-251">Clemens Vaster, architect at the Azure Service Bus team, refers to this potential difficulty as "the new ESB" in the "[Messaging and Microservices](https://www.youtube.com/watch?v=rXi5CLjIQ9k)" session at GOTO 2016.</span></span>

- <span data-ttu-id="7a882-252">Usar um Gateway de API de microsserviços cria um possível ponto único de falha adicional.</span><span class="sxs-lookup"><span data-stu-id="7a882-252">Using a microservices API Gateway creates an additional possible single point of failure.</span></span>

- <span data-ttu-id="7a882-253">Um Gateway de API pode apresentar um maior tempo de resposta devido à chamada de rede adicional.</span><span class="sxs-lookup"><span data-stu-id="7a882-253">An API Gateway can introduce increased response time due to the additional network call.</span></span> <span data-ttu-id="7a882-254">No entanto, essa chamada extra normalmente causa um menor impacto do que ter uma interface do cliente com excesso de chamadas diretas aos microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-254">However, this extra call usually has less impact than having a client interface that's too chatty directly calling the internal microservices.</span></span>

- <span data-ttu-id="7a882-255">Se não for dimensionado corretamente, o Gateway de API poderá se tornar um gargalo.</span><span class="sxs-lookup"><span data-stu-id="7a882-255">If not scaled out properly, the API Gateway can become a bottleneck.</span></span>

- <span data-ttu-id="7a882-256">Um Gateway de API requer custos adicionais de desenvolvimento e manutenção futura se incluir lógica personalizada e agregação de dados.</span><span class="sxs-lookup"><span data-stu-id="7a882-256">An API Gateway requires additional development cost and future maintenance if it includes custom logic and data aggregation.</span></span> <span data-ttu-id="7a882-257">Os desenvolvedores precisam atualizar o Gateway de API para expor os pontos de extremidade de cada microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7a882-257">Developers must update the API Gateway in order to expose each microservice's endpoints.</span></span> <span data-ttu-id="7a882-258">Além disso, as alterações de implementação nos microsserviços internos podem causar alterações de código no nível do Gateway da API.</span><span class="sxs-lookup"><span data-stu-id="7a882-258">Moreover, implementation changes in the internal microservices might cause code changes at the API Gateway level.</span></span> <span data-ttu-id="7a882-259">No entanto, se o Gateway de API estiver apenas aplicando segurança, logon e controle de versão (como ao usar o Gerenciamento de API do Azure), esse custo de desenvolvimento adicional poderá não se aplicar.</span><span class="sxs-lookup"><span data-stu-id="7a882-259">However, if the API Gateway is just applying security, logging, and versioning (as when using Azure API Management), this additional development cost might not apply.</span></span>

- <span data-ttu-id="7a882-260">Se o Gateway de API for desenvolvido por uma única equipe, poderá haver um gargalo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="7a882-260">If the API Gateway is developed by a single team, there can be a development bottleneck.</span></span> <span data-ttu-id="7a882-261">Esse é outro motivo pelo qual uma abordagem melhor é ter vários Gateways de API refinados que respondam às diferentes necessidades do cliente.</span><span class="sxs-lookup"><span data-stu-id="7a882-261">This is another reason why a better approach is to have several fined-grained API Gateways that respond to different client needs.</span></span> <span data-ttu-id="7a882-262">Você também pode separar o Gateway de API internamente em várias áreas ou camadas de propriedade de diferentes equipes trabalhando em microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="7a882-262">You could also segregate the API Gateway internally into multiple areas or layers that are owned by the different teams working on the internal microservices.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="7a882-263">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="7a882-263">Additional resources</span></span>

- <span data-ttu-id="7a882-264">**Charles Richardson. Padrão: gateway de API/back-end para front-end** </span><span class="sxs-lookup"><span data-stu-id="7a882-264">**Charles Richardson. Pattern: API Gateway / Backend for Front-End** </span></span>\
  <https://microservices.io/patterns/apigateway.html>

- <span data-ttu-id="7a882-265">**Padrão de Gateway de API** </span><span class="sxs-lookup"><span data-stu-id="7a882-265">**API Gateway pattern** </span></span>\
  <https://docs.microsoft.com/azure/architecture/microservices/gateway>

- <span data-ttu-id="7a882-266">**Padrão de agregação e composição** </span><span class="sxs-lookup"><span data-stu-id="7a882-266">**Aggregation and composition pattern** </span></span>\
  <https://microservices.io/patterns/data/api-composition.html>

- <span data-ttu-id="7a882-267">**Gerenciamento de API do Azure** </span><span class="sxs-lookup"><span data-stu-id="7a882-267">**Azure API Management** </span></span>\
  <https://azure.microsoft.com/services/api-management/>

- <span data-ttu-id="7a882-268">**Udi Dahan. Composição orientada a serviços** </span><span class="sxs-lookup"><span data-stu-id="7a882-268">**Udi Dahan. Service Oriented Composition** </span></span>\
  <http://udidahan.com/2014/07/30/service-oriented-composition-with-video/>

- <span data-ttu-id="7a882-269">**Clemens Vasters. Mensagens e microsserviços na GOTO 2016 (vídeo)**  </span><span class="sxs-lookup"><span data-stu-id="7a882-269">**Clemens Vasters. Messaging and Microservices at GOTO 2016 (video)** </span></span>\
  <https://www.youtube.com/watch?v=rXi5CLjIQ9k>

- <span data-ttu-id="7a882-270">**Resumo sobre o Gateway de API** (série de tutoriais do Gateway de API do ASP.NET Core) </span><span class="sxs-lookup"><span data-stu-id="7a882-270">**API Gateway in a Nutshell** (ASP.net Core API Gateway Tutorial Series) </span></span>\
  <https://www.pogsdotnet.com/2018/08/api-gateway-in-nutshell.html>

>[!div class="step-by-step"]
><span data-ttu-id="7a882-271">[Anterior](identify-microservice-domain-model-boundaries.md)
>[Próximo](communication-in-microservice-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="7a882-271">[Previous](identify-microservice-domain-model-boundaries.md)
[Next](communication-in-microservice-architecture.md)</span></span>
