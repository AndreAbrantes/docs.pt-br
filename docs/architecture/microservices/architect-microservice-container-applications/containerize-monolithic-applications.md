---
title: Implantar aplicativos monolíticos em contêineres
description: Colocar em contêineres aplicativos monolíticos, embora não obtenha todos os benefícios da arquitetura de microsserviços, tem benefícios de implantação importantes que podem ser entregues imediatamente.
ms.date: 09/20/2018
ms.openlocfilehash: 5b38ba1c2954f4fd4064723b1316afbf09d25bf2
ms.sourcegitcommit: 559259da2738a7b33a46c0130e51d336091c2097
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/22/2019
ms.locfileid: "72771474"
---
# <a name="containerizing-monolithic-applications"></a><span data-ttu-id="5b5ef-103">Implantar aplicativos monolíticos em contêineres</span><span class="sxs-lookup"><span data-stu-id="5b5ef-103">Containerizing monolithic applications</span></span>

<span data-ttu-id="5b5ef-104">Talvez você queira criar um aplicativo ou serviço Web único e monolítico e implantá-lo como um contêiner.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-104">You might want to build a single, monolithically deployed web application or service and deploy it as a container.</span></span> <span data-ttu-id="5b5ef-105">O aplicativo em si pode não ser monolítico internamente, mas estruturado como várias bibliotecas, componentes ou até mesmo camadas (camada de aplicativo, de domínio, de acesso a dados, etc.).</span><span class="sxs-lookup"><span data-stu-id="5b5ef-105">The application itself might not be internally monolithic, but structured as several libraries, components, or even layers (application layer, domain layer, data-access layer, etc.).</span></span> <span data-ttu-id="5b5ef-106">No entanto, externamente ele é um contêiner único – um processo único, um aplicativo Web único ou um serviço único.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-106">Externally, however, it's a single container—a single process, a single web application, or a single service.</span></span>

<span data-ttu-id="5b5ef-107">Para gerenciar esse modelo, implante um contêiner único para representar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-107">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="5b5ef-108">Para aumentar a capacidade, você expande, ou seja, apenas adiciona mais cópias com um balanceador de carga na frente.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-108">To increase capacity, you scale out, that is, just add more copies with a load balancer in front.</span></span> <span data-ttu-id="5b5ef-109">A simplicidade está em gerenciar um a implantação única em um contêiner ou VM único.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-109">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![Um aplicativo em contêineres monolítico tem a maior parte de sua funcionalidade em um único contêiner, com bibliotecas ou camadas internas e é expandido clonando o contêiner em vários servidores/VMs](./media/image1.png)

<span data-ttu-id="5b5ef-111">**Figura 4-1**.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-111">**Figure 4-1**.</span></span> <span data-ttu-id="5b5ef-112">Exemplo de arquitetura de um aplicativo monolítico em contêiner</span><span class="sxs-lookup"><span data-stu-id="5b5ef-112">Example of the architecture of a containerized monolithic application</span></span>

<span data-ttu-id="5b5ef-113">É possível incluir vários componentes, bibliotecas ou camadas internas em cada contêiner, conforme ilustrado na Figura 4-1.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-113">You can include multiple components, libraries, or internal layers in each container, as illustrated in Figure 4-1.</span></span> <span data-ttu-id="5b5ef-114">No entanto, esse padrão monolítico pode entrar em conflito com o princípio do contêiner: "um contêiner executa uma ação em um processo". Porém, em alguns casos não haverá problemas.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-114">However, this monolithic pattern might conflict with the container principle "a container does one thing, and does it in one process", but might be ok for some cases.</span></span>

<span data-ttu-id="5b5ef-115">O ponto negativo dessa abordagem ficará evidente se o aplicativo crescer e for necessário dimensioná-lo.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-115">The downside of this approach becomes evident if the application grows, requiring it to scale.</span></span> <span data-ttu-id="5b5ef-116">Se o aplicativo inteiro puder ser dimensionado, não será realmente um problema.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-116">If the entire application can scale, it isn't really a problem.</span></span> <span data-ttu-id="5b5ef-117">Entretanto, na maioria dos casos apenas algumas partes do aplicativo são os pontos de redução que exigem escalonamento, enquanto outros componentes são menos utilizados.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-117">However, in most cases, just a few parts of the application are the choke points that requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="5b5ef-118">Por exemplo, em um aplicativo comum de comércio eletrônico, provavelmente é preciso dimensionar o subsistema de informações do produto, pois a procura por produtos é maior do que a compra.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-118">For example, in a typical e-commerce application, you likely need to scale the product information subsystem, because many more customers browse products than purchase them.</span></span> <span data-ttu-id="5b5ef-119">Mais clientes usam o carrinho em vez do pipeline de pagamento.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-119">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="5b5ef-120">Menos clientes fazem comentários ou exibem o histórico de compras.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-120">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="5b5ef-121">E você pode ter apenas alguns funcionários que precisam gerenciar as campanhas de conteúdo e marketing.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-121">And you might have only a handful of employees that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="5b5ef-122">Ao escalonar o design monolítico, todo o código dessas tarefas diferentes é implantado diversas vezes e dimensionado no mesmo grau.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-122">If you scale the monolithic design, all the code for these different tasks is deployed multiple times and scaled at the same grade.</span></span>

<span data-ttu-id="5b5ef-123">Há várias maneiras de dimensionar um aplicativo: duplicação horizontal, divisão de diferentes áreas do aplicativo e partição de conceitos ou dados empresariais semelhantes.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-123">There are multiple ways to scale an application-horizontal duplication, splitting different areas of the application, and partitioning similar business concepts or data.</span></span> <span data-ttu-id="5b5ef-124">No entanto, além do problema de dimensionamento de todos os componentes, alterar um único componente exige testar novamente todo o aplicativo e reimplantar todas as instâncias.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-124">But, in addition to the problem of scaling all components, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="5b5ef-125">Porém, a abordagem monolítica é comum, pois o desenvolvimento do aplicativo é inicialmente muito mais fácil do que nas abordagens de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-125">However, the monolithic approach is common, because the development of the application is initially easier than for microservices approaches.</span></span> <span data-ttu-id="5b5ef-126">Assim, diversas organizações desenvolvem usando essas abordagem de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-126">Thus, many organizations develop using this architectural approach.</span></span> <span data-ttu-id="5b5ef-127">Embora algumas delas tenham obtido bons resultados, outras estão atingindo seus limites.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-127">While some organizations have had good enough results, others are hitting limits.</span></span> <span data-ttu-id="5b5ef-128">Muitas organizações criaram aplicativos usando esse modelo porque as ferramentas e a infraestrutura dificultaram bastante a criação de SOAs (arquiteturas orientadas a serviços) no passado e elas não viam necessidade disso – até os aplicativos crescerem.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-128">Many organizations designed their applications using this model because tools and infrastructure made it too difficult to build service-oriented architectures (SOA) years ago, and they did not see the need-until the application grew.</span></span>

<span data-ttu-id="5b5ef-129">De uma perspectiva de infraestrutura, cada servidor pode executar vários aplicativos no mesmo host e ter um índice de eficiência razoável de uso de recursos, conforme mostrado na Figura 4-2.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-129">From an infrastructure perspective, each server can run many applications within the same host and have an acceptable ratio of efficiency in resources usage, as shown in Figure 4-2.</span></span>

![Um host pode executar vários aplicativos monolíticos, cada um em um contêiner separado.](./media/image2.png)

<span data-ttu-id="5b5ef-131">**Figura 4-2**.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-131">**Figure 4-2**.</span></span> <span data-ttu-id="5b5ef-132">Abordagem monolítica: host executando vários aplicativos, cada um em execução como um contêiner</span><span class="sxs-lookup"><span data-stu-id="5b5ef-132">Monolithic approach: Host running multiple apps, each app running as a container</span></span>

<span data-ttu-id="5b5ef-133">Os aplicativos monolíticos no Microsoft Azure podem ser implantados por meio de VMs dedicadas a cada instância.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-133">Monolithic applications in Microsoft Azure can be deployed using dedicated VMs for each instance.</span></span> <span data-ttu-id="5b5ef-134">Além disso, usando [conjuntos de dimensionamento de máquinas virtuais do Azure](https://azure.microsoft.com/documentation/services/virtual-machine-scale-sets/), você pode dimensionar VMs facilmente.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-134">Additionally, using [Azure virtual machine scale sets](https://azure.microsoft.com/documentation/services/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="5b5ef-135">O [Serviço de Aplicativo do Azure](https://azure.microsoft.com/services/app-service/) também executa aplicativos monolíticos e dimensiona instâncias facilmente sem necessidade de gerenciamento de VMs.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-135">[Azure App Service](https://azure.microsoft.com/services/app-service/) can also run monolithic applications and easily scale instances without requiring you to manage the VMs.</span></span> <span data-ttu-id="5b5ef-136">Desde 2016, o Serviços de Aplicativos do Azure também pode executar instâncias únicas de contêineres do Docker, simplificando a implantação.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-136">Since 2016, Azure App Services can run single instances of Docker containers as well, simplifying deployment.</span></span>

<span data-ttu-id="5b5ef-137">Como em um ambiente de garantia de qualidade ou de produção limitada, é possível implantar diversas VMs host do Docker e balanceá-las usando o balanceador do Azure, conforme mostrado na Figura 4-3.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-137">As a QA environment or a limited production environment, you can deploy multiple Docker host VMs and balance them using the Azure balancer, as shown in Figure 4-3.</span></span> <span data-ttu-id="5b5ef-138">Assim, você pode gerenciar o dimensionamento com uma abordagem de alta granularidade, pois o aplicativo inteiro está em um único contêiner.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-138">This lets you manage scaling with a coarse-grain approach, because the whole application lives within a single container.</span></span>

![Vários hosts, cada um executando um contêiner com o aplicativo monolítico.](./media/image3.png)

<span data-ttu-id="5b5ef-140">**Figura 4-3**.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-140">**Figure 4-3**.</span></span> <span data-ttu-id="5b5ef-141">Exemplo de vários hosts escalando verticalmente um aplicativo em contêiner único</span><span class="sxs-lookup"><span data-stu-id="5b5ef-141">Example of multiple hosts scaling up a single container application</span></span>

<span data-ttu-id="5b5ef-142">A implantação em vários hosts pode ser gerenciada com técnicas de implantação tradicionais.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-142">Deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="5b5ef-143">Os hosts do Docker podem ser gerenciados manualmente com comandos como `docker run` ou `docker-compose`. Outra opção é a automação, como os pipelines de entrega contínua.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-143">Docker hosts can be managed with commands like `docker run` or `docker-compose` performed manually, or through automation such as continuous delivery (CD) pipelines.</span></span>

## <a name="deploying-a-monolithic-application-as-a-container"></a><span data-ttu-id="5b5ef-144">Implantar um aplicativo monolítico como um contêiner</span><span class="sxs-lookup"><span data-stu-id="5b5ef-144">Deploying a monolithic application as a container</span></span>

<span data-ttu-id="5b5ef-145">Há benefícios em usar contêineres para gerenciar implantações de aplicativos monolíticos.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-145">There are benefits to using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="5b5ef-146">O dimensionamento de instâncias de contêiner é muito mais rápido e fácil do que a implantação de VMs adicionais.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-146">Scaling container instances is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="5b5ef-147">Mesmo se você usar os conjuntos de dimensionamento de máquinas virtuais, as VMs levarão tempo para iniciar.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-147">Even if you use virtual machine scale sets, VMs take time to start.</span></span> <span data-ttu-id="5b5ef-148">Quando implantado como instâncias de aplicativo tradicionais em vez de contêineres, a configuração do aplicativo é gerenciada como parte da VM, o que não é o ideal.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-148">When deployed as traditional application instances instead of containers, the configuration of the application is managed as part of the VM, which isn't ideal.</span></span>

<span data-ttu-id="5b5ef-149">Implantar atualizações como imagens do Docker é muito mais rápido e eficiente em termos de rede.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-149">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="5b5ef-150">As imagens do Docker se inicializam em questão de segundos, o que agiliza a distribuição.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-150">Docker images typically start in seconds, which speeds rollouts.</span></span> <span data-ttu-id="5b5ef-151">Destruir uma instância de imagem do Docker é tão fácil quanto emitir um comando `docker stop` e geralmente leva menos de um segundo.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-151">Tearing down a Docker image instance is as easy as issuing a `docker stop` command, and typically completes in less than a second.</span></span>

<span data-ttu-id="5b5ef-152">Como o design dos contêineres é imutável, não é necessário se preocupar com VMs corrompidas.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-152">Because containers are immutable by design, you never need to worry about corrupted VMs.</span></span> <span data-ttu-id="5b5ef-153">Por outro lado, os scripts de atualização de uma VM podem não levar em conta configurações específicas ou arquivos deixados no disco.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-153">In contrast, update scripts for a VM might forget to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="5b5ef-154">Embora aplicativos monolíticos possam se beneficiar do Docker, estamos mencionando apenas as vantagens.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-154">While monolithic applications can benefit from Docker, we're touching only on the benefits.</span></span> <span data-ttu-id="5b5ef-155">Outros pontos positivos de gerenciar contêineres são decorrentes da implantação com orquestradores de contêiner, que gerenciam as diversas instâncias e o ciclo de vida de cada instância de contêiner.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-155">Additional benefits of managing containers come from deploying with container orchestrators, which manage the various instances and lifecycle of each container instance.</span></span> <span data-ttu-id="5b5ef-156">Dividir o aplicativo monolítico em subsistemas que podem ser dimensionados, desenvolvidos e implantados individualmente é o ponto de entrada no universo dos microsserviços.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-156">Breaking up the monolithic application into subsystems that can be scaled, developed, and deployed individually is your entry point into the realm of microservices.</span></span>

## <a name="publishing-a-single-container-based-application-to-azure-app-service"></a><span data-ttu-id="5b5ef-157">Publicar um aplicativo baseado em contêiner único no Serviço de Aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="5b5ef-157">Publishing a single-container-based application to Azure App Service</span></span>

<span data-ttu-id="5b5ef-158">Seja para validar um contêiner implantado no Azure ou quando um aplicativo é baseado em contêiner único, o Serviço de Aplicativo do Azure é uma ótima maneira de oferecer serviços escalonáveis baseados em contêiner único.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-158">Whether you want to get validation of a container deployed to Azure or when an application is simply a single-container application, Azure App Service provides a great way to provide scalable single-container-based services.</span></span> <span data-ttu-id="5b5ef-159">Usar o Serviço de Aplicativo do Azure é simples.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-159">Using Azure App Service is simple.</span></span> <span data-ttu-id="5b5ef-160">Ele tem uma ótima integração com o GIT para facilitar a implantação do código criado no Visual Studio diretamente no Azure.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-160">It provides great integration with Git to make it easy to take your code, build it in Visual Studio, and deploy it directly to Azure.</span></span>

![O assistente para publicar um aplicativo baseado em contêiner único no Serviço de Aplicativo do Azure por meio do Visual Studio](./media/image4.png)

<span data-ttu-id="5b5ef-162">**Figura 4-4**.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-162">**Figure 4-4**.</span></span> <span data-ttu-id="5b5ef-163">Publicar um aplicativo baseado em contêiner único no Serviço de Aplicativo do Azure por meio do Visual Studio</span><span class="sxs-lookup"><span data-stu-id="5b5ef-163">Publishing a single-container application to Azure App Service from Visual Studio</span></span>

<span data-ttu-id="5b5ef-164">Sem o Docker, se você precisasse de outros recursos, estruturas ou dependências sem suporte no Serviço de Aplicativo do Azure, seria necessário aguardar até que a equipe do Azure atualizasse essas dependências no Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-164">Without Docker, if you needed other capabilities, frameworks, or dependencies that aren't supported in Azure App Service, you had to wait until the Azure team updated those dependencies in App Service.</span></span> <span data-ttu-id="5b5ef-165">Outra opção era mudar para outros serviços, como Serviços de Nuvem do Azure, ou VMs, em que se tinha mais controle e era possível instalar o componente ou a estrutura exigidos pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-165">Or you had to switch to other services like Azure Cloud Services or VMs, where you had further control and you could install a required component or framework for your application.</span></span>

<span data-ttu-id="5b5ef-166">No Visual Studio 2017 e posterior, o suporte para contêineres oferece a capacidade de incluir tudo o que você deseja no ambiente do aplicativo, conforme mostrado na Figura 4-4.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-166">Container support in Visual Studio 2017 and later gives you the ability to include whatever you want in your application environment, as shown in Figure 4-4.</span></span> <span data-ttu-id="5b5ef-167">Como está sendo executado em um contêiner, se você adicionar uma dependência ao aplicativo, será possível incluí-la em um Dockerfile ou em uma imagem do Docker.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-167">Since you're running it in a container, if you add a dependency to your application, you can include the dependency in your Dockerfile or Docker image.</span></span>

<span data-ttu-id="5b5ef-168">A Figura 4-4 também mostra que o fluxo de publicação envia uma imagem por meio do registro de contêiner.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-168">As also shown in Figure 4-4, the publish flow pushes an image through a container registry.</span></span> <span data-ttu-id="5b5ef-169">Isso pode ser feito pelo Registro de Contêiner do Azure (um registro próximo às implantações no Azure e protegido por grupos e contas do Azure Active Directory) ou outros registros do Docker, como o Docker Hub ou um registro local.</span><span class="sxs-lookup"><span data-stu-id="5b5ef-169">This can be the Azure Container Registry (a registry close to your deployments in Azure and secured by Azure Active Directory groups and accounts), or any other Docker registry, like Docker Hub or an on-premises registry.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="5b5ef-170">[Anterior](index.md)
>[Próximo](docker-application-state-data.md)</span><span class="sxs-lookup"><span data-stu-id="5b5ef-170">[Previous](index.md)
[Next](docker-application-state-data.md)</span></span>
