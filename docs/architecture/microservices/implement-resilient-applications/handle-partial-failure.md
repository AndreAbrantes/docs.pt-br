---
title: Tratando falha parcial
description: Saiba como tratar falhas parciais normalmente. Um microsserviço pode não estar totalmente funcional, mas ainda conseguir realizar algum trabalho útil.
ms.date: 10/16/2018
ms.openlocfilehash: f00e5349df74b543deb6ac941c751cb130b3837c
ms.sourcegitcommit: 22be09204266253d45ece46f51cc6f080f2b3fd6
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/07/2019
ms.locfileid: "73732986"
---
# <a name="handle-partial-failure"></a><span data-ttu-id="2cfc4-104">Tratar falhas parciais</span><span class="sxs-lookup"><span data-stu-id="2cfc4-104">Handle partial failure</span></span>

<span data-ttu-id="2cfc4-105">Em sistemas distribuídos como aplicativos baseados em microsserviços, há um risco de falha parcial sempre presente.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-105">In distributed systems like microservices-based applications, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="2cfc4-106">Por exemplo, um único microsserviço/contêiner pode falhar ou pode não estar disponível para responder por um curto período, ou um único servidor ou VM pode falhar.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-106">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="2cfc4-107">Como clientes e serviços são processos separados, um serviço pode não ser capaz de responder de forma oportuna a uma solicitação do cliente.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-107">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client’s request.</span></span> <span data-ttu-id="2cfc4-108">O serviço pode estar sobrecarregado e respondendo a solicitações de maneira muito lenta ou pode simplesmente não estar acessível durante um curto período devido a problemas de rede.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-108">The service might be overloaded and responding very slowly to requests or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="2cfc4-109">Por exemplo, considere a página de detalhes Ordem do aplicativo de exemplo eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-109">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="2cfc4-110">Se o microsserviço de ordenação não estiver respondendo quando o usuário tentar enviar uma ordem, uma implementação incorreta do processo do cliente (o aplicativo Web MVC) – por exemplo, se o código do cliente usasse RPCs síncronos sem tempo limite – bloqueará threads indefinidamente que estão aguardando uma resposta.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-110">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="2cfc4-111">Além de criar uma experiência de usuário ruim, toda espera sem resposta consome ou bloqueia um thread, e os threads são extremamente valiosos em aplicativos altamente escalonáveis.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-111">Besides creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="2cfc4-112">Se houver muitos threads bloqueados, o runtime do aplicativo poderá eventualmente ficar sem threads.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-112">If there are many blocked threads, eventually the application’s runtime can run out of threads.</span></span> <span data-ttu-id="2cfc4-113">Nesse caso, o aplicativo poderá ficar globalmente sem resposta, em vez de apenas parcialmente sem resposta, como mostra a Figura 8-1.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-113">In that case, the application can become globally unresponsive instead of just partially unresponsive, as shown in Figure 8-1.</span></span>

![Diagrama mostrando falhas parciais.](./media/handle-partial-failure/partial-failures-diagram.png)

<span data-ttu-id="2cfc4-115">**Figura 8-1**.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-115">**Figure 8-1**.</span></span> <span data-ttu-id="2cfc4-116">Falhas parciais devido a dependências que afetam a disponibilidade do thread de serviço</span><span class="sxs-lookup"><span data-stu-id="2cfc4-116">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="2cfc4-117">Em um aplicativo grande baseado em microsserviços, falhas parciais poderão ser amplificadas, principalmente se a maioria da interação interna dos microsserviços for baseada em chamadas HTTP síncronas (o que é considerado um antipadrão).</span><span class="sxs-lookup"><span data-stu-id="2cfc4-117">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="2cfc4-118">Pense em um sistema que recebe milhões de chamadas de entrada por dia.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-118">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="2cfc4-119">Se o sistema tiver um design ruim baseado em longas cadeias de chamadas HTTP síncronas, essas chamadas de entrada poderão resultar em muito mais milhões de chamadas de saída (vamos supor uma razão de 1:4) a dezenas de microsserviços internos como dependências síncronas.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-119">If your system has a bad design that's based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let’s suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="2cfc4-120">Essa situação é mostrada na Figura 8-2, especialmente a dependência \#3, que inicia uma cadeia, chamando a dependência #4.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-120">This situation is shown in Figure 8-2, especially dependency \#3, that starts a chain, calling dependency #4.</span></span> <span data-ttu-id="2cfc4-121">que as chamadas #5.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-121">which the calls #5.</span></span>

![Diagrama mostrando várias dependências distribuídas.](./media/handle-partial-failure/multiple-distributed-dependencies.png)

<span data-ttu-id="2cfc4-123">**Figura 8-2**.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-123">**Figure 8-2**.</span></span> <span data-ttu-id="2cfc4-124">O impacto de ter um design incorreto com longas cadeias de solicitações HTTP</span><span class="sxs-lookup"><span data-stu-id="2cfc4-124">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="2cfc4-125">A falha intermitente é garantida em um sistema distribuído e baseado em nuvem, mesmo quando cada dependência têm uma disponibilidade excelente.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-125">Intermittent failure is guaranteed in a distributed and cloud-based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="2cfc4-126">Esse um fato que você precisa considerar.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-126">It's a fact you need to consider.</span></span>

<span data-ttu-id="2cfc4-127">Se você não criar nem implementar técnicas para garantir a tolerância a falhas, até mesmo pequenos tempos de inatividade poderão ser amplificados.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-127">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="2cfc4-128">Por exemplo, 50 dependências, cada uma com 99,99% de disponibilidade, poderia resultar em várias horas de tempo de inatividade por mês devido a esse efeito de ondulação.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-128">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="2cfc4-129">Quando uma dependência de microsserviço falhar ao manipular um alto volume de solicitações, essa falha poderá saturar rapidamente todos os threads de solicitação disponíveis em cada serviço e causar uma pane em todo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-129">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![Diagrama mostrando falha parcial amplificada em microserviços.](./media/handle-partial-failure/partial-failure-amplified-microservices.png)

<span data-ttu-id="2cfc4-131">**Figura 8-3**.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-131">**Figure 8-3**.</span></span> <span data-ttu-id="2cfc4-132">Falha parcial amplificada por microsserviços com longas cadeias de chamadas HTTP síncronas</span><span class="sxs-lookup"><span data-stu-id="2cfc4-132">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="2cfc4-133">Para minimizar esse problema, na seção [A integração assíncrona do microsserviço impõe a autonomia do microsserviço](../architect-microservice-container-applications/communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy), esse guia indica o uso da comunicação assíncrona entre os microsserviços internos.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-133">To minimize this problem, in the section [Asynchronous microservice integration enforce microservice’s autonomy](../architect-microservice-container-applications/communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy), this guide encourages you to use asynchronous communication across the internal microservices.</span></span>

<span data-ttu-id="2cfc4-134">Além disso, é essencial que você crie seus aplicativos cliente e microsserviços para lidar com falhas parciais, ou seja, crie microsserviços e aplicativos cliente resilientes.</span><span class="sxs-lookup"><span data-stu-id="2cfc4-134">In addition, it's essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="2cfc4-135">[Anterior](index.md)
>[Próximo](partial-failure-strategies.md)</span><span class="sxs-lookup"><span data-stu-id="2cfc4-135">[Previous](index.md)
[Next](partial-failure-strategies.md)</span></span>
