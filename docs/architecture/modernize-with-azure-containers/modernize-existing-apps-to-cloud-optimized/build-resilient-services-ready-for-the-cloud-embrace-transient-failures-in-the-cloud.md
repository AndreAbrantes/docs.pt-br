---
title: Crie serviços resilientes prontos para a nuvem. adote as falhas transitórias na nuvem
description: Modernizar aplicativos .NET existentes com contêineres de nuvem e Windows do Azure | Crie serviços resilientes prontos para a nuvem. adote as falhas transitórias na nuvem
ms.date: 04/30/2018
ms.openlocfilehash: 5f44029a214cf1f366fc787e27a9ac34599c4dca
ms.sourcegitcommit: c70542d02736e082e8dac67dad922c19249a8893
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/05/2019
ms.locfileid: "70373967"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="dc383-105">Crie serviços resilientes prontos para a nuvem: adote as falhas transitórias na nuvem</span><span class="sxs-lookup"><span data-stu-id="dc383-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="dc383-106">A resiliência é a capacidade de recuperar de falhas e continuar a funcionar.</span><span class="sxs-lookup"><span data-stu-id="dc383-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="dc383-107">A resiliência não está prestes a evitar falhas, mas aceitando o fato de que as falhas ocorrerão e, em seguida, respondendo a elas de uma forma que evite tempo de inatividade ou perda de dados.</span><span class="sxs-lookup"><span data-stu-id="dc383-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="dc383-108">A meta de resiliência é retornar o aplicativo para um estado totalmente funcional após uma falha.</span><span class="sxs-lookup"><span data-stu-id="dc383-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="dc383-109">Seu aplicativo está pronto para a nuvem quando, no mínimo, implementa um modelo de resiliência baseado em software, em vez de um modelo baseado em hardware.</span><span class="sxs-lookup"><span data-stu-id="dc383-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="dc383-110">Seu aplicativo de nuvem deve adotar as falhas parciais que certamente ocorrerão.</span><span class="sxs-lookup"><span data-stu-id="dc383-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="dc383-111">Projetar ou refatorar parcialmente seu aplicativo para obter resiliência com falhas parciais esperadas.</span><span class="sxs-lookup"><span data-stu-id="dc383-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="dc383-112">Ele deve ser projetado para lidar com falhas parciais, como interrupções de rede transitórias e nós, ou VMs falhando na nuvem.</span><span class="sxs-lookup"><span data-stu-id="dc383-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="dc383-113">Até mesmo os contêineres sendo movidos para um nó diferente dentro de um cluster Orchestrator podem causar falhas curtas intermitentes dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="dc383-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="dc383-114">Tratando falha parcial</span><span class="sxs-lookup"><span data-stu-id="dc383-114">Handling partial failure</span></span>

<span data-ttu-id="dc383-115">Em um aplicativo baseado em nuvem, há um risco de falha parcial em qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="dc383-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="dc383-116">Por exemplo, uma única instância de site ou um contêiner pode falhar ou pode estar indisponível ou sem resposta por um curto período de tempo.</span><span class="sxs-lookup"><span data-stu-id="dc383-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="dc383-117">Ou, uma única VM ou servidor pode falhar.</span><span class="sxs-lookup"><span data-stu-id="dc383-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="dc383-118">Como clientes e serviços são processos separados, um serviço pode não ser capaz de responder oportunamente à solicitação de um cliente.</span><span class="sxs-lookup"><span data-stu-id="dc383-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="dc383-119">O serviço pode estar sobrecarregado e responder lentamente a solicitações ou pode não estar acessível por um curto período devido a problemas de rede.</span><span class="sxs-lookup"><span data-stu-id="dc383-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="dc383-120">Por exemplo, considere um aplicativo .NET monolítico que acessa um banco de dados no banco de dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="dc383-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="dc383-121">Se o banco de dados SQL do Azure ou qualquer outro serviço de terceiros não estiver respondendo por um breve tempo (um banco de dados SQL do Azure pode ser movido para um nó ou servidor diferente e não responder por alguns segundos), quando o usuário tentar realizar qualquer ação, o aplicativo poderá falhar e mostrar w uma exceção ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="dc383-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="dc383-122">Um cenário semelhante pode ocorrer em um aplicativo que consome serviços HTTP.</span><span class="sxs-lookup"><span data-stu-id="dc383-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="dc383-123">A rede ou o serviço em si pode não estar disponível na nuvem durante uma falha curta e transitória.</span><span class="sxs-lookup"><span data-stu-id="dc383-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="dc383-124">Um aplicativo resiliente como o mostrado na Figura 4-9 deve implementar técnicas como "repetições com retirada exponencial" para dar ao aplicativo uma oportunidade de lidar com falhas transitórias nos recursos.</span><span class="sxs-lookup"><span data-stu-id="dc383-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="dc383-125">Você também deve usar "disjuntores de circuito" em seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="dc383-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="dc383-126">Um disjuntor impede que um aplicativo tente acessar um recurso quando é realmente uma falha de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="dc383-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="dc383-127">Usando um disjuntor, o aplicativo evita provocativa uma negação de serviço a si mesmo.</span><span class="sxs-lookup"><span data-stu-id="dc383-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Falhas parciais tratadas por repetições com retirada exponencial](./media/image9.png)

<span data-ttu-id="dc383-129">**Figura 4-9.**</span><span class="sxs-lookup"><span data-stu-id="dc383-129">**Figure 4-9.**</span></span> <span data-ttu-id="dc383-130">Falhas parciais tratadas por repetições com retirada exponencial</span><span class="sxs-lookup"><span data-stu-id="dc383-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="dc383-131">Você pode usar essas técnicas tanto em recursos HTTP quanto em recursos de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dc383-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="dc383-132">Na Figura 4-9, o aplicativo é baseado em uma arquitetura de três camadas, portanto, você precisa dessas técnicas no nível de serviços (HTTP) e no nível de camada de dados (TCP).</span><span class="sxs-lookup"><span data-stu-id="dc383-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="dc383-133">Em um aplicativo monolítico que usa uma única camada de aplicativo além do banco de dados (sem serviços ou microserviços adicionais), lidar com falhas transitórias no nível de conexão do banco de dados pode ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="dc383-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="dc383-134">Nesse cenário, apenas uma configuração específica da conexão de banco de dados é necessária.</span><span class="sxs-lookup"><span data-stu-id="dc383-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="dc383-135">Ao implementar comunicações resilientes que acessam o banco de dados, dependendo da versão do .NET que você está usando, pode ser simples (por exemplo, [com o Entity Framework 6 ou posterior](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span><span class="sxs-lookup"><span data-stu-id="dc383-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="dc383-136">É apenas uma questão de configurar a conexão de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dc383-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="dc383-137">Ou talvez você precise usar bibliotecas adicionais, como o [bloco de aplicativo de tratamento de falhas transitórias](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (para versões anteriores do .net), ou até mesmo implementar sua própria biblioteca.</span><span class="sxs-lookup"><span data-stu-id="dc383-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="dc383-138">Ao implementar repetições de HTTP e disparadores de circuito, a recomendação para o .NET é usar a biblioteca [Polly](https://github.com/App-vNext/Polly) , que tem como alvo .NET Framework 4,0, .NET Framework 4,5 e .net Standard 1,1, que inclui o suporte do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="dc383-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Framework 4.0, .NET Framework 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="dc383-139">Para saber como implementar estratégias para lidar com falhas parciais na nuvem, consulte as referências a seguir.</span><span class="sxs-lookup"><span data-stu-id="dc383-139">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="dc383-140">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="dc383-140">Additional resources</span></span>

- <span data-ttu-id="dc383-141">**Implementando a comunicação resiliente para lidar com falhas parciais**</span><span class="sxs-lookup"><span data-stu-id="dc383-141">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/architecture/microservices/implement-resilient-applications/partial-failure-strategies](../../microservices/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="dc383-142">**Entity Framework a resiliência da conexão e a lógica de repetição (versão 6 e posterior)**</span><span class="sxs-lookup"><span data-stu-id="dc383-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="dc383-143">**O bloco de aplicativo de tratamento de falhas transitórias**</span><span class="sxs-lookup"><span data-stu-id="dc383-143">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="dc383-144">**Biblioteca Polly para comunicação HTTP resiliente**</span><span class="sxs-lookup"><span data-stu-id="dc383-144">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
><span data-ttu-id="dc383-145">[Anterior](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Próximo](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="dc383-145">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
