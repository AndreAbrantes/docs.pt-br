---
title: Como implantar o eShopOnContainers no Azure
description: Implantando o aplicativo eShopOnContainers usando o serviço kubernetes do Azure, o Helm e o DevSpaces.
ms.date: 06/30/2019
ms.openlocfilehash: 21033cc904dc595193c69f3452ce2522740f8ff6
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/23/2019
ms.locfileid: "71183269"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="850c6-103">Como implantar o eShopOnContainers no Azure</span><span class="sxs-lookup"><span data-stu-id="850c6-103">Deploying eShopOnContainers to Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="850c6-104">A lógica que dá suporte ao aplicativo eShopOnContainers pode ser suportada pelo Azure usando uma variedade de serviços.</span><span class="sxs-lookup"><span data-stu-id="850c6-104">The logic supporting the eShopOnContainers application can be supported by Azure using a variety of services.</span></span> <span data-ttu-id="850c6-105">A abordagem recomendada é aproveitar o kubernetes usando o AKS (serviço kubernetes do Azure).</span><span class="sxs-lookup"><span data-stu-id="850c6-105">The recommended approach is to leverage Kubernetes using Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="850c6-106">Isso pode ser combinado com a implantação do Helm para garantir uma configuração de infraestrutura facilmente repetida.</span><span class="sxs-lookup"><span data-stu-id="850c6-106">This can be combined with Helm deployment to ensure easily repeated infrastructure configuration.</span></span> <span data-ttu-id="850c6-107">Opcionalmente, os desenvolvedores podem aproveitar Azure Dev Spaces para kubernetes como parte de seu processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="850c6-107">Optionally, developers can leverage Azure Dev Spaces for Kubernetes as part of their development process.</span></span> <span data-ttu-id="850c6-108">Outra opção é hospedar a funcionalidade do aplicativo usando recursos sem servidor do Azure, como Azure Functions e aplicativos lógicos do Azure.</span><span class="sxs-lookup"><span data-stu-id="850c6-108">Another option is to host the functionality of the app using Azure Serverless features like Azure Functions and Azure Logic Apps.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="850c6-109">Serviço de Kubernetes do Azure</span><span class="sxs-lookup"><span data-stu-id="850c6-109">Azure Kubernetes Service</span></span>

<span data-ttu-id="850c6-110">Se você quiser hospedar o aplicativo eShopOnContainers em seu próprio cluster AKS, a primeira etapa será criar o cluster.</span><span class="sxs-lookup"><span data-stu-id="850c6-110">If you'd like to host the eShopOnContainers application in your own AKS cluster, the first step is to create your cluster.</span></span> <span data-ttu-id="850c6-111">Você pode fazer isso usando o portal do Azure, que irá orientá-lo pelas etapas necessárias, ou você pode usar o CLI do Azure, tomando cuidado para garantir que você habilite o controle de acesso baseado em função (RBAC) e o roteamento de aplicativos quando fizer isso.</span><span class="sxs-lookup"><span data-stu-id="850c6-111">You can do this using the Azure portal, which will walk you through the required steps, or you can use the Azure CLI, taking care to ensure you enable Role-Based Access Control (RBAC) and application routing when you do so.</span></span> <span data-ttu-id="850c6-112">A documentação do eShopOnContainers ' descreve as etapas envolvidas na criação de seu próprio cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="850c6-112">The eShopOnContainers' documentation describes the steps involved in creating your own AKS cluster.</span></span> <span data-ttu-id="850c6-113">Depois que o cluster é criado, você deve habilitar o acesso ao painel do kubernetes, ponto em que você deve ser capaz de navegar até o painel do kubernetes para gerenciar o cluster.</span><span class="sxs-lookup"><span data-stu-id="850c6-113">Once the cluster is created, you must enable access to the Kubernetes dashboard, at which point you should be able to browse to the Kubernetes dashboard to manage the cluster.</span></span>

<span data-ttu-id="850c6-114">Depois que o cluster tiver sido criado e configurado, você poderá implantar o aplicativo nele usando o Helm e o gaveta.</span><span class="sxs-lookup"><span data-stu-id="850c6-114">Once the cluster has been created and configured, you can deploy the application to it using Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="850c6-115">Implantando no serviço kubernetes do Azure usando o Helm</span><span class="sxs-lookup"><span data-stu-id="850c6-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="850c6-116">As implantações básicas no AKS podem usar scripts CLI personalizados ou arquivos de implantação simples, mas aplicativos mais complexos devem usar uma ferramenta de gerenciamento de dependência como Helm.</span><span class="sxs-lookup"><span data-stu-id="850c6-116">Basic deployments to AKS may use custom CLI scripts or simple deployment files, but more complex applications should use a dependency management tool like Helm.</span></span> <span data-ttu-id="850c6-117">O Helm é mantido pela base de computação nativa em nuvem e ajuda você a definir, instalar e atualizar aplicativos kubernetes.</span><span class="sxs-lookup"><span data-stu-id="850c6-117">Helm is maintained by the Cloud-native Computing Foundation and helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="850c6-118">O Helm é composto por um cliente de linha de comando, Helm, que usa gráficos do Helm e um componente no cluster, o.</span><span class="sxs-lookup"><span data-stu-id="850c6-118">Helm is composed of a command-line client, helm, which uses helm charts, and an in-cluster component, Tiller.</span></span> <span data-ttu-id="850c6-119">Os gráficos Helm usam arquivos padrão formatados por YAML para descrever um conjunto relacionado de recursos do kubernetes e são normalmente com controle de versão junto com o aplicativo que eles descrevem.</span><span class="sxs-lookup"><span data-stu-id="850c6-119">Helm Charts use standard YAML-formatted files to describe a related set of Kubernetes resources and are typically versioned alongside the application they describe.</span></span> <span data-ttu-id="850c6-120">Os gráficos Helm variam de simples a complexo, dependendo dos requisitos da instalação que descrevem.</span><span class="sxs-lookup"><span data-stu-id="850c6-120">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="850c6-121">Você encontrará os gráficos eShopOnContainers Helm na pasta/K8S/Helm.</span><span class="sxs-lookup"><span data-stu-id="850c6-121">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="850c6-122">A Figura 2-6 mostra como os diferentes componentes do aplicativo são organizados em uma estrutura de pastas usada pelo Helm para definir e implantações gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="850c6-122">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="850c6-123">![arquitetura eShopOnContainers](./media/eshoponcontainers-helm-folder.png)
**figura 2-6**.</span><span class="sxs-lookup"><span data-stu-id="850c6-123">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="850c6-124">A pasta eShopOnContainers Helm</span><span class="sxs-lookup"><span data-stu-id="850c6-124">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="850c6-125">Cada componente individual é instalado usando um comando `helm install`.</span><span class="sxs-lookup"><span data-stu-id="850c6-125">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="850c6-126">Esses comandos são facilmente incluídos no script e o eShopOnContainers fornece um script "implantar tudo" que faz o loop pelos diferentes componentes e os instala usando seus respectivos gráficos do Helm.</span><span class="sxs-lookup"><span data-stu-id="850c6-126">These commands are easily scripted, and eShopOnContainers provides a "deploy all" script that loops through the different components and installs them using their respective helm charts.</span></span> <span data-ttu-id="850c6-127">O resultado é um processo repetível, com versão com o aplicativo no controle do código-fonte, que qualquer pessoa da equipe pode implantar em um cluster AKS com um comando de script de uma linha.</span><span class="sxs-lookup"><span data-stu-id="850c6-127">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span> <span data-ttu-id="850c6-128">Especialmente quando combinado com Azure Dev Spaces, isso torna mais fácil para os desenvolvedores diagnosticar e testar suas alterações individuais em seus aplicativos nativos de nuvem baseados em microserviço.</span><span class="sxs-lookup"><span data-stu-id="850c6-128">Especially when combined with Azure Dev Spaces, this makes it easy for developers to diagnose and test their individual changes to their microservice-based cloud-native apps.</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="850c6-129">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="850c6-129">Azure Dev Spaces</span></span>

<span data-ttu-id="850c6-130">Azure Dev Spaces ajuda os desenvolvedores individuais a hospedarem sua própria versão exclusiva dos clusters AKS no Azure durante o desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="850c6-130">Azure Dev Spaces helps individual developers host their own unique version of AKS clusters in Azure during development.</span></span> <span data-ttu-id="850c6-131">Isso minimiza os requisitos do computador local e permite que os membros da equipe vejam rapidamente como suas alterações se comportarão em um ambiente AKS real.</span><span class="sxs-lookup"><span data-stu-id="850c6-131">This minimizes local machine requirements and allows team members to quickly see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="850c6-132">O Azure Dev Spaces oferece uma CLI para que os desenvolvedores usem para gerenciar seus espaços de desenvolvimento e para implantar em um espaço de desenvolvimento filho específico, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="850c6-132">Azure Dev Spaces offers a CLI for developers to use to manage their dev spaces and to deploy to a specific child dev space as needed.</span></span> <span data-ttu-id="850c6-133">Cada espaço de desenvolvimento filho é referenciado usando um subdomínio de URL exclusivo, permitindo implantações lado a lado de clusters modificados para que os desenvolvedores individuais possam evitar conflitos com o trabalho de cada um deles em andamento.</span><span class="sxs-lookup"><span data-stu-id="850c6-133">Each child dev space is referenced using a unique URL subdomain, allowing side-by-side deployments of modified clusters so that individual developers can avoid conflicting with each other's work in progress.</span></span> <span data-ttu-id="850c6-134">Na Figura 2-7, você pode ver como o desenvolvedor Susana implantou sua própria versão do microserviço bikes em seu espaço de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="850c6-134">In Figure 2-7 you can see how developer Susie has deployed her own version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="850c6-135">Em seguida, ela é capaz de testar suas alterações usando uma URL personalizada que começa com o nome de seu espaço (susie.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="850c6-135">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="850c6-136">![arquitetura eShopOnContainers](./media/azure-devspaces-one.png)
**figura 2-7**.</span><span class="sxs-lookup"><span data-stu-id="850c6-136">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="850c6-137">O Developer Susana implanta sua própria versão do microserviço Bikes e a testa.</span><span class="sxs-lookup"><span data-stu-id="850c6-137">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="850c6-138">Ao mesmo tempo, o desenvolvedor John está Personalizando o microserviço de reservas e precisa testar suas alterações.</span><span class="sxs-lookup"><span data-stu-id="850c6-138">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="850c6-139">Ele é capaz de implantar suas alterações em seu próprio espaço de desenvolvimento sem entrar em conflito com as alterações do Susana, conforme mostrado na Figura 2-8.</span><span class="sxs-lookup"><span data-stu-id="850c6-139">He's able to deploy his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="850c6-140">Ele pode testar suas alterações usando sua própria URL, que é prefixada com o nome de seu espaço (john.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="850c6-140">He can test his changes using his own URL which is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="850c6-141">![arquitetura eShopOnContainers](./media/azure-devspaces-two.png)
**figura 2-8**.</span><span class="sxs-lookup"><span data-stu-id="850c6-141">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="850c6-142">O desenvolvedor John implanta sua própria versão do microserviço de reservas e a testa sem entrar em conflito com outros desenvolvedores.</span><span class="sxs-lookup"><span data-stu-id="850c6-142">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="850c6-143">Usando Azure Dev Spaces, as equipes podem trabalhar diretamente com o AKS enquanto alteram, implantam e testam suas alterações de forma independente.</span><span class="sxs-lookup"><span data-stu-id="850c6-143">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="850c6-144">Essa abordagem reduz a necessidade de ambientes hospedados dedicados separados, pois cada desenvolvedor efetivamente tem seu próprio ambiente AKS.</span><span class="sxs-lookup"><span data-stu-id="850c6-144">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="850c6-145">Os desenvolvedores podem trabalhar com Azure Dev Spaces usando sua CLI ou iniciar seu aplicativo para Azure Dev Spaces diretamente do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="850c6-145">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="850c6-146">Saiba mais sobre como Azure Dev Spaces funciona e está configurado.</span><span class="sxs-lookup"><span data-stu-id="850c6-146">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="850c6-147">Azure Functions e aplicativos lógicos (sem servidor)</span><span class="sxs-lookup"><span data-stu-id="850c6-147">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="850c6-148">O exemplo de eShopOnContainers inclui suporte para acompanhamento de campanhas de marketing online.</span><span class="sxs-lookup"><span data-stu-id="850c6-148">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="850c6-149">Uma função do Azure é usada para receber detalhes da campanha de marketing para uma determinada ID de campanha.</span><span class="sxs-lookup"><span data-stu-id="850c6-149">An Azure Function is used to pull marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="850c6-150">Em vez de criar um aplicativo ASP.NET Core completo para essa finalidade, um único ponto de extremidade do Azure function é mais simples e suficiente.</span><span class="sxs-lookup"><span data-stu-id="850c6-150">Rather than creating a complete ASP.NET Core application for this purpose, a single Azure Function endpoint is simpler and sufficient.</span></span> <span data-ttu-id="850c6-151">Azure Functions ter um modelo de compilação e implantação muito mais simples do que aplicativos ASP.NET Core completos, especialmente quando configurados para serem executados no kubernetes.</span><span class="sxs-lookup"><span data-stu-id="850c6-151">Azure Functions have a much simpler build and deployment model than full ASP.NET Core applications, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="850c6-152">A implantação da função é inserida em script usando modelos de Azure Resource Manager (ARM) e a CLI do Azure.</span><span class="sxs-lookup"><span data-stu-id="850c6-152">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="850c6-153">Este microserviço de detalhes da campanha não é voltado para o cliente e não tem os mesmos requisitos que o armazenamento online, tornando-o um bom candidato para Azure Functions.</span><span class="sxs-lookup"><span data-stu-id="850c6-153">This campaign details microservice isn't customer-facing and doesn't have the same requirements as the online store, making it a good candidate for Azure Functions.</span></span> <span data-ttu-id="850c6-154">A função requer que algumas configurações funcionem corretamente, como as configurações de cadeia de caracteres de conexão de banco de dados e URI de base de imagem.</span><span class="sxs-lookup"><span data-stu-id="850c6-154">The function requires some configuration to work properly, such as database connection string data and image base URI settings.</span></span> <span data-ttu-id="850c6-155">Você configura Azure Functions no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="850c6-155">You configure Azure Functions in the Azure Portal.</span></span>

## <a name="references"></a><span data-ttu-id="850c6-156">Referências</span><span class="sxs-lookup"><span data-stu-id="850c6-156">References</span></span>

- <span data-ttu-id="850c6-157">[eShopOnContainers: criar cluster kubernetes no AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="850c6-157">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="850c6-158">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="850c6-158">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="850c6-159">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="850c6-159">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="850c6-160">[Anterior](map-eshoponcontainers-azure-services.md)
>[Próximo](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="850c6-160">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
