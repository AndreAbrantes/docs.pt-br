---
title: Como implantar o eShopOnContainers no Azure
description: Implantando o aplicativo eShopOnContainers usando o serviço kubernetes do Azure, o Helm e o DevSpaces.
ms.date: 05/13/2020
ms.openlocfilehash: 93a2848f095d7593e1e169f4a6c6c1818a76217d
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614091"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="619ce-103">Como implantar o eShopOnContainers no Azure</span><span class="sxs-lookup"><span data-stu-id="619ce-103">Deploying eShopOnContainers to Azure</span></span>

<span data-ttu-id="619ce-104">O aplicativo eShopOnContainers pode ser implantado em uma variedade de plataformas do Azure.</span><span class="sxs-lookup"><span data-stu-id="619ce-104">The eShopOnContainers application can be deployed to a variety of Azure platforms.</span></span> <span data-ttu-id="619ce-105">A abordagem recomendada é implantar o aplicativo nos AKS (serviços Kubernetess do Azure).</span><span class="sxs-lookup"><span data-stu-id="619ce-105">The recommended approach is to deploy the application to Azure Kubernetes Services (AKS).</span></span> <span data-ttu-id="619ce-106">O Helm, uma ferramenta de implantação do kubernetes, está disponível para reduzir a complexidade da implantação.</span><span class="sxs-lookup"><span data-stu-id="619ce-106">Helm, a Kubernetes deployment tool, is available to reduce deployment complexity.</span></span> <span data-ttu-id="619ce-107">Opcionalmente, os desenvolvedores podem implementar Azure Dev Spaces para kubernetes para simplificar seu processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="619ce-107">Optionally, developers may implement Azure Dev Spaces for Kubernetes to streamline their development process.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="619ce-108">Serviço de Kubernetes do Azure</span><span class="sxs-lookup"><span data-stu-id="619ce-108">Azure Kubernetes Service</span></span>

<span data-ttu-id="619ce-109">Para hospedar eShop em AKS, a primeira etapa é criar um cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="619ce-109">To host eShop in AKS, the first step is to create an AKS cluster.</span></span> <span data-ttu-id="619ce-110">Para fazer isso, você pode usar o portal do Azure, que irá orientá-lo pelas etapas necessárias.</span><span class="sxs-lookup"><span data-stu-id="619ce-110">To do so, you might use the Azure portal, which will walk you through the required steps.</span></span> <span data-ttu-id="619ce-111">Você também pode criar um cluster do CLI do Azure, tomando cuidado para habilitar o controle de acesso baseado em função (RBAC) e o roteamento de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="619ce-111">You could also create a cluster from the Azure CLI, taking care to enable Role-Based Access Control (RBAC) and application routing.</span></span> <span data-ttu-id="619ce-112">A documentação do eShopOnContainers ' fornece detalhes sobre as etapas para criar seu próprio cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="619ce-112">The eShopOnContainers' documentation details the steps for creating your own AKS cluster.</span></span> <span data-ttu-id="619ce-113">Depois de criado, você pode acessar e gerenciar o cluster no painel do kubernetes.</span><span class="sxs-lookup"><span data-stu-id="619ce-113">Once created, you can access and manage the cluster from the Kubernetes dashboard.</span></span>

<span data-ttu-id="619ce-114">Agora você pode implantar o aplicativo eShop no cluster, aproveitando o Helm e o Gavetar.</span><span class="sxs-lookup"><span data-stu-id="619ce-114">You can now deploy the eShop application to the cluster leveraging Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="619ce-115">Implantando no serviço kubernetes do Azure usando o Helm</span><span class="sxs-lookup"><span data-stu-id="619ce-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="619ce-116">Helm é uma ferramenta de Gerenciador de pacotes de aplicativos que funciona diretamente com o kubernetes.</span><span class="sxs-lookup"><span data-stu-id="619ce-116">Helm is an application package manager tool that works directly with Kubernetes.</span></span> <span data-ttu-id="619ce-117">Ele ajuda a definir, instalar e atualizar aplicativos kubernetes.</span><span class="sxs-lookup"><span data-stu-id="619ce-117">It helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="619ce-118">Embora aplicativos simples possam ser implantados em AKS com scripts CLI personalizados ou arquivos de implantação simples, aplicativos complexos podem conter muitos objetos kubernetes e se beneficiarem do Helm.</span><span class="sxs-lookup"><span data-stu-id="619ce-118">While simple apps can be deployed to AKS with custom CLI scripts or simple deployment files, complex apps can contain many Kubernetes objects and benefit from Helm.</span></span>

<span data-ttu-id="619ce-119">Usando o Helm, os aplicativos incluem arquivos de configuração baseados em texto, chamados de gráficos Helm, que descrevem declarativamente o aplicativo e a configuração em pacotes Helm.</span><span class="sxs-lookup"><span data-stu-id="619ce-119">Using Helm, applications include text-based configuration files, called Helm charts, which declaratively describe the application and configuration in Helm packages.</span></span> <span data-ttu-id="619ce-120">Os gráficos usam arquivos padrão formatados por YAML para descrever um conjunto relacionado de recursos do kubernetes.</span><span class="sxs-lookup"><span data-stu-id="619ce-120">Charts use standard YAML-formatted files to describe a related set of Kubernetes resources.</span></span> <span data-ttu-id="619ce-121">Eles têm controle de versão junto com o código do aplicativo que eles descrevem.</span><span class="sxs-lookup"><span data-stu-id="619ce-121">They're versioned alongside the application code they describe.</span></span> <span data-ttu-id="619ce-122">Os gráficos Helm variam de simples a complexo, dependendo dos requisitos da instalação que descrevem.</span><span class="sxs-lookup"><span data-stu-id="619ce-122">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="619ce-123">O Helm é composto por uma ferramenta de cliente de linha de comando, que consome gráficos do Helm e inicia comandos para um componente de servidor chamado, o.</span><span class="sxs-lookup"><span data-stu-id="619ce-123">Helm is composed of a command-line client tool, which consumes helm charts and launches commands to a server component named, Tiller.</span></span> <span data-ttu-id="619ce-124">O gaveta se comunica com a API do kubernetes para garantir o provisionamento correto de suas cargas de trabalho em contêineres.</span><span class="sxs-lookup"><span data-stu-id="619ce-124">Tiller communicates with the Kubernetes API to ensure the correct provisioning of your containerized workloads.</span></span> <span data-ttu-id="619ce-125">O Helm é mantido pela base de computação nativa de nuvem.</span><span class="sxs-lookup"><span data-stu-id="619ce-125">Helm is maintained by the Cloud-native Computing Foundation.</span></span>

<span data-ttu-id="619ce-126">O seguinte arquivo YAML apresenta um modelo Helm:</span><span class="sxs-lookup"><span data-stu-id="619ce-126">The following yaml file presents a Helm template:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.app.svc.marketing }}
  labels:
    app: {{ template "marketing-api.name" . }}
    chart: {{ template "marketing-api.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: {{ template "marketing-api.name" . }}
    release: {{ .Release.Name }}
```

<span data-ttu-id="619ce-127">Observe como o modelo descreve um conjunto dinâmico de pares chave/valor.</span><span class="sxs-lookup"><span data-stu-id="619ce-127">Note how the template describes a dynamic set of key/value pairs.</span></span> <span data-ttu-id="619ce-128">Quando o modelo é invocado, os valores que estão entre chaves são extraídos de outros arquivos de configuração baseados em YAML.</span><span class="sxs-lookup"><span data-stu-id="619ce-128">When the template is invoked, values that enclosed in curly braces are pulled in from other yaml-based configuration files.</span></span>

<span data-ttu-id="619ce-129">Você encontrará os gráficos eShopOnContainers Helm na pasta/K8S/Helm.</span><span class="sxs-lookup"><span data-stu-id="619ce-129">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="619ce-130">A Figura 2-6 mostra como os diferentes componentes do aplicativo são organizados em uma estrutura de pastas usada pelo Helm para definir e implantações gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="619ce-130">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="619ce-131">![Arquitetura eShopOnContainers ](./media/eshoponcontainers-helm-folder.png)
 **Figura 2-6**.</span><span class="sxs-lookup"><span data-stu-id="619ce-131">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="619ce-132">A pasta eShopOnContainers Helm</span><span class="sxs-lookup"><span data-stu-id="619ce-132">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="619ce-133">Cada componente individual é instalado usando um `helm install` comando.</span><span class="sxs-lookup"><span data-stu-id="619ce-133">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="619ce-134">o eShop inclui um script "implantar tudo" que percorre e instala os componentes usando seus respectivos gráficos do Helm.</span><span class="sxs-lookup"><span data-stu-id="619ce-134">eShop includes a "deploy all" script that loops through and installs the components using their respective helm charts.</span></span> <span data-ttu-id="619ce-135">O resultado é um processo repetível, com versão com o aplicativo no controle do código-fonte, que qualquer pessoa da equipe pode implantar em um cluster AKS com um comando de script de uma linha.</span><span class="sxs-lookup"><span data-stu-id="619ce-135">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span>

> <span data-ttu-id="619ce-136">Observe que a versão 3 do Helm remove oficialmente a necessidade do componente de servidor da gaveta.</span><span class="sxs-lookup"><span data-stu-id="619ce-136">Note that version 3 of Helm officially removes the need for the Tiller server component.</span></span> <span data-ttu-id="619ce-137">Mais informações sobre esse aprimoramento podem ser encontradas [aqui](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span><span class="sxs-lookup"><span data-stu-id="619ce-137">More information on this enhancement can be found [here](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="619ce-138">Espaços de Desenvolvimento do Azure</span><span class="sxs-lookup"><span data-stu-id="619ce-138">Azure Dev Spaces</span></span>

<span data-ttu-id="619ce-139">Os aplicativos nativos de nuvem podem crescer de forma rápida e complexa, exigindo recursos de computação significativos para serem executados.</span><span class="sxs-lookup"><span data-stu-id="619ce-139">Cloud-native applications can quickly grow large and complex, requiring significant compute resources to run.</span></span> <span data-ttu-id="619ce-140">Nesses cenários, o aplicativo inteiro não pode ser hospedado em um computador de desenvolvimento (especialmente um laptop).</span><span class="sxs-lookup"><span data-stu-id="619ce-140">In these scenarios, the entire application can't be hosted on a development machine (especially a laptop).</span></span> <span data-ttu-id="619ce-141">Azure Dev Spaces foi projetado para resolver esse problema usando AKS.</span><span class="sxs-lookup"><span data-stu-id="619ce-141">Azure Dev Spaces is designed to address this problem using AKS.</span></span> <span data-ttu-id="619ce-142">Ele permite que os desenvolvedores trabalhem com uma versão local de seus serviços enquanto hospedam o restante do aplicativo em um cluster de desenvolvimento AKS.</span><span class="sxs-lookup"><span data-stu-id="619ce-142">It enables developers to work with a local version of their services while hosting the rest of the application in an AKS development cluster.</span></span>

<span data-ttu-id="619ce-143">Os desenvolvedores compartilham uma instância em execução (desenvolvimento) em um cluster AKS que contém o aplicativo em contêineres inteiro.</span><span class="sxs-lookup"><span data-stu-id="619ce-143">Developers share a running (development) instance in an AKS cluster that contains the entire containerized application.</span></span> <span data-ttu-id="619ce-144">Mas eles usam espaços pessoais configurados em sua máquina para desenvolver localmente seus serviços.</span><span class="sxs-lookup"><span data-stu-id="619ce-144">But they use personal spaces set up on their machine to locally develop their services.</span></span> <span data-ttu-id="619ce-145">Quando estiver pronto, eles serão testados de ponta a ponta no cluster AKS, sem replicar dependências.</span><span class="sxs-lookup"><span data-stu-id="619ce-145">When ready, they test from end-to-end in the AKS cluster - without replicating dependencies.</span></span> <span data-ttu-id="619ce-146">Azure Dev Spaces mescla o código do computador local com serviços no AKS.</span><span class="sxs-lookup"><span data-stu-id="619ce-146">Azure Dev Spaces merges code from the local machine with services in AKS.</span></span> <span data-ttu-id="619ce-147">Os membros da equipe podem ver como suas alterações se comportarão em um ambiente AKS real.</span><span class="sxs-lookup"><span data-stu-id="619ce-147">Team members can see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="619ce-148">Os desenvolvedores podem iterar e depurar rapidamente o código diretamente no kubernetes usando o Visual Studio 2017 ou Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="619ce-148">Developers can rapidly iterate and debug code directly in Kubernetes using Visual Studio 2017 or Visual Studio Code.</span></span>

<span data-ttu-id="619ce-149">Na Figura 2-7, você pode ver que o desenvolvedor Susana implantou uma versão atualizada do microserviço bikes em seu espaço de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="619ce-149">In Figure 2-7, you can see that Developer Susie has deployed an updated version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="619ce-150">Em seguida, ela é capaz de testar suas alterações usando uma URL personalizada que começa com o nome de seu espaço (susie.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="619ce-150">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="619ce-151">![Arquitetura eShopOnContainers ](./media/azure-devspaces-one.png)
 **Figura 2-7**.</span><span class="sxs-lookup"><span data-stu-id="619ce-151">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="619ce-152">O Developer Susana implanta sua própria versão do microserviço Bikes e a testa.</span><span class="sxs-lookup"><span data-stu-id="619ce-152">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="619ce-153">Ao mesmo tempo, o desenvolvedor John está Personalizando o microserviço de reservas e precisa testar suas alterações.</span><span class="sxs-lookup"><span data-stu-id="619ce-153">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="619ce-154">Ele implanta suas alterações em seu próprio espaço de desenvolvimento sem entrar em conflito com as alterações do Susana, conforme mostrado na Figura 2-8.</span><span class="sxs-lookup"><span data-stu-id="619ce-154">He deploys his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="619ce-155">João, em seguida, testa suas alterações usando sua própria URL que é prefixada com o nome de seu espaço (john.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="619ce-155">John then tests his changes using his own URL that is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="619ce-156">![Arquitetura eShopOnContainers ](./media/azure-devspaces-two.png)
 **Figura 2-8**.</span><span class="sxs-lookup"><span data-stu-id="619ce-156">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="619ce-157">O desenvolvedor John implanta sua própria versão do microserviço de reservas e a testa sem entrar em conflito com outros desenvolvedores.</span><span class="sxs-lookup"><span data-stu-id="619ce-157">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="619ce-158">Usando Azure Dev Spaces, as equipes podem trabalhar diretamente com o AKS enquanto alteram, implantam e testam suas alterações de forma independente.</span><span class="sxs-lookup"><span data-stu-id="619ce-158">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="619ce-159">Essa abordagem reduz a necessidade de ambientes hospedados dedicados separados, pois cada desenvolvedor efetivamente tem seu próprio ambiente AKS.</span><span class="sxs-lookup"><span data-stu-id="619ce-159">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="619ce-160">Os desenvolvedores podem trabalhar com Azure Dev Spaces usando sua CLI ou iniciar seu aplicativo para Azure Dev Spaces diretamente do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="619ce-160">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="619ce-161">Saiba mais sobre como Azure Dev Spaces funciona e está configurado.</span><span class="sxs-lookup"><span data-stu-id="619ce-161">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="619ce-162">Azure Functions e aplicativos lógicos (sem servidor)</span><span class="sxs-lookup"><span data-stu-id="619ce-162">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="619ce-163">O exemplo de eShopOnContainers inclui suporte para acompanhamento de campanhas de marketing online.</span><span class="sxs-lookup"><span data-stu-id="619ce-163">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="619ce-164">Uma função do Azure é usada para acompanhar os detalhes da campanha de marketing para uma determinada ID de campanha.</span><span class="sxs-lookup"><span data-stu-id="619ce-164">An Azure Function is used to track marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="619ce-165">Em vez de criar um Microservice completo, uma única função do Azure é mais simples e suficiente.</span><span class="sxs-lookup"><span data-stu-id="619ce-165">Rather than creating a full microservice, a single Azure Function is simpler and sufficient.</span></span> <span data-ttu-id="619ce-166">Azure Functions ter um modelo simples de compilação e implantação, especialmente quando configurado para ser executado no kubernetes.</span><span class="sxs-lookup"><span data-stu-id="619ce-166">Azure Functions have a simple build and deployment model, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="619ce-167">A implantação da função é inserida em script usando modelos de Azure Resource Manager (ARM) e a CLI do Azure.</span><span class="sxs-lookup"><span data-stu-id="619ce-167">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="619ce-168">Este serviço de campanha não é voltado para o cliente e invoca uma única operação, tornando-o um excelente candidato para Azure Functions.</span><span class="sxs-lookup"><span data-stu-id="619ce-168">This campaign service isn't customer-facing and invokes a single operation, making it a great candidate for Azure Functions.</span></span> <span data-ttu-id="619ce-169">A função requer configuração mínima, incluindo uma cadeia de conexão de banco de dados e configurações de URI de base de imagem.</span><span class="sxs-lookup"><span data-stu-id="619ce-169">The function requires minimal configuration, including a database connection string data and image base URI settings.</span></span> <span data-ttu-id="619ce-170">Você configura Azure Functions no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="619ce-170">You configure Azure Functions in the Azure portal.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="619ce-171">[Anterior](map-eshoponcontainers-azure-services.md) 
> [Avançar](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="619ce-171">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
