---
title: gRPC
description: Saiba mais sobre o gRPC, sua função em aplicativos nativos de nuvem e como ele difere da comunicação HTTP RESTful.
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: f34b267d7f5c6b4e593841c80df44d1ccbde95ae
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614039"
---
# <a name="grpc"></a><span data-ttu-id="a5828-103">gRPC</span><span class="sxs-lookup"><span data-stu-id="a5828-103">gRPC</span></span>

<span data-ttu-id="a5828-104">Até agora neste livro, nos concentramos na comunicação [baseada em REST](https://docs.microsoft.com/azure/architecture/best-practices/api-design) .</span><span class="sxs-lookup"><span data-stu-id="a5828-104">So far in this book, we've focused on [REST-based](https://docs.microsoft.com/azure/architecture/best-practices/api-design) communication.</span></span> <span data-ttu-id="a5828-105">Vimos que REST é um estilo de arquitetura flexível que define operações baseadas em CRUD contra recursos de entidade.</span><span class="sxs-lookup"><span data-stu-id="a5828-105">We've seen that REST is a flexible architectural style that defines CRUD-based operations against entity resources.</span></span> <span data-ttu-id="a5828-106">Os clientes interagem com recursos no HTTP com um modelo de comunicação de solicitação/resposta.</span><span class="sxs-lookup"><span data-stu-id="a5828-106">Clients interact with resources across HTTP with a request/response communication model.</span></span> <span data-ttu-id="a5828-107">Embora o REST seja amplamente implementado, uma tecnologia de comunicação mais nova, gRPC, ganhou uma enorme impulso na Comunidade nativa de nuvem.</span><span class="sxs-lookup"><span data-stu-id="a5828-107">While REST is widely implemented, a newer communication technology, gRPC, has gained tremendous momentum across the cloud-native community.</span></span>

## <a name="what-is-grpc"></a><span data-ttu-id="a5828-108">O que é o gRPC?</span><span class="sxs-lookup"><span data-stu-id="a5828-108">What is gRPC?</span></span>

<span data-ttu-id="a5828-109">o gRPC é uma estrutura moderna de alto desempenho que evolui o protocolo [RPC (chamada de procedimento remoto)](https://en.wikipedia.org/wiki/Remote_procedure_call) antigo.</span><span class="sxs-lookup"><span data-stu-id="a5828-109">gRPC is a modern, high-performance framework that evolves the age-old [remote procedure call (RPC)](https://en.wikipedia.org/wiki/Remote_procedure_call) protocol.</span></span> <span data-ttu-id="a5828-110">No nível do aplicativo, o gRPC simplifica mensagens entre clientes e serviços de back-end.</span><span class="sxs-lookup"><span data-stu-id="a5828-110">At the application level, gRPC streamlines messaging between clients and back-end services.</span></span> <span data-ttu-id="a5828-111">Originado do Google, o gRPC é um software livre e parte do ecossistema [CNCF (Cloud Native Computing Foundation)](https://www.cncf.io/) de ofertas nativas de nuvem.</span><span class="sxs-lookup"><span data-stu-id="a5828-111">Originating from Google, gRPC is open source and part of the  [Cloud Native Computing Foundation (CNCF)](https://www.cncf.io/) ecosystem of cloud-native offerings.</span></span> <span data-ttu-id="a5828-112">CNCF considera gRPC um [projeto incubating](https://github.com/cncf/toc/blob/master/process/graduation_criteria.adoc).</span><span class="sxs-lookup"><span data-stu-id="a5828-112">CNCF considers gRPC an [incubating project](https://github.com/cncf/toc/blob/master/process/graduation_criteria.adoc).</span></span> <span data-ttu-id="a5828-113">Incubating significa que os usuários finais estão usando a tecnologia em aplicativos de produção e o projeto tem um número íntegro de colaboradores.</span><span class="sxs-lookup"><span data-stu-id="a5828-113">Incubating means end users are using the technology in production applications, and the project has a healthy number of contributors.</span></span>

<span data-ttu-id="a5828-114">Um aplicativo cliente gRPC típico exporá uma função local em processo que implementa uma operação de negócios.</span><span class="sxs-lookup"><span data-stu-id="a5828-114">A typical gRPC client app will expose a local, in-process function that implements a business operation.</span></span> <span data-ttu-id="a5828-115">Nos bastidores, essa função local invoca outra função em um computador remoto.</span><span class="sxs-lookup"><span data-stu-id="a5828-115">Under the covers, that local function invokes another function on a remote machine.</span></span> <span data-ttu-id="a5828-116">O que parece ser uma chamada local essencialmente se torna uma chamada fora do processo transparente para um serviço remoto.</span><span class="sxs-lookup"><span data-stu-id="a5828-116">What appears to be a local call essentially becomes a transparent out-of-process call to a remote service.</span></span> <span data-ttu-id="a5828-117">O direcionamento de RPC abstrai a comunicação de rede ponto a ponto, a serialização e a execução entre computadores.</span><span class="sxs-lookup"><span data-stu-id="a5828-117">The RPC plumbing abstracts the point-to-point networking communication, serialization, and execution between computers.</span></span>

<span data-ttu-id="a5828-118">Em aplicativos nativos de nuvem, os desenvolvedores costumam trabalhar em linguagens de programação, estruturas e tecnologias.</span><span class="sxs-lookup"><span data-stu-id="a5828-118">In cloud-native applications, developers often work across programming languages, frameworks, and technologies.</span></span> <span data-ttu-id="a5828-119">Essa *interoperabilidade* complica os contratos de mensagem e o direcionamento necessário para comunicação entre plataformas.</span><span class="sxs-lookup"><span data-stu-id="a5828-119">This *interoperability* complicates message contracts and the plumbing required for cross-platform communication.</span></span>  <span data-ttu-id="a5828-120">o gRPC fornece uma "camada horizontal uniforme" que abstrai essas preocupações.</span><span class="sxs-lookup"><span data-stu-id="a5828-120">gRPC provides a "uniform horizontal layer" that abstracts these concerns.</span></span> <span data-ttu-id="a5828-121">O código dos desenvolvedores em sua plataforma nativa concentra-se na funcionalidade de negócios, enquanto o gRPC lida com o direcionamento de comunicação.</span><span class="sxs-lookup"><span data-stu-id="a5828-121">Developers code in their native platform focused on business functionality, while gRPC handles communication plumbing.</span></span>

<span data-ttu-id="a5828-122">o gRPC oferece suporte abrangente entre as pilhas de desenvolvimento mais populares, incluindo Java, JavaScript, C#, go, Swift e NodeJS.</span><span class="sxs-lookup"><span data-stu-id="a5828-122">gRPC offers comprehensive support across most popular development stacks, including Java, JavaScript, C#, Go, Swift, and NodeJS.</span></span>

## <a name="grpc-benefits"></a><span data-ttu-id="a5828-123">Benefícios do gRPC</span><span class="sxs-lookup"><span data-stu-id="a5828-123">gRPC Benefits</span></span>

<span data-ttu-id="a5828-124">gRPC usa HTTP/2 para seu protocolo de transporte.</span><span class="sxs-lookup"><span data-stu-id="a5828-124">gRPC uses HTTP/2 for its transport protocol.</span></span> <span data-ttu-id="a5828-125">Embora seja compatível com HTTP 1,1, o HTTP/2 apresenta muitos recursos avançados:</span><span class="sxs-lookup"><span data-stu-id="a5828-125">While compatible with HTTP 1.1, HTTP/2 features many advanced capabilities:</span></span>

- <span data-ttu-id="a5828-126">Um protocolo binário para transporte de dados-ao contrário de HTTP 1,1, que envia dados como texto não criptografado.</span><span class="sxs-lookup"><span data-stu-id="a5828-126">A binary protocol for data transport - unlike HTTP 1.1, which sends data as clear text.</span></span>
- <span data-ttu-id="a5828-127">O suporte à multiplexação para enviar várias solicitações paralelas pela mesma conexão-HTTP 1,1 limita o processamento a uma mensagem de solicitação/resposta por vez.</span><span class="sxs-lookup"><span data-stu-id="a5828-127">Multiplexing support for sending multiple parallel requests over the same connection - HTTP 1.1 limits processing to one request/response message at a time.</span></span>
- <span data-ttu-id="a5828-128">Comunicação bidirecional Full duplex para enviar solicitações de cliente e respostas de servidor simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="a5828-128">Bidirectional full-duplex communication for sending both client requests and server responses simultaneously.</span></span>
- <span data-ttu-id="a5828-129">Streaming interno permitindo solicitações e respostas para transmitir conjuntos de dados grandes de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="a5828-129">Built-in streaming enabling requests and responses to asynchronously stream large data sets.</span></span>

<span data-ttu-id="a5828-130">o gRPC é leve e tem alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="a5828-130">gRPC is lightweight and highly performant.</span></span> <span data-ttu-id="a5828-131">Pode ser até 8x mais rápido que a serialização JSON com mensagens 60-80% menores.</span><span class="sxs-lookup"><span data-stu-id="a5828-131">It can be up to 8x faster than JSON serialization with messages 60-80% smaller.</span></span> <span data-ttu-id="a5828-132">Na linguagem Microsoft [Windows Communication Foundation (WCF)](https://docs.microsoft.com/dotnet/framework/wcf/whats-wcf) , o desempenho do gRPC excede a velocidade e a eficiência das [associações NetTcp](https://docs.microsoft.com/dotnet/api/system.servicemodel.nettcpbinding?view=netframework-4.8)altamente otimizadas.</span><span class="sxs-lookup"><span data-stu-id="a5828-132">In Microsoft [Windows Communication Foundation (WCF)](https://docs.microsoft.com/dotnet/framework/wcf/whats-wcf) parlance, gRPC performance exceeds the speed and efficiency of the highly optimized [NetTCP bindings](https://docs.microsoft.com/dotnet/api/system.servicemodel.nettcpbinding?view=netframework-4.8).</span></span> <span data-ttu-id="a5828-133">Diferentemente do NetTCP, que favorece o Microsoft Stack, o gRPC é uma plataforma cruzada.</span><span class="sxs-lookup"><span data-stu-id="a5828-133">Unlike NetTCP, which favors the Microsoft stack, gRPC is cross-platform.</span></span>

## <a name="protocol-buffers"></a><span data-ttu-id="a5828-134">Buffers de protocolo</span><span class="sxs-lookup"><span data-stu-id="a5828-134">Protocol Buffers</span></span>

<span data-ttu-id="a5828-135">o gRPC adota uma tecnologia de código aberto chamada [buffers de protocolo](https://developers.google.com/protocol-buffers/docs/overview).</span><span class="sxs-lookup"><span data-stu-id="a5828-135">gRPC embraces an open-source technology called [Protocol Buffers](https://developers.google.com/protocol-buffers/docs/overview).</span></span> <span data-ttu-id="a5828-136">Eles fornecem um formato de serialização altamente eficiente e com neutralidade de plataforma para serializar mensagens estruturadas que os serviços enviam entre si.</span><span class="sxs-lookup"><span data-stu-id="a5828-136">They provide a highly efficient and platform-neutral serialization format for serializing structured messages that services send to each other.</span></span> <span data-ttu-id="a5828-137">Usando uma IDL (linguagem de definição de interface) de plataforma cruzada, os desenvolvedores definem um contrato de serviço para cada microserviço.</span><span class="sxs-lookup"><span data-stu-id="a5828-137">Using a cross-platform Interface Definition Language (IDL), developers define a service contract for each microservice.</span></span> <span data-ttu-id="a5828-138">O contrato, implementado como um arquivo baseado em texto `.proto` , descreve os métodos, as entradas e as saídas de cada serviço.</span><span class="sxs-lookup"><span data-stu-id="a5828-138">The contract, implemented as a text-based `.proto` file, describes the methods, inputs, and outputs for each service.</span></span> <span data-ttu-id="a5828-139">O mesmo arquivo de contrato pode ser usado para clientes e serviços gRPC criados em diferentes plataformas de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="a5828-139">The same contract file can be used for gRPC clients and services built on different development platforms.</span></span>

<span data-ttu-id="a5828-140">Usando o arquivo proto, o compilador Protobuf, `protoc` , gera o código de cliente e de serviço para sua plataforma de destino.</span><span class="sxs-lookup"><span data-stu-id="a5828-140">Using the proto file, the Protobuf compiler, `protoc`, generates both client and service code for your target platform.</span></span> <span data-ttu-id="a5828-141">O código inclui os seguintes componentes:</span><span class="sxs-lookup"><span data-stu-id="a5828-141">The code includes the following components:</span></span>

- <span data-ttu-id="a5828-142">Objetos fortemente tipados, compartilhados pelo cliente e serviço, que representam as operações de serviço e os elementos de dados de uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="a5828-142">Strongly-typed objects, shared by the client and service, that represent the service operations and data elements for a message.</span></span>
- <span data-ttu-id="a5828-143">Uma classe base fortemente tipada com o direcionamento de rede necessário que o serviço gRPC remoto pode herdar e estender.</span><span class="sxs-lookup"><span data-stu-id="a5828-143">A strongly-typed base class with the required network plumbing that the remote gRPC service can inherit and extend.</span></span>
- <span data-ttu-id="a5828-144">Um stub de cliente que contém o encanamento necessário para invocar o serviço gRPC remoto.</span><span class="sxs-lookup"><span data-stu-id="a5828-144">A client stub that contains the required plumbing to invoke the remote gRPC service.</span></span>

<span data-ttu-id="a5828-145">Em tempo de execução, cada mensagem é serializada como uma representação Protobuf padrão e trocada entre o cliente e o serviço remoto.</span><span class="sxs-lookup"><span data-stu-id="a5828-145">At runtime, each message is serialized as a standard Protobuf representation and exchanged between the client and remote service.</span></span> <span data-ttu-id="a5828-146">Ao contrário de JSON ou XML, as mensagens Protobuf são serializadas como bytes binários compilados.</span><span class="sxs-lookup"><span data-stu-id="a5828-146">Unlike JSON or XML, Protobuf messages are serialized as compiled binary bytes.</span></span>

<span data-ttu-id="a5828-147">O livro, [gRPC para desenvolvedores do WCF](https://docs.microsoft.com/dotnet/architecture/grpc-for-wcf-developers/), disponível no site de arquitetura da Microsoft, fornece uma cobertura detalhada de GRPC e buffers de protocolo.</span><span class="sxs-lookup"><span data-stu-id="a5828-147">The book, [gRPC for WCF Developers](https://docs.microsoft.com/dotnet/architecture/grpc-for-wcf-developers/), available from the Microsoft Architecture site, provides in-depth coverage of gRPC and Protocol Buffers.</span></span>

## <a name="grpc-support-in-net"></a><span data-ttu-id="a5828-148">suporte do gRPC no .NET</span><span class="sxs-lookup"><span data-stu-id="a5828-148">gRPC support in .NET</span></span>

<span data-ttu-id="a5828-149">o gRPC é integrado ao SDK do .NET Core 3,0 e posterior.</span><span class="sxs-lookup"><span data-stu-id="a5828-149">gRPC is integrated into .NET Core 3.0 SDK and later.</span></span> <span data-ttu-id="a5828-150">As ferramentas a seguir dão suporte a ela:</span><span class="sxs-lookup"><span data-stu-id="a5828-150">The following tools support it:</span></span>

- <span data-ttu-id="a5828-151">Visual Studio 2019, versão 16,3 ou posterior, com a carga de trabalho de desenvolvimento da Web instalada.</span><span class="sxs-lookup"><span data-stu-id="a5828-151">Visual Studio 2019, version 16.3 or later, with the web development workload installed.</span></span>
- <span data-ttu-id="a5828-152">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="a5828-152">Visual Studio Code</span></span>
- <span data-ttu-id="a5828-153">a CLI do dotnet</span><span class="sxs-lookup"><span data-stu-id="a5828-153">the dotnet CLI</span></span>

<span data-ttu-id="a5828-154">O SDK inclui ferramentas para roteamento de ponto de extremidade, IoC interno e registro em log.</span><span class="sxs-lookup"><span data-stu-id="a5828-154">The SDK includes tooling for endpoint routing, built-in IoC, and logging.</span></span> <span data-ttu-id="a5828-155">O servidor Web Kestrel de código aberto dá suporte a conexões HTTP/2.</span><span class="sxs-lookup"><span data-stu-id="a5828-155">The open-source Kestrel web server supports HTTP/2 connections.</span></span> <span data-ttu-id="a5828-156">A Figura 4-20 mostra um modelo do Visual Studio 2019 que aplica Scaffold um projeto de esqueleto para um serviço gRPC.</span><span class="sxs-lookup"><span data-stu-id="a5828-156">Figure 4-20 shows a Visual Studio 2019 template that scaffolds a skeleton project for a gRPC service.</span></span> <span data-ttu-id="a5828-157">Observe como o .NET Core dá suporte total ao Windows, Linux e macOS.</span><span class="sxs-lookup"><span data-stu-id="a5828-157">Note how .NET Core fully supports Windows, Linux, and macOS.</span></span>

![Suporte do gRPC no Visual Studio 2019](./media/visual-studio-2019-grpc-template.png)

<span data-ttu-id="a5828-159">**Figura 4-20**.</span><span class="sxs-lookup"><span data-stu-id="a5828-159">**Figure 4-20**.</span></span> <span data-ttu-id="a5828-160">suporte do gRPC no Visual Studio 2019</span><span class="sxs-lookup"><span data-stu-id="a5828-160">gRPC support in Visual Studio 2019</span></span>
  
<span data-ttu-id="a5828-161">A Figura 4-21 mostra o esqueleto do serviço gRPC gerado a partir do scaffolding interno incluído no Visual Studio 2019.</span><span class="sxs-lookup"><span data-stu-id="a5828-161">Figure 4-21 shows the skeleton gRPC service generated from the built-in scaffolding included in Visual Studio 2019.</span></span>  

![projeto gRPC no Visual Studio 2019](./media/grpc-project.png  )

<span data-ttu-id="a5828-163">**Figura 4-21**.</span><span class="sxs-lookup"><span data-stu-id="a5828-163">**Figure 4-21**.</span></span> <span data-ttu-id="a5828-164">projeto gRPC no Visual Studio 2019</span><span class="sxs-lookup"><span data-stu-id="a5828-164">gRPC project in Visual Studio 2019</span></span>

<span data-ttu-id="a5828-165">Na figura anterior, observe o arquivo de descrição proto e o código do serviço.</span><span class="sxs-lookup"><span data-stu-id="a5828-165">In the previous figure, note the proto description file and service code.</span></span> <span data-ttu-id="a5828-166">Como você verá em breve, o Visual Studio gera configuração adicional tanto na classe de inicialização quanto no arquivo de projeto subjacente.</span><span class="sxs-lookup"><span data-stu-id="a5828-166">As you'll see shortly, Visual Studio generates additional configuration in both the Startup class and underlying project file.</span></span>

## <a name="grpc-usage"></a><span data-ttu-id="a5828-167">uso de gRPC</span><span class="sxs-lookup"><span data-stu-id="a5828-167">gRPC usage</span></span>

<span data-ttu-id="a5828-168">Favorecer o gRPC para os seguintes cenários:</span><span class="sxs-lookup"><span data-stu-id="a5828-168">Favor gRPC for the following scenarios:</span></span>

- <span data-ttu-id="a5828-169">Comunicação de microserviço para microserviço de back-end síncrona em que uma resposta imediata é necessária para continuar o processamento.</span><span class="sxs-lookup"><span data-stu-id="a5828-169">Synchronous backend microservice-to-microservice communication where an immediate response is required to continue processing.</span></span>
- <span data-ttu-id="a5828-170">Ambientes poliglota que precisam dar suporte a plataformas de programação mista.</span><span class="sxs-lookup"><span data-stu-id="a5828-170">Polyglot environments that need to support mixed programming platforms.</span></span>
- <span data-ttu-id="a5828-171">Comunicação de baixa latência e alta taxa de transferência em que o desempenho é crítico.</span><span class="sxs-lookup"><span data-stu-id="a5828-171">Low latency and high throughput communication where performance is critical.</span></span>
- <span data-ttu-id="a5828-172">Comunicação em tempo real de ponto a ponto – o gRPC pode enviar mensagens em tempo real sem sondagem e tem excelente suporte para streaming bidirecional.</span><span class="sxs-lookup"><span data-stu-id="a5828-172">Point-to-point real-time communication - gRPC can push messages in real time without polling and has excellent support for bi-directional streaming.</span></span>
- <span data-ttu-id="a5828-173">Ambientes com restrição de rede – as mensagens gRPC binárias são sempre menores do que uma mensagem JSON equivalente com base em texto.</span><span class="sxs-lookup"><span data-stu-id="a5828-173">Network constrained environments – binary gRPC messages are always smaller than an equivalent text-based JSON message.</span></span>

<span data-ttu-id="a5828-174">No momento da redação deste artigo, o gRPC é usado principalmente com os serviços de back-end.</span><span class="sxs-lookup"><span data-stu-id="a5828-174">At the time, of this writing, gRPC is primarily used with backend services.</span></span> <span data-ttu-id="a5828-175">A maioria dos navegadores modernos não pode fornecer o nível de controle HTTP/2 necessário para dar suporte a um cliente gRPC de front-end.</span><span class="sxs-lookup"><span data-stu-id="a5828-175">Most modern browsers can't provide the level of HTTP/2 control required to support a front-end gRPC client.</span></span> <span data-ttu-id="a5828-176">Dito isso, há uma [iniciativa antecipada](https://devblogs.microsoft.com/aspnet/grpc-web-experiment/) que permite a comunicação gRPC de aplicativos baseados em navegador criados com tecnologias de Webassembly JavaScript ou mais recente.</span><span class="sxs-lookup"><span data-stu-id="a5828-176">That said, there's an [early initiative](https://devblogs.microsoft.com/aspnet/grpc-web-experiment/) that enables gRPC communication from browser-based apps built with JavaScript or Blazor WebAssembly technologies.</span></span> <span data-ttu-id="a5828-177">O [gRPC-Web para .net](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md) permite que um aplicativo ASP.NET Core gRPC dê suporte aos recursos do gRPC em aplicativos de navegador:</span><span class="sxs-lookup"><span data-stu-id="a5828-177">The  [gRPC-Web for .NET](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md) enables an ASP.NET Core gRPC app to support gRPC features in browser apps:</span></span>

- <span data-ttu-id="a5828-178">Clientes gerados por código fortemente tipados</span><span class="sxs-lookup"><span data-stu-id="a5828-178">Strongly-typed code-generated clients</span></span>
- <span data-ttu-id="a5828-179">Compactar mensagens Protobuf</span><span class="sxs-lookup"><span data-stu-id="a5828-179">Compact Protobuf messages</span></span>
- <span data-ttu-id="a5828-180">Transmissão de servidor</span><span class="sxs-lookup"><span data-stu-id="a5828-180">Server streaming</span></span>

## <a name="grpc-implementation"></a><span data-ttu-id="a5828-181">implementação de gRPC</span><span class="sxs-lookup"><span data-stu-id="a5828-181">gRPC implementation</span></span>

<span data-ttu-id="a5828-182">A arquitetura de referência de microserviço, [eshop em contêineres](https://github.com/dotnet-architecture/eShopOnContainers), da Microsoft, mostra como implementar serviços gRPC em aplicativos .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5828-182">The microservice reference architecture, [eShop on Containers](https://github.com/dotnet-architecture/eShopOnContainers), from Microsoft, shows how to implement gRPC services in .NET Core applications.</span></span> <span data-ttu-id="a5828-183">A Figura 4-22 apresenta a arquitetura de back-end.</span><span class="sxs-lookup"><span data-stu-id="a5828-183">Figure 4-22 presents the back-end architecture.</span></span>

![Arquitetura de back-end para eShop em contêineres](./media/eshop-with-aggregators.png)

<span data-ttu-id="a5828-185">**Figura 4-22**.</span><span class="sxs-lookup"><span data-stu-id="a5828-185">**Figure 4-22**.</span></span> <span data-ttu-id="a5828-186">Arquitetura de back-end para eShop em contêineres</span><span class="sxs-lookup"><span data-stu-id="a5828-186">Backend architecture for eShop on Containers</span></span>

<span data-ttu-id="a5828-187">Na figura anterior, observe como o eShop adota o [back-end para o padrão de front-ends](https://docs.microsoft.com/azure/architecture/patterns/backends-for-frontends) (BFF) expondo vários gateways de API.</span><span class="sxs-lookup"><span data-stu-id="a5828-187">In the previous figure, note how eShop embraces the [Backend for Frontends pattern](https://docs.microsoft.com/azure/architecture/patterns/backends-for-frontends) (BFF) by exposing multiple API gateways.</span></span> <span data-ttu-id="a5828-188">Discutimos o padrão BFF anteriormente neste capítulo.</span><span class="sxs-lookup"><span data-stu-id="a5828-188">We discussed the BFF pattern earlier in this chapter.</span></span> <span data-ttu-id="a5828-189">Preste muita atenção ao microserviço do agregador (em cinza) que se situa entre o gateway da API de compra da Web e os microserviços de compra de back-end.</span><span class="sxs-lookup"><span data-stu-id="a5828-189">Pay close attention to the Aggregator microservice (in gray) that sits between the Web-Shopping API Gateway and backend Shopping microservices.</span></span> <span data-ttu-id="a5828-190">O agregador recebe uma única solicitação de um cliente, a distribui para vários microserviços, agrega os resultados e os envia de volta para o cliente solicitante.</span><span class="sxs-lookup"><span data-stu-id="a5828-190">The Aggregator receives a single request from a client, dispatches it to various microservices, aggregates the results, and sends them back to the requesting client.</span></span> <span data-ttu-id="a5828-191">Essas operações normalmente exigem comunicação síncrona para produzir uma resposta imediata.</span><span class="sxs-lookup"><span data-stu-id="a5828-191">Such operations typically require synchronous communication as to produce an immediate response.</span></span> <span data-ttu-id="a5828-192">No eShop, as chamadas de back-end do agregador são executadas usando gRPC, conforme mostrado na Figura 4-23.</span><span class="sxs-lookup"><span data-stu-id="a5828-192">In eShop, backend calls from the Aggregator are performed using gRPC as shown in Figure 4-23.</span></span>

![gRPC em eShop em contêineres](./media/grpc-implementation.png)

<span data-ttu-id="a5828-194">**Figura 4-23**.</span><span class="sxs-lookup"><span data-stu-id="a5828-194">**Figure 4-23**.</span></span> <span data-ttu-id="a5828-195">gRPC em eShop em contêineres</span><span class="sxs-lookup"><span data-stu-id="a5828-195">gRPC in eShop on Containers</span></span>

<span data-ttu-id="a5828-196">a comunicação gRPC requer componentes de cliente e de servidor.</span><span class="sxs-lookup"><span data-stu-id="a5828-196">gRPC communication requires both client and server components.</span></span> <span data-ttu-id="a5828-197">Na figura anterior, observe como o agregador de compras implementa um cliente gRPC.</span><span class="sxs-lookup"><span data-stu-id="a5828-197">In the previous figure, note how the Shopping Aggregator implements a gRPC client.</span></span> <span data-ttu-id="a5828-198">O cliente faz chamadas gRPC síncronas (em vermelho) para os microserviços de back-end, cada uma implementando um servidor gRPC.</span><span class="sxs-lookup"><span data-stu-id="a5828-198">The client makes synchronous gRPC calls (in red) to backend microservices, each of which implement a gRPC server.</span></span> <span data-ttu-id="a5828-199">Tanto o cliente quanto o servidor tiram proveito do gRPC integrado da SDK do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5828-199">Both the client and server take advantage of the built-in gRPC plumbing from the .NET Core SDK.</span></span> <span data-ttu-id="a5828-200">Os *stubs* do lado do cliente fornecem o encanamento para invocar chamadas gRPC remotas.</span><span class="sxs-lookup"><span data-stu-id="a5828-200">Client-side *stubs* provide the plumbing to invoke remote gRPC calls.</span></span> <span data-ttu-id="a5828-201">Os componentes do lado do servidor fornecem o direcionamento gRPC que as classes de serviço personalizadas podem herdar e consumir.</span><span class="sxs-lookup"><span data-stu-id="a5828-201">Server-side components provide gRPC plumbing that custom service classes can inherit and consume.</span></span>

<span data-ttu-id="a5828-202">Os microserviços que expõem uma API RESTful e a comunicação gRPC exigem vários pontos de extremidade para gerenciar o tráfego.</span><span class="sxs-lookup"><span data-stu-id="a5828-202">Microservices that expose both a RESTful API and gRPC communication require multiple endpoints to manage traffic.</span></span> <span data-ttu-id="a5828-203">Você abriria um ponto de extremidade que escuta o tráfego HTTP para as chamadas RESTful e outro para chamadas gRPC.</span><span class="sxs-lookup"><span data-stu-id="a5828-203">You would open an endpoint that listens for HTTP traffic for the RESTful calls and another for gRPC calls.</span></span> <span data-ttu-id="a5828-204">O ponto de extremidade gRPC deve ser configurado para o protocolo HTTP/2 que é necessário para a comunicação gRPC.</span><span class="sxs-lookup"><span data-stu-id="a5828-204">The gRPC endpoint must be configured for the HTTP/2 protocol that is required for gRPC communication.</span></span>

<span data-ttu-id="a5828-205">Embora possamos nos esforçarmos para desassociar os microserviços com padrões de comunicação assíncrona, algumas operações exigem chamadas diretas.</span><span class="sxs-lookup"><span data-stu-id="a5828-205">While we strive to decouple microservices with asynchronous communication patterns, some operations require direct calls.</span></span> <span data-ttu-id="a5828-206">gRPC deve ser a escolha primária para a comunicação síncrona direta entre os microserviços.</span><span class="sxs-lookup"><span data-stu-id="a5828-206">gRPC should be the primary choice for direct synchronous communication between microservices.</span></span> <span data-ttu-id="a5828-207">Seu protocolo de comunicação de alto desempenho, com base em buffers de protocolo e HTTP/2, torna-o uma opção perfeita.</span><span class="sxs-lookup"><span data-stu-id="a5828-207">Its high-performance communication protocol, based on HTTP/2 and protocol buffers, make it a perfect choice.</span></span>

## <a name="looking-ahead"></a><span data-ttu-id="a5828-208">Olhando para o futuro</span><span class="sxs-lookup"><span data-stu-id="a5828-208">Looking ahead</span></span>

<span data-ttu-id="a5828-209">Olhando para o futuro, o gRPC continuará a obter força para sistemas nativos de nuvem.</span><span class="sxs-lookup"><span data-stu-id="a5828-209">Looking ahead, gRPC will continue to gain traction for cloud-native systems.</span></span> <span data-ttu-id="a5828-210">Os benefícios de desempenho e a facilidade de desenvolvimento são atraentes.</span><span class="sxs-lookup"><span data-stu-id="a5828-210">The performance benefits and ease of development are compelling.</span></span> <span data-ttu-id="a5828-211">No entanto, o REST provavelmente estará por muito tempo.</span><span class="sxs-lookup"><span data-stu-id="a5828-211">However, REST will likely be around for a long time.</span></span> <span data-ttu-id="a5828-212">Ele é Excel para APIs expostas publicamente e por motivos de compatibilidade com versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="a5828-212">It excels for publicly exposed APIs and for backward compatibility reasons.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="a5828-213">[Anterior](service-to-service-communication.md) 
> [Avançar](service-mesh-communication-infrastructure.md)</span><span class="sxs-lookup"><span data-stu-id="a5828-213">[Previous](service-to-service-communication.md)
[Next](service-mesh-communication-infrastructure.md)</span></span>
