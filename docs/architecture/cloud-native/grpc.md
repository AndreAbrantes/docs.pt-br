---
title: gRPC
description: Saiba mais sobre o gRPC, seu papel em aplicativos nativos da nuvem e como ele difere da comunicação HTTP RESTful.
author: robvet
ms.date: 03/31/2020
ms.openlocfilehash: 28a07ad5ec105d3fc5b65e4cf0ac0cd85eb16627
ms.sourcegitcommit: 79b0dd8bfc63f33a02137121dd23475887ecefda
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/01/2020
ms.locfileid: "80524169"
---
# <a name="grpc"></a><span data-ttu-id="7aef4-103">gRPC</span><span class="sxs-lookup"><span data-stu-id="7aef4-103">gRPC</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="7aef4-104">Até agora neste livro, nos concentramos na comunicação baseada em [REST.](https://docs.microsoft.com/azure/architecture/best-practices/api-design)</span><span class="sxs-lookup"><span data-stu-id="7aef4-104">So far in this book, we've focused on [REST-based](https://docs.microsoft.com/azure/architecture/best-practices/api-design) communication.</span></span> <span data-ttu-id="7aef4-105">Vimos que rest é um estilo arquitetônico flexível que define operações baseadas em CRUD contra recursos da entidade.</span><span class="sxs-lookup"><span data-stu-id="7aef4-105">We've seen that REST is a flexible architectural style that defines CRUD-based operations against entity resources.</span></span> <span data-ttu-id="7aef4-106">Os clientes interagem com recursos em HTTP com um modelo de comunicação de solicitação/resposta.</span><span class="sxs-lookup"><span data-stu-id="7aef4-106">Clients interact with resources across HTTP with a request/response communication model.</span></span> <span data-ttu-id="7aef4-107">Embora o REST seja amplamente implementado, uma nova tecnologia de comunicação, o gRPC, ganhou um enorme impulso em toda a comunidade nativa da nuvem.</span><span class="sxs-lookup"><span data-stu-id="7aef4-107">While REST is widely implemented, a newer communication technology, gRPC, has gained tremendous momentum across the cloud-native community.</span></span>

## <a name="what-is-grpc"></a><span data-ttu-id="7aef4-108">O que é gRPC?</span><span class="sxs-lookup"><span data-stu-id="7aef4-108">What is gRPC?</span></span>

<span data-ttu-id="7aef4-109">gRPC é uma estrutura moderna e de alto desempenho que evolui o antigo protocolo de chamada de [procedimento remoto (RPC).](https://en.wikipedia.org/wiki/Remote_procedure_call)</span><span class="sxs-lookup"><span data-stu-id="7aef4-109">gRPC is a modern, high-performance framework that evolves the age-old [remote procedure call (RPC)](https://en.wikipedia.org/wiki/Remote_procedure_call) protocol.</span></span> <span data-ttu-id="7aef4-110">No nível de aplicativo, o gRPC simplifica as mensagens entre clientes e serviços back-end.</span><span class="sxs-lookup"><span data-stu-id="7aef4-110">At the application level, gRPC streamlines messaging between clients and back-end services.</span></span> <span data-ttu-id="7aef4-111">Originário do Google, o gRPC é de código aberto e faz parte do ecossistema de ofertas nativas em nuvem da [Cloud-Native Computing Foundation (CNCF).](https://www.cncf.io/)</span><span class="sxs-lookup"><span data-stu-id="7aef4-111">Originating from Google, gRPC is open source and part of the  [Cloud Native Computing Foundation (CNCF)](https://www.cncf.io/) ecosystem of cloud-native offerings.</span></span> <span data-ttu-id="7aef4-112">A CNCF considera o gRPC um [projeto de incubação.](https://github.com/cncf/toc/blob/master/process/graduation_criteria.adoc)</span><span class="sxs-lookup"><span data-stu-id="7aef4-112">CNCF considers gRPC an [incubating project](https://github.com/cncf/toc/blob/master/process/graduation_criteria.adoc).</span></span> <span data-ttu-id="7aef4-113">Incubar significa que os usuários finais estão usando a tecnologia em aplicações de produção, e o projeto tem um número saudável de colaboradores.</span><span class="sxs-lookup"><span data-stu-id="7aef4-113">Incubating means end users are using the technology in production applications, and the project has a healthy number of contributors.</span></span>

<span data-ttu-id="7aef4-114">Um aplicativo cliente gRPC típico exporá uma função local em processo que implementa uma operação de negócios.</span><span class="sxs-lookup"><span data-stu-id="7aef4-114">A typical gRPC client app will expose a local, in-process function that implements a business operation.</span></span> <span data-ttu-id="7aef4-115">Sob as tampas, essa função local invoca outra função em uma máquina remota.</span><span class="sxs-lookup"><span data-stu-id="7aef4-115">Under the covers, that local function invokes another function on a remote machine.</span></span> <span data-ttu-id="7aef4-116">O que parece ser uma chamada local torna-se essencialmente uma chamada fora de processo transparente para um serviço remoto.</span><span class="sxs-lookup"><span data-stu-id="7aef4-116">What appears to be a local call essentially becomes a transparent out-of-process call to a remote service.</span></span> <span data-ttu-id="7aef4-117">O encanamento RPC abstrai a comunicação de rede ponto a ponto, serialização e execução entre computadores.</span><span class="sxs-lookup"><span data-stu-id="7aef4-117">The RPC plumbing abstracts the point-to-point networking communication, serialization, and execution between computers.</span></span>

<span data-ttu-id="7aef4-118">Em aplicativos nativos da nuvem, os desenvolvedores geralmente trabalham em linguagens de programação, frameworks e tecnologias.</span><span class="sxs-lookup"><span data-stu-id="7aef4-118">In cloud-native applications, developers often work across programming languages, frameworks, and technologies.</span></span> <span data-ttu-id="7aef4-119">Essa *interoperabilidade* complica os contratos de mensagens e o encanamento necessário para a comunicação entre plataformas.</span><span class="sxs-lookup"><span data-stu-id="7aef4-119">This *interoperability* complicates message contracts and the plumbing required for cross-platform communication.</span></span>  <span data-ttu-id="7aef4-120">o gRPC fornece uma "camada horizontal uniforme" que abstrai essas preocupações.</span><span class="sxs-lookup"><span data-stu-id="7aef4-120">gRPC provides a "uniform horizontal layer" that abstracts these concerns.</span></span> <span data-ttu-id="7aef4-121">Os desenvolvedores codificam em sua plataforma nativa focada na funcionalidade de negócios, enquanto o gRPC lida com o encanamento de comunicação.</span><span class="sxs-lookup"><span data-stu-id="7aef4-121">Developers code in their native platform focused on business functionality, while gRPC handles communication plumbing.</span></span>

<span data-ttu-id="7aef4-122">O gRPC oferece suporte abrangente nas pilhas de desenvolvimento mais populares, incluindo Java, JavaScript, C#, Go, Swift e NodeJS.</span><span class="sxs-lookup"><span data-stu-id="7aef4-122">gRPC offers comprehensive support across most popular development stacks, including Java, JavaScript, C#, Go, Swift, and NodeJS.</span></span>

## <a name="grpc-benefits"></a><span data-ttu-id="7aef4-123">Benefícios gRPC</span><span class="sxs-lookup"><span data-stu-id="7aef4-123">gRPC Benefits</span></span>

<span data-ttu-id="7aef4-124">O gRPC usa HTTP/2 para seu protocolo de transporte.</span><span class="sxs-lookup"><span data-stu-id="7aef4-124">gRPC uses HTTP/2 for its transport protocol.</span></span> <span data-ttu-id="7aef4-125">Embora compatível com HTTP 1.1, HTTP/2 possui muitos recursos avançados:</span><span class="sxs-lookup"><span data-stu-id="7aef4-125">While compatible with HTTP 1.1, HTTP/2 features many advanced capabilities:</span></span>

- <span data-ttu-id="7aef4-126">Um protocolo binário para transporte de dados - ao contrário do HTTP 1.1, que envia dados como texto claro.</span><span class="sxs-lookup"><span data-stu-id="7aef4-126">A binary protocol for data transport - unlike HTTP 1.1, which sends data as clear text.</span></span>
- <span data-ttu-id="7aef4-127">Multiplear o suporte para enviar várias solicitações paralelas sobre a mesma conexão - HTTP 1.1 limita o processamento a uma mensagem de solicitação/resposta por vez.</span><span class="sxs-lookup"><span data-stu-id="7aef4-127">Multiplexing support for sending multiple parallel requests over the same connection - HTTP 1.1 limits processing to one request/response message at a time.</span></span>
- <span data-ttu-id="7aef4-128">Comunicação bidirecional full-duplex para enviar solicitações de clientes e respostas do servidor simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="7aef4-128">Bidirectional full-duplex communication for sending both client requests and server responses simultaneously.</span></span>
- <span data-ttu-id="7aef4-129">Streaming integrado que permite solicitações e respostas para transmitir de forma assíncrona grandes conjuntos de dados.</span><span class="sxs-lookup"><span data-stu-id="7aef4-129">Built-in streaming enabling requests and responses to asynchronously stream large data sets.</span></span>

<span data-ttu-id="7aef4-130">gRPC é leve e de alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aef4-130">gRPC is lightweight and highly performant.</span></span> <span data-ttu-id="7aef4-131">Pode ser até 8x mais rápido que a serialização JSON com mensagens 60-80% menores.</span><span class="sxs-lookup"><span data-stu-id="7aef4-131">It can be up to 8x faster than JSON serialization with messages 60-80% smaller.</span></span> <span data-ttu-id="7aef4-132">Na linguagem da Microsoft [Windows Communication Foundation (WCF),](https://docs.microsoft.com/dotnet/framework/wcf/whats-wcf) o desempenho gRPC excede a velocidade e a eficiência das [ligações NetTCP](https://docs.microsoft.com/dotnet/api/system.servicemodel.nettcpbinding?view=netframework-4.8)altamente otimizadas.</span><span class="sxs-lookup"><span data-stu-id="7aef4-132">In Microsoft [Windows Communication Foundation (WCF)](https://docs.microsoft.com/dotnet/framework/wcf/whats-wcf) parlance, gRPC performance exceeds the speed and efficiency of the highly optimized [NetTCP bindings](https://docs.microsoft.com/dotnet/api/system.servicemodel.nettcpbinding?view=netframework-4.8).</span></span> <span data-ttu-id="7aef4-133">Ao contrário do NetTCP, que favorece a pilha da Microsoft, o gRPC é multiplataforma.</span><span class="sxs-lookup"><span data-stu-id="7aef4-133">Unlike NetTCP, which favors the Microsoft stack, gRPC is cross-platform.</span></span>

## <a name="protocol-buffers"></a><span data-ttu-id="7aef4-134">Buffers de protocolo</span><span class="sxs-lookup"><span data-stu-id="7aef4-134">Protocol Buffers</span></span>

<span data-ttu-id="7aef4-135">O gRPC adota uma tecnologia de código aberto chamada [Buffers de Protocolo](https://developers.google.com/protocol-buffers/docs/overview).</span><span class="sxs-lookup"><span data-stu-id="7aef4-135">gRPC embraces an open-source technology called [Protocol Buffers](https://developers.google.com/protocol-buffers/docs/overview).</span></span> <span data-ttu-id="7aef4-136">Eles fornecem um formato de serialização altamente eficiente e neutro em plataforma para serializar mensagens estruturadas que os serviços enviam entre si.</span><span class="sxs-lookup"><span data-stu-id="7aef4-136">They provide a highly efficient and platform-neutral serialization format for serializing structured messages that services send to each other.</span></span> <span data-ttu-id="7aef4-137">Usando um IDL (Interface Definition Language, linguagem de definição de interface multiplataforma), os desenvolvedores definem um contrato de serviço para cada microserviço.</span><span class="sxs-lookup"><span data-stu-id="7aef4-137">Using a cross-platform Interface Definition Language (IDL), developers define a service contract for each microservice.</span></span> <span data-ttu-id="7aef4-138">O contrato, implementado como `.proto` um arquivo baseado em texto, descreve os métodos, entradas e saídas de cada serviço.</span><span class="sxs-lookup"><span data-stu-id="7aef4-138">The contract, implemented as a text-based `.proto` file, describes the methods, inputs, and outputs for each service.</span></span> <span data-ttu-id="7aef4-139">O mesmo arquivo de contrato pode ser usado para clientes e serviços gRPC construídos em diferentes plataformas de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="7aef4-139">The same contract file can be used for gRPC clients and services built on different development platforms.</span></span>

<span data-ttu-id="7aef4-140">Usando o arquivo proto, o compilador `protoc`Protobuf, gera código de cliente e serviço para sua plataforma de destino.</span><span class="sxs-lookup"><span data-stu-id="7aef4-140">Using the proto file, the Protobuf compiler, `protoc`, generates both client and service code for your target platform.</span></span> <span data-ttu-id="7aef4-141">O código inclui os seguintes componentes:</span><span class="sxs-lookup"><span data-stu-id="7aef4-141">The code includes the following components:</span></span>

- <span data-ttu-id="7aef4-142">Objetos fortemente digitados, compartilhados pelo cliente e pelo serviço, que representam as operações de serviço e os elementos de dados para uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="7aef4-142">Strongly-typed objects, shared by the client and service, that represent the service operations and data elements for a message.</span></span>
- <span data-ttu-id="7aef4-143">Uma classe base fortemente digitada com o encanamento de rede necessário que o serviço gRPC remoto pode herdar e estender.</span><span class="sxs-lookup"><span data-stu-id="7aef4-143">A strongly-typed base class with the required network plumbing that the remote gRPC service can inherit and extend.</span></span>
- <span data-ttu-id="7aef4-144">Um stub de cliente que contém o encanamento necessário para invocar o serviço gRPC remoto.</span><span class="sxs-lookup"><span data-stu-id="7aef4-144">A client stub that contains the required plumbing to invoke the remote gRPC service.</span></span>

<span data-ttu-id="7aef4-145">Em tempo de execução, cada mensagem é serializada como uma representação Protobuf padrão e trocada entre o cliente e o serviço remoto.</span><span class="sxs-lookup"><span data-stu-id="7aef4-145">At runtime, each message is serialized as a standard Protobuf representation and exchanged between the client and remote service.</span></span> <span data-ttu-id="7aef4-146">Ao contrário de JSON ou XML, as mensagens Protobuf são serializadas como bytes binários compilados.</span><span class="sxs-lookup"><span data-stu-id="7aef4-146">Unlike JSON or XML, Protobuf messages are serialized as compiled binary bytes.</span></span>

<span data-ttu-id="7aef4-147">O livro, [gRPC for WCF Developers](https://docs.microsoft.com/dotnet/architecture/grpc-for-wcf-developers/), disponível no site da Microsoft Architecture, fornece uma cobertura aprofundada de gRPC e Buffers de Protocolo.</span><span class="sxs-lookup"><span data-stu-id="7aef4-147">The book, [gRPC for WCF Developers](https://docs.microsoft.com/dotnet/architecture/grpc-for-wcf-developers/), available from the Microsoft Architecture site, provides in-depth coverage of gRPC and Protocol Buffers.</span></span>

## <a name="grpc-support-in-net"></a><span data-ttu-id="7aef4-148">suporte gRPC em .NET</span><span class="sxs-lookup"><span data-stu-id="7aef4-148">gRPC support in .NET</span></span>

<span data-ttu-id="7aef4-149">O gRPC é integrado ao .NET Core 3.0 SDK ou posterior.</span><span class="sxs-lookup"><span data-stu-id="7aef4-149">gRPC is integrated into .NET Core 3.0 SDK or later.</span></span> <span data-ttu-id="7aef4-150">As seguintes ferramentas o suportam:</span><span class="sxs-lookup"><span data-stu-id="7aef4-150">The following tools support it:</span></span>

- <span data-ttu-id="7aef4-151">Visual Studio 2019, versão 16.3 ou posterior, com a carga de trabalho de desenvolvimento web instalada.</span><span class="sxs-lookup"><span data-stu-id="7aef4-151">Visual Studio 2019, version 16.3 or later, with the web development workload installed.</span></span>
- <span data-ttu-id="7aef4-152">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="7aef4-152">Visual Studio Code</span></span>
- <span data-ttu-id="7aef4-153">o CLI dotnet</span><span class="sxs-lookup"><span data-stu-id="7aef4-153">the dotnet CLI</span></span>

<span data-ttu-id="7aef4-154">O SDK inclui ferramentas para roteamento de ponto final, IoC incorporado e registro.</span><span class="sxs-lookup"><span data-stu-id="7aef4-154">The SDK includes tooling for endpoint routing, built-in IoC, and logging.</span></span> <span data-ttu-id="7aef4-155">O servidor web Kestrel de código aberto suporta conexões HTTP/2.</span><span class="sxs-lookup"><span data-stu-id="7aef4-155">The open-source Kestrel web server supports HTTP/2 connections.</span></span> <span data-ttu-id="7aef4-156">A Figura 4-20 mostra um modelo visual studio 2019 que andaimes um projeto esqueleto para um serviço gRPC.</span><span class="sxs-lookup"><span data-stu-id="7aef4-156">Figure 4-20 shows a Visual Studio 2019 template that scaffolds a skeleton project for a gRPC service.</span></span> <span data-ttu-id="7aef4-157">Observe como o .NET Core suporta totalmente o Windows, Linux e macOS.</span><span class="sxs-lookup"><span data-stu-id="7aef4-157">Note how .NET Core fully supports Windows, Linux, and macOS.</span></span>

![Suporte gRPC no Visual Studio 2019](./media/visual-studio-2019-grpc-template.png)

<span data-ttu-id="7aef4-159">**Figura 4-20**.</span><span class="sxs-lookup"><span data-stu-id="7aef4-159">**Figure 4-20**.</span></span> <span data-ttu-id="7aef4-160">suporte a gRPC no Visual Studio 2019</span><span class="sxs-lookup"><span data-stu-id="7aef4-160">gRPC support in Visual Studio 2019</span></span>
  
<span data-ttu-id="7aef4-161">A Figura 4-21 mostra o serviço gRPC esqueleto gerado a partir dos andaimes embutidos incluídos no Visual Studio 2019.</span><span class="sxs-lookup"><span data-stu-id="7aef4-161">Figure 4-21 shows the skeleton gRPC service generated from the built-in scaffolding included in Visual Studio 2019.</span></span>  

![projeto gRPC no Visual Studio 2019](./media/grpc-project.png  )

<span data-ttu-id="7aef4-163">**Figura 4-21**.</span><span class="sxs-lookup"><span data-stu-id="7aef4-163">**Figure 4-21**.</span></span> <span data-ttu-id="7aef4-164">projeto gRPC no Visual Studio 2019</span><span class="sxs-lookup"><span data-stu-id="7aef4-164">gRPC project in Visual Studio 2019</span></span>

<span data-ttu-id="7aef4-165">Na figura anterior, observe o arquivo de descrição do proto e o código de serviço.</span><span class="sxs-lookup"><span data-stu-id="7aef4-165">In the previous figure, note the proto description file and service code.</span></span> <span data-ttu-id="7aef4-166">Como você verá em breve, o Visual Studio gera configuração adicional tanto na classe Startup quanto no arquivo de projeto subjacente.</span><span class="sxs-lookup"><span data-stu-id="7aef4-166">As you'll see shortly, Visual Studio generates additional configuration in both the Startup class and underlying project file.</span></span>

## <a name="grpc-usage"></a><span data-ttu-id="7aef4-167">uso de gRPC</span><span class="sxs-lookup"><span data-stu-id="7aef4-167">gRPC usage</span></span>

<span data-ttu-id="7aef4-168">Favor e gRPC para os seguintes cenários:</span><span class="sxs-lookup"><span data-stu-id="7aef4-168">Favor gRPC for the following scenarios:</span></span>

- <span data-ttu-id="7aef4-169">Comunicação de microserviço de back-end síncrono onde uma resposta imediata é necessária para continuar o processamento.</span><span class="sxs-lookup"><span data-stu-id="7aef4-169">Synchronous backend microservice-to-microservice communication where an immediate response is required to continue processing.</span></span>
- <span data-ttu-id="7aef4-170">Ambientes poliglotas que precisam suportar plataformas de programação mista.</span><span class="sxs-lookup"><span data-stu-id="7aef4-170">Polyglot environments that need to support mixed programming platforms.</span></span>
- <span data-ttu-id="7aef4-171">Baixa latência e comunicação de alto rendimento onde o desempenho é crítico.</span><span class="sxs-lookup"><span data-stu-id="7aef4-171">Low latency and high throughput communication where performance is critical.</span></span>
- <span data-ttu-id="7aef4-172">Comunicação ponto a ponto em tempo real - o gRPC pode enviar mensagens em tempo real sem votação e tem excelente suporte para streaming bidirecional.</span><span class="sxs-lookup"><span data-stu-id="7aef4-172">Point-to-point real-time communication - gRPC can push messages in real time without polling and has excellent support for bi-directional streaming.</span></span>
- <span data-ttu-id="7aef4-173">Ambientes limitados à rede – as mensagens binárias gRPC são sempre menores do que uma mensagem JSON baseada em texto equivalente.</span><span class="sxs-lookup"><span data-stu-id="7aef4-173">Network constrained environments – binary gRPC messages are always smaller than an equivalent text-based JSON message.</span></span>

<span data-ttu-id="7aef4-174">No momento, desta redação, o gRPC é usado principalmente com serviços back-end.</span><span class="sxs-lookup"><span data-stu-id="7aef4-174">At the time, of this writing, gRPC is primarily used with backend services.</span></span> <span data-ttu-id="7aef4-175">A maioria dos navegadores modernos não pode fornecer o nível de controle HTTP/2 necessário para suportar um cliente gRPC front-end.</span><span class="sxs-lookup"><span data-stu-id="7aef4-175">Most modern browsers can't provide the level of HTTP/2 control required to support a front-end gRPC client.</span></span> <span data-ttu-id="7aef4-176">Dito isto, há uma [iniciativa inicial](https://devblogs.microsoft.com/aspnet/grpc-web-experiment/) que permite a comunicação gRPC a partir de aplicativos baseados em navegador construídos com as tecnologias JavaScript ou Blazor WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="7aef4-176">That said, there's an [early initiative](https://devblogs.microsoft.com/aspnet/grpc-web-experiment/) that enables gRPC communication from browser-based apps built with JavaScript or Blazor WebAssembly technologies.</span></span> <span data-ttu-id="7aef4-177">O [gRPC-Web para .NET](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md) permite que um aplicativo gRPC ASP.NET Core suporte recursos gRPC em aplicativos de navegador:</span><span class="sxs-lookup"><span data-stu-id="7aef4-177">The  [gRPC-Web for .NET](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md) enables an ASP.NET Core gRPC app to support gRPC features in browser apps:</span></span>

- <span data-ttu-id="7aef4-178">Clientes fortemente digitados gerados por código</span><span class="sxs-lookup"><span data-stu-id="7aef4-178">Strongly-typed code-generated clients</span></span>
- <span data-ttu-id="7aef4-179">Mensagens compactas do Protobuf</span><span class="sxs-lookup"><span data-stu-id="7aef4-179">Compact Protobuf messages</span></span>
- <span data-ttu-id="7aef4-180">Streaming de servidor</span><span class="sxs-lookup"><span data-stu-id="7aef4-180">Server streaming</span></span>

## <a name="grpc-implementation"></a><span data-ttu-id="7aef4-181">implementação do gRPC</span><span class="sxs-lookup"><span data-stu-id="7aef4-181">gRPC implementation</span></span>

<span data-ttu-id="7aef4-182">A arquitetura de referência de microserviço, [eShop on Containers](https://github.com/dotnet-architecture/eShopOnContainers), da Microsoft, mostra como implementar serviços gRPC em aplicativos .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7aef4-182">The microservice reference architecture, [eShop on Containers](https://github.com/dotnet-architecture/eShopOnContainers), from Microsoft, shows how to implement gRPC services in .NET Core applications.</span></span> <span data-ttu-id="7aef4-183">A Figura 4-22 apresenta a arquitetura back-end.</span><span class="sxs-lookup"><span data-stu-id="7aef4-183">Figure 4-22 presents the back-end architecture.</span></span>

![Arquitetura backend para eShop em Containers](./media/eshop-with-aggregators.png)

<span data-ttu-id="7aef4-185">**Figura 4-22**.</span><span class="sxs-lookup"><span data-stu-id="7aef4-185">**Figure 4-22**.</span></span> <span data-ttu-id="7aef4-186">Arquitetura backend para eShop em Containers</span><span class="sxs-lookup"><span data-stu-id="7aef4-186">Backend architecture for eShop on Containers</span></span>

<span data-ttu-id="7aef4-187">Na figura anterior, observe como o eShop adota o [padrão Backend for Frontends](https://docs.microsoft.com/azure/architecture/patterns/backends-for-frontends) (BFF) expondo vários gateways de API.</span><span class="sxs-lookup"><span data-stu-id="7aef4-187">In the previous figure, note how eShop embraces the [Backend for Frontends pattern](https://docs.microsoft.com/azure/architecture/patterns/backends-for-frontends) (BFF) by exposing multiple API gateways.</span></span> <span data-ttu-id="7aef4-188">Discutimos o padrão BFF no início deste capítulo.</span><span class="sxs-lookup"><span data-stu-id="7aef4-188">We discussed the BFF pattern earlier in this chapter.</span></span> <span data-ttu-id="7aef4-189">Preste muita atenção ao microserviço Agregador (em cinza) que fica entre o Gateway de API de Compras Web e os microsserviços back-end Shopping.</span><span class="sxs-lookup"><span data-stu-id="7aef4-189">Pay close attention to the Aggregator microservice (in gray) that sits between the Web-Shopping API Gateway and backend Shopping microservices.</span></span> <span data-ttu-id="7aef4-190">O Agregador recebe uma única solicitação de um cliente, despacha-a para vários microsserviços, agrega os resultados e os envia de volta ao cliente solicitante.</span><span class="sxs-lookup"><span data-stu-id="7aef4-190">The Aggregator receives a single request from a client, dispatches it to various microservices, aggregates the results, and sends them back to the requesting client.</span></span> <span data-ttu-id="7aef4-191">Tais operações normalmente requerem comunicação síncrona para produzir uma resposta imediata.</span><span class="sxs-lookup"><span data-stu-id="7aef4-191">Such operations typically require synchronous communication as to produce an immediate response.</span></span> <span data-ttu-id="7aef4-192">No eShop, as chamadas de back-end do Agregador são realizadas usando gRPC, conforme mostrado na Figura 4-23.</span><span class="sxs-lookup"><span data-stu-id="7aef4-192">In eShop, backend calls from the Aggregator are performed using gRPC as shown in Figure 4-23.</span></span>

![gRPC em eShop em Containers](./media/grpc-implementation.png)

<span data-ttu-id="7aef4-194">**Figura 4-23**.</span><span class="sxs-lookup"><span data-stu-id="7aef4-194">**Figure 4-23**.</span></span> <span data-ttu-id="7aef4-195">gRPC em eShop em Containers</span><span class="sxs-lookup"><span data-stu-id="7aef4-195">gRPC in eShop on Containers</span></span>

<span data-ttu-id="7aef4-196">A comunicação gRPC requer componentes do cliente e do servidor.</span><span class="sxs-lookup"><span data-stu-id="7aef4-196">gRPC communication requires both client and server components.</span></span> <span data-ttu-id="7aef4-197">Na figura anterior, observe como o Agregador de Compras implementa um cliente gRPC.</span><span class="sxs-lookup"><span data-stu-id="7aef4-197">In the previous figure, note how the Shopping Aggregator implements a gRPC client.</span></span> <span data-ttu-id="7aef4-198">O cliente faz chamadas síncronas de gRPC (em vermelho) para microsserviços back-end, cada um dos quais implementa um servidor gRPC.</span><span class="sxs-lookup"><span data-stu-id="7aef4-198">The client makes synchronous gRPC calls (in red) to backend microservices, each of which implement a gRPC server.</span></span> <span data-ttu-id="7aef4-199">Tanto o cliente quanto o servidor aproveitam o encanamento gRPC incorporado do SDK .NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="7aef4-199">Both the client and server take advantage of the built-in gRPC plumbing from the .NET Core 3.0 SDK.</span></span> <span data-ttu-id="7aef4-200">Os *stubs do* lado do cliente fornecem o encanamento para invocar chamadas gRPC remotas.</span><span class="sxs-lookup"><span data-stu-id="7aef4-200">Client-side *stubs* provide the plumbing to invoke remote gRPC calls.</span></span> <span data-ttu-id="7aef4-201">Os componentes do lado do servidor fornecem encanamento gRPC que as classes de serviço personalizadas podem herdar e consumir.</span><span class="sxs-lookup"><span data-stu-id="7aef4-201">Server-side components provide gRPC plumbing that custom service classes can inherit and consume.</span></span>

<span data-ttu-id="7aef4-202">Microserviços que expõem uma API RESTful e uma comunicação gRPC exigem vários pontos finais para gerenciar o tráfego.</span><span class="sxs-lookup"><span data-stu-id="7aef4-202">Microservices that expose both a RESTful API and gRPC communication require multiple endpoints to manage traffic.</span></span> <span data-ttu-id="7aef4-203">Você abriria um ponto final que escuta o tráfego HTTP para as chamadas RESTful e outro para chamadas gRPC.</span><span class="sxs-lookup"><span data-stu-id="7aef4-203">You would open an endpoint that listens for HTTP traffic for the RESTful calls and another for gRPC calls.</span></span> <span data-ttu-id="7aef4-204">O ponto final gRPC deve ser configurado para o protocolo HTTP/2 necessário para a comunicação gRPC.</span><span class="sxs-lookup"><span data-stu-id="7aef4-204">The gRPC endpoint must be configured for the HTTP/2 protocol that is required for gRPC communication.</span></span>

<span data-ttu-id="7aef4-205">Enquanto nos esforçamos para desacoplar microsserviços com padrões de comunicação assíncronos, algumas operações exigem chamadas diretas.</span><span class="sxs-lookup"><span data-stu-id="7aef4-205">While we strive to decouple microservices with asynchronous communication patterns, some operations require direct calls.</span></span> <span data-ttu-id="7aef4-206">o gRPC deve ser a principal escolha para a comunicação síncrona direta entre microserviços.</span><span class="sxs-lookup"><span data-stu-id="7aef4-206">gRPC should be the primary choice for direct synchronous communication between microservices.</span></span> <span data-ttu-id="7aef4-207">Seu protocolo de comunicação de alto desempenho, baseado em HTTP/2 e buffers de protocolo, o torna uma escolha perfeita.</span><span class="sxs-lookup"><span data-stu-id="7aef4-207">Its high-performance communication protocol, based on HTTP/2 and protocol buffers, make it a perfect choice.</span></span>

## <a name="looking-ahead"></a><span data-ttu-id="7aef4-208">Olhando para o futuro</span><span class="sxs-lookup"><span data-stu-id="7aef4-208">Looking ahead</span></span>

<span data-ttu-id="7aef4-209">Olhando para o futuro, o gRPC continuará a ganhar tração para sistemas nativos da nuvem.</span><span class="sxs-lookup"><span data-stu-id="7aef4-209">Looking ahead, gRPC will continue to gain traction for cloud-native systems.</span></span> <span data-ttu-id="7aef4-210">Os benefícios de desempenho e a facilidade de desenvolvimento são convincentes.</span><span class="sxs-lookup"><span data-stu-id="7aef4-210">The performance benefits and ease of development are compelling.</span></span> <span data-ttu-id="7aef4-211">No entanto, rest provavelmente vai estar por perto por um longo tempo.</span><span class="sxs-lookup"><span data-stu-id="7aef4-211">However, REST will likely be around for a long time.</span></span> <span data-ttu-id="7aef4-212">Ele se destaca por APIs expostas publicamente e por razões de compatibilidade retrógrada.</span><span class="sxs-lookup"><span data-stu-id="7aef4-212">It excels for publicly exposed APIs and for backward compatibility reasons.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="7aef4-213">[Próximo](service-to-service-communication.md)
>[anterior](service-mesh-communication-infrastructure.md)</span><span class="sxs-lookup"><span data-stu-id="7aef4-213">[Previous](service-to-service-communication.md)
[Next](service-mesh-communication-infrastructure.md)</span></span>
