---
title: Configuração centralizada
description: Centralizando a configuração para aplicativos nativos de nuvem usando o Azure App Configuration e o cofre AzureKey.
ms.date: 05/13/2020
ms.openlocfilehash: 0d40c5b2d70f30beb17489dfd55900f7c5fc1a75
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91160873"
---
# <a name="centralized-configuration"></a><span data-ttu-id="f5aa2-103">Configuração centralizada</span><span class="sxs-lookup"><span data-stu-id="f5aa2-103">Centralized configuration</span></span>

<span data-ttu-id="f5aa2-104">Ao contrário de um aplicativo monolítico no qual tudo é executado em uma única instância, um aplicativo nativo de nuvem consiste em serviços independentes distribuídos entre máquinas virtuais, contêineres e regiões geográficas.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-104">Unlike a monolithic app in which everything runs within a single instance, a cloud-native application consists of independent services distributed across virtual machines, containers, and geographic regions.</span></span> <span data-ttu-id="f5aa2-105">O gerenciamento de definições de configuração para dezenas de serviços interdependentes pode ser desafiador.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-105">Managing configuration settings for dozens of interdependent services can be challenging.</span></span> <span data-ttu-id="f5aa2-106">Cópias duplicadas de definições de configuração em locais diferentes são propensas a erros e são difíceis de gerenciar.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-106">Duplicate copies of configuration settings across different locations is error prone and difficult to manage.</span></span> <span data-ttu-id="f5aa2-107">A configuração centralizada é um requisito crítico para aplicativos nativos de nuvem distribuída.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-107">Centralized configuration is a critical requirement for distributed cloud-native applications.</span></span>

<span data-ttu-id="f5aa2-108">Conforme discutido no [capítulo 1](introduction.md), as recomendações do aplicativo de doze fatores exigem uma separação estrita entre o código e a configuração.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-108">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="f5aa2-109">A configuração deve ser armazenada externamente do aplicativo e de leitura, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-109">Configuration must be stored externally from the application and read-in as needed.</span></span> <span data-ttu-id="f5aa2-110">O armazenamento de valores de configuração como constantes ou valores literais no código é uma violação.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-110">Storing configuration values as constants or literal values in code is a violation.</span></span> <span data-ttu-id="f5aa2-111">Os mesmos valores de configuração geralmente são usados por muitos serviços no mesmo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-111">The same configuration values are often be used by many services in the same application.</span></span> <span data-ttu-id="f5aa2-112">Além disso, devemos dar suporte aos mesmos valores em vários ambientes, como desenvolvimento, teste e produção.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-112">Additionally, we must support the same values across multiple environments, such as dev, testing, and production.</span></span> <span data-ttu-id="f5aa2-113">A prática recomendada é armazená-los em um repositório de configurações centralizado.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-113">The best practice is store them in a centralized configuration store.</span></span>

<span data-ttu-id="f5aa2-114">A nuvem do Azure apresenta várias ótimas opções.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-114">The Azure cloud presents several great options.</span></span>

## <a name="azure-app-configuration"></a><span data-ttu-id="f5aa2-115">Configuração de Aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-115">Azure App Configuration</span></span>

<span data-ttu-id="f5aa2-116">A [configuração de Azure app](/azure/azure-app-configuration/overview) é um serviço do Azure totalmente gerenciado que armazena definições de configuração não secretas em um local seguro e centralizado.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-116">[Azure App Configuration](/azure/azure-app-configuration/overview) is a fully managed Azure service that stores non-secret configuration settings in a secure, centralized location.</span></span> <span data-ttu-id="f5aa2-117">Os valores armazenados podem ser compartilhados entre vários serviços e aplicativos.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-117">Stored values can be shared among multiple services and applications.</span></span>

<span data-ttu-id="f5aa2-118">O serviço é simples de usar e fornece vários benefícios:</span><span class="sxs-lookup"><span data-stu-id="f5aa2-118">The service is simple to use and provides several benefits:</span></span>

- <span data-ttu-id="f5aa2-119">Representações e mapeamentos flexíveis de chave/valor</span><span class="sxs-lookup"><span data-stu-id="f5aa2-119">Flexible key/value representations and mappings</span></span>
- <span data-ttu-id="f5aa2-120">Marcação com rótulos do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-120">Tagging with Azure labels</span></span>
- <span data-ttu-id="f5aa2-121">Interface do usuário dedicada para gerenciamento</span><span class="sxs-lookup"><span data-stu-id="f5aa2-121">Dedicated UI for management</span></span>
- <span data-ttu-id="f5aa2-122">Criptografia de informações confidenciais</span><span class="sxs-lookup"><span data-stu-id="f5aa2-122">Encryption of sensitive information</span></span>
- <span data-ttu-id="f5aa2-123">Consulta e recuperação em lote</span><span class="sxs-lookup"><span data-stu-id="f5aa2-123">Querying and batch retrieval</span></span>

<span data-ttu-id="f5aa2-124">Azure App configuração mantém as alterações feitas nas configurações de valor de chave por sete dias.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-124">Azure App Configuration maintains changes made to key-value settings for seven days.</span></span> <span data-ttu-id="f5aa2-125">O recurso de instantâneo point-in-time permite reconstruir o histórico de uma configuração e até mesmo reverter para uma implantação com falha.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-125">The point-in-time snapshot feature enables you to reconstruct the history of a setting and even rollback for a failed deployment.</span></span>

<span data-ttu-id="f5aa2-126">A configuração de aplicativo armazena em cache automaticamente cada configuração para evitar chamadas excessivas para o repositório de configuração.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-126">App Configuration automatically caches each setting to avoid excessive calls to the configuration store.</span></span> <span data-ttu-id="f5aa2-127">A operação de atualização aguarda até o valor em cache de uma configuração expirar para atualizar essa configuração, mesmo quando o valor é alterado no repositório de configurações.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-127">The refresh operation waits until the cached value of a setting expires to update that setting, even when its value changes in the configuration store.</span></span> <span data-ttu-id="f5aa2-128">O tempo de término de cache padrão é de 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-128">The default cache expiration time is 30 seconds.</span></span> <span data-ttu-id="f5aa2-129">Você pode substituir o tempo de expiração.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-129">You can override the expiration time.</span></span>

<span data-ttu-id="f5aa2-130">A configuração de aplicativo criptografa todos os valores de configuração em trânsito e em repouso.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-130">App Configuration encrypts all configuration values in transit and at rest.</span></span> <span data-ttu-id="f5aa2-131">Nomes de chave e rótulos são usados como índices para recuperar dados de configuração e não são criptografados.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-131">Key names and labels are used as indexes for retrieving configuration data and aren't encrypted.</span></span>

<span data-ttu-id="f5aa2-132">Embora a configuração de aplicativo forneça segurança protegida, Azure Key Vault ainda é o melhor lugar para armazenar os segredos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-132">Although App Configuration provides hardened security, Azure Key Vault is still the best place for storing application secrets.</span></span> <span data-ttu-id="f5aa2-133">O Key Vault fornece criptografia no nível de hardware, políticas de acesso granulares e operações de gerenciamento, como a rotação de certificado.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-133">Key Vault provides hardware-level encryption, granular access policies, and management operations such as certificate rotation.</span></span> <span data-ttu-id="f5aa2-134">Você pode criar valores de configuração de aplicativo que fazem referência a segredos armazenados em um Key Vault.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-134">You can create App Configuration values that reference secrets stored in a Key Vault.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="f5aa2-135">Cofre de Chave do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-135">Azure Key Vault</span></span>

<span data-ttu-id="f5aa2-136">Key Vault é um serviço gerenciado para armazenar e acessar segredos com segurança.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-136">Key Vault is a managed service for securely storing and accessing secrets.</span></span> <span data-ttu-id="f5aa2-137">Um segredo é tudo a que você deseja controlar rigorosamente o acesso, como certificados, senhas ou chaves de API.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-137">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="f5aa2-138">Um cofre é um grupo lógico de segredos.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-138">A vault is a logical group of secrets.</span></span>

<span data-ttu-id="f5aa2-139">O Key Vault reduz consideravelmente a probabilidade de os segredos serem vazados acidentalmente.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-139">Key Vault greatly reduces the chances that secrets may be accidentally leaked.</span></span> <span data-ttu-id="f5aa2-140">Ao usar o Key Vault, os desenvolvedores de aplicativos não precisam mais armazenar informações de segurança no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-140">When using Key Vault, application developers no longer need to store security information in their application.</span></span> <span data-ttu-id="f5aa2-141">Essa prática elimina a necessidade de armazenar essas informações dentro do seu código.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-141">This practice eliminates the need to store this information inside your code.</span></span> <span data-ttu-id="f5aa2-142">Por exemplo, um aplicativo pode precisar se conectar a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-142">For example, an application may need to connect to a database.</span></span> <span data-ttu-id="f5aa2-143">Em vez de armazenar a cadeia de conexão no código do aplicativo, armazene-o com segurança no Key Vault.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-143">Instead of storing the connection string in the app's code, you can store it securely in Key Vault.</span></span>

<span data-ttu-id="f5aa2-144">Os aplicativos podem acessar com segurança as informações necessárias usando URIs.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-144">Your applications can securely access the information they need by using URIs.</span></span> <span data-ttu-id="f5aa2-145">Esses URIs permitem que os aplicativos recuperem versões específicas de um segredo.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-145">These URIs allow the applications to retrieve specific versions of a secret.</span></span> <span data-ttu-id="f5aa2-146">Não há necessidade de escrever código personalizado para proteger qualquer informação secreta armazenada no Key Vault.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-146">There's no need to write custom code to protect any of the secret information stored in Key Vault.</span></span>

<span data-ttu-id="f5aa2-147">O acesso a Key Vault requer autenticação e autorização apropriadas de chamador.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-147">Access to Key Vault requires proper caller authentication and authorization.</span></span> <span data-ttu-id="f5aa2-148">Normalmente, cada microserviço nativo de nuvem usa uma combinação ClientId/ClientSecret.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-148">Typically, each cloud-native microservice uses a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="f5aa2-149">É importante manter essas credenciais fora do controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-149">It's important to keep these credentials outside source control.</span></span> <span data-ttu-id="f5aa2-150">Uma prática recomendada é defini-los no ambiente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-150">A best practice is to set them in  the application's environment.</span></span> <span data-ttu-id="f5aa2-151">O acesso direto a Key Vault do AKS pode ser obtido usando [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span><span class="sxs-lookup"><span data-stu-id="f5aa2-151">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

## <a name="configuration-in-eshop"></a><span data-ttu-id="f5aa2-152">Configuração no eShop</span><span class="sxs-lookup"><span data-stu-id="f5aa2-152">Configuration in eShop</span></span>

<span data-ttu-id="f5aa2-153">O aplicativo eShopOnContainers inclui arquivos de configurações de aplicativo local com cada microserviço.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-153">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="f5aa2-154">Esses arquivos são verificados no controle do código-fonte, mas não incluem segredos de produção, como cadeias de conexão ou chaves de API.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-154">These files are checked into source control, but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="f5aa2-155">Em produção, as configurações individuais podem ser substituídas por variáveis de ambiente por serviço.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-155">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="f5aa2-156">Injetar segredos em variáveis de ambiente é uma prática comum para aplicativos hospedados, mas não fornece um repositório de configuração central.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-156">Injecting secrets in environment variables is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="f5aa2-157">Para dar suporte ao gerenciamento centralizado de definições de configuração, cada microserviço inclui uma configuração para alternar entre o uso de configurações locais ou configurações de Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="f5aa2-157">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="references"></a><span data-ttu-id="f5aa2-158">Referências</span><span class="sxs-lookup"><span data-stu-id="f5aa2-158">References</span></span>

- [<span data-ttu-id="f5aa2-159">A arquitetura eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="f5aa2-159">The eShopOnContainers Architecture</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [<span data-ttu-id="f5aa2-160">Orquestrar microsserviços e aplicativos de vários contêineres para alta escalabilidade e disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f5aa2-160">Orchestrating microservices and multi-container applications for high scalability and availability</span></span>](../microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications.md)
- [<span data-ttu-id="f5aa2-161">Gerenciamento de API do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-161">Azure API Management</span></span>](/azure/api-management/api-management-key-concepts)
- [<span data-ttu-id="f5aa2-162">Visão geral do banco de dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-162">Azure SQL Database Overview</span></span>](/azure/sql-database/sql-database-technical-overview)
- [<span data-ttu-id="f5aa2-163">Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-163">Azure Cache for Redis</span></span>](https://azure.microsoft.com/services/cache/)
- [<span data-ttu-id="f5aa2-164">API do Azure Cosmos DB para MongoDB</span><span class="sxs-lookup"><span data-stu-id="f5aa2-164">Azure Cosmos DB's API for MongoDB</span></span>](/azure/cosmos-db/mongodb-introduction)
- [<span data-ttu-id="f5aa2-165">Barramento de Serviço do Azure</span><span class="sxs-lookup"><span data-stu-id="f5aa2-165">Azure Service Bus</span></span>](/azure/service-bus-messaging/service-bus-messaging-overview)
- [<span data-ttu-id="f5aa2-166">Visão geral do Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="f5aa2-166">Azure Monitor overview</span></span>](/azure/azure-monitor/overview)
- <span data-ttu-id="f5aa2-167">[eShopOnContainers: criar cluster kubernetes no AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="f5aa2-167">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="f5aa2-168">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="f5aa2-168">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="f5aa2-169">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="f5aa2-169">Azure Dev Spaces</span></span>](/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="f5aa2-170">[Anterior](deploy-eshoponcontainers-azure.md) 
> [Avançar](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="f5aa2-170">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>
