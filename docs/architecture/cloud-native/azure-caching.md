---
title: Cache em um aplicativo nativo de nuvem
description: Saiba mais sobre estratégias de cache em um aplicativo nativo de nuvem.
author: robvet
ms.date: 05/17/2020
ms.openlocfilehash: a109db59d7b2005ea97922eef07ae4869e4894a7
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614286"
---
# <a name="caching-in-a-cloud-native-app"></a><span data-ttu-id="25fd3-103">Caching em um aplicativo nativo de nuvem</span><span class="sxs-lookup"><span data-stu-id="25fd3-103">Caching in a cloud-native app</span></span>

<span data-ttu-id="25fd3-104">Os benefícios do cache são bem compreendidos.</span><span class="sxs-lookup"><span data-stu-id="25fd3-104">The benefits of caching are well understood.</span></span> <span data-ttu-id="25fd3-105">A técnica funciona copiando temporariamente os dados acessados com frequência de um armazenamento de dados de back-end para o *armazenamento rápido* localizado mais próximo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="25fd3-105">The technique works by temporarily copying frequently accessed data from a backend data store to *fast storage* that's located closer to the application.</span></span> <span data-ttu-id="25fd3-106">O cache é geralmente implementado onde...</span><span class="sxs-lookup"><span data-stu-id="25fd3-106">Caching is often implemented where...</span></span>

- <span data-ttu-id="25fd3-107">Os dados permanecem relativamente estáticos.</span><span class="sxs-lookup"><span data-stu-id="25fd3-107">Data remains relatively static.</span></span>
- <span data-ttu-id="25fd3-108">O acesso a dados é lento, especialmente em comparação com a velocidade do cache.</span><span class="sxs-lookup"><span data-stu-id="25fd3-108">Data access is slow, especially compared to the speed of the cache.</span></span>
- <span data-ttu-id="25fd3-109">Os dados estão sujeitos a altos níveis de contenção.</span><span class="sxs-lookup"><span data-stu-id="25fd3-109">Data is subject to high levels of contention.</span></span>

## <a name="why"></a><span data-ttu-id="25fd3-110">Por quê?</span><span class="sxs-lookup"><span data-stu-id="25fd3-110">Why?</span></span>

<span data-ttu-id="25fd3-111">Conforme discutido nas [diretrizes de cache da Microsoft](https://docs.microsoft.com/azure/architecture/best-practices/caching), o Caching pode aumentar o desempenho, a escalabilidade e a disponibilidade de microserviços individuais e do sistema como um todo.</span><span class="sxs-lookup"><span data-stu-id="25fd3-111">As discussed in the [Microsoft caching guidance](https://docs.microsoft.com/azure/architecture/best-practices/caching), caching can increase performance, scalability, and availability for individual microservices and the system as a whole.</span></span> <span data-ttu-id="25fd3-112">Ele reduz a latência e a contenção de lidar com grandes volumes de solicitações simultâneas para um armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="25fd3-112">It reduces the latency and contention of handling large volumes of concurrent requests to a data store.</span></span> <span data-ttu-id="25fd3-113">À medida que o volume de dados e o número de usuários aumentam, quanto mais os benefícios do cache se tornam.</span><span class="sxs-lookup"><span data-stu-id="25fd3-113">As data volume and the number of users increase, the greater the benefits of caching become.</span></span>

<span data-ttu-id="25fd3-114">O Caching é mais eficaz quando um cliente lê repetidamente os dados que são imutáveis ou que são alterados com pouca frequência.</span><span class="sxs-lookup"><span data-stu-id="25fd3-114">Caching is most effective when a client repeatedly reads data that is immutable or that changes infrequently.</span></span> <span data-ttu-id="25fd3-115">Os exemplos incluem informações de referência, como informações sobre produtos e preços, ou recursos estáticos compartilhados que são caros de construir.</span><span class="sxs-lookup"><span data-stu-id="25fd3-115">Examples include reference information such as product and pricing information, or shared static resources that are costly to construct.</span></span>

<span data-ttu-id="25fd3-116">Enquanto os microserviços devem ser sem monitoração de estado, um cache distribuído pode dar suporte ao acesso simultâneo aos dados de estado da sessão quando absolutamente necessário.</span><span class="sxs-lookup"><span data-stu-id="25fd3-116">While microservices should be stateless, a distributed cache can support concurrent access to session state data when absolutely required.</span></span>

<span data-ttu-id="25fd3-117">Também considere o cache para evitar cálculos repetitivos.</span><span class="sxs-lookup"><span data-stu-id="25fd3-117">Also consider caching to avoid repetitive computations.</span></span> <span data-ttu-id="25fd3-118">Se uma operação transformar dados ou executar um cálculo complicado, armazene em cache o resultado para solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="25fd3-118">If an operation transforms data or performs a complicated calculation, cache the result for subsequent requests.</span></span>

## <a name="caching-architecture"></a><span data-ttu-id="25fd3-119">Arquitetura de cache</span><span class="sxs-lookup"><span data-stu-id="25fd3-119">Caching architecture</span></span>

<span data-ttu-id="25fd3-120">Aplicativos nativos de nuvem normalmente implementam uma arquitetura de cache distribuído.</span><span class="sxs-lookup"><span data-stu-id="25fd3-120">Cloud native applications typically implement a distributed caching architecture.</span></span> <span data-ttu-id="25fd3-121">O cache é hospedado como um [serviço de backup](./definition.md#backing-services)baseado em nuvem, separado dos microservices.</span><span class="sxs-lookup"><span data-stu-id="25fd3-121">The cache is hosted as a cloud-based [backing service](./definition.md#backing-services), separate from the microservices.</span></span> <span data-ttu-id="25fd3-122">A Figura 5-15 mostra a arquitetura.</span><span class="sxs-lookup"><span data-stu-id="25fd3-122">Figure 5-15 shows the architecture.</span></span>

![Caching em um aplicativo nativo de nuvem](media/caching-in-a-cloud-native-app.png)

<span data-ttu-id="25fd3-124">**Figura 5-15**: Caching em um aplicativo nativo de nuvem</span><span class="sxs-lookup"><span data-stu-id="25fd3-124">**Figure 5-15**: Caching in a cloud native app</span></span>

<span data-ttu-id="25fd3-125">Na figura anterior, observe como o cache é independente e compartilhado pelos microservices.</span><span class="sxs-lookup"><span data-stu-id="25fd3-125">In the previous figure, note how the cache is independent of and shared by the microservices.</span></span> <span data-ttu-id="25fd3-126">Nesse cenário, o cache é invocado pelo [Gateway de API](./front-end-communication.md).</span><span class="sxs-lookup"><span data-stu-id="25fd3-126">In this scenario, the cache is invoked by the [API Gateway](./front-end-communication.md).</span></span> <span data-ttu-id="25fd3-127">Conforme discutido no capítulo 4, o gateway serve como um front-end para todas as solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="25fd3-127">As discussed in chapter 4, the gateway serves as a front end for all incoming requests.</span></span> <span data-ttu-id="25fd3-128">O cache distribuído aumenta a capacidade de resposta do sistema retornando dados armazenados em cache sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="25fd3-128">The distributed cache increases system responsiveness by returning cached data whenever possible.</span></span> <span data-ttu-id="25fd3-129">Além disso, separar o cache dos serviços permite que o cache seja escalado verticalmente ou horizontalmente de forma independente para atender às demandas de tráfego aumentadas.</span><span class="sxs-lookup"><span data-stu-id="25fd3-129">Additionally, separating the cache from the services allows the cache to scale up or out independently to meet increased traffic demands.</span></span>

<span data-ttu-id="25fd3-130">A figura anterior apresenta um padrão de cache comum conhecido como [padrão de reserva de cache](https://docs.microsoft.com/azure/architecture/patterns/cache-aside).</span><span class="sxs-lookup"><span data-stu-id="25fd3-130">The previous figure presents a common caching pattern known as the [cache-aside pattern](https://docs.microsoft.com/azure/architecture/patterns/cache-aside).</span></span> <span data-ttu-id="25fd3-131">Para uma solicitação de entrada, primeiro você consulta o cache (etapa \# 1) para obter uma resposta.</span><span class="sxs-lookup"><span data-stu-id="25fd3-131">For an incoming request, you first query the cache (step \#1) for a response.</span></span> <span data-ttu-id="25fd3-132">Se for encontrado, os dados serão retornados imediatamente.</span><span class="sxs-lookup"><span data-stu-id="25fd3-132">If found, the data is returned immediately.</span></span> <span data-ttu-id="25fd3-133">Se os dados não existirem no cache (conhecido como um [erro de cache](https://www.techopedia.com/definition/6308/cache-miss)), eles são recuperados de um banco de dados local em um serviço downstream (etapa \# 2).</span><span class="sxs-lookup"><span data-stu-id="25fd3-133">If the data doesn't exist in the cache (known as a [cache miss](https://www.techopedia.com/definition/6308/cache-miss)), it's retrieved from a local database in a downstream service (step \#2).</span></span> <span data-ttu-id="25fd3-134">Em seguida, ele é gravado no cache para solicitações futuras (etapa \# 3) e retornado ao chamador.</span><span class="sxs-lookup"><span data-stu-id="25fd3-134">It's then written to the cache for future requests (step \#3), and returned to the caller.</span></span> <span data-ttu-id="25fd3-135">Deve-se ter cuidado para remover periodicamente os dados armazenados em cache para que o sistema permaneça em tempo hábil e consistente.</span><span class="sxs-lookup"><span data-stu-id="25fd3-135">Care must be taken to periodically evict cached data so that the system remains timely and consistent.</span></span>

<span data-ttu-id="25fd3-136">À medida que um cache compartilhado cresce, pode-se provar benéfico para particionar seus dados em vários nós.</span><span class="sxs-lookup"><span data-stu-id="25fd3-136">As a shared cache grows, it might prove beneficial to partition its data across multiple nodes.</span></span> <span data-ttu-id="25fd3-137">Isso pode ajudar a minimizar a contenção e melhorar a escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="25fd3-137">Doing so can help minimize contention and improve scalability.</span></span> <span data-ttu-id="25fd3-138">Muitos serviços de cache oferecem suporte à capacidade de adicionar e remover nós dinamicamente e reequilibrar dados entre partições.</span><span class="sxs-lookup"><span data-stu-id="25fd3-138">Many Caching services support the ability to dynamically add and remove nodes and rebalance data across partitions.</span></span> <span data-ttu-id="25fd3-139">Essa abordagem geralmente envolve clustering.</span><span class="sxs-lookup"><span data-stu-id="25fd3-139">This approach typically involves clustering.</span></span> <span data-ttu-id="25fd3-140">O clustering expõe uma coleção de nós federados como um cache único e contínuo.</span><span class="sxs-lookup"><span data-stu-id="25fd3-140">Clustering exposes a collection of federated nodes as a seamless, single cache.</span></span> <span data-ttu-id="25fd3-141">Internamente, no entanto, os dados são dispersos entre os nós após uma estratégia de distribuição predefinida que equilibra a carga uniformemente.</span><span class="sxs-lookup"><span data-stu-id="25fd3-141">Internally, however, the data is dispersed across the nodes following a predefined distribution strategy that balances the load evenly.</span></span>

## <a name="azure-cache-for-redis"></a><span data-ttu-id="25fd3-142">Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="25fd3-142">Azure Cache for Redis</span></span>

<span data-ttu-id="25fd3-143">O [cache do Azure para Redis](https://azure.microsoft.com/services/cache/) é um serviço de agente de mensagens e cache de dados seguro, totalmente gerenciado pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="25fd3-143">[Azure Cache for Redis](https://azure.microsoft.com/services/cache/) is a secure data caching and messaging broker service, fully managed by Microsoft.</span></span> <span data-ttu-id="25fd3-144">Consumido como uma oferta de PaaS (plataforma como serviço), ele fornece alta taxa de transferência e acesso de baixa latência aos dados.</span><span class="sxs-lookup"><span data-stu-id="25fd3-144">Consumed as a Platform as a Service (PaaS) offering, it provides high throughput and low-latency access to data.</span></span> <span data-ttu-id="25fd3-145">O serviço pode ser acessado por qualquer aplicativo dentro ou fora do Azure.</span><span class="sxs-lookup"><span data-stu-id="25fd3-145">The service is accessible to any application within or outside of Azure.</span></span>

<span data-ttu-id="25fd3-146">O cache do Azure para o serviço Redis gerencia o acesso a servidores Redis de software livre hospedados em data centers do Azure.</span><span class="sxs-lookup"><span data-stu-id="25fd3-146">The Azure Cache for Redis service manages access to open-source Redis servers hosted across Azure data centers.</span></span> <span data-ttu-id="25fd3-147">O serviço atua como uma fachada que fornece gerenciamento, controle de acesso e segurança.</span><span class="sxs-lookup"><span data-stu-id="25fd3-147">The service acts as a facade providing management, access control, and security.</span></span> <span data-ttu-id="25fd3-148">O serviço nativamente dá suporte a um conjunto avançado de estruturas de dados, incluindo cadeias de caracteres, hashes, listas e conjuntos.</span><span class="sxs-lookup"><span data-stu-id="25fd3-148">The service natively supports a rich set of data structures, including strings, hashes, lists, and sets.</span></span> <span data-ttu-id="25fd3-149">Se seu aplicativo já usa Redis, ele funcionará no estado em que se encontra com o cache do Azure para Redis.</span><span class="sxs-lookup"><span data-stu-id="25fd3-149">If your application already uses Redis, it will work as-is with Azure Cache for Redis.</span></span>

<span data-ttu-id="25fd3-150">O cache do Azure para Redis é mais do que um servidor de cache simples.</span><span class="sxs-lookup"><span data-stu-id="25fd3-150">Azure Cache for Redis is more than a simple cache server.</span></span> <span data-ttu-id="25fd3-151">Ele pode dar suporte a vários cenários para aprimorar uma arquitetura de microserviços:</span><span class="sxs-lookup"><span data-stu-id="25fd3-151">It can support a number of scenarios to enhance a microservices architecture:</span></span>

- <span data-ttu-id="25fd3-152">Um armazenamento de dados na memória</span><span class="sxs-lookup"><span data-stu-id="25fd3-152">An in-memory data store</span></span>
- <span data-ttu-id="25fd3-153">Um banco de dados não relacional distribuído</span><span class="sxs-lookup"><span data-stu-id="25fd3-153">A distributed non-relational database</span></span>
- <span data-ttu-id="25fd3-154">Um agente de mensagem</span><span class="sxs-lookup"><span data-stu-id="25fd3-154">A message broker</span></span>
- <span data-ttu-id="25fd3-155">Um servidor de configuração ou descoberta</span><span class="sxs-lookup"><span data-stu-id="25fd3-155">A configuration or discovery server</span></span>
  
<span data-ttu-id="25fd3-156">Para cenários avançados, uma cópia dos dados armazenados em cache pode ser [persistida no disco](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-how-to-premium-persistence).</span><span class="sxs-lookup"><span data-stu-id="25fd3-156">For advanced scenarios, a copy of the cached data can be [persisted to disk](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-how-to-premium-persistence).</span></span> <span data-ttu-id="25fd3-157">Se um evento catastrófico desabilitar os caches primário e de réplica, o cache será reconstruído a partir do instantâneo mais recente.</span><span class="sxs-lookup"><span data-stu-id="25fd3-157">If a catastrophic event disables both the primary and replica caches, the cache is reconstructed from the most recent snapshot.</span></span>

<span data-ttu-id="25fd3-158">O cache Redis do Azure está disponível em várias configurações predefinidas e tipos de preço.</span><span class="sxs-lookup"><span data-stu-id="25fd3-158">Azure Redis Cache is available across a number of predefined configurations and pricing tiers.</span></span>  <span data-ttu-id="25fd3-159">A [camada Premium](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-premium-tier-intro) apresenta muitos recursos de nível empresarial, como clustering, persistência de dados, replicação geográfica e isolamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="25fd3-159">The [Premium tier](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-premium-tier-intro) features many enterprise-level features such as clustering, data persistence, geo-replication, and virtual-network isolation.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="25fd3-160">[Anterior](relational-vs-nosql-data.md) 
> [Avançar](elastic-search-in-azure.md)</span><span class="sxs-lookup"><span data-stu-id="25fd3-160">[Previous](relational-vs-nosql-data.md)
[Next](elastic-search-in-azure.md)</span></span>
