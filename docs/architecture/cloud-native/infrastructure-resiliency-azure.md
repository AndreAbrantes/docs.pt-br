---
title: Resiliência da plataforma Azure
description: Arquitetando aplicativos .NET nativos da nuvem para o Azure | Resiliência de infraestrutura de nuvem com o Azure
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: 752f1320d9dfa18e52b078763d221a787da15e8e
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/19/2020
ms.locfileid: "83613974"
---
# <a name="azure-platform-resiliency"></a><span data-ttu-id="2fbc0-103">Resiliência da plataforma Azure</span><span class="sxs-lookup"><span data-stu-id="2fbc0-103">Azure platform resiliency</span></span>

<span data-ttu-id="2fbc0-104">Criar um aplicativo confiável na nuvem é diferente do desenvolvimento de aplicativos local tradicional.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-104">Building a reliable application in the cloud is different from traditional on-premises application development.</span></span> <span data-ttu-id="2fbc0-105">Embora historicamente você adquiriu um hardware de extremidade superior para escalar verticalmente, em um ambiente de nuvem, você escala horizontalmente. Em vez de tentar evitar falhas, o objetivo é minimizar seus efeitos e manter o sistema estável.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-105">While historically you purchased higher-end hardware to scale up, in a cloud environment you scale out. Instead of trying to prevent failures, the goal is to minimize their effects and keep the system stable.</span></span>

<span data-ttu-id="2fbc0-106">Dito isso, os aplicativos de nuvem confiáveis exibem características distintas:</span><span class="sxs-lookup"><span data-stu-id="2fbc0-106">That said, reliable cloud applications display distinct characteristics:</span></span>

- <span data-ttu-id="2fbc0-107">Eles são resilientes, recuperam-se normalmente de problemas e continuam a funcionar.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-107">They're resilient, recover gracefully from problems, and continue to function.</span></span>
- <span data-ttu-id="2fbc0-108">Eles são altamente disponíveis (HA) e são executados conforme projetados em um estado íntegro sem tempo de inatividade significativo.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-108">They're highly available (HA) and run as designed in a healthy state with no significant downtime.</span></span>

<span data-ttu-id="2fbc0-109">Entender como essas características funcionam em conjunto e como elas afetam o custo-é essencial para a criação de um aplicativo de nuvem confiável.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-109">Understanding how these characteristics work together - and how they affect cost - is essential to building a reliable cloud-native application.</span></span> <span data-ttu-id="2fbc0-110">Em seguida, veremos como você pode criar resiliência e disponibilidade em seus aplicativos nativos de nuvem aproveitando os recursos da nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-110">We'll next look at ways that you can build resiliency and availability into your cloud-native applications leveraging features from the Azure cloud.</span></span>

## <a name="design-with-resiliency"></a><span data-ttu-id="2fbc0-111">Design com resiliência</span><span class="sxs-lookup"><span data-stu-id="2fbc0-111">Design with resiliency</span></span>

<span data-ttu-id="2fbc0-112">Dissemos que a resiliência permite que seu aplicativo reaja a uma falha e ainda permaneça funcional.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-112">We've said resiliency enables your application to react to failure and still remain functional.</span></span> <span data-ttu-id="2fbc0-113">O White Paper, [resiliência no Azure White Paper](https://azure.microsoft.com/mediahandler/files/resourcefiles/resilience-in-azure-whitepaper/Resilience%20in%20Azure.pdf), fornece orientação para obter resiliência na plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-113">The whitepaper, [Resilience in Azure whitepaper](https://azure.microsoft.com/mediahandler/files/resourcefiles/resilience-in-azure-whitepaper/Resilience%20in%20Azure.pdf), provides guidance for achieving resilience in the Azure platform.</span></span> <span data-ttu-id="2fbc0-114">Aqui estão algumas recomendações importantes:</span><span class="sxs-lookup"><span data-stu-id="2fbc0-114">Here are some key recommendations:</span></span>

- <span data-ttu-id="2fbc0-115">*Falha de hardware.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-115">*Hardware failure.*</span></span> <span data-ttu-id="2fbc0-116">Crie redundância no aplicativo implantando componentes em diferentes domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-116">Build redundancy into the application by deploying components across different fault domains.</span></span> <span data-ttu-id="2fbc0-117">Por exemplo, verifique se as VMs do Azure são colocadas em diferentes racks usando conjuntos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-117">For example, ensure that Azure VMs are placed in different racks by using Availability Sets.</span></span>

- <span data-ttu-id="2fbc0-118">*Falha no datacenter.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-118">*Datacenter failure.*</span></span> <span data-ttu-id="2fbc0-119">Crie redundância no aplicativo com zonas de isolamento de falhas em data centers.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-119">Build redundancy into the application with fault isolation zones across datacenters.</span></span> <span data-ttu-id="2fbc0-120">Por exemplo, verifique se as VMs do Azure são colocadas em diferentes data centers isolados de falhas usando Zonas de Disponibilidade do Azure.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-120">For example, ensure that Azure VMs are placed in different fault-isolated datacenters by using Azure Availability Zones.</span></span>

- <span data-ttu-id="2fbc0-121">*Falha regional.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-121">*Regional failure.*</span></span> <span data-ttu-id="2fbc0-122">Replique os dados e componentes em outra região para que os aplicativos possam ser recuperados rapidamente.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-122">Replicate the data and components into another region so that applications can be quickly recovered.</span></span> <span data-ttu-id="2fbc0-123">Por exemplo, use Azure Site Recovery para replicar VMs do Azure para outra região do Azure.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-123">For example, use Azure Site Recovery to replicate Azure VMs to another Azure region.</span></span>

- <span data-ttu-id="2fbc0-124">*Carga pesada.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-124">*Heavy load.*</span></span> <span data-ttu-id="2fbc0-125">Balancear a carga entre instâncias para lidar com picos de uso.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-125">Load balance across instances to handle spikes in usage.</span></span> <span data-ttu-id="2fbc0-126">Por exemplo, coloque duas ou mais VMs do Azure atrás de um balanceador de carga para distribuir o tráfego para todas as VMs.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-126">For example, put two or more Azure VMs behind a load balancer to distribute traffic to all VMs.</span></span>

- <span data-ttu-id="2fbc0-127">*Exclusão ou corrupção acidental de dados.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-127">*Accidental data deletion or corruption.*</span></span> <span data-ttu-id="2fbc0-128">Faça backup dos dados para que eles possam ser restaurados se houver alguma exclusão ou corrupção.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-128">Back up data so it can be restored if there’s any deletion or corruption.</span></span> <span data-ttu-id="2fbc0-129">Por exemplo, use o backup do Azure para fazer backup de suas VMs do Azure periodicamente.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-129">For example, use Azure Backup to periodically back up your Azure VMs.</span></span>

## <a name="design-with-redundancy"></a><span data-ttu-id="2fbc0-130">Design com redundância</span><span class="sxs-lookup"><span data-stu-id="2fbc0-130">Design with redundancy</span></span>

<span data-ttu-id="2fbc0-131">As falhas variam no escopo do impacto.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-131">Failures vary in scope of impact.</span></span> <span data-ttu-id="2fbc0-132">Uma falha de hardware, como um disco com falha, pode afetar um único nó em um cluster.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-132">A hardware failure, such as a failed disk, can affect a single node in a cluster.</span></span> <span data-ttu-id="2fbc0-133">Um comutador de rede com falha pode afetar um rack de servidor inteiro.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-133">A failed network switch could affect an entire server rack.</span></span> <span data-ttu-id="2fbc0-134">Falhas menos comuns, como perda de energia, podem interromper um datacenter inteiro.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-134">Less common failures, such as loss of power, could disrupt a whole datacenter.</span></span> <span data-ttu-id="2fbc0-135">Raramente, uma região inteira fica indisponível.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-135">Rarely, an entire region becomes unavailable.</span></span>

<span data-ttu-id="2fbc0-136">A [redundância](https://docs.microsoft.com/azure/architecture/guide/design-principles/redundancy) é uma maneira de fornecer resiliência do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-136">[Redundancy](https://docs.microsoft.com/azure/architecture/guide/design-principles/redundancy) is one way to provide application resilience.</span></span> <span data-ttu-id="2fbc0-137">O nível exato de redundância necessário depende de seus requisitos de negócios e afetará o custo e a complexidade do seu sistema.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-137">The exact level of redundancy needed depends upon your business requirements and will affect both the cost and complexity of your system.</span></span> <span data-ttu-id="2fbc0-138">Por exemplo, uma implantação de várias regiões é mais cara e mais complexa para ser gerenciada do que uma implantação de região única.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-138">For example, a multi-region deployment is more expensive and more complex to manage than a single-region deployment.</span></span> <span data-ttu-id="2fbc0-139">Você precisará de procedimentos operacionais para gerenciar failover e failback.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-139">You'll need operational procedures to manage failover and failback.</span></span> <span data-ttu-id="2fbc0-140">O custo adicional e a complexidade podem ser justificados para alguns cenários de negócios, mas não para outros.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-140">The additional cost and complexity might be justified for some business scenarios, but not others.</span></span>

<span data-ttu-id="2fbc0-141">Para arquitetar a redundância, você precisa identificar os caminhos críticos em seu aplicativo e, em seguida, determinar se há redundância em cada ponto do caminho?</span><span class="sxs-lookup"><span data-stu-id="2fbc0-141">To architect redundancy, you need to identify the critical paths in your application, and then determine if there's redundancy at each point in the path?</span></span> <span data-ttu-id="2fbc0-142">Se um subsistema falhar, o aplicativo fará failover para outra coisa?</span><span class="sxs-lookup"><span data-stu-id="2fbc0-142">If a subsystem should fail, will the application fail over to something else?</span></span> <span data-ttu-id="2fbc0-143">Por fim, você precisa de uma compreensão clara desses recursos incorporados à plataforma de nuvem do Azure que você pode aproveitar para atender aos seus requisitos de redundância.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-143">Finally, you need a clear understanding of those features built into the Azure cloud platform that you can leverage to meet your redundancy requirements.</span></span> <span data-ttu-id="2fbc0-144">Aqui estão as recomendações para a arquitetura da redundância:</span><span class="sxs-lookup"><span data-stu-id="2fbc0-144">Here are recommendations for architecting redundancy:</span></span>

- <span data-ttu-id="2fbc0-145">*Implante várias instâncias de serviços.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-145">*Deploy multiple instances of services.*</span></span> <span data-ttu-id="2fbc0-146">Se seu aplicativo depender de uma única instância de um serviço, ele criará um único ponto de falha.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-146">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="2fbc0-147">O provisionamento de várias instâncias melhora a resiliência e a escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-147">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="2fbc0-148">Ao hospedar no serviço kubernetes do Azure, você pode configurar declarativamente instâncias redundantes (conjuntos de réplicas) no arquivo de manifesto kubernetes.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-148">When hosting in Azure Kubernetes Service, you can declaratively configure redundant instances (replica sets) in the Kubernetes manifest file.</span></span> <span data-ttu-id="2fbc0-149">O valor da contagem de réplicas pode ser gerenciado programaticamente, no portal ou por meio de recursos de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-149">The replica count value can be managed programmatically, in the portal, or through autoscaling features.</span></span>

- <span data-ttu-id="2fbc0-150">*Aproveitando um balanceador de carga.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-150">*Leveraging a load balancer.*</span></span> <span data-ttu-id="2fbc0-151">O balanceamento de carga distribui as solicitações do aplicativo para instâncias de serviço íntegra e remove automaticamente instâncias não íntegras da rotação.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-151">Load-balancing distributes your application's requests to healthy service instances and automatically removes unhealthy instances from rotation.</span></span> <span data-ttu-id="2fbc0-152">Ao implantar no kubernetes, o balanceamento de carga pode ser especificado no arquivo de manifesto kubernetes na seção serviços.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-152">When deploying to Kubernetes, load balancing can be specified in the Kubernetes manifest file in the Services section.</span></span>

- <span data-ttu-id="2fbc0-153">*Planejar a implantação em multiregião.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-153">*Plan for multiregion deployment.*</span></span> <span data-ttu-id="2fbc0-154">Se você implantar seu aplicativo em uma única região e essa região ficar indisponível, seu aplicativo também ficará indisponível.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-154">If you deploy your application to a single region, and that region becomes unavailable, your application will also become unavailable.</span></span> <span data-ttu-id="2fbc0-155">Isso pode ser inaceitável nos termos dos contratos de nível de serviço de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-155">This may be unacceptable under the terms of your application's service level agreements.</span></span> <span data-ttu-id="2fbc0-156">Em vez disso, considere implantar seu aplicativo e seus serviços em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-156">Instead, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="2fbc0-157">Por exemplo, um cluster AKS (serviço de kubernetes do Azure) é implantado em uma única região.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-157">For example, an Azure Kubernetes Service (AKS) cluster is deployed to a single region.</span></span> <span data-ttu-id="2fbc0-158">Para proteger seu sistema de uma falha regional, você pode implantar seu aplicativo em vários clusters AKS em regiões diferentes e usar o recurso de [regiões emparelhadas](https://buildazure.com/2017/01/06/azure-region-pairs-explained/) para coordenar as atualizações da plataforma e priorizar os esforços de recuperação.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-158">To protect your system from a regional failure, you might deploy your application to multiple AKS clusters across different regions and use the [Paired Regions](https://buildazure.com/2017/01/06/azure-region-pairs-explained/) feature to coordinate platform updates and prioritize recovery efforts.</span></span>

- <span data-ttu-id="2fbc0-159">*Habilite [a replicação geográfica](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-159">*Enable [geo-replication](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).*</span></span> <span data-ttu-id="2fbc0-160">A replicação geográfica para serviços, como o banco de dados SQL do Azure e o Cosmos DB criará réplicas secundárias de sua data em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-160">Geo-replication for services such as Azure SQL Database and Cosmos DB will create secondary replicas of your data across multiple regions.</span></span> <span data-ttu-id="2fbc0-161">Embora os dois serviços repliquem automaticamente os dados na mesma região, a replicação geográfica protege você contra uma interrupção regional, permitindo o failover para uma região secundária.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-161">While both services will automatically replicate data within the same region, geo-replication protects you against a regional outage by enabling you to fail over to a secondary region.</span></span> <span data-ttu-id="2fbc0-162">Outra prática recomendada para os centros de replicação geográfica em relação ao armazenamento de imagens de contêiner.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-162">Another best practice for geo-replication centers around storing container images.</span></span> <span data-ttu-id="2fbc0-163">Para implantar um serviço no AKS, você precisa armazenar e efetuar pull da imagem de um repositório.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-163">To deploy a service in AKS, you need to store and pull the image from a repository.</span></span> <span data-ttu-id="2fbc0-164">O registro de contêiner do Azure integra-se com o AKS e pode armazenar imagens de contêiner com segurança.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-164">Azure Container Registry integrates with AKS and can securely store container images.</span></span> <span data-ttu-id="2fbc0-165">Para melhorar o desempenho e a disponibilidade, considere a replicação geográfica de suas imagens para um registro em cada região em que você tenha um cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-165">To improve performance and availability, consider geo-replicating your images to a registry in each region where you have an AKS cluster.</span></span> <span data-ttu-id="2fbc0-166">Cada cluster AKS, em seguida, efetua pull das imagens de contêiner do registro de contêiner local em sua região, conforme mostrado na Figura 6-4:</span><span class="sxs-lookup"><span data-stu-id="2fbc0-166">Each AKS cluster then pulls container images from the local container registry in its region as shown in Figure 6-4:</span></span>

![Recursos replicados entre regiões](./media/replicated-resources.png)

<span data-ttu-id="2fbc0-168">**Figura 6-4**.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-168">**Figure 6-4**.</span></span> <span data-ttu-id="2fbc0-169">Recursos replicados entre regiões</span><span class="sxs-lookup"><span data-stu-id="2fbc0-169">Replicated resources across regions</span></span>

- <span data-ttu-id="2fbc0-170">*Implemente um balanceador de carga de tráfego DNS.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-170">*Implement a DNS traffic load balancer.*</span></span> <span data-ttu-id="2fbc0-171">O [Gerenciador de tráfego do Azure](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) fornece alta disponibilidade para aplicativos críticos pelo balanceamento de carga no nível do DNS.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-171">[Azure Traffic Manager](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) provides high-availability for critical applications by load-balancing at the DNS level.</span></span> <span data-ttu-id="2fbc0-172">Ele pode rotear o tráfego para diferentes regiões com base na geografia, no tempo de resposta do cluster e até mesmo na integridade do ponto de extremidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-172">It can route traffic to different regions based on geography, cluster response time, and even application endpoint health.</span></span> <span data-ttu-id="2fbc0-173">Por exemplo, o Gerenciador de tráfego do Azure pode direcionar os clientes para a instância de aplicativo e cluster AKS mais próxima.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-173">For example, Azure Traffic Manager can direct customers to the closest AKS cluster and application instance.</span></span> <span data-ttu-id="2fbc0-174">Se você tiver vários clusters AKS em regiões diferentes, use o Gerenciador de tráfego para controlar como o tráfego flui para os aplicativos que são executados em cada cluster.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-174">If you have multiple AKS clusters in different regions, use Traffic Manager to control how traffic flows to the applications that run in each cluster.</span></span> <span data-ttu-id="2fbc0-175">A Figura 6-5 mostra esse cenário.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-175">Figure 6-5 shows this scenario.</span></span>

![AKS e Gerenciador de tráfego do Azure](./media/aks-traffic-manager.png)

<span data-ttu-id="2fbc0-177">**Figura 6-5**.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-177">**Figure 6-5**.</span></span> <span data-ttu-id="2fbc0-178">AKS e Gerenciador de tráfego do Azure</span><span class="sxs-lookup"><span data-stu-id="2fbc0-178">AKS and Azure Traffic Manager</span></span>

## <a name="design-for-scalability"></a><span data-ttu-id="2fbc0-179">Design para escalabilidade</span><span class="sxs-lookup"><span data-stu-id="2fbc0-179">Design for scalability</span></span>

<span data-ttu-id="2fbc0-180">A nuvem prospera no dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-180">The cloud thrives on scaling.</span></span> <span data-ttu-id="2fbc0-181">A capacidade de aumentar/diminuir os recursos do sistema para lidar com a carga crescente/decrescente do sistema é um princípio fundamental da nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-181">The ability to increase/decrease system resources to address increasing/decreasing system load is a key tenet of the Azure cloud.</span></span> <span data-ttu-id="2fbc0-182">Mas, para dimensionar um aplicativo com eficiência, você precisa compreender os recursos de dimensionamento de cada serviço do Azure que você inclui em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-182">But, to effectively scale an application, you need an understanding of the scaling features of each Azure service that you include in your application.</span></span>  <span data-ttu-id="2fbc0-183">Aqui estão recomendações para implementar efetivamente o dimensionamento em seu sistema.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-183">Here are recommendations for effectively implementing scaling in your system.</span></span>

- <span data-ttu-id="2fbc0-184">*Design para dimensionamento.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-184">*Design for scaling.*</span></span> <span data-ttu-id="2fbc0-185">Um aplicativo deve ser projetado para dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-185">An application must be designed for scaling.</span></span> <span data-ttu-id="2fbc0-186">Para iniciar, os serviços devem ser sem estado para que as solicitações possam ser roteadas para qualquer instância.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-186">To start, services should be stateless so that requests can be routed to any instance.</span></span> <span data-ttu-id="2fbc0-187">Ter serviços sem estado também significa que a adição ou remoção de uma instância não afeta negativamente os usuários atuais.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-187">Having stateless services also means that adding or removing an instance doesn't adversely impact current users.</span></span>

- <span data-ttu-id="2fbc0-188">*Cargas de trabalho de partição*.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-188">*Partition workloads*.</span></span> <span data-ttu-id="2fbc0-189">A decomposição de domínios em microserviços independentes e autônomos permite que cada serviço seja dimensionado de forma independente dos outros.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-189">Decomposing domains into independent, self-contained microservices enable each service to scale independently of others.</span></span> <span data-ttu-id="2fbc0-190">Normalmente, os serviços terão necessidades e requisitos de escalabilidade diferentes.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-190">Typically, services will have different scalability needs and requirements.</span></span> <span data-ttu-id="2fbc0-191">O particionamento permite que você dimensione apenas o que precisa ser dimensionado sem o custo desnecessário de dimensionamento de um aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-191">Partitioning enables you to scale only what needs to be scaled without the unnecessary cost of scaling an entire application.</span></span>

- <span data-ttu-id="2fbc0-192">*Favorecer a expansão.* Os aplicativos baseados em nuvem favorecem a expansão dos recursos em oposição ao dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-192">*Favor scale-out.* Cloud-based applications favor scaling out resources as opposed to scaling up.</span></span> <span data-ttu-id="2fbc0-193">A expansão (também conhecida como escala horizontal) envolve a adição de mais recursos de serviço a um sistema existente para atender e compartilhar um nível de desempenho desejado.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-193">Scaling out (also known as horizontal scaling) involves adding more service resources to an existing system to meet and share a desired level of performance.</span></span> <span data-ttu-id="2fbc0-194">O dimensionamento (também conhecido como dimensionamento vertical) envolve a substituição de recursos existentes por hardware mais potente (mais núcleos de disco, memória e processamento).</span><span class="sxs-lookup"><span data-stu-id="2fbc0-194">Scaling up (also known as vertical scaling) involves replacing existing resources with more powerful hardware (more disk, memory, and processing cores).</span></span> <span data-ttu-id="2fbc0-195">A expansão pode ser invocada automaticamente com os recursos de dimensionamento automático disponíveis em alguns recursos de nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-195">Scaling out can be invoked automatically with the autoscaling features available in some Azure cloud resources.</span></span> <span data-ttu-id="2fbc0-196">Escalar horizontalmente em vários recursos também adiciona redundância ao sistema geral.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-196">Scaling out across multiple resources also adds redundancy to the overall system.</span></span> <span data-ttu-id="2fbc0-197">Por fim, a expansão de um único recurso é normalmente mais cara do que escalar horizontalmente em muitos recursos menores.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-197">Finally scaling up a single resource is typically more expensive than scaling out across many smaller resources.</span></span> <span data-ttu-id="2fbc0-198">A Figura 6-6 mostra as duas abordagens:</span><span class="sxs-lookup"><span data-stu-id="2fbc0-198">Figure 6-6 shows the two approaches:</span></span>

![Escalar verticalmente versus escalar horizontalmente](./media/scale-up-scale-out.png)

<span data-ttu-id="2fbc0-200">**Figura 6-6.**</span><span class="sxs-lookup"><span data-stu-id="2fbc0-200">**Figure 6-6.**</span></span> <span data-ttu-id="2fbc0-201">Escalar verticalmente versus escalar horizontalmente</span><span class="sxs-lookup"><span data-stu-id="2fbc0-201">Scale up versus scale out</span></span>

- <span data-ttu-id="2fbc0-202">*Dimensionar proporcionalmente.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-202">*Scale proportionally.*</span></span> <span data-ttu-id="2fbc0-203">Ao dimensionar um serviço, considere em termos de *conjuntos de recursos*.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-203">When scaling a service, think in terms of *resource sets*.</span></span> <span data-ttu-id="2fbc0-204">Se você fosse expandir drasticamente um serviço específico, que impacto teria em armazenamentos de dados de back-end, em caches e serviços dependentes?</span><span class="sxs-lookup"><span data-stu-id="2fbc0-204">If you were to dramatically scale out a specific service, what impact would that have on back-end data stores, caches and dependent services?</span></span> <span data-ttu-id="2fbc0-205">Alguns recursos, como Cosmos DB, podem ser expandidos proporcionalmente, enquanto muitos outros não podem.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-205">Some resources such as Cosmos DB can scale out proportionally, while many others can't.</span></span> <span data-ttu-id="2fbc0-206">Você deseja garantir que não expanda um recurso para um ponto em que ele esgotará outros recursos associados.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-206">You want to ensure that you don't scale out a resource to a point where it will exhaust other associated resources.</span></span>

- <span data-ttu-id="2fbc0-207">*Evite a afinidade.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-207">*Avoid affinity.*</span></span> <span data-ttu-id="2fbc0-208">Uma prática recomendada é garantir que um nó não exija afinidade local, geralmente chamado de *sessão adesiva*.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-208">A best practice is to ensure a node doesn't require local affinity, often referred to as a *sticky session*.</span></span> <span data-ttu-id="2fbc0-209">Uma solicitação deve ser capaz de rotear para qualquer instância.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-209">A request should be able to route to any instance.</span></span> <span data-ttu-id="2fbc0-210">Se você precisar manter o estado, ele deve ser salvo em um cache distribuído, como o [cache Redis do Azure](https://azure.microsoft.com/services/cache/).</span><span class="sxs-lookup"><span data-stu-id="2fbc0-210">If you need to persist state, it should be saved to a distributed cache, such as [Azure Redis cache](https://azure.microsoft.com/services/cache/).</span></span>

- <span data-ttu-id="2fbc0-211">*Aproveite os recursos de dimensionamento automático da plataforma.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-211">*Take advantage of platform autoscaling features.*</span></span> <span data-ttu-id="2fbc0-212">Use recursos internos de dimensionamento automático sempre que possível, em vez de mecanismos personalizados ou de terceiros.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-212">Use built-in autoscaling features whenever possible, rather than custom or third-party mechanisms.</span></span> <span data-ttu-id="2fbc0-213">Sempre que possível, use regras de dimensionamento agendadas para garantir que os recursos estejam disponíveis sem um atraso de inicialização, mas adicione o dimensionamento automático reativo às regras conforme apropriado, para lidar com alterações inesperadas na demanda.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-213">Where possible, use scheduled scaling rules to ensure that resources are available without a startup delay, but add reactive autoscaling to the rules as appropriate, to cope with unexpected changes in demand.</span></span> <span data-ttu-id="2fbc0-214">Para obter mais informações, consulte [diretrizes de dimensionamento](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling)automático.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-214">For more information, see [Autoscaling guidance](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling).</span></span>

- <span data-ttu-id="2fbc0-215">*Expanda agressivamente.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-215">*Scale out aggressively.*</span></span> <span data-ttu-id="2fbc0-216">Uma prática final seria escalar horizontalmente de forma agressiva para que você possa atender rapidamente a picos imediatos de tráfego sem perder negócios.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-216">A final practice would be to scale out aggressively so that you can quickly meet immediate spikes in traffic without losing business.</span></span> <span data-ttu-id="2fbc0-217">E, em seguida, reduzir (ou seja, remover instâncias desnecessárias) de forma conservadora para manter o sistema estável.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-217">And, then scale in (that is, remove unneeded instances) conservatively to keep the system stable.</span></span> <span data-ttu-id="2fbc0-218">Uma maneira simples de implementar isso é definir o período de resfriamento, que é o tempo de espera entre as operações de dimensionamento, cinco minutos para adicionar recursos e até 15 minutos para remover instâncias.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-218">A simple way to implement this is to set the cool down period, which is the time to wait between scaling operations, to five minutes for adding resources and up to 15 minutes for removing instances.</span></span>

## <a name="built-in-retry-in-services"></a><span data-ttu-id="2fbc0-219">Repetição interna em serviços</span><span class="sxs-lookup"><span data-stu-id="2fbc0-219">Built-in retry in services</span></span>

<span data-ttu-id="2fbc0-220">Incentivamos a prática recomendada de implementar operações de repetição programáticas em uma seção anterior.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-220">We encouraged the best practice of implementing programmatic retry operations in an earlier section.</span></span> <span data-ttu-id="2fbc0-221">Tenha em mente que muitos serviços do Azure e seus SDKs de cliente correspondentes também incluem mecanismos de repetição.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-221">Keep in mind that many Azure services and their corresponding client SDKs also include retry mechanisms.</span></span> <span data-ttu-id="2fbc0-222">A lista a seguir resume os recursos de repetição nos muitos dos serviços do Azure que são discutidos neste livro:</span><span class="sxs-lookup"><span data-stu-id="2fbc0-222">The following list summarizes retry features in the many of the Azure services that are discussed in this book:</span></span>

- <span data-ttu-id="2fbc0-223">*Azure Cosmos DB.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-223">*Azure Cosmos DB.*</span></span> <span data-ttu-id="2fbc0-224">A <xref:Microsoft.Azure.Documents.Client.DocumentClient> classe da API do cliente desativa automaticamente as tentativas com falha.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-224">The <xref:Microsoft.Azure.Documents.Client.DocumentClient> class from the client API automatically retires failed attempts.</span></span> <span data-ttu-id="2fbc0-225">O número de repetições e o tempo de espera máximo são configuráveis.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-225">The number of retries and maximum wait time are configurable.</span></span> <span data-ttu-id="2fbc0-226">As exceções geradas pela API do cliente são solicitações que excedem a política de repetição ou erros não transitórios.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-226">Exceptions thrown by the client API are either requests that exceed the retry policy or non-transient errors.</span></span>

- <span data-ttu-id="2fbc0-227">*Cache Redis do Azure.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-227">*Azure Redis Cache.*</span></span> <span data-ttu-id="2fbc0-228">O cliente Redis StackExchange usa uma classe de Gerenciador de conexões que inclui novas tentativas em tentativas com falha.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-228">The Redis StackExchange client uses a connection manager class that includes retries on failed attempts.</span></span> <span data-ttu-id="2fbc0-229">O número de repetições, a política de repetição específica e o tempo de espera são todos configuráveis.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-229">The number of retries, specific retry policy and wait time are all configurable.</span></span>

- <span data-ttu-id="2fbc0-230">*Barramento de serviço do Azure.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-230">*Azure Service Bus.*</span></span> <span data-ttu-id="2fbc0-231">O cliente do barramento de serviço expõe uma [classe RetryPolicy](xref:Microsoft.ServiceBus.RetryPolicy) que pode ser configurada com um intervalo de retirada, contagem de repetição e <xref:Microsoft.ServiceBus.RetryExponential.TerminationTimeBuffer%2A> , que especifica o tempo máximo que uma operação pode tomar.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-231">The Service Bus client exposes a [RetryPolicy class](xref:Microsoft.ServiceBus.RetryPolicy) that can be configured with a back-off interval, retry count, and <xref:Microsoft.ServiceBus.RetryExponential.TerminationTimeBuffer%2A>, which specifies the maximum time an operation can take.</span></span> <span data-ttu-id="2fbc0-232">A política padrão é de nove tentativas de repetição máximas com um período de retirada de 30 segundos entre as tentativas.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-232">The default policy is nine maximum retry attempts with a 30-second backoff period between attempts.</span></span>

- <span data-ttu-id="2fbc0-233">*Banco de dados SQL do Azure.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-233">*Azure SQL Database.*</span></span> <span data-ttu-id="2fbc0-234">O suporte de repetição é fornecido ao usar a biblioteca de [Entity Framework Core](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency) .</span><span class="sxs-lookup"><span data-stu-id="2fbc0-234">Retry support is provided when using the [Entity Framework Core](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency) library.</span></span>

- <span data-ttu-id="2fbc0-235">*Armazenamento do Azure.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-235">*Azure Storage.*</span></span> <span data-ttu-id="2fbc0-236">A biblioteca de cliente de armazenamento dá suporte a operações de repetição.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-236">The storage client library support retry operations.</span></span> <span data-ttu-id="2fbc0-237">As estratégias variam em tabelas de armazenamento do Azure, BLOBs e filas.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-237">The strategies vary across Azure storage tables, blobs, and queues.</span></span> <span data-ttu-id="2fbc0-238">Assim, as repetições alternativas alternam entre locais de serviços de armazenamento primários e secundários quando o recurso de redundância geográfica está habilitado.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-238">As well, alternate retries switch between primary and secondary storage services locations when the geo-redundancy feature is enabled.</span></span>

- <span data-ttu-id="2fbc0-239">*Hubs de eventos do Azure.*</span><span class="sxs-lookup"><span data-stu-id="2fbc0-239">*Azure Event Hubs.*</span></span> <span data-ttu-id="2fbc0-240">A biblioteca de cliente do hub de eventos apresenta uma propriedade RetryPolicy, que inclui um recurso de retirada exponencial configurável.</span><span class="sxs-lookup"><span data-stu-id="2fbc0-240">The Event Hub client library features a RetryPolicy property, which includes a configurable exponential backoff feature.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="2fbc0-241">[Anterior](application-resiliency-patterns.md) 
> [Avançar](resilient-communications.md)</span><span class="sxs-lookup"><span data-stu-id="2fbc0-241">[Previous](application-resiliency-patterns.md)
[Next](resilient-communications.md)</span></span>
