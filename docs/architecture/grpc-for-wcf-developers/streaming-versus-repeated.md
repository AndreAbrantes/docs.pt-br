---
title: Serviços de streaming vs. campos repetidos - gRPC para desenvolvedores WCF
description: Compare campos repetidos com serviços de streaming como formas de passar coletas de dados usando gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 542ebc393f9c9c1ad717d02d01fab33d85c18917
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79147744"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a><span data-ttu-id="a145d-103">Serviços de streaming gRPC versus campos repetidos</span><span class="sxs-lookup"><span data-stu-id="a145d-103">gRPC streaming services vs. repeated fields</span></span>

<span data-ttu-id="a145d-104">Os serviços gRPC fornecem duas maneiras de retornar conjuntos de dados ou listas de objetos.</span><span class="sxs-lookup"><span data-stu-id="a145d-104">gRPC services provide two ways of returning datasets, or lists of objects.</span></span> <span data-ttu-id="a145d-105">A especificação de mensagem `repeated` Buffers de protocolo usa a palavra-chave para declarar listas ou matrizes de mensagens em outra mensagem.</span><span class="sxs-lookup"><span data-stu-id="a145d-105">The Protocol Buffers message specification uses the `repeated` keyword for declaring lists or arrays of messages within another message.</span></span> <span data-ttu-id="a145d-106">A especificação de serviço `stream` gRPC usa a palavra-chave para declarar uma conexão persistente de longa duração.</span><span class="sxs-lookup"><span data-stu-id="a145d-106">The gRPC service specification uses the `stream` keyword to declare a long-running persistent connection.</span></span> <span data-ttu-id="a145d-107">Sobre essa conexão, várias mensagens são enviadas e podem ser processadas individualmente.</span><span class="sxs-lookup"><span data-stu-id="a145d-107">Over that connection, multiple messages are sent, and can be processed, individually.</span></span>

<span data-ttu-id="a145d-108">Você também pode `stream` usar o recurso para dados temporais de longa duração, como notificações ou mensagens de registro.</span><span class="sxs-lookup"><span data-stu-id="a145d-108">You can also use the `stream` feature for long-running temporal data such as notifications or log messages.</span></span> <span data-ttu-id="a145d-109">Mas este capítulo considerará seu uso para retornar um único conjunto de dados.</span><span class="sxs-lookup"><span data-stu-id="a145d-109">But this chapter will consider its use for returning a single dataset.</span></span>

<span data-ttu-id="a145d-110">O que você deve usar depende de fatores como:</span><span class="sxs-lookup"><span data-stu-id="a145d-110">Which you should use depends on factors such as:</span></span>

- <span data-ttu-id="a145d-111">O tamanho geral do conjunto de dados.</span><span class="sxs-lookup"><span data-stu-id="a145d-111">The overall size of the dataset.</span></span>
- <span data-ttu-id="a145d-112">O tempo que levou para criar o conjunto de dados no cliente ou no final do servidor.</span><span class="sxs-lookup"><span data-stu-id="a145d-112">The time it took to create the dataset at either the client or server end.</span></span>
- <span data-ttu-id="a145d-113">Se o consumidor do conjunto de dados pode começar a agir sobre ele assim que o primeiro item estiver disponível, ou precisa do conjunto de dados completo para fazer qualquer coisa útil.</span><span class="sxs-lookup"><span data-stu-id="a145d-113">Whether the consumer of the dataset can start acting on it as soon as the first item is available, or needs the complete dataset to do anything useful.</span></span>

## <a name="when-to-use-repeated-fields"></a><span data-ttu-id="a145d-114">Quando usar `repeated` campos</span><span class="sxs-lookup"><span data-stu-id="a145d-114">When to use `repeated` fields</span></span>

<span data-ttu-id="a145d-115">Para qualquer conjunto de dados que esteja limitado em tamanho e que possa ser gerado em sua totalidade `repeated` em um curto espaço de tempo — digamos, em menos de um segundo — você deve usar um campo em uma mensagem Protobuf regular.</span><span class="sxs-lookup"><span data-stu-id="a145d-115">For any dataset that's constrained in size and that can be generated in its entirety in a short time—say, under one second—you should use a `repeated` field in a regular Protobuf message.</span></span> <span data-ttu-id="a145d-116">Por exemplo, em um sistema de comércio eletrônico, construir uma lista de itens dentro de um pedido é provavelmente rápido e a lista não será muito grande.</span><span class="sxs-lookup"><span data-stu-id="a145d-116">For example, in an e-commerce system, to build a list of items within an order is probably quick and the list won't be very large.</span></span> <span data-ttu-id="a145d-117">Devolver uma única mensagem com um `repeated` campo é `stream` uma ordem de magnitude mais rápida do que usar e incorre em menos sobrecarga de rede.</span><span class="sxs-lookup"><span data-stu-id="a145d-117">Returning a single message with a `repeated` field is an order of magnitude faster than using `stream` and incurs less network overhead.</span></span>

<span data-ttu-id="a145d-118">Se o cliente precisar de todos os dados antes de começar a processá-los `repeated` e o conjunto de dados for pequeno o suficiente para construir na memória, então considere usar um campo.</span><span class="sxs-lookup"><span data-stu-id="a145d-118">If the client needs all the data before starting to process it and the dataset is small enough to construct in memory, then consider using a `repeated` field.</span></span> <span data-ttu-id="a145d-119">Considere-o mesmo que a criação do conjunto de dados na memória no servidor seja mais lenta.</span><span class="sxs-lookup"><span data-stu-id="a145d-119">Consider it even if the creation of the dataset in memory on the server is slower.</span></span>

## <a name="when-to-use-stream-methods"></a><span data-ttu-id="a145d-120">Quando usar `stream` métodos</span><span class="sxs-lookup"><span data-stu-id="a145d-120">When to use `stream` methods</span></span>

<span data-ttu-id="a145d-121">Quando os objetos de mensagem em seus conjuntos de dados são potencialmente muito grandes, é melhor transferi-los usando solicitações de streaming ou respostas.</span><span class="sxs-lookup"><span data-stu-id="a145d-121">When the message objects in your datasets are potentially very large, it's best for you transfer them by using streaming requests or responses.</span></span> <span data-ttu-id="a145d-122">É mais eficiente construir um objeto grande na memória, escrevê-lo para a rede e, em seguida, liberar os recursos.</span><span class="sxs-lookup"><span data-stu-id="a145d-122">It's more efficient to construct a large object in memory, write it to the network, and then free up the resources.</span></span> <span data-ttu-id="a145d-123">Essa abordagem melhorará a escalabilidade do seu serviço.</span><span class="sxs-lookup"><span data-stu-id="a145d-123">This approach will improve the scalability of your service.</span></span>

<span data-ttu-id="a145d-124">Da mesma forma, você deve enviar conjuntos de dados de tamanho não restrito sobre fluxos para evitar ficar sem memória ao construí-los.</span><span class="sxs-lookup"><span data-stu-id="a145d-124">Similarly, you should send datasets of unconstrained size over streams to avoid running out of memory while constructing them.</span></span>

<span data-ttu-id="a145d-125">Para conjuntos de dados onde o consumidor pode processar separadamente cada item, você deve considerar o uso de um fluxo se isso significar que o progresso pode ser indicado para o usuário.</span><span class="sxs-lookup"><span data-stu-id="a145d-125">For datasets where the consumer can separately process each item, you should consider using a stream if it means that progress can be indicated to the user.</span></span> <span data-ttu-id="a145d-126">O uso de um fluxo pode melhorar a capacidade de resposta de um aplicativo, mas você deve equilibrá-lo em relação ao desempenho geral do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a145d-126">Using a stream can improve the responsiveness of an application, but you should balance it against the overall performance of the application.</span></span>

<span data-ttu-id="a145d-127">Outro cenário onde os fluxos podem ser úteis é onde uma mensagem está sendo processada em vários serviços.</span><span class="sxs-lookup"><span data-stu-id="a145d-127">Another scenario where streams can be useful is where a message is being processed across multiple services.</span></span> <span data-ttu-id="a145d-128">Se cada serviço em uma cadeia retornar um fluxo, então o serviço de terminal (ou seja, o último da cadeia) pode começar a retornar mensagens.</span><span class="sxs-lookup"><span data-stu-id="a145d-128">If each service in a chain returns a stream, then the terminal service (that is, the last one in the chain) can start returning messages.</span></span> <span data-ttu-id="a145d-129">Essas mensagens podem ser processadas e transmitidas ao longo da cadeia para o solicitante original.</span><span class="sxs-lookup"><span data-stu-id="a145d-129">These messages can be processed and passed back along the chain to the original requestor.</span></span> <span data-ttu-id="a145d-130">O solicitante pode retornar um fluxo ou agregar os resultados em uma única mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="a145d-130">The requestor can either return a stream or aggregate the results into a single response message.</span></span> <span data-ttu-id="a145d-131">Essa abordagem se presta bem a padrões como MapReduce.</span><span class="sxs-lookup"><span data-stu-id="a145d-131">This approach lends itself well to patterns like MapReduce.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="a145d-132">[Próximo](migrate-duplex-services.md)
>[anterior](client-libraries.md)</span><span class="sxs-lookup"><span data-stu-id="a145d-132">[Previous](migrate-duplex-services.md)
[Next](client-libraries.md)</span></span>
