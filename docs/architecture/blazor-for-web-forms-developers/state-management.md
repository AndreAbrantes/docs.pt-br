---
title: Gerenciamento de estado
description: Aprenda abordagens diferentes para o gerenciamento de estado em ASP.NET Web Forms e mais incrivelmente.
author: csharpfritz
ms.author: jefritz
ms.date: 05/15/2020
ms.openlocfilehash: 2ca811f886c6a245ac16c2bd66a68ff16e5bfc44
ms.sourcegitcommit: 0100be20fcf23f61dab672deced70059ed71bb2e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/17/2020
ms.locfileid: "88267718"
---
# <a name="state-management"></a><span data-ttu-id="bcade-103">Gerenciamento de estado</span><span class="sxs-lookup"><span data-stu-id="bcade-103">State management</span></span>

<span data-ttu-id="bcade-104">O gerenciamento de estado é um conceito-chave de Web Forms aplicativos, facilitado por meio do estado de exibição, estado de sessão, estado do aplicativo e recursos de postback.</span><span class="sxs-lookup"><span data-stu-id="bcade-104">State management is a key concept of Web Forms applications, facilitated through View State, Session State, Application State, and Postback features.</span></span> <span data-ttu-id="bcade-105">Esses recursos com estado da estrutura ajudaram a ocultar o gerenciamento de estado necessário para um aplicativo e permitir que os desenvolvedores de aplicativos se concentrem em fornecer sua funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="bcade-105">These stateful features of the framework helped to hide the state management required for an application and allow application developers to focus on delivering their functionality.</span></span> <span data-ttu-id="bcade-106">Com o ASP.NET Core e o mais bem, alguns desses recursos foram realocados e alguns foram completamente removidos.</span><span class="sxs-lookup"><span data-stu-id="bcade-106">With ASP.NET Core and Blazor, some of these features have been relocated and some have been removed altogether.</span></span> <span data-ttu-id="bcade-107">Este capítulo examina como manter o estado e fornecer a mesma funcionalidade com os novos recursos do mais novo.</span><span class="sxs-lookup"><span data-stu-id="bcade-107">This chapter reviews how to maintain state and deliver the same functionality with the new features in Blazor.</span></span>

## <a name="request-state-management-with-viewstate"></a><span data-ttu-id="bcade-108">Solicitar gerenciamento de estado com ViewState</span><span class="sxs-lookup"><span data-stu-id="bcade-108">Request state management with ViewState</span></span>

<span data-ttu-id="bcade-109">Ao discutir o gerenciamento de estado no aplicativo Web Forms, muitos desenvolvedores irão considerar imediatamente o ViewState.</span><span class="sxs-lookup"><span data-stu-id="bcade-109">When discussing state management in Web Forms application, many developers will immediately think of ViewState.</span></span> <span data-ttu-id="bcade-110">Em Web Forms, ViewState gerencia o estado do conteúdo entre solicitações HTTP enviando um bloco de texto codificado grande para o navegador.</span><span class="sxs-lookup"><span data-stu-id="bcade-110">In Web Forms, ViewState manages the state of the content between HTTP requests by sending a large encoded block of text back and forth to the browser.</span></span> <span data-ttu-id="bcade-111">O campo ViewState pode ser sobrecarregado com conteúdo de uma página que contém muitos elementos, potencialmente expandindo para vários megabytes de tamanho.</span><span class="sxs-lookup"><span data-stu-id="bcade-111">The ViewState field could be overwhelmed with content from a page containing many elements, potentially expanding to several megabytes in size.</span></span>

<span data-ttu-id="bcade-112">Com o servidor mais incrivelmente, o aplicativo mantém uma conexão contínua com o servidor.</span><span class="sxs-lookup"><span data-stu-id="bcade-112">With Blazor Server, the app maintains an ongoing connection with the server.</span></span> <span data-ttu-id="bcade-113">O estado do aplicativo, chamado de *circuito*, é mantido na memória do servidor enquanto a conexão é considerada ativa.</span><span class="sxs-lookup"><span data-stu-id="bcade-113">The app's state, called a *circuit*, is held in server memory while the connection is considered active.</span></span> <span data-ttu-id="bcade-114">O estado só será Descartado quando o usuário sair do aplicativo ou de uma página específica no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bcade-114">State will only be disposed when the user navigates away from the app or a particular page in the app.</span></span> <span data-ttu-id="bcade-115">Todos os membros dos componentes ativos estão disponíveis entre as interações com o servidor.</span><span class="sxs-lookup"><span data-stu-id="bcade-115">All members of the active components are available between interactions with the server.</span></span>

<span data-ttu-id="bcade-116">Há várias vantagens desse recurso:</span><span class="sxs-lookup"><span data-stu-id="bcade-116">There are several advantages of this feature:</span></span>

- <span data-ttu-id="bcade-117">O estado do componente está prontamente disponível e não reconstruído entre as interações.</span><span class="sxs-lookup"><span data-stu-id="bcade-117">Component state is readily available and not rebuilt between interactions.</span></span>
- <span data-ttu-id="bcade-118">O estado não é transmitido para o navegador.</span><span class="sxs-lookup"><span data-stu-id="bcade-118">State isn't transmitted to the browser.</span></span>

<span data-ttu-id="bcade-119">No entanto, há algumas desvantagens na persistência de estado de componente na memória a serem consideradas:</span><span class="sxs-lookup"><span data-stu-id="bcade-119">However, there are some disadvantages to in-memory component state persistence to be aware of:</span></span>

- <span data-ttu-id="bcade-120">Se o servidor for reiniciado entre a solicitação, o estado será perdido.</span><span class="sxs-lookup"><span data-stu-id="bcade-120">If the server restarts between request, state is lost.</span></span>
- <span data-ttu-id="bcade-121">Sua solução de balanceamento de carga do servidor Web do aplicativo deve incluir sessões adesivas para garantir que todas as solicitações do mesmo navegador retornem para o mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="bcade-121">Your application web server load-balancing solution must include sticky sessions to ensure that all requests from the same browser return to the same server.</span></span> <span data-ttu-id="bcade-122">Se uma solicitação for para um servidor diferente, o estado será perdido.</span><span class="sxs-lookup"><span data-stu-id="bcade-122">If a request goes to a different server, state will be lost.</span></span>
- <span data-ttu-id="bcade-123">A persistência do estado do componente no servidor pode levar à pressão de memória no servidor Web.</span><span class="sxs-lookup"><span data-stu-id="bcade-123">Persistence of component state on the server can lead to memory pressure on the web server.</span></span>

<span data-ttu-id="bcade-124">Pelos motivos anteriores, não confie apenas no estado do componente para residir na memória no servidor.</span><span class="sxs-lookup"><span data-stu-id="bcade-124">For the preceding reasons, don't rely on just the state of the component to reside in-memory on the server.</span></span> <span data-ttu-id="bcade-125">Seu aplicativo também deve incluir algum armazenamento de dados de backup para dados entre solicitações.</span><span class="sxs-lookup"><span data-stu-id="bcade-125">Your application should also include some backing data store for data between requests.</span></span> <span data-ttu-id="bcade-126">Alguns exemplos simples dessa estratégia:</span><span class="sxs-lookup"><span data-stu-id="bcade-126">Some simple examples of this strategy:</span></span>

- <span data-ttu-id="bcade-127">Em um aplicativo de carrinho de compras, persista o conteúdo dos novos itens adicionados ao carrinho em um registro de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="bcade-127">In a shopping cart application, persist the content of new items added to the cart in a database record.</span></span> <span data-ttu-id="bcade-128">Se o estado no servidor for perdido, você poderá reconstitui-lo dos registros do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="bcade-128">If the state on the server is lost, you can reconstitute it from the database records.</span></span>
- <span data-ttu-id="bcade-129">Em um formulário da Web de várias partes, seus usuários esperam que seu aplicativo se lembre de valores entre cada solicitação.</span><span class="sxs-lookup"><span data-stu-id="bcade-129">In a multi-part web form, your users will expect your application to remember values between each request.</span></span> <span data-ttu-id="bcade-130">Grave os dados entre cada um dos posts do usuário em um repositório de dados para que eles possam ser buscados e montados na estrutura de resposta do formulário final quando o formulário de várias partes for concluído.</span><span class="sxs-lookup"><span data-stu-id="bcade-130">Write the data between each of your user's posts to a data store so that they can be fetched and assembled into the final form response structure when the multi-part form is completed.</span></span>

<span data-ttu-id="bcade-131">Para obter detalhes adicionais sobre o gerenciamento de estado em aplicativos mais novos, consulte [ASP.NET Core o gerenciamento de estado mais incrivelmente](/aspnet/core/blazor/state-management).</span><span class="sxs-lookup"><span data-stu-id="bcade-131">For additional details on managing state in Blazor apps, see [ASP.NET Core Blazor state management](/aspnet/core/blazor/state-management).</span></span>

## <a name="maintain-state-with-session"></a><span data-ttu-id="bcade-132">Manter estado com sessão</span><span class="sxs-lookup"><span data-stu-id="bcade-132">Maintain state with Session</span></span>

<span data-ttu-id="bcade-133">Web Forms desenvolvedores podem manter informações sobre o usuário que está atuando no momento com o <xref:Microsoft.AspNetCore.Http.ISession?displayProperty=nameWithType> objeto Dictionary.</span><span class="sxs-lookup"><span data-stu-id="bcade-133">Web Forms developers could maintain information about the currently acting user with the <xref:Microsoft.AspNetCore.Http.ISession?displayProperty=nameWithType> dictionary object.</span></span> <span data-ttu-id="bcade-134">É fácil adicionar um objeto com uma chave de cadeia de caracteres ao `Session` , e esse objeto estaria disponível posteriormente durante as interações do usuário com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bcade-134">It's easy enough to add an object with a string key to the `Session`, and that object would be available at a later time during the user's interactions with the application.</span></span> <span data-ttu-id="bcade-135">Em uma tentativa de eliminar o gerenciamento de interação com HTTP, o `Session` objeto facilitou a manutenção do estado.</span><span class="sxs-lookup"><span data-stu-id="bcade-135">In an attempt to eliminate managing interacting with HTTP, the `Session` object made it easy to maintain state.</span></span>

<span data-ttu-id="bcade-136">A assinatura do objeto .NET Framework `Session` não é igual ao `Session` objeto ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bcade-136">The signature of the .NET Framework `Session` object isn't the same as the ASP.NET Core `Session` object.</span></span> <span data-ttu-id="bcade-137">Considere [a documentação da nova sessão de ASP.NET Core](/dotnet/api/microsoft.aspnetcore.http.isession) antes de decidir migrar e usar o novo recurso de estado de sessão.</span><span class="sxs-lookup"><span data-stu-id="bcade-137">Consider [the documentation for the new ASP.NET Core Session](/dotnet/api/microsoft.aspnetcore.http.isession) before deciding to migrate and use the new session state feature.</span></span>

<span data-ttu-id="bcade-138">A sessão está disponível em um servidor ASP.NET Core e mais incrivelmente, mas não é recomendável de usar para armazenar dados em um repositório de dados adequadamente.</span><span class="sxs-lookup"><span data-stu-id="bcade-138">Session is available in ASP.NET Core and Blazor Server, but is discouraged from use in favor of storing data in a data repository appropriately.</span></span> <span data-ttu-id="bcade-139">O estado da sessão também não funcionará se os visitantes recusarem o uso de cookies HTTP em seu aplicativo devido a questões de privacidade.</span><span class="sxs-lookup"><span data-stu-id="bcade-139">Session state is also not functional if visitors decline the use HTTP cookies in your application due to privacy concerns.</span></span>

<span data-ttu-id="bcade-140">A configuração para ASP.NET Core e o estado de sessão está disponível no [artigo gerenciamento de sessão e estado no ASP.NET Core](/aspnet/core/fundamentals/app-state#session-state).</span><span class="sxs-lookup"><span data-stu-id="bcade-140">Configuration for ASP.NET Core and Session state is available in the [Session and state management in ASP.NET Core article](/aspnet/core/fundamentals/app-state#session-state).</span></span>

## <a name="application-state"></a><span data-ttu-id="bcade-141">Estado do aplicativo</span><span class="sxs-lookup"><span data-stu-id="bcade-141">Application state</span></span>

<span data-ttu-id="bcade-142">O `Application` objeto no Web Forms Framework fornece um repositório maciço e de solicitação cruzada para interagir com a configuração e o estado do escopo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bcade-142">The `Application` object in the Web Forms framework provides a massive, cross-request repository for interacting with application-scope configuration and state.</span></span> <span data-ttu-id="bcade-143">O estado do aplicativo era um lugar ideal para armazenar várias propriedades de configuração de aplicativo que seriam referenciadas por todas as solicitações, independentemente do usuário que faz a solicitação.</span><span class="sxs-lookup"><span data-stu-id="bcade-143">Application state was an ideal place to store various application configuration properties that would be referenced by all requests, regardless of the user making the request.</span></span> <span data-ttu-id="bcade-144">O problema com o `Application` objeto era que os dados não persistiram em vários servidores.</span><span class="sxs-lookup"><span data-stu-id="bcade-144">The problem with the `Application` object was that data didn't persist across multiple servers.</span></span> <span data-ttu-id="bcade-145">O estado do objeto de aplicativo foi perdido entre as reinicializações.</span><span class="sxs-lookup"><span data-stu-id="bcade-145">The state of the application object was lost between restarts.</span></span>

<span data-ttu-id="bcade-146">Assim como acontece com `Session` o, é recomendável que os dados sejam movidos para um repositório de backup persistente que possa ser acessado por várias instâncias de servidor.</span><span class="sxs-lookup"><span data-stu-id="bcade-146">As with `Session`, it's recommended that data move to a persistent backing store that could be accessed by multiple server instances.</span></span> <span data-ttu-id="bcade-147">Se houver dados voláteis que você gostaria de poder acessar entre solicitações e usuários, você poderia armazená-los facilmente em um serviço singleton que pode ser injetado em componentes que exigem essas informações ou interação.</span><span class="sxs-lookup"><span data-stu-id="bcade-147">If there is volatile data that you would like to be able to access across requests and users, you could easily store it in a singleton service that can be injected into components that require this information or interaction.</span></span>

<span data-ttu-id="bcade-148">A construção de um objeto para manter o estado do aplicativo e seu consumo pode se parecer com a seguinte implementação:</span><span class="sxs-lookup"><span data-stu-id="bcade-148">The construction of an object to maintain application state and its consumption could resemble the following implementation:</span></span>

```csharp
public class MyApplicationState
{
    public int VisitorCounter { get; private set; } = 0;

    public void IncrementCounter() => VisitorCounter += 1;
}
```

```csharp
app.AddSingleton<MyApplicationState>();
```

```razor
@inject MyApplicationState AppState

<label>Total Visitors: @AppState.VisitorCounter</label>
```

<span data-ttu-id="bcade-149">O `MyApplicationState` objeto é criado apenas uma vez no servidor, e o valor `VisitorCounter` é buscado e a saída é obtida no rótulo do componente.</span><span class="sxs-lookup"><span data-stu-id="bcade-149">The `MyApplicationState` object is created only once on the server, and the value `VisitorCounter` is fetched and output in the component's label.</span></span> <span data-ttu-id="bcade-150">O `VisitorCounter` valor deve ser persistido e recuperado de um armazenamento de dados de backup para durabilidade e escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="bcade-150">The `VisitorCounter` value should be persisted and retrieved from a backing data store for durability and scalability.</span></span>

## <a name="in-the-browser"></a><span data-ttu-id="bcade-151">No navegador</span><span class="sxs-lookup"><span data-stu-id="bcade-151">In the browser</span></span>

<span data-ttu-id="bcade-152">Os dados do aplicativo também podem ser armazenados no lado do cliente no dispositivo do usuário para que ele esteja disponível posteriormente.</span><span class="sxs-lookup"><span data-stu-id="bcade-152">Application data can also be stored client-side on the user's device so that is available later.</span></span> <span data-ttu-id="bcade-153">Há dois recursos de navegador que permitem a persistência de dados em escopos diferentes do navegador do usuário:</span><span class="sxs-lookup"><span data-stu-id="bcade-153">There are two browser features that allow for persistence of data in different scopes of the user's browser:</span></span>

- <span data-ttu-id="bcade-154">`localStorage` -escopo do navegador inteiro do usuário.</span><span class="sxs-lookup"><span data-stu-id="bcade-154">`localStorage` - scoped to the user's entire browser.</span></span> <span data-ttu-id="bcade-155">Se a página for recarregada, o navegador será fechado e reaberto, ou outra guia será aberta com a mesma URL, então o mesmo `localStorage` será fornecido pelo navegador</span><span class="sxs-lookup"><span data-stu-id="bcade-155">If the page is reloaded, the browser is closed and reopened, or another tab is opened with the same URL then the same `localStorage` is provided by the browser</span></span>
- <span data-ttu-id="bcade-156">`sessionStorage` -escopo da guia atual do navegador do usuário. Se a guia for recarregada, o estado persiste.</span><span class="sxs-lookup"><span data-stu-id="bcade-156">`sessionStorage` - scoped to the user's current browser tab. If the tab is reloaded, the state persists.</span></span> <span data-ttu-id="bcade-157">No entanto, se o usuário abrir outra guia para seu aplicativo ou fechar e reabrir o navegador, o estado será perdido.</span><span class="sxs-lookup"><span data-stu-id="bcade-157">However, if the user opens another tab to your application or closes and reopens the browser the state is lost.</span></span>

<span data-ttu-id="bcade-158">Você pode escrever um código JavaScript personalizado para interagir com esses recursos, ou há vários pacotes NuGet que você pode usar que fornecem essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="bcade-158">You can write some custom JavaScript code to interact with these features, or there are a number of NuGet packages that you can use that provide this functionality.</span></span> <span data-ttu-id="bcade-159">Um desses pacotes é [Microsoft. AspNetCore. ProtectedBrowserStorage](https://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage).</span><span class="sxs-lookup"><span data-stu-id="bcade-159">One such package is [Microsoft.AspNetCore.ProtectedBrowserStorage](https://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage).</span></span>

<span data-ttu-id="bcade-160">Para obter instruções sobre como utilizar esse pacote para interagir `localStorage` com `sessionStorage` o e o, consulte o artigo de [Gerenciamento de estado mais incrivelmente](/aspnet/core/blazor/state-management#protected-browser-storage-experimental-package) .</span><span class="sxs-lookup"><span data-stu-id="bcade-160">For instructions on utilizing this package to interact with `localStorage` and `sessionStorage`, see the [Blazor State Management](/aspnet/core/blazor/state-management#protected-browser-storage-experimental-package) article.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="bcade-161">[Anterior](pages-routing-layouts.md) 
> [Avançar](forms-validation.md)</span><span class="sxs-lookup"><span data-stu-id="bcade-161">[Previous](pages-routing-layouts.md)
[Next](forms-validation.md)</span></span>
