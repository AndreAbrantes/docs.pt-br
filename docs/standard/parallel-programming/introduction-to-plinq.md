---
title: "Introdução ao PLINQ"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords: PLINQ queries, introduction to
ms.assetid: eaa720d8-8999-4eb7-8df5-3c19ca61cad0
caps.latest.revision: "22"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: db9c3e16d4a8073fbce636f37490f719dbd93e4d
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="introduction-to-plinq"></a><span data-ttu-id="dd298-102">Introdução ao PLINQ</span><span class="sxs-lookup"><span data-stu-id="dd298-102">Introduction to PLINQ</span></span>
## <a name="what-is-a-parallel-query"></a><span data-ttu-id="dd298-103">O que é uma Consulta Paralela?</span><span class="sxs-lookup"><span data-stu-id="dd298-103">What is a Parallel Query?</span></span>  
 <span data-ttu-id="dd298-104">A LINQ (Consulta Integrada à Linguagem) foi introduzida no [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dd298-104">Language-Integrated Query (LINQ) was introduced in the [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)].</span></span>  <span data-ttu-id="dd298-105">Ele apresenta um modelo unificado para consultar qualquer <xref:System.Collections.IEnumerable?displayProperty=nameWithType> ou <xref:System.Collections.Generic.IEnumerable%601?displayProperty=nameWithType> fonte de dados de uma maneira de tipo seguro.</span><span class="sxs-lookup"><span data-stu-id="dd298-105">It features a unified model for querying any <xref:System.Collections.IEnumerable?displayProperty=nameWithType> or <xref:System.Collections.Generic.IEnumerable%601?displayProperty=nameWithType> data source in a type-safe manner.</span></span> <span data-ttu-id="dd298-106">Objetos LINQ to é o nome para consultas LINQ que são executados em relação a coleções na memória, como <xref:System.Collections.Generic.List%601> e matrizes.</span><span class="sxs-lookup"><span data-stu-id="dd298-106">LINQ to Objects is the name for LINQ queries that are run against in-memory collections such as <xref:System.Collections.Generic.List%601> and arrays.</span></span> <span data-ttu-id="dd298-107">Este artigo pressupõe que você tenha uma compreensão básica de LINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-107">This article assumes that you have a basic understand of LINQ.</span></span> <span data-ttu-id="dd298-108">Para saber mais, veja [LINQ (Consulta Integrada à Linguagem)](http://msdn.microsoft.com/library/a73c4aec-5d15-4e98-b962-1274021ea93d).</span><span class="sxs-lookup"><span data-stu-id="dd298-108">For more information, see [LINQ (Language-Integrated Query)](http://msdn.microsoft.com/library/a73c4aec-5d15-4e98-b962-1274021ea93d).</span></span>  
  
 <span data-ttu-id="dd298-109">PLINQ (Parallel LINQ) é uma implementação paralela da LINQ padrão.</span><span class="sxs-lookup"><span data-stu-id="dd298-109">Parallel LINQ (PLINQ) is a parallel implementation of the LINQ pattern.</span></span> <span data-ttu-id="dd298-110">Uma consulta PLINQ, em muitas formas, é semelhante a uma consulta não paralela de LINQ to Objects.</span><span class="sxs-lookup"><span data-stu-id="dd298-110">A PLINQ query in many ways resembles a non-parallel LINQ to Objects query.</span></span> <span data-ttu-id="dd298-111">Consultas PLINQ, assim como sequencial [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] consultas, operar em qualquer na memória <xref:System.Collections.IEnumerable> ou <xref:System.Collections.Generic.IEnumerable%601> dados de origem e adiaram execução, o que significa que eles não começar a execução até que a consulta é enumerada.</span><span class="sxs-lookup"><span data-stu-id="dd298-111">PLINQ queries, just like sequential [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] queries, operate on any in-memory <xref:System.Collections.IEnumerable> or <xref:System.Collections.Generic.IEnumerable%601> data source, and have deferred execution, which means they do not begin executing until the query is enumerated.</span></span> <span data-ttu-id="dd298-112">A principal diferença é que a PLINQ tenta fazer uso integral de todos os processadores no sistema.</span><span class="sxs-lookup"><span data-stu-id="dd298-112">The primary difference is that PLINQ attempts to make full use of all the processors on the system.</span></span> <span data-ttu-id="dd298-113">Ela faz isso particionando a fonte de dados em segmentos e então executando a consulta em cada segmento em threads de trabalho separados em paralelo em vários processadores.</span><span class="sxs-lookup"><span data-stu-id="dd298-113">It does this by partitioning the data source into segments, and then executing the query on each segment on separate worker threads in parallel on multiple processors.</span></span> <span data-ttu-id="dd298-114">Em muitos casos, a execução paralela significa que a consulta é executada de forma significativamente mais rápida.</span><span class="sxs-lookup"><span data-stu-id="dd298-114">In many cases, parallel execution means that the query runs significantly faster.</span></span>  
  
 <span data-ttu-id="dd298-115">Por meio da execução paralela, PLINQ pode obter melhorias significativas de desempenho sobre o código herdado para determinados tipos de consultas, geralmente simplesmente adicionando o <xref:System.Linq.ParallelEnumerable.AsParallel%2A> operação à fonte de dados de consulta.</span><span class="sxs-lookup"><span data-stu-id="dd298-115">Through parallel execution, PLINQ can achieve significant performance improvements over legacy code for certain kinds of queries, often just by adding the <xref:System.Linq.ParallelEnumerable.AsParallel%2A> query operation to the data source.</span></span> <span data-ttu-id="dd298-116">No entanto, o paralelismo pode apresentar suas próprias complexidades e nem todas as operações de consulta são executadas mais rapidamente na PLINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-116">However, parallelism can introduce its own complexities, and not all query operations run faster in PLINQ.</span></span> <span data-ttu-id="dd298-117">Na verdade, a paralelização realmente atrasa determinadas consultas.</span><span class="sxs-lookup"><span data-stu-id="dd298-117">In fact, parallelization actually slows down certain queries.</span></span> <span data-ttu-id="dd298-118">Portanto, você deve compreender como problemas como a classificação afetam consultas paralelas.</span><span class="sxs-lookup"><span data-stu-id="dd298-118">Therefore, you should understand how issues such as ordering affect parallel queries.</span></span> <span data-ttu-id="dd298-119">Para saber mais, veja [Noções básicas sobre agilização em PLINQ](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-119">For more information, see [Understanding Speedup in PLINQ](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="dd298-120">Esta documentação usa expressões lambda para definir representantes na PLINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-120">This documentation uses lambda expressions to define delegates in PLINQ.</span></span> <span data-ttu-id="dd298-121">Se você não estiver familiarizado com expressões lambda no C# ou no Visual Basic, veja [Expressões lambda em PLINQ e TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-121">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>  
  
 <span data-ttu-id="dd298-122">O restante deste artigo fornece uma visão geral das principais classes PLINQ e discute como criar consultas PLINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-122">The remainder of this article gives an overview of the main PLINQ classes, and discusses how to create PLINQ queries.</span></span> <span data-ttu-id="dd298-123">Cada seção contém links para mais informações e exemplos de código.</span><span class="sxs-lookup"><span data-stu-id="dd298-123">Each section contains links to more detailed information and code examples.</span></span>  
  
## <a name="the-parallelenumerable-class"></a><span data-ttu-id="dd298-124">A Classe ParallelEnumerable</span><span class="sxs-lookup"><span data-stu-id="dd298-124">The ParallelEnumerable Class</span></span>  
 <span data-ttu-id="dd298-125">O <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> classe expõe quase todas as funcionalidades do PLINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-125">The <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> class exposes almost all of PLINQ's functionality.</span></span>  <span data-ttu-id="dd298-126">Ele e o restante do <xref:System.Linq?displayProperty=nameWithType> tipos de namespace são compilados no assembly System.Core.dll.</span><span class="sxs-lookup"><span data-stu-id="dd298-126">It and the rest of the <xref:System.Linq?displayProperty=nameWithType> namespace types are compiled into the System.Core.dll assembly.</span></span> <span data-ttu-id="dd298-127">Os projetos padrão de C# e do Visual Basic no Visual Studio fazem referência ao assembly e importam o namespace.</span><span class="sxs-lookup"><span data-stu-id="dd298-127">The default C# and Visual Basic projects in Visual Studio both reference the assembly and import the namespace.</span></span>  
  
 <span data-ttu-id="dd298-128"><xref:System.Linq.ParallelEnumerable>inclui implementações de todos os operadores de consulta padrão LINQ para objetos com suporte, embora não haja a tentativa paralelizar a cada um.</span><span class="sxs-lookup"><span data-stu-id="dd298-128"><xref:System.Linq.ParallelEnumerable> includes implementations of all the standard query operators that LINQ to Objects supports, although it does not attempt to parallelize each one.</span></span> <span data-ttu-id="dd298-129">Se você não estiver familiarizado com a [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)], veja [Introdução a LINQ](http://msdn.microsoft.com/library/24dddf19-12a0-4707-a4bc-eba4fa7f219e).</span><span class="sxs-lookup"><span data-stu-id="dd298-129">If you are not familiar with [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)], see [Introduction to LINQ](http://msdn.microsoft.com/library/24dddf19-12a0-4707-a4bc-eba4fa7f219e).</span></span>  
  
 <span data-ttu-id="dd298-130">Além dos operadores de consulta padrão, o <xref:System.Linq.ParallelEnumerable> classe contém um conjunto de métodos que permitem comportamentos específicos para execução paralela.</span><span class="sxs-lookup"><span data-stu-id="dd298-130">In addition to the standard query operators, the <xref:System.Linq.ParallelEnumerable> class contains a set of methods that enable behaviors specific to parallel execution.</span></span> <span data-ttu-id="dd298-131">Esses métodos específicos de PLINQ são listados na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="dd298-131">These PLINQ-specific methods are listed in the following table.</span></span>  
  
|<span data-ttu-id="dd298-132">Operador ParallelEnumerable</span><span class="sxs-lookup"><span data-stu-id="dd298-132">ParallelEnumerable Operator</span></span>|<span data-ttu-id="dd298-133">Descrição</span><span class="sxs-lookup"><span data-stu-id="dd298-133">Description</span></span>|  
|---------------------------------|-----------------|  
|<xref:System.Linq.ParallelEnumerable.AsParallel%2A>|<span data-ttu-id="dd298-134">O ponto de entrada para PLINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-134">The entry point for PLINQ.</span></span> <span data-ttu-id="dd298-135">Especifica que o restante da consulta deverá ser paralelizado, se possível.</span><span class="sxs-lookup"><span data-stu-id="dd298-135">Specifies that the rest of the query should be parallelized, if it is possible.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.AsSequential%2A>|<span data-ttu-id="dd298-136">Especifica que o restante da consulta deve ser executado em sequência, como uma consulta LINQ não paralela.</span><span class="sxs-lookup"><span data-stu-id="dd298-136">Specifies that the rest of the query should be run sequentially, as a non-parallel LINQ query.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.AsOrdered%2A>|<span data-ttu-id="dd298-137">Especifica que a PLINQ deve preservar a ordenação da sequência de origem para o restante da consulta, ou até que a ordenação seja alterada, por exemplo, pelo uso de uma cláusula orderby (Order By no Vlsual Basic).</span><span class="sxs-lookup"><span data-stu-id="dd298-137">Specifies that PLINQ should preserve the ordering of the source sequence for the rest of the query, or until the ordering is changed, for example by the use of an orderby (Order By in Vlsual Basic) clause.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.AsUnordered%2A>|<span data-ttu-id="dd298-138">Especifica que a PLINQ para o restante da consulta não precisa preservar a ordenação da sequência de origem.</span><span class="sxs-lookup"><span data-stu-id="dd298-138">Specifies that PLINQ for the rest of the query is not required to preserve the ordering of the source sequence.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithCancellation%2A>|<span data-ttu-id="dd298-139">Especifica que a PLINQ deve monitorar periodicamente o estado do token de cancelamento fornecido e cancelar a execução se isso for solicitado.</span><span class="sxs-lookup"><span data-stu-id="dd298-139">Specifies that PLINQ should periodically monitor the state of the provided cancellation token and cancel execution if it is requested.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A>|<span data-ttu-id="dd298-140">Especifica o número máximo de processadores que a PLINQ deve usar para paralelizar a consulta.</span><span class="sxs-lookup"><span data-stu-id="dd298-140">Specifies the maximum number of processors that PLINQ should use to parallelize the query.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A>|<span data-ttu-id="dd298-141">Fornece uma dica sobre como a PLINQ deve, se possível, mesclar resultados paralelos novamente em apenas uma sequência no segmento de consumo.</span><span class="sxs-lookup"><span data-stu-id="dd298-141">Provides a hint about how PLINQ should, if it is possible, merge parallel results back into just one sequence on the consuming thread.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A>|<span data-ttu-id="dd298-142">Especifica se a PLINQ deve paralelizar a consulta mesmo quando o comportamento padrão for executá-la em sequência.</span><span class="sxs-lookup"><span data-stu-id="dd298-142">Specifies whether PLINQ should parallelize the query even when the default behavior would be to run it sequentially.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.ForAll%2A>|<span data-ttu-id="dd298-143">Um método de enumeração multithread que, ao contrário de iterar sobre os resultados da consulta, permite que os resultados sejam processados em paralelo sem primeiro mesclar de volta para o thread de consumidor.</span><span class="sxs-lookup"><span data-stu-id="dd298-143">A multithreaded enumeration method that, unlike iterating over the results of the query, enables results to be processed in parallel without first merging back to the consumer thread.</span></span>|  
|<span data-ttu-id="dd298-144">sobrecarga de <xref:System.Linq.ParallelEnumerable.Aggregate%2A></span><span class="sxs-lookup"><span data-stu-id="dd298-144"><xref:System.Linq.ParallelEnumerable.Aggregate%2A> overload</span></span>|<span data-ttu-id="dd298-145">Uma sobrecarga que é exclusiva da PLINQ e permite agregação intermediária em partições de thread local, além de uma função de agregação final para combinar os resultados de todas as partições.</span><span class="sxs-lookup"><span data-stu-id="dd298-145">An overload that is unique to PLINQ and enables intermediate aggregation over thread-local partitions, plus a final aggregation function to combine the results of all partitions.</span></span>|  
  
## <a name="the-opt-in-model"></a><span data-ttu-id="dd298-146">O Modelo de Aceite</span><span class="sxs-lookup"><span data-stu-id="dd298-146">The Opt-in Model</span></span>  
 <span data-ttu-id="dd298-147">Quando você escreve uma consulta, escolha PLINQ invocando o <xref:System.Linq.ParallelEnumerable.AsParallel%2A?displayProperty=nameWithType> método de extensão na fonte de dados, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="dd298-147">When you write a query, opt in to PLINQ by invoking the <xref:System.Linq.ParallelEnumerable.AsParallel%2A?displayProperty=nameWithType> extension method on the data source, as shown in the following example.</span></span>  
  
 [!code-csharp[PLINQ#1](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#1)]
 [!code-vb[PLINQ#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#1)]  
  
 <span data-ttu-id="dd298-148">O <xref:System.Linq.ParallelEnumerable.AsParallel%2A> método de extensão associa os operadores de consulta subsequente, nesse caso, `where` e `select`, para o <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> implementações.</span><span class="sxs-lookup"><span data-stu-id="dd298-148">The <xref:System.Linq.ParallelEnumerable.AsParallel%2A> extension method binds the subsequent query operators, in this case, `where` and `select`, to the <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> implementations.</span></span>  
  
## <a name="execution-modes"></a><span data-ttu-id="dd298-149">Modos de Execução</span><span class="sxs-lookup"><span data-stu-id="dd298-149">Execution Modes</span></span>  
 <span data-ttu-id="dd298-150">Por padrão, a PLINQ é conservadora.</span><span class="sxs-lookup"><span data-stu-id="dd298-150">By default, PLINQ is conservative.</span></span> <span data-ttu-id="dd298-151">Em tempo de execução, a infraestrutura da PLINQ analisa a estrutura geral da consulta.</span><span class="sxs-lookup"><span data-stu-id="dd298-151">At run time, the PLINQ infrastructure analyzes the overall structure of the query.</span></span> <span data-ttu-id="dd298-152">Se for provável que a consulta produza aumentos de velocidade por paralelização, a PLINQ particionará a sequência de origem em tarefas que podem ser executadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="dd298-152">If the query is likely to yield speedups by parallelization, PLINQ partitions the source sequence into tasks that can be run concurrently.</span></span> <span data-ttu-id="dd298-153">Se não for seguro a paralelização de uma consulta, a PLINQ apenas executa a consulta em sequência.</span><span class="sxs-lookup"><span data-stu-id="dd298-153">If it is not safe to parallelize a query, PLINQ just runs the query sequentially.</span></span> <span data-ttu-id="dd298-154">Se a PLINQ tiver a opção de escolher entre um algoritmo paralelo potencialmente caro ou um algoritmo sequencial barato, ela escolherá o algoritmo sequencial, por padrão.</span><span class="sxs-lookup"><span data-stu-id="dd298-154">If PLINQ has a choice between a potentially expensive parallel algorithm or an inexpensive sequential algorithm, it chooses the sequential algorithm by default.</span></span> <span data-ttu-id="dd298-155">Você pode usar o <xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A> método e o <xref:System.Linq.ParallelExecutionMode?displayProperty=nameWithType> enumeração para instruir o PLINQ para selecionar o algoritmo em paralelo.</span><span class="sxs-lookup"><span data-stu-id="dd298-155">You can use the <xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A> method and the <xref:System.Linq.ParallelExecutionMode?displayProperty=nameWithType> enumeration to instruct PLINQ to select the parallel algorithm.</span></span> <span data-ttu-id="dd298-156">Isso é útil quando você sabe por meio de testes e medidas que uma determinada consulta é executada mais rapidamente em paralelo.</span><span class="sxs-lookup"><span data-stu-id="dd298-156">This is useful when you know by testing and measurement that a particular query executes faster in parallel.</span></span> <span data-ttu-id="dd298-157">Para saber mais, veja [Como especificar o modo de execução em PLINQ](../../../docs/standard/parallel-programming/how-to-specify-the-execution-mode-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-157">For more information, see [How to: Specify the Execution Mode in PLINQ](../../../docs/standard/parallel-programming/how-to-specify-the-execution-mode-in-plinq.md).</span></span>  
  
## <a name="degree-of-parallelism"></a><span data-ttu-id="dd298-158">Grau de Paralelismo</span><span class="sxs-lookup"><span data-stu-id="dd298-158">Degree of Parallelism</span></span>  
 <span data-ttu-id="dd298-159">Por padrão, o PLINQ usa todos os processadores no computador host.</span><span class="sxs-lookup"><span data-stu-id="dd298-159">By default, PLINQ uses all of the processors on the host computer.</span></span> <span data-ttu-id="dd298-160">Você pode instruir o PLINQ usar não mais do que um número especificado de processadores usando a <xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A> método.</span><span class="sxs-lookup"><span data-stu-id="dd298-160">You can instruct PLINQ to use no more than a specified number of processors by using the <xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A> method.</span></span> <span data-ttu-id="dd298-161">Isso é útil quando você deseja certificar-se de que outros processos em execução no computador receberão um determinado período de tempo de CPU.</span><span class="sxs-lookup"><span data-stu-id="dd298-161">This is useful when you want to make sure that other processes running on the computer receive a certain amount of CPU time.</span></span> <span data-ttu-id="dd298-162">O trecho a seguir limita a consulta ao utilizar no máximo dois processadores.</span><span class="sxs-lookup"><span data-stu-id="dd298-162">The following snippet limits the query to utilizing a maximum of two processors.</span></span>  
  
 [!code-csharp[PLINQ#5](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#5)]
 [!code-vb[PLINQ#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#5)]  
  
 <span data-ttu-id="dd298-163">Em casos onde uma consulta esteja executando uma quantidade significativa de trabalho associado a computação, como E/S de Arquivo, pode ser útil especificar um grau de paralelismo maior do que o número de núcleos no computador.</span><span class="sxs-lookup"><span data-stu-id="dd298-163">In cases where a query is performing a significant amount of non-compute-bound work such as File I/O, it might be beneficial to specify a degree of parallelism greater than the number of cores on the machine.</span></span>  
  
## <a name="ordered-versus-unordered-parallel-queries"></a><span data-ttu-id="dd298-164">Consultas Paralelas Ordenadas Contra Não Ordenadas</span><span class="sxs-lookup"><span data-stu-id="dd298-164">Ordered Versus Unordered Parallel Queries</span></span>  
 <span data-ttu-id="dd298-165">Em algumas consultas, um operador de consulta deve produzir resultados que preservem a ordenação da sequência de origem.</span><span class="sxs-lookup"><span data-stu-id="dd298-165">In some queries, a query operator must produce results that preserve the ordering of the source sequence.</span></span> <span data-ttu-id="dd298-166">PLINQ fornece o <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operador para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="dd298-166">PLINQ provides the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator for this purpose.</span></span> <span data-ttu-id="dd298-167"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A>é diferente do <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd298-167"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A> is distinct from <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span></span> <span data-ttu-id="dd298-168">Um <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequência ainda é processada em paralelo, mas os resultados são armazenados em buffer e classificados.</span><span class="sxs-lookup"><span data-stu-id="dd298-168">An <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequence is still processed in parallel, but its results are buffered and sorted.</span></span> <span data-ttu-id="dd298-169">Porque um trabalho extra, normalmente envolve a preservação da ordem um <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequência pode ser processada mais lentamente do que o padrão <xref:System.Linq.ParallelEnumerable.AsUnordered%2A> sequência.</span><span class="sxs-lookup"><span data-stu-id="dd298-169">Because order preservation typically involves extra work, an <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequence might be processed more slowly than the default <xref:System.Linq.ParallelEnumerable.AsUnordered%2A> sequence.</span></span> <span data-ttu-id="dd298-170">Se uma determinada operação paralela ordenada será mais rápida do que uma versão sequencial da operação, isso dependerá de vários fatores.</span><span class="sxs-lookup"><span data-stu-id="dd298-170">Whether a particular ordered parallel operation is faster than a sequential version of the operation depends on many factors.</span></span>  
  
 <span data-ttu-id="dd298-171">O exemplo de código a seguir mostra como aceitar a preservação da ordem.</span><span class="sxs-lookup"><span data-stu-id="dd298-171">The following code example shows how to opt in to order preservation.</span></span>  
  
 [!code-csharp[PLINQ#3](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#3)]
 [!code-vb[PLINQ#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#3)]  
  
 <span data-ttu-id="dd298-172">Para saber mais, veja [Preservação da ordem em PLINQ](../../../docs/standard/parallel-programming/order-preservation-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-172">For more information, see [Order Preservation in PLINQ](../../../docs/standard/parallel-programming/order-preservation-in-plinq.md).</span></span>  
  
## <a name="parallel-vs-sequential-queries"></a><span data-ttu-id="dd298-173">Consultas paralelas versus sequenciais</span><span class="sxs-lookup"><span data-stu-id="dd298-173">Parallel vs. Sequential Queries</span></span>  
 <span data-ttu-id="dd298-174">Algumas operações exigem que os dados de origem sejam entregue de forma sequencial.</span><span class="sxs-lookup"><span data-stu-id="dd298-174">Some operations require that the source data be delivered in a sequential manner.</span></span> <span data-ttu-id="dd298-175">O <xref:System.Linq.ParallelEnumerable> consulta operadores volte para o modo sequencial automaticamente quando necessário.</span><span class="sxs-lookup"><span data-stu-id="dd298-175">The <xref:System.Linq.ParallelEnumerable> query operators revert to sequential mode automatically when it is required.</span></span> <span data-ttu-id="dd298-176">Operadores de consulta definidas pelo usuário e delegados de usuário que exigem execução sequencial, PLINQ fornece o <xref:System.Linq.ParallelEnumerable.AsSequential%2A> método.</span><span class="sxs-lookup"><span data-stu-id="dd298-176">For user-defined query operators and user delegates that require sequential execution, PLINQ provides the <xref:System.Linq.ParallelEnumerable.AsSequential%2A> method.</span></span> <span data-ttu-id="dd298-177">Quando você usa <xref:System.Linq.ParallelEnumerable.AsSequential%2A>, todos os operadores subsequentes na consulta são executados sequencialmente até <xref:System.Linq.ParallelEnumerable.AsParallel%2A> é chamado novamente.</span><span class="sxs-lookup"><span data-stu-id="dd298-177">When you use <xref:System.Linq.ParallelEnumerable.AsSequential%2A>, all subsequent operators in the query are executed sequentially until <xref:System.Linq.ParallelEnumerable.AsParallel%2A> is called again.</span></span> <span data-ttu-id="dd298-178">Para saber mais, veja [Como combinar consultas LINQ paralelas e sequenciais](../../../docs/standard/parallel-programming/how-to-combine-parallel-and-sequential-linq-queries.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-178">For more information, see [How to: Combine Parallel and Sequential LINQ Queries](../../../docs/standard/parallel-programming/how-to-combine-parallel-and-sequential-linq-queries.md).</span></span>  
  
## <a name="options-for-merging-query-results"></a><span data-ttu-id="dd298-179">Opções para Mesclar Resultados da Consulta</span><span class="sxs-lookup"><span data-stu-id="dd298-179">Options for Merging Query Results</span></span>  
 <span data-ttu-id="dd298-180">Quando uma consulta PLINQ é executada em paralelo, seus resultados de cada thread de trabalho devem ser mesclados de volta para o thread principal para consumo de um loop `foreach` (`For Each` em [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) ou inserção em uma lista ou matriz.</span><span class="sxs-lookup"><span data-stu-id="dd298-180">When a PLINQ query executes in parallel, its results from each worker thread must be merged back onto the main thread for consumption by a `foreach` loop (`For Each` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), or insertion into a list or array.</span></span> <span data-ttu-id="dd298-181">Em alguns casos, ela pode ser útil para especificar um determinado tipo de operação de mesclagem, por exemplo, para começar a produzir resultados mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="dd298-181">In some cases, it might be beneficial to specify a particular kind of merge operation, for example, to begin producing results more quickly.</span></span> <span data-ttu-id="dd298-182">Para essa finalidade, o PLINQ oferece suporte a <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> método e o <xref:System.Linq.ParallelMergeOptions> enumeração.</span><span class="sxs-lookup"><span data-stu-id="dd298-182">For this purpose, PLINQ supports the <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> method, and the <xref:System.Linq.ParallelMergeOptions> enumeration.</span></span> <span data-ttu-id="dd298-183">Para saber mais, veja [Opções de mesclagem em PLINQ](../../../docs/standard/parallel-programming/merge-options-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-183">For more information, see [Merge Options in PLINQ](../../../docs/standard/parallel-programming/merge-options-in-plinq.md).</span></span>  
  
## <a name="the-forall-operator"></a><span data-ttu-id="dd298-184">O Operador ForAll</span><span class="sxs-lookup"><span data-stu-id="dd298-184">The ForAll Operator</span></span>  
 <span data-ttu-id="dd298-185">Em sequencial [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] consultas de execução é adiada até que a consulta é enumerada em uma `foreach` (`For Each` na [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) loop ou por invocação de um método como <xref:System.Linq.ParallelEnumerable.ToList%2A> , <xref:System.Linq.ParallelEnumerable.ToArray%2A> , ou <xref:System.Linq.ParallelEnumerable.ToDictionary%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd298-185">In sequential [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] queries, execution is deferred until the query is enumerated either in a `foreach` (`For Each` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) loop or by invoking a method such as <xref:System.Linq.ParallelEnumerable.ToList%2A> , <xref:System.Linq.ParallelEnumerable.ToArray%2A> , or <xref:System.Linq.ParallelEnumerable.ToDictionary%2A>.</span></span> <span data-ttu-id="dd298-186">Na PLINQ, você também pode usar `foreach` para executar a consulta e percorrer os resultados.</span><span class="sxs-lookup"><span data-stu-id="dd298-186">In PLINQ, you can also use `foreach` to execute the query and iterate through the results.</span></span> <span data-ttu-id="dd298-187">No entanto, `foreach` em si não é executada em paralelo e, portanto, requer que a saída de todas as tarefas paralelas seja mesclada de volta ao thread que está executando o loop.</span><span class="sxs-lookup"><span data-stu-id="dd298-187">However, `foreach` itself does not run in parallel, and therefore, it requires that the output from all parallel tasks be merged back into the thread on which the loop is running.</span></span> <span data-ttu-id="dd298-188">Na PLINQ, você pode usar `foreach` quando tiver de preservar a ordenação final dos resultados da consulta e também sempre que estiver processando os resultados de forma serial, por exemplo, quando estiver chamando `Console.WriteLine` para cada elemento.</span><span class="sxs-lookup"><span data-stu-id="dd298-188">In PLINQ, you can use `foreach` when you must preserve the final ordering of the query results, and also whenever you are processing the results in a serial manner, for example when you are calling `Console.WriteLine` for each element.</span></span> <span data-ttu-id="dd298-189">Para mais rápido execução da consulta quando a preservação da ordem não é necessária e quando o processamento dos resultados poderá próprio paralelização, use o <xref:System.Linq.ParallelEnumerable.ForAll%2A> método para executar uma consulta PLINQ.</span><span class="sxs-lookup"><span data-stu-id="dd298-189">For faster query execution when order preservation is not required and when the processing of the results can itself be parallelized, use the <xref:System.Linq.ParallelEnumerable.ForAll%2A> method to execute a PLINQ query.</span></span> <span data-ttu-id="dd298-190"><xref:System.Linq.ParallelEnumerable.ForAll%2A>não execute esta etapa de mesclagem final.</span><span class="sxs-lookup"><span data-stu-id="dd298-190"><xref:System.Linq.ParallelEnumerable.ForAll%2A> does not perform this final merge step.</span></span> <span data-ttu-id="dd298-191">O exemplo de código a seguir mostra como usar o <xref:System.Linq.ParallelEnumerable.ForAll%2A> método.</span><span class="sxs-lookup"><span data-stu-id="dd298-191">The following code example shows how to use the <xref:System.Linq.ParallelEnumerable.ForAll%2A> method.</span></span> <span data-ttu-id="dd298-192"><xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType>é usado aqui porque ele é otimizado para vários threads simultaneamente adicionando sem tentar remover todos os itens.</span><span class="sxs-lookup"><span data-stu-id="dd298-192"><xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType> is used here because it is optimized for multiple threads adding concurrently without attempting to remove any items.</span></span>  
  
 [!code-csharp[PLINQ#4](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#4)]
 [!code-vb[PLINQ#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#4)]  
  
 <span data-ttu-id="dd298-193">A ilustração a seguir mostra a diferença entre `foreach` e <xref:System.Linq.ParallelEnumerable.ForAll%2A> em relação a execução da consulta.</span><span class="sxs-lookup"><span data-stu-id="dd298-193">The following illustration shows the difference between `foreach` and <xref:System.Linq.ParallelEnumerable.ForAll%2A> with regard to query execution.</span></span>  
  
 <span data-ttu-id="dd298-194">![ForAll vs. ForEach](../../../docs/standard/parallel-programming/media/vs-isvnt-allvseach.png "VS_ISVNT_ALLvsEACH")</span><span class="sxs-lookup"><span data-stu-id="dd298-194">![ForAll vs. ForEach](../../../docs/standard/parallel-programming/media/vs-isvnt-allvseach.png "VS_ISVNT_ALLvsEACH")</span></span>  
  
## <a name="cancellation"></a><span data-ttu-id="dd298-195">Cancelamento</span><span class="sxs-lookup"><span data-stu-id="dd298-195">Cancellation</span></span>  
 <span data-ttu-id="dd298-196">A PLINQ é integrada aos tipos de cancelamento em [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dd298-196">PLINQ is integrated with the cancellation types in [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].</span></span> <span data-ttu-id="dd298-197">(Para saber mais, veja [Cancelamento em threads gerenciados](../../../docs/standard/threading/cancellation-in-managed-threads.md)). Portanto, ao contrário das consultas sequenciais da LINQ to Objects, as consultas PLINQ podem ser canceladas.</span><span class="sxs-lookup"><span data-stu-id="dd298-197">(For more information, see [Cancellation in Managed Threads](../../../docs/standard/threading/cancellation-in-managed-threads.md).) Therefore, unlike sequential LINQ to Objects queries, PLINQ queries can be canceled.</span></span> <span data-ttu-id="dd298-198">Para criar uma consulta PLINQ anulável, use o <xref:System.Linq.ParallelEnumerable.WithCancellation%2A> operador na consulta e fornecer um <xref:System.Threading.CancellationToken> instância como argumento.</span><span class="sxs-lookup"><span data-stu-id="dd298-198">To create a cancelable PLINQ query, use the <xref:System.Linq.ParallelEnumerable.WithCancellation%2A> operator on the query and provide a <xref:System.Threading.CancellationToken> instance as the argument.</span></span> <span data-ttu-id="dd298-199">Quando o <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> propriedade no token é definida como true, PLINQ Observe-lo, pare o processamento de todos os threads e lançar um <xref:System.OperationCanceledException>.</span><span class="sxs-lookup"><span data-stu-id="dd298-199">When the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on the token is set to true, PLINQ will notice it, stop processing on all threads, and throw an <xref:System.OperationCanceledException>.</span></span>  
  
 <span data-ttu-id="dd298-200">É possível que uma consulta PLINQ possa continuar a processar alguns elementos depois que o token de cancelamento é definido.</span><span class="sxs-lookup"><span data-stu-id="dd298-200">It is possible that a PLINQ query might continue to process some elements after the cancellation token is set.</span></span>  
  
 <span data-ttu-id="dd298-201">Para maior capacidade de resposta, você também pode responder a solicitações de cancelamento em representantes do usuário de longa duração.</span><span class="sxs-lookup"><span data-stu-id="dd298-201">For greater responsiveness, you can also respond to cancellation requests in long-running user delegates.</span></span> <span data-ttu-id="dd298-202">Para saber mais, veja [Como cancelar uma consulta PLINQ](../../../docs/standard/parallel-programming/how-to-cancel-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-202">For more information, see [How to: Cancel a PLINQ Query](../../../docs/standard/parallel-programming/how-to-cancel-a-plinq-query.md).</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="dd298-203">Exceções</span><span class="sxs-lookup"><span data-stu-id="dd298-203">Exceptions</span></span>  
 <span data-ttu-id="dd298-204">Quando uma consulta PLINQ é executada, várias exceções podem ser geradas de diversos threads simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="dd298-204">When a PLINQ query executes, multiple exceptions might be thrown from different threads simultaneously.</span></span> <span data-ttu-id="dd298-205">Além disso, o código para tratar a exceção pode estar em um thread diferente do código que gerou a exceção.</span><span class="sxs-lookup"><span data-stu-id="dd298-205">Also, the code to handle the exception might be on a different thread than the code that threw the exception.</span></span> <span data-ttu-id="dd298-206">PLINQ usa o <xref:System.AggregateException> digite para encapsular todas as exceções que foram geradas por uma consulta e empacotar essas exceções para o thread de chamada.</span><span class="sxs-lookup"><span data-stu-id="dd298-206">PLINQ uses the <xref:System.AggregateException> type to encapsulate all the exceptions that were thrown by a query, and marshal those exceptions back to the calling thread.</span></span> <span data-ttu-id="dd298-207">No thread de chamada, apenas um bloco try-catch é necessário.</span><span class="sxs-lookup"><span data-stu-id="dd298-207">On the calling thread, only one try-catch block is required.</span></span> <span data-ttu-id="dd298-208">No entanto, você pode iterar por todas as exceções que são encapsuladas no <xref:System.AggregateException> e detectar qualquer um que você pode recuperar com segurança de.</span><span class="sxs-lookup"><span data-stu-id="dd298-208">However, you can iterate through all of the exceptions that are encapsulated in the <xref:System.AggregateException> and catch any that you can safely recover from.</span></span> <span data-ttu-id="dd298-209">Em casos raros, algumas exceções podem ser geradas que não são encapsuladas em um <xref:System.AggregateException>, e <xref:System.Threading.ThreadAbortException>s também não são encapsulados.</span><span class="sxs-lookup"><span data-stu-id="dd298-209">In rare cases, some exceptions may be thrown that are not wrapped in an <xref:System.AggregateException>, and <xref:System.Threading.ThreadAbortException>s  are also not wrapped.</span></span>  
  
 <span data-ttu-id="dd298-210">Quando as exceções tiverem permissão de emergirem novamente para o thread de associação, então será possível que uma consulta continue a processar alguns itens após a geração da exceção.</span><span class="sxs-lookup"><span data-stu-id="dd298-210">When exceptions are allowed to bubble up back to the joining thread, then it is possible that a query may continue to process some items after the exception is raised.</span></span>  
  
 <span data-ttu-id="dd298-211">Para saber mais, veja [Como tratar exceções em uma consulta PLINQ](../../../docs/standard/parallel-programming/how-to-handle-exceptions-in-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-211">For more information, see [How to: Handle Exceptions in a PLINQ Query](../../../docs/standard/parallel-programming/how-to-handle-exceptions-in-a-plinq-query.md).</span></span>  
  
## <a name="custom-partitioners"></a><span data-ttu-id="dd298-212">Particionadores Personalizados</span><span class="sxs-lookup"><span data-stu-id="dd298-212">Custom Partitioners</span></span>  
 <span data-ttu-id="dd298-213">Em alguns casos, você pode melhorar o desempenho da consulta escrevendo um particionador personalizado que aproveite algumas características da fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="dd298-213">In some cases, you can improve query performance by writing a custom partitioner that takes advantage of some characteristic of the source data.</span></span> <span data-ttu-id="dd298-214">Na consulta, o particionador personalizado em si é o objeto enumerável que será consultado.</span><span class="sxs-lookup"><span data-stu-id="dd298-214">In the query, the custom partitioner itself is the enumerable object that is queried.</span></span>  
  
 [!code-csharp[PLINQ#2](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#2)]
 [!code-vb[PLINQ#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq3.vb#2)]  
  
 <span data-ttu-id="dd298-215">A PLINQ oferece suporte a um número fixo de partições (embora os dados possam ser dinamicamente reatribuídos a essas partições durante o tempo de execução para balanceamento de carga.).</span><span class="sxs-lookup"><span data-stu-id="dd298-215">PLINQ supports a fixed number of partitions (although data may be dynamically reassigned to those partitions during run time for load balancing.).</span></span> <span data-ttu-id="dd298-216"><xref:System.Threading.Tasks.Parallel.For%2A>e <xref:System.Threading.Tasks.Parallel.ForEach%2A> suporte somente o particionamento dinâmico, o que significa que o número de partições alterações em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="dd298-216"><xref:System.Threading.Tasks.Parallel.For%2A> and <xref:System.Threading.Tasks.Parallel.ForEach%2A> support only dynamic partitioning, which means that the number of partitions changes at run time.</span></span> <span data-ttu-id="dd298-217">Para saber mais, veja [Particionadores personalizados para PLINQ e TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-217">For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md).</span></span>  
  
## <a name="measuring-plinq-performance"></a><span data-ttu-id="dd298-218">Medindo Desempenho PLINQ</span><span class="sxs-lookup"><span data-stu-id="dd298-218">Measuring PLINQ Performance</span></span>  
 <span data-ttu-id="dd298-219">Em muitos casos, uma consulta pode ser paralelizada, mas a sobrecarga de configuração de consulta paralela supera o benefício de desempenho obtido.</span><span class="sxs-lookup"><span data-stu-id="dd298-219">In many cases, a query can be parallelized, but the overhead of setting up the parallel query outweighs the performance benefit gained.</span></span> <span data-ttu-id="dd298-220">Se uma consulta não gerar muita computação ou se a fonte de dados for pequena, uma consulta PLINQ poderá ser mais lenta do que uma consulta sequencial LINQ to Objects.</span><span class="sxs-lookup"><span data-stu-id="dd298-220">If a query does not perform much computation or if the data source is small, a PLINQ query may be slower than a sequential LINQ to Objects query.</span></span> <span data-ttu-id="dd298-221">Você pode usar o Analisador de Desempenho Paralelo no Visual Studio Team Server para comparar o desempenho de várias consultas, para localizar afunilamentos de processamento e para determinar se a consulta está em execução em paralelo ou sequencialmente.</span><span class="sxs-lookup"><span data-stu-id="dd298-221">You can use the Parallel Performance Analyzer in Visual Studio Team Server to compare the performance of various queries, to locate processing bottlenecks, and to determine whether your query is running in parallel or sequentially.</span></span> <span data-ttu-id="dd298-222">Para saber mais, veja [Visualizador de Simultaneidade](/visualstudio/profiling/concurrency-visualizer) e [Como medir o Desempenho da Consulta PLINQ](../../../docs/standard/parallel-programming/how-to-measure-plinq-query-performance.md).</span><span class="sxs-lookup"><span data-stu-id="dd298-222">For more information, see [Concurrency Visualizer](/visualstudio/profiling/concurrency-visualizer) and [How to: Measure PLINQ Query Performance](../../../docs/standard/parallel-programming/how-to-measure-plinq-query-performance.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dd298-223">Consulte também</span><span class="sxs-lookup"><span data-stu-id="dd298-223">See Also</span></span>  
 [<span data-ttu-id="dd298-224">PLINQ (LINQ paralelo)</span><span class="sxs-lookup"><span data-stu-id="dd298-224">Parallel LINQ (PLINQ)</span></span>](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)  
 [<span data-ttu-id="dd298-225">Noções básicas sobre agilização no PLINQ</span><span class="sxs-lookup"><span data-stu-id="dd298-225">Understanding Speedup in PLINQ</span></span>](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md)
