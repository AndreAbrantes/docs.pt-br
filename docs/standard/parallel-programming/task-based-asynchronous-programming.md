---
title: Programação assíncrona baseada em tarefas – .NET
description: Neste artigo, saiba mais sobre a programação assíncrona baseada em tarefas por meio da TPL (biblioteca paralela de tarefas) no .NET.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- parallelism, task
ms.assetid: 458b5e69-5210-45e5-bc44-3888f86abd6f
ms.openlocfilehash: a1abe474628cd88e0c24f4152d83bd8ed7ad7950
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94830019"
---
# <a name="task-based-asynchronous-programming"></a><span data-ttu-id="ddb47-103">Programação assíncrona baseada em tarefas</span><span class="sxs-lookup"><span data-stu-id="ddb47-103">Task-based asynchronous programming</span></span>

<span data-ttu-id="ddb47-104">A TPL (Biblioteca de Paralelismo de Tarefas) é baseada no conceito de uma *tarefa*, que representa uma operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="ddb47-104">The Task Parallel Library (TPL) is based on the concept of a *task*, which represents an asynchronous operation.</span></span> <span data-ttu-id="ddb47-105">De certa forma, uma tarefa é semelhante a um thread ou a um item de trabalho <xref:System.Threading.ThreadPool>, mas em um nível mais alto de abstração.</span><span class="sxs-lookup"><span data-stu-id="ddb47-105">In some ways, a task resembles a thread or <xref:System.Threading.ThreadPool> work item, but at a higher level of abstraction.</span></span> <span data-ttu-id="ddb47-106">O termo *paralelismo de tarefas* refere-se a uma ou mais tarefas independentes que são executadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="ddb47-106">The term *task parallelism* refers to one or more independent tasks running concurrently.</span></span> <span data-ttu-id="ddb47-107">As tarefas fornecem dois benefícios principais:</span><span class="sxs-lookup"><span data-stu-id="ddb47-107">Tasks provide two primary benefits:</span></span>

- <span data-ttu-id="ddb47-108">Uso mais eficiente e mais dimensionável de recursos do sistema.</span><span class="sxs-lookup"><span data-stu-id="ddb47-108">More efficient and more scalable use of system resources.</span></span>

     <span data-ttu-id="ddb47-109">Nos bastidores, as tarefas são colocadas na fila <xref:System.Threading.ThreadPool>, a qual foi aprimorada com algoritmos que determinam e se ajustam ao número de segmentos e que fornecem o balanceamento de carga para maximizar o rendimento.</span><span class="sxs-lookup"><span data-stu-id="ddb47-109">Behind the scenes, tasks are queued to the <xref:System.Threading.ThreadPool>, which has been enhanced with algorithms  that determine and adjust to the number of threads and that provide load balancing to maximize throughput.</span></span> <span data-ttu-id="ddb47-110">Isso torna as tarefas relativamente simples, e você pode criar muitas delas para habilitar um paralelismo refinado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-110">This makes tasks relatively lightweight, and you can create many of them to enable fine-grained parallelism.</span></span>

- <span data-ttu-id="ddb47-111">Controle mais programático do que é possível com um thread ou um item de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ddb47-111">More programmatic control than is possible with a thread or work item.</span></span>

     <span data-ttu-id="ddb47-112">As tarefas e a estrutura criada em torno delas fornecem um rico conjunto de APIs que oferecem suporte a espera, cancelamentos, continuações, tratamento de exceções robusto, status detalhado, agendamento personalizado e mais.</span><span class="sxs-lookup"><span data-stu-id="ddb47-112">Tasks and the framework built around them provide a rich set of APIs that support waiting, cancellation, continuations, robust exception handling, detailed status, custom scheduling, and more.</span></span>

<span data-ttu-id="ddb47-113">Por esses dois motivos, a TPL é a API preferida para escrever código multithread, assíncrono e paralelo no .NET.</span><span class="sxs-lookup"><span data-stu-id="ddb47-113">For both of these reasons, TPL is the preferred API for writing multi-threaded, asynchronous, and parallel code in .NET.</span></span>

## <a name="creating-and-running-tasks-implicitly"></a><span data-ttu-id="ddb47-114">Criando e executando tarefas de forma implícita</span><span class="sxs-lookup"><span data-stu-id="ddb47-114">Creating and running tasks implicitly</span></span>

<span data-ttu-id="ddb47-115">O método <xref:System.Threading.Tasks.Parallel.Invoke%2A?displayProperty=nameWithType> fornece uma maneira conveniente de executar simultaneamente um número qualquer de instruções arbitrárias.</span><span class="sxs-lookup"><span data-stu-id="ddb47-115">The <xref:System.Threading.Tasks.Parallel.Invoke%2A?displayProperty=nameWithType> method provides a convenient way to run any number of arbitrary statements concurrently.</span></span> <span data-ttu-id="ddb47-116">Basta passar um delegado <xref:System.Action> para cada item de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ddb47-116">Just pass in an <xref:System.Action> delegate for each item of work.</span></span> <span data-ttu-id="ddb47-117">A maneira mais fácil de criar esses delegados é usar expressões lambda.</span><span class="sxs-lookup"><span data-stu-id="ddb47-117">The easiest way to create these delegates is to use lambda expressions.</span></span> <span data-ttu-id="ddb47-118">A expressão lambda pode chamar um método chamado ou fornecer o código embutido.</span><span class="sxs-lookup"><span data-stu-id="ddb47-118">The lambda expression can either call a named method or provide the code inline.</span></span> <span data-ttu-id="ddb47-119">O exemplo a seguir mostra uma chamada <xref:System.Threading.Tasks.Parallel.Invoke%2A> básica que cria e inicia duas tarefas executadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="ddb47-119">The following example shows a basic <xref:System.Threading.Tasks.Parallel.Invoke%2A> call that creates and starts two tasks that run concurrently.</span></span> <span data-ttu-id="ddb47-120">A primeira tarefa é representada por uma expressão lambda que chama um método denominado `DoSomeWork`. A segunda tarefa é representada por uma expressão lambda que chama um método denominado `DoSomeOtherWork`.</span><span class="sxs-lookup"><span data-stu-id="ddb47-120">The first task is represented by a lambda expression that calls a method named `DoSomeWork`, and the second task is represented by a lambda expression that calls a method named `DoSomeOtherWork`.</span></span>

> [!NOTE]
> <span data-ttu-id="ddb47-121">Esta documentação usa expressões lambda para definir delegados na TLP.</span><span class="sxs-lookup"><span data-stu-id="ddb47-121">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="ddb47-122">Se você não estiver familiarizado com expressões lambda em C# ou Visual Basic, consulte [expressões lambda em PLINQ e TPL](lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-122">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](lambda-expressions-in-plinq-and-tpl.md).</span></span>

[!code-csharp[TPL#21](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl/cs/tpl.cs#21)]
[!code-vb[TPL#21](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl/vb/tpl_vb.vb#21)]

> [!NOTE]
> <span data-ttu-id="ddb47-123">O número de instâncias de <xref:System.Threading.Tasks.Task> que são criadas em segundo plano por <xref:System.Threading.Tasks.Parallel.Invoke%2A> não é necessariamente igual ao número de delegados que são fornecidos.</span><span class="sxs-lookup"><span data-stu-id="ddb47-123">The number of <xref:System.Threading.Tasks.Task> instances that are created behind the scenes by <xref:System.Threading.Tasks.Parallel.Invoke%2A> is not necessarily equal to the number of delegates that are provided.</span></span> <span data-ttu-id="ddb47-124">A TPL pode usar várias otimizações, principalmente com números grandes de delegados.</span><span class="sxs-lookup"><span data-stu-id="ddb47-124">The TPL may employ various optimizations, especially with large numbers of delegates.</span></span>

<span data-ttu-id="ddb47-125">Para obter mais informações, consulte [Como usar Parallel.Invoke para executar operações em paralelo](how-to-use-parallel-invoke-to-execute-parallel-operations.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-125">For more information, see [How to: Use Parallel.Invoke to Execute Parallel Operations](how-to-use-parallel-invoke-to-execute-parallel-operations.md).</span></span>

<span data-ttu-id="ddb47-126">Para obter maior controle sobre a execução da tarefa ou para retornar um valor da tarefa, é necessário trabalhar com objetos <xref:System.Threading.Tasks.Task> de forma mais explícita.</span><span class="sxs-lookup"><span data-stu-id="ddb47-126">For greater control over task execution or to return a value from the task, you have to work with <xref:System.Threading.Tasks.Task> objects more explicitly.</span></span>

## <a name="creating-and-running-tasks-explicitly"></a><span data-ttu-id="ddb47-127">Criando e executando tarefas de forma explícita</span><span class="sxs-lookup"><span data-stu-id="ddb47-127">Creating and running tasks explicitly</span></span>

<span data-ttu-id="ddb47-128">Uma tarefa que não retorna um valor é representada pela classe <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-128">A task that does not return a value is represented by the <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="ddb47-129">Uma tarefa que retorna um valor é representada pela classe <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>, a qual herda de <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-129">A task that returns a value is represented by the <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> class, which inherits from <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="ddb47-130">O objeto da tarefa lida com os detalhes da infraestrutura e fornece métodos e propriedades que são acessíveis a partir do segmento de chamada em todo o tempo de vida da tarefa.</span><span class="sxs-lookup"><span data-stu-id="ddb47-130">The task object handles the infrastructure details and provides methods and properties that are accessible from the calling thread throughout the lifetime of the task.</span></span> <span data-ttu-id="ddb47-131">Por exemplo, você pode acessar a propriedade <xref:System.Threading.Tasks.Task.Status%2A> de uma tarefa a qualquer momento para determinar se ela começou a ser executada, se foi executada até a conclusão, se foi cancelada ou se uma exceção foi gerada.</span><span class="sxs-lookup"><span data-stu-id="ddb47-131">For example, you can access the <xref:System.Threading.Tasks.Task.Status%2A> property of a task at any time to determine whether it has started running, ran to completion, was canceled, or has thrown an exception.</span></span> <span data-ttu-id="ddb47-132">O status é representado por uma enumeração <xref:System.Threading.Tasks.TaskStatus>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-132">The status is represented by a <xref:System.Threading.Tasks.TaskStatus> enumeration.</span></span>

<span data-ttu-id="ddb47-133">Quando você cria uma tarefa, fornece a ela um delegado de usuário que encapsula o código que a tarefa irá executar.</span><span class="sxs-lookup"><span data-stu-id="ddb47-133">When you create a task, you give it a user delegate that encapsulates the code that the task will execute.</span></span> <span data-ttu-id="ddb47-134">O delegado pode ser expresso como um delegado nomeado, um método anônimo ou uma expressão lambda.</span><span class="sxs-lookup"><span data-stu-id="ddb47-134">The delegate can be expressed as a named delegate, an anonymous method, or a lambda expression.</span></span> <span data-ttu-id="ddb47-135">As expressões lambda podem conter uma chamada para um método nomeado, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="ddb47-135">Lambda expressions can contain a call to a named method, as shown in the following example.</span></span> <span data-ttu-id="ddb47-136">Observe que o exemplo inclui uma chamada para o método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> para garantir que a tarefa termine a execução antes do aplicativo de modo console terminar.</span><span class="sxs-lookup"><span data-stu-id="ddb47-136">Note that the example includes a call to the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to ensure that the task completes execution before the console mode application ends.</span></span>

[!code-csharp[TPL_TaskIntro#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/lambda1.cs#1)]
[!code-vb[TPL_TaskIntro#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/lambda1.vb#1)]

<span data-ttu-id="ddb47-137">Você também pode usar os métodos <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> para criar e iniciar uma tarefa em uma única operação.</span><span class="sxs-lookup"><span data-stu-id="ddb47-137">You can also use the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> methods to create and start a task in one operation.</span></span> <span data-ttu-id="ddb47-138">Para gerenciar a tarefa, os métodos <xref:System.Threading.Tasks.Task.Run%2A> usam o agendador de tarefas padrão, independentemente de qual agendador de tarefas é associado ao segmento atual.</span><span class="sxs-lookup"><span data-stu-id="ddb47-138">To manage the task, the <xref:System.Threading.Tasks.Task.Run%2A> methods use the default  task scheduler, regardless of which task scheduler is associated with the current thread.</span></span> <span data-ttu-id="ddb47-139">Os métodos <xref:System.Threading.Tasks.Task.Run%2A> são a maneira preferencial para criar e iniciar tarefas quando mais controle sobre a criação e o agendamento da tarefa não é necessário.</span><span class="sxs-lookup"><span data-stu-id="ddb47-139">The <xref:System.Threading.Tasks.Task.Run%2A> methods are the preferred way to create and start tasks when more control over the creation and scheduling of the task is not needed.</span></span>

[!code-csharp[TPL_TaskIntro#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/run1.cs#2)]
[!code-vb[TPL_TaskIntro#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/run1.vb#2)]

<span data-ttu-id="ddb47-140">Você também pode usar o método <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> para criar e iniciar uma tarefa em uma operação.</span><span class="sxs-lookup"><span data-stu-id="ddb47-140">You can also use the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method to create and start a task in one operation.</span></span> <span data-ttu-id="ddb47-141">Use este método quando a criação e o agendamento não precisarem ser separados e você precisar de opções adicionais de criação de tarefas ou do uso de um agendador específico, ou ainda quando você precisar passar estado adicional na tarefa que você pode recuperar através da propriedade <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType>, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="ddb47-141">Use this method when creation and scheduling do not have to be separated and you require additional task creation options or the use of a specific scheduler, or when you need to pass additional state into the task that you can retrieve through its <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property, as shown in the following example.</span></span>

[!code-csharp[TPL_TaskIntro#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/asyncstate.cs#23)]
[!code-vb[TPL_TaskIntro#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/asyncstate.vb#23)]

<span data-ttu-id="ddb47-142"><xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601> expõem uma propriedade <xref:System.Threading.Tasks.Task.Factory%2A> estática que retorna uma instância padrão de <xref:System.Threading.Tasks.TaskFactory> para que você possa chamar o método como `Task.Factory.StartNew()`.</span><span class="sxs-lookup"><span data-stu-id="ddb47-142"><xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> each expose a static <xref:System.Threading.Tasks.Task.Factory%2A> property that returns a default instance of <xref:System.Threading.Tasks.TaskFactory>, so that you can call the method as `Task.Factory.StartNew()`.</span></span> <span data-ttu-id="ddb47-143">Além disso, no exemplo a seguir, como as tarefas são do tipo <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>, cada uma possui uma propriedade pública <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> que contém o resultado do cálculo.</span><span class="sxs-lookup"><span data-stu-id="ddb47-143">Also, in the following example, because the tasks are of type <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>, they each have a public <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property that contains the result of the computation.</span></span> <span data-ttu-id="ddb47-144">As tarefas são executadas de forma assíncrona e podem ser concluídas em qualquer ordem.</span><span class="sxs-lookup"><span data-stu-id="ddb47-144">The tasks run asynchronously and may complete in any order.</span></span> <span data-ttu-id="ddb47-145">Se a propriedade <xref:System.Threading.Tasks.Task%601.Result%2A> for acessada antes que a computação seja concluída, a propriedade bloqueará o thread de chamada até o valor estar disponível.</span><span class="sxs-lookup"><span data-stu-id="ddb47-145">If the <xref:System.Threading.Tasks.Task%601.Result%2A> property is accessed before the computation finishes, the property blocks the calling thread until the value is available.</span></span>

[!code-csharp[TPL_TaskIntro#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/result1.cs#4)]
[!code-vb[TPL_TaskIntro#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/result1.vb#4)]

<span data-ttu-id="ddb47-146">Para obter mais informações, consulte [Como retornar um valor de uma tarefa](how-to-return-a-value-from-a-task.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-146">For more information, see [How to: Return a Value from a Task](how-to-return-a-value-from-a-task.md).</span></span>

<span data-ttu-id="ddb47-147">Ao usar uma expressão lambda para criar um delegado, você tem acesso a todas as variáveis que são visíveis nesse ponto em seu código-fonte.</span><span class="sxs-lookup"><span data-stu-id="ddb47-147">When you use a lambda expression to create a delegate, you have access to all the variables that are visible at that point in your source code.</span></span> <span data-ttu-id="ddb47-148">No entanto, em alguns casos, especialmente dentro de loops, um lambda não captura a variável conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-148">However, in some cases, most notably within loops, a lambda doesn't capture the variable as expected.</span></span> <span data-ttu-id="ddb47-149">Ele captura somente o valor final, e não o valor no qual ele se transforma após cada iteração.</span><span class="sxs-lookup"><span data-stu-id="ddb47-149">It only captures the final value, not the value as it mutates after each iteration.</span></span> <span data-ttu-id="ddb47-150">O exemplo a seguir ilustra o problema.</span><span class="sxs-lookup"><span data-stu-id="ddb47-150">The following example illustrates the problem.</span></span> <span data-ttu-id="ddb47-151">Ele passa um contador de loops para uma expressão lambda que instancia um objeto `CustomData` e usa o contador de loops como o identificador do objeto.</span><span class="sxs-lookup"><span data-stu-id="ddb47-151">It passes a loop counter to a lambda expression that instantiates a `CustomData` object and uses the loop counter as the object's identifier.</span></span> <span data-ttu-id="ddb47-152">Conforme mostra a saída do exemplo, cada objeto `CustomData` possui um identificador idêntico.</span><span class="sxs-lookup"><span data-stu-id="ddb47-152">As the output from the example shows, each `CustomData` object has an identical identifier.</span></span>

[!code-csharp[TPL_TaskIntro#22](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/iteration1b.cs#22)]
[!code-vb[TPL_TaskIntro#22](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/iteration1b.vb#22)]

<span data-ttu-id="ddb47-153">Você pode acessar o valor em cada iteração ao fornecer um objeto de estado para uma tarefa através do respectivo construtor.</span><span class="sxs-lookup"><span data-stu-id="ddb47-153">You can access the value on each iteration by providing a state object to a task through its constructor.</span></span> <span data-ttu-id="ddb47-154">O exemplo a seguir modifica o exemplo anterior usando o contador de loops ao criar o objeto `CustomData`, que, em seguida, é transmitido para a expressão lambda.</span><span class="sxs-lookup"><span data-stu-id="ddb47-154">The following example modifies the previous example by using the loop counter when creating the `CustomData` object, which, in turn, is passed to the lambda expression.</span></span>  <span data-ttu-id="ddb47-155">Como mostra a saída do exemplo, cada objeto `CustomData` agora tem um identificador exclusivo com base no valor do contador de loops no momento em que o objeto foi instanciado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-155">As the output from the example shows, each `CustomData` object now has a unique identifier based on the value of the loop counter at the time the object was instantiated.</span></span>

[!code-csharp[TPL_TaskIntro#21](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/iteration1a.cs#21)]
[!code-vb[TPL_TaskIntro#21](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/iteration1a.vb#21)]

<span data-ttu-id="ddb47-156">Este estado é transmitido como um argumento para o delegado da tarefa e pode ser acessado do objeto de tarefa via propriedade <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-156">This state is passed as an argument to the task delegate, and it can be accessed from the task object by using the <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="ddb47-157">O exemplo a seguir é uma variação do exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="ddb47-157">The following example is a variation on the previous example.</span></span> <span data-ttu-id="ddb47-158">Ele usa a propriedade <xref:System.Threading.Tasks.Task.AsyncState%2A> para exibir informações sobre os objetos `CustomData` passados para a expressão lambda.</span><span class="sxs-lookup"><span data-stu-id="ddb47-158">It uses the <xref:System.Threading.Tasks.Task.AsyncState%2A> property to display information about the `CustomData` objects passed to the lambda expression.</span></span>

[!code-csharp[TPL_TaskIntro#23](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/asyncstate.cs#23)]
[!code-vb[TPL_TaskIntro#23](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/asyncstate.vb#23)]

## <a name="task-id"></a><span data-ttu-id="ddb47-159">ID da Tarefa</span><span class="sxs-lookup"><span data-stu-id="ddb47-159">Task ID</span></span>

<span data-ttu-id="ddb47-160">Cada tarefa recebe um ID inteiro que a identifica exclusivamente em um domínio de aplicativo e que pode ser acessado pela propriedade <xref:System.Threading.Tasks.Task.Id%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-160">Every task receives an integer ID that uniquely identifies it in an application domain and can be accessed by using the <xref:System.Threading.Tasks.Task.Id%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="ddb47-161">A ID é útil para exibir informações sobre a tarefa nas janelas **Pilhas Paralelas** e **Tarefas** do depurador do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ddb47-161">The ID is useful for viewing task information in the Visual Studio debugger **Parallel Stacks** and **Tasks** windows.</span></span> <span data-ttu-id="ddb47-162">O ID é criado lentamente, o que significa que ele não é criado até que seja solicitado; portanto, uma tarefa pode ter um ID diferente toda vez que o programa é executado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-162">The ID is lazily created, which means that it isn't created until it is requested; therefore, a task may have a different ID every time the program is run.</span></span> <span data-ttu-id="ddb47-163">Para obter mais informações sobre como exibir IDs de tarefa no depurador, consulte [Usando a janela Tarefas](/visualstudio/debugger/using-the-tasks-window) e [Usando a janela Pilhas Paralelas](/visualstudio/debugger/using-the-parallel-stacks-window).</span><span class="sxs-lookup"><span data-stu-id="ddb47-163">For more information about how to view task IDs in the debugger, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window) and [Using the Parallel Stacks Window](/visualstudio/debugger/using-the-parallel-stacks-window).</span></span>

## <a name="task-creation-options"></a><span data-ttu-id="ddb47-164">Opções de criação de tarefa</span><span class="sxs-lookup"><span data-stu-id="ddb47-164">Task creation options</span></span>

<span data-ttu-id="ddb47-165">A maioria das APIs que criam tarefas fornecem sobrecargas que aceitam um parâmetro <xref:System.Threading.Tasks.TaskCreationOptions>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-165">Most APIs that create tasks provide overloads that accept a <xref:System.Threading.Tasks.TaskCreationOptions> parameter.</span></span> <span data-ttu-id="ddb47-166">Ao especificar uma ou mais dessas opções, você informa ao agendador de tarefas como agendar a tarefa no pool de threads.</span><span class="sxs-lookup"><span data-stu-id="ddb47-166">By specifying one or more of these options, you tell the task scheduler how to schedule the task on the thread pool.</span></span> <span data-ttu-id="ddb47-167">As opções podem ser combinadas com o uso de **uma operação or** bit a bit.</span><span class="sxs-lookup"><span data-stu-id="ddb47-167">Options may be combined by using a bitwise **OR** operation.</span></span>

<span data-ttu-id="ddb47-168">O exemplo a seguir mostra uma tarefa que tem <xref:System.Threading.Tasks.TaskCreationOptions.LongRunning> as <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness> Opções e.</span><span class="sxs-lookup"><span data-stu-id="ddb47-168">The following example shows a task that has the <xref:System.Threading.Tasks.TaskCreationOptions.LongRunning> and <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness> options.</span></span>

[!code-csharp[TPL_TaskIntro#03](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/taskintro.cs#03)]
[!code-vb[TPL_TaskIntro#03](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/tpl_intro.vb#03)]

## <a name="tasks-threads-and-culture"></a><span data-ttu-id="ddb47-169">Tarefas, threads e cultura</span><span class="sxs-lookup"><span data-stu-id="ddb47-169">Tasks, threads, and culture</span></span>

<span data-ttu-id="ddb47-170">Cada thread tem uma cultura associada e cultura de interface do usuário, que são definidas pelas <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> <xref:System.Threading.Thread.CurrentUICulture%2A?displayProperty=nameWithType> Propriedades e, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="ddb47-170">Each thread has an associated culture and UI culture, which are defined by the <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> and <xref:System.Threading.Thread.CurrentUICulture%2A?displayProperty=nameWithType> properties, respectively.</span></span> <span data-ttu-id="ddb47-171">A cultura de um thread é usada em operações como formatação, análise, classificação e comparação de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="ddb47-171">A thread's culture is used in such operations as formatting, parsing, sorting, and string comparison.</span></span> <span data-ttu-id="ddb47-172">A cultura de interface do usuário de um thread é usada na pesquisa de recursos.</span><span class="sxs-lookup"><span data-stu-id="ddb47-172">A thread's UI culture is used in resource lookup.</span></span>

<span data-ttu-id="ddb47-173">A menos que você especifique uma cultura padrão para todos os threads em um domínio de aplicativo usando as <xref:System.Globalization.CultureInfo.DefaultThreadCurrentCulture%2A?displayProperty=nameWithType> <xref:System.Globalization.CultureInfo.DefaultThreadCurrentUICulture%2A?displayProperty=nameWithType> Propriedades e, a cultura padrão e a cultura de interface do usuário de um thread são definidas pela cultura do sistema.</span><span class="sxs-lookup"><span data-stu-id="ddb47-173">Unless you specify a default culture for all the threads in an application domain by using the <xref:System.Globalization.CultureInfo.DefaultThreadCurrentCulture%2A?displayProperty=nameWithType> and <xref:System.Globalization.CultureInfo.DefaultThreadCurrentUICulture%2A?displayProperty=nameWithType> properties, the default culture and UI culture of a thread is defined by the system culture.</span></span> <span data-ttu-id="ddb47-174">Se você definir a cultura de um thread de forma explícita e iniciar um novo thread, o novo thread não herdará a cultura do thread de chamada; em vez disso, sua cultura será a cultura padrão do sistema.</span><span class="sxs-lookup"><span data-stu-id="ddb47-174">If you explicitly set a thread's culture and launch a new thread, the new thread does not inherit the culture of the calling thread; instead, its culture is the default system culture.</span></span> <span data-ttu-id="ddb47-175">No entanto, na programação baseada em tarefas, as tarefas usam a cultura do thread de chamada, mesmo que a tarefa seja executada de forma assíncrona em um thread diferente.</span><span class="sxs-lookup"><span data-stu-id="ddb47-175">However, in task-based programming, tasks use the calling thread's culture, even if the task runs asynchronously on a different thread.</span></span>

<span data-ttu-id="ddb47-176">O exemplo a seguir fornece uma ilustração simples.</span><span class="sxs-lookup"><span data-stu-id="ddb47-176">The following example provides a simple illustration.</span></span> <span data-ttu-id="ddb47-177">Ele altera a cultura atual do aplicativo para francês (França) (ou, se francês (França) já for a cultura atual, para inglês (Estados Unidos)).</span><span class="sxs-lookup"><span data-stu-id="ddb47-177">It changes the app's current culture to French (France) (or, if French (France) is already the current culture, to English (United States)).</span></span> <span data-ttu-id="ddb47-178">Depois, ele chama um delegado chamado `formatDelegate` que retorna alguns números formatados como valores de moeda na nova cultura.</span><span class="sxs-lookup"><span data-stu-id="ddb47-178">It then invokes a delegate named `formatDelegate` that returns some numbers formatted as currency values in the new culture.</span></span> <span data-ttu-id="ddb47-179">Se o delegado for invocado por uma tarefa de forma síncrona ou assíncrona, a tarefa usará a cultura do thread de chamada.</span><span class="sxs-lookup"><span data-stu-id="ddb47-179">Whether the delegate is invoked by a task either synchronously or asynchronously, the task uses the culture of the calling thread.</span></span>

:::code language="csharp" source="snippets/cs/asyncculture1.cs" id="1":::

:::code language="vbnet" source="snippets/vb/asyncculture1.vb" id="1":::

> [!NOTE]
> <span data-ttu-id="ddb47-180">Nas versões do .NET Framework antes do .NET Framework 4,6, a cultura de uma tarefa é determinada pela cultura do thread em que ele *é executado*, não pela cultura do *thread de chamada*.</span><span class="sxs-lookup"><span data-stu-id="ddb47-180">In versions of .NET Framework prior to .NET Framework 4.6, a task's culture is determined by the culture of the thread on which it *runs*, not the culture of the *calling thread*.</span></span> <span data-ttu-id="ddb47-181">Para tarefas assíncronas, isso significa que a cultura usada pela tarefa pode ser diferente para a cultura do thread de chamada.</span><span class="sxs-lookup"><span data-stu-id="ddb47-181">For asynchronous tasks, this means the culture used by the task could be different to the calling thread's culture.</span></span>

<span data-ttu-id="ddb47-182">Para saber mais sobre a cultura e tarefas assíncronas, veja a seção “Cultura e operações assíncronas baseadas em tarefas assíncronas” no tópico <xref:System.Globalization.CultureInfo>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-182">For more information on asynchronous tasks and culture, see the "Culture and asynchronous task-based operations" section in the <xref:System.Globalization.CultureInfo> topic.</span></span>

## <a name="creating-task-continuations"></a><span data-ttu-id="ddb47-183">Criando continuações de tarefa</span><span class="sxs-lookup"><span data-stu-id="ddb47-183">Creating task continuations</span></span>

<span data-ttu-id="ddb47-184">Os métodos <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> e <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> permitem que você especifique uma tarefa para iniciar quando a *tarefa antecedente* terminar.</span><span class="sxs-lookup"><span data-stu-id="ddb47-184">The <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> methods let you specify a task to start when the *antecedent task* finishes.</span></span> <span data-ttu-id="ddb47-185">O delegado da tarefa de continuação recebe uma referência à tarefa antecedente para que possa examinar o status da tarefa antecedente e, ao recuperar o valor da propriedade <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>, pode usar a saída do antecedente como entrada para a continuação.</span><span class="sxs-lookup"><span data-stu-id="ddb47-185">The delegate of the continuation task is passed a reference to the antecedent task so that it can examine the antecedent task's status and, by retrieving the value of the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property, can use the output of the antecedent as input for the continuation.</span></span>

<span data-ttu-id="ddb47-186">No exemplo a seguir, a tarefa `getData` é iniciada por uma chamada feita ao método <xref:System.Threading.Tasks.TaskFactory.StartNew%60%601%28System.Func%7B%60%600%7D%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-186">In the following example, the `getData` task is started by a call to the <xref:System.Threading.Tasks.TaskFactory.StartNew%60%601%28System.Func%7B%60%600%7D%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="ddb47-187">A tarefa `processData` é iniciada automaticamente quando `getData` termina, e `displayData` é iniciada quando `processData` termina.</span><span class="sxs-lookup"><span data-stu-id="ddb47-187">The `processData` task is started automatically when `getData` finishes, and `displayData` is started when `processData` finishes.</span></span> <span data-ttu-id="ddb47-188">`getData` produz uma matriz de inteiros que é acessível para a tarefa `processData` por meio da propriedade `getData` da tarefa <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-188">`getData` produces an integer array, which is accessible to the `processData` task through the `getData` task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="ddb47-189">A tarefa `processData` processa a matriz e retorna um resultado cujo tipo é derivado do tipo retornado pela expressão lambda passada ao método <xref:System.Threading.Tasks.Task%601.ContinueWith%60%601%28System.Func%7BSystem.Threading.Tasks.Task%7B%600%7D%2C%60%600%7D%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-189">The `processData` task processes that array and returns a result whose type is inferred from the return type of the lambda expression passed to the <xref:System.Threading.Tasks.Task%601.ContinueWith%60%601%28System.Func%7BSystem.Threading.Tasks.Task%7B%600%7D%2C%60%600%7D%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="ddb47-190">A tarefa `displayData` é executada automaticamente quando `processData` é concluído e o objeto <xref:System.Tuple%603> retornado pela expressão lambda `processData` é acessível para a tarefa de `displayData` através da propriedade `processData` da tarefa <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-190">The `displayData` task executes automatically when `processData` finishes, and the <xref:System.Tuple%603> object returned by the `processData` lambda expression is accessible to the `displayData` task through the `processData` task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="ddb47-191">A tarefa `displayData` recebe o resultado da tarefa `processData` e gera um resultado cujo tipo é inferido de maneira semelhante e que é disponibilizado para o programa na propriedade <xref:System.Threading.Tasks.Task%601.Result%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-191">The `displayData` task takes the result of the `processData` task and produces a result whose type is inferred in a similar manner and which is made available to the program in the <xref:System.Threading.Tasks.Task%601.Result%2A> property.</span></span>

[!code-csharp[TPL_TaskIntro#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/continuations1.cs#5)]
[!code-vb[TPL_TaskIntro#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/continuations1.vb#5)]

<span data-ttu-id="ddb47-192">Como <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> é um método de instância, é possível encadear as chamadas de método juntas em vez de criar uma instância de um objeto de <xref:System.Threading.Tasks.Task%601> para cada tarefa antecedente.</span><span class="sxs-lookup"><span data-stu-id="ddb47-192">Because <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> is an instance method, you can chain method calls together instead of instantiating a <xref:System.Threading.Tasks.Task%601> object for each antecedent task.</span></span> <span data-ttu-id="ddb47-193">O exemplo a seguir é funcionalmente idêntico ao exemplo anterior, exceto que ele encadeia chamadas ao método <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-193">The following example is functionally identical to the previous example, except that it chains together calls to the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="ddb47-194">Observe que o objeto de <xref:System.Threading.Tasks.Task%601> retornado pela cadeia de chamadas de métodos é a tarefa final de continuação.</span><span class="sxs-lookup"><span data-stu-id="ddb47-194">Note that the <xref:System.Threading.Tasks.Task%601> object returned by the chain of method calls is the final continuation task.</span></span>

[!code-csharp[TPL_TaskIntro#24](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/continuations2.cs#24)]
[!code-vb[TPL_TaskIntro#24](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/continuations2.vb#24)]

<span data-ttu-id="ddb47-195">Os métodos <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> e <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> permitem que você continue de várias tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-195">The <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> and <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> methods enable you to continue from multiple tasks.</span></span>

<span data-ttu-id="ddb47-196">Para obter mais informações, consulte [Encadeando tarefas com tarefas de continuação](chaining-tasks-by-using-continuation-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-196">For more information, see [Chaining Tasks by Using Continuation Tasks](chaining-tasks-by-using-continuation-tasks.md).</span></span>

## <a name="creating-detached-child-tasks"></a><span data-ttu-id="ddb47-197">Criando tarefas filho desanexadas</span><span class="sxs-lookup"><span data-stu-id="ddb47-197">Creating detached child tasks</span></span>

<span data-ttu-id="ddb47-198">Quando o código do usuário que está executando em uma tarefa cria uma nova tarefa e não especifica a opção de <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent>, a nova tarefa não é sincronizada com a tarefa pai de nenhuma forma especial.</span><span class="sxs-lookup"><span data-stu-id="ddb47-198">When user code that is running in a task creates a new task and does not specify the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> option, the new task is not synchronized with the parent task in any special way.</span></span> <span data-ttu-id="ddb47-199">Esse tipo de tarefa não sincronizada é chamada de *tarefa aninhada desanexada* ou *tarefa filho desanexada*.</span><span class="sxs-lookup"><span data-stu-id="ddb47-199">This type of non-synchronized task is called a *detached nested task* or *detached child task*.</span></span> <span data-ttu-id="ddb47-200">O exemplo a seguir mostra uma tarefa que cria uma tarefa filha desanexada.</span><span class="sxs-lookup"><span data-stu-id="ddb47-200">The following example shows a task that creates one detached child task.</span></span>

[!code-csharp[TPL_TaskIntro#07](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/taskintro.cs#07)]
[!code-vb[TPL_TaskIntro#07](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/tpl_intro.vb#07)]

<span data-ttu-id="ddb47-201">Observe que a tarefa pai não espera a tarefa filha desanexada terminar.</span><span class="sxs-lookup"><span data-stu-id="ddb47-201">Note that the parent task does not wait for the detached child task to finish.</span></span>

## <a name="creating-child-tasks"></a><span data-ttu-id="ddb47-202">Criando tarefas filho</span><span class="sxs-lookup"><span data-stu-id="ddb47-202">Creating child tasks</span></span>

<span data-ttu-id="ddb47-203">Quando o código de usuário que está sendo executado em uma tarefa cria uma tarefa com a <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> opção, a nova tarefa é conhecida como uma *tarefa filho anexada* da tarefa pai.</span><span class="sxs-lookup"><span data-stu-id="ddb47-203">When user code that is running in a task creates a task with the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> option, the new task is known as an *attached child task* of the parent task.</span></span> <span data-ttu-id="ddb47-204">Você pode usar a opção <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> para expressar o paralelismo estruturado das tarefas, porque a tarefa pai espera implicitamente todas as tarefas filhas anexadas terminarem.</span><span class="sxs-lookup"><span data-stu-id="ddb47-204">You can use the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> option to express structured task parallelism, because the parent task implicitly waits for all attached child tasks to finish.</span></span> <span data-ttu-id="ddb47-205">O exemplo a seguir mostra uma tarefa pai que cria dez tarefas filhas anexadas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-205">The following example shows a parent task that creates ten attached child tasks.</span></span> <span data-ttu-id="ddb47-206">Observe que, embora o exemplo chame o método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> para aguardar que a tarefa pai seja concluída, ele não precisará aguardar explicitamente que as tarefas filhas anexadas sejam concluídas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-206">Note that although the example calls the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to wait for the parent task to finish, it does not have to explicitly wait for the attached child tasks to complete.</span></span>

[!code-csharp[TPL_TaskIntro#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/child1.cs#8)]
[!code-vb[TPL_TaskIntro#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/child1.vb#8)]

<span data-ttu-id="ddb47-207">Uma tarefa pai pode usar a opção <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> para impedir que outras tarefas se anexem à tarefa pai.</span><span class="sxs-lookup"><span data-stu-id="ddb47-207">A parent task can use the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option to prevent other tasks from attaching to the parent task.</span></span> <span data-ttu-id="ddb47-208">Para obter mais informações, consulte [Tarefas filho anexadas e desanexadas](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-208">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="waiting-for-tasks-to-finish"></a><span data-ttu-id="ddb47-209">Aguardando a conclusão das tarefas</span><span class="sxs-lookup"><span data-stu-id="ddb47-209">Waiting for tasks to finish</span></span>

<span data-ttu-id="ddb47-210">Os tipos <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> e <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> fornecem várias sobrecargas dos métodos <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> que permitem aguardar a conclusão de uma tarefa.</span><span class="sxs-lookup"><span data-stu-id="ddb47-210">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> types provide several overloads of the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> methods that enable you to wait for a task to finish.</span></span> <span data-ttu-id="ddb47-211">Além disso, as sobrecargas dos métodos estáticos <xref:System.Threading.Tasks.Task.WaitAll%2A?displayProperty=nameWithType> e <xref:System.Threading.Tasks.Task.WaitAny%2A?displayProperty=nameWithType> permitem que você aguarde a conclusão de qualquer uma ou de todas as matrizes de tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-211">In addition, overloads of the static <xref:System.Threading.Tasks.Task.WaitAll%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WaitAny%2A?displayProperty=nameWithType> methods let you wait for any or all of an array of tasks to finish.</span></span>

<span data-ttu-id="ddb47-212">Normalmente, você esperaria uma tarefa por um destes motivos:</span><span class="sxs-lookup"><span data-stu-id="ddb47-212">Typically, you would wait for a task for one of these reasons:</span></span>

- <span data-ttu-id="ddb47-213">O thread principal depende do resultado final calculado por uma tarefa.</span><span class="sxs-lookup"><span data-stu-id="ddb47-213">The main thread depends on the final result computed by a task.</span></span>

- <span data-ttu-id="ddb47-214">Você precisa tratar exceções que podem ser geradas pela tarefa.</span><span class="sxs-lookup"><span data-stu-id="ddb47-214">You have to handle exceptions that might be thrown from the task.</span></span>

- <span data-ttu-id="ddb47-215">O aplicativo pode terminar antes que todas as tarefas concluam a execução.</span><span class="sxs-lookup"><span data-stu-id="ddb47-215">The application may terminate before all tasks have completed execution.</span></span> <span data-ttu-id="ddb47-216">Por exemplo, aplicativos de console terminarão assim que todos os códigos síncronos em `Main` (o ponto de entrada do aplicativo) tiverem sido executados.</span><span class="sxs-lookup"><span data-stu-id="ddb47-216">For example, console applications will terminate as soon as all synchronous code in `Main` (the application entry point) has executed.</span></span>

<span data-ttu-id="ddb47-217">O exemplo a seguir mostra o padrão básico que não envolve tratamento de exceções.</span><span class="sxs-lookup"><span data-stu-id="ddb47-217">The following example shows the basic pattern that does not involve exception handling.</span></span>

[!code-csharp[TPL_TaskIntro#06](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/taskintro.cs#06)]
[!code-vb[TPL_TaskIntro#06](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/tpl_intro.vb#06)]

<span data-ttu-id="ddb47-218">Para obter um exemplo que mostra o tratamento de exceções, consulte [Tratamento de exceções](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-218">For an example that shows exception handling, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

<span data-ttu-id="ddb47-219">Algumas sobrecargas permitem especificar um tempo limite, e outras usam um <xref:System.Threading.CancellationToken> adicional como um parâmetro de entrada para que a espera possa ser cancelada programaticamente ou em resposta a uma entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="ddb47-219">Some overloads let you specify a time-out, and others take an additional <xref:System.Threading.CancellationToken> as an input parameter, so that the wait itself can be canceled either programmatically or in response to user input.</span></span>

<span data-ttu-id="ddb47-220">Ao aguardar uma tarefa, você espera implicitamente todas as filhos da tarefa que foram criadas usando a opção <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-220">When you wait for a task, you implicitly wait for all children of that task that were created by using the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option.</span></span> <span data-ttu-id="ddb47-221"><xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> retorna imediatamente se a tarefa já foi concluída.</span><span class="sxs-lookup"><span data-stu-id="ddb47-221"><xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> returns immediately if the task has already completed.</span></span> <span data-ttu-id="ddb47-222">Todas as exceções geradas por uma tarefa serão geradas por um método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType>, mesmo se o método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> tiver sido chamado após o término da tarefa.</span><span class="sxs-lookup"><span data-stu-id="ddb47-222">Any exceptions raised by a task will be thrown by a <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method, even if the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method was called after the task completed.</span></span>

## <a name="composing-tasks"></a><span data-ttu-id="ddb47-223">Compondo tarefas</span><span class="sxs-lookup"><span data-stu-id="ddb47-223">Composing tasks</span></span>

<span data-ttu-id="ddb47-224">As classes <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601> fornecem vários métodos que podem ajudá-lo na composição de várias tarefas para implementar padrões comuns e melhorar o uso dos recursos de linguagem assíncronos que são fornecidos por C#, Visual Basic e F#.</span><span class="sxs-lookup"><span data-stu-id="ddb47-224">The <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> classes provide several methods that can help you compose multiple tasks to implement common patterns and to better use the asynchronous language features that are provided by C#, Visual Basic, and F#.</span></span> <span data-ttu-id="ddb47-225">Esta seção descreve os métodos <xref:System.Threading.Tasks.Task.WhenAll%2A>, <xref:System.Threading.Tasks.Task.WhenAny%2A>, <xref:System.Threading.Tasks.Task.Delay%2A> e <xref:System.Threading.Tasks.Task.FromResult%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-225">This section describes the <xref:System.Threading.Tasks.Task.WhenAll%2A>, <xref:System.Threading.Tasks.Task.WhenAny%2A>, <xref:System.Threading.Tasks.Task.Delay%2A>, and <xref:System.Threading.Tasks.Task.FromResult%2A> methods.</span></span>

### <a name="taskwhenall"></a><span data-ttu-id="ddb47-226">Task.WhenAll</span><span class="sxs-lookup"><span data-stu-id="ddb47-226">Task.WhenAll</span></span>

<span data-ttu-id="ddb47-227">O método <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> espera assincronamente a conclusão de vários objetos <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-227">The <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method asynchronously waits for multiple <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to finish.</span></span> <span data-ttu-id="ddb47-228">Ele fornece versões sobrecarregadas que permitem aguardar conjuntos não uniformes de tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-228">It provides overloaded versions that enable you to wait for non-uniform sets of tasks.</span></span> <span data-ttu-id="ddb47-229">Por exemplo, você pode aguardar vários objetos <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601> para concluir após uma chamada de método.</span><span class="sxs-lookup"><span data-stu-id="ddb47-229">For example, you can wait for multiple <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects to complete from one method call.</span></span>

### <a name="taskwhenany"></a><span data-ttu-id="ddb47-230">Task.WhenAny</span><span class="sxs-lookup"><span data-stu-id="ddb47-230">Task.WhenAny</span></span>

<span data-ttu-id="ddb47-231">O método <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> espera assincronamente a conclusão de um de vários objetos <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-231">The <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> method asynchronously waits for one of multiple <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to finish.</span></span> <span data-ttu-id="ddb47-232">Assim como no método <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>, esse método oferece as versões sobrecarregadas que permitem aguardar conjuntos não uniformes de tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-232">As in the <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method, this method provides overloaded versions that enable you to wait for non-uniform sets of tasks.</span></span> <span data-ttu-id="ddb47-233">O método <xref:System.Threading.Tasks.Task.WhenAny%2A> é especialmente útil nos cenários a seguir.</span><span class="sxs-lookup"><span data-stu-id="ddb47-233">The <xref:System.Threading.Tasks.Task.WhenAny%2A> method is especially useful in the following scenarios.</span></span>

- <span data-ttu-id="ddb47-234">Operações redundantes.</span><span class="sxs-lookup"><span data-stu-id="ddb47-234">Redundant operations.</span></span> <span data-ttu-id="ddb47-235">Considere um algoritmo ou uma operação que possam ser executados de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="ddb47-235">Consider an algorithm or operation that can be performed in many ways.</span></span> <span data-ttu-id="ddb47-236">Você pode usar o método <xref:System.Threading.Tasks.Task.WhenAny%2A> para selecionar a operação que termina primeiro e então cancelar as operações restantes.</span><span class="sxs-lookup"><span data-stu-id="ddb47-236">You can use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to select the operation that finishes first and then cancel the remaining operations.</span></span>

- <span data-ttu-id="ddb47-237">Operações intercaladas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-237">Interleaved operations.</span></span> <span data-ttu-id="ddb47-238">Você pode iniciar várias operações que todos devem concluir e usar o método <xref:System.Threading.Tasks.Task.WhenAny%2A> para processar resultados à medida que cada operação termina.</span><span class="sxs-lookup"><span data-stu-id="ddb47-238">You can start multiple operations that must all finish and use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to process results as each operation finishes.</span></span> <span data-ttu-id="ddb47-239">Após uma operação ser concluída, você poderá começar uma ou mais tarefas adicionais.</span><span class="sxs-lookup"><span data-stu-id="ddb47-239">After one operation finishes, you can start one or more additional tasks.</span></span>

- <span data-ttu-id="ddb47-240">Operações controladas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-240">Throttled operations.</span></span> <span data-ttu-id="ddb47-241">Você pode usar o método <xref:System.Threading.Tasks.Task.WhenAny%2A> para estender o cenário anterior ao limitar o número de operações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-241">You can use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to extend the previous scenario by limiting the number of concurrent operations.</span></span>

- <span data-ttu-id="ddb47-242">Operações expiradas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-242">Expired operations.</span></span> <span data-ttu-id="ddb47-243">Você pode usar o método <xref:System.Threading.Tasks.Task.WhenAny%2A> para selecionar entre uma ou mais tarefas e uma tarefa que termine após uma hora específica, como uma tarefa que é retornada pelo método <xref:System.Threading.Tasks.Task.Delay%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-243">You can use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to select between one or more tasks and a task that finishes after a specific time, such as a task that is returned by the <xref:System.Threading.Tasks.Task.Delay%2A> method.</span></span> <span data-ttu-id="ddb47-244">O método <xref:System.Threading.Tasks.Task.Delay%2A> é descrito na seção a seguir.</span><span class="sxs-lookup"><span data-stu-id="ddb47-244">The <xref:System.Threading.Tasks.Task.Delay%2A> method is described in the following section.</span></span>

### <a name="taskdelay"></a><span data-ttu-id="ddb47-245">Task.Delay</span><span class="sxs-lookup"><span data-stu-id="ddb47-245">Task.Delay</span></span>

<span data-ttu-id="ddb47-246">O método <xref:System.Threading.Tasks.Task.Delay%2A?displayProperty=nameWithType> gera um objeto <xref:System.Threading.Tasks.Task> que se encerra após o tempo especificado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-246">The <xref:System.Threading.Tasks.Task.Delay%2A?displayProperty=nameWithType> method produces a <xref:System.Threading.Tasks.Task> object that finishes after the specified time.</span></span> <span data-ttu-id="ddb47-247">Você pode usar esse método para compilar os loop que, ocasionalmente, procuram dados, introduzem tempos limites, atrasam manipulação de entrada do usuário por um período pré-determinado e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="ddb47-247">You can use this method to build loops that occasionally poll for data, introduce time-outs, delay the handling of user input for a predetermined time, and so on.</span></span>

### <a name="tasktfromresult"></a><span data-ttu-id="ddb47-248">Task(T).FromResult</span><span class="sxs-lookup"><span data-stu-id="ddb47-248">Task(T).FromResult</span></span>

<span data-ttu-id="ddb47-249">Ao usar o método <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType>, você pode criar um objeto <xref:System.Threading.Tasks.Task%601> com um resultado pré-calculado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-249">By using the <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType> method, you can create a <xref:System.Threading.Tasks.Task%601> object that holds a pre-computed result.</span></span> <span data-ttu-id="ddb47-250">Este método é útil quando você executa uma operação assíncrona que retorna um objeto <xref:System.Threading.Tasks.Task%601> e o resultado do objeto <xref:System.Threading.Tasks.Task%601> já está calculado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-250">This method is useful when you perform an asynchronous operation that returns a <xref:System.Threading.Tasks.Task%601> object, and the result of that <xref:System.Threading.Tasks.Task%601> object is already computed.</span></span> <span data-ttu-id="ddb47-251">Para obter um exemplo que use <xref:System.Threading.Tasks.Task.FromResult%2A> para recuperar os resultados de operações de download assíncronas mantidas em um cache, veja [Como criar tarefas pré-computadas](how-to-create-pre-computed-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-251">For an example that uses <xref:System.Threading.Tasks.Task.FromResult%2A> to retrieve the results of asynchronous download operations that are held in a cache, see [How to: Create Pre-Computed Tasks](how-to-create-pre-computed-tasks.md).</span></span>

## <a name="handling-exceptions-in-tasks"></a><span data-ttu-id="ddb47-252">Tratando exceções em tarefas</span><span class="sxs-lookup"><span data-stu-id="ddb47-252">Handling exceptions in tasks</span></span>

<span data-ttu-id="ddb47-253">Quando uma tarefa gera uma ou mais exceções, as exceções são envolvidas em uma exceção <xref:System.AggregateException>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-253">When a task throws one or more exceptions, the exceptions are wrapped in an <xref:System.AggregateException> exception.</span></span> <span data-ttu-id="ddb47-254">Essa exceção é propagada de volta para o thread que se associa à tarefa, que normalmente é o thread que está aguardando a conclusão da tarefa ou o thread que acessa a propriedade <xref:System.Threading.Tasks.Task%601.Result%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-254">That exception is propagated back to the thread that joins with the task, which is typically the thread that is waiting for the task to finish or the thread that accesses the <xref:System.Threading.Tasks.Task%601.Result%2A> property.</span></span> <span data-ttu-id="ddb47-255">Esse comportamento serve para impor a política do .NET Framework de que todas as exceções sem tratamento devem, por padrão, encerrar o processo.</span><span class="sxs-lookup"><span data-stu-id="ddb47-255">This behavior serves to enforce the .NET Framework policy that all unhandled exceptions by default should terminate the process.</span></span> <span data-ttu-id="ddb47-256">O código de chamada pode tratar as exceções usando uma destas opções em um bloco `try`/`catch`:</span><span class="sxs-lookup"><span data-stu-id="ddb47-256">The calling code can handle the exceptions by using any of the following in a `try`/`catch` block:</span></span>

- <span data-ttu-id="ddb47-257">O método <xref:System.Threading.Tasks.Task.Wait%2A></span><span class="sxs-lookup"><span data-stu-id="ddb47-257">The <xref:System.Threading.Tasks.Task.Wait%2A> method</span></span>

- <span data-ttu-id="ddb47-258">O método <xref:System.Threading.Tasks.Task.WaitAll%2A></span><span class="sxs-lookup"><span data-stu-id="ddb47-258">The <xref:System.Threading.Tasks.Task.WaitAll%2A> method</span></span>

- <span data-ttu-id="ddb47-259">O método <xref:System.Threading.Tasks.Task.WaitAny%2A></span><span class="sxs-lookup"><span data-stu-id="ddb47-259">The <xref:System.Threading.Tasks.Task.WaitAny%2A> method</span></span>

- <span data-ttu-id="ddb47-260">A propriedade <xref:System.Threading.Tasks.Task%601.Result%2A></span><span class="sxs-lookup"><span data-stu-id="ddb47-260">The <xref:System.Threading.Tasks.Task%601.Result%2A> property</span></span>

<span data-ttu-id="ddb47-261">O thread de associação também pode manipular exceções ao acessar a propriedade <xref:System.Threading.Tasks.Task.Exception%2A> antes que a tarefa seja coletada pela lixeira.</span><span class="sxs-lookup"><span data-stu-id="ddb47-261">The joining thread can also handle exceptions by accessing the <xref:System.Threading.Tasks.Task.Exception%2A> property before the task is garbage-collected.</span></span> <span data-ttu-id="ddb47-262">Ao acessar essa propriedade, você impede que a exceção sem tratamento dispare o comportamento de propagação de exceção que finaliza o processo quando o objeto é encerrado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-262">By accessing this property, you prevent the unhandled exception from triggering the exception propagation behavior that terminates the process when the object is finalized.</span></span>

<span data-ttu-id="ddb47-263">Para obter mais informações sobre exceções e tarefas, consulte [Tratamento de exceções](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-263">For more information about exceptions and tasks, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

## <a name="canceling-tasks"></a><span data-ttu-id="ddb47-264">Cancelando tarefas</span><span class="sxs-lookup"><span data-stu-id="ddb47-264">Canceling tasks</span></span>

<span data-ttu-id="ddb47-265">A classe <xref:System.Threading.Tasks.Task> oferece suporte ao cancelamento cooperativo e é totalmente integrada às classes <xref:System.Threading.CancellationTokenSource?displayProperty=nameWithType> e <xref:System.Threading.CancellationToken?displayProperty=nameWithType>, as quais foram introduzidas no .NET Framework 4.</span><span class="sxs-lookup"><span data-stu-id="ddb47-265">The <xref:System.Threading.Tasks.Task> class supports cooperative cancellation and is fully integrated with the <xref:System.Threading.CancellationTokenSource?displayProperty=nameWithType> and <xref:System.Threading.CancellationToken?displayProperty=nameWithType> classes, which were introduced in the .NET Framework 4.</span></span> <span data-ttu-id="ddb47-266">Muitos dos construtores na classe <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> recebem um objeto <xref:System.Threading.CancellationToken> como um parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="ddb47-266">Many of the constructors in the <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> class take a <xref:System.Threading.CancellationToken> object as an input parameter.</span></span> <span data-ttu-id="ddb47-267">Várias das sobrecargas <xref:System.Threading.Tasks.TaskFactory.StartNew%2A> e <xref:System.Threading.Tasks.Task.Run%2A> também incluem um parâmetro <xref:System.Threading.CancellationToken>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-267">Many of the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A> and <xref:System.Threading.Tasks.Task.Run%2A> overloads also include a <xref:System.Threading.CancellationToken> parameter.</span></span>

<span data-ttu-id="ddb47-268">Você pode criar o token e enviar a solicitação de cancelamento algum tempo depois usando a classe <xref:System.Threading.CancellationTokenSource>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-268">You can create the token, and issue the cancellation request at some later time, by using the <xref:System.Threading.CancellationTokenSource> class.</span></span> <span data-ttu-id="ddb47-269">Passe o token para <xref:System.Threading.Tasks.Task> como um argumento e também referencie o mesmo token em seu delegado de usuário, o qual faz o trabalho de responder a uma solicitação de cancelamento.</span><span class="sxs-lookup"><span data-stu-id="ddb47-269">Pass the token to the <xref:System.Threading.Tasks.Task> as an argument, and also reference the same token in your user delegate, which does the work of responding to a cancellation request.</span></span>

<span data-ttu-id="ddb47-270">Para obter mais informações, consulte [Cancelamento de tarefas](task-cancellation.md) e [Como cancelar uma tarefa e seus filhos](how-to-cancel-a-task-and-its-children.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-270">For more information, see [Task Cancellation](task-cancellation.md) and [How to: Cancel a Task and Its Children](how-to-cancel-a-task-and-its-children.md).</span></span>

## <a name="the-taskfactory-class"></a><span data-ttu-id="ddb47-271">A classe TaskFactory</span><span class="sxs-lookup"><span data-stu-id="ddb47-271">The TaskFactory class</span></span>

<span data-ttu-id="ddb47-272">A classe <xref:System.Threading.Tasks.TaskFactory> fornece métodos estáticos que encapsulam alguns padrões comuns para criar e iniciar tarefas e tarefas de continuação de linha.</span><span class="sxs-lookup"><span data-stu-id="ddb47-272">The <xref:System.Threading.Tasks.TaskFactory> class provides static methods that encapsulate some common patterns for creating and starting tasks and continuation tasks.</span></span>

- <span data-ttu-id="ddb47-273">O padrão mais comum é <xref:System.Threading.Tasks.TaskFactory.StartNew%2A>, que cria e inicia uma tarefa em uma instrução.</span><span class="sxs-lookup"><span data-stu-id="ddb47-273">The most common pattern is <xref:System.Threading.Tasks.TaskFactory.StartNew%2A>, which creates and starts a task in one statement.</span></span>

- <span data-ttu-id="ddb47-274">Quando você cria tarefas de continuação de vários antecedentes, use o método <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> ou o método <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> ou seus equivalentes na classe <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-274">When you create continuation tasks from multiple antecedents, use the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> method or <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> method or their equivalents in the <xref:System.Threading.Tasks.Task%601> class.</span></span> <span data-ttu-id="ddb47-275">Para obter mais informações, consulte [Encadeando tarefas com tarefas de continuação](chaining-tasks-by-using-continuation-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-275">For more information, see [Chaining Tasks by Using Continuation Tasks](chaining-tasks-by-using-continuation-tasks.md).</span></span>

- <span data-ttu-id="ddb47-276">Para encapsular os métodos `BeginX` e `EndX` do modelo de programação assíncrona em uma instância de <xref:System.Threading.Tasks.Task> ou de <xref:System.Threading.Tasks.Task%601>, use os métodos <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-276">To encapsulate Asynchronous Programming Model `BeginX` and `EndX` methods in a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> instance, use the <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A> methods.</span></span> <span data-ttu-id="ddb47-277">Para obter mais informações, consulte [Programação assíncrona do .NET Framework tradicional e TPL](tpl-and-traditional-async-programming.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-277">For more information, see [TPL and Traditional .NET Framework Asynchronous Programming](tpl-and-traditional-async-programming.md).</span></span>

<span data-ttu-id="ddb47-278">O <xref:System.Threading.Tasks.TaskFactory> padrão pode ser acessado como uma propriedade estática na classe <xref:System.Threading.Tasks.Task> ou na classe <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-278">The default <xref:System.Threading.Tasks.TaskFactory> can be accessed as a static property on the <xref:System.Threading.Tasks.Task> class or <xref:System.Threading.Tasks.Task%601> class.</span></span> <span data-ttu-id="ddb47-279">Você também pode criar uma instância <xref:System.Threading.Tasks.TaskFactory> diretamente e especificar várias opções que incluem <xref:System.Threading.CancellationToken>, uma opção <xref:System.Threading.Tasks.TaskCreationOptions>, uma opção <xref:System.Threading.Tasks.TaskContinuationOptions> ou um <xref:System.Threading.Tasks.TaskScheduler>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-279">You can also instantiate a <xref:System.Threading.Tasks.TaskFactory> directly and specify various options that include a <xref:System.Threading.CancellationToken>, a <xref:System.Threading.Tasks.TaskCreationOptions> option, a <xref:System.Threading.Tasks.TaskContinuationOptions> option, or a <xref:System.Threading.Tasks.TaskScheduler>.</span></span> <span data-ttu-id="ddb47-280">As opções especificadas quando você cria a fábrica de tarefas serão aplicadas a todas as tarefas criadas por ela, a menos que <xref:System.Threading.Tasks.Task> seja criada usando a enumeração <xref:System.Threading.Tasks.TaskCreationOptions>. Nesse caso, as opções de tarefa substituem as da fábrica de tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-280">Whatever options are specified when you create the task factory will be applied to all tasks that it creates, unless the <xref:System.Threading.Tasks.Task> is created by using the <xref:System.Threading.Tasks.TaskCreationOptions> enumeration, in which case the task's options override those of the task factory.</span></span>

## <a name="tasks-without-delegates"></a><span data-ttu-id="ddb47-281">Tarefas sem representantes</span><span class="sxs-lookup"><span data-stu-id="ddb47-281">Tasks without delegates</span></span>

<span data-ttu-id="ddb47-282">Em alguns casos, convém usar <xref:System.Threading.Tasks.Task> para encapsular qualquer operação assíncrona executada por um componente externo em vez de seu próprio delegado de usuário.</span><span class="sxs-lookup"><span data-stu-id="ddb47-282">In some cases, you may want to use a <xref:System.Threading.Tasks.Task> to encapsulate some asynchronous operation that is performed by an external component instead of your own user delegate.</span></span> <span data-ttu-id="ddb47-283">Se a operação for baseada no padrão Begin/End do modelo de programação assíncrona, você poderá usar os métodos <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-283">If the operation is based on the Asynchronous Programming Model Begin/End pattern, you can use the <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A> methods.</span></span> <span data-ttu-id="ddb47-284">Se esse não for o caso, você poderá usar o objeto <xref:System.Threading.Tasks.TaskCompletionSource%601> para envolver a operação em uma tarefa e obter assim alguns benefícios de programabilidade <xref:System.Threading.Tasks.Task>, por exemplo, suporte a propagação e continuações de exceção.</span><span class="sxs-lookup"><span data-stu-id="ddb47-284">If that is not the case, you can use the <xref:System.Threading.Tasks.TaskCompletionSource%601> object to wrap the operation in a task and thereby gain some of the benefits of <xref:System.Threading.Tasks.Task> programmability, for example, support for exception propagation and continuations.</span></span> <span data-ttu-id="ddb47-285">Para obter mais informações, consulte <xref:System.Threading.Tasks.TaskCompletionSource%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-285">For more information, see <xref:System.Threading.Tasks.TaskCompletionSource%601>.</span></span>

## <a name="custom-schedulers"></a><span data-ttu-id="ddb47-286">Agendadores personalizados</span><span class="sxs-lookup"><span data-stu-id="ddb47-286">Custom schedulers</span></span>

<span data-ttu-id="ddb47-287">A maioria dos desenvolvedores de aplicativos ou bibliotecas não se importa com o processador em que a tarefa é executada, como ele sincroniza seu trabalho com outras tarefas e como ela é agendada em <xref:System.Threading.ThreadPool?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-287">Most application or library developers do not care which processor the task runs on, how it synchronizes its work with other tasks, or how it is scheduled on the <xref:System.Threading.ThreadPool?displayProperty=nameWithType>.</span></span> <span data-ttu-id="ddb47-288">Eles apenas exigem que ela seja executada da maneira mais eficiente possível no computador host.</span><span class="sxs-lookup"><span data-stu-id="ddb47-288">They only require that it execute as efficiently as possible on the host computer.</span></span> <span data-ttu-id="ddb47-289">Se você exigir um controle mais aguçado sobre os detalhes de programação, a Biblioteca Paralela de Tarefas permite definir algumas configurações no agendador de tarefas padrão e permite até mesmo fornecer um agendador personalizado.</span><span class="sxs-lookup"><span data-stu-id="ddb47-289">If you require more fine-grained control over the scheduling details, the Task Parallel Library lets you configure some settings on the default task scheduler, and even lets you supply a custom scheduler.</span></span> <span data-ttu-id="ddb47-290">Para obter mais informações, consulte <xref:System.Threading.Tasks.TaskScheduler>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-290">For more information, see <xref:System.Threading.Tasks.TaskScheduler>.</span></span>

## <a name="related-data-structures"></a><span data-ttu-id="ddb47-291">Estruturas de dados relacionados</span><span class="sxs-lookup"><span data-stu-id="ddb47-291">Related data structures</span></span>

<span data-ttu-id="ddb47-292">A TPL possui vários novos tipos públicos que são úteis em cenários paralelos e sequenciais.</span><span class="sxs-lookup"><span data-stu-id="ddb47-292">The TPL has several new public types that are useful in both parallel and sequential scenarios.</span></span> <span data-ttu-id="ddb47-293">Esses incluem várias classes de coleção thread-safe, rápida e dimensionável no namespace <xref:System.Collections.Concurrent?displayProperty=nameWithType>, e vários novos tipos de sincronização, por exemplo, <xref:System.Threading.Semaphore?displayProperty=nameWithType> e <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType>, que são mais eficientes do que seus antecessores para tipos específicos de cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ddb47-293">These include several thread-safe, fast and scalable collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, and several new synchronization types, for example, <xref:System.Threading.Semaphore?displayProperty=nameWithType> and <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType>, which are more efficient than their predecessors for specific kinds of workloads.</span></span> <span data-ttu-id="ddb47-294">Outros novos tipos no .NET Framework 4, por exemplo, <xref:System.Threading.Barrier?displayProperty=nameWithType> e <xref:System.Threading.SpinLock?displayProperty=nameWithType>, fornecem a funcionalidade que não estava disponível em versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="ddb47-294">Other new types in the .NET Framework 4, for example, <xref:System.Threading.Barrier?displayProperty=nameWithType> and <xref:System.Threading.SpinLock?displayProperty=nameWithType>, provide functionality that was not available in earlier releases.</span></span> <span data-ttu-id="ddb47-295">Para obter mais informações, consulte [Estruturas de dados para programação paralela](data-structures-for-parallel-programming.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-295">For more information, see [Data Structures for Parallel Programming](data-structures-for-parallel-programming.md).</span></span>

## <a name="custom-task-types"></a><span data-ttu-id="ddb47-296">Tipos de tarefa personalizados</span><span class="sxs-lookup"><span data-stu-id="ddb47-296">Custom task types</span></span>

<span data-ttu-id="ddb47-297">Recomendamos que você não herde de <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> ou de <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-297">We recommend that you do not inherit from <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>.</span></span> <span data-ttu-id="ddb47-298">Em vez disso, recomenda-se usar a propriedade <xref:System.Threading.Tasks.Task.AsyncState%2A> para associar dados adicionais ou o estado a um objeto <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-298">Instead, we recommend that you use the <xref:System.Threading.Tasks.Task.AsyncState%2A> property to associate additional data or state with a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> object.</span></span> <span data-ttu-id="ddb47-299">Você também pode usar os métodos de extensão para estender a funcionalidade de <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-299">You can also use extension methods to extend the functionality of the <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> classes.</span></span> <span data-ttu-id="ddb47-300">Para obter mais informações sobre métodos de extensão, consulte [Métodos de extensão](../../csharp/programming-guide/classes-and-structs/extension-methods.md) e [Métodos de extensão](../../visual-basic/programming-guide/language-features/procedures/extension-methods.md).</span><span class="sxs-lookup"><span data-stu-id="ddb47-300">For more information about extension methods, see [Extension Methods](../../csharp/programming-guide/classes-and-structs/extension-methods.md) and [Extension Methods](../../visual-basic/programming-guide/language-features/procedures/extension-methods.md).</span></span>

<span data-ttu-id="ddb47-301">Se você deve herdar de <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601> , não é possível usar <xref:System.Threading.Tasks.Task.Run%2A> , ou as <xref:System.Threading.Tasks.TaskFactory?displayProperty=nameWithType> <xref:System.Threading.Tasks.TaskFactory%601?displayProperty=nameWithType> classes, ou <xref:System.Threading.Tasks.TaskCompletionSource%601?displayProperty=nameWithType> para criar instâncias de seu tipo de tarefa personalizada porque esses mecanismos criam apenas <xref:System.Threading.Tasks.Task> <xref:System.Threading.Tasks.Task%601> objetos e.</span><span class="sxs-lookup"><span data-stu-id="ddb47-301">If you must inherit from <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, you cannot use <xref:System.Threading.Tasks.Task.Run%2A>, or the <xref:System.Threading.Tasks.TaskFactory?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskFactory%601?displayProperty=nameWithType>, or <xref:System.Threading.Tasks.TaskCompletionSource%601?displayProperty=nameWithType> classes to create instances of your custom task type because these mechanisms create only <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects.</span></span> <span data-ttu-id="ddb47-302">Além disso, você não pode usar os mecanismos de continuação de tarefas fornecidos por <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.TaskFactory> e <xref:System.Threading.Tasks.TaskFactory%601> para criar instâncias de seu tipo de tarefa personalizada porque esses mecanismos também criam apenas objetos <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-302">In addition, you cannot use the task continuation mechanisms that are provided by <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.TaskFactory>, and  <xref:System.Threading.Tasks.TaskFactory%601> to create instances of your custom task type because these mechanisms also create only <xref:System.Threading.Tasks.Task> and  <xref:System.Threading.Tasks.Task%601> objects.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ddb47-303">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="ddb47-303">Related topics</span></span>

|<span data-ttu-id="ddb47-304">Título</span><span class="sxs-lookup"><span data-stu-id="ddb47-304">Title</span></span>|<span data-ttu-id="ddb47-305">Descrição</span><span class="sxs-lookup"><span data-stu-id="ddb47-305">Description</span></span>|
|-|-|
|[<span data-ttu-id="ddb47-306">Encadeando tarefas com tarefas de continuação</span><span class="sxs-lookup"><span data-stu-id="ddb47-306">Chaining Tasks by Using Continuation Tasks</span></span>](chaining-tasks-by-using-continuation-tasks.md)|<span data-ttu-id="ddb47-307">Descreve como as continuações funcionam.</span><span class="sxs-lookup"><span data-stu-id="ddb47-307">Describes how continuations work.</span></span>|
|[<span data-ttu-id="ddb47-308">Tarefas filho anexadas e desanexadas</span><span class="sxs-lookup"><span data-stu-id="ddb47-308">Attached and Detached Child Tasks</span></span>](attached-and-detached-child-tasks.md)|<span data-ttu-id="ddb47-309">Descreve a diferença entre tarefas filhas anexadas e desanexadas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-309">Describes the difference between attached and detached child tasks.</span></span>|
|[<span data-ttu-id="ddb47-310">Cancelamento da tarefa</span><span class="sxs-lookup"><span data-stu-id="ddb47-310">Task Cancellation</span></span>](task-cancellation.md)|<span data-ttu-id="ddb47-311">Descreve o suporte a cancelamento interno do objeto <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-311">Describes the cancellation support that is built into the <xref:System.Threading.Tasks.Task> object.</span></span>|
|[<span data-ttu-id="ddb47-312">Tratamento de Exceção</span><span class="sxs-lookup"><span data-stu-id="ddb47-312">Exception Handling</span></span>](exception-handling-task-parallel-library.md)|<span data-ttu-id="ddb47-313">Descreve como as exceções são manipuladas em threads simultâneos.</span><span class="sxs-lookup"><span data-stu-id="ddb47-313">Describes how exceptions on concurrent threads are handled.</span></span>|
|[<span data-ttu-id="ddb47-314">Como: usar Parallel.Invoke para executar operações paralelas</span><span class="sxs-lookup"><span data-stu-id="ddb47-314">How to: Use Parallel.Invoke to Execute Parallel Operations</span></span>](how-to-use-parallel-invoke-to-execute-parallel-operations.md)|<span data-ttu-id="ddb47-315">Descreve como usar o <xref:System.Threading.Tasks.Parallel.Invoke%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-315">Describes how to use <xref:System.Threading.Tasks.Parallel.Invoke%2A>.</span></span>|
|[<span data-ttu-id="ddb47-316">Como: Retornar um valor de uma tarefa</span><span class="sxs-lookup"><span data-stu-id="ddb47-316">How to: Return a Value from a Task</span></span>](how-to-return-a-value-from-a-task.md)|<span data-ttu-id="ddb47-317">Descreve como retornar valores de tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-317">Describes how to return values from tasks.</span></span>|
|[<span data-ttu-id="ddb47-318">Como: Cancelar uma tarefa e seus filhos</span><span class="sxs-lookup"><span data-stu-id="ddb47-318">How to: Cancel a Task and Its Children</span></span>](how-to-cancel-a-task-and-its-children.md)|<span data-ttu-id="ddb47-319">Descreve como cancelar tarefas.</span><span class="sxs-lookup"><span data-stu-id="ddb47-319">Describes how to cancel tasks.</span></span>|
|[<span data-ttu-id="ddb47-320">Como: criar tarefas pré-computadas</span><span class="sxs-lookup"><span data-stu-id="ddb47-320">How to: Create Pre-Computed Tasks</span></span>](how-to-create-pre-computed-tasks.md)|<span data-ttu-id="ddb47-321">Descreve como usar o método <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType> para recuperar os resultados das operações de download assíncronas armazenados em um cache.</span><span class="sxs-lookup"><span data-stu-id="ddb47-321">Describes how to use the <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType> method to retrieve the results of asynchronous download operations that are held in a cache.</span></span>|
|[<span data-ttu-id="ddb47-322">Como: percorrer uma árvore binária com tarefas paralelas</span><span class="sxs-lookup"><span data-stu-id="ddb47-322">How to: Traverse a Binary Tree with Parallel Tasks</span></span>](how-to-traverse-a-binary-tree-with-parallel-tasks.md)|<span data-ttu-id="ddb47-323">Descreve como usar tarefas para percorrer uma árvore binária.</span><span class="sxs-lookup"><span data-stu-id="ddb47-323">Describes how to use tasks to traverse a binary tree.</span></span>|
|[<span data-ttu-id="ddb47-324">Como: Desencapsular uma tarefa aninhada</span><span class="sxs-lookup"><span data-stu-id="ddb47-324">How to: Unwrap a Nested Task</span></span>](how-to-unwrap-a-nested-task.md)|<span data-ttu-id="ddb47-325">Demonstra como usar o método de extensão <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddb47-325">Demonstrates how to use the <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> extension method.</span></span>|
|[<span data-ttu-id="ddb47-326">Paralelismo de dados</span><span class="sxs-lookup"><span data-stu-id="ddb47-326">Data Parallelism</span></span>](data-parallelism-task-parallel-library.md)|<span data-ttu-id="ddb47-327">Descreve como usar <xref:System.Threading.Tasks.Parallel.For%2A> e <xref:System.Threading.Tasks.Parallel.ForEach%2A> para criar loops paralelos sobre dados.</span><span class="sxs-lookup"><span data-stu-id="ddb47-327">Describes how to use <xref:System.Threading.Tasks.Parallel.For%2A> and <xref:System.Threading.Tasks.Parallel.ForEach%2A> to create parallel loops over data.</span></span>|
|[<span data-ttu-id="ddb47-328">Programação paralela</span><span class="sxs-lookup"><span data-stu-id="ddb47-328">Parallel Programming</span></span>](index.md)|<span data-ttu-id="ddb47-329">Nó de nível superior para a programação paralela do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="ddb47-329">Top level node for .NET Framework parallel programming.</span></span>|

## <a name="see-also"></a><span data-ttu-id="ddb47-330">Confira também</span><span class="sxs-lookup"><span data-stu-id="ddb47-330">See also</span></span>

- [<span data-ttu-id="ddb47-331">Programação paralela</span><span class="sxs-lookup"><span data-stu-id="ddb47-331">Parallel Programming</span></span>](index.md)
- [<span data-ttu-id="ddb47-332">Exemplos de programação paralela com o & do .NET Core .NET Standard</span><span class="sxs-lookup"><span data-stu-id="ddb47-332">Samples for Parallel Programming with the .NET Core & .NET Standard</span></span>](/samples/browse/?products=dotnet-core%2Cdotnet-standard&term=parallel)
