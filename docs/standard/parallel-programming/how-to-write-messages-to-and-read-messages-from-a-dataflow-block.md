---
title: 'Como: Escrever mensagens em um bloco de fluxo de dados e ler mensagens de um bloco de fluxo de dados'
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, reading and writing messages
ms.assetid: 1a9bf078-aa82-46eb-b95a-f87237f028c5
caps.latest.revision: "8"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: bf609a8c350a44fc802cce0ec10693431bbf4f42
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="how-to-write-messages-to-and-read-messages-from-a-dataflow-block"></a><span data-ttu-id="2b375-102">Como: Escrever mensagens em um bloco de fluxo de dados e ler mensagens de um bloco de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="2b375-102">How to: Write Messages to and Read Messages from a Dataflow Block</span></span>
<span data-ttu-id="2b375-103">Este documento descreve como usar a biblioteca de fluxo de dados TPL para escrever mensagens e ler mensagens em um bloco de fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="2b375-103">This document describes how to use the TPL Dataflow Library to write messages to and read messages from a dataflow block.</span></span> <span data-ttu-id="2b375-104">A biblioteca de fluxo de dados TPL fornece métodos síncronos e assíncronos para gravar mensagens para e leitura de um bloco de fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="2b375-104">The TPL Dataflow Library provides both synchronous and asynchronous methods for writing messages to and reading messages from a dataflow block.</span></span> <span data-ttu-id="2b375-105">Este documento usa o <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType> classe.</span><span class="sxs-lookup"><span data-stu-id="2b375-105">This document uses the <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="2b375-106">O <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> classe armazena mensagens no buffer e se comporta como ambos os uma fonte de mensagem e como um destino de mensagem.</span><span class="sxs-lookup"><span data-stu-id="2b375-106">The <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> class buffers messages and behaves as both a message source and as a message target.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="2b375-107">A biblioteca de fluxo de dados TPL (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) não é distribuído com o [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2b375-107">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="2b375-108">Para instalar o <xref:System.Threading.Tasks.Dataflow> namespace, abra seu projeto no [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], escolha **gerenciar pacotes NuGet** no menu projeto e pesquise online o `Microsoft.Tpl.Dataflow` pacote.</span><span class="sxs-lookup"><span data-stu-id="2b375-108">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
  
## <a name="writing-to-and-reading-from-a-dataflow-block-synchronously"></a><span data-ttu-id="2b375-109">Gravar e ler de um bloco de fluxo de dados de forma síncrona</span><span class="sxs-lookup"><span data-stu-id="2b375-109">Writing to and Reading from a Dataflow Block Synchronously</span></span>  
 <span data-ttu-id="2b375-110">O exemplo a seguir usa o <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> método para gravar um <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> blocos de fluxo de dados e o <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A> método de leitura do mesmo objeto.</span><span class="sxs-lookup"><span data-stu-id="2b375-110">The following example uses the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> method to write to a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> dataflow block and the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A> method to read from the same object.</span></span>  
  
 [!code-csharp[TPLDataflow_ReadWrite#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_readwrite/cs/dataflowreadwrite.cs#2)]
 [!code-vb[TPLDataflow_ReadWrite#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_readwrite/vb/dataflowreadwrite.vb#2)]  
  
 <span data-ttu-id="2b375-111">Você também pode usar o <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> método de leitura de um bloco de fluxo de dados, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="2b375-111">You can also use the <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> method to read from a dataflow block, as shown in the following example.</span></span> <span data-ttu-id="2b375-112">O <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> método não bloqueia o thread atual e é útil quando você ocasionalmente sondar dados.</span><span class="sxs-lookup"><span data-stu-id="2b375-112">The <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> method does not block the current thread and is useful when you occasionally poll for data.</span></span>  
  
 [!code-csharp[TPLDataflow_ReadWrite#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_readwrite/cs/dataflowreadwrite.cs#3)]
 [!code-vb[TPLDataflow_ReadWrite#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_readwrite/vb/dataflowreadwrite.vb#3)]  
  
 <span data-ttu-id="2b375-113">Porque o <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> método age de forma síncrona, o <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> objeto nos exemplos anteriores recebe todos os dados antes do segundo loop lê os dados.</span><span class="sxs-lookup"><span data-stu-id="2b375-113">Because the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> method acts synchronously, the <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object in the previous examples receives all data before the second loop reads data.</span></span> <span data-ttu-id="2b375-114">O exemplo a seguir estende o primeiro exemplo usando <xref:System.Threading.Tasks.Parallel.Invoke%2A> para ler e gravar simultaneamente para o bloco de mensagens.</span><span class="sxs-lookup"><span data-stu-id="2b375-114">The following example extends the first example by using <xref:System.Threading.Tasks.Parallel.Invoke%2A> to read from and write to the message block concurrently.</span></span> <span data-ttu-id="2b375-115">Porque <xref:System.Threading.Tasks.Parallel.Invoke%2A> executa ações simultaneamente, os valores não são gravados para o <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> objeto em qualquer ordem específica.</span><span class="sxs-lookup"><span data-stu-id="2b375-115">Because <xref:System.Threading.Tasks.Parallel.Invoke%2A> performs actions concurrently, the values are not written to the <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object in any specific order.</span></span>  
  
 [!code-csharp[TPLDataflow_ReadWrite#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_readwrite/cs/dataflowreadwrite.cs#4)]
 [!code-vb[TPLDataflow_ReadWrite#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_readwrite/vb/dataflowreadwrite.vb#4)]  
  
## <a name="writing-to-and-reading-from-a-dataflow-block-asynchronously"></a><span data-ttu-id="2b375-116">Gravar e ler de um bloco de fluxo de dados de forma assíncrona</span><span class="sxs-lookup"><span data-stu-id="2b375-116">Writing to and Reading from a Dataflow Block Asynchronously</span></span>  
 <span data-ttu-id="2b375-117">O exemplo a seguir usa o <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> método para gravar de maneira assíncrona para um <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> objeto e o <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A> método assincronamente leiam o mesmo objeto.</span><span class="sxs-lookup"><span data-stu-id="2b375-117">The following example uses the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> method to asynchronously write to a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object and the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A> method to asynchronously read from the same object.</span></span> <span data-ttu-id="2b375-118">Este exemplo usa o [async](~/docs/csharp/language-reference/keywords/async.md) e [await](~/docs/csharp/language-reference/keywords/await.md) operadores ([Async](~/docs/visual-basic/language-reference/modifiers/async.md) e [Await](~/docs/visual-basic/language-reference/operators/await-operator.md) no Visual Basic) para enviar dados e ler de forma assíncrona dados do bloco de destino.</span><span class="sxs-lookup"><span data-stu-id="2b375-118">This example uses the [async](~/docs/csharp/language-reference/keywords/async.md) and [await](~/docs/csharp/language-reference/keywords/await.md) operators ([Async](~/docs/visual-basic/language-reference/modifiers/async.md) and [Await](~/docs/visual-basic/language-reference/operators/await-operator.md) in Visual Basic) to asynchronously send data to and read data from the target block.</span></span> <span data-ttu-id="2b375-119">O <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> método é útil quando você deve habilitar um bloco de fluxo de dados para adiar mensagens.</span><span class="sxs-lookup"><span data-stu-id="2b375-119">The <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> method is useful when you must enable a dataflow block to postpone messages.</span></span> <span data-ttu-id="2b375-120">O <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A> método é útil quando você deseja agir sobre dados quando dados se torna disponíveis.</span><span class="sxs-lookup"><span data-stu-id="2b375-120">The <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A> method is useful when you want to act on data when that data becomes available.</span></span> <span data-ttu-id="2b375-121">Para obter mais informações sobre como as mensagens são propagadas entre blocos de mensagens, consulte a seção passagem de mensagens em [fluxo de dados](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="2b375-121">For more information about how messages propagate among message blocks, see the section Message Passing in [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md).</span></span>  
  
 [!code-csharp[TPLDataflow_ReadWrite#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_readwrite/cs/dataflowreadwrite.cs#5)]
 [!code-vb[TPLDataflow_ReadWrite#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_readwrite/vb/dataflowreadwrite.vb#5)]  
  
## <a name="a-complete-example"></a><span data-ttu-id="2b375-122">Um exemplo completo</span><span class="sxs-lookup"><span data-stu-id="2b375-122">A Complete Example</span></span>  
 <span data-ttu-id="2b375-123">O exemplo a seguir mostra o código completo para este documento.</span><span class="sxs-lookup"><span data-stu-id="2b375-123">The following example shows the complete code for this document.</span></span>  
  
 [!code-csharp[TPLDataflow_ReadWrite#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_readwrite/cs/dataflowreadwrite.cs#1)]
 [!code-vb[TPLDataflow_ReadWrite#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_readwrite/vb/dataflowreadwrite.vb#1)]  
  
## <a name="compiling-the-code"></a><span data-ttu-id="2b375-124">Compilando o código</span><span class="sxs-lookup"><span data-stu-id="2b375-124">Compiling the Code</span></span>  
 <span data-ttu-id="2b375-125">Copie o código de exemplo e cole-o em um projeto do Visual Studio ou colá-lo em um arquivo chamado `DataflowReadWrite.cs` (`DataflowReadWrite.vb` para [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), e, em seguida, execute o seguinte comando em uma janela de Prompt de comando do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2b375-125">Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `DataflowReadWrite.cs` (`DataflowReadWrite.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window.</span></span>  
  
 [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  
  
 <span data-ttu-id="2b375-126">**CSC.exe /r:System.Threading.Tasks.Dataflow.dll DataflowReadWrite.cs**</span><span class="sxs-lookup"><span data-stu-id="2b375-126">**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowReadWrite.cs**</span></span>  
  
 [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  
  
 <span data-ttu-id="2b375-127">**Vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowReadWrite.vb**</span><span class="sxs-lookup"><span data-stu-id="2b375-127">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowReadWrite.vb**</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="2b375-128">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="2b375-128">Next Steps</span></span>  
 <span data-ttu-id="2b375-129">Este exemplo mostra como ler e gravar diretamente em um bloco de mensagens.</span><span class="sxs-lookup"><span data-stu-id="2b375-129">This example shows how to read from and write to a message block directly.</span></span> <span data-ttu-id="2b375-130">Você também pode conectar os blocos de fluxo de dados para o formulário *pipelines*, que são sequências lineares dos blocos de fluxo de dados, ou *redes*, que são gráficos de blocos de fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="2b375-130">You can also connect dataflow blocks to form *pipelines*, which are linear sequences of dataflow blocks, or *networks*, which are graphs of dataflow blocks.</span></span> <span data-ttu-id="2b375-131">Em uma rede ou pipeline, origens propagam dados assincronamente para destinos assim que os dados ficam disponíveis.</span><span class="sxs-lookup"><span data-stu-id="2b375-131">In a pipeline or network, sources asynchronously propagate data to targets as that data becomes available.</span></span> <span data-ttu-id="2b375-132">Para obter um exemplo que cria um pipeline de fluxo de dados básico, consulte [passo a passo: Criando um Pipeline de fluxo de dados](../../../docs/standard/parallel-programming/walkthrough-creating-a-dataflow-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="2b375-132">For an example that creates a basic dataflow pipeline, see [Walkthrough: Creating a Dataflow Pipeline](../../../docs/standard/parallel-programming/walkthrough-creating-a-dataflow-pipeline.md).</span></span> <span data-ttu-id="2b375-133">Para obter um exemplo que cria uma rede de fluxo de dados mais complexa, consulte [passo a passo: usando o fluxo de dados em um aplicativo do Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="2b375-133">For an example that creates a more complex dataflow network, see [Walkthrough: Using Dataflow in a Windows Forms Application](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2b375-134">Consulte também</span><span class="sxs-lookup"><span data-stu-id="2b375-134">See Also</span></span>  
 [<span data-ttu-id="2b375-135">Fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="2b375-135">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
