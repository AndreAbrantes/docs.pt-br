---
title: 'Passo a passo: usar um fluxo de dados em um aplicativo do Windows Forms'
ms.date: 03/30/2017
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
ms.openlocfilehash: da42358007b887f6bab05c35e0f7542f1069abd4
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/24/2020
ms.locfileid: "95689804"
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="9e3bb-102">Passo a passo: usar um fluxo de dados em um aplicativo do Windows Forms</span><span class="sxs-lookup"><span data-stu-id="9e3bb-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>

<span data-ttu-id="9e3bb-103">Este documento demonstra como criar uma rede de blocos de fluxo de dados que executam o processamento de imagens em um Aplicativo do Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="9e3bb-104">Este exemplo carrega arquivos de imagem da pasta especificada, cria uma imagem composta e exibe o resultado.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="9e3bb-105">O exemplo usa o modelo de fluxo de dados para encaminhar imagens por meio da rede.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="9e3bb-106">No modelo de fluxo de dados, componentes independentes de um programa se comunicam uns com os outros enviando mensagens.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="9e3bb-107">Quando um componente recebe uma mensagem, ele executa uma ação e, depois, passa o resultado para outro componente.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="9e3bb-108">Compare isso com o modelo de fluxo de controle, em que um aplicativo usa estruturas de controle, por exemplo, instruções condicionais, loops e assim por diante, para controlar a ordem das operações em um programa.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="9e3bb-109">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="9e3bb-109">Prerequisites</span></span>  

 <span data-ttu-id="9e3bb-110">Leia sobre o [Fluxo de dados](dataflow-task-parallel-library.md) antes de iniciar essa explicação passo a passo.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-110">Read [Dataflow](dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="sections"></a><span data-ttu-id="9e3bb-111">Seções</span><span class="sxs-lookup"><span data-stu-id="9e3bb-111">Sections</span></span>  

 <span data-ttu-id="9e3bb-112">Este passo a passo contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="9e3bb-112">This walkthrough contains the following sections:</span></span>  
  
- [<span data-ttu-id="9e3bb-113">Criar o aplicativo do Windows Forms</span><span class="sxs-lookup"><span data-stu-id="9e3bb-113">Creating the Windows Forms Application</span></span>](#winforms)  
  
- [<span data-ttu-id="9e3bb-114">Criar a rede de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="9e3bb-114">Creating the Dataflow Network</span></span>](#network)  
  
- [<span data-ttu-id="9e3bb-115">Conectar a rede de fluxo de dados à interface do usuário</span><span class="sxs-lookup"><span data-stu-id="9e3bb-115">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
- [<span data-ttu-id="9e3bb-116">O exemplo completo</span><span class="sxs-lookup"><span data-stu-id="9e3bb-116">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>

## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="9e3bb-117">Criar o aplicativo do Windows Forms</span><span class="sxs-lookup"><span data-stu-id="9e3bb-117">Creating the Windows Forms Application</span></span>  

 <span data-ttu-id="9e3bb-118">Esta seção descreve como criar o aplicativo básico do Windows Forms e adicionar controles ao formulário principal.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-118">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="9e3bb-119">Para criar o aplicativo do Windows Forms</span><span class="sxs-lookup"><span data-stu-id="9e3bb-119">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="9e3bb-120">No Visual Studio, crie um projeto de **aplicativo do Windows Forms** do Visual Basic ou do Visual C#.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-120">In Visual Studio, create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="9e3bb-121">Neste documento, o projeto é chamado `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-121">In this document, the project is named `CompositeImages`.</span></span>  
  
2. <span data-ttu-id="9e3bb-122">No designer de formulários do formulário principal, Form1.cs (Form1.vb para Visual Basic), adicione um controle <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-122">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3. <span data-ttu-id="9e3bb-123">Adicione um controle <xref:System.Windows.Forms.ToolStripButton> ao controle <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-123">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="9e3bb-124">Defina a propriedade <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> como <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> e a propriedade <xref:System.Windows.Forms.ToolStripItem.Text%2A> como **Escolher Pasta**.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-124">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4. <span data-ttu-id="9e3bb-125">Adicione um segundo controle <xref:System.Windows.Forms.ToolStripButton> ao controle <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-125">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="9e3bb-126">Defina a propriedade <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> como <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, a propriedade <xref:System.Windows.Forms.ToolStripItem.Text%2A> como **Cancelar** e a propriedade <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> como `False`.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5. <span data-ttu-id="9e3bb-127">Adicione um objeto <xref:System.Windows.Forms.PictureBox> ao formulário principal.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-127">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="9e3bb-128">Defina a propriedade <xref:System.Windows.Forms.Control.Dock%2A> como <xref:System.Windows.Forms.DockStyle.Fill>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-128">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>

## <a name="creating-the-dataflow-network"></a><span data-ttu-id="9e3bb-129">Criar a rede de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="9e3bb-129">Creating the Dataflow Network</span></span>  

 <span data-ttu-id="9e3bb-130">Esta seção descreve como criar a rede de fluxo de dados que executa o processamento de imagem.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-130">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="9e3bb-131">Para criar a rede de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="9e3bb-131">To Create the Dataflow Network</span></span>  
  
1. <span data-ttu-id="9e3bb-132">Adicione uma referência a System.Threading.Tasks.Dataflow.dll ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-132">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2. <span data-ttu-id="9e3bb-133">Verifique se o Form1.cs (Form1.vb para Visual Basic) contém as seguintes instruções `using` (`Using` em Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="9e3bb-133">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` (`Using` in Visual Basic) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3. <span data-ttu-id="9e3bb-134">Adicione os membros de dados a seguir à classe `Form1`:</span><span class="sxs-lookup"><span data-stu-id="9e3bb-134">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4. <span data-ttu-id="9e3bb-135">Adicione o seguinte método, `CreateImageProcessingNetwork`, à classe `Form1`.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-135">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="9e3bb-136">Esse método cria a rede de processamento de imagem.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-136">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5. <span data-ttu-id="9e3bb-137">Implementar o método de `LoadBitmaps` .</span><span class="sxs-lookup"><span data-stu-id="9e3bb-137">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6. <span data-ttu-id="9e3bb-138">Implementar o método de `CreateCompositeBitmap` .</span><span class="sxs-lookup"><span data-stu-id="9e3bb-138">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    > <span data-ttu-id="9e3bb-139">A versão em C# do método `CreateCompositeBitmap` usa ponteiros para habilitar o processamento eficiente dos objetos <xref:System.Drawing.Bitmap?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-139">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="9e3bb-140">Portanto, você deve habilitar a opção **Permitir código não gerenciado** em seu projeto para usar a palavra-chave [unsafe](../../csharp/language-reference/keywords/unsafe.md).</span><span class="sxs-lookup"><span data-stu-id="9e3bb-140">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](../../csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="9e3bb-141">Para obter mais informações de como habilitar o código não seguro em um projeto em Visual C#, confira [Página Build, Designer de Projeto (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span><span class="sxs-lookup"><span data-stu-id="9e3bb-141">For more information about how to enable unsafe code in a Visual C# project, see [Build Page, Project Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span></span>  
  
 <span data-ttu-id="9e3bb-142">A tabela a seguir descreve os membros da rede.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-142">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="9e3bb-143">Membro</span><span class="sxs-lookup"><span data-stu-id="9e3bb-143">Member</span></span>|<span data-ttu-id="9e3bb-144">Type</span><span class="sxs-lookup"><span data-stu-id="9e3bb-144">Type</span></span>|<span data-ttu-id="9e3bb-145">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="9e3bb-145">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="9e3bb-146">Usa um caminho de pasta como entrada e produz uma coleção de objetos <xref:System.Drawing.Bitmap> como saída.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-146">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="9e3bb-147">Usa uma coleção de objetos <xref:System.Drawing.Bitmap> como entrada e produz um bitmap composto como saída.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-147">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="9e3bb-148">Exibe o bitmap composto no formulário.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-148">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="9e3bb-149">Exibe uma imagem para indicar que a operação foi cancelada e permite que o usuário selecione outra pasta.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-149">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="9e3bb-150">Para conectar os blocos de fluxo de dados para formar uma rede, este exemplo usa o método <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-150">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="9e3bb-151">O método <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> contém uma versão sobrecarregada que usa um objeto <xref:System.Predicate%601> que determina se o bloco de destino aceita ou rejeita uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-151">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="9e3bb-152">Esse mecanismo de filtragem permite que os blocos de mensagens recebam apenas determinados valores.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-152">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="9e3bb-153">Neste exemplo, a rede pode ser ramificada usando uma de duas maneiras.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-153">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="9e3bb-154">A ramificação principal carrega as imagens do disco, cria a imagem composta e exibe essa imagem no formulário.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-154">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="9e3bb-155">A ramificação alternativa cancela a operação atual.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-155">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="9e3bb-156">Os objetos <xref:System.Predicate%601> permitem que os blocos de fluxo de dados ao longo da ramificação principal alternem para a ramificação alternativa rejeitando determinadas mensagens.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-156">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="9e3bb-157">Por exemplo, se o usuário cancelar a operação, o bloco de fluxo de dados `createCompositeBitmap` produzirá `null` (`Nothing` em Visual Basic) como sua saída.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-157">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in Visual Basic) as its output.</span></span> <span data-ttu-id="9e3bb-158">O bloco de fluxo de dados `displayCompositeBitmap` rejeita valores de entrada `null` e, portanto, a mensagem é oferecida para `operationCancelled`.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-158">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="9e3bb-159">O bloco de fluxo de dados `operationCancelled` aceita todas as mensagens e, portanto, exibe uma imagem para indicar que a operação foi cancelada.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-159">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="9e3bb-160">A seguinte ilustração mostra a rede de processamento de imagem:</span><span class="sxs-lookup"><span data-stu-id="9e3bb-160">The following illustration shows the image processing network:</span></span>  
  
 ![Ilustração que mostra a rede de processamento de imagem.](./media/walkthrough-using-dataflow-in-a-windows-forms-application/dataflow-winforms-image-processing.png)  
  
 <span data-ttu-id="9e3bb-162">Como os blocos de fluxo de dados `displayCompositeBitmap` e `operationCancelled` atuam na interface do usuário, é importante que essas ações ocorram no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-162">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="9e3bb-163">Para isso, durante a construção cada objeto fornece um objeto <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> cuja propriedade <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> está definida como <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-163">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="9e3bb-164">O método <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> cria um objeto <xref:System.Threading.Tasks.TaskScheduler> que executa o trabalho no contexto de sincronização atual.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-164">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="9e3bb-165">Como o método `CreateImageProcessingNetwork` é chamado do manipulador do botão **Escolher Pasta**, executado no thread da interface de usuário, as ações para os blocos de fluxo de dados `displayCompositeBitmap` e `operationCancelled` também são executadas no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-165">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="9e3bb-166">Este exemplo usa um token de cancelamento compartilhado em vez de configurar a propriedade <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>, pois a propriedade <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> cancela permanentemente a execução do bloco de fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-166">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="9e3bb-167">Um token de cancelamento permite que esse exemplo reutilize a mesma rede de fluxo de dados várias vezes, mesmo quando o usuário cancela uma ou mais operações.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-167">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="9e3bb-168">Para obter um exemplo que usa <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> para cancelar permanentemente a execução de um bloco de fluxo de dados, confira [Como cancelar um bloco de fluxo de dados](how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="9e3bb-168">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>

## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="9e3bb-169">Conectar a rede de fluxo de dados à interface do usuário</span><span class="sxs-lookup"><span data-stu-id="9e3bb-169">Connecting the Dataflow Network to the User Interface</span></span>  

 <span data-ttu-id="9e3bb-170">Esta seção descreve como conectar a rede de fluxo de dados à interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-170">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="9e3bb-171">A criação de uma imagem composta e o cancelamento da operação começa com os botões **Escolher Pasta** e **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-171">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="9e3bb-172">Quando o usuário escolhe um desses botões, a ação apropriada é iniciada de maneira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-172">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="9e3bb-173">Para conectar a rede de fluxo de dados à interface do usuário</span><span class="sxs-lookup"><span data-stu-id="9e3bb-173">To Connect the Dataflow Network to the User Interface</span></span>  
  
1. <span data-ttu-id="9e3bb-174">No designer de formulários, do formulário principal, crie um manipulador de eventos para o evento <xref:System.Windows.Forms.ToolStripItem.Click> para o botão **Escolher Pasta**.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-174">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2. <span data-ttu-id="9e3bb-175">Implemente o evento <xref:System.Windows.Forms.ToolStripItem.Click> para o botão **Escolher Pasta**.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-175">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3. <span data-ttu-id="9e3bb-176">No designer de formulários, para o formulário principal, crie um manipulador de eventos para o evento <xref:System.Windows.Forms.ToolStripItem.Click> para o botão **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4. <span data-ttu-id="9e3bb-177">Implante o evento <xref:System.Windows.Forms.ToolStripItem.Click> para o botão **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>

## <a name="the-complete-example"></a><span data-ttu-id="9e3bb-178">O Exemplo Completo</span><span class="sxs-lookup"><span data-stu-id="9e3bb-178">The Complete Example</span></span>  

 <span data-ttu-id="9e3bb-179">O exemplo a seguir mostra o código completo dessa explicação passo a passo.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-179">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="9e3bb-180">A ilustração a seguir mostra a saída típica para a pasta \Sample Pictures\ comum.</span><span class="sxs-lookup"><span data-stu-id="9e3bb-180">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="9e3bb-181">![O aplicativo Windows Forms](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="9e3bb-181">![The Windows Forms Application](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  

## <a name="see-also"></a><span data-ttu-id="9e3bb-182">Confira também</span><span class="sxs-lookup"><span data-stu-id="9e3bb-182">See also</span></span>

- [<span data-ttu-id="9e3bb-183">Fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="9e3bb-183">Dataflow</span></span>](dataflow-task-parallel-library.md)
