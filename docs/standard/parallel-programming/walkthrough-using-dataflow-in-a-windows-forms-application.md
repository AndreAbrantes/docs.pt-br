---
title: "Explicação passo a passo: Usando um fluxo de dados em um Aplicativo do Windows Forms"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
caps.latest.revision: "8"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: d2775cc99020fd99d6e7d79cdf3e1ffcc3219146
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="dda66-102">Explicação passo a passo: Usando um fluxo de dados em um Aplicativo do Windows Forms</span><span class="sxs-lookup"><span data-stu-id="dda66-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>
<span data-ttu-id="dda66-103">Este documento demonstra como criar uma rede de blocos de fluxo de dados que executam o processamento de imagem em um aplicativo do Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="dda66-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="dda66-104">Este exemplo carrega arquivos de imagem da pasta especificada, cria uma imagem composta e exibe o resultado.</span><span class="sxs-lookup"><span data-stu-id="dda66-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="dda66-105">O exemplo usa o modelo de fluxo de dados para imagens de rota por meio da rede.</span><span class="sxs-lookup"><span data-stu-id="dda66-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="dda66-106">No modelo de fluxo de dados, componentes independentes de um programa se comunicar uns com os outros enviando mensagens.</span><span class="sxs-lookup"><span data-stu-id="dda66-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="dda66-107">Quando um componente recebe uma mensagem, ele executa uma ação e, em seguida, passa o resultado para outro componente.</span><span class="sxs-lookup"><span data-stu-id="dda66-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="dda66-108">Compare isso com o modelo de fluxo de controle, em que um aplicativo usa estruturas de controle, por exemplo, instruções condicionais, loops e assim por diante, para controlar a ordem das operações em um programa.</span><span class="sxs-lookup"><span data-stu-id="dda66-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="dda66-109">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="dda66-109">Prerequisites</span></span>  
 <span data-ttu-id="dda66-110">Leitura [fluxo de dados](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) antes de começar este passo a passo.</span><span class="sxs-lookup"><span data-stu-id="dda66-110">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="dda66-111">A biblioteca de fluxo de dados TPL (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) não é distribuído com o [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dda66-111">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="dda66-112">Para instalar o <xref:System.Threading.Tasks.Dataflow> namespace, abra seu projeto no [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], escolha **gerenciar pacotes NuGet** no menu projeto e pesquise online o `Microsoft.Tpl.Dataflow` pacote.</span><span class="sxs-lookup"><span data-stu-id="dda66-112">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
 
  
## <a name="sections"></a><span data-ttu-id="dda66-113">Seções</span><span class="sxs-lookup"><span data-stu-id="dda66-113">Sections</span></span>  
 <span data-ttu-id="dda66-114">Este passo a passo contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="dda66-114">This walkthrough contains the following sections:</span></span>  
  
-   [<span data-ttu-id="dda66-115">Criando o aplicativo Windows Forms</span><span class="sxs-lookup"><span data-stu-id="dda66-115">Creating the Windows Forms Application</span></span>](#winforms)  
  
-   [<span data-ttu-id="dda66-116">Criar a rede de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="dda66-116">Creating the Dataflow Network</span></span>](#network)  
  
-   [<span data-ttu-id="dda66-117">Conectar-se a rede de fluxo de dados para a Interface do usuário</span><span class="sxs-lookup"><span data-stu-id="dda66-117">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
-   [<span data-ttu-id="dda66-118">O exemplo completo</span><span class="sxs-lookup"><span data-stu-id="dda66-118">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>   
## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="dda66-119">Criando o aplicativo Windows Forms</span><span class="sxs-lookup"><span data-stu-id="dda66-119">Creating the Windows Forms Application</span></span>  
 <span data-ttu-id="dda66-120">Esta seção descreve como criar o aplicativo de Windows Forms básico e adicionar controles ao formulário principal.</span><span class="sxs-lookup"><span data-stu-id="dda66-120">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
#### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="dda66-121">Para criar o Windows Forms de aplicativo</span><span class="sxs-lookup"><span data-stu-id="dda66-121">To Create the Windows Forms Application</span></span>  
  
1.  <span data-ttu-id="dda66-122">Em [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], crie um [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] ou Visual Basic **aplicativo do Windows Forms** projeto.</span><span class="sxs-lookup"><span data-stu-id="dda66-122">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="dda66-123">Neste documento, o projeto é denominado `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="dda66-123">In this document, the project is named `CompositeImages`.</span></span>  
  
2.  <span data-ttu-id="dda66-124">No designer de formulário para o formulário principal, Form1 (Form1. vb para [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), adicione um <xref:System.Windows.Forms.ToolStrip> controle.</span><span class="sxs-lookup"><span data-stu-id="dda66-124">On the form designer for the main form, Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3.  <span data-ttu-id="dda66-125">Adicionar um <xref:System.Windows.Forms.ToolStripButton> o controle para o <xref:System.Windows.Forms.ToolStrip> controle.</span><span class="sxs-lookup"><span data-stu-id="dda66-125">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="dda66-126">Definir o <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> propriedade <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> e o <xref:System.Windows.Forms.ToolStripItem.Text%2A> propriedade **escolher a pasta**.</span><span class="sxs-lookup"><span data-stu-id="dda66-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4.  <span data-ttu-id="dda66-127">Adicionar um segundo <xref:System.Windows.Forms.ToolStripButton> o controle para o <xref:System.Windows.Forms.ToolStrip> controle.</span><span class="sxs-lookup"><span data-stu-id="dda66-127">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="dda66-128">Definir o <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> propriedade <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, o <xref:System.Windows.Forms.ToolStripItem.Text%2A> propriedade **Cancelar**e o <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> propriedade para `False`.</span><span class="sxs-lookup"><span data-stu-id="dda66-128">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5.  <span data-ttu-id="dda66-129">Adicionar uma <xref:System.Windows.Forms.PictureBox> objeto para o formulário principal.</span><span class="sxs-lookup"><span data-stu-id="dda66-129">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="dda66-130">Defina a propriedade <xref:System.Windows.Forms.Control.Dock%2A> como <xref:System.Windows.Forms.DockStyle.Fill>.</span><span class="sxs-lookup"><span data-stu-id="dda66-130">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>   
## <a name="creating-the-dataflow-network"></a><span data-ttu-id="dda66-131">Criar a rede de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="dda66-131">Creating the Dataflow Network</span></span>  
 <span data-ttu-id="dda66-132">Esta seção descreve como criar a rede de fluxo de dados que executa o processamento de imagem.</span><span class="sxs-lookup"><span data-stu-id="dda66-132">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
#### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="dda66-133">Para criar a rede de fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="dda66-133">To Create the Dataflow Network</span></span>  
  
1.  <span data-ttu-id="dda66-134">Adicione uma referência a System.Threading.Tasks.Dataflow.dll ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="dda66-134">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2.  <span data-ttu-id="dda66-135">Certifique-se de que Form1 (Form1. vb para [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) contém o seguinte `using` (`Using` em [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) instruções:</span><span class="sxs-lookup"><span data-stu-id="dda66-135">Ensure that Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) contains the following `using` (`Using` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3.  <span data-ttu-id="dda66-136">Adicionar os seguintes membros de dados para o `Form1` classe:</span><span class="sxs-lookup"><span data-stu-id="dda66-136">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4.  <span data-ttu-id="dda66-137">Adicione o seguinte método, `CreateImageProcessingNetwork`, para o `Form1` classe.</span><span class="sxs-lookup"><span data-stu-id="dda66-137">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="dda66-138">Esse método cria a rede de processamento de imagem.</span><span class="sxs-lookup"><span data-stu-id="dda66-138">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5.  <span data-ttu-id="dda66-139">Implementar o método de `LoadBitmaps` .</span><span class="sxs-lookup"><span data-stu-id="dda66-139">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6.  <span data-ttu-id="dda66-140">Implementar o método de `CreateCompositeBitmap` .</span><span class="sxs-lookup"><span data-stu-id="dda66-140">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    >  <span data-ttu-id="dda66-141">A versão c# do `CreateCompositeBitmap` método usa ponteiros para habilitar o processamento eficiente do <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objetos.</span><span class="sxs-lookup"><span data-stu-id="dda66-141">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="dda66-142">Portanto, você deve habilitar o **permitir código inseguro** opção em seu projeto para usar o [unsafe](~/docs/csharp/language-reference/keywords/unsafe.md) palavra-chave.</span><span class="sxs-lookup"><span data-stu-id="dda66-142">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](~/docs/csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="dda66-143">Para obter mais informações sobre como habilitar o código não seguro em um [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] de projeto, consulte [página de compilação, Designer de projeto (c#)] https://msdn.microsoft.com/library/kb4wyys2).</span><span class="sxs-lookup"><span data-stu-id="dda66-143">For more information about how to enable unsafe code in a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] project, see [Build Page, Project Designer (C#)]https://msdn.microsoft.com/library/kb4wyys2).</span></span>  
  
 <span data-ttu-id="dda66-144">A tabela a seguir descreve os membros da rede.</span><span class="sxs-lookup"><span data-stu-id="dda66-144">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="dda66-145">Membro</span><span class="sxs-lookup"><span data-stu-id="dda66-145">Member</span></span>|<span data-ttu-id="dda66-146">Tipo</span><span class="sxs-lookup"><span data-stu-id="dda66-146">Type</span></span>|<span data-ttu-id="dda66-147">Descrição</span><span class="sxs-lookup"><span data-stu-id="dda66-147">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="dda66-148">Usa um caminho de pasta como entrada e produz uma coleção de <xref:System.Drawing.Bitmap> objetos como saída.</span><span class="sxs-lookup"><span data-stu-id="dda66-148">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="dda66-149">Usa uma coleção de <xref:System.Drawing.Bitmap> objetos como entrada e produz um bitmap composto como saída.</span><span class="sxs-lookup"><span data-stu-id="dda66-149">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="dda66-150">Exibe o bitmap composto no formulário.</span><span class="sxs-lookup"><span data-stu-id="dda66-150">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="dda66-151">Exibe uma imagem para indicar que a operação será cancelada e permite que o usuário selecione outra pasta.</span><span class="sxs-lookup"><span data-stu-id="dda66-151">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="dda66-152">Para conectar os blocos de fluxo de dados para formar uma rede, este exemplo usa o <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> método.</span><span class="sxs-lookup"><span data-stu-id="dda66-152">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="dda66-153">O <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> método contém uma versão sobrecarregada que leva um <xref:System.Predicate%601> objeto que determina se o bloco de destino aceita ou rejeita uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="dda66-153">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="dda66-154">Esse mecanismo de filtragem permite que os blocos de mensagens receber apenas determinados valores.</span><span class="sxs-lookup"><span data-stu-id="dda66-154">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="dda66-155">Neste exemplo, a rede pode ramificar em uma das duas maneiras.</span><span class="sxs-lookup"><span data-stu-id="dda66-155">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="dda66-156">A ramificação principal carrega as imagens de disco, cria uma composição de imagens e exibe essa imagem no formulário.</span><span class="sxs-lookup"><span data-stu-id="dda66-156">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="dda66-157">A ramificação alternativa cancela a operação atual.</span><span class="sxs-lookup"><span data-stu-id="dda66-157">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="dda66-158">O <xref:System.Predicate%601> objetos permitem que os blocos de fluxo de dados ao longo da ramificação principal para alternar para a ramificação alternativa rejeitando determinadas mensagens.</span><span class="sxs-lookup"><span data-stu-id="dda66-158">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="dda66-159">Por exemplo, se o usuário cancela a operação, o bloco de fluxo de dados `createCompositeBitmap` produz `null` (`Nothing` em [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) como sua saída.</span><span class="sxs-lookup"><span data-stu-id="dda66-159">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) as its output.</span></span> <span data-ttu-id="dda66-160">O bloco de fluxo de dados `displayCompositeBitmap` rejeita `null` valores de entrada e, portanto, a mensagem é oferecido para `operationCancelled`.</span><span class="sxs-lookup"><span data-stu-id="dda66-160">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="dda66-161">O bloco de fluxo de dados `operationCancelled` aceita todas as mensagens e, portanto, exibe uma imagem para indicar que a operação foi cancelada.</span><span class="sxs-lookup"><span data-stu-id="dda66-161">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="dda66-162">A ilustração a seguir mostra a rede de processamento de imagem.</span><span class="sxs-lookup"><span data-stu-id="dda66-162">The following illustration shows the image processing network.</span></span>  
  
 <span data-ttu-id="dda66-163">![A rede de processamento de imagem](../../../docs/standard/parallel-programming/media/dataflowwinforms.png "DataflowWinForms")</span><span class="sxs-lookup"><span data-stu-id="dda66-163">![The image processing network](../../../docs/standard/parallel-programming/media/dataflowwinforms.png "DataflowWinForms")</span></span>  
  
 <span data-ttu-id="dda66-164">Porque o `displayCompositeBitmap` e `operationCancelled` blocos agir na interface do usuário de fluxo de dados, é importante que essas ações ocorrem no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="dda66-164">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="dda66-165">Para fazer isso, durante a construção, esses objetos fornecem um <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> objeto que tem o <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> propriedade definida como <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="dda66-165">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="dda66-166">O <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> método cria um <xref:System.Threading.Tasks.TaskScheduler> objeto que executa o trabalho no contexto de sincronização atual.</span><span class="sxs-lookup"><span data-stu-id="dda66-166">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="dda66-167">Porque o `CreateImageProcessingNetwork` método é chamado de manipulador do **Escolher pasta** botão, que é executado na interface do usuário do thread, as ações para o `displayCompositeBitmap` e `operationCancelled` também executar blocos de fluxo de dados no thread de interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="dda66-167">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="dda66-168">Este exemplo usa um token de cancelamento compartilhados em vez de configuração o <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> propriedade porque o <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> propriedade permanentemente cancela a execução de bloco de fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="dda66-168">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="dda66-169">Um token de cancelamento permite que esse exemplo de reutilizar a mesma rede de fluxo de dados várias vezes, mesmo quando o usuário cancela uma ou mais operações.</span><span class="sxs-lookup"><span data-stu-id="dda66-169">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="dda66-170">Para obter um exemplo que usa <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> para cancelar permanentemente a execução de um bloco de fluxo de dados, consulte [como: Cancelar um Dataflow Block](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="dda66-170">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>   
## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="dda66-171">Conectar-se a rede de fluxo de dados para a Interface do usuário</span><span class="sxs-lookup"><span data-stu-id="dda66-171">Connecting the Dataflow Network to the User Interface</span></span>  
 <span data-ttu-id="dda66-172">Esta seção descreve como conectar-se a rede de fluxo de dados para a interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="dda66-172">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="dda66-173">A criação de uma composição de imagens e o cancelamento da operação iniciadas a partir de **Escolher pasta** e **Cancelar** botões.</span><span class="sxs-lookup"><span data-stu-id="dda66-173">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="dda66-174">Quando o usuário escolhe um desses botões, a ação apropriada é iniciada de maneira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="dda66-174">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
#### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="dda66-175">Para conectar-se a rede de fluxo de dados para a Interface do usuário</span><span class="sxs-lookup"><span data-stu-id="dda66-175">To Connect the Dataflow Network to the User Interface</span></span>  
  
1.  <span data-ttu-id="dda66-176">No designer de formulário para o formulário principal, crie um manipulador de eventos para o <xref:System.Windows.Forms.ToolStripItem.Click> eventos para o **Escolher pasta** botão.</span><span class="sxs-lookup"><span data-stu-id="dda66-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2.  <span data-ttu-id="dda66-177">Implementar o <xref:System.Windows.Forms.ToolStripItem.Click> eventos para o **Escolher pasta** botão.</span><span class="sxs-lookup"><span data-stu-id="dda66-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3.  <span data-ttu-id="dda66-178">No designer de formulário para o formulário principal, crie um manipulador de eventos para o <xref:System.Windows.Forms.ToolStripItem.Click> eventos para o **Cancelar** botão.</span><span class="sxs-lookup"><span data-stu-id="dda66-178">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4.  <span data-ttu-id="dda66-179">Implementar o <xref:System.Windows.Forms.ToolStripItem.Click> eventos para o **Cancelar** botão.</span><span class="sxs-lookup"><span data-stu-id="dda66-179">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>   
## <a name="the-complete-example"></a><span data-ttu-id="dda66-180">O Exemplo Completo</span><span class="sxs-lookup"><span data-stu-id="dda66-180">The Complete Example</span></span>  
 <span data-ttu-id="dda66-181">O exemplo a seguir mostra o código completo para este passo a passo.</span><span class="sxs-lookup"><span data-stu-id="dda66-181">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="dda66-182">A ilustração a seguir mostra a saída típica para a pasta \Sample Pictures\ comuns.</span><span class="sxs-lookup"><span data-stu-id="dda66-182">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="dda66-183">![Aplicativo do Windows Forms](../../../docs/standard/parallel-programming/media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="dda66-183">![The Windows Forms Application](../../../docs/standard/parallel-programming/media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="dda66-184">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="dda66-184">Next Steps</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dda66-185">Consulte também</span><span class="sxs-lookup"><span data-stu-id="dda66-185">See Also</span></span>  
 [<span data-ttu-id="dda66-186">Fluxo de dados</span><span class="sxs-lookup"><span data-stu-id="dda66-186">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
