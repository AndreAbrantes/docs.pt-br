---
title: Opções de mesclagem em PLINQ
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- PLINQ queries, merge options
ms.assetid: e8f7be3b-88de-4f33-ab14-dc008e76c1ba
ms.openlocfilehash: 18f233ac4c5afa63ec31e83d5fff8f0a57f9146f
ms.sourcegitcommit: 81ad1f09b93f3b3e6706a7f2e4ddf50ef229ea3d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/20/2019
ms.locfileid: "74203994"
---
# <a name="merge-options-in-plinq"></a><span data-ttu-id="9fe75-102">Opções de mesclagem em PLINQ</span><span class="sxs-lookup"><span data-stu-id="9fe75-102">Merge Options in PLINQ</span></span>
<span data-ttu-id="9fe75-103">Quando uma consulta está sendo executada como paralela, o PLINQ faz a partição da sequência de origem para que várias threads possam funcionar em diferentes partes simultaneamente, normalmente em threads separados.</span><span class="sxs-lookup"><span data-stu-id="9fe75-103">When a query is executing as parallel, PLINQ partitions the source sequence so that multiple threads can work on different parts concurrently, typically on separate threads.</span></span> <span data-ttu-id="9fe75-104">Se os resultados forem consumidos em um thread, por exemplo, em um loop `foreach` (`For Each` em Visual Basic), os resultados de cada thread precisarão ser mesclados novamente em uma sequência.</span><span class="sxs-lookup"><span data-stu-id="9fe75-104">If the results are to be consumed on one thread, for example, in a `foreach` (`For Each` in Visual Basic) loop, then the results from every thread must be merged back into one sequence.</span></span> <span data-ttu-id="9fe75-105">O tipo de mesclagem executado pelo PLINQ depende dos operadores que estão presentes na consulta.</span><span class="sxs-lookup"><span data-stu-id="9fe75-105">The kind of merge that PLINQ performs depends on the operators that are present in the query.</span></span> <span data-ttu-id="9fe75-106">Por exemplo, os operadores que impõem uma nova ordem aos resultados devem armazenar em buffer todos os elementos em todos os threads.</span><span class="sxs-lookup"><span data-stu-id="9fe75-106">For example, operators that impose a new order on the results must buffer all elements from all threads.</span></span> <span data-ttu-id="9fe75-107">Do ponto de vista do thread de consumo (que também é o thread do usuário do aplicativo), uma consulta totalmente armazenada em buffer pode ser executada por um período significativo de tempo antes de produzir seu primeiro resultado.</span><span class="sxs-lookup"><span data-stu-id="9fe75-107">From the perspective of the consuming thread (which is also that of the application user) a fully buffered query might run for a noticeable period of time before it produces its first result.</span></span> <span data-ttu-id="9fe75-108">Por padrão, outros operadores são parcialmente armazenados em buffer e geram seus resultados em lotes.</span><span class="sxs-lookup"><span data-stu-id="9fe75-108">Other operators, by default, are partially buffered; they yield their results in batches.</span></span> <span data-ttu-id="9fe75-109">Um operador <xref:System.Linq.ParallelEnumerable.ForAll%2A> não é armazenado em buffer por padrão.</span><span class="sxs-lookup"><span data-stu-id="9fe75-109">One operator, <xref:System.Linq.ParallelEnumerable.ForAll%2A> is not buffered by default.</span></span> <span data-ttu-id="9fe75-110">Ele gera todos os elementos de todos os threads imediatamente.</span><span class="sxs-lookup"><span data-stu-id="9fe75-110">It yields all elements from all threads immediately.</span></span>  
  
 <span data-ttu-id="9fe75-111">Usando o método <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A>, conforme mostrado no exemplo a seguir, você pode fornecer uma dica ao PLINQ indicando o tipo de mesclagem que deverá ser executada.</span><span class="sxs-lookup"><span data-stu-id="9fe75-111">By using the <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> method, as shown in the following example, you can provide a hint to PLINQ that indicates what kind of merging to perform.</span></span>  
  
 [!code-csharp[PLINQ#26](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#26)]
 [!code-vb[PLINQ#26](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#26)]  
  
 <span data-ttu-id="9fe75-112">Para ver o exemplo completo, confira [Como especificar opções de mesclagem em PLINQ](../../../docs/standard/parallel-programming/how-to-specify-merge-options-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="9fe75-112">For the complete example, see [How to: Specify Merge Options in PLINQ](../../../docs/standard/parallel-programming/how-to-specify-merge-options-in-plinq.md).</span></span>  
  
 <span data-ttu-id="9fe75-113">Se a consulta em questão não oferecer suporte à opção solicitada, a opção será ignorada.</span><span class="sxs-lookup"><span data-stu-id="9fe75-113">If the particular query cannot support the requested option, then the option will just be ignored.</span></span> <span data-ttu-id="9fe75-114">Na maioria dos casos, você não precisa especificar uma opção de mesclagem para uma consulta PLINQ.</span><span class="sxs-lookup"><span data-stu-id="9fe75-114">In most cases, you do not have to specify a merge option for a PLINQ query.</span></span> <span data-ttu-id="9fe75-115">No entanto, em alguns casos você pode achar, ao testar e medir, que uma consulta terá uma melhor execução em um modo diferente do padrão.</span><span class="sxs-lookup"><span data-stu-id="9fe75-115">However, in some cases you may find by testing and measurement that a query executes best in a non-default mode.</span></span> <span data-ttu-id="9fe75-116">Uma forma comum de usar essa opção é forçando um operador de mesclagem de blocos a transmitir os resultados para fornecer uma interface de usuário mais ágil na resposta.</span><span class="sxs-lookup"><span data-stu-id="9fe75-116">A common use of this option is to force a chunk-merging operator to stream its results in order to provide a more responsive user interface.</span></span>  
  
## <a name="parallelmergeoptions"></a><span data-ttu-id="9fe75-117">ParallelMergeOptions</span><span class="sxs-lookup"><span data-stu-id="9fe75-117">ParallelMergeOptions</span></span>  
 <span data-ttu-id="9fe75-118">A enumeração <xref:System.Linq.ParallelMergeOptions> inclui as seguintes opções que especificam, para formas de consulta com suporte, como a saída final da consulta será produzida quando os resultados forem consumidos em um thread:</span><span class="sxs-lookup"><span data-stu-id="9fe75-118">The <xref:System.Linq.ParallelMergeOptions> enumeration includes the following options that specify, for supported query shapes, how the final output of the query is yielded when the results are consumed on one thread:</span></span>  
  
- `Not Buffered`  
  
     <span data-ttu-id="9fe75-119">A opção <xref:System.Linq.ParallelMergeOptions.NotBuffered> faz com que cada elemento processado seja retornado de cada thread assim que ele for produzido.</span><span class="sxs-lookup"><span data-stu-id="9fe75-119">The <xref:System.Linq.ParallelMergeOptions.NotBuffered> option causes each processed element to be returned from each thread as soon as it is produced.</span></span> <span data-ttu-id="9fe75-120">Esse comportamento é semelhante a fazer "streaming" da saída.</span><span class="sxs-lookup"><span data-stu-id="9fe75-120">This behavior is analogous to "streaming" the output.</span></span> <span data-ttu-id="9fe75-121">Se o operador <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> estiver presente na consulta, `NotBuffered` preservará a ordem dos elementos de origem.</span><span class="sxs-lookup"><span data-stu-id="9fe75-121">If the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator is present in the query, `NotBuffered` preserves the order of the source elements.</span></span> <span data-ttu-id="9fe75-122">Embora `NotBuffered` comece a produzir os resultados assim que estiverem disponíveis, o tempo total para produzir todos os resultados ainda pode ser maior do que usar uma das outras opções de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="9fe75-122">Although `NotBuffered` starts yielding results as soon as they're available, the total time to produce all the results might still be longer than using one of the other merge options.</span></span>  
  
- `Auto Buffered`  
  
     <span data-ttu-id="9fe75-123">A opção <xref:System.Linq.ParallelMergeOptions.AutoBuffered> faz com que a consulta colete elementos em um buffer e, em seguida, gere periodicamente todo o conteúdo do buffer de uma vez para o thread de consumo.</span><span class="sxs-lookup"><span data-stu-id="9fe75-123">The <xref:System.Linq.ParallelMergeOptions.AutoBuffered> option causes the query to collect elements into a buffer and then periodically yield the buffer contents all at once to the consuming thread.</span></span> <span data-ttu-id="9fe75-124">Isso equivale a gerar os dados de origem em "partes" em vez de usar o comportamento de "streaming" de `NotBuffered`.</span><span class="sxs-lookup"><span data-stu-id="9fe75-124">This is analogous to yielding the source data in "chunks" instead of using the "streaming" behavior of `NotBuffered`.</span></span> <span data-ttu-id="9fe75-125">`AutoBuffered` pode demorar mais do que `NotBuffered` para disponibilizar o primeiro elemento no thread de consumo.</span><span class="sxs-lookup"><span data-stu-id="9fe75-125">`AutoBuffered` may take longer than `NotBuffered` to make the first element available on the consuming thread.</span></span> <span data-ttu-id="9fe75-126">O tamanho do buffer e o comportamento exato do retorno não são configuráveis e podem variar dependendo de vários fatores relacionados à consulta.</span><span class="sxs-lookup"><span data-stu-id="9fe75-126">The size of the buffer and the exact yielding behavior are not configurable and may vary, depending on various factors that relate to the query.</span></span>  
  
- `FullyBuffered`  
  
     <span data-ttu-id="9fe75-127">A opção <xref:System.Linq.ParallelMergeOptions.FullyBuffered> faz com que a saída de toda a consulta seja armazenada em buffer antes que qualquer um dos elementos seja gerado.</span><span class="sxs-lookup"><span data-stu-id="9fe75-127">The <xref:System.Linq.ParallelMergeOptions.FullyBuffered> option causes the output of the whole query to be buffered before any of the elements are yielded.</span></span> <span data-ttu-id="9fe75-128">Quando você usa essa opção, pode demorar mais tempo para que o primeiro elemento fique disponível no thread de consumo, mas os resultados completos podem ainda ser produzidos mais rapidamente em comparação com as outras opções.</span><span class="sxs-lookup"><span data-stu-id="9fe75-128">When you use this option, it can take longer before the first element is available on the consuming thread, but the complete results might still be produced faster than by using the other options.</span></span>  
  
## <a name="query-operators-that-support-merge-options"></a><span data-ttu-id="9fe75-129">Operadores de consulta que dão suporte a opções de mesclagem</span><span class="sxs-lookup"><span data-stu-id="9fe75-129">Query Operators that Support Merge Options</span></span>  
 <span data-ttu-id="9fe75-130">A tabela a seguir lista os operadores que dão suporte a todos os modos de opções de mesclagem sujeitos às restrições especificadas.</span><span class="sxs-lookup"><span data-stu-id="9fe75-130">The following table lists the operators that support all merge option modes, subject to the specified restrictions.</span></span>  
  
|<span data-ttu-id="9fe75-131">Operador</span><span class="sxs-lookup"><span data-stu-id="9fe75-131">Operator</span></span>|<span data-ttu-id="9fe75-132">{1&gt;Restrições&lt;1}</span><span class="sxs-lookup"><span data-stu-id="9fe75-132">Restrictions</span></span>|  
|--------------|------------------|  
|<xref:System.Linq.ParallelEnumerable.AsEnumerable%2A>|<span data-ttu-id="9fe75-133">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-133">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Cast%2A>|<span data-ttu-id="9fe75-134">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-134">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Concat%2A>|<span data-ttu-id="9fe75-135">Consultas não ordenadas que têm apenas uma fonte de dados de Matriz ou Lista.</span><span class="sxs-lookup"><span data-stu-id="9fe75-135">Non-ordered queries that have an Array or List source only.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.DefaultIfEmpty%2A>|<span data-ttu-id="9fe75-136">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-136">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.OfType%2A>|<span data-ttu-id="9fe75-137">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-137">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Reverse%2A>|<span data-ttu-id="9fe75-138">Consultas não ordenadas que têm apenas uma fonte de dados de Matriz ou Lista.</span><span class="sxs-lookup"><span data-stu-id="9fe75-138">Non-ordered queries that have an Array or List source only.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Select%2A>|<span data-ttu-id="9fe75-139">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-139">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.SelectMany%2A>|<span data-ttu-id="9fe75-140">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-140">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Skip%2A>|<span data-ttu-id="9fe75-141">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-141">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Take%2A>|<span data-ttu-id="9fe75-142">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-142">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Where%2A>|<span data-ttu-id="9fe75-143">Nenhum</span><span class="sxs-lookup"><span data-stu-id="9fe75-143">None</span></span>|  
  
 <span data-ttu-id="9fe75-144">Todos os outros operadores da consulta PLINQ podem ignorar opções de mesclagem fornecidas pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="9fe75-144">All other PLINQ query operators might ignore user-provided merge options.</span></span> <span data-ttu-id="9fe75-145">Alguns operadores de consulta, por exemplo, <xref:System.Linq.ParallelEnumerable.Reverse%2A> e <xref:System.Linq.ParallelEnumerable.OrderBy%2A>, não conseguem gerar elementos até que todos eles sejam produzidos e reordenados.</span><span class="sxs-lookup"><span data-stu-id="9fe75-145">Some query operators, for example, <xref:System.Linq.ParallelEnumerable.Reverse%2A> and <xref:System.Linq.ParallelEnumerable.OrderBy%2A>, cannot yield any elements until all have been produced and reordered.</span></span> <span data-ttu-id="9fe75-146">Portanto, quando <xref:System.Linq.ParallelMergeOptions> é usado em uma consulta que também contém um operador, como <xref:System.Linq.ParallelEnumerable.Reverse%2A>, o comportamento de mesclagem não será aplicado à consulta até que esse operador produza seus resultados.</span><span class="sxs-lookup"><span data-stu-id="9fe75-146">Therefore, when <xref:System.Linq.ParallelMergeOptions> is used in a query that also contains an operator such as <xref:System.Linq.ParallelEnumerable.Reverse%2A>, the merge behavior will not be applied in the query until after that operator has produced its results.</span></span>  
  
 <span data-ttu-id="9fe75-147">A capacidade de alguns operadores para lidar com as opções de mesclagem depende do tipo da sequência de origem e se o operador <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> foi usado anteriormente na consulta.</span><span class="sxs-lookup"><span data-stu-id="9fe75-147">The ability of some operators to handle merge options depends on the type of the source sequence, and whether the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator was used earlier in the query.</span></span> <span data-ttu-id="9fe75-148"><xref:System.Linq.ParallelEnumerable.ForAll%2A> é sempre <xref:System.Linq.ParallelMergeOptions.NotBuffered>; ele suspende seus elementos imediatamente.</span><span class="sxs-lookup"><span data-stu-id="9fe75-148"><xref:System.Linq.ParallelEnumerable.ForAll%2A> is always <xref:System.Linq.ParallelMergeOptions.NotBuffered> ; it yields its elements immediately.</span></span> <span data-ttu-id="9fe75-149"><xref:System.Linq.ParallelEnumerable.OrderBy%2A> é sempre <xref:System.Linq.ParallelMergeOptions.FullyBuffered>; ele precisa classificar a lista inteira antes de suspendê-la.</span><span class="sxs-lookup"><span data-stu-id="9fe75-149"><xref:System.Linq.ParallelEnumerable.OrderBy%2A> is always <xref:System.Linq.ParallelMergeOptions.FullyBuffered>; it must sort the whole list before it yields.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9fe75-150">Consulte também</span><span class="sxs-lookup"><span data-stu-id="9fe75-150">See also</span></span>

- [<span data-ttu-id="9fe75-151">PLINQ (LINQ paralelo)</span><span class="sxs-lookup"><span data-stu-id="9fe75-151">Parallel LINQ (PLINQ)</span></span>](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)
- [<span data-ttu-id="9fe75-152">Como especificar opções de mesclagem em PLINQ</span><span class="sxs-lookup"><span data-stu-id="9fe75-152">How to: Specify Merge Options in PLINQ</span></span>](../../../docs/standard/parallel-programming/how-to-specify-merge-options-in-plinq.md)
