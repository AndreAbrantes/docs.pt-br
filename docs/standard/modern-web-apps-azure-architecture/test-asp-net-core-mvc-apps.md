---
title: Testar aplicativos MVC do ASP.NET Core
description: Projetar aplicativos Web modernos com ASP.NET Core e o Azure | Testar aplicativos MVC do ASP.NET Core
author: ardalis
ms.author: wiwagn
ms.date: 10/08/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: d23d0accc33fb8335dff602d6e1d6c8689972906
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/23/2017
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="acd37-103">Testar aplicativos MVC do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="acd37-103">Test ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="acd37-104">_"Se você não deseja que seu produto de teste de unidade, provavelmente os clientes não gostam de testá-lo, ou."_</span><span class="sxs-lookup"><span data-stu-id="acd37-104">_"If you don't like unit testing your product, most likely your customers won't like to test it, either."_</span></span>
> <span data-ttu-id="acd37-105">_ - Anônimo -</span><span class="sxs-lookup"><span data-stu-id="acd37-105">_- Anonymous-</span></span>

## <a name="summary"></a><span data-ttu-id="acd37-106">Resumo</span><span class="sxs-lookup"><span data-stu-id="acd37-106">Summary</span></span>

<span data-ttu-id="acd37-107">Software de qualquer complexidade pode falhar de maneiras inesperadas em resposta a alterações.</span><span class="sxs-lookup"><span data-stu-id="acd37-107">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="acd37-108">Assim, são necessário para todos os aplicativos mais simples (ou menos críticos), exceto testes depois de fazer alterações.</span><span class="sxs-lookup"><span data-stu-id="acd37-108">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="acd37-109">Teste manual é o mais lento, menos confiável de maneira mais cara para testar o software.</span><span class="sxs-lookup"><span data-stu-id="acd37-109">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="acd37-110">Infelizmente, se os aplicativos não são projetados para ser testável, pode ser o único meio disponível.</span><span class="sxs-lookup"><span data-stu-id="acd37-110">Unfortunately, if applications are not designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="acd37-111">Aplicativos escritos os princípios de arquitetura apresentados a seguir no capítulo X devem ser um teste de unidade e integração automatizada e testes funcionais também dar suporte a aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="acd37-111">Applications written following the architectural principles laid out in chapter X should be unit testable, and ASP.NET Core applications support automated integration and functional testing as well.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="acd37-112">Tipos de testes automatizados</span><span class="sxs-lookup"><span data-stu-id="acd37-112">Kinds of Automated Tests</span></span>

<span data-ttu-id="acd37-113">Há muitos tipos de testes automatizados para aplicativos de software.</span><span class="sxs-lookup"><span data-stu-id="acd37-113">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="acd37-114">A forma mais simples, teste de nível mais baixo é o teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-114">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="acd37-115">Em um nível superior ligeiramente há testes de integração e testes funcionais.</span><span class="sxs-lookup"><span data-stu-id="acd37-115">At a slightly higher level there are integration tests and functional tests.</span></span> <span data-ttu-id="acd37-116">Outros tipos de testes, como testes de interface do usuário, testes de carga, testes de estresse e testes smoke, estão além do escopo deste documento.</span><span class="sxs-lookup"><span data-stu-id="acd37-116">Other kinds of tests, like UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="acd37-117">Testes de Unidade</span><span class="sxs-lookup"><span data-stu-id="acd37-117">Unit Tests</span></span>

<span data-ttu-id="acd37-118">Um teste de unidade testa uma única parte da lógica do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="acd37-118">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="acd37-119">Ainda mais um pode descrevê-lo por meio da lista algumas das coisas que não é.</span><span class="sxs-lookup"><span data-stu-id="acd37-119">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="acd37-120">Um teste de unidade não testa como a código funciona com dependências ou infraestrutura – que é o que a integração de testes destinam-se.</span><span class="sxs-lookup"><span data-stu-id="acd37-120">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="acd37-121">Um teste de unidade não testa a estrutura de em que seu código é escrito – você deve pressupor que ele funciona ou se achar que não, registrar um bug e uma solução alternativa de código.</span><span class="sxs-lookup"><span data-stu-id="acd37-121">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="acd37-122">Um teste de unidade é executado completamente na memória e no processo.</span><span class="sxs-lookup"><span data-stu-id="acd37-122">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="acd37-123">Ele não se comunicar com o sistema de arquivos, rede ou um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="acd37-123">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="acd37-124">Testes de unidade só devem testar seu código.</span><span class="sxs-lookup"><span data-stu-id="acd37-124">Unit tests should only test your code.</span></span>

<span data-ttu-id="acd37-125">Testes de unidade, devido ao fato de que eles testar apenas uma única unidade de seu código, sem dependências externas, devem ser executado muito rapidamente.</span><span class="sxs-lookup"><span data-stu-id="acd37-125">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely quickly.</span></span> <span data-ttu-id="acd37-126">Assim, você deve ser capaz de executar os pacotes de testes de centenas de testes de unidade em alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="acd37-126">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="acd37-127">Executá-los com frequência, idealmente antes de cada envio por push para um repositório de controle do código-fonte compartilhado e certamente com cada compilação automatizada em seu servidor de compilação.</span><span class="sxs-lookup"><span data-stu-id="acd37-127">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="acd37-128">Testes de integração</span><span class="sxs-lookup"><span data-stu-id="acd37-128">Integration Tests</span></span>

<span data-ttu-id="acd37-129">Embora seja uma boa ideia para encapsular o código que interage com a infraestrutura, como bancos de dados e sistemas de arquivos, você ainda terá algumas que o código e você provavelmente desejará testá-lo.</span><span class="sxs-lookup"><span data-stu-id="acd37-129">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="acd37-130">Além disso, você deve verificar que camadas do seu código interagem conforme o esperado quando dependências do aplicativo são totalmente resolvidas.</span><span class="sxs-lookup"><span data-stu-id="acd37-130">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="acd37-131">Isso é responsabilidade de testes de integração.</span><span class="sxs-lookup"><span data-stu-id="acd37-131">This is the responsibility of integration tests.</span></span> <span data-ttu-id="acd37-132">Testes de integração tendem a ser mais lento e mais difícil de configurar que testes de unidade, porque eles geralmente dependem de infraestrutura e as dependências externas.</span><span class="sxs-lookup"><span data-stu-id="acd37-132">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="acd37-133">Portanto, você deve evitar coisas que podem ser testes com testes de unidade em testes de integração de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-133">Thus, you should avoid testing things that could be tests with unit tests in integration tests.</span></span> <span data-ttu-id="acd37-134">Se você pode testar um determinado cenário com um teste de unidade, você deve testá-lo com um teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-134">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="acd37-135">Se não for possível, considere usar um teste de integração.</span><span class="sxs-lookup"><span data-stu-id="acd37-135">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="acd37-136">Testes de integração geralmente terá uma configuração mais complexa e procedimentos de desmontagem de testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-136">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="acd37-137">Por exemplo, um teste de integração que vai em relação a um banco de dados real precisará de uma maneira de retornar o banco de dados para um estado conhecido antes de cada execução de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-137">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="acd37-138">Conforme novos testes são adicionados e o esquema de banco de dados de produção evolui, esses scripts tendem a aumentar em tamanho e complexidade de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-138">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="acd37-139">Em muitos sistemas grandes, não é prático para executar pacotes completos de testes de integração em estações de trabalho do desenvolvedor antes de verificar as alterações ao controle do código-fonte compartilhado.</span><span class="sxs-lookup"><span data-stu-id="acd37-139">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="acd37-140">Nesses casos, os testes de integração podem ser executados em um servidor de compilação.</span><span class="sxs-lookup"><span data-stu-id="acd37-140">In these cases, integration tests may be run on a build server.</span></span>

<span data-ttu-id="acd37-141">A classe de implementação LocalFileImageService implementa a lógica para buscar e retornando os bytes de um arquivo de imagem de uma pasta específica recebe uma id:</span><span class="sxs-lookup"><span data-stu-id="acd37-141">The LocalFileImageService implementation class implements the logic for fetching and returning the bytes of an image file from a particular folder given an id:</span></span>

```cs
public class LocalFileImageService : IImageService
{
    private readonly IHostingEnvironment _env;
    public LocalFileImageService(IHostingEnvironment env)
    {
        _env = env;
    }
    public byte[] GetImageBytesById(int id)
    {
        try
        {
            var contentRoot = _env.ContentRootPath + "//Pics";
            var path = Path.Combine(contentRoot, id + ".png");
            return File.ReadAllBytes(path);
```

### <a name="functional-tests"></a><span data-ttu-id="acd37-142">Testes funcionais</span><span class="sxs-lookup"><span data-stu-id="acd37-142">Functional Tests</span></span>

<span data-ttu-id="acd37-143">Testes de integração são gravados do ponto de vista do desenvolvedor, verifique se que alguns componentes do sistema funcionem corretamente.</span><span class="sxs-lookup"><span data-stu-id="acd37-143">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="acd37-144">Testes funcionais são escritos da perspectiva do usuário e verificar a integridade do sistema com base em seus requisitos.</span><span class="sxs-lookup"><span data-stu-id="acd37-144">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="acd37-145">O trecho a seguir oferece uma analogia útil para pensar sobre testes funcionais, em comparação comparadas testes de unidade como:</span><span class="sxs-lookup"><span data-stu-id="acd37-145">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="acd37-146">"Muitas vezes o desenvolvimento de um sistema é comparado a construção de uma casa.</span><span class="sxs-lookup"><span data-stu-id="acd37-146">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="acd37-147">Embora essa analogia não seja bastante correta, podemos poderá estendê-lo para fins de compreender a diferença entre unidade e testes funcionais.</span><span class="sxs-lookup"><span data-stu-id="acd37-147">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="acd37-148">Testes de unidade é análoga a um Inspetor de construção, visite o site de construção de uma casa.</span><span class="sxs-lookup"><span data-stu-id="acd37-148">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="acd37-149">Ele destina-se em vários sistemas internos de casa, a base de enquadramento, elétrica, encanamento e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="acd37-149">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="acd37-150">Ele garante (testes) que as partes da casa funcionarão corretamente e com segurança, ou seja, atender o código de construção.</span><span class="sxs-lookup"><span data-stu-id="acd37-150">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="acd37-151">Testes funcionais neste cenário são análogos ao imóvel visitar esse mesmo site de construção.</span><span class="sxs-lookup"><span data-stu-id="acd37-151">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="acd37-152">Ele pressupõe que os sistemas internos irão se comportar adequadamente, que o Inspetor de construção está executando suas tarefas.</span><span class="sxs-lookup"><span data-stu-id="acd37-152">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="acd37-153">O proprietário é focado em que será como vida essa casa.</span><span class="sxs-lookup"><span data-stu-id="acd37-153">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="acd37-154">Ele está preocupada com a aparência da casa, são as várias rooms um tamanho confortável, é a casa atender às necessidades da família, são as janelas um bom ponto para capturar o sun da manhã.</span><span class="sxs-lookup"><span data-stu-id="acd37-154">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="acd37-155">O proprietário está executando testes funcionais em casa.</span><span class="sxs-lookup"><span data-stu-id="acd37-155">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="acd37-156">Ele tem um ponto de vista do usuário.</span><span class="sxs-lookup"><span data-stu-id="acd37-156">He has the user's perspective.</span></span> <span data-ttu-id="acd37-157">O Inspetor de construção está executando testes de unidade em casa.</span><span class="sxs-lookup"><span data-stu-id="acd37-157">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="acd37-158">Ele tem perspectiva do construtor."</span><span class="sxs-lookup"><span data-stu-id="acd37-158">He has the builder's perspective."</span></span>

<span data-ttu-id="acd37-159">Fonte: [versus testes funcionais de teste de unidade](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span><span class="sxs-lookup"><span data-stu-id="acd37-159">Source: [Unit Testing versus Functional Tests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="acd37-160">Estou de jogos de dizer "como os desenvolvedores, podemos falha de duas maneiras: criamos a coisa errada ou criamos a coisa errada."</span><span class="sxs-lookup"><span data-stu-id="acd37-160">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="acd37-161">Testes de unidade, verifique se que você está criando o direito de coisa; testes funcionais Verifique se que você está criando o certo.</span><span class="sxs-lookup"><span data-stu-id="acd37-161">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="acd37-162">Desde que os testes funcionais operam no nível do sistema, eles podem exigir um certo grau de automação de interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="acd37-162">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="acd37-163">Como testes de integração, elas geralmente funcionam com algum tipo de infraestrutura de teste também.</span><span class="sxs-lookup"><span data-stu-id="acd37-163">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="acd37-164">Isso os torna mais lento e mais frágil que testes de unidade e a integração.</span><span class="sxs-lookup"><span data-stu-id="acd37-164">This makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="acd37-165">Você deve ter somente quantos testes funcionais conforme necessário garantir que o sistema está se comportando conforme esperam de usuários.</span><span class="sxs-lookup"><span data-stu-id="acd37-165">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="acd37-166">Teste de pirâmide</span><span class="sxs-lookup"><span data-stu-id="acd37-166">Testing Pyramid</span></span>

<span data-ttu-id="acd37-167">Martin Fowler gravou sobre a teste pirâmide, um exemplo é mostrado na Figura 9-1.</span><span class="sxs-lookup"><span data-stu-id="acd37-167">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![](./media/image9-1.png)

<span data-ttu-id="acd37-168">Figura 9-1 teste pirâmide</span><span class="sxs-lookup"><span data-stu-id="acd37-168">Figure 9-1 Testing Pyramid</span></span>

<span data-ttu-id="acd37-169">As diferentes camadas de pirâmide e seus tamanhos relativos, representam tipos diferentes de testes e quantos você deve escrever para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="acd37-169">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="acd37-170">Como você pode ver, a recomendação é ter uma grande base de testes de unidade, suportados por uma camada menor de testes de integração, com uma camada ainda menor de testes funcionais.</span><span class="sxs-lookup"><span data-stu-id="acd37-170">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="acd37-171">Cada camada idealmente deve ter somente testes que não pode ser executada de forma adequada em uma camada inferior.</span><span class="sxs-lookup"><span data-stu-id="acd37-171">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="acd37-172">Lembre-se da pirâmide teste quando você estiver tentando decidir qual tipo de teste para um cenário específico.</span><span class="sxs-lookup"><span data-stu-id="acd37-172">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="acd37-173">O que testar</span><span class="sxs-lookup"><span data-stu-id="acd37-173">What to Test</span></span>

<span data-ttu-id="acd37-174">Um problema comum para os desenvolvedores que não tiver experiência com a criação de testes automatizados está chegando com o teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-174">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="acd37-175">É um bom ponto de partida testar a lógica condicional.</span><span class="sxs-lookup"><span data-stu-id="acd37-175">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="acd37-176">Onde quer que tenha um método com o comportamento que as alterações com base em uma instrução condicional (if-else, alternar, etc.), você poderá criar pelo menos dois testes que confirmam se o comportamento correto para determinadas condições.</span><span class="sxs-lookup"><span data-stu-id="acd37-176">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, etc.), you should be able to come up at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="acd37-177">Se seu código tem condições de erro, é melhor criar pelo menos um teste para o "caminho feliz" através do código (com sem erros) e pelo menos um teste para o "caminho sad" (com erros ou resultados atípicos) para confirmar que seu aplicativo se comporta como esperado no caso de erros.</span><span class="sxs-lookup"><span data-stu-id="acd37-177">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="acd37-178">Por fim, tente se concentrar no teste de coisas que podem falhar, em vez de nos concentrarmos no métricas como cobertura de código.</span><span class="sxs-lookup"><span data-stu-id="acd37-178">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="acd37-179">Cobertura de código mais geralmente é melhor do que o menor.</span><span class="sxs-lookup"><span data-stu-id="acd37-179">More code coverage is better than less, generally.</span></span> <span data-ttu-id="acd37-180">No entanto, gravar alguns testes mais de um método muito complexo e críticos para os negócios é normalmente um melhor uso de tempo que escrever testes para autopropriedades apenas para melhorar as métricas de cobertura de código de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-180">However, writing a few more tests of a very complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="acd37-181">Organizar projetos de teste</span><span class="sxs-lookup"><span data-stu-id="acd37-181">Organizing Test Projects</span></span>

<span data-ttu-id="acd37-182">Projetos de teste podem ser organizados, mas funciona melhor para você.</span><span class="sxs-lookup"><span data-stu-id="acd37-182">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="acd37-183">É uma boa ideia separe os testes por tipo (teste de unidade, teste de integração) e o estão sendo testado (por projeto, namespace).</span><span class="sxs-lookup"><span data-stu-id="acd37-183">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="acd37-184">Se essa separação consistirá de pastas dentro de um projeto de teste único ou vários projetos de teste, é uma decisão de design.</span><span class="sxs-lookup"><span data-stu-id="acd37-184">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="acd37-185">Um projeto é mais simples, mas para projetos grandes, com muitos testes ou para executar mais facilmente os diferentes conjuntos de testes, você talvez queira ter vários projetos de teste diferente.</span><span class="sxs-lookup"><span data-stu-id="acd37-185">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="acd37-186">Muitas equipes organizam projetos de teste baseados no projeto que estão testando, que pode resultar em um grande número de projetos de teste, especialmente se você ainda dividir essas acordo com os tipo de testes que estão em cada projeto para aplicativos com mais de alguns projetos.</span><span class="sxs-lookup"><span data-stu-id="acd37-186">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="acd37-187">Uma abordagem de comprometimento é ter um projeto por tipo de teste, por aplicativo, com pastas dentro de projetos de teste para indicar o projeto (e a classe) que está sendo testado.</span><span class="sxs-lookup"><span data-stu-id="acd37-187">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="acd37-188">Uma abordagem comum é organizar os projetos de aplicativo em uma pasta de 'src' e projetos de teste do aplicativo em uma pasta de 'teste' paralelos.</span><span class="sxs-lookup"><span data-stu-id="acd37-188">A common approach is to organize the application projects under a ‘src' folder, and the application's test projects under a parallel ‘tests' folder.</span></span> <span data-ttu-id="acd37-189">Você pode criar pastas de solução correspondente no Visual Studio, se você encontrar esta organização útil.</span><span class="sxs-lookup"><span data-stu-id="acd37-189">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![](./media/image9-2.png)

<span data-ttu-id="acd37-190">Figura 9-2 organização de teste em sua solução</span><span class="sxs-lookup"><span data-stu-id="acd37-190">Figure 9-2 Test organization in your solution</span></span>

<span data-ttu-id="acd37-191">Você pode usar qualquer estrutura de teste que você preferir.</span><span class="sxs-lookup"><span data-stu-id="acd37-191">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="acd37-192">A estrutura xUnit funciona bem e que todos os testes do ASP.NET Core e EF principal são gravados.</span><span class="sxs-lookup"><span data-stu-id="acd37-192">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="acd37-193">Você pode adicionar um projeto de teste xUnit no Visual Studio usando o modelo mostrado na Figura 9-3 ou da CLI usando dotnet xunit de novo.</span><span class="sxs-lookup"><span data-stu-id="acd37-193">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.</span></span>

![](./media/image9-3.png)

<span data-ttu-id="acd37-194">Figura 9-3 adicionar um projeto de teste xUnit no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="acd37-194">Figure 9-3 Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="acd37-195">Teste de nomenclatura</span><span class="sxs-lookup"><span data-stu-id="acd37-195">Test Naming</span></span>

<span data-ttu-id="acd37-196">Você deve nomear os testes de maneira consistente, com nomes que indiquem o que faz cada teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-196">You should name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="acd37-197">É uma abordagem com que tive grande sucesso classes de nome de teste de acordo com a classe e o método que estão sendo testado.</span><span class="sxs-lookup"><span data-stu-id="acd37-197">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="acd37-198">Isso resulta em várias classes de teste pequena, mas ele torna extremamente limpar o que é responsável por cada teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-198">This results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="acd37-199">Com o nome de classe de teste configurado para identificar a classe e o método a ser testada, o nome do método de teste pode ser usado para especificar o comportamento que está sendo testado.</span><span class="sxs-lookup"><span data-stu-id="acd37-199">With the test class name set up to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="acd37-200">Isso deve incluir o comportamento esperado e qualquer entrada ou suposições que devem gerar esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="acd37-200">This should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="acd37-201">Alguns exemplos de nomes de teste:</span><span class="sxs-lookup"><span data-stu-id="acd37-201">Some example test names:</span></span>

-   <span data-ttu-id="acd37-202">CatalogControllerGetImage.CallsImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="acd37-202">CatalogControllerGetImage.CallsImageServiceWithId</span></span>

-   <span data-ttu-id="acd37-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="acd37-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span></span>

-   <span data-ttu-id="acd37-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span><span class="sxs-lookup"><span data-stu-id="acd37-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span></span>

-   <span data-ttu-id="acd37-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="acd37-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span></span>

<span data-ttu-id="acd37-206">Uma variação dessa abordagem termina o nome de cada classe de teste com "Deve" e modifica os tempos verbais ligeiramente:</span><span class="sxs-lookup"><span data-stu-id="acd37-206">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

-   <span data-ttu-id="acd37-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="acd37-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span></span>

-   <span data-ttu-id="acd37-208">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="acd37-208">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span></span>

<span data-ttu-id="acd37-209">Algumas equipes localizar a segunda abordagem de nomenclatura mais clara, embora um pouco mais detalhado.</span><span class="sxs-lookup"><span data-stu-id="acd37-209">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="acd37-210">Em qualquer caso, tente usar uma convenção de nomenclatura que fornece informações sobre o comportamento de teste, para que quando um ou mais testes falharem, seja óbvio em seus nomes quais casos falharam.</span><span class="sxs-lookup"><span data-stu-id="acd37-210">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="acd37-211">Evite nomeando testes vagamente, como ControllerTests.Test1, como eles oferecem nenhum valor quando você vê-los nos resultados de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-211">Avoid naming you tests vaguely, such as ControllerTests.Test1, as these offer no value when you see them in test results.</span></span>

<span data-ttu-id="acd37-212">Se você seguir uma convenção de nomenclatura, como mostrado acima que produz muitas classes de teste pequena, é uma boa ideia para organizar ainda mais seus testes usando pastas e namespaces.</span><span class="sxs-lookup"><span data-stu-id="acd37-212">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="acd37-213">Figura 9-4 mostra uma abordagem para organizar testes por pasta em vários projetos de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-213">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![](./media/image9-4.png)

<span data-ttu-id="acd37-214">**Figura 9-4.**</span><span class="sxs-lookup"><span data-stu-id="acd37-214">**Figure 9-4.**</span></span> <span data-ttu-id="acd37-215">Organizando classes de teste por pasta com base na classe que está sendo testado.</span><span class="sxs-lookup"><span data-stu-id="acd37-215">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="acd37-216">É claro que, se uma classe específica do aplicativo tem muitos métodos que está sendo testados (e, portanto, muitas classes de teste), talvez faça sentido para colocá-los em uma pasta correspondente para a classe do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="acd37-216">Of course, if a particular application class has many methods being tested (and thus many test classes), it may make sense to place these in a folder corresponding to the application class.</span></span> <span data-ttu-id="acd37-217">Esta organização não é diferente de como você pode organizar arquivos em pastas em outro lugar.</span><span class="sxs-lookup"><span data-stu-id="acd37-217">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="acd37-218">Se você tiver mais de três ou quatro arquivos em uma pasta que contém muitos outros arquivos relacionados a, geralmente é útil para movê-los em sua própria subpasta.</span><span class="sxs-lookup"><span data-stu-id="acd37-218">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="acd37-219">Aplicativos de ASP.NET Core de teste de unidade</span><span class="sxs-lookup"><span data-stu-id="acd37-219">Unit Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="acd37-220">Em um aplicativo bem projetado do ASP.NET Core, a maioria da complexidade e lógica de negócios será encapsulada em entidades de negócios e uma variedade de serviços.</span><span class="sxs-lookup"><span data-stu-id="acd37-220">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="acd37-221">O aplicativo ASP.NET MVC de núcleo em si, com seus controladores, filtros, viewmodels e modos de exibição, deve exigir muito poucos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-221">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require very few unit tests.</span></span> <span data-ttu-id="acd37-222">Muitas das funcionalidades de uma determinada ação está fora do método de ação.</span><span class="sxs-lookup"><span data-stu-id="acd37-222">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="acd37-223">Teste se o roteamento funciona corretamente ou o tratamento de erro global, não pode ser feito efetivamente com um teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-223">Testing whether routing works correctly, or global error handling, cannot be done effectively with a unit test.</span></span> <span data-ttu-id="acd37-224">Da mesma forma, quaisquer filtros, incluindo autenticação e validação de modelo e filtros de autorização, não pode ser teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-224">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested.</span></span> <span data-ttu-id="acd37-225">Sem essas fontes de comportamento, a maioria dos métodos de ação deve ser muito pequeno, a maior parte do seu trabalho para serviços que pode ser testado independentemente do controlador que usa a delegação.</span><span class="sxs-lookup"><span data-stu-id="acd37-225">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="acd37-226">Às vezes, você precisará refatorar o código de pedido para teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-226">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="acd37-227">Com frequência, isso envolve identificando abstrações e usando a injeção de dependência para acessar a abstração no código que você deseja testar, em vez de codificar diretamente na infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="acd37-227">Frequently this involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="acd37-228">Por exemplo, considere este método de ação simples para exibir imagens:</span><span class="sxs-lookup"><span data-stu-id="acd37-228">For example, consider this simple action method for displaying images:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="acd37-229">Esse método de teste de unidade torna difícil por sua dependência direta System.IO, que ele usa para ler do sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="acd37-229">Unit testing this method is made difficult by its direct dependency on System.IO.File, which it uses to read from the file system.</span></span> <span data-ttu-id="acd37-230">Você pode testar esse comportamento para garantir que ele funciona conforme o esperado, mas fazer isso com arquivos reais é um teste de integração.</span><span class="sxs-lookup"><span data-stu-id="acd37-230">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="acd37-231">Vale a pena observar não é possível testar rota desse método – você verá como fazer isso com um teste funcional em breve.</span><span class="sxs-lookup"><span data-stu-id="acd37-231">It's worth noting you can't test this method's route – you'll see how to do this with a functional test shortly.</span></span>

<span data-ttu-id="acd37-232">Se você não é o comportamento do sistema de arquivos de teste de unidade diretamente e não é possível testar a rota, o que há testar?</span><span class="sxs-lookup"><span data-stu-id="acd37-232">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="acd37-233">Bem, depois de refatoração para possibilitar o teste de unidade, você pode descobrir alguns casos de teste e comportamento ausente, como o tratamento de erros.</span><span class="sxs-lookup"><span data-stu-id="acd37-233">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="acd37-234">O que o método faz quando não for encontrado um arquivo?</span><span class="sxs-lookup"><span data-stu-id="acd37-234">What does the method do when a file isn't found?</span></span> <span data-ttu-id="acd37-235">O que ele deve fazer?</span><span class="sxs-lookup"><span data-stu-id="acd37-235">What should it do?</span></span> <span data-ttu-id="acd37-236">Neste exemplo, o método refatorado tem esta aparência:</span><span class="sxs-lookup"><span data-stu-id="acd37-236">In this example, the refactored method looks like this:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")\]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="acd37-237">O \_agente e \_imageService são injetadas como dependências.</span><span class="sxs-lookup"><span data-stu-id="acd37-237">The \_logger and \_imageService are both injected as dependencies.</span></span> <span data-ttu-id="acd37-238">Agora você pode testar se a mesma id que é passada para o método de ação é passada para o \_imageService, e que os bytes resultantes serão retornados como parte do FileResult.</span><span class="sxs-lookup"><span data-stu-id="acd37-238">Now you can test that the same id that is passed to the action method is passed to the \_imageService, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="acd37-239">Você também pode testar que o log de erros está ocorrendo conforme o esperado, e que um resultado encontrado será retornado se a imagem estiver ausente, supondo que esse é o comportamento de aplicativo importantes (ou seja, não apenas código temporário o desenvolvedor adicionado para diagnosticar um problema).</span><span class="sxs-lookup"><span data-stu-id="acd37-239">You can also test that error logging is happening as expected, and that a NotFound result is returned if the image is missing, assuming this is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="acd37-240">A lógica real do arquivo foi movido para um serviço de implementação separada e foi aumentada para retornar uma exceção específica do aplicativo para o caso de um arquivo ausente.</span><span class="sxs-lookup"><span data-stu-id="acd37-240">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="acd37-241">Você pode testar essa implementação de forma independente, usando um teste de integração.</span><span class="sxs-lookup"><span data-stu-id="acd37-241">You can test this implementation independently, using an integration test.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="acd37-242">Integração de teste ASP.NET Core aplicativos</span><span class="sxs-lookup"><span data-stu-id="acd37-242">Integration Testing ASP.NET Core Apps</span></span>

```cs
    }
        catch (FileNotFoundException ex)
        {
            throw new CatalogImageMissingException(ex);
        }
    }
}
```

<span data-ttu-id="acd37-243">Esse serviço usa IHostingEnvironment, assim como o CatalogController código foi antes que ele foi refatorado em um serviço separado.</span><span class="sxs-lookup"><span data-stu-id="acd37-243">This service uses the IHostingEnvironment, just as the CatalogController code did before it was refactored into a separate service.</span></span> <span data-ttu-id="acd37-244">Já que esse foi o código somente no controlador que usado IHostingEnvironment, essa dependência foi removida do construtor do CatalogController.</span><span class="sxs-lookup"><span data-stu-id="acd37-244">Since this was the only code in the controller that used IHostingEnvironment, that dependency was removed from CatalogController's constructor.</span></span>

<span data-ttu-id="acd37-245">Para testar a que este serviço está funcionando corretamente, você precisa criar um arquivo de imagem de teste conhecido e verificar que o serviço retorna uma entrada específica.</span><span class="sxs-lookup"><span data-stu-id="acd37-245">To test that this service works correctly, you need to create a known test image file and verify that the service returns it given a specific input.</span></span> <span data-ttu-id="acd37-246">Você deve ter cuidado para não usar objetos fictícios o comportamento que você realmente deseja testar (nesse caso, o sistema de arquivos de leitura).</span><span class="sxs-lookup"><span data-stu-id="acd37-246">You should take care not to use mock objects on the behavior you actually want to test (in this case, reading from the file system).</span></span> <span data-ttu-id="acd37-247">No entanto, os objetos fictícios ainda podem ser útil para configurar testes de integração.</span><span class="sxs-lookup"><span data-stu-id="acd37-247">However, mock objects may still be useful to set up integration tests.</span></span> <span data-ttu-id="acd37-248">Nesse caso, você pode simular IHostingEnvironment para que seu ContentRootPath aponta para a pasta que você pretende usar para a imagem de teste.</span><span class="sxs-lookup"><span data-stu-id="acd37-248">In this case, you can mock IHostingEnvironment so that its ContentRootPath points to the folder you're going to use for your test image.</span></span> <span data-ttu-id="acd37-249">A classe de teste de integração completa do trabalho é mostrada aqui:</span><span class="sxs-lookup"><span data-stu-id="acd37-249">The complete working integration test class is shown here:</span></span>

```cs
public class LocalFileImageServiceGetImageBytesById
{
    private byte[] _testBytes = new byte[] { 0x01, 0x02, 0x03 };
    private readonly Mock<IHostingEnvironment> _mockEnvironment = new Mock<IHostingEnvironment>();
    private int _testImageId = 123;
    private string _testFileName = "123.png";
    public LocalFileImageServiceGetImageBytesById()
    {
        // create folder if necessary
        Directory.CreateDirectory(Path.Combine(GetFileDirectory(), "Pics"));
        string filePath = GetFilePath(_testFileName);
        System.IO.File.WriteAllBytes(filePath, _testBytes);
        _mockEnvironment.SetupGet<string>(m => m.ContentRootPath).Returns(GetFileDirectory());
    }
    private string GetFilePath(string fileName)
    {
        return Path.Combine(GetFileDirectory(), "Pics", fileName);
        }
            private string GetFileDirectory()
        {
            var location = System.Reflection.Assembly.GetEntryAssembly().Location;
            return Path.GetDirectoryName(location);
        }

        [Fact]
        public void ReturnsFileContentResultGivenValidId()
        {
            var fileService = new LocalFileImageService(_mockEnvironment.Object);
            var result = fileService.GetImageBytesById(_testImageId);
            Assert.Equal(_testBytes, result);
        }
    }
```

> [!NOTE]
> <span data-ttu-id="acd37-250">a maior parte do código que o teste é muito simple, é necessária para configurar o sistema e criar a infraestrutura de teste (no caso, um arquivo real ser lidas do disco).</span><span class="sxs-lookup"><span data-stu-id="acd37-250">that the test itself is very simple – the bulk of the code is necessary to configure the system and create the testing infrastructure (in this case, an actual file to be read from disk).</span></span> <span data-ttu-id="acd37-251">Isso é típico para testes de integração, que geralmente exigem o trabalho de configuração mais complexo que testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="acd37-251">This is typical for integration tests, which often require more complex setup work than unit tests.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="acd37-252">Testando aplicativos do ASP.NET Core funcional</span><span class="sxs-lookup"><span data-stu-id="acd37-252">Functional Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="acd37-253">Para aplicativos do ASP.NET Core, a classe TestServer faz testes funcionais relativamente fáceis de escrever.</span><span class="sxs-lookup"><span data-stu-id="acd37-253">For ASP.NET Core applications, the TestServer class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="acd37-254">Você configurar um TestServer usando um WebHostBuilder, assim como faria normalmente para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="acd37-254">You configure a TestServer using a WebHostBuilder, just as you normally do for your application.</span></span> <span data-ttu-id="acd37-255">Este WebHostBuilder deve ser configurado como host real do seu aplicativo, mas você pode modificar qualquer aspectos que facilitar os testes.</span><span class="sxs-lookup"><span data-stu-id="acd37-255">This WebHostBuilder should be configured just like your application's real host, but you can modify any aspects of it that make testing easier.</span></span> <span data-ttu-id="acd37-256">Na maioria das vezes, você vai utilizar o mesmo TestServer em muitos casos de teste, para que você pode encapsulá-lo em um método reutilizável (talvez em uma classe base):</span><span class="sxs-lookup"><span data-stu-id="acd37-256">Most of the time, you'll reuse the same TestServer for many test cases, so you can encapsulate it in a reusable method (perhaps in a base class):</span></span>

```cs
public abstract class BaseWebTest
{
    protected readonly HttpClient _client;
    protected string _contentRoot;

    public BaseWebTest()
    {
        _client = GetClient();
    }
    
    protected HttpClient GetClient()
    {
        var startupAssembly = typeof(Startup).GetTypeInfo().Assembly;
        _contentRoot = GetProjectPath("src", startupAssembly);
        var builder = new WebHostBuilder()
        .UseContentRoot(_contentRoot)
        .UseStartup&lt;Startup&gt;();
        var server = new TestServer(builder);
        var client = server.CreateClient();
        return client;
    }
}
```

<span data-ttu-id="acd37-257">O método GetProjectPath simplesmente retorna o caminho físico para o projeto da web (solução de exemplo de download).</span><span class="sxs-lookup"><span data-stu-id="acd37-257">The GetProjectPath method simply returns the physical path to the web project (download sample solution).</span></span> <span data-ttu-id="acd37-258">O WebHostBuilder nesse caso simplesmente especifica onde o conteúdo raiz para o aplicativo web e referencia a mesma classe de inicialização que usa o aplicativo web real.</span><span class="sxs-lookup"><span data-stu-id="acd37-258">The WebHostBuilder in this case simply specifies where the content root for the web application is, and references the same Startup class the real web application uses.</span></span> <span data-ttu-id="acd37-259">Para trabalhar com o TestServer, você pode usar o tipo de System.Net.HttpClient para fazer solicitações a ele.</span><span class="sxs-lookup"><span data-stu-id="acd37-259">To work with the TestServer, you use the standard System.Net.HttpClient type to make requests to it.</span></span> <span data-ttu-id="acd37-260">TestServer expõe um método de CreateClient útil que fornece um cliente pré-configurado que está pronto para fazer solicitações para o aplicativo em execução no TestServer.</span><span class="sxs-lookup"><span data-stu-id="acd37-260">TestServer exposes a helpful CreateClient method that provides a pre-configured client that is ready to make requests to the application running on the TestServer.</span></span> <span data-ttu-id="acd37-261">Use este cliente (definido como protegido \_membro do cliente no teste de base acima) ao escrever testes funcionais para seu aplicativo ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="acd37-261">You use this client (set to the protected \_client member on the base test above) when writing functional tests for your ASP.NET Core application:</span></span>

```cs
public class CatalogControllerGetImage : BaseWebTest
{
    [Fact]
    public async Task ReturnsFileContentResultGivenValidId()
    {
        var testFilePath = Path.Combine(_contentRoot, "pics//1.png");
        var expectedFileBytes = File.ReadAllBytes(testFilePath);
        var response = await _client.GetAsync("/catalog/pic/1");
        response.EnsureSuccessStatusCode();
        var streamResponse = await response.Content.ReadAsStreamAsync();
        byte[] byteResult;
        using (var ms = new MemoryStream())
        {
            streamResponse.CopyTo(ms);
            byteResult = ms.ToArray();
        }
        Assert.Equal(expectedFileBytes, byteResult);
    }
}
```

<span data-ttu-id="acd37-262">Esse teste funcional emprega a pilha de aplicativo MVC do ASP.NET Core completa, incluindo todos os middleware, filtros, associadores, etc. que pode estar em vigor.</span><span class="sxs-lookup"><span data-stu-id="acd37-262">This functional test exercises the full ASP.NET Core MVC application stack, including all middleware, filters, binders, etc. that may be in place.</span></span> <span data-ttu-id="acd37-263">Ele verifica se uma determinada rota ("/ pic/catálogo/1") retorna a matriz de bytes esperados para um arquivo em um local conhecido.</span><span class="sxs-lookup"><span data-stu-id="acd37-263">It verifies that a given route ("/catalog/pic/1") returns the expected byte array for a file in a known location.</span></span> <span data-ttu-id="acd37-264">Ele faz isso sem configurar um servidor web real e portanto evita muito a fragilidade que servidor de teste pode ocorrer (por exemplo, problemas com as configurações de firewall) usando uma web real.</span><span class="sxs-lookup"><span data-stu-id="acd37-264">It does so without setting up a real web server, and so avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="acd37-265">Testes funcionais executadas em TestServer são geralmente mais lentas do que a integração e testes de unidade, mas são muito mais rápidos que testes que seriam executado pela rede para um servidor de teste da web.</span><span class="sxs-lookup"><span data-stu-id="acd37-265">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="acd37-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span><span class="sxs-lookup"><span data-stu-id="acd37-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span></span>
