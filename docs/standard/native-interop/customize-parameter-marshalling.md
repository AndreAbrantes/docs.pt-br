---
title: Personalizar o marshalling de parâmetro - .NET
description: Saiba como personalizar a forma como o .NET realiza marshalling em seus parâmetros para uma representação nativa.
author: jkoritzinsky
ms.author: jekoritz
ms.date: 01/18/2019
ms.openlocfilehash: 7821da546e0ed0ab5fa97d00a638aa5cc1a3089c
ms.sourcegitcommit: b56d59ad42140d277f2acbd003b74d655fdbc9f1
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/19/2019
ms.locfileid: "56411349"
---
# <a name="customizing-parameter-marshalling"></a><span data-ttu-id="0fd7d-103">Personalizar o marshalling de parâmetro</span><span class="sxs-lookup"><span data-stu-id="0fd7d-103">Customizing parameter marshalling</span></span>

<span data-ttu-id="0fd7d-104">Quando o comportamento de marshalling de parâmetro padrão do tempo de execução do .NET não fizer o que você deseja, use o atributo <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> para personalizar o modo como seus parâmetros passam pelo processo de marshalling.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-104">When the .NET runtime's default parameter marshalling behavior doesn't do what you want, use can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> attribute to customize how your parameters are marshaled.</span></span>

## <a name="customizing-string-parameters"></a><span data-ttu-id="0fd7d-105">Personalizar parâmetros de cadeias de caracteres</span><span class="sxs-lookup"><span data-stu-id="0fd7d-105">Customizing string parameters</span></span>

<span data-ttu-id="0fd7d-106">O .NET tem uma variedade de formatos para a realização de marshalling de cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-106">.NET has a variety of formats for marshalling strings.</span></span> <span data-ttu-id="0fd7d-107">Esses métodos são divididos em seções distintas em strings no C-style e em formatos de cadeias de caracteres centrados no Windows.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-107">These methods are split into distinct sections on C-style strings and Windows-centric string formats.</span></span>

### <a name="c-style-strings"></a><span data-ttu-id="0fd7d-108">Cadeias de caracteres C-style</span><span class="sxs-lookup"><span data-stu-id="0fd7d-108">C-Style strings</span></span>

<span data-ttu-id="0fd7d-109">Cada um desses formatos passa uma cadeia de caracteres terminada em nulo para o código nativo.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-109">Each of these formats passes a null-terminated string to native code.</span></span> <span data-ttu-id="0fd7d-110">Eles diferem pela codificação da cadeia de caracteres nativa.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-110">They differ by the encoding of the native string.</span></span>

| <span data-ttu-id="0fd7d-111">Valor `System.Runtime.InteropServices.UnmanagedType`</span><span class="sxs-lookup"><span data-stu-id="0fd7d-111">`System.Runtime.InteropServices.UnmanagedType` value</span></span> | <span data-ttu-id="0fd7d-112">Codificando</span><span class="sxs-lookup"><span data-stu-id="0fd7d-112">Encoding</span></span> |
|------------------------------------------------------|----------|
| <span data-ttu-id="0fd7d-113">LPStr</span><span class="sxs-lookup"><span data-stu-id="0fd7d-113">LPStr</span></span> | <span data-ttu-id="0fd7d-114">ANSI</span><span class="sxs-lookup"><span data-stu-id="0fd7d-114">ANSI</span></span> |
| <span data-ttu-id="0fd7d-115">LPUTF8Str</span><span class="sxs-lookup"><span data-stu-id="0fd7d-115">LPUTF8Str</span></span> | <span data-ttu-id="0fd7d-116">UTF-8</span><span class="sxs-lookup"><span data-stu-id="0fd7d-116">UTF-8</span></span> | 
| <span data-ttu-id="0fd7d-117">LPWStr</span><span class="sxs-lookup"><span data-stu-id="0fd7d-117">LPWStr</span></span> | <span data-ttu-id="0fd7d-118">UTF-16</span><span class="sxs-lookup"><span data-stu-id="0fd7d-118">UTF-16</span></span> |

<span data-ttu-id="0fd7d-119">O formato <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> é um pouco diferente.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-119">The <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> format is slightly different.</span></span> <span data-ttu-id="0fd7d-120">Como `LPWStr`, ele realiza marshalling da cadeia de caracteres para uma cadeia de caracteres C-style nativa codificada em UTF-16.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-120">Like `LPWStr`, it marshals the string to a native C-style string encoded in UTF-16.</span></span> <span data-ttu-id="0fd7d-121">No entanto, a assinatura gerenciada passa a cadeia de caracteres por referência e a assinatura nativa correspondente usa a cadeia de caracteres por valor.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-121">However, the managed signature has you pass in the string by reference and the matching native signature takes the string by value.</span></span> <span data-ttu-id="0fd7d-122">Essa distinção permite que você use uma API nativa que recebe uma cadeia de caracteres por valor e a modifica no local sem precisar usar um `StringBuilder`.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-122">This distinction allows you to use a native API that takes a string by value and modifies it in-place without having to use a `StringBuilder`.</span></span> <span data-ttu-id="0fd7d-123">Recomendamos que você não use esse formato manualmente, pois ele pode causar confusão com as assinaturas nativas e gerenciadas incompatíveis.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-123">We recommend against manually using this format since it's prone to cause confusion with the mismatching native and managed signatures.</span></span>

### <a name="windows-centric-string-formats"></a><span data-ttu-id="0fd7d-124">Formatos de cadeias de caracteres centradas no Windows</span><span class="sxs-lookup"><span data-stu-id="0fd7d-124">Windows-centric string formats</span></span>

<span data-ttu-id="0fd7d-125">Ao interagir com interfaces COM ou OLE, você provavelmente descobrirá que as funções nativas tomam cadeias de caracteres como argumentos `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-125">When interacting with COM or OLE interfaces, you'll likely find that the native functions take strings as `BSTR` arguments.</span></span> <span data-ttu-id="0fd7d-126">Você pode usar o tipo não gerenciado <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> para realizar marshalling de uma cadeia de caracteres como um `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-126">You can use the <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> unmanaged type to marshal a string as a `BSTR`.</span></span>

<span data-ttu-id="0fd7d-127">Se você estiver interagindo com as APIs do WinRT, poderá usar o formato <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> para realizar marshalling de uma cadeia de caracteres como `HSTRING`.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-127">If you're interacting with WinRT APIs, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format to marshal a string as an `HSTRING`.</span></span>

## <a name="customizing-array-parameters"></a><span data-ttu-id="0fd7d-128">Personalizar parâmetros de matriz</span><span class="sxs-lookup"><span data-stu-id="0fd7d-128">Customizing array parameters</span></span>

<span data-ttu-id="0fd7d-129">.NET também fornece várias maneiras de realizar marshalling de parâmetros de matriz.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-129">.NET also provides you multiple ways to marshal array parameters.</span></span> <span data-ttu-id="0fd7d-130">Se você estiver chamando uma API que usa uma matriz C-style, use o tipo não gerenciado <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-130">If you're calling an API that takes a C-style array, use the <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="0fd7d-131">Se os valores na matriz precisarem de marshalling personalizado, você poderá usar o campo <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> no atributo `[MarshalAs]` para isso.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-131">If the values in the array need customized marshalling, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> field on the `[MarshalAs]` attribute for that.</span></span>

<span data-ttu-id="0fd7d-132">Se você estiver usando APIs COM, provavelmente terá que organizar seus parâmetros de matriz como `SAFEARRAY*`s.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-132">If you're using COM APIs, you'll likely have to marshal your array parameters as `SAFEARRAY*`s.</span></span> <span data-ttu-id="0fd7d-133">Para fazer isso, você pode usar o tipo não gerenciado <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-133">To do so, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="0fd7d-134">O tipo padrão dos elementos do `SAFEARRAY` pode ser visto na tabela sobre [ como personalizar campos `object`](./customize-struct-marshalling.md#marshalling-systemobjects).</span><span class="sxs-lookup"><span data-stu-id="0fd7d-134">The default type of the elements of the `SAFEARRAY` can be seen in the table on [customizing `object` fields](./customize-struct-marshalling.md#marshalling-systemobjects).</span></span> <span data-ttu-id="0fd7d-135">Você pode usar os campos <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> e <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> para personalizar o tipo de elemento exato do `SAFEARRAY`.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-135">You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> and <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> fields to customize the exact element type of the `SAFEARRAY`.</span></span>

## <a name="customizing-boolean-or-decimal-parameters"></a><span data-ttu-id="0fd7d-136">Personalizar parâmetros boolianos ou decimais</span><span class="sxs-lookup"><span data-stu-id="0fd7d-136">Customizing boolean or decimal parameters</span></span>

<span data-ttu-id="0fd7d-137">Para saber mais sobre como realizar marshalling de parâmetros boolianos ou decimais, consulte [Personalizar marshalling de estrutura](customize-struct-marshalling.md).</span><span class="sxs-lookup"><span data-stu-id="0fd7d-137">For information on marshalling boolean or decimal parameters, see [Customizing structure marshalling](customize-struct-marshalling.md).</span></span>

## <a name="customizing-object-parameters-windows-only"></a><span data-ttu-id="0fd7d-138">Personalizar parâmetros de objeto (somente Windows)</span><span class="sxs-lookup"><span data-stu-id="0fd7d-138">Customizing object parameters (Windows-only)</span></span>

<span data-ttu-id="0fd7d-139">No Windows, o tempo de execução do .NET fornece várias maneiras diferentes de realizar marshalling de parâmetros de objeto para código nativo.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-139">On Windows, the .NET runtime provides a number of different ways to marshal object parameters to native code.</span></span>

### <a name="marshalling-as-specific-com-interfaces"></a><span data-ttu-id="0fd7d-140">Marshalling como interfaces COM específicas</span><span class="sxs-lookup"><span data-stu-id="0fd7d-140">Marshalling as specific COM interfaces</span></span>

<span data-ttu-id="0fd7d-141">Se sua API leva um ponteiro para um objeto COM, você pode usar qualquer um dos seguintes formatos `UnmanagedType` em um parâmetro de tipo `object` para informar o .NET para realizar marshalling como essas interfaces específicas:</span><span class="sxs-lookup"><span data-stu-id="0fd7d-141">If your API takes a pointer to a COM object, you can use any of the following `UnmanagedType` formats on an `object`-typed parameter to tell .NET to marshal as these specific interfaces:</span></span>

- `IUnknown`
- `IDispatch`
- `IInspectable`

<span data-ttu-id="0fd7d-142">Além disso, se o seu tipo estiver marcado com `[ComVisible(true)]` ou se você estiver organizando o tipo `object`, poderá usar o formato <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> para realizar marshalling do seu objeto como um COM callable wrapper para a exibição COM do seu tipo.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-142">Additionally, if your type is marked `[ComVisible(true)]` or you're marshalling the `object` type, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format to marshal your object as a COM callable wrapper for the COM view of your type.</span></span>

### <a name="marshalling-to-a-variant"></a><span data-ttu-id="0fd7d-143">Marshalling para uma `VARIANT`</span><span class="sxs-lookup"><span data-stu-id="0fd7d-143">Marshalling to a `VARIANT`</span></span>

<span data-ttu-id="0fd7d-144">Se sua API nativa tiver uma `VARIANT` Win32, você poderá usar o formato <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> no seu `object` para organizar seus objetos como `VARIANT`s.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-144">If your native API takes a Win32 `VARIANT`, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> format on your `object` parameter to marshal your objects as `VARIANT`s.</span></span> <span data-ttu-id="0fd7d-145">Consulte a documentação sobre [como personalizar campos `object`](customize-struct-marshalling.md#marshalling-systemobjects) para um mapeamento entre tipos .NET e tipos `VARIANT`.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-145">See the documentation on [customizing `object` fields](customize-struct-marshalling.md#marshalling-systemobjects) for a mapping between .NET types and `VARIANT` types.</span></span>

### <a name="custom-marshalers"></a><span data-ttu-id="0fd7d-146">Empacotadores personalizados</span><span class="sxs-lookup"><span data-stu-id="0fd7d-146">Custom marshalers</span></span>

<span data-ttu-id="0fd7d-147">Se você deseja projetar uma interface COM nativa em um tipo gerenciado diferente, você pode usar o formato `UnmanagedType.CustomMarshaler` e uma implementação de <xref:System.Runtime.InteropServices.ICustomMarshaler> para fornecer seu próprio código de marshaling personalizado.</span><span class="sxs-lookup"><span data-stu-id="0fd7d-147">If you want to project a native COM interface into a different managed type, you can use the `UnmanagedType.CustomMarshaler` format and an implementation of <xref:System.Runtime.InteropServices.ICustomMarshaler> to provide your own custom marshalling code.</span></span>
