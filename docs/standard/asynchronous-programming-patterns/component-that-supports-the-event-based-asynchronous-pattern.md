---
title: "Instruções passo a passo: implementando um componente compatível com o padrão assíncrono baseado em evento"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 150e4b27cc149774895574ddd196de5f9bc2acd8
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="walkthrough-implementing-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="1e6a9-102">Instruções passo a passo: implementando um componente compatível com o padrão assíncrono baseado em evento</span><span class="sxs-lookup"><span data-stu-id="1e6a9-102">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="1e6a9-103">Se você estiver escrevendo uma classe com algumas operações que podem causar atrasos notáveis, considere fornecendo funcionalidade assíncrona Implementando o [baseado em evento visão geral do padrão assíncrono](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1e6a9-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="1e6a9-104">Este passo a passo ilustra como criar um componente que implementa o padrão assíncrono baseado em evento.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="1e6a9-105">Ele é implementado usando classes auxiliares do <xref:System.ComponentModel?displayProperty=nameWithType> namespace, o que garante que o componente funciona corretamente em qualquer modelo de aplicativo, incluindo [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], aplicativos de Windows Forms e aplicativos de Console.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Console applications and Windows Forms applications.</span></span> <span data-ttu-id="1e6a9-106">Este componente também é projetáveis com um <xref:System.Windows.Forms.PropertyGrid> controle e seus próprios designers personalizados.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="1e6a9-107">Quando terminar, você terá um aplicativo que calcula números primos de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="1e6a9-108">Seu aplicativo terá um thread de interface do usuário do usuário principal e um thread para cada cálculo de números primos.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="1e6a9-109">Embora testar se é um grande número primo pode levar uma quantidade considerável de tempo, o thread de interface do usuário principal não será interrompido por esse atraso e o formulário será responsivo durante os cálculos.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="1e6a9-110">Você poderá executar como muitos cálculos como desejar simultaneamente e seletivamente Cancelar pendentes cálculos.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="1e6a9-111">As tarefas ilustradas neste passo a passo incluem:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-111">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="1e6a9-112">Criar o componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-112">Creating the Component</span></span>  
  
-   <span data-ttu-id="1e6a9-113">Definindo representantes e eventos assíncronos públicos</span><span class="sxs-lookup"><span data-stu-id="1e6a9-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
-   <span data-ttu-id="1e6a9-114">Definindo privada delegados</span><span class="sxs-lookup"><span data-stu-id="1e6a9-114">Defining Private Delegates</span></span>  
  
-   <span data-ttu-id="1e6a9-115">Implementando eventos públicos</span><span class="sxs-lookup"><span data-stu-id="1e6a9-115">Implementing Public Events</span></span>  
  
-   <span data-ttu-id="1e6a9-116">Implementando o método de conclusão</span><span class="sxs-lookup"><span data-stu-id="1e6a9-116">Implementing the Completion Method</span></span>  
  
-   <span data-ttu-id="1e6a9-117">Implementando os métodos de trabalho</span><span class="sxs-lookup"><span data-stu-id="1e6a9-117">Implementing the Worker Methods</span></span>  
  
-   <span data-ttu-id="1e6a9-118">Implementação de início e cancelamento</span><span class="sxs-lookup"><span data-stu-id="1e6a9-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="1e6a9-119">Para copiar o código neste tópico como uma única lista, consulte [como: implementar um componente compatível com o padrão assíncrono baseado em evento](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="1e6a9-119">To copy the code in this topic as a single listing, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="1e6a9-120">Criar o componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-120">Creating the Component</span></span>  
 <span data-ttu-id="1e6a9-121">A primeira etapa é criar o componente que implementa o padrão assíncrono baseado em evento.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
#### <a name="to-create-the-component"></a><span data-ttu-id="1e6a9-122">Para criar o componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-122">To create the component</span></span>  
  
-   <span data-ttu-id="1e6a9-123">Criar uma classe chamada `PrimeNumberCalculator` que herda de <xref:System.ComponentModel.Component>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="1e6a9-124">Definindo representantes e eventos assíncronos públicos</span><span class="sxs-lookup"><span data-stu-id="1e6a9-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="1e6a9-125">O componente se comunica com clientes usando os eventos.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="1e6a9-126">O *MethodName* `Completed` clientes para a conclusão de uma tarefa assíncrona, alertas de eventos e o *MethodName* `ProgressChanged` evento informa os clientes do progresso de uma tarefa assíncrona.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-126">The *MethodName*`Completed` event alerts clients to the completion of an asynchronous task, and the *MethodName*`ProgressChanged` event informs clients of the progress of an asynchronous task.</span></span>  
  
#### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="1e6a9-127">Para definir eventos assíncronos para clientes do seu componente:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-127">To define asynchronous events for clients of your component:</span></span>  
  
1.  <span data-ttu-id="1e6a9-128">Importar o <xref:System.Threading?displayProperty=nameWithType> e <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces na parte superior do arquivo.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2.  <span data-ttu-id="1e6a9-129">Antes do `PrimeNumberCalculator` definição, da classe declarar representantes para eventos de andamento e a conclusão.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3.  <span data-ttu-id="1e6a9-130">No `PrimeNumberCalculator` definição da classe, declare eventos para relatar o andamento e a conclusão aos clientes.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4.  <span data-ttu-id="1e6a9-131">Após o `PrimeNumberCalculator` definição da classe, derivar o `CalculatePrimeCompletedEventArgs` classe para reportar o resultado de cada cálculo ao manipulador de eventos do cliente para o `CalculatePrimeCompleted`.event.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="1e6a9-132">Além de `AsyncCompletedEventArgs` propriedades, essa classe permite que o cliente determinar qual número foi testado, se ela é a principal e o divisor primeiro novidades se não for principal.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="1e6a9-133">Ponto de verificação</span><span class="sxs-lookup"><span data-stu-id="1e6a9-133">Checkpoint</span></span>  
 <span data-ttu-id="1e6a9-134">Neste ponto, você pode criar o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-134">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="1e6a9-135">Para testar seu componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-135">To test your component</span></span>  
  
-   <span data-ttu-id="1e6a9-136">Compile o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-136">Compile the component.</span></span>  
  
     <span data-ttu-id="1e6a9-137">Você receberá dois avisos do compilador:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-137">You will receive two compiler warnings:</span></span>  
  
    ```  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="1e6a9-138">Esses avisos serão removidos na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="1e6a9-139">Definindo privada delegados</span><span class="sxs-lookup"><span data-stu-id="1e6a9-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="1e6a9-140">Os aspectos assíncronos do `PrimeNumberCalculator` componente são implementados internamente com um delegado especial conhecido como um <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="1e6a9-141">Um <xref:System.Threading.SendOrPostCallback> representa um método de retorno de chamada que é executado em um <xref:System.Threading.ThreadPool> thread.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="1e6a9-142">O método de retorno de chamada deve ter uma assinatura que usa um único parâmetro do tipo <xref:System.Object>, que significa que você precisará passar o estado entre delegates em uma classe wrapper.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="1e6a9-143">Para obter mais informações, consulte <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
#### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="1e6a9-144">Para implementar o comportamento de assíncrono interno do componente:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1.  <span data-ttu-id="1e6a9-145">Declare e crie o <xref:System.Threading.SendOrPostCallback> delega no `PrimeNumberCalculator` classe.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="1e6a9-146">Criar o <xref:System.Threading.SendOrPostCallback> objetos em um método de utilitário chamado `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="1e6a9-147">Você precisará de dois delegados: uma para relatar o andamento para o cliente e outra para relatório de conclusão para o cliente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2.  <span data-ttu-id="1e6a9-148">Chamar o `InitializeDelegates` método no construtor do componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3.  <span data-ttu-id="1e6a9-149">Declara um representante no `PrimeNumberCalculator` classe que manipula o trabalho real para ser executado de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="1e6a9-150">Este delegado encapsula o método de trabalho que verifica se um número é o principal.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="1e6a9-151">O representante aceitar um <xref:System.ComponentModel.AsyncOperation> parâmetro, que será usado para rastrear o tempo de vida da operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4.  <span data-ttu-id="1e6a9-152">Crie uma coleção para gerenciar o tempo de vida de operações assíncronas pendentes.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="1e6a9-153">O cliente precisa de uma maneira para rastrear as operações como elas são executadas e concluídas, e esse controle é feito ao exigir que o cliente passar um token exclusivo ou a ID da tarefa, quando o cliente faz a chamada para o método assíncrono.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="1e6a9-154">O `PrimeNumberCalculator` componente deve manter o controle de cada chamada ao associar a ID da tarefa de sua invocação correspondente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="1e6a9-155">Se o cliente passa uma ID de tarefa que não é exclusiva, o `PrimeNumberCalculator` componente deve gerar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="1e6a9-156">O `PrimeNumberCalculator` componente mantém o controle de ID da tarefa usando uma classe de coleção especial chamada um <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="1e6a9-157">Na definição de classe, crie um <xref:System.Collections.Specialized.HybridDictionary> chamado `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="1e6a9-158">Implementando eventos públicos</span><span class="sxs-lookup"><span data-stu-id="1e6a9-158">Implementing Public Events</span></span>  
 <span data-ttu-id="1e6a9-159">Componentes que implementam o padrão assíncrono baseado em evento se comunicar com clientes usando os eventos.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="1e6a9-160">Esses eventos são chamados no thread adequada com a Ajuda do <xref:System.ComponentModel.AsyncOperation> classe.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
#### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="1e6a9-161">Para gerar eventos para clientes do componente:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-161">To raise events to your component's clients:</span></span>  
  
1.  <span data-ttu-id="1e6a9-162">Implemente eventos públicos para emissão de relatórios para os clientes.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="1e6a9-163">Você precisará de um evento para relatório de andamento e outro para relatório de conclusão.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="1e6a9-164">Implementando o método de conclusão</span><span class="sxs-lookup"><span data-stu-id="1e6a9-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="1e6a9-165">O delegado de conclusão é o método que o comportamento assíncrono subjacente, free-thread chamará quando termina a operação assíncrona foi bem-sucedida, erro ou cancelamento.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="1e6a9-166">Esta chamada ocorre em um thread arbitrário.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="1e6a9-167">Esse método é onde a ID da tarefa do cliente é removido da coleção interna de tokens de cliente exclusivo.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="1e6a9-168">Esse método também termina o tempo de vida de uma determinada operação assíncrona ao chamar o <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> método correspondente <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="1e6a9-169">Essa chamada gera o evento de conclusão no thread que é apropriado para o modelo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="1e6a9-170">Após o <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> método é chamado, esta instância do <xref:System.ComponentModel.AsyncOperation> não pode mais ser usado, e quaisquer tentativas subsequentes de usá-lo lançará uma exceção.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="1e6a9-171">O `CompletionMethod` assinatura deve conter todos os estados necessárias para descrever o resultado da operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="1e6a9-172">Ele mantém o estado para o número que foi testado por essa operação assíncrona específica, seja o número primo e o valor de seu primeiro divisor se não for um número primo.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="1e6a9-173">Ela também contém o estado que descreve qualquer exceção que ocorreu, e o <xref:System.ComponentModel.AsyncOperation> correspondente a essa tarefa específica.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
#### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="1e6a9-174">Para concluir uma operação assíncrona:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-174">To complete an asynchronous operation:</span></span>  
  
-   <span data-ttu-id="1e6a9-175">Implemente o método de conclusão.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-175">Implement the completion method.</span></span> <span data-ttu-id="1e6a9-176">Ele usa seis parâmetros, que são usados para preencher um `CalculatePrimeCompletedEventArgs` que é retornado ao cliente por meio do cliente `CalculatePrimeCompletedEventHandler`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="1e6a9-177">Ele remove o token de ID de tarefa do cliente da coleção interna e ele termina o tempo de vida da operação assíncrona com uma chamada para <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="1e6a9-178">O <xref:System.ComponentModel.AsyncOperation> controla a chamada para o contexto apropriado para o modelo de aplicativo ou thread.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="1e6a9-179">Ponto de verificação</span><span class="sxs-lookup"><span data-stu-id="1e6a9-179">Checkpoint</span></span>  
 <span data-ttu-id="1e6a9-180">Neste ponto, você pode criar o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-180">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="1e6a9-181">Para testar seu componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-181">To test your component</span></span>  
  
-   <span data-ttu-id="1e6a9-182">Compile o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-182">Compile the component.</span></span>  
  
     <span data-ttu-id="1e6a9-183">Você receberá um aviso do compilador:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-183">You will receive one compiler warning:</span></span>  
  
    ```  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="1e6a9-184">Esse aviso será resolvido na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="1e6a9-185">Implementando os métodos de trabalho</span><span class="sxs-lookup"><span data-stu-id="1e6a9-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="1e6a9-186">Até agora, você implementou o código de suporte assíncrono para o `PrimeNumberCalculator` componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="1e6a9-187">Agora você pode implementar o código que faz o trabalho real.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="1e6a9-188">Você irá implementar os três métodos: `CalculateWorker`, `BuildPrimeNumberList`, e `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="1e6a9-189">Juntas, `BuildPrimeNumberList` e `IsPrime` compõem um algoritmo bem conhecido chamado Sieve de Eratosthenes, que determina se um número primo localizando todos os números primos até a raiz quadrada do número de teste.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="1e6a9-190">Se nenhum divisores forem encontrados por esse ponto, o número de teste é primos.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="1e6a9-191">Este componente foram desenvolvido para máxima eficiência, ele seria Lembre-se de todos os números primos descobertos por várias invocações de números de teste diferente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="1e6a9-192">Ele também deve verificar para divisores triviais como 2, 3 e 5.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="1e6a9-193">A intenção deste exemplo é demonstrar como demoradas operações podem ser executadas de forma assíncrona, no entanto, para que essas otimizações são deixadas como um exercício para você.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="1e6a9-194">O `CalculateWorker` método é encapsulado em um representante e é invocado de forma assíncrona, com uma chamada para `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1e6a9-195">Relatório de progresso é implementado no `BuildPrimeNumberList` método.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="1e6a9-196">Em computadores rápidos, `ProgressChanged` eventos podem ser gerados em sucessão rápida.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="1e6a9-197">O thread de cliente, em que esses eventos são gerados, deve ser capaz de lidar com essa situação.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="1e6a9-198">Código de interface do usuário pode ser inundada com mensagens e não é possível continuar, resultando no comportamento de deslocamento.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-198">User interface code may be flooded with messages and unable to keep up, resulting in hanging behavior.</span></span> <span data-ttu-id="1e6a9-199">Para uma interface de usuário de exemplo que manipula essa situação, consulte [como: implementar um cliente do padrão assíncrono baseado em evento](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="1e6a9-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
#### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="1e6a9-200">Para executar o cálculo de número primo de forma assíncrona:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-200">To execute the prime number calculation asynchronously:</span></span>  
  
1.  <span data-ttu-id="1e6a9-201">Implementar o `TaskCanceled` método utilitário.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="1e6a9-202">Isso verifica se a coleção de tempo de vida de tarefa para a ID de tarefa específica e retorna `true` se a ID da tarefa não foi encontrada.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2.  <span data-ttu-id="1e6a9-203">Implementar o método de `CalculateWorker` .</span><span class="sxs-lookup"><span data-stu-id="1e6a9-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="1e6a9-204">Ele usa dois parâmetros: um número para testar e um <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3.  <span data-ttu-id="1e6a9-205">Implementar `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="1e6a9-206">Ele usa dois parâmetros: o número para testar e um <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="1e6a9-207">Ele usa o <xref:System.ComponentModel.AsyncOperation> para relatar o andamento e o resultado incremental.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="1e6a9-208">Isso garante que os manipuladores de eventos do cliente são chamados no thread adequada ou contexto para o modelo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="1e6a9-209">Quando `BuildPrimeNumberList` localiza um número primo, relatar isso como um resultado incremental para manipulador de eventos do cliente para o `ProgressChanged` evento.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="1e6a9-210">Isso requer uma classe derivada de <xref:System.ComponentModel.ProgressChangedEventArgs>, chamado `CalculatePrimeProgressChangedEventArgs`, que tenha um adicionado propriedade chamada `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="1e6a9-211">O `BuildPrimeNumberList` método também chama o `TaskCanceled` método e saídas se o método retornar `true`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4.  <span data-ttu-id="1e6a9-212">Implementar `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-212">Implement `IsPrime`.</span></span> <span data-ttu-id="1e6a9-213">Ele usa três parâmetros: uma lista de números primos de conhecidos, o número para testar e um parâmetro de saída para o divisor primeiro encontrado.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="1e6a9-214">Recebe a lista de números primos, determina se o teste de número primo.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5.  <span data-ttu-id="1e6a9-215">Derivar `CalculatePrimeProgressChangedEventArgs` de <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="1e6a9-216">Essa classe é necessária para relatar resultados incrementais ao manipulador de eventos do cliente para o `ProgressChanged` evento.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="1e6a9-217">Ele tem uma propriedade adicional chamada `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="1e6a9-218">Ponto de verificação</span><span class="sxs-lookup"><span data-stu-id="1e6a9-218">Checkpoint</span></span>  
 <span data-ttu-id="1e6a9-219">Neste ponto, você pode criar o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-219">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="1e6a9-220">Para testar seu componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-220">To test your component</span></span>  
  
-   <span data-ttu-id="1e6a9-221">Compile o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-221">Compile the component.</span></span>  
  
     <span data-ttu-id="1e6a9-222">Tudo o que permanece a serem gravados é os métodos para iniciar e cancelar operações assíncronas, `CalculatePrimeAsync` e `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="1e6a9-223">Implementando o início e métodos de cancelamento</span><span class="sxs-lookup"><span data-stu-id="1e6a9-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="1e6a9-224">Iniciar o método de trabalho em seu próprio thread chamando `BeginInvoke` sobre o delegado que encapsula a ele.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="1e6a9-225">Para gerenciar o tempo de vida de uma determinada operação assíncrona, você deve chamar o <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> método sobre o <xref:System.ComponentModel.AsyncOperationManager> classe auxiliar.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="1e6a9-226">Isso retorna um <xref:System.ComponentModel.AsyncOperation>, que realiza marshaling de chamadas em manipuladores de eventos do cliente para o contexto ou adequada da thread.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="1e6a9-227">Cancelar uma determinada operação pendente chamando <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> em correspondente <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="1e6a9-228">Isso encerra a operação e qualquer chamada subsequente para seus <xref:System.ComponentModel.AsyncOperation> lançará uma exceção.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
#### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="1e6a9-229">Para implementar o início e cancelar a funcionalidade:</span><span class="sxs-lookup"><span data-stu-id="1e6a9-229">To implement Start and Cancel functionality:</span></span>  
  
1.  <span data-ttu-id="1e6a9-230">Implementar o método de `CalculatePrimeAsync` .</span><span class="sxs-lookup"><span data-stu-id="1e6a9-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="1e6a9-231">Verifique se que o token fornecido pelo cliente (ID da tarefa) é exclusivo em relação a todos os tokens que representam atualmente tarefas pendentes.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="1e6a9-232">Se o cliente passa um token não exclusivo, `CalculatePrimeAsync` gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="1e6a9-233">Caso contrário, o token é adicionado à coleção de ID de tarefa.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2.  <span data-ttu-id="1e6a9-234">Implementar o método de `CancelAsync` .</span><span class="sxs-lookup"><span data-stu-id="1e6a9-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="1e6a9-235">Se o `taskId` parâmetro existe na coleção de token, ele será removido.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="1e6a9-236">Isso impede que tarefas canceladas que não foram iniciados de execução.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="1e6a9-237">Se a tarefa estiver em execução, o `BuildPrimeNumberList` método encerrado quando ele detecta que a ID da tarefa foi removida da coleção de tempo de vida.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="1e6a9-238">Ponto de verificação</span><span class="sxs-lookup"><span data-stu-id="1e6a9-238">Checkpoint</span></span>  
 <span data-ttu-id="1e6a9-239">Neste ponto, você pode criar o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-239">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="1e6a9-240">Para testar seu componente</span><span class="sxs-lookup"><span data-stu-id="1e6a9-240">To test your component</span></span>  
  
-   <span data-ttu-id="1e6a9-241">Compile o componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-241">Compile the component.</span></span>  
  
 <span data-ttu-id="1e6a9-242">O `PrimeNumberCalculator` componente agora está concluído e pronto para uso.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="1e6a9-243">Para um cliente de exemplo que usa o `PrimeNumberCalculator` componente, consulte [como: implementar um cliente do padrão assíncrono baseado em evento](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="1e6a9-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="1e6a9-244">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="1e6a9-244">Next Steps</span></span>  
 <span data-ttu-id="1e6a9-245">Você pode preencher este exemplo escrevendo `CalculatePrime`, o equivalente síncrono `CalculatePrimeAsync` método.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="1e6a9-246">Isso tornará o `PrimeNumberCalculator` totalmente compatível com o padrão assíncrono baseado em evento do componente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="1e6a9-247">Você pode melhorar neste exemplo, mantendo a lista de todos os números primos descoberto por várias invocações de números de teste diferente.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="1e6a9-248">Usando essa abordagem, cada tarefa se beneficiam o trabalho realizado por tarefas anteriores.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="1e6a9-249">Tenha cuidado para proteger essa lista com `lock` regiões, portanto o acesso à lista por threads diferentes é serializado.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="1e6a9-250">Você também pode melhorar este exemplo testando divisores triviais, como 2, 3 e 5.</span><span class="sxs-lookup"><span data-stu-id="1e6a9-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1e6a9-251">Consulte também</span><span class="sxs-lookup"><span data-stu-id="1e6a9-251">See Also</span></span>  
 [<span data-ttu-id="1e6a9-252">Como executar uma operação em segundo plano</span><span class="sxs-lookup"><span data-stu-id="1e6a9-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)  
 [<span data-ttu-id="1e6a9-253">Visão Geral do Padrão Assíncrono Baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="1e6a9-253">Event-based Asynchronous Pattern Overview</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)  
 [<span data-ttu-id="1e6a9-254">NÃO está em compilação: Multithread no Visual Basic</span><span class="sxs-lookup"><span data-stu-id="1e6a9-254">NOT IN BUILD: Multithreading in Visual Basic</span></span>](http://msdn.microsoft.com/en-us/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="1e6a9-255">Como implementar um componente compatível com o Padrão Assíncrono baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="1e6a9-255">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="1e6a9-256">Programação multi-threaded com o padrão assíncrono baseado em evento</span><span class="sxs-lookup"><span data-stu-id="1e6a9-256">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)
