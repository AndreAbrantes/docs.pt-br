---
title: Práticas recomendadas para a implementação do padrão assíncrono baseado em evento
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- AsyncOperation class
- AsyncCompletedEventArgs class
ms.assetid: 4acd2094-4f46-4eff-9190-92d0d9ff47db
ms.openlocfilehash: eaf410fa198fdb38a39a0474e9e147542919df8e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33578415"
---
# <a name="best-practices-for-implementing-the-event-based-asynchronous-pattern"></a><span data-ttu-id="d60d6-102">Práticas recomendadas para a implementação do padrão assíncrono baseado em evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-102">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="d60d6-103">O padrão assíncrono baseado em eventos proporciona uma maneira eficiente de expor o comportamento assíncrono nas classes, com evento familiar e semântica de representante.</span><span class="sxs-lookup"><span data-stu-id="d60d6-103">The Event-based Asynchronous Pattern provides you with an effective way to expose asynchronous behavior in classes, with familiar event and delegate semantics.</span></span> <span data-ttu-id="d60d6-104">Para implementá-lo, você deve seguir alguns requisitos de comportamento específicos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-104">To implement Event-based Asynchronous Pattern, you need to follow some specific behavioral requirements.</span></span> <span data-ttu-id="d60d6-105">As seções a seguir descrevem os requisitos e as diretrizes a serem considerados ao implementar uma classe que segue o padrão assíncrono baseado em eventos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-105">The following sections describe requirements and guidelines you should consider when you implement a class that follows the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="d60d6-106">Para obter uma visão geral, veja [Implementação do padrão assíncrono baseado em evento](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="d60d6-106">For an overview, see [Implementing the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="required-behavioral-guarantees"></a><span data-ttu-id="d60d6-107">Garantias comportamentais necessárias</span><span class="sxs-lookup"><span data-stu-id="d60d6-107">Required Behavioral Guarantees</span></span>  
 <span data-ttu-id="d60d6-108">Se implementar o padrão assíncrono baseado em eventos, você deve fornecer diversas garantias para assegurar que a classe se comportará corretamente e que os clientes da classe podem confiar nesse comportamento.</span><span class="sxs-lookup"><span data-stu-id="d60d6-108">If you implement the Event-based Asynchronous Pattern, you must provide a number of guarantees to ensure that your class will behave properly and clients of your class can rely on such behavior.</span></span>  
  
### <a name="completion"></a><span data-ttu-id="d60d6-109">Conclusão</span><span class="sxs-lookup"><span data-stu-id="d60d6-109">Completion</span></span>  
 <span data-ttu-id="d60d6-110">Sempre invoque o manipulador de eventos *MethodName***Completed** quando houver uma conclusão com êxito, um erro ou um cancelamento.</span><span class="sxs-lookup"><span data-stu-id="d60d6-110">Always invoke the *MethodName***Completed** event handler when you have successful completion, an error, or a cancellation.</span></span> <span data-ttu-id="d60d6-111">Os aplicativos nunca devem permanecer inativos sem que a conclusão ocorra.</span><span class="sxs-lookup"><span data-stu-id="d60d6-111">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span> <span data-ttu-id="d60d6-112">Uma exceção a essa regra é se a própria operação assíncrona for projetada para nunca concluir.</span><span class="sxs-lookup"><span data-stu-id="d60d6-112">One exception to this rule is if the asynchronous operation itself it designed so that it never completes.</span></span>  
  
### <a name="completed-event-and-eventargs"></a><span data-ttu-id="d60d6-113">Evento e argumentos de eventos concluídos</span><span class="sxs-lookup"><span data-stu-id="d60d6-113">Completed Event and EventArgs</span></span>  
 <span data-ttu-id="d60d6-114">Para cada método separado *MethodName***Async**, aplique estes requisitos de design:</span><span class="sxs-lookup"><span data-stu-id="d60d6-114">For each separate *MethodName***Async** method, apply the following design requirements:</span></span>  
  
-   <span data-ttu-id="d60d6-115">Defina um evento *MethodName***Completed** na mesma classe que o método.</span><span class="sxs-lookup"><span data-stu-id="d60d6-115">Define a *MethodName***Completed** event on the same class as the method.</span></span>  
  
-   <span data-ttu-id="d60d6-116">Defina uma classe <xref:System.EventArgs> e o representante de acompanhamento para o evento *MethodName***Completed** que deriva da classe <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-116">Define an <xref:System.EventArgs> class and accompanying delegate for the *MethodName***Completed** event that derives from the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span> <span data-ttu-id="d60d6-117">O nome padrão da classe deve seguir a forma *MethodName***CompletedEventArgs**.</span><span class="sxs-lookup"><span data-stu-id="d60d6-117">The default class name should be of the form *MethodName***CompletedEventArgs**.</span></span>  
  
-   <span data-ttu-id="d60d6-118">Verifique se a classe <xref:System.EventArgs> é específica aos valores retornados do método *MethodName*.</span><span class="sxs-lookup"><span data-stu-id="d60d6-118">Ensure that the <xref:System.EventArgs> class is specific to the return values of the *MethodName* method.</span></span> <span data-ttu-id="d60d6-119">Ao usar a classe <xref:System.EventArgs>, você nunca deve solicitar que os desenvolvedores convertam o resultado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-119">When you use the <xref:System.EventArgs> class, you should never require developers to cast the result.</span></span>  
  
     <span data-ttu-id="d60d6-120">O exemplo de código a seguir mostra as implementações correta e incorreta desse requisito, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d60d6-120">The following code example shows good and bad implementation of this design requirement respectively.</span></span>  
  
```csharp  
// Good design  
private void Form1_MethodNameCompleted(object sender, xxxCompletedEventArgs e)   
{   
    DemoType result = e.Result;  
}  
  
// Bad design  
private void Form1_MethodNameCompleted(object sender, MethodNameCompletedEventArgs e)   
{   
    DemoType result = (DemoType)(e.Result);  
}  
```  
  
-   <span data-ttu-id="d60d6-121">Não defina uma classe <xref:System.EventArgs> para os métodos de retorno que retornam `void`.</span><span class="sxs-lookup"><span data-stu-id="d60d6-121">Do not define an <xref:System.EventArgs> class for returning methods that return `void`.</span></span> <span data-ttu-id="d60d6-122">Em vez disso, use uma instância da classe <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-122">Instead, use an instance of the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span>  
  
-   <span data-ttu-id="d60d6-123">O evento *MethodName***Completed** sempre deve ser usado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-123">Ensure that you always raise the *MethodName***Completed** event.</span></span> <span data-ttu-id="d60d6-124">Esse evento deve ser usado quando a conclusão for realizada com êxito, em caso de erro ou em caso de cancelamento.</span><span class="sxs-lookup"><span data-stu-id="d60d6-124">This event should be raised on successful completion, on an error, or on cancellation.</span></span> <span data-ttu-id="d60d6-125">Os aplicativos nunca devem permanecer inativos sem que a conclusão ocorra.</span><span class="sxs-lookup"><span data-stu-id="d60d6-125">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span>  
  
-   <span data-ttu-id="d60d6-126">Você deve capturar todas as exceções que ocorrerem na operação assíncrona e atribuir a exceção de captura à propriedade <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-126">Ensure that you catch any exceptions that occur in the asynchronous operation and assign the caught exception to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
-   <span data-ttu-id="d60d6-127">Caso ocorra um erro ao concluir a tarefa, os resultados não devem estar acessíveis.</span><span class="sxs-lookup"><span data-stu-id="d60d6-127">If there was an error completing the task, the results should not be accessible.</span></span> <span data-ttu-id="d60d6-128">Quando a propriedade <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> não for `null`, verifique se o acesso a qualquer propriedade na estrutura <xref:System.EventArgs> gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="d60d6-128">When the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property is not `null`, ensure that accessing any property in the <xref:System.EventArgs> structure raises an exception.</span></span> <span data-ttu-id="d60d6-129">Use o método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> para fazer essa verificação.</span><span class="sxs-lookup"><span data-stu-id="d60d6-129">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method to perform this verification.</span></span>  
  
-   <span data-ttu-id="d60d6-130">Defina o tempo limite como um erro.</span><span class="sxs-lookup"><span data-stu-id="d60d6-130">Model a time out as an error.</span></span> <span data-ttu-id="d60d6-131">Em caso de evento de tempo limite, gere o evento *MethodName***Completed** e atribua um <xref:System.TimeoutException> à propriedade <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-131">When a time out occurs, raise the *MethodName***Completed** event and assign a <xref:System.TimeoutException> to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
-   <span data-ttu-id="d60d6-132">Se a sua classe permite usar diversas invocações ao mesmo tempo, garanta que o evento *MethodName***Completed** tenha o objeto `userSuppliedState` apropriado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-132">If your class supports multiple concurrent invocations, ensure that the *MethodName***Completed** event contains the appropriate `userSuppliedState` object.</span></span>  
  
-   <span data-ttu-id="d60d6-133">Verifique se o evento *MethodName***Completed** é gerado no thread certo e no momento certo do ciclo de vida do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d60d6-133">Ensure that the *MethodName***Completed** event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="d60d6-134">Para obter mais informações, consulte a seção Threads e contextos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-134">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="simultaneously-executing-operations"></a><span data-ttu-id="d60d6-135">Operações em execução simultânea</span><span class="sxs-lookup"><span data-stu-id="d60d6-135">Simultaneously Executing Operations</span></span>  
  
-   <span data-ttu-id="d60d6-136">Se sua classe permite fazer diversas invocações ao mesmo tempo, permita que o desenvolvedor acompanhe cada invocação separadamente. Para isso, defina a sobrecarga de *MethodName***Async** que usa um parâmetro de estado com valor de objeto, ou ID de tarefa, chamado `userSuppliedState`.</span><span class="sxs-lookup"><span data-stu-id="d60d6-136">If your class supports multiple concurrent invocations, enable the developer to track each invocation separately by defining the *MethodName***Async** overload that takes an object-valued state parameter, or task ID, called `userSuppliedState`.</span></span> <span data-ttu-id="d60d6-137">Esse parâmetro sempre deve ser o último presente na assinatura do método *MethodName***Async**.</span><span class="sxs-lookup"><span data-stu-id="d60d6-137">This parameter should always be the last parameter in the *MethodName***Async** method's signature.</span></span>  
  
-   <span data-ttu-id="d60d6-138">Se a sua classe define a sobrecarga de *MethodName***Async** que usa um parâmetro de estado com valor de objeto, ou ID de tarefa, acompanhe o tempo de vida da operação com essa ID de tarefa e informe o indicador de conclusão.</span><span class="sxs-lookup"><span data-stu-id="d60d6-138">If your class defines the *MethodName***Async** overload that takes an object-valued state parameter, or task ID, be sure to track the lifetime of the operation with that task ID, and be sure to provide it back into the completion handler.</span></span> <span data-ttu-id="d60d6-139">Há algumas classes auxiliares disponíveis para ajudar.</span><span class="sxs-lookup"><span data-stu-id="d60d6-139">There are helper classes available to assist.</span></span> <span data-ttu-id="d60d6-140">Para saber mais sobre o gerenciamento de simultaneidade, veja [Instruções passo a passo: implementando um componente compatível com o Padrão Assíncrono baseado em Evento](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="d60d6-140">For more information on concurrency management, see [Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
-   <span data-ttu-id="d60d6-141">Se sua classe define o método *MethodName***Async** sem o parâmetro de estado e não for compatível com diversas invocações ao mesmo tempo, verifique se as tentativas de invocar *MethodName***Async** antes da conclusão da invocação anterior de *MethodName***Async** gera um <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-141">If your class defines the *MethodName***Async** method without the state parameter, and it does not support multiple concurrent invocations, ensure that any attempt to invoke *MethodName***Async** before the prior *MethodName***Async** invocation has completed raises an <xref:System.InvalidOperationException>.</span></span>  
  
-   <span data-ttu-id="d60d6-142">Em geral, não gere a exceção se o método *MethodName***Async** sem o parâmetro `userSuppliedState` for invocado diversas vezes para que haja diversas operações pendentes.</span><span class="sxs-lookup"><span data-stu-id="d60d6-142">In general, do not raise an exception if the *MethodName***Async** method without the `userSuppliedState` parameter is invoked multiple times so that there are multiple outstanding operations.</span></span> <span data-ttu-id="d60d6-143">Você pode gerar uma exceção quando a classe não puder explicitamente lidar com essa situação, e você deduzir que os desenvolvedores podem lidar com esses diversos retornos de chamada indistinguíveis.</span><span class="sxs-lookup"><span data-stu-id="d60d6-143">You can raise an exception when your class explicitly cannot handle that situation, but assume that developers can handle these multiple indistinguishable callbacks</span></span>  
  
### <a name="accessing-results"></a><span data-ttu-id="d60d6-144">Acessando os resultados</span><span class="sxs-lookup"><span data-stu-id="d60d6-144">Accessing Results</span></span>  
  
-   <span data-ttu-id="d60d6-145">Caso ocorra um erro durante a execução da operação assíncrona, os resultados não devem estar acessíveis.</span><span class="sxs-lookup"><span data-stu-id="d60d6-145">If there was an error during execution of the asynchronous operation, the results should not be accessible.</span></span> <span data-ttu-id="d60d6-146">Verifique se o acesso a qualquer propriedade no <xref:System.ComponentModel.AsyncCompletedEventArgs> quando <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> não for `null`, gera a exceção usada como referência por <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-146">Ensure that accessing any property in the <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> is not `null` raises the exception referenced by <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span></span> <span data-ttu-id="d60d6-147">A classe <xref:System.ComponentModel.AsyncCompletedEventArgs> fornece o método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> para esse propósito.</span><span class="sxs-lookup"><span data-stu-id="d60d6-147">The <xref:System.ComponentModel.AsyncCompletedEventArgs> class provides the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method for this purpose.</span></span>  
  
-   <span data-ttu-id="d60d6-148">Verifique se todas as tentativas de acessar o resultado geram um <xref:System.InvalidOperationException>, indicando que a operação foi cancelada.</span><span class="sxs-lookup"><span data-stu-id="d60d6-148">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="d60d6-149">Use o método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> para fazer essa verificação.</span><span class="sxs-lookup"><span data-stu-id="d60d6-149">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
### <a name="progress-reporting"></a><span data-ttu-id="d60d6-150">Relatórios de progresso</span><span class="sxs-lookup"><span data-stu-id="d60d6-150">Progress Reporting</span></span>  
  
-   <span data-ttu-id="d60d6-151">Permita o uso de relatórios de progresso, se possível.</span><span class="sxs-lookup"><span data-stu-id="d60d6-151">Support progress reporting, if possible.</span></span> <span data-ttu-id="d60d6-152">Isso permite que os desenvolvedores melhorem a experiência dos usuários do aplicativo quando eles usam sua classe.</span><span class="sxs-lookup"><span data-stu-id="d60d6-152">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
-   <span data-ttu-id="d60d6-153">Se você implementar um evento **ProgressChanged** ou *MethodName***ProgressChanged**, verifique se há eventos desse tipo para operações assíncronas específicas após o evento *MethodName***Completed** da operação.</span><span class="sxs-lookup"><span data-stu-id="d60d6-153">If you implement a **ProgressChanged** or *MethodName***ProgressChanged** event, ensure that there are no such events raised for a particular asynchronous operation after that operation's *MethodName***Completed** event has been raised.</span></span>  
  
-   <span data-ttu-id="d60d6-154">Se o <xref:System.ComponentModel.ProgressChangedEventArgs> padrão estiver sendo preenchido, verifique se <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> sempre pode ser identificado como uma porcentagem.</span><span class="sxs-lookup"><span data-stu-id="d60d6-154">If the standard <xref:System.ComponentModel.ProgressChangedEventArgs> is being populated, ensure that the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> can always be interpreted as a percentage.</span></span> <span data-ttu-id="d60d6-155">A porcentagem não precisa ser precisa, mas deve representar uma porcentagem.</span><span class="sxs-lookup"><span data-stu-id="d60d6-155">The percentage does not need to be accurate, but it should represent a percentage.</span></span> <span data-ttu-id="d60d6-156">Se a métrica do relatório de progresso não tiver que ser uma porcentagem, derive uma classe da classe <xref:System.ComponentModel.ProgressChangedEventArgs> e deixe <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> como 0.</span><span class="sxs-lookup"><span data-stu-id="d60d6-156">If your progress reporting metric must be something other than a percentage, derive a class from the <xref:System.ComponentModel.ProgressChangedEventArgs> class and leave <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> at 0.</span></span> <span data-ttu-id="d60d6-157">Evite usar outras métricas além de porcentagem nos relatórios.</span><span class="sxs-lookup"><span data-stu-id="d60d6-157">Avoid using a reporting metric other than a percentage.</span></span>  
  
-   <span data-ttu-id="d60d6-158">Verifique se o evento `ProgressChanged` é gerado no thread certo e no momento certo do ciclo de vida do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d60d6-158">Ensure that the `ProgressChanged` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="d60d6-159">Para obter mais informações, consulte a seção Threads e contextos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-159">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="isbusy-implementation"></a><span data-ttu-id="d60d6-160">Implementação IsBusy</span><span class="sxs-lookup"><span data-stu-id="d60d6-160">IsBusy Implementation</span></span>  
  
-   <span data-ttu-id="d60d6-161">Não exponha a propriedade `IsBusy` se a classe for compatível com diversas invocações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="d60d6-161">Do not expose an `IsBusy` property if your class supports multiple concurrent invocations.</span></span> <span data-ttu-id="d60d6-162">Por exemplo, os proxies de serviço Web XML não expõem a propriedade `IsBusy` porque permitem usar diversas invocações simultâneas de métodos assíncronos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-162">For example, XML Web service proxies do not expose an `IsBusy` property because they support multiple concurrent invocations of asynchronous methods.</span></span>  
  
-   <span data-ttu-id="d60d6-163">A propriedade `IsBusy` deve retornar `true` depois que o método *MethodName***Async** for chamado e antes da geração do evento *MethodName***Completed**.</span><span class="sxs-lookup"><span data-stu-id="d60d6-163">The `IsBusy` property should return `true` after the *MethodName***Async** method has been called and before the *MethodName***Completed** event has been raised.</span></span> <span data-ttu-id="d60d6-164">Caso contrário, ela deve retornar `false`.</span><span class="sxs-lookup"><span data-stu-id="d60d6-164">Otherwise it should return `false`.</span></span> <span data-ttu-id="d60d6-165">Os componentes <xref:System.ComponentModel.BackgroundWorker> e <xref:System.Net.WebClient> são exemplos de classes que expõem uma propriedade `IsBusy`.</span><span class="sxs-lookup"><span data-stu-id="d60d6-165">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.Net.WebClient> components are examples of classes that expose an `IsBusy` property.</span></span>  
  
### <a name="cancellation"></a><span data-ttu-id="d60d6-166">Cancelamento</span><span class="sxs-lookup"><span data-stu-id="d60d6-166">Cancellation</span></span>  
  
-   <span data-ttu-id="d60d6-167">Permita o cancelamento, se possível.</span><span class="sxs-lookup"><span data-stu-id="d60d6-167">Support cancellation, if possible.</span></span> <span data-ttu-id="d60d6-168">Isso permite que os desenvolvedores melhorem a experiência dos usuários do aplicativo quando eles usam sua classe.</span><span class="sxs-lookup"><span data-stu-id="d60d6-168">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
-   <span data-ttu-id="d60d6-169">Em caso de cancelamento, defina o sinalizador <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> no objeto <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-169">In the case of cancellation, set the <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flag in the <xref:System.ComponentModel.AsyncCompletedEventArgs> object.</span></span>  
  
-   <span data-ttu-id="d60d6-170">Verifique se todas as tentativas de acessar o resultado geram um <xref:System.InvalidOperationException>, indicando que a operação foi cancelada.</span><span class="sxs-lookup"><span data-stu-id="d60d6-170">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="d60d6-171">Use o método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> para fazer essa verificação.</span><span class="sxs-lookup"><span data-stu-id="d60d6-171">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
-   <span data-ttu-id="d60d6-172">Verifique se as chamadas de um método de cancelamento sempre retornam com êxito e nunca geram uma exceção.</span><span class="sxs-lookup"><span data-stu-id="d60d6-172">Ensure that calls to a cancellation method always return successfully, and never raise an exception.</span></span> <span data-ttu-id="d60d6-173">Em geral, o cliente não é notificado se a operação pode mesmo ser cancelada a qualquer momento, nem se o cancelamento emitido foi realizado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-173">In general, a client is not notified as to whether an operation is truly cancelable at any given time, and is not notified as to whether a previously issued cancellation has succeeded.</span></span> <span data-ttu-id="d60d6-174">No entanto, o aplicativo sempre recebe uma notificação quando o cancelamento é realizado. Isso acontece porque o aplicativo participa do status de conclusão.</span><span class="sxs-lookup"><span data-stu-id="d60d6-174">However, the application will always be given notification when a cancellation succeeded, because the application takes part in the completion status.</span></span>  
  
-   <span data-ttu-id="d60d6-175">Acione o evento *MethodName***Completed** quando a operação for cancelada.</span><span class="sxs-lookup"><span data-stu-id="d60d6-175">Raise the *MethodName***Completed** event when the operation is canceled.</span></span>  
  
### <a name="errors-and-exceptions"></a><span data-ttu-id="d60d6-176">Erros e exceções</span><span class="sxs-lookup"><span data-stu-id="d60d6-176">Errors and Exceptions</span></span>  
  
-   <span data-ttu-id="d60d6-177">Capture todas as exceções que ocorrerem na operação assíncrona e defina o valor da propriedade <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> para essa exceção.</span><span class="sxs-lookup"><span data-stu-id="d60d6-177">Catch any exceptions that occur in the asynchronous operation and set the value of the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> property to that exception.</span></span>  
  
### <a name="threading-and-contexts"></a><span data-ttu-id="d60d6-178">Threads e contextos</span><span class="sxs-lookup"><span data-stu-id="d60d6-178">Threading and Contexts</span></span>  
 <span data-ttu-id="d60d6-179">Para que sua classe opere corretamente, é essencial que os indicadores de eventos do cliente sejam invocados no thread ou contexto certo de acordo com o modelo do aplicativo, incluindo [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] e aplicativos Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="d60d6-179">For correct operation of your class, it is critical that the client's event handlers are invoked on the proper thread or context for the given application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] and Windows Forms applications.</span></span> <span data-ttu-id="d60d6-180">Duas importantes classes auxiliares são fornecidas para garantir que a classe assíncrona se comporte corretamente em qualquer modelo de aplicativo: <xref:System.ComponentModel.AsyncOperation> e <xref:System.ComponentModel.AsyncOperationManager>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-180">Two important helper classes are provided to ensure that your asynchronous class behaves correctly under any application model: <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager>.</span></span>  
  
 <span data-ttu-id="d60d6-181"><xref:System.ComponentModel.AsyncOperationManager> fornece um método, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, que retorna um <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-181"><xref:System.ComponentModel.AsyncOperationManager> provides one method, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, which returns an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="d60d6-182">Seu método *MethodName***Async** chama <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> e sua classe usa o <xref:System.ComponentModel.AsyncOperation> retornado para acompanhar o tempo de vida da tarefa assíncrona.</span><span class="sxs-lookup"><span data-stu-id="d60d6-182">Your *MethodName***Async** method calls <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> and your class uses the returned <xref:System.ComponentModel.AsyncOperation> to track the lifetime of the asynchronous task.</span></span>  
  
 <span data-ttu-id="d60d6-183">Para criar relatórios de progresso, resultados incrementais e conclusão para o cliente, chame os métodos <xref:System.ComponentModel.AsyncOperation.Post%2A> e <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> no <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-183">To report progress, incremental results, and completion to the client, call the <xref:System.ComponentModel.AsyncOperation.Post%2A> and <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> methods on the <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="d60d6-184"><xref:System.ComponentModel.AsyncOperation> é responsável por fazer marshaling de chamadas para os identificadores de eventos de cliente para o thread ou contexto adequado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-184"><xref:System.ComponentModel.AsyncOperation> is responsible for marshaling calls to the client's event handlers to the proper thread or context.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d60d6-185">Você pode driblar essas regras se quiser explicitamente ir contra a política de modelo de aplicativos, e ainda aproveitar outras vantagens do padrão assíncrono baseado em eventos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-185">You can circumvent these rules if you explicitly want to go against the policy of the application model, but still benefit from the other advantages of using the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="d60d6-186">Por exemplo, uma classe pode operar no Windows Forms para ter threads livres.</span><span class="sxs-lookup"><span data-stu-id="d60d6-186">For example, you may want a class operating in Windows Forms to be free threaded.</span></span> <span data-ttu-id="d60d6-187">Você pode criar uma classe de thread livre, contanto que os desenvolvedores conheçam as restrições inerentes.</span><span class="sxs-lookup"><span data-stu-id="d60d6-187">You can create a free threaded class, as long as developers understand the implied restrictions.</span></span> <span data-ttu-id="d60d6-188">Os aplicativos de console não sincronizam a execução das chamadas de <xref:System.ComponentModel.AsyncOperation.Post%2A>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-188">Console applications do not synchronize the execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls.</span></span> <span data-ttu-id="d60d6-189">Isso pode fazer com que os eventos `ProgressChanged` sejam gerados fora de ordem.</span><span class="sxs-lookup"><span data-stu-id="d60d6-189">This can cause `ProgressChanged` events to be raised out of order.</span></span> <span data-ttu-id="d60d6-190">Se quiser que as chamadas <xref:System.ComponentModel.AsyncOperation.Post%2A> sejam executadas em série, implemente e instale uma classe <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-190">If you wish to have serialized execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls, implement and install a <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> class.</span></span>  
  
 <span data-ttu-id="d60d6-191">Para saber mais sobre como usar <xref:System.ComponentModel.AsyncOperation> e <xref:System.ComponentModel.AsyncOperationManager> para habilitar as operações assíncronas, veja [Passo a passo: implementando um componente compatível com o Padrão Assíncrono baseado em Evento](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="d60d6-191">For more information about using <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager> to enable your asynchronous operations, see [Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="guidelines"></a><span data-ttu-id="d60d6-192">Diretrizes</span><span class="sxs-lookup"><span data-stu-id="d60d6-192">Guidelines</span></span>  
  
-   <span data-ttu-id="d60d6-193">De modo ideal, cada invocação de método deve ser independente das demais.</span><span class="sxs-lookup"><span data-stu-id="d60d6-193">Ideally, each method invocation should be independent of others.</span></span> <span data-ttu-id="d60d6-194">Você deve evitar o agrupamento de invocações e recursos compartilhados.</span><span class="sxs-lookup"><span data-stu-id="d60d6-194">You should avoid coupling invocations with shared resources.</span></span> <span data-ttu-id="d60d6-195">Se for necessário compartilhar os recursos entre as invocações, será necessário fornecer um mecanismo de sincronização adequado na sua implementação.</span><span class="sxs-lookup"><span data-stu-id="d60d6-195">If resources are to be shared among invocations, you will need to provide a proper synchronization mechanism in your implementation.</span></span>  
  
-   <span data-ttu-id="d60d6-196">Não recomendamos o uso de designs que requerem que o cliente implemente a sincronização.</span><span class="sxs-lookup"><span data-stu-id="d60d6-196">Designs that require the client to implement synchronization are discouraged.</span></span> <span data-ttu-id="d60d6-197">Por exemplo, você pode ter um método assíncrono que recebe um objeto estático global como parâmetro, e diversas invocações simultâneas desse método podem resultar em dados corrompidos ou deadlocks.</span><span class="sxs-lookup"><span data-stu-id="d60d6-197">For example, you could have an asynchronous method that receives a global static object as a parameter; multiple concurrent invocations of such a method could result in data corruption or deadlocks.</span></span>  
  
-   <span data-ttu-id="d60d6-198">Se você implementar um método com sobrecarga de diversas invocações (`userState` na assinatura), sua classe precisará gerenciar uma coleção de estados dos usuários ou IDs de tarefas e suas respectivas operações pendentes.</span><span class="sxs-lookup"><span data-stu-id="d60d6-198">If you implement a method with the multiple-invocation overload (`userState` in the signature), your class will need to manage a collection of user states, or task IDs, and their corresponding pending operations.</span></span> <span data-ttu-id="d60d6-199">Essa coleção deve ser protegida com as regiões `lock` porque as diversas invocações adicionam e removem `userState` objetos da coleção.</span><span class="sxs-lookup"><span data-stu-id="d60d6-199">This collection should be protected with `lock` regions, because the various invocations add and remove `userState` objects in the collection.</span></span>  
  
-   <span data-ttu-id="d60d6-200">Considere reutilizar as classes `CompletedEventArgs` quando possível e adequado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-200">Consider reusing `CompletedEventArgs` classes where feasible and appropriate.</span></span> <span data-ttu-id="d60d6-201">Nesse caso, a nomenclatura não é consistente com o nome do método porque um determinado representante e o tipo <xref:System.EventArgs> não são vinculados a um único método.</span><span class="sxs-lookup"><span data-stu-id="d60d6-201">In this case, the naming is not consistent with the method name, because a given delegate and <xref:System.EventArgs> type are not tied to a single method.</span></span> <span data-ttu-id="d60d6-202">No entanto, forçar os desenvolvedores a converter o valor recuperado de uma propriedade no <xref:System.EventArgs> nunca é aceitável.</span><span class="sxs-lookup"><span data-stu-id="d60d6-202">However, forcing developers to cast the value retrieved from a property on the <xref:System.EventArgs> is never acceptable.</span></span>  
  
-   <span data-ttu-id="d60d6-203">Se você estiver criando uma classe que deriva de <xref:System.ComponentModel.Component>, não implemente nem instale sua própria classe <xref:System.Threading.SynchronizationContext>.</span><span class="sxs-lookup"><span data-stu-id="d60d6-203">If you are authoring a class that derives from <xref:System.ComponentModel.Component>, do not implement and install your own <xref:System.Threading.SynchronizationContext> class.</span></span> <span data-ttu-id="d60d6-204">Os modelos do aplicativo, e não os componentes, controlam o <xref:System.Threading.SynchronizationContext> usado.</span><span class="sxs-lookup"><span data-stu-id="d60d6-204">Application models, not components, control the <xref:System.Threading.SynchronizationContext> that is used.</span></span>  
  
-   <span data-ttu-id="d60d6-205">Ao usar multithreading de qualquer tipo, você pode enfrentar bugs muito sérios e complexos.</span><span class="sxs-lookup"><span data-stu-id="d60d6-205">When you use multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="d60d6-206">Veja as [Práticas recomendadas de threading gerenciado](../../../docs/standard/threading/managed-threading-best-practices.md) antes de implementar qualquer solução que use multithreading.</span><span class="sxs-lookup"><span data-stu-id="d60d6-206">Before implementing any solution that uses multithreading, see [Managed Threading Best Practices](../../../docs/standard/threading/managed-threading-best-practices.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d60d6-207">Consulte também</span><span class="sxs-lookup"><span data-stu-id="d60d6-207">See Also</span></span>  
 <xref:System.ComponentModel.AsyncOperation>  
 <xref:System.ComponentModel.AsyncOperationManager>  
 <xref:System.ComponentModel.AsyncCompletedEventArgs>  
 <xref:System.ComponentModel.ProgressChangedEventArgs>  
 <xref:System.ComponentModel.BackgroundWorker>  
 [<span data-ttu-id="d60d6-208">Implementando o Padrão Assíncrono baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-208">Implementing the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="d60d6-209">Programação multi-threaded com o padrão assíncrono baseado em evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-209">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="d60d6-210">Decidindo quando implementar o Padrão Assíncrono baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-210">Deciding When to Implement the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/deciding-when-to-implement-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="d60d6-211">Práticas recomendadas para a implementação do Padrão Assíncrono baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-211">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/best-practices-for-implementing-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="d60d6-212">Como usar componentes compatíveis com o Padrão Assíncrono baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-212">How to: Use Components That Support the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/how-to-use-components-that-support-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="d60d6-213">Instruções passo a passo: implementando um componente compatível com o Padrão Assíncrono baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="d60d6-213">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)
