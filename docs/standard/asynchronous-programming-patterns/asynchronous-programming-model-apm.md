---
title: Modelo de programação assíncrona (APM)
description: Saiba mais sobre o modelo de programação assíncrona (APM) no .NET. Descubra como iniciar e encerrar uma operação assíncrona.
ms.date: 03/30/2017
helpviewer_keywords:
- ending asynchronous operations
- starting asynchronous operations
- beginning asynchronous operations
- asynchronous programming, ending operations
- asynchronous programming
- stopping asynchronous operations
- asynchronous programming, beginning operations
ms.assetid: c9b3501e-6bc6-40f9-8efd-4b6d9e39ccf0
ms.openlocfilehash: a6e2ed06e92adffa6c8a61b27bbff994370e8b34
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/24/2020
ms.locfileid: "95722733"
---
# <a name="asynchronous-programming-model-apm"></a><span data-ttu-id="de730-104">Modelo de programação assíncrona (APM)</span><span class="sxs-lookup"><span data-stu-id="de730-104">Asynchronous Programming Model (APM)</span></span>

<span data-ttu-id="de730-105">Uma operação assíncrona que utiliza o padrão de design <xref:System.IAsyncResult> é implementada como dois métodos chamados `BeginOperationName` e `EndOperationName` que começam e terminam a operação assíncrona *OperationName*, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="de730-105">An asynchronous operation that uses the <xref:System.IAsyncResult> design pattern is implemented as two methods named `BeginOperationName` and `EndOperationName` that begin and end the asynchronous operation *OperationName* respectively.</span></span> <span data-ttu-id="de730-106">Por exemplo, a classe <xref:System.IO.FileStream> fornece os métodos <xref:System.IO.FileStream.BeginRead%2A> e <xref:System.IO.FileStream.EndRead%2A> para ler os bytes de um arquivo de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-106">For example, the <xref:System.IO.FileStream> class provides the <xref:System.IO.FileStream.BeginRead%2A> and <xref:System.IO.FileStream.EndRead%2A> methods to asynchronously read bytes from a file.</span></span> <span data-ttu-id="de730-107">Esses métodos implementam a versão assíncrona do método <xref:System.IO.FileStream.Read%2A>.</span><span class="sxs-lookup"><span data-stu-id="de730-107">These methods implement the asynchronous version of the <xref:System.IO.FileStream.Read%2A> method.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="de730-108">A partir do .NET Framework 4, a Biblioteca de Paralelismo de Tarefas fornece um novo modelo de programação paralela e assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-108">Starting with the .NET Framework 4, the Task Parallel Library provides a new model for asynchronous and parallel programming.</span></span> <span data-ttu-id="de730-109">Para obter mais informações, consulte a [TPL (biblioteca paralela de tarefas)](../parallel-programming/task-parallel-library-tpl.md) e o [padrão assíncrono baseado em tarefa (toque)](task-based-asynchronous-pattern-tap.md)).</span><span class="sxs-lookup"><span data-stu-id="de730-109">For more information, see [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) and [Task-based Asynchronous Pattern (TAP)](task-based-asynchronous-pattern-tap.md)).</span></span>  
  
 <span data-ttu-id="de730-110">Depois de chamar `BeginOperationName`, um aplicativo pode continuar a executar as instruções no thread de chamada, enquanto a operação assíncrona ocorre em um thread diferente.</span><span class="sxs-lookup"><span data-stu-id="de730-110">After calling `BeginOperationName`, an application can continue executing instructions on the calling thread while the asynchronous operation takes place on a different thread.</span></span> <span data-ttu-id="de730-111">Cada chamada para `BeginOperationName`, o aplicativo também deve chamar `EndOperationName` para obter os resultados da operação.</span><span class="sxs-lookup"><span data-stu-id="de730-111">For each call to `BeginOperationName`, the application should also call `EndOperationName` to get the results of the operation.</span></span>  
  
## <a name="beginning-an-asynchronous-operation"></a><span data-ttu-id="de730-112">Começando uma operação assíncrona</span><span class="sxs-lookup"><span data-stu-id="de730-112">Beginning an Asynchronous Operation</span></span>  

 <span data-ttu-id="de730-113">O método `BeginOperationName` inicia a operação assíncrona *OperationName* e retorna um objeto que implementa a interface <xref:System.IAsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="de730-113">The `BeginOperationName` method begins asynchronous operation *OperationName* and returns an object that implements the <xref:System.IAsyncResult> interface.</span></span> <span data-ttu-id="de730-114">Os objetos <xref:System.IAsyncResult> armazenam as informações sobre uma operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-114"><xref:System.IAsyncResult> objects store information about an asynchronous operation.</span></span> <span data-ttu-id="de730-115">A tabela a seguir mostra informações sobre uma operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-115">The following table shows information about an asynchronous operation.</span></span>  
  
|<span data-ttu-id="de730-116">Membro</span><span class="sxs-lookup"><span data-stu-id="de730-116">Member</span></span>|<span data-ttu-id="de730-117">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="de730-117">Description</span></span>|  
|------------|-----------------|  
|<xref:System.IAsyncResult.AsyncState%2A>|<span data-ttu-id="de730-118">Um objeto específico do aplicativo opcional que contém informações sobre a operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-118">An optional application-specific object that contains information about the asynchronous operation.</span></span>|  
|<xref:System.IAsyncResult.AsyncWaitHandle%2A>|<span data-ttu-id="de730-119">Um <xref:System.Threading.WaitHandle> que pode ser usado para bloquear a execução do aplicativo até que a operação assíncrona seja concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-119">A <xref:System.Threading.WaitHandle> that can be used to block application execution until the asynchronous operation completes.</span></span>|  
|<xref:System.IAsyncResult.CompletedSynchronously%2A>|<span data-ttu-id="de730-120">Um valor que indica se a operação assíncrona foi concluída no thread usado para chamar `BeginOperationName` em vez de concluir em um thread <xref:System.Threading.ThreadPool> separado.</span><span class="sxs-lookup"><span data-stu-id="de730-120">A value that indicates whether the asynchronous operation completed on the thread used to call `BeginOperationName` instead of completing on a separate <xref:System.Threading.ThreadPool> thread.</span></span>|  
|<xref:System.IAsyncResult.IsCompleted%2A>|<span data-ttu-id="de730-121">Um valor que indica se a operação assíncrona foi concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-121">A value that indicates whether the asynchronous operation has completed.</span></span>|  
  
 <span data-ttu-id="de730-122">Um método `BeginOperationName` usa qualquer parâmetro declarado na assinatura da versão síncrona do método que é passado por valor ou referência.</span><span class="sxs-lookup"><span data-stu-id="de730-122">A `BeginOperationName` method takes any parameters declared in the signature of the synchronous version of the method that are passed by value or by reference.</span></span> <span data-ttu-id="de730-123">Os parâmetros de saída não são parte da assinatura do método `BeginOperationName`.</span><span class="sxs-lookup"><span data-stu-id="de730-123">Any out parameters are not part of the `BeginOperationName` method signature.</span></span> <span data-ttu-id="de730-124">A assinatura do método `BeginOperationName` também inclui dois parâmetros adicionais.</span><span class="sxs-lookup"><span data-stu-id="de730-124">The `BeginOperationName` method signature also includes two additional parameters.</span></span> <span data-ttu-id="de730-125">O primeiro deles define um delegado <xref:System.AsyncCallback> que faz referência a um método que é chamado quando a operação assíncrona é concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-125">The first of these defines an <xref:System.AsyncCallback> delegate that references a method that is called when the asynchronous operation completes.</span></span> <span data-ttu-id="de730-126">O chamador pode especificar `null` (`Nothing` no Visual Basic) se não desejar um método chamado quando a operação for concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-126">The caller can specify `null` (`Nothing` in Visual Basic) if it does not want a method invoked when the operation completes.</span></span> <span data-ttu-id="de730-127">O segundo parâmetro adicional é um objeto definido pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="de730-127">The second additional parameter is a user-defined object.</span></span> <span data-ttu-id="de730-128">Esse objeto pode ser usado para passar informações de estado específico do aplicativo para o método invocado quando a operação assíncrona é concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-128">This object can be used to pass application-specific state information to the method invoked when the asynchronous operation completes.</span></span> <span data-ttu-id="de730-129">Se um método `BeginOperationName` usar parâmetros adicionais específicos da operação, como uma matriz de bytes para armazenar os bytes lidos de um arquivo, o <xref:System.AsyncCallback> e o objeto de estado do aplicativo serão os últimos parâmetros da assinatura de método `BeginOperationName`.</span><span class="sxs-lookup"><span data-stu-id="de730-129">If a `BeginOperationName` method takes additional operation-specific parameters, such as a byte array to store bytes read from a file, the <xref:System.AsyncCallback> and application state object are the last parameters in the `BeginOperationName` method signature.</span></span>  
  
 <span data-ttu-id="de730-130">`BeginOperationName` retorna o controle para o thread de chamada imediatamente.</span><span class="sxs-lookup"><span data-stu-id="de730-130">`BeginOperationName` returns control to the calling thread immediately.</span></span> <span data-ttu-id="de730-131">Se o método `BeginOperationName` gerar exceções, as exceções serão geradas antes de a operação assíncrona ser iniciada.</span><span class="sxs-lookup"><span data-stu-id="de730-131">If the `BeginOperationName` method throws exceptions, the exceptions are thrown before the asynchronous operation is started.</span></span> <span data-ttu-id="de730-132">Se o método `BeginOperationName` gerar exceções, o método de retorno de chamada não será invocado.</span><span class="sxs-lookup"><span data-stu-id="de730-132">If the `BeginOperationName` method throws exceptions, the callback method is not invoked.</span></span>  
  
## <a name="ending-an-asynchronous-operation"></a><span data-ttu-id="de730-133">Encerrando uma operação assíncrona</span><span class="sxs-lookup"><span data-stu-id="de730-133">Ending an Asynchronous Operation</span></span>  

 <span data-ttu-id="de730-134">O método `EndOperationName` termina a operação assíncrona *OperationName*.</span><span class="sxs-lookup"><span data-stu-id="de730-134">The `EndOperationName` method ends asynchronous operation *OperationName*.</span></span> <span data-ttu-id="de730-135">O valor retornado do método `EndOperationName` é do mesmo tipo retornado pela sua contraparte síncrona e é específico para a operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-135">The return value of the `EndOperationName` method is the same type returned by its synchronous counterpart and is specific to the asynchronous operation.</span></span> <span data-ttu-id="de730-136">Por exemplo, o método <xref:System.IO.FileStream.EndRead%2A> retorna o número de bytes lidos de um <xref:System.IO.FileStream> e o método <xref:System.Net.Dns.EndGetHostByName%2A> retorna um objeto <xref:System.Net.IPHostEntry> que contém informações sobre um computador host.</span><span class="sxs-lookup"><span data-stu-id="de730-136">For example, the <xref:System.IO.FileStream.EndRead%2A> method returns the number of bytes read from a <xref:System.IO.FileStream> and the <xref:System.Net.Dns.EndGetHostByName%2A> method returns an <xref:System.Net.IPHostEntry> object that contains information about a host computer.</span></span> <span data-ttu-id="de730-137">O método `EndOperationName` usa qualquer parâmetro declarado de referência na assinatura da versão síncrona do método.</span><span class="sxs-lookup"><span data-stu-id="de730-137">The `EndOperationName` method takes any out or ref parameters declared in the signature of the synchronous version of the method.</span></span> <span data-ttu-id="de730-138">Além dos parâmetros do método síncrono, o método `EndOperationName` também inclui um parâmetro <xref:System.IAsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="de730-138">In addition to the parameters from the synchronous method, the `EndOperationName` method also includes an <xref:System.IAsyncResult> parameter.</span></span> <span data-ttu-id="de730-139">Os chamadores devem passar a instância retornada pela chamada correspondente para `BeginOperationName`.</span><span class="sxs-lookup"><span data-stu-id="de730-139">Callers must pass the instance returned by the corresponding call to `BeginOperationName`.</span></span>  
  
 <span data-ttu-id="de730-140">Se a operação assíncrona representada pelo objeto <xref:System.IAsyncResult> não tiver sido concluída quando `EndOperationName` for chamado, `EndOperationName` bloqueará o thread de chamada até que a operação assíncrona seja concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-140">If the asynchronous operation represented by the <xref:System.IAsyncResult> object has not completed when `EndOperationName` is called, `EndOperationName` blocks the calling thread until the asynchronous operation is complete.</span></span> <span data-ttu-id="de730-141">As exceções geradas pela operação assíncrona são geradas do método `EndOperationName`.</span><span class="sxs-lookup"><span data-stu-id="de730-141">Exceptions thrown by the asynchronous operation are thrown from the `EndOperationName` method.</span></span> <span data-ttu-id="de730-142">O efeito da chamada para o método `EndOperationName` várias vezes com o mesmo <xref:System.IAsyncResult> não é definido.</span><span class="sxs-lookup"><span data-stu-id="de730-142">The effect of calling the `EndOperationName` method multiple times with the same <xref:System.IAsyncResult> is not defined.</span></span> <span data-ttu-id="de730-143">Da mesma forma, chamar o método `EndOperationName` com um <xref:System.IAsyncResult> que não foi retornado pelo método Begin relacionado também não será definido.</span><span class="sxs-lookup"><span data-stu-id="de730-143">Likewise, calling the `EndOperationName` method with an <xref:System.IAsyncResult> that was not returned by the related Begin method is also not defined.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="de730-144">Para qualquer um dos cenários indefinidos, os implementadores devem considerar a geração de <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="de730-144">For either of the undefined scenarios, implementers should consider throwing <xref:System.InvalidOperationException>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="de730-145">Os implementadores deste padrão de design devem notificar o chamador de que a operação assíncrona está concluída, definindo <xref:System.IAsyncResult.IsCompleted%2A> como true, chamando o método de retorno de chamada assíncrono (se tiver sido especificado) e sinalizando o <xref:System.IAsyncResult.AsyncWaitHandle%2A>.</span><span class="sxs-lookup"><span data-stu-id="de730-145">Implementers of this design pattern should notify the caller that the asynchronous operation completed by setting <xref:System.IAsyncResult.IsCompleted%2A> to true, calling the asynchronous callback method (if one was specified) and signaling the <xref:System.IAsyncResult.AsyncWaitHandle%2A>.</span></span>  
  
 <span data-ttu-id="de730-146">Os desenvolvedores de aplicativos tem várias opções de design para acessar os resultados da operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="de730-146">Application developers have several design choices for accessing the results of the asynchronous operation.</span></span> <span data-ttu-id="de730-147">A opção correta depende se o aplicativo tem instruções que podem ser executadas enquanto a operação é concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-147">The correct choice depends on whether the application has instructions that can execute while the operation completes.</span></span> <span data-ttu-id="de730-148">Se um aplicativo não puder executar trabalho adicional até que ele receba os resultados da operação assíncrona, o aplicativo deverá ser bloqueado até que os resultados estejam disponíveis.</span><span class="sxs-lookup"><span data-stu-id="de730-148">If an application cannot perform any additional work until it receives the results of the asynchronous operation, the application must block until the results are available.</span></span> <span data-ttu-id="de730-149">Para bloquear até que uma operação assíncrona seja concluída, você poderá usar uma das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="de730-149">To block until an asynchronous operation completes, you can use one of the following approaches:</span></span>  
  
- <span data-ttu-id="de730-150">Chamar `EndOperationName` do thread principal do aplicativo, bloqueando a execução do aplicativo até que a operação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-150">Call `EndOperationName` from the application’s main thread, blocking application execution until the operation is complete.</span></span> <span data-ttu-id="de730-151">Veja um exemplo que ilustra essa técnica em [Bloqueando a execução de um aplicativo encerrando uma operação assíncrona](blocking-application-execution-by-ending-an-async-operation.md).</span><span class="sxs-lookup"><span data-stu-id="de730-151">For an example that illustrates this technique, see [Blocking Application Execution by Ending an Async Operation](blocking-application-execution-by-ending-an-async-operation.md).</span></span>  
  
- <span data-ttu-id="de730-152">Use o <xref:System.IAsyncResult.AsyncWaitHandle%2A> para impedir a execução do aplicativo até que uma ou mais operações sejam concluídas.</span><span class="sxs-lookup"><span data-stu-id="de730-152">Use the <xref:System.IAsyncResult.AsyncWaitHandle%2A> to block application execution until one or more operations are complete.</span></span> <span data-ttu-id="de730-153">Veja um exemplo que ilustra essa técnica em [Bloqueando a execução de um aplicativo com um AsyncWaitHandle](blocking-application-execution-using-an-asyncwaithandle.md).</span><span class="sxs-lookup"><span data-stu-id="de730-153">For an example that illustrates this technique, see [Blocking Application Execution Using an AsyncWaitHandle](blocking-application-execution-using-an-asyncwaithandle.md).</span></span>  
  
 <span data-ttu-id="de730-154">Os aplicativos que não precisarem ser bloqueados enquanto a operação assíncrona é concluída podem usar uma das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="de730-154">Applications that do not need to block while the asynchronous operation completes can use one of the following approaches:</span></span>  
  
- <span data-ttu-id="de730-155">Sondagem de status de conclusão da operação, verificando a propriedade <xref:System.IAsyncResult.IsCompleted%2A> periodicamente e chamando `EndOperationName` quando a operação for concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-155">Poll for operation completion status by checking the <xref:System.IAsyncResult.IsCompleted%2A> property periodically and calling `EndOperationName` when the operation is complete.</span></span> <span data-ttu-id="de730-156">Veja um exemplo que ilustra essa técnica em [Sondagem do status de uma operação assíncrona](polling-for-the-status-of-an-asynchronous-operation.md).</span><span class="sxs-lookup"><span data-stu-id="de730-156">For an example that illustrates this technique, see [Polling for the Status of an Asynchronous Operation](polling-for-the-status-of-an-asynchronous-operation.md).</span></span>  
  
- <span data-ttu-id="de730-157">Use um delegado <xref:System.AsyncCallback> para especificar um método a ser invocado quando a operação for concluída.</span><span class="sxs-lookup"><span data-stu-id="de730-157">Use an <xref:System.AsyncCallback> delegate to specify a method to be invoked when the operation is complete.</span></span> <span data-ttu-id="de730-158">Veja um exemplo que ilustra essa técnica em [Usar um representante AsyncCallback para finalizar uma operação assíncrona](using-an-asynccallback-delegate-to-end-an-asynchronous-operation.md).</span><span class="sxs-lookup"><span data-stu-id="de730-158">For an example that illustrates this technique, see [Using an AsyncCallback Delegate to End an Asynchronous Operation](using-an-asynccallback-delegate-to-end-an-asynchronous-operation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="de730-159">Confira também</span><span class="sxs-lookup"><span data-stu-id="de730-159">See also</span></span>

- [<span data-ttu-id="de730-160">Padrão assíncrono baseado em evento (EAP)</span><span class="sxs-lookup"><span data-stu-id="de730-160">Event-based Asynchronous Pattern (EAP)</span></span>](event-based-asynchronous-pattern-eap.md)
- [<span data-ttu-id="de730-161">Chamando métodos síncronos de forma assíncrona</span><span class="sxs-lookup"><span data-stu-id="de730-161">Calling Synchronous Methods Asynchronously</span></span>](calling-synchronous-methods-asynchronously.md)
- [<span data-ttu-id="de730-162">Usando um delegado AsyncCallback e um objeto de estado</span><span class="sxs-lookup"><span data-stu-id="de730-162">Using an AsyncCallback Delegate and State Object</span></span>](using-an-asynccallback-delegate-and-state-object.md)
