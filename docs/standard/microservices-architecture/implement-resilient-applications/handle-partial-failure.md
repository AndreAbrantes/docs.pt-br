---
title: Tratamento de falha parcial
description: "Arquitetura de Microservices .NET para aplicativos .NET em contêineres | Tratamento de falha parcial"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: b7d16acf3de2d395da70e8f46e59c129dec24f71
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="handling-partial-failure"></a><span data-ttu-id="ac4a3-104">Tratamento de falha parcial</span><span class="sxs-lookup"><span data-stu-id="ac4a3-104">Handling partial failure</span></span>

<span data-ttu-id="ac4a3-105">Em sistemas distribuídos como aplicativos baseados em microservices, há um risco de sempre presente de falha parcial.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-105">In distributed systems like microservices-based applications, there is an ever-present risk of partial failure.</span></span> <span data-ttu-id="ac4a3-106">Por exemplo, um único microsserviço/contêiner pode falhar ou pode não estar disponível para responder por um curto período, ou um único servidor ou VM pode falhar.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-106">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="ac4a3-107">Como clientes e serviços são processos separados, um serviço pode não ser capaz de responder de forma oportuna de uma solicitação do cliente.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-107">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client’s request.</span></span> <span data-ttu-id="ac4a3-108">O serviço pode estar sobrecarregadas e respondendo muito lenta para solicitações, ou pode simplesmente não estar acessível por um curto período devido a problemas de rede.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-108">The service might be overloaded and responding extremely slowly to requests, or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="ac4a3-109">Por exemplo, considere a página de detalhes da ordem do eShopOnContainers aplicativo de exemplo.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-109">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="ac4a3-110">Se não estiver respondendo o ordenação microsserviço quando o usuário tentar enviar um pedido, uma implementação incorreta de processo do cliente (o aplicativo da web MVC) — por exemplo, se o código do cliente usar RPCs síncronos sem tempo limite — bloquearia threads indefinidamente aguardando uma resposta.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-110">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="ac4a3-111">Além de criar uma experiência de usuário incorreto, cada espera sem resposta consome ou bloqueia um thread e threads são extremamente importantes em aplicativos altamente escalonáveis.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-111">In addition to creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="ac4a3-112">Se houver muitos threads bloqueados, eventualmente o tempo de execução do aplicativo pode ficar sem threads.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-112">If there are many blocked threads, eventually the application’s runtime can run out of threads.</span></span> <span data-ttu-id="ac4a3-113">Nesse caso, o aplicativo pode se tornar globalmente não responder em vez de apenas parcialmente não responder, como é mostrado na Figura 10-1.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-113">In that case, the application can become globally unresponsive instead of just partially unresponsive, as show in Figure 10-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="ac4a3-114">**Figura 10-1**.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-114">**Figure 10-1**.</span></span> <span data-ttu-id="ac4a3-115">Falhas parciais devido a dependências que afetam a disponibilidade do serviço de thread</span><span class="sxs-lookup"><span data-stu-id="ac4a3-115">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="ac4a3-116">Em um aplicativo grande com base em microservices, todas as falhas parciais podem ser aumentadas, especialmente se a maioria da interação microservices interna é baseado em chamadas HTTP síncronas (o que é considerado um antipadrão).</span><span class="sxs-lookup"><span data-stu-id="ac4a3-116">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="ac4a3-117">Pense em um sistema que recebe milhões de chamadas por dia.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-117">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="ac4a3-118">Se o sistema tiver um design ruim se baseia em longas cadeias de chamadas síncronas de HTTP, essas chamadas de entrada podem resultar em muitos mais milhões de chamadas de saída (vamos supor que uma taxa de 1:4) a dezenas de microservices interno como dependências síncronas.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-118">If your system has a bad design that is based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let’s suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="ac4a3-119">Essa situação é mostrada na Figura 10-2, especialmente dependência \#3.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-119">This situation is shown in Figure 10-2, especially dependency \#3.</span></span>

![](./media/image2.png)

<span data-ttu-id="ac4a3-120">**Figura 10-2**.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-120">**Figure 10-2**.</span></span> <span data-ttu-id="ac4a3-121">O impacto de um design incorreto com longas cadeias de solicitações HTTP</span><span class="sxs-lookup"><span data-stu-id="ac4a3-121">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="ac4a3-122">Falha intermitente é praticamente garantido em distribuído e na nuvem de sistema baseado em, mesmo se cada dependência em si tem excelente disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-122">Intermittent failure is virtually guaranteed in a distributed and cloud based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="ac4a3-123">Isso deve ser um fato que você precisa considerar.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-123">This should be a fact you need to consider.</span></span>

<span data-ttu-id="ac4a3-124">Se você não criar e implementar técnicas para garantir tolerância a falhas, até mesmo pequenos tempos de inatividade podem ser amplificados.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-124">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="ac4a3-125">Por exemplo, 50 dependências cada com 99,99% de disponibilidade pode resultar em várias horas de inatividade por mês devido a esse efeito de ondulação.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-125">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="ac4a3-126">Quando uma dependência de microsserviço Falha ao manipular um alto volume de solicitações, essa falha pode saturar todos os threads de solicitação disponíveis em cada serviço e falhas de todo o aplicativo rapidamente.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-126">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![](./media/image3.png)

<span data-ttu-id="ac4a3-127">**Figura 10-3**.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-127">**Figure 10-3**.</span></span> <span data-ttu-id="ac4a3-128">Falha parcial ampliada por microservices com longas cadeias de chamadas síncronas de HTTP</span><span class="sxs-lookup"><span data-stu-id="ac4a3-128">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="ac4a3-129">Para minimizar esse problema, na seção "*microsserviço assíncrona integração impõe a autonomia do microsserviço*" (no capítulo arquitetura), é recomendável usar a comunicação assíncrona entre interno microservices.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-129">To minimize this problem, in the section "*Asynchronous microservice integration enforce microservice’s autonomy*” (in the architecture chapter), we encouraged you to use asynchronous communication across the internal microservices.</span></span> <span data-ttu-id="ac4a3-130">Brevemente explicamos mais na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-130">We briefly explain more in the next section.</span></span>

<span data-ttu-id="ac4a3-131">Além disso, é essencial que você criar seus aplicativos de cliente e microservices para lidar com falhas parciais — ou seja, para compilar aplicativos microservices resiliente e cliente.</span><span class="sxs-lookup"><span data-stu-id="ac4a3-131">In addition, it is essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="ac4a3-132">[Anterior] (index.md) [Avançar] (strategies.md de falha parcial)</span><span class="sxs-lookup"><span data-stu-id="ac4a3-132">[Previous] (index.md) [Next] (partial-failure-strategies.md)</span></span>
