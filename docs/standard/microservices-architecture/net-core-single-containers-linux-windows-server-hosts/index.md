---
title: "Implantando aplicativos Web .NET Core baseados em um único contêiner em hosts do Linux ou do Windows Nano Server"
description: "Arquitetura de microsserviços do .NET para aplicativos do .NET em contêineres | Implantando aplicativos Web .NET Core baseados em um único contêiner em hosts do Linux ou do Windows Nano Server"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: f85b3db6b4ca6d22c4b855c8b96051c1c31350a6
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/23/2017
---
# <a name="deploying-single-container-based-net-core-web-applications-on-linux-or-windows-nano-server-hosts"></a><span data-ttu-id="0c4f5-104">Implantando aplicativos Web .NET Core baseados em um único contêiner em hosts do Linux ou do Windows Nano Server</span><span class="sxs-lookup"><span data-stu-id="0c4f5-104">Deploying Single-Container-Based .NET Core Web Applications on Linux or Windows Nano Server Hosts</span></span>

<span data-ttu-id="0c4f5-105">*Você pode usar contêineres do Docker para a implantação monolítica de aplicativos Web mais simples. Isso melhora os pipelines de integração contínua e de implantação contínua e ajuda a obter êxito na implantação de produção. Não existe mais "funciona no meu computador, por que não funciona em produção?"*</span><span class="sxs-lookup"><span data-stu-id="0c4f5-105">*You can use Docker containers for monolithic deployment of simpler web applications. This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success. No more “It works in my machine, why does not work in production?”*</span></span>

<span data-ttu-id="0c4f5-106">Uma arquitetura baseada em microsserviços tem muitos benefícios, mas esses benefícios são fornecidos ao custo do aumento da complexidade.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-106">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="0c4f5-107">Em alguns casos, os custos superam os benefícios e você será melhor atendido com um aplicativo de implantação monolítico em execução em um único contêiner ou em poucos contêineres.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-107">In some cases, the costs outweigh the benefits, and you will be better served with a monolithic deployment application running in a single container or in just a few containers.</span></span> 

<span data-ttu-id="0c4f5-108">Um aplicativo monolítico não pode ser facilmente decomposto em microsserviços bem separados.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-108">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="0c4f5-109">Você aprendeu que eles devem ser particionados por função: os microsserviços devem funcionar independentemente uns dos outros para fornecer um aplicativo mais resiliente.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-109">You have learned that these should be partitioned by function: microservices should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="0c4f5-110">Se você não puder entregar fatias de recursos do aplicativo, separá-las apenas gera mais complexidade.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-110">If you cannot deliver feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="0c4f5-111">Talvez o aplicativo ainda não precise dimensionar recursos de modo independente.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-111">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="0c4f5-112">Vamos supor que no início na vida de nosso aplicativo de referência eShopOnContainers, o tráfego não justificava a separação de recursos em diferentes microsserviços.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-112">Let’s suppose that early in the life of our eShopOnContainers reference application, the traffic did not justify separating features into different microservices.</span></span> <span data-ttu-id="0c4f5-113">O tráfego era tão pequeno que a adição de recursos a um serviço normalmente significava adicionar recursos a todos os serviços.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-113">Traffic was small enough that adding resources to one service typically meant adding resources to all services.</span></span> <span data-ttu-id="0c4f5-114">O trabalho adicional para separar o aplicativo em serviços distintos fornecia o mínimo de benefício.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-114">The additional work to separate the application into discrete services provided minimal benefit.</span></span>

<span data-ttu-id="0c4f5-115">Além disso, no início do desenvolvimento de um aplicativo talvez você não tenha uma ideia clara de onde estão os limites funcionais naturais.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-115">Also, early in the development of an application you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="0c4f5-116">Mesmo depois de desenvolve rum produto mínimo viável, a separação natural pode ainda não ter surgido.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-116">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span>

<span data-ttu-id="0c4f5-117">Algumas dessas condições podem ser temporárias.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-117">Some of these conditions might be temporary.</span></span> <span data-ttu-id="0c4f5-118">Você pode começar criando um aplicativo monolítico e posteriormente separar alguns recursos para serem desenvolvidos e implantados como microsserviços.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-118">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="0c4f5-119">Outras condições podem ser essenciais para o espaço do problema do aplicativo, o que significa que o aplicativo pode nunca ser dividido em vários microsserviços.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-119">Other conditions might be essential to the application’s problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="0c4f5-120">A separação de um aplicativo em vários processos distintos também apresenta sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-120">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="0c4f5-121">Há mais complexidade na separação de recursos em diferentes processos.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-121">There is more complexity in separating features into different processes.</span></span> <span data-ttu-id="0c4f5-122">Os protocolos de comunicação tornam-se mais complexos.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-122">The communication protocols become more complex.</span></span> <span data-ttu-id="0c4f5-123">Em vez de chamadas de método, você deve usar a comunicação assíncrona entre serviços.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-123">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="0c4f5-124">Ao passar para uma arquitetura de microsserviços, você precisa adicionar muitos dos blocos de construção implementados na versão de microsserviços do aplicativo eShopOnContainers: manipulação de barramento de eventos, resiliência e novas tentativas de mensagem, consistência eventual e muito mais.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-124">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the eShopOnContainers application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="0c4f5-125">Uma versão muito mais simplificada do eShopOnContainers (chamado [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) e incluído no mesmo repositório GitHub) é executada como um aplicativo MVC monolítico e, conforme foi descrito, há vantagens oferecidas por essa escolha de design.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-125">A much-simplified version of eShopOnContainers (named [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) and included in the same GitHub repo) runs as a monolithic MVC application, and as just described, there are advantages offered by that design choice.</span></span> <span data-ttu-id="0c4f5-126">Você pode baixar o código-fonte desse aplicativo do GitHub e executá-lo localmente.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-126">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="0c4f5-127">Até mesmo esse aplicativo monolítico beneficia-se de ser implantado em um ambiente do contêiner.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-127">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="0c4f5-128">Por exemplo, a implantação em contêineres significa que cada instância do aplicativo é executada no mesmo ambiente.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-128">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="0c4f5-129">Isso inclui o ambiente de desenvolvedor no qual os testes e o desenvolvimento iniciais ocorrem.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-129">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="0c4f5-130">A equipe de desenvolvimento pode executar o aplicativo em um ambiente em contêineres que corresponda ao ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-130">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="0c4f5-131">Além disso, os aplicativos em contêineres são aumentados com um custo menor.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-131">In addition, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="0c4f5-132">Como você viu anteriormente, o ambiente de contêiner permite um compartilhamento maior de recursos do que os ambientes de VM tradicionais.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-132">As you saw earlier, the container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="0c4f5-133">Por fim, colocar o aplicativo em contêineres força uma separação entre a lógica de negócios e o servidor de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-133">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="0c4f5-134">À medida que o aplicativo for escalado horizontalmente, os vários contêineres dependerão de uma única mídia de armazenamento físico.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-134">As the application scales out, the multiple containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="0c4f5-135">Geralmente, esse seria um servidor de alta disponibilidade que executa um banco de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-135">This would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="application-tour"></a><span data-ttu-id="0c4f5-136">Tour do aplicativo</span><span class="sxs-lookup"><span data-stu-id="0c4f5-136">Application tour</span></span>

<span data-ttu-id="0c4f5-137">O aplicativo [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) representa uma parte do aplicativo eShopOnContainers em execução como um aplicativo monolítico, um aplicativo baseado no ASP.NET Core MVC em execução no .NET Core.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-137">The [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) application represents some of the eShopOnContainers application running as a monolithic application—an ASP.NET Core MVC based application running on .NET Core.</span></span> <span data-ttu-id="0c4f5-138">Ele fornece principalmente os recursos de pesquisa no catálogo que foram descritos nas seções anteriores.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-138">It mainly provides the catalog browsing capabilities that we described in earlier sections.</span></span>

<span data-ttu-id="0c4f5-139">O aplicativo usa um banco de dados do SQL Server para o armazenamento de catálogo.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-139">The application uses a SQL Server database for the catalog storage.</span></span> <span data-ttu-id="0c4f5-140">Em implantações com base em contêiner, este aplicativo monolítico pode acessar o mesmo armazenamento de dados que o aplicativo baseado em microsserviços.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-140">In container-based deployments, this monolithic application can access the same data store as the microservices-based application.</span></span> <span data-ttu-id="0c4f5-141">O aplicativo é configurado para executar o SQL Server em um contêiner ao lado do aplicativo monolítico.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-141">The application is configured to run SQL Server in a container alongside the monolithic application.</span></span> <span data-ttu-id="0c4f5-142">Em um ambiente de produção, o SQL Server seria executado em um computador de alta disponibilidade, fora do host do Docker.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-142">In a production environment, SQL Server would run on a high-availability machine, outside of the Docker host.</span></span> <span data-ttu-id="0c4f5-143">Por motivo de conveniência em um ambiente de desenvolvimento ou de teste, é recomendável executar o SQL Server em seu próprio contêiner.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-143">For convenience in a dev or test environment, we recommend running SQL Server in its own container.</span></span>

<span data-ttu-id="0c4f5-144">O conjunto inicial de recursos apenas habilita a pesquisa no catálogo.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-144">The initial feature set only enables browsing the catalog.</span></span> <span data-ttu-id="0c4f5-145">As atualizações habilitarão o conjunto completo de recursos do aplicativo em contêiner.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-145">Updates would enable the full feature set of the containerized application.</span></span> <span data-ttu-id="0c4f5-146">Uma arquitetura de aplicativo Web monolítico mais avançada é descrita no livro eletrônico [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) (Práticas de arquitetura de aplicativos Web ASP.NET) e no [aplicativo de exemplo eShopOnWeb](http://aka.ms/WebAppArchitecture) relacionado, embora nesse caso ele não esteja em execução em contêineres do Docker porque esse cenário se concentra no desenvolvimento da Web simples com o ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-146">A more advanced monolithic web application architecture is described in the [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) e-book and related [eShopOnWeb sample application](http://aka.ms/WebAppArchitecture), although in that case it is not running on Docker containers because that scenario focuses on plain web development with ASP.NET Core.</span></span>

<span data-ttu-id="0c4f5-147">No entanto, a versão simplificada disponível em eShopOnContainers (eShopWeb) é executado em um contêiner do Docker.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-147">However, the simplified version available in eShopOnContainers (eShopWeb) runs in a Docker container.</span></span>

## <a name="docker-support"></a><span data-ttu-id="0c4f5-148">Suporte ao Docker</span><span class="sxs-lookup"><span data-stu-id="0c4f5-148">Docker support</span></span>

<span data-ttu-id="0c4f5-149">O projeto eShopOnWeb é executado no .NET Core.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-149">The eShopOnWeb project runs on .NET Core.</span></span> <span data-ttu-id="0c4f5-150">Portanto, ele pode ser executado em contêineres baseados em Linux ou em Windows.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-150">Therefore, it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="0c4f5-151">Observe que, para a implantação do Docker, você deseja usar o mesmo tipo de host para o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-151">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="0c4f5-152">Os contêineres baseados em Linux permitem o uso de um espaço menor e são preferenciais.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-152">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="0c4f5-153">O Visual Studio fornece um modelo de projeto que adiciona o suporte ao Docker em uma solução.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-153">Visual Studio provides a project template that adds support for Docker to a solution.</span></span> <span data-ttu-id="0c4f5-154">Clique com o botão direito do mouse no projeto, clique em **Adicionar** e, em seguida, em **Suporte ao Docker**.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-154">You right-click the project, click **Add** followed by **Docker Support**.</span></span> <span data-ttu-id="0c4f5-155">O modelo adiciona um Dockerfile ao seu projeto e um novo projeto **docker-compose** que fornece um arquivo inicial docker-compose.yml.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-155">The template adds a Dockerfile to your project, and a new **docker-compose** project that provides a starter docker-compose.yml file.</span></span> <span data-ttu-id="0c4f5-156">Esta etapa já foi feita no projeto eShopOnWeb baixado do GitHub.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-156">This step has already been done in the eShopOnWeb project downloaded from GitHub.</span></span> <span data-ttu-id="0c4f5-157">Você verá que a solução contém o projeto **eShopOnWeb** e o projeto **docker-compose** conforme é mostrado na Figura 6-1.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-157">You will see that the solution contains the **eShopOnWeb** project and the **docker-compose** project as shown in Figure 6-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="0c4f5-158">**Figura 6-1**.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-158">**Figure 6-1**.</span></span> <span data-ttu-id="0c4f5-159">O projeto **docker-compose** em um aplicativo Web de contêiner único</span><span class="sxs-lookup"><span data-stu-id="0c4f5-159">The **docker-compose** project in a single-container web application</span></span>

<span data-ttu-id="0c4f5-160">Esses são arquivos docker-compose padrão, consistentes com qualquer projeto do Docker.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-160">These files are standard docker-compose files, consistent with any Docker project.</span></span> <span data-ttu-id="0c4f5-161">Você pode usá-los com o Visual Studio ou por meio da linha de comando.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-161">You can use them with Visual Studio or from the command line.</span></span> <span data-ttu-id="0c4f5-162">Este aplicativo é executado no .NET Core e usa contêineres do Linux, portanto, também é possível codificar, compilar e executar em um computador Mac ou Linux.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-162">This application runs on .NET Core and uses Linux containers, so you can also code, build, and run on a Mac or on a Linux machine.</span></span>

<span data-ttu-id="0c4f5-163">O arquivo docker-compose.yml contém informações de quais imagens devem ser compiladas e quais contêineres devem ser iniciados.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-163">The docker-compose.yml file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="0c4f5-164">Os modelos especificam como compilar a imagem eshopweb e iniciar os contêineres do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-164">The templates specify how to build the eshopweb image and launch the application’s containers.</span></span> <span data-ttu-id="0c4f5-165">Você precisa adicionar a dependência do SQL Server, incluindo uma imagem para ele (por exemplo, mssql-server-linux) e um serviço para a imagem sql.data para que o Docker crie e inicie esse contêiner.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-165">You need to add the dependency on SQL Server by including an image for it (for example, mssql-server-linux), and a service for the sql.data image for Docker to build and launch that container.</span></span> <span data-ttu-id="0c4f5-166">Essas configurações são mostradas no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="0c4f5-166">These settings are shown in the following example:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web
    build:
    context: ./eShopWeb
    dockerfile: Dockerfile
    depends_on:
      - sql.data

  sql.data:
    image: microsoft/mssql-server-linux
```

<span data-ttu-id="0c4f5-167">A diretiva depends\_on mostra ao Docker que a imagem eShopWeb depende da imagem sql.data.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-167">The depends\_on directive tells Docker that the eShopWeb image depends on the sql.data image.</span></span> <span data-ttu-id="0c4f5-168">As linhas abaixo disso são instruções para compilar uma imagem marcada com sql.data usando a imagem microsoft/mssql-server-linux.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-168">Lines below that are the instructions to build an image tagged sql.data using the microsoft/mssql-server-linux image.</span></span>

<span data-ttu-id="0c4f5-169">O projeto **docker-compose** exibe os outros arquivos docker-compose sob o nó docker-compose.yml principal para fornecer uma indicação visual de que esses arquivos estão relacionados.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-169">The **docker-compose** project displays the other docker-compose files under the main docker-compose.yml node to provide a visual indication that these files are related.</span></span> <span data-ttu-id="0c4f5-170">O arquivo docker-compose-override.yml contém configurações para os dois serviços, como cadeias de conexão e outras configurações de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-170">The docker-compose-override.yml file contains settings for both services, such as connection strings and other application settings.</span></span>

<span data-ttu-id="0c4f5-171">O exemplo a seguir mostra o arquivo docker-compose.vs.debug.yml, que contém as configurações usadas para depuração no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-171">The following example shows the docker-compose.vs.debug.yml file, which contains settings used for debugging in Visual Studio.</span></span> <span data-ttu-id="0c4f5-172">Nesse arquivo, a imagem eshopweb tem a marca dev anexada.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-172">In that file, the eshopweb image has the dev tag appended to it.</span></span> <span data-ttu-id="0c4f5-173">Isso ajuda a separar a depuração das imagens de versão para que você não implante acidentalmente as informações de depuração em um ambiente de produção:</span><span class="sxs-lookup"><span data-stu-id="0c4f5-173">That helps separate debug from release images so that you do not accidentally deploy the debug information to a production environment:</span></span>

```yml
version: '2'
  
services:
  eshopweb:
    image: eshop/web:dev
    build:
    args:
    source: ${DOCKER_BUILD_SOURCE}
    environment:
      - DOTNET_USE_POLLING_FILE_WATCHER=1
    volumes:
      - ./eShopWeb:/app
      - ~/.nuget/packages:/root/.nuget/packages:ro
      - ~/clrdbg:/clrdbg:ro
    entrypoint: tail -f /dev/null
    labels:
      - "com.microsoft.visualstudio.targetoperatingsystem=linux"
```

<span data-ttu-id="0c4f5-174">O último arquivo adicionado é o docker-compose.ci.build.yml.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-174">The last file added is docker-compose.ci.build.yml.</span></span> <span data-ttu-id="0c4f5-175">Ele seria usado na linha de comando para compilar o projeto de um servidor de CI.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-175">This would be used from the command line to build the project from a CI server.</span></span> <span data-ttu-id="0c4f5-176">Esse arquivo compose inicia um contêiner do Docker que compilar as imagens necessárias para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-176">This compose file starts a Docker container that builds the images needed for your application.</span></span> <span data-ttu-id="0c4f5-177">O exemplo a seguir mostra o conteúdo do arquivo docker-compose.ci.build.yml.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-177">The following example shows the contents of the docker-compose.ci.build.yml file.</span></span>

```yml
version: '2'
  
services:
  ci-build:
    image: microsoft/aspnetcore-build:latest
    volumes:
      - .:/src
    working_dir: /src
  command: /bin/bash -c "dotnet restore ./eShopWeb.sln && dotnet publish  ./eShopWeb.sln -c Release -o ./obj/Docker/publish"
```

<span data-ttu-id="0c4f5-178">**Observação**: a partir do .NET Core 2.0, o comando de restauração dotnet executa automaticamente quando a publicação dotnet é executada.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-178">**Note**: Starting with .NET Core 2.0, the dotnet restore command executes automatically when dotnet publish is executed.</span></span>

<span data-ttu-id="0c4f5-179">Observe que a imagem é uma imagem de build do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-179">Notice that the image is an ASP.NET Core build image.</span></span> <span data-ttu-id="0c4f5-180">Essa imagem inclui as ferramentas do SDK e de build para compilar seu aplicativo e criar as imagens necessárias.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-180">That image includes the SDK and build tools to build your application and create the required images.</span></span> <span data-ttu-id="0c4f5-181">Executar o projeto **docker-compose** usando este arquivo inicia o contêiner de build da imagem, em seguida, compila a imagem do aplicativo nesse contêiner.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-181">Running the **docker-compose** project using this file starts the build container from the image, then builds your application’s image in that container.</span></span> <span data-ttu-id="0c4f5-182">É possível especificar esse arquivo docker-compose como parte da linha de comando para criar o aplicativo em um contêiner do Docker e, em seguida, o iniciar.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-182">You specify that docker-compose file as part of the command line to build your application in a Docker container, then launch it.</span></span>

<span data-ttu-id="0c4f5-183">No Visual Studio, você pode executar seu aplicativo em contêineres do Docker, selecionando o projeto **docker-compose** como o projeto de inicialização e, em seguida, pressionando Ctrl + F5 (F5 para depurar), como faria com qualquer outro aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-183">In Visual Studio, you can run your application in Docker containers by selecting the **docker-compose** project as the startup project, and then pressing Ctrl+F5 (F5 to debug), as you can with any other application.</span></span> <span data-ttu-id="0c4f5-184">Quando você inicia o projeto **docker-compose**, o Visual Studio executa o **docker-compose** usando o arquivo docker-compose.yml, o arquivo docker-compose.override.yml e um dos arquivos docker-compose.vs\*.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-184">When you start the **docker-compose** project, Visual Studio runs **docker-compose** using the docker-compose.yml file, the docker-compose.override.yml file, and one of the docker-compose.vs.\* files.</span></span> <span data-ttu-id="0c4f5-185">Depois que o aplicativo é iniciado, o Visual Studio inicia o navegador.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-185">Once the application has started, Visual Studio launches the browser for you.</span></span>

<span data-ttu-id="0c4f5-186">Se você iniciar o aplicativo no depurador, o Visual Studio será anexado ao aplicativo em execução no Docker.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-186">If you launch the application in the debugger, Visual Studio will attach to the running application in Docker.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="0c4f5-187">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="0c4f5-187">Troubleshooting</span></span>

<span data-ttu-id="0c4f5-188">Esta seção descreve alguns problemas que podem surgir ao executar contêineres localmente e sugere algumas correções.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-188">This section describes a few issues that might arise when your run containers locally and suggests some fixes.</span></span>

### <a name="stopping-docker-containers"></a><span data-ttu-id="0c4f5-189">Interrompendo contêineres do Docker</span><span class="sxs-lookup"><span data-stu-id="0c4f5-189">Stopping Docker containers</span></span> 

<span data-ttu-id="0c4f5-190">Depois que você inicia o aplicativo em contêineres, os contêineres continuam em execução, mesmo depois de interromper a depuração.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-190">After you launch the containerized application, the containers continue to run, even after you have stopped debugging.</span></span> <span data-ttu-id="0c4f5-191">Você pode executar o comando docker ps na linha de comando para ver quais contêineres estão em execução.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-191">You can run the docker ps command from the command line to see which containers are running.</span></span> <span data-ttu-id="0c4f5-192">O comando docker stop interrompe um contêiner em execução, conforme é mostrado na Figura 6-2.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-192">The docker stop command stops a running container, as shown in Figure 6-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="0c4f5-193">**Figura 6-2**.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-193">**Figure 6-2**.</span></span> <span data-ttu-id="0c4f5-194">Listando e interrompendo contêineres com os comandos da CLI docker ps e docker stop</span><span class="sxs-lookup"><span data-stu-id="0c4f5-194">Listing and stopping containers with the docker ps and docker stop CLI commands</span></span>

<span data-ttu-id="0c4f5-195">Talvez seja necessário interromper os processos em execução ao alternar entre diferentes configurações.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-195">You might need to stop running processes when you switch between different configurations.</span></span> <span data-ttu-id="0c4f5-196">Caso contrário, o contêiner que está executando o aplicativo Web usará a porta do aplicativo (5106 neste exemplo).</span><span class="sxs-lookup"><span data-stu-id="0c4f5-196">Otherwise, the container that is running the web application is using the port for your application (5106 in this example).</span></span>

### <a name="adding-docker-to-your-projects"></a><span data-ttu-id="0c4f5-197">Adicionando o Docker aos seus projetos</span><span class="sxs-lookup"><span data-stu-id="0c4f5-197">Adding Docker to your projects</span></span>

<span data-ttu-id="0c4f5-198">O assistente que adiciona o suporte ao Docker se comunica com o processo do Docker em execução.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-198">The wizard that adds Docker support communicates with the running Docker process.</span></span> <span data-ttu-id="0c4f5-199">O assistente não será executado corretamente se o Docker não estiver em execução quando você iniciar o assistente.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-199">The wizard will not run correctly if Docker is not running when you start the wizard.</span></span> <span data-ttu-id="0c4f5-200">Além disso, o assistente examinará sua escolha de contêiner atual para adicionar o suporte ao Docker correto.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-200">In addition, the wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="0c4f5-201">Se você desejar adicionar suporte para contêineres do Windows, será necessário executar o assistente enquanto o Docker estiver em execução com contêineres do Windows configurados.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-201">If you want to add support for Windows Containers, you need to run the wizard while you have Docker running with Windows Containers configured.</span></span> <span data-ttu-id="0c4f5-202">Se você desejar adicionar suporte para contêineres do Linux, será necessário executar o assistente enquanto o Docker estiver em execução com contêineres do Linux configurados.</span><span class="sxs-lookup"><span data-stu-id="0c4f5-202">If you want to add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="0c4f5-203">[Previous] (../docker-application-development-process/docker-app-development-workflow.md) [Next] (../containerize-net-framework-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="0c4f5-203">[Previous] (../docker-application-development-process/docker-app-development-workflow.md) [Next] (../containerize-net-framework-applications/index.md)</span></span>
