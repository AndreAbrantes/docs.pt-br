---
title: "Criando, desenvolvendo e controle de versão de microsserviço APIs e contratos"
description: "Arquitetura de Microservices .NET para aplicativos .NET em contêineres | Criando, desenvolvendo e controle de versão de microsserviço APIs e contratos"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 433711c3479eafd52bf9f5d53faf8e5707c6c624
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/22/2017
---
# <a name="creating-evolving-and-versioning-microservice-apis-and-contracts"></a><span data-ttu-id="cdc59-104">Criando, desenvolvendo e controle de versão de microsserviço APIs e contratos</span><span class="sxs-lookup"><span data-stu-id="cdc59-104">Creating, evolving, and versioning microservice APIs and contracts</span></span>

<span data-ttu-id="cdc59-105">Um API de microsserviço é um contrato entre o serviço e seus clientes.</span><span class="sxs-lookup"><span data-stu-id="cdc59-105">A microservice API is a contract between the service and its clients.</span></span> <span data-ttu-id="cdc59-106">Você poderá desenvolver um microsserviço independentemente somente se você não interromper seu contrato de API, o motivo pelo qual o contrato é tão importante.</span><span class="sxs-lookup"><span data-stu-id="cdc59-106">You will be able to evolve a microservice independently only if you do not break its API contract, which is why the contract is so important.</span></span> <span data-ttu-id="cdc59-107">Se você alterar o contrato, isso afetará os aplicativos cliente ou seu Gateway de API.</span><span class="sxs-lookup"><span data-stu-id="cdc59-107">If you change the contract, it will impact your client applications or your API Gateway.</span></span>

<span data-ttu-id="cdc59-108">A natureza da definição de API depende no protocolo que você está usando.</span><span class="sxs-lookup"><span data-stu-id="cdc59-108">The nature of the API definition depends on which protocol you are using.</span></span> <span data-ttu-id="cdc59-109">Por exemplo, se você estiver usando o sistema de mensagens (como [AMQP](https://www.amqp.org/)), a API consiste em tipos de mensagem.</span><span class="sxs-lookup"><span data-stu-id="cdc59-109">For instance, if you are using messaging (like [AMQP](https://www.amqp.org/)), the API consists of the message types.</span></span> <span data-ttu-id="cdc59-110">Se você estiver usando HTTP e os serviços RESTful, a API consiste as URLs e os formatos de solicitação e resposta JSON.</span><span class="sxs-lookup"><span data-stu-id="cdc59-110">If you are using HTTP and RESTful services, the API consists of the URLs and the request and response JSON formats.</span></span>

<span data-ttu-id="cdc59-111">No entanto, mesmo se você estiver certo sobre o contrato inicial, uma API de serviço precisará alterar ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="cdc59-111">However, even if you are thoughtful about your initial contract, a service API will need to change over time.</span></span> <span data-ttu-id="cdc59-112">Quando isso acontece, e especialmente se a sua API é uma API pública consumida por vários aplicativos cliente — normalmente não pode forçar todos os clientes devem atualizar para o novo contrato de API.</span><span class="sxs-lookup"><span data-stu-id="cdc59-112">When that happens—and especially if your API is a public API consumed by multiple client applications—you typically cannot force all clients to upgrade to your new API contract.</span></span> <span data-ttu-id="cdc59-113">Normalmente, você precisa implantar novas versões de um serviço de forma que as versões antigas e novas de um contrato de serviço são executados simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="cdc59-113">You usually need to incrementally deploy new versions of a service in a way that both old and new versions of a service contract are running simultaneously.</span></span> <span data-ttu-id="cdc59-114">Portanto, é importante ter uma estratégia para o controle de versão do serviço.</span><span class="sxs-lookup"><span data-stu-id="cdc59-114">Therefore, it is important to have a strategy for your service versioning.</span></span>

<span data-ttu-id="cdc59-115">Quando as alterações de API são pequenas, como se você adicionar atributos ou parâmetros para sua API, os clientes que usam uma API mais antiga devem alternar e trabalhar com a nova versão do serviço.</span><span class="sxs-lookup"><span data-stu-id="cdc59-115">When the API changes are small, like if you add attributes or parameters to your API, clients that use an older API should switch and work with the new version of the service.</span></span> <span data-ttu-id="cdc59-116">Você poderá fornecer valores padrão para todos os atributos ausentes que são necessários e os clientes poderá ignorar os atributos de resposta extra.</span><span class="sxs-lookup"><span data-stu-id="cdc59-116">You might be able to provide default values for any missing attributes that are required, and the clients might be able to ignore any extra response attributes.</span></span>

<span data-ttu-id="cdc59-117">No entanto, às vezes você precisa fazer alterações principais e incompatíveis para uma API de serviço.</span><span class="sxs-lookup"><span data-stu-id="cdc59-117">However, sometimes you need to make major and incompatible changes to a service API.</span></span> <span data-ttu-id="cdc59-118">Porque você não poderá forçar a aplicativos cliente ou serviços para atualizar imediatamente para a nova versão, um serviço deve dar suporte a versões mais antigas da API para um determinado período.</span><span class="sxs-lookup"><span data-stu-id="cdc59-118">Because you might not be able to force client applications or services to upgrade immediately to the new version, a service must support older versions of the API for some period.</span></span> <span data-ttu-id="cdc59-119">Se você estiver usando um mecanismo baseado em HTTP, como REST, uma abordagem é inserir o número de versão de API na URL ou em um cabeçalho HTTP.</span><span class="sxs-lookup"><span data-stu-id="cdc59-119">If you are using an HTTP-based mechanism such as REST, one approach is to embed the API version number in the URL or into a HTTP header.</span></span> <span data-ttu-id="cdc59-120">Em seguida, você pode decidir entre implementar ambas as versões do serviço simultaneamente na mesma instância do serviço, ou implantar instâncias diferentes que cada lidar com uma versão da API.</span><span class="sxs-lookup"><span data-stu-id="cdc59-120">Then you can decide between implementing both versions of the service simultaneously within the same service instance, or deploying different instances that each handle a version of the API.</span></span> <span data-ttu-id="cdc59-121">Uma boa abordagem para isso é o [padrão mediador](https://en.wikipedia.org/wiki/Mediator_pattern) (por exemplo, [MediatR biblioteca](https://github.com/jbogard/MediatR)) para separar as versões diferentes de implementação em manipuladores independentes.</span><span class="sxs-lookup"><span data-stu-id="cdc59-121">A good approach for this is the [Mediator pattern](https://en.wikipedia.org/wiki/Mediator_pattern) (for example, [MediatR library](https://github.com/jbogard/MediatR)) to decouple the different implementation versions into independent handlers.</span></span>

<span data-ttu-id="cdc59-122">Por fim, se você estiver usando uma arquitetura REST, [hipermídia](https://www.infoq.com/articles/mark-baker-hypermedia) é a melhor solução para controle de versão de seus serviços e permitindo auxiliando APIs.</span><span class="sxs-lookup"><span data-stu-id="cdc59-122">Finally, if you are using a REST architecture, [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) is the best solution for versioning your services and allowing evolvable APIs.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="cdc59-123">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="cdc59-123">Additional resources</span></span>

-   <span data-ttu-id="cdc59-124">**Scott Hanselman. Controle de versão do núcleo da API da Web RESTful ASP.NET facilitado**
    <http://www.hanselman.com/blog/ASPNETCoreRESTfulWebAPIVersioningMadeEasy.aspx></span><span class="sxs-lookup"><span data-stu-id="cdc59-124">**Scott Hanselman. ASP.NET Core RESTful Web API versioning made easy**
<http://www.hanselman.com/blog/ASPNETCoreRESTfulWebAPIVersioningMadeEasy.aspx></span></span>

-   <span data-ttu-id="cdc59-125">**Controle de versão de uma API da web RESTful**
    [*https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api*](https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api)</span><span class="sxs-lookup"><span data-stu-id="cdc59-125">**Versioning a RESTful web API**
[*https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api*](https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api)</span></span>

-   <span data-ttu-id="cdc59-126">**Roy Fielding. Controle de versão, hipermídia e REST**
    <https://www.infoq.com/articles/roy-fielding-on-versioning></span><span class="sxs-lookup"><span data-stu-id="cdc59-126">**Roy Fielding. Versioning, Hypermedia, and REST**
<https://www.infoq.com/articles/roy-fielding-on-versioning></span></span>


>[!div class="step-by-step"]
<span data-ttu-id="cdc59-127">[Anterior] (assíncrona-mensagem-com base-communication.md) [Avançar] (microservices-Endereçabilidade-serviço-registry.md)</span><span class="sxs-lookup"><span data-stu-id="cdc59-127">[Previous] (asynchronous-message-based-communication.md) [Next] (microservices-addressability-service-registry.md)</span></span>
