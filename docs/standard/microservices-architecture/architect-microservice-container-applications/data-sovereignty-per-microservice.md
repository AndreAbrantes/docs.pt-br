---
title: Soberania de dados por microsserviço
description: Arquitetura de microsserviços do .NET para aplicativos .NET em contêineres | Soberania de dados por microsserviço
keywords: Docker, Microsserviços, ASP.NET, Contêiner
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: f5d782a70123a66c1579a64a37bc612ccda9c1a4
ms.sourcegitcommit: 2e8acae16ae802f2d6d04e3ce0a6dbf04e476513
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/18/2018
---
# <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="4969e-104">Soberania de dados por microsserviço</span><span class="sxs-lookup"><span data-stu-id="4969e-104">Data sovereignty per microservice</span></span>

<span data-ttu-id="4969e-105">Uma regra importante para a arquitetura de microsserviços é que cada um deles precisa ter dados e lógica de domínio.</span><span class="sxs-lookup"><span data-stu-id="4969e-105">An important rule for microservices architecture is that each microservice must own its domain data and logic.</span></span> <span data-ttu-id="4969e-106">Assim como um aplicativo completo tem sua própria lógica e dados, cada microsserviço precisa tê-los em um ciclo de vida autônomo, com implantação independente por microsserviço.</span><span class="sxs-lookup"><span data-stu-id="4969e-106">Just as a full application owns its logic and data, so must each microservice own its logic and data under an autonomous lifecycle, with independent deployment per microservice.</span></span>

<span data-ttu-id="4969e-107">Isso significa que o modelo conceitual do domínio será diferente entre subsistemas ou microsserviços.</span><span class="sxs-lookup"><span data-stu-id="4969e-107">This means that the conceptual model of the domain will differ between subsystems or microservices.</span></span> <span data-ttu-id="4969e-108">Imagine aplicativos empresariais, em que os aplicativos de gerenciamento de relacionamento com o cliente (CRM), subsistemas de compras transacionais e subsistemas de suporte ao cliente exigem atributos e dados únicos de entidade do cliente e aplicam um contexto delimitado diferente.</span><span class="sxs-lookup"><span data-stu-id="4969e-108">Consider enterprise applications, where customer relationship management (CRM) applications, transactional purchase subsystems, and customer support subsystems each call on unique customer entity attributes and data, and where each employs a different Bounded Context (BC).</span></span>

<span data-ttu-id="4969e-109">Esse princípio é semelhante no [DDD (design controlado por domínio)](https://en.wikipedia.org/wiki/Domain-driven_design), em que cada [Contexto Delimitado](https://martinfowler.com/bliki/BoundedContext.html) ou subsistema autônomo ou serviço precisa ter seu próprio modelo de domínio (dados, lógica e comportamento).</span><span class="sxs-lookup"><span data-stu-id="4969e-109">This principle is similar in [Domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), where each [Bounded Context](https://martinfowler.com/bliki/BoundedContext.html) or autonomous subsystem or service must own its domain model (data plus logic and behavior).</span></span> <span data-ttu-id="4969e-110">Cada Contexto Delimitado por DDD se correlaciona a um microsserviço de negócios (um ou vários serviços).</span><span class="sxs-lookup"><span data-stu-id="4969e-110">Each DDD Bounded Context correlates to one business microservice (one or several services).</span></span> <span data-ttu-id="4969e-111">O padrão do Contexto Delimitado é aprofundado na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="4969e-111">(We expand on this point about the Bounded Context pattern in the next section.)</span></span>

<span data-ttu-id="4969e-112">Por outro lado, a abordagem tradicional (dados monolíticos) usada em diversos aplicativos é ter um banco de dados único centralizado ou poucos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="4969e-112">On the other hand, the traditional (monolithic data) approach used in many applications is to have a single centralized database or just a few databases.</span></span> <span data-ttu-id="4969e-113">Geralmente, trata-se de um Banco de Dados SQL normalizado utilizado para o aplicativo inteiro e todos seus subsistemas internos, conforme mostrado na Figura 4-7.</span><span class="sxs-lookup"><span data-stu-id="4969e-113">This is often a normalized SQL database that is used for the whole application and all its internal subsystems, as shown in Figure 4-7.</span></span>

![](./media/image7.png)

<span data-ttu-id="4969e-114">**Figura 4-7**.</span><span class="sxs-lookup"><span data-stu-id="4969e-114">**Figure 4-7**.</span></span> <span data-ttu-id="4969e-115">Comparação de soberania de dados: banco de dados monolítico x microsserviços</span><span class="sxs-lookup"><span data-stu-id="4969e-115">Data sovereignty comparison: monolithic database versus microservices</span></span>

<span data-ttu-id="4969e-116">A abordagem de banco de dados centralizado aparenta ser mais simples inicialmente e parece permitir a reutilização de entidades em subsistemas diferentes para tornar tudo consistente.</span><span class="sxs-lookup"><span data-stu-id="4969e-116">The centralized database approach initially looks simpler and seems to enable reuse of entities in different subsystems to make everything consistent.</span></span> <span data-ttu-id="4969e-117">Mas a realidade é que você acaba com uma quantidade enorme de tabelas que servem para muitos subsistemas diferentes e incluem atributos e colunas que não são necessárias na maioria dos casos.</span><span class="sxs-lookup"><span data-stu-id="4969e-117">But the reality is you end up with huge tables that serve many different subsystems, and that include attributes and columns that are not needed in most cases.</span></span> <span data-ttu-id="4969e-118">É como tentar usar o mesmo mapa físico para uma caminhada em uma trilha pequena, uma viagem de carro de um dia e para aprender geografia.</span><span class="sxs-lookup"><span data-stu-id="4969e-118">it is like trying to use the same physical map for hiking a short trail, taking a day-long car trip, and learning geography.</span></span>

<span data-ttu-id="4969e-119">Um aplicativo monolítico com um banco de dados relacional único conta com duas vantagens: [transações ACID](https://en.wikipedia.org/wiki/ACID) e a linguagem SQL, ambas em funcionamento em todas as tabelas e dados relacionados ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4969e-119">A monolithic application with typically a single relational database has two important benefits: [ACID transactions](https://en.wikipedia.org/wiki/ACID) and the SQL language, both working across all the tables and data related to your application.</span></span> <span data-ttu-id="4969e-120">Essa abordagem é uma maneira fácil de gravar consultas que combinam dados de diversas tabelas.</span><span class="sxs-lookup"><span data-stu-id="4969e-120">This approach provides a way to easily write a query that combines data from multiple tables.</span></span>

<span data-ttu-id="4969e-121">No entanto, o acesso a dados se torna muito mais complexo ao migrar para uma arquitetura de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="4969e-121">However, data access becomes much more complex when you move to a microservices architecture.</span></span> <span data-ttu-id="4969e-122">Porém, mesmo quando as transações ACID podem ou devem ser usadas no âmbito de um microsserviço ou Contexto Delimitado, os dados de propriedade de cada microsserviço são privados e só podem ser acessados por meio de suas APIs.</span><span class="sxs-lookup"><span data-stu-id="4969e-122">But even when ACID transactions can or should be used within a microservice or Bounded Context, the data owned by each microservice is private to that microservice and can only be accessed via its microservice API.</span></span> <span data-ttu-id="4969e-123">Encapsular os dados garante que os microsserviços sejam acoplados de forma flexível e evoluam de modo independente.</span><span class="sxs-lookup"><span data-stu-id="4969e-123">Encapsulating the data ensures that the microservices are loosely coupled and can evolve independently of one another.</span></span> <span data-ttu-id="4969e-124">Se vários serviços acessarem os mesmos dados, as atualizações de esquema exigirão atualizações coordenadas de todos os serviços.</span><span class="sxs-lookup"><span data-stu-id="4969e-124">If multiple services were accessing the same data, schema updates would require coordinated updates to all the services.</span></span> <span data-ttu-id="4969e-125">Isso interrompe a autonomia do ciclo de vida do microsserviço.</span><span class="sxs-lookup"><span data-stu-id="4969e-125">This would break the microservice lifecycle autonomy.</span></span> <span data-ttu-id="4969e-126">Entretanto, as estruturas de dados distribuídos impedem você de realizar transações ACID nos microsserviços.</span><span class="sxs-lookup"><span data-stu-id="4969e-126">But distributed data structures mean that you cannot make a single ACID transaction across microservices.</span></span> <span data-ttu-id="4969e-127">Por sua vez, isso significa que é necessário utilizar consistência eventual quando um processo de negócios abrange vários microsserviços.</span><span class="sxs-lookup"><span data-stu-id="4969e-127">This in turn means you must use eventual consistency when a business process spans multiple microservices.</span></span> <span data-ttu-id="4969e-128">Isso é muito mais difícil de implementar do que uma simples união SQL. Da mesma forma, vários outros recursos de banco de dados relacional não estão disponíveis em diversos microsserviços.</span><span class="sxs-lookup"><span data-stu-id="4969e-128">This is much harder to implement than simple SQL joins; similarly, many other relational database features are not available across multiple microservices.</span></span>

<span data-ttu-id="4969e-129">Além disso, microsserviços diferentes geralmente usam *tipos* diferentes de bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="4969e-129">Going even further, different microservices often use different *kinds* of databases.</span></span> <span data-ttu-id="4969e-130">Aplicativos modernos armazenam e processam tipos de dados diversificados, e um banco de dados relacional nem sempre é a melhor opção.</span><span class="sxs-lookup"><span data-stu-id="4969e-130">Modern applications store and process diverse kinds of data, and a relational database is not always the best choice.</span></span> <span data-ttu-id="4969e-131">Em alguns casos de uso, um banco de dados NoSQL como o Azure DocumentDB ou o MongoDB podem ter um modelo de dados mais conveniente e oferecer desempenho e escalabilidade melhores que um banco de dados SQL como o SQL Server ou o Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="4969e-131">For some use cases, a NoSQL database such as Azure DocumentDB or MongoDB might have a more convenient data model and offer better performance and scalability than a SQL database like SQL Server or Azure SQL Database.</span></span> <span data-ttu-id="4969e-132">Em outros casos, um banco de dados relacional ainda é a melhor abordagem.</span><span class="sxs-lookup"><span data-stu-id="4969e-132">In other cases, a relational database is still the best approach.</span></span> <span data-ttu-id="4969e-133">Portanto, aplicativos baseados em microsserviço geralmente usam uma combinação de bancos de dados SQL e NoSQL, chamada às vezes de abordagem de [persistência poliglota](https://martinfowler.com/bliki/PolyglotPersistence.html).</span><span class="sxs-lookup"><span data-stu-id="4969e-133">Therefore, microservices-based applications often use a mixture of SQL and NoSQL databases, which is sometimes called the [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) approach.</span></span>

<span data-ttu-id="4969e-134">Uma arquitetura particionada e de persistência poliglota para armazenamento de dados traz muitos benefícios.</span><span class="sxs-lookup"><span data-stu-id="4969e-134">A partitioned, polyglot-persistent architecture for data storage has many benefits.</span></span> <span data-ttu-id="4969e-135">Entre eles, serviços acoplados de forma flexível, desempenho e escalabilidade melhores e capacidade de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="4969e-135">These include loosely coupled services and better performance, scalability, costs, and manageability.</span></span> <span data-ttu-id="4969e-136">No entanto, essa arquitetura pode apresentar alguns desafios relacionados com o gerenciamento de dados distribuídos. Isso será explicado mais adiante neste capítulo, em "[Identificar os limites do modelo de domínio](#identifying-domain-model-boundaries-for-each-microservice)".</span><span class="sxs-lookup"><span data-stu-id="4969e-136">However, it can introduce some distributed data management challenges, as we will explain in “[Identifying domain-model boundaries](#identifying-domain-model-boundaries-for-each-microservice)” later in this chapter.</span></span>

## <a name="the-relationship-between-microservices-and-the-bounded-context-pattern"></a><span data-ttu-id="4969e-137">A relação entre os microsserviços e o padrão do Contexto Delimitado</span><span class="sxs-lookup"><span data-stu-id="4969e-137">The relationship between microservices and the Bounded Context pattern</span></span>

<span data-ttu-id="4969e-138">O conceito de microsserviço tem origem no [padrão de BC (Contexto Delimitado)](https://martinfowler.com/bliki/BoundedContext.html) na [DDD (design controlado por domínio)](https://en.wikipedia.org/wiki/Domain-driven_design).</span><span class="sxs-lookup"><span data-stu-id="4969e-138">The concept of microservice derives from the [Bounded Context (BC) pattern](https://martinfowler.com/bliki/BoundedContext.html) in [domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span></span> <span data-ttu-id="4969e-139">A DDD aborda modelos grandes dividindo-os em vários BCs e explicitando seus limites.</span><span class="sxs-lookup"><span data-stu-id="4969e-139">DDD deals with large models by dividing them into multiple BCs and being explicit about their boundaries.</span></span> <span data-ttu-id="4969e-140">Cada BC precisa ter um modelo e banco de dados próprios. Da mesma forma, cada microsserviço tem seus próprios dados relacionados.</span><span class="sxs-lookup"><span data-stu-id="4969e-140">Each BC must have its own model and database; likewise, each microservice owns its related data.</span></span> <span data-ttu-id="4969e-141">Além disso, cada BC geralmente tem uma [linguagem ubíqua](https://martinfowler.com/bliki/UbiquitousLanguage.html) própria para ajudar na comunicação entre desenvolvedores de software e especialistas em domínio.</span><span class="sxs-lookup"><span data-stu-id="4969e-141">In addition, each BC usually has its own [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) to help communication between software developers and domain experts.</span></span>

<span data-ttu-id="4969e-142">Esses termos (principalmente entidades de domínio) na linguagem ubíqua podem ter nomes diferentes em Contextos Delimitados distintos, mesmo quando entidades de domínio diferentes compartilham a mesma identidade (ou seja, a ID exclusiva utilizada para ler a entidade do armazenamento).</span><span class="sxs-lookup"><span data-stu-id="4969e-142">Those terms (mainly domain entities) in the ubiquitous language can have different names in different Bounded Contexts, even when different domain entities share the same identity (that is, the unique ID that is used to read the entity from storage).</span></span> <span data-ttu-id="4969e-143">Por exemplo, em um Contexto Delimitado de perfil de usuário, a entidade de domínio Usuário pode compartilhar a identidade com a entidade de domínio Comprador no Contexto Delimitado de pedido.</span><span class="sxs-lookup"><span data-stu-id="4969e-143">For instance, in a user-profile Bounded Context, the User domain entity might share identity with the Buyer domain entity in the ordering Bounded Context.</span></span>

<span data-ttu-id="4969e-144">Desse modo, um microsserviço é como um Contexto Delimitado, mas também especifica seu caráter de serviço distribuído.</span><span class="sxs-lookup"><span data-stu-id="4969e-144">A microservice is therefore like a Bounded Context, but it also specifies that it is a distributed service.</span></span> <span data-ttu-id="4969e-145">Ele é criado como um processo separado para cada Contexto Delimitado e precisa utilizar os protocolos distribuídos mencionados anteriormente, como HTTP/HTTPS, WebSockets ou [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span><span class="sxs-lookup"><span data-stu-id="4969e-145">It is built as a separate process for each Bounded Context, and it must use the distributed protocols noted earlier, like HTTP/HTTPS, WebSockets, or [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span></span> <span data-ttu-id="4969e-146">Entretanto, o padrão Contexto Delimitado não especifica se é um serviço distribuído ou simplesmente um limite lógico (como um subsistema genérico) em um aplicativo de implantação monolítica.</span><span class="sxs-lookup"><span data-stu-id="4969e-146">The Bounded Context pattern, however, does not specify whether the Bounded Context is a distributed service or if it is simply a logical boundary (such as a generic subsystem) within a monolithic-deployment application.</span></span>

<span data-ttu-id="4969e-147">É importante salientar que definir um serviço para cada Contexto Delimitado é uma boa maneira de começar.</span><span class="sxs-lookup"><span data-stu-id="4969e-147">It is important to highlight that defining a service for each Bounded Context is a good place to start.</span></span> <span data-ttu-id="4969e-148">Porém, não é preciso restringir seu design a ele.</span><span class="sxs-lookup"><span data-stu-id="4969e-148">But you do not have to constrain your design to it.</span></span> <span data-ttu-id="4969e-149">Às vezes, é necessário criar um Contexto Delimitado ou microsserviço de negócios composto de vários serviços físicos.</span><span class="sxs-lookup"><span data-stu-id="4969e-149">Sometimes you must design a Bounded Context or business microservice composed of several physical services.</span></span> <span data-ttu-id="4969e-150">Mas, por fim, ambos os padrões — Contexto Delimitado e microsserviço — estão intimamente relacionados.</span><span class="sxs-lookup"><span data-stu-id="4969e-150">But ultimately, both patterns—Bounded Context and microservice—are closely related.</span></span>

<span data-ttu-id="4969e-151">A DDD se beneficia dos microsserviços ao obter limites reais na forma de microsserviços distribuídos.</span><span class="sxs-lookup"><span data-stu-id="4969e-151">DDD benefits from microservices by getting real boundaries in the form of distributed microservices.</span></span> <span data-ttu-id="4969e-152">Contudo, ideias como o não compartilhamento do modelo entre os microsserviços também são desejáveis em um Contexto Delimitado.</span><span class="sxs-lookup"><span data-stu-id="4969e-152">But ideas like not sharing the model between microservices are what you also want in a Bounded Context.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="4969e-153">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="4969e-153">Additional resources</span></span>

-   <span data-ttu-id="4969e-154">**Chris Richardson. Padrão: banco de dados por serviço**
    [*https://microservices.io/patterns/data/database-per-service.html*](https://microservices.io/patterns/data/database-per-service.html)</span><span class="sxs-lookup"><span data-stu-id="4969e-154">**Chris Richardson. Pattern: Database per service**
[*https://microservices.io/patterns/data/database-per-service.html*](https://microservices.io/patterns/data/database-per-service.html)</span></span>

-   <span data-ttu-id="4969e-155">**Martin Fowler. BoundedContext**
    [*https://martinfowler.com/bliki/BoundedContext.html*](https://martinfowler.com/bliki/BoundedContext.html)</span><span class="sxs-lookup"><span data-stu-id="4969e-155">**Martin Fowler. BoundedContext**
[*https://martinfowler.com/bliki/BoundedContext.html*](https://martinfowler.com/bliki/BoundedContext.html)</span></span>

-   <span data-ttu-id="4969e-156">**Martin Fowler. PolyglotPersistence**
    [*https://martinfowler.com/bliki/PolyglotPersistence.html*](https://martinfowler.com/bliki/PolyglotPersistence.html)</span><span class="sxs-lookup"><span data-stu-id="4969e-156">**Martin Fowler. PolyglotPersistence**
[*https://martinfowler.com/bliki/PolyglotPersistence.html*](https://martinfowler.com/bliki/PolyglotPersistence.html)</span></span>

-   <span data-ttu-id="4969e-157">**Alberto Brandolini. Design controlado por domínio estratégico com mapeamento de contexto**
    [*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span><span class="sxs-lookup"><span data-stu-id="4969e-157">**Alberto Brandolini. Strategic Domain Driven Design with Context Mapping**
[*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="4969e-158">[Anterior] (microservices-architecture.md) [Próximo] (logical-versus-physical-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="4969e-158">[Previous] (microservices-architecture.md) [Next] (logical-versus-physical-architecture.md)</span></span>
