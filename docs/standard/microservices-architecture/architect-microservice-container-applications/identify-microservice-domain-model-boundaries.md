---
title: "Identificando os limites de modelo de domínio de cada microsserviço"
description: "Arquitetura de microsserviços .NET para aplicativos .NET em contêineres | Identificando os limites de modelo de domínio para cada microsserviço"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 830dd48a420a462842de57e436323a5a930c195d
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/23/2017
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="7cbdb-104">Identificar os limites de modelo de domínio de cada microsserviço</span><span class="sxs-lookup"><span data-stu-id="7cbdb-104">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="7cbdb-105">A meta de identificar os limites do modelo e o tamanho de cada microsserviço não é obter a separação mais granular possível, embora você deva tender a usar microsserviços pequenos, se possível.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-105">The goal when identifying model boundaries and size for each microservice is not to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="7cbdb-106">Em vez disso, sua meta deve ser obter a separação mais significativa orientada pelo seu conhecimento do domínio.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-106">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="7cbdb-107">A ênfase não está no tamanho, mas em funcionalidades de negócios.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-107">The emphasis is not on the size, but instead on business capabilities.</span></span> <span data-ttu-id="7cbdb-108">Além disso, se for necessária uma clara coesão para uma determinada área do aplicativo com base em um grande número de dependências, isso será a indicação da necessidade de um único microsserviço também.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-108">In addition, if there is clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="7cbdb-109">A coesão é uma maneira de identificar como separar ou agrupar microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-109">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="7cbdb-110">Por fim, enquanto você obtém mais conhecimento sobre o domínio, deve adaptar o tamanho do seu microsserviço iterativamente.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-110">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="7cbdb-111">Localizar o tamanho correto não é um processo único.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-111">Finding the right size is not a one-shot process.</span></span>

<span data-ttu-id="7cbdb-112">[SAM Newman](http://samnewman.io/), um conhecido promotor de microsserviços e autor do livro [Building microservices](http://samnewman.io/books/building_microservices/) (Criando microsserviços), realça o que você deve projetar seus microsserviços com base no padrão de BC (Contexto Limitado) (parte do controlado por domínio design), conforme apresentado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-112">[Sam Newman](http://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](http://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="7cbdb-113">Às vezes, um BC poderia ser composto por vários serviços físicos, mas não vice-versa.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-113">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="7cbdb-114">Um modelo de domínio com entidades de domínio específicas dentro de um BC ou microsserviço concreto.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-114">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="7cbdb-115">Um BC delimita a aplicabilidade de um modelo de domínio e dá aos membros da equipe do desenvolvedor uma compreensão clara e compartilhada sobre o que deve ser coeso e o que pode ser desenvolvido de modo independente.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-115">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="7cbdb-116">Essas são as mesmas metas de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-116">These are the same goals for microservices.</span></span>

<span data-ttu-id="7cbdb-117">Outra ferramenta que informa a sua escolha de design é a [lei de Conway](https://en.wikipedia.org/wiki/Conway%27s_law), que diz que um aplicativo refletirá os limites sociais da organização que o produziu.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-117">Another tool that informs your design choice is [Conway’s law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="7cbdb-118">Porém, às vezes, o oposto é verdadeiro: a organização da empresa é formada pelo software.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-118">But sometimes the opposite is true—the company’s organization is formed by the software.</span></span> <span data-ttu-id="7cbdb-119">Talvez você precise reverter a lei de Conway e criar os limites de compilação da maneira que deseja que a empresa seja organizada, inclinada em direção à consultoria do processo de negócios.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-119">You might need to reverse Conway’s law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="7cbdb-120">Para identificar contextos limitados, um padrão DDD que pode ser usado para isso é o [padrão de Mapeamento de Contexto](https://www.infoq.com/articles/ddd-contextmapping).</span><span class="sxs-lookup"><span data-stu-id="7cbdb-120">In order to identify bounded contexts, a DDD pattern that can be used for this is the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="7cbdb-121">Com Mapeamento de Contexto, você identifica os vários contextos no aplicativo e seus limites.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-121">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="7cbdb-122">É comum haver um contexto e um limite diferentes para cada subsistema pequeno, por exemplo.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-122">It is common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="7cbdb-123">O Mapa de Contexto é uma maneira de definir e explicitar esses limites entre domínios.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-123">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="7cbdb-124">Um BC é autônomo e inclui os detalhes de um único domínio (detalhes como as entidades de domínio) e define os contratos de integração com outros BCs.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-124">A BC is autonomous and includes the details of a single domain—details like the domain entities—and defines integration contracts with other BCs.</span></span> <span data-ttu-id="7cbdb-125">Isso é semelhante à definição de um microsserviço: é autônomo, implementa determinadas funcionalidades de domínio e deve fornecer interfaces.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-125">This is similar to the definition of a microservice: it is autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="7cbdb-126">É por isso que o Mapeamento de Contexto e o padrão de Contexto Limitado são boas abordagens para identificar os limites de modelo de domínio dos seus microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-126">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="7cbdb-127">Ao criar um aplicativo grande, você verá como seu modelo de domínio pode ser fragmentado; um especialista de domínio do domínio de catálogo nomeará as entidades de maneira diferente nos domínios de catálogo e de inventário que um especialista em domínio de envio, por exemplo.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-127">When designing a large application, you will see how its domain model can be fragmented — a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="7cbdb-128">Ou a entidade de usuário de domínio pode ser diferente em termos de tamanho e número de atributos ao lidar com um especialista do CRM que queira armazenar todos os detalhes sobre o cliente do que ao lidar com um especialista de domínio de ordenação que precisa apenas de dados parciais sobre o cliente.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-128">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="7cbdb-129">É muito difícil resolver a ambiguidade de todos os termos do domínio em todos os domínios relacionados a um aplicativo grande.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-129">It is very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="7cbdb-130">Porém, o mais importante é que você não deve tentar unificar os termos; em vez disso, aceite as diferenças e riqueza fornecida pelos domínios individuais.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-130">But the most important thing is that you should not try to unify the terms; instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="7cbdb-131">Se você tentar obter um banco de dados unificado para o aplicativo inteiro, tentativas de um vocabulário unificada serão inadequadas e não soarão bem a nenhum dos vários especialistas de domínio.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-131">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and will not sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="7cbdb-132">Portanto, BCs (implementados como microsserviços) ajudarão a esclarecer em que locais você pode usar determinados termos do domínio e em que locais precisará dividir o sistema e criar BCs adicionais com domínios diferentes.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-132">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you will need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="7cbdb-133">Você saberá que você obteve os limites e tamanhos certos de cada BC e modelo de domínio se tiver alguma relação forte entre modelos de domínio, e normalmente não precisará mesclar informações de vários modelos de domínio ao executar um operações de aplicativo típicas.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-133">You will know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="7cbdb-134">Talvez a melhor resposta à pergunta de quão grande um modelo de domínio para cada microsserviço deve ser é a seguinte: ele deve ter um BC autônomo, o mais isolado possível, que lhe permita trabalhar sem precisar mudar constantemente para outros contextos (outros modelos do microsserviço).</span><span class="sxs-lookup"><span data-stu-id="7cbdb-134">Perhaps the best answer to the question of how big a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice’s models).</span></span> <span data-ttu-id="7cbdb-135">Na Figura 4-10, você pode ver como vários microsserviços (vários BCs) têm cada um os próprios modelos e como suas entidades podem ser definidas, dependendo dos requisitos específicos para cada um dos domínios identificados em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-135">In Figure 4-10 you can see how multiple microservices (multiple BCs) each have their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![](./media/image10.png)

<span data-ttu-id="7cbdb-136">**Figura 4-10**.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-136">**Figure 4-10**.</span></span> <span data-ttu-id="7cbdb-137">Identificação de entidades e limites de modelo de microsserviço</span><span class="sxs-lookup"><span data-stu-id="7cbdb-137">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="7cbdb-138">A Figura 4-10 ilustra um cenário de exemplo relacionado a um sistema de gerenciamento de conferência online.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-138">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="7cbdb-139">Você identificou vários BCs que podem ser implementados como microsserviços, com base em domínios que especialistas de domínio definiram para você.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-139">You have identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="7cbdb-140">Como você pode ver, há entidades que estão presentes apenas em um único modelo de microsserviço, como Pagamentos no microsserviço de Pagamento.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-140">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="7cbdb-141">Esses serão fáceis de implementar.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-141">Those will be easy to implement.</span></span>

<span data-ttu-id="7cbdb-142">No entanto, você também pode ter entidades com diferentes formas, mas que compartilhem de uma mesma identidade em vários modelos de domínio de vários microsserviços.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-142">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="7cbdb-143">Por exemplo, a entidade de Usuário é identificada no microsserviço Gerenciamento de Conferências.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-143">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="7cbdb-144">Esse mesmo usuário, com a mesma identidade, é o chamado Compradores no microsserviço de Ordenação ou o chamado Pagante no microsserviço de Pagamento e, até mesmo, o chamado Cliente no microsserviço de Atendimento ao Cliente.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-144">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="7cbdb-145">Isso ocorre porque, dependendo da [linguagem ubíqua](https://martinfowler.com/bliki/UbiquitousLanguage.html) que cada especialista em domínio está usando, um usuário pode ter uma perspectiva diferente mesmo com atributos diferentes.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-145">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="7cbdb-146">A entidade de usuário no modelo de microsserviço denominado Gerenciamento de Conferências pode ter a maioria dos seus atributos de dados pessoais.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-146">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="7cbdb-147">No entanto, esse mesmo usuário na forma Pagante no microsserviço Pagamento ou na forma de Cliente no microsserviço Atendimento ao Cliente talvez não precise da mesma lista de atributos.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-147">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="7cbdb-148">Uma abordagem similar é ilustrada na Figura 4-11.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-148">A similar approach is illustrated in Figure 4-11.</span></span>

![](./media/image11.png)

<span data-ttu-id="7cbdb-149">**Figura 4-11**.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-149">**Figure 4-11**.</span></span> <span data-ttu-id="7cbdb-150">Decomposição de modelos de dados tradicionais em vários modelos de domínio</span><span class="sxs-lookup"><span data-stu-id="7cbdb-150">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="7cbdb-151">Você pode ver como o usuário está presente no modelo de microsserviço de Gerenciamento de Conferências como a entidade de Usuário e também está presente na forma de entidade de Comprador no microsserviço Preços, com atributos ou detalhes alternativos sobre o usuário quando ele é de fato um Comprador.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-151">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it is actually a buyer.</span></span> <span data-ttu-id="7cbdb-152">Cada microsserviço ou BC pode não precisar de todos os dados relacionados a uma entidade de Usuário, apenas parte deles, dependendo do problema ou do contexto a resolver.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-152">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="7cbdb-153">Por exemplo, no modelo de microsserviço de Preços, não é necessário o endereço nem a ID do usuário, apenas a ID (como identidade) e o Status, que afetarão os descontos ao definir os preços das estações por comprador.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-153">For instance, in the Pricing microservice model, you do not need the address or the ID of the user, just ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="7cbdb-154">A entidade Seat tem o mesmo nome, mas diferentes atributos em cada modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-154">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="7cbdb-155">No entanto, Seat compartilha identidade com base na mesma ID, conforme acontece com Usuário e Comprador.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-155">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="7cbdb-156">Basicamente, há um conceito compartilhado de um usuário que existe em vários serviços (domínios), que compartilham todos da identidade do usuário.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-156">Basically, there is a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="7cbdb-157">Mas, em cada modelo de domínio, pode haver detalhes adicionais ou diferentes sobre a entidade de usuário.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-157">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="7cbdb-158">Portanto, precisa haver uma maneira de mapear uma entidade de usuário de um domínio (microsserviço) para outro.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-158">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="7cbdb-159">Existem vários benefícios em não compartilhar a mesma entidade de usuário com o mesmo número de atributos entre domínios.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-159">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="7cbdb-160">Um benefício é reduzir a duplicação para que os modelos de microsserviço não tenham nenhum dado de que não precisem.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-160">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="7cbdb-161">Outro benefício é ter um microsserviço mestre que detém um determinado tipo de dados por entidade de modo que atualizações e consultas para esse tipo de dados sejam controladas apenas por esse microsserviço.</span><span class="sxs-lookup"><span data-stu-id="7cbdb-161">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="7cbdb-162">[Anterior] (distributed-data-management.md) [Próximo] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="7cbdb-162">[Previous] (distributed-data-management.md) [Next] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
