---
title: "Comunicação assíncrona baseada em mensagens"
description: "Arquitetura de Microservices .NET para aplicativos .NET em contêineres | Comunicação assíncrona baseada em mensagens"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: df39771295d12e122edbe27e91cd899e3318e301
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/22/2017
---
# <a name="asynchronous-message-based-communication"></a><span data-ttu-id="166e1-104">Comunicação assíncrona baseada em mensagens</span><span class="sxs-lookup"><span data-stu-id="166e1-104">Asynchronous message-based communication</span></span>

<span data-ttu-id="166e1-105">Sistema de mensagens assíncronas e comunicação controlada por evento são essenciais ao propagar alterações em várias microservices e seus modelos de domínio relacionadas.</span><span class="sxs-lookup"><span data-stu-id="166e1-105">Asynchronous messaging and event-driven communication are critical when propagating changes across multiple microservices and their related domain models.</span></span> <span data-ttu-id="166e1-106">Conforme mencionado anteriormente na discussão microservices e contextos limitada (BCs), modelos (usuário, cliente, produto, conta, etc.) podem significar coisas diferentes para diferentes microservices ou BCs.</span><span class="sxs-lookup"><span data-stu-id="166e1-106">As mentioned earlier in the discussion microservices and Bounded Contexts (BCs), models (User, Customer, Product, Account, etc.) can mean different things to different microservices or BCs.</span></span> <span data-ttu-id="166e1-107">Isso significa que quando ocorrem alterações, você precisa de algum modo para reconciliar as alterações entre diferentes modelos.</span><span class="sxs-lookup"><span data-stu-id="166e1-107">That means that when changes occur, you need some way to reconcile changes across the different models.</span></span> <span data-ttu-id="166e1-108">Uma solução é consistência eventual e comunicação controlada por evento, com base no sistema de mensagens assíncronas.</span><span class="sxs-lookup"><span data-stu-id="166e1-108">A solution is eventual consistency and event-driven communication based on asynchronous messaging.</span></span>

<span data-ttu-id="166e1-109">Ao usar o sistema de mensagens, processos se comunicam trocando mensagens de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="166e1-109">When using messaging, processes communicate by exchanging messages asynchronously.</span></span> <span data-ttu-id="166e1-110">Um cliente faz um comando ou uma solicitação para um serviço ao enviar uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="166e1-110">A client makes a command or a request to a service by sending it a message.</span></span> <span data-ttu-id="166e1-111">Se o serviço precisar responder, ele envia uma mensagem diferente para o cliente.</span><span class="sxs-lookup"><span data-stu-id="166e1-111">If the service needs to reply, it sends a different message back to the client.</span></span> <span data-ttu-id="166e1-112">Como é uma comunicação baseada em mensagens, o cliente presume que a resposta não será recebida imediatamente e que não pode haver nenhuma resposta em todos os.</span><span class="sxs-lookup"><span data-stu-id="166e1-112">Since it is a message-based communication, the client assumes that the reply will not be received immediately, and that there might be no response at all.</span></span>

<span data-ttu-id="166e1-113">Uma mensagem é composta por um cabeçalho (metadados, como informações de identificação ou de segurança) e um corpo.</span><span class="sxs-lookup"><span data-stu-id="166e1-113">A message is composed by a header (metadata such as identification or security information) and a body.</span></span> <span data-ttu-id="166e1-114">Geralmente são enviadas por meio de protocolos assíncronos como AMQP.</span><span class="sxs-lookup"><span data-stu-id="166e1-114">Messages are usually sent through asynchronous protocols like AMQP.</span></span>

<span data-ttu-id="166e1-115">A infraestrutura preferencial para esse tipo de comunicação na comunidade de microservices é um agente de mensagem leve, que é diferente de agentes de grandes e orchestrators usadas na SOA.</span><span class="sxs-lookup"><span data-stu-id="166e1-115">The preferred infrastructure for this type of communication in the microservices community is a lightweight message broker, which is different than the large brokers and orchestrators used in SOA.</span></span> <span data-ttu-id="166e1-116">Em um agente de mensagem leve, a infraestrutura é normalmente "inútil," atuando somente como um agente de mensagens, com implantações simples como RabbitMQ ou um barramento de serviço escalonáveis na nuvem como o Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="166e1-116">In a lightweight message broker, the infrastructure is typically “dumb,” acting only as a message broker, with simple implementations such as RabbitMQ or a scalable service bus in the cloud like Azure Service Bus.</span></span> <span data-ttu-id="166e1-117">Nesse cenário, a maioria do raciocínio "inteligente" ainda mora em pontos de extremidade que estão produzindo e consumir mensagens — ou seja, em que o microservices.</span><span class="sxs-lookup"><span data-stu-id="166e1-117">In this scenario, most of the “smart” thinking still lives in the endpoints that are producing and consuming messages—that is, in the microservices.</span></span>

<span data-ttu-id="166e1-118">Outra regra que a seguir, tanto quanto possível, tente é usar mensagens assíncronas somente entre os serviços internos e para usar comunicação síncrona (como HTTP) apenas nos aplicativos de cliente para os serviços de front-end (Gateways de API e o primeiro nível de microservices).</span><span class="sxs-lookup"><span data-stu-id="166e1-118">Another rule you should try to follow, as much as possible, is to use only asynchronous messaging between the internal services, and to use synchronous communication (such as HTTP) only from the client apps to the front-end services (API Gateways plus the first level of microservices).</span></span>

<span data-ttu-id="166e1-119">Há dois tipos de comunicação assíncrona de mensagens: comunicação baseada em mensagens do receptor único e vários receptores mensagem uma comunicação.</span><span class="sxs-lookup"><span data-stu-id="166e1-119">There are two kinds of asynchronous messaging communication: single receiver message-based communication, and multiple receivers message-based communication.</span></span> <span data-ttu-id="166e1-120">As seções a seguir fornecemos detalhes sobre elas.</span><span class="sxs-lookup"><span data-stu-id="166e1-120">In the following sections we provide details about them.</span></span>

## <a name="single-receiver-message-based-communication"></a><span data-ttu-id="166e1-121">Comunicação baseada em mensagem único destinatário</span><span class="sxs-lookup"><span data-stu-id="166e1-121">Single-receiver message-based communication</span></span> 

<span data-ttu-id="166e1-122">Comunicação assíncrona baseada em mensagem com um único destinatário significa que não há comunicação ponto a ponto que envia uma mensagem para exatamente um dos consumidores que está lendo do canal e a mensagem é processada apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="166e1-122">Message-based asynchronous communication with a single receiver means there is point-to-point communication that delivers a message to exactly one of the consumers that is reading from the channel, and that the message is processed just once.</span></span> <span data-ttu-id="166e1-123">No entanto, há situações especiais.</span><span class="sxs-lookup"><span data-stu-id="166e1-123">However, there are special situations.</span></span> <span data-ttu-id="166e1-124">Por exemplo, em um sistema de nuvem que tenta se recuperar automaticamente de falhas, a mesma mensagem pode ser enviada várias vezes.</span><span class="sxs-lookup"><span data-stu-id="166e1-124">For instance, in a cloud system that tries to automatically recover from failures, the same message could be sent multiple times.</span></span> <span data-ttu-id="166e1-125">Devido à rede ou outras falhas, o cliente deve ser capaz de tentar o envio de mensagens e o servidor tem que implementar uma operação para ser idempotente para processar uma mensagem específica apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="166e1-125">Due to network or other failures, the client has to be able to retry sending messages, and the server has to implement an operation to be idempotent in order to process a particular message just once.</span></span>

<span data-ttu-id="166e1-126">A comunicação baseada em mensagem único destinatário é especialmente adequada para enviar comandos assíncronos de um microsserviço para outro, conforme mostrado na Figura 4-18 que mostra essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="166e1-126">Single-receiver message-based communication is especially well suited for sending asynchronous commands from one microservice to another as shown in Figure 4-18 that illustrates this approach.</span></span>

<span data-ttu-id="166e1-127">Depois de iniciar a comunicação baseada em mensagens (ou com comandos ou eventos) de envio, você deve evitar a mistura de comunicação baseada em mensagem com a comunicação HTTP síncrona.</span><span class="sxs-lookup"><span data-stu-id="166e1-127">Once you start sending message-based communication (either with commands or events), you should avoid mixing message-based communication with synchronous HTTP communication.</span></span>

![](./media/image18.PNG)

<span data-ttu-id="166e1-128">**Figura 4-18**.</span><span class="sxs-lookup"><span data-stu-id="166e1-128">**Figure 4-18**.</span></span> <span data-ttu-id="166e1-129">Um único microsserviço recebendo uma mensagem assíncrona</span><span class="sxs-lookup"><span data-stu-id="166e1-129">A single microservice receiving an asynchronous message</span></span>

<span data-ttu-id="166e1-130">Observe que, quando os comandos provém de aplicativos cliente, elas podem ser implementadas como comandos síncronos HTTP.</span><span class="sxs-lookup"><span data-stu-id="166e1-130">Note that when the commands come from client applications, they can be implemented as HTTP synchronous commands.</span></span> <span data-ttu-id="166e1-131">Quando você precisar maior escalabilidade ou quando você já estiver em um processo de negócios com base em mensagem, você deve usar comandos baseada em mensagem.</span><span class="sxs-lookup"><span data-stu-id="166e1-131">You should use message-based commands when you need higher scalability or when you are already in a message-based business process.</span></span>

## <a name="multiple-receivers-message-based-communication"></a><span data-ttu-id="166e1-132">Comunicação baseada em mensagens de vários destinatários</span><span class="sxs-lookup"><span data-stu-id="166e1-132">Multiple-receivers message-based communication</span></span> 

<span data-ttu-id="166e1-133">Como uma abordagem mais flexível, você também poderá usar um mecanismo de publicação/assinatura para que a comunicação do remetente estará disponível para o assinante adicionais microservices ou para aplicativos externos.</span><span class="sxs-lookup"><span data-stu-id="166e1-133">As a more flexible approach, you might also want to use a publish/subscribe mechanism so that your communication from the sender will be available to additional subscriber microservices or to external applications.</span></span> <span data-ttu-id="166e1-134">Portanto, ele ajuda a seguir o [abertura/fechamento princípio](https://en.wikipedia.org/wiki/Open/closed_principle) no serviço de envio.</span><span class="sxs-lookup"><span data-stu-id="166e1-134">Thus, it helps you to follow the [open/closed principle](https://en.wikipedia.org/wiki/Open/closed_principle) in the sending service.</span></span> <span data-ttu-id="166e1-135">Dessa forma, assinantes adicionais podem ser adicionados no futuro sem a necessidade de modificar o serviço do remetente.</span><span class="sxs-lookup"><span data-stu-id="166e1-135">That way, additional subscribers can be added in the future without the need to modify the sender service.</span></span>

<span data-ttu-id="166e1-136">Quando você usar uma comunicação de publicação/assinatura, talvez você esteja usando uma interface de barramento de eventos para eventos de publicação a qualquer assinante.</span><span class="sxs-lookup"><span data-stu-id="166e1-136">When you use a publish/subscribe communication, you might be using an event bus interface to publish events to any subscriber.</span></span>

## <a name="asynchronous-event-driven-communication"></a><span data-ttu-id="166e1-137">Comunicação assíncrona controlada por evento</span><span class="sxs-lookup"><span data-stu-id="166e1-137">Asynchronous event-driven communication</span></span>

<span data-ttu-id="166e1-138">Ao usar comunicação assíncrona controlada por evento, um microsserviço publica um evento de integração quando acontecer algo em seu domínio e outro microsserviço precisa ser consideradas, como uma alteração de preço em um microsserviço do catálogo de produtos.</span><span class="sxs-lookup"><span data-stu-id="166e1-138">When using asynchronous event-driven communication, a microservice publishes an integration event when something happens within its domain and another microservice needs to be aware of it, like a price change in a product catalog microservice.</span></span> <span data-ttu-id="166e1-139">Microservices adicionais assinar os eventos para eles podem recebê-las de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="166e1-139">Additional microservices subscribe to the events so they can receive them asynchronously.</span></span> <span data-ttu-id="166e1-140">Quando isso acontece, os receptores podem atualizar suas próprias entidades de domínio, o que podem causar mais eventos de integração a ser publicado.</span><span class="sxs-lookup"><span data-stu-id="166e1-140">When that happens, the receivers might update their own domain entities, which can cause more integration events to be published.</span></span> <span data-ttu-id="166e1-141">Este sistema de publicação/assinatura normalmente é executado por meio de uma implementação de um barramento de evento.</span><span class="sxs-lookup"><span data-stu-id="166e1-141">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="166e1-142">O barramento de evento pode ser projetado como uma interface, com a API que é necessário para assinar ou cancelar a assinatura para eventos e publicar eventos ou de abstração.</span><span class="sxs-lookup"><span data-stu-id="166e1-142">The event bus can be designed as an abstraction or interface, with the API that is needed to subscribe or unsubscribe to events and to publish events.</span></span> <span data-ttu-id="166e1-143">O barramento de evento também pode ter um ou mais implementações com base em qualquer agente entre processos e mensagens, como uma fila de mensagens ou o barramento de serviço que dá suporte à comunicação assíncrona e um modelo de publicação/assinatura.</span><span class="sxs-lookup"><span data-stu-id="166e1-143">The event bus can also have one or more implementations based on any inter-process and messaging broker, like a messaging queue or service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="166e1-144">Se um sistema usa consistência eventual orientada por eventos de integração, é recomendável que essa abordagem ficar completamente limpa para o usuário final.</span><span class="sxs-lookup"><span data-stu-id="166e1-144">If a system uses eventual consistency driven by integration events, it is recommended that this approach be made completely clear to the end user.</span></span> <span data-ttu-id="166e1-145">O sistema não deve usar uma abordagem que simule eventos de integração, como sistemas de sondagem do cliente ou SignalR.</span><span class="sxs-lookup"><span data-stu-id="166e1-145">The system should not use an approach that mimics integration events, like SignalR or polling systems from the client.</span></span> <span data-ttu-id="166e1-146">O usuário final e o proprietário da empresa precisam explicitamente adotar consistência eventual no sistema e observe que em muitos casos de negócios não tem nenhum problema com essa abordagem, desde que ele seja explícito.</span><span class="sxs-lookup"><span data-stu-id="166e1-146">The end user and the business owner have to explicitly embrace eventual consistency in the system and realize that in many cases the business does not have any problem with this approach, as long as it is explicit.</span></span>

<span data-ttu-id="166e1-147">Conforme observado anteriormente no [desafios e soluções para o gerenciamento de dados distribuídas](#challenges-and-solutions-for-distributed-data-management) seção, você pode usar eventos de integração para implementar as tarefas de negócios que abrangem vários microservices.</span><span class="sxs-lookup"><span data-stu-id="166e1-147">As noted earlier in the [Challenges and solutions for distributed data management](#challenges-and-solutions-for-distributed-data-management) section, you can use integration events to implement business tasks that span multiple microservices.</span></span> <span data-ttu-id="166e1-148">Assim, você terá consistência eventual entre esses serviços.</span><span class="sxs-lookup"><span data-stu-id="166e1-148">Thus you will have eventual consistency between those services.</span></span> <span data-ttu-id="166e1-149">Uma transação finalmente consistente é composta de uma coleção de ações distribuídas.</span><span class="sxs-lookup"><span data-stu-id="166e1-149">An eventually consistent transaction is made up of a collection of distributed actions.</span></span> <span data-ttu-id="166e1-150">Em cada ação, o microsserviço relacionado atualiza uma entidade de domínio e publica outro evento de integração que gera a próxima ação dentro da mesma tarefa comercial de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="166e1-150">At each action, the related microservice updates a domain entity and publishes another integration event that raises the next action within the same end-to-end business task.</span></span>

<span data-ttu-id="166e1-151">Um ponto importante é que você deseja se comunicar com várias microservices que assinou o mesmo evento.</span><span class="sxs-lookup"><span data-stu-id="166e1-151">An important point is that you might want to communicate to multiple microservices that are subscribed to the same event.</span></span> <span data-ttu-id="166e1-152">Para fazer isso, você pode usar a publicação/assinatura de mensagens com base em comunicação controlada por evento, conforme mostrado na Figura 4-19.</span><span class="sxs-lookup"><span data-stu-id="166e1-152">To do so, you can use publish/subscribe messaging based on event-driven communication, as shown in Figure 4-19.</span></span> <span data-ttu-id="166e1-153">Esse mecanismo de publicação/assinatura não é exclusivo para a arquitetura de microsserviço.</span><span class="sxs-lookup"><span data-stu-id="166e1-153">This publish/subscribe mechanism is not exclusive to the microservice architecture.</span></span> <span data-ttu-id="166e1-154">É semelhante à forma como [limitada contextos](http://martinfowler.com/bliki/BoundedContext.html) no DDD deve se comunicar ou à forma como você propagar atualizações do banco de dados de gravação no banco de dados de leitura no [comando e consulta responsabilidade CQRS (segregação)](http://martinfowler.com/bliki/CQRS.html)padrão de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="166e1-154">It is similar to the way [Bounded Contexts](http://martinfowler.com/bliki/BoundedContext.html) in DDD should communicate, or to the way you propagate updates from the write database to the read database in the [Command and Query Responsibility Segregation (CQRS)](http://martinfowler.com/bliki/CQRS.html) architecture pattern.</span></span> <span data-ttu-id="166e1-155">A meta é ter consistência eventual entre várias fontes de dados em seu sistema distribuído.</span><span class="sxs-lookup"><span data-stu-id="166e1-155">The goal is to have eventual consistency between multiple data sources across your distributed system.</span></span>

![](./media/image19.png)

<span data-ttu-id="166e1-156">**Figura 4-19**.</span><span class="sxs-lookup"><span data-stu-id="166e1-156">**Figure 4-19**.</span></span> <span data-ttu-id="166e1-157">Comunicação assíncrona de mensagem controlado por evento</span><span class="sxs-lookup"><span data-stu-id="166e1-157">Asynchronous event-driven message communication</span></span>

<span data-ttu-id="166e1-158">Sua implementação determinará o protocolo a ser usado para comunicações com base na mensagem, controlada por evento.</span><span class="sxs-lookup"><span data-stu-id="166e1-158">Your implementation will determine what protocol to use for event-driven, message-based communications.</span></span> <span data-ttu-id="166e1-159">[AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol) pode ajudar a obter uma comunicação confiável na fila.</span><span class="sxs-lookup"><span data-stu-id="166e1-159">[AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol) can help achieve reliable queued communication.</span></span>

<span data-ttu-id="166e1-160">Quando você usar um barramento de evento, talvez você queira usar um nível de abstração (como uma interface de barramento de evento) com base em uma implementação relacionada em classes com o código usando a API de um agente de mensagens como [RabbitMQ](https://www.rabbitmq.com/) ou um barramento de serviço como [Barramento de serviço do azure com tópicos](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="166e1-160">When you use an event bus, you might want to use an abstraction level (like an event bus interface) based on a related implementation in classes with code using the API from a message broker like [RabbitMQ](https://www.rabbitmq.com/) or a service bus like [Azure Service Bus with Topics](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span></span> <span data-ttu-id="166e1-161">Como alternativa, você talvez queira usar um barramento de serviço de nível superior como NServiceBus, MassTransit ou Brighter para enfatizar o barramento de evento e sistema de publicação/assinatura.</span><span class="sxs-lookup"><span data-stu-id="166e1-161">Alternatively, you might want to use a higher-level service bus like NServiceBus, MassTransit, or Brighter to articulate your event bus and publish/subscribe system.</span></span>

## <a name="a-note-about-messaging-technologies-for-production-systems"></a><span data-ttu-id="166e1-162">Uma observação sobre tecnologias para sistemas de produção de mensagens</span><span class="sxs-lookup"><span data-stu-id="166e1-162">A note about messaging technologies for production systems</span></span>

<span data-ttu-id="166e1-163">As tecnologias de mensagens disponíveis para implementar o barramento do evento abstrato estão em diferentes níveis.</span><span class="sxs-lookup"><span data-stu-id="166e1-163">The messaging technologies available for implementing your abstract event bus are at different levels.</span></span> <span data-ttu-id="166e1-164">Por exemplo, produtos, como RabbitMQ (um transporte do broker mensagens) e o Azure Service Bus ficam em um nível inferior outros produtos como, NServiceBus, MassTransit ou Brighter, que pode funcionar sobre RabbitMQ e o barramento de serviço do Azure.</span><span class="sxs-lookup"><span data-stu-id="166e1-164">For instance, products like RabbitMQ (a messaging broker transport) and Azure Service Bus sit at a lower level than other products like, NServiceBus, MassTransit, or Brighter, which can work on top of RabbitMQ and Azure Service Bus.</span></span> <span data-ttu-id="166e1-165">Sua escolha depende de quantos recursos avançados no nível do aplicativo e escalabilidade de fora da caixa, que você precisa para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="166e1-165">Your choice depends on how many rich features at the application level and out-of-the-box scalability you need for your application.</span></span> <span data-ttu-id="166e1-166">Para implementar apenas um barramento de evento de prova de conceito para seu ambiente de desenvolvimento, como fizemos no exemplo de eShopOnContainers, pode ser uma implementação simples sobre RabbitMQ em execução em um contêiner do Docker suficiente.</span><span class="sxs-lookup"><span data-stu-id="166e1-166">For implementing just a proof-of-concept event bus for your development environment, as we have done in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running on a Docker container might be enough.</span></span>

<span data-ttu-id="166e1-167">No entanto, para essenciais e sistemas de produção que precisam hyper escalabilidade, talvez você queira avaliar o Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="166e1-167">However, for mission-critical and production systems that need hyper-scalability, you might want to evaluate Azure Service Bus.</span></span> <span data-ttu-id="166e1-168">Recursos que facilitam o desenvolvimento de aplicativos distribuídos e abstrações de alto nível, é recomendável que você avalie barramentos outros serviços comerciais e de código aberto, como NServiceBus, MassTransit e Brighter.</span><span class="sxs-lookup"><span data-stu-id="166e1-168">For high-level abstractions and features that make the development of distributed applications easier, we recommend that you evaluate other commercial and open-source service buses, such as NServiceBus, MassTransit, and Brighter.</span></span> <span data-ttu-id="166e1-169">Obviamente, você pode criar seus próprios recursos de barramento de serviço sobre tecnologias de nível inferior, como RabbitMQ e o Docker.</span><span class="sxs-lookup"><span data-stu-id="166e1-169">Of course, you can build your own service-bus features on top of lower-level technologies like RabbitMQ and Docker.</span></span> <span data-ttu-id="166e1-170">Mas esse trabalho pode muito caro para um aplicativo da empresa personalizados.</span><span class="sxs-lookup"><span data-stu-id="166e1-170">But that plumbing work might cost too much for a custom enterprise application.</span></span>

## <a name="resiliently-publishing-to-the-event-bus"></a><span data-ttu-id="166e1-171">Atenda com flexibilidade de publicação para o barramento de evento</span><span class="sxs-lookup"><span data-stu-id="166e1-171">Resiliently publishing to the event bus</span></span>

<span data-ttu-id="166e1-172">Um desafio ao implementar uma arquitetura orientada a eventos em vários microservices é como atomicamente atualizar estado de microsserviço original durante a publicação atenda com flexibilidade de seu evento integração relacionados para o barramento de evento, com base em alguma forma em transações.</span><span class="sxs-lookup"><span data-stu-id="166e1-172">A challenge when implementing an event-driven architecture across multiple microservices is how to atomically update state in the original microservice while resiliently publishing its related integration event into the event bus, somehow based on transactions.</span></span> <span data-ttu-id="166e1-173">A seguir estão algumas maneiras de fazer isso, embora haja outras abordagens também.</span><span class="sxs-lookup"><span data-stu-id="166e1-173">The following are a few ways to accomplish this, although there could be additional approaches as well.</span></span>

-   <span data-ttu-id="166e1-174">Usando uma fila transacional (baseado em DTC) como MSMQ.</span><span class="sxs-lookup"><span data-stu-id="166e1-174">Using a transactional (DTC-based) queue like MSMQ.</span></span> <span data-ttu-id="166e1-175">(No entanto, essa é uma abordagem herdada.)</span><span class="sxs-lookup"><span data-stu-id="166e1-175">(However, this is a legacy approach.)</span></span>

-   <span data-ttu-id="166e1-176">Usando [mineração do log de transações](http://www.scoop.it/t/sql-server-transaction-log-mining).</span><span class="sxs-lookup"><span data-stu-id="166e1-176">Using [transaction log mining](http://www.scoop.it/t/sql-server-transaction-log-mining).</span></span>

-   <span data-ttu-id="166e1-177">Usando completo [fornecimento do evento](https://msdn.microsoft.com/en-us/library/dn589792.aspx) padrão.</span><span class="sxs-lookup"><span data-stu-id="166e1-177">Using full [Event Sourcing](https://msdn.microsoft.com/en-us/library/dn589792.aspx) pattern.</span></span>

-   <span data-ttu-id="166e1-178">Usando o [da caixa de saída padrão](http://gistlabs.com/2014/05/the-outbox/): uma tabela de banco de dados transacional como uma fila de mensagens que será a base de um componente do criador do evento que criar o evento e publicá-lo.</span><span class="sxs-lookup"><span data-stu-id="166e1-178">Using the [Outbox pattern](http://gistlabs.com/2014/05/the-outbox/): a transactional database table as a message queue that will be the base for an event-creator component that would create the event and publish it.</span></span>

<span data-ttu-id="166e1-179">Tópicos adicionais a serem considerados ao usar comunicação assíncrona são idempotência de mensagem e a eliminação de duplicação de mensagem.</span><span class="sxs-lookup"><span data-stu-id="166e1-179">Additional topics to consider when using asynchronous communication are message idempotence and message deduplication.</span></span> <span data-ttu-id="166e1-180">Esses tópicos são abordados na seção [implementar a comunicação baseada em eventos entre microservices (eventos de integração)](#implementing_event_based_comms_microserv) posteriormente neste guia.</span><span class="sxs-lookup"><span data-stu-id="166e1-180">These topics are covered in the section [Implementing event-based communication between microservices (integration events)](#implementing_event_based_comms_microserv) later in this guide.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="166e1-181">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="166e1-181">Additional resources</span></span>

-   <span data-ttu-id="166e1-182">**Mensagens de eventos controlada por**
    [*http://soapatterns.org/design\_padrões/evento\_controlados por\_de mensagens*](http://soapatterns.org/design_patterns/event_driven_messaging)</span><span class="sxs-lookup"><span data-stu-id="166e1-182">**Event Driven Messaging**
[*http://soapatterns.org/design\_patterns/event\_driven\_messaging*](http://soapatterns.org/design_patterns/event_driven_messaging)</span></span>

-   <span data-ttu-id="166e1-183">**Canal de publicação/assinatura**
    [*http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html*](http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html)</span><span class="sxs-lookup"><span data-stu-id="166e1-183">**Publish/Subscribe Channel**
[*http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html*](http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html)</span></span>

-   <span data-ttu-id="166e1-184">**Udi Dahan. Esclareceu CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="166e1-184">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="166e1-185">**Comando e consultar a segregação de responsabilidade (CQRS)**
    [*https://docs.microsoft.com/azure/architecture/patterns/cqrs*](https://docs.microsoft.com/azure/architecture/patterns/cqrs)</span><span class="sxs-lookup"><span data-stu-id="166e1-185">**Command and Query Responsibility Segregation (CQRS)**
[*https://docs.microsoft.com/azure/architecture/patterns/cqrs*](https://docs.microsoft.com/azure/architecture/patterns/cqrs)</span></span>

-   <span data-ttu-id="166e1-186">**Comunicação entre limitada contextos**
    [*https://msdn.microsoft.com/library/jj591572.aspx*](https://msdn.microsoft.com/library/jj591572.aspx)</span><span class="sxs-lookup"><span data-stu-id="166e1-186">**Communicating Between Bounded Contexts**
[*https://msdn.microsoft.com/library/jj591572.aspx*](https://msdn.microsoft.com/library/jj591572.aspx)</span></span>

-   <span data-ttu-id="166e1-187">**Consistência eventual**
    [*https://en.wikipedia.org/wiki/Eventual\_consistência*](https://en.wikipedia.org/wiki/Eventual_consistency)</span><span class="sxs-lookup"><span data-stu-id="166e1-187">**Eventual consistency**
[*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span></span>

-   <span data-ttu-id="166e1-188">**Jimmy Bogard. Refatoração em direção a resiliência: Avaliando acoplamento**
    [*https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/*](https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/)</span><span class="sxs-lookup"><span data-stu-id="166e1-188">**Jimmy Bogard. Refactoring Towards Resilience: Evaluating Coupling**
[*https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/*](https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="166e1-189">[Anterior] (comunicação-em-microsserviço-architecture.md) [Avançar] (manter-microsserviço-apis.md)</span><span class="sxs-lookup"><span data-stu-id="166e1-189">[Previous] (communication-in-microservice-architecture.md) [Next] (maintain-microservice-apis.md)</span></span>
