---
title: "Aplicando CQRS e CQS abordagens um microsserviço DDD em eShopOnContainers"
description: "Arquitetura de Microservices .NET para aplicativos .NET em contêineres | Aplicando CQRS e CQS abordagens um microsserviço DDD em eShopOnContainers"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: a2c4429a75ca47d4fbcde868b95e76bc65ea2bef
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="ab079-104">Aplicando CQRS e CQS abordagens um microsserviço DDD em eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="ab079-104">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="ab079-105">O design do ordenação microsserviço no aplicativo eShopOnContainers referência se baseia em princípios CQRS.</span><span class="sxs-lookup"><span data-stu-id="ab079-105">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="ab079-106">No entanto, ele usa a abordagem mais simples, que apenas as consultas a separação dos comandos e usando o mesmo banco de dados para ambas as ações.</span><span class="sxs-lookup"><span data-stu-id="ab079-106">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="ab079-107">A essência desses padrões e o ponto importante aqui é que as consultas são idempotentes: não importa quantas vezes você consultar um sistema, o estado do sistema não serão alterado, você pode até usar um modelo de dados diferente de "leitura" que a lógica transacional "gravação" modelo de domínio, embora a ordenação microservices está usando o mesmo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="ab079-107">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="ab079-108">Portanto, essa é uma abordagem CQRS simplificada.</span><span class="sxs-lookup"><span data-stu-id="ab079-108">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="ab079-109">Por outro lado, comandos que iniciam transações e as atualizações de dados, alteram o estado do sistema.</span><span class="sxs-lookup"><span data-stu-id="ab079-109">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="ab079-110">Com os comandos, você precisa ter cuidado quando relacionadas com complexidade e constantes de regras de negócio.</span><span class="sxs-lookup"><span data-stu-id="ab079-110">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="ab079-111">Isso é onde você deseja aplicar as técnicas DDD para ter um sistema modelado melhor.</span><span class="sxs-lookup"><span data-stu-id="ab079-111">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="ab079-112">Os padrões DDD apresentados neste guia não devem ser aplicados universalmente.</span><span class="sxs-lookup"><span data-stu-id="ab079-112">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="ab079-113">Eles apresentam restrições em seu design.</span><span class="sxs-lookup"><span data-stu-id="ab079-113">They introduce constraints on your design.</span></span> <span data-ttu-id="ab079-114">Essas restrições fornecem benefícios como alta qualidade ao longo do tempo, especialmente em comandos e outro código que modifica o estado do sistema.</span><span class="sxs-lookup"><span data-stu-id="ab079-114">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="ab079-115">No entanto, essas restrições adicionam complexidade com menos benefícios para ler e consultar dados.</span><span class="sxs-lookup"><span data-stu-id="ab079-115">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="ab079-116">Um esse padrão é o agregação padrão, o que mais são examinadas em seções posteriores.</span><span class="sxs-lookup"><span data-stu-id="ab079-116">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="ab079-117">Resumidamente, a agregação padrão, tratar vários objetos de domínio como uma única unidade como resultado de sua relação no domínio.</span><span class="sxs-lookup"><span data-stu-id="ab079-117">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="ab079-118">Você não pode obter vantagens deste padrão em consultas; sempre ele pode aumentar a complexidade da lógica de consulta.</span><span class="sxs-lookup"><span data-stu-id="ab079-118">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="ab079-119">Para consultas somente leitura, você não obtiver as vantagens de tratamento de vários objetos como uma única agregação.</span><span class="sxs-lookup"><span data-stu-id="ab079-119">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="ab079-120">Você somente obtém a complexidade.</span><span class="sxs-lookup"><span data-stu-id="ab079-120">You only get the complexity.</span></span>

<span data-ttu-id="ab079-121">Conforme mostrado na Figura 9-2, este guia sugere usando padrões DDD apenas na área de transacional/atualizações do seu microsserviço (ou seja, como disparado por comandos).</span><span class="sxs-lookup"><span data-stu-id="ab079-121">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="ab079-122">Consultas podem seguir uma abordagem mais simples e devem ser separadas dos comandos, seguindo uma abordagem CQRS.</span><span class="sxs-lookup"><span data-stu-id="ab079-122">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="ab079-123">Para implementar o lado"consultas", você pode escolher entre várias abordagens de seu ORM completo como EF Core, AutoMapper projeções, procedimentos armazenados, exibições, Exibições materializadas ou um ORM micro.</span><span class="sxs-lookup"><span data-stu-id="ab079-123">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="ab079-124">Neste guia e eShopOnContainers (especificamente o microsserviço ordenação) que escolhemos para implementar retas consultas usando um micro ORM como [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="ab079-124">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="ab079-125">Isso permite ao usuário implementar qualquer consulta com base nas instruções SQL para obter o melhor desempenho, graças uma estrutura leve com muito pouca sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="ab079-125">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="ab079-126">Observe que, quando você usar essa abordagem, as atualizações para seu modelo que afetam como entidades são persistentes em um banco de dados SQL também necessário atualizações separadas em consultas SQL usadas por Dapper ou quaisquer outras abordagens (não EF) separadas para consultar.</span><span class="sxs-lookup"><span data-stu-id="ab079-126">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="ab079-127">Padrões de CQRS e DDD não são as arquiteturas de nível superior</span><span class="sxs-lookup"><span data-stu-id="ab079-127">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="ab079-128">É importante entender que CQRS e a maioria dos padrões DDD (como camadas DDD ou um modelo de domínio com agregações) não são estilos de arquitetura, mas apenas os padrões de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="ab079-128">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="ab079-129">Microservices, SOA e arquitetura orientada a eventos (EDA) são exemplos de estilos de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="ab079-129">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="ab079-130">Eles descrevem um sistema de vários componentes, como muitos microservices.</span><span class="sxs-lookup"><span data-stu-id="ab079-130">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="ab079-131">Padrões de CQRS e DDD descrevem algo dentro de um único sistema ou um componente. Nesse caso, algo dentro de um microsserviço.</span><span class="sxs-lookup"><span data-stu-id="ab079-131">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="ab079-132">Diferentes contextos limitada (BCs) empregará padrões diferentes.</span><span class="sxs-lookup"><span data-stu-id="ab079-132">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="ab079-133">Eles têm responsabilidades diferentes e que leva a diferentes soluções.</span><span class="sxs-lookup"><span data-stu-id="ab079-133">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="ab079-134">Vale enfatizar que forçar o mesmo padrão em todos os lugares leva a uma falha.</span><span class="sxs-lookup"><span data-stu-id="ab079-134">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="ab079-135">Não use CQRS e DDD padrões em todos os lugares.</span><span class="sxs-lookup"><span data-stu-id="ab079-135">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="ab079-136">Vários subsistemas, BCs ou microservices são mais simples e pode ser implementado mais facilmente usando serviços CRUD simples ou outra abordagem.</span><span class="sxs-lookup"><span data-stu-id="ab079-136">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="ab079-137">Arquitetura de apenas um aplicativo: a arquitetura do aplicativo de sistema ou de ponta a ponta que você está criando (por exemplo, a arquitetura de microservices).</span><span class="sxs-lookup"><span data-stu-id="ab079-137">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="ab079-138">No entanto, o design de cada contexto limitado ou microsserviço que reflete o seu próprio compensações e decisões de design interno em um nível de padrões de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="ab079-138">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="ab079-139">Não tente aplicar os mesmos padrões de arquitetura como CQRS ou DDD em qualquer lugar.</span><span class="sxs-lookup"><span data-stu-id="ab079-139">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="ab079-140">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="ab079-140">Additional resources</span></span>

-   <span data-ttu-id="ab079-141">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="ab079-141">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="ab079-142">**Greg Young. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="ab079-142">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="ab079-143">**Greg Young. Documentos CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="ab079-143">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="ab079-144">**Greg Young. CQRS, tarefa baseado em interfaces de usuário e o fornecimento de evento**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="ab079-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="ab079-145">**Udi Dahan. Esclareceu CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="ab079-145">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="ab079-146">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="ab079-146">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="ab079-147">**(ES) de fornecimento de evento**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="ab079-147">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="ab079-148">[Anterior] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Avançar] (cqrs-microsserviço-reads.md)</span><span class="sxs-lookup"><span data-stu-id="ab079-148">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
