---
title: "Criar um modelo de domínio de microsserviço"
description: "Arquitetura de Microservices .NET para aplicativos .NET em contêineres | Criar um modelo de domínio de microsserviço"
keywords: "Docker, Microsserviços, ASP.NET, Contêiner"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 455a2c5a39fb9b765b557610ab108f8c75882dbd
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-microservice-domain-model"></a><span data-ttu-id="2dcdf-104">Criar um modelo de domínio de microsserviço</span><span class="sxs-lookup"><span data-stu-id="2dcdf-104">Designing a microservice domain model</span></span>

<span data-ttu-id="2dcdf-105">*Definir um modelo de domínio avançado para cada microsserviço de negócios ou contexto limitado*</span><span class="sxs-lookup"><span data-stu-id="2dcdf-105">*Define one rich domain model for each business microservice or Bounded Context*</span></span>

<span data-ttu-id="2dcdf-106">Seu objetivo é criar um modelo de domínio coesa único para cada microsserviço de negócios ou contexto limitado (BC).</span><span class="sxs-lookup"><span data-stu-id="2dcdf-106">Your goal is to create a single cohesive domain model for each business microservice or Bounded Context (BC).</span></span> <span data-ttu-id="2dcdf-107">Tenha em mente, no entanto, que uma continuidade de negócios ou microsserviço de negócios, às vezes, pode ser composto de vários serviços físicos que compartilham um modelo de domínio único.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-107">Keep in mind, however, that a BC or business microservice could sometimes be composed of several physical services that share a single domain model.</span></span> <span data-ttu-id="2dcdf-108">O modelo de domínio deve capturar a regras, o comportamento, idioma de negócios e restrições do contexto associado único ou microsserviço de negócios que ele representa.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-108">The domain model must capture the rules, behavior, business language, and constraints of the single Bounded Context or business microservice that it represents.</span></span>

## <a name="the-domain-entity-pattern"></a><span data-ttu-id="2dcdf-109">O padrão de entidade de domínio</span><span class="sxs-lookup"><span data-stu-id="2dcdf-109">The Domain Entity pattern</span></span>

<span data-ttu-id="2dcdf-110">Entidades representam objetos de domínio e principalmente são definidas por sua identidade, continuidade e persistência ao longo do tempo e não apenas pelos atributos que compõem a eles.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-110">Entities represent domain objects and are primarily defined by their identity, continuity, and persistence over time, and not only by the attributes that comprise them.</span></span> <span data-ttu-id="2dcdf-111">Como Eric Evans afirma, "um objeto definido, basicamente, por sua identidade é denominado entidade."</span><span class="sxs-lookup"><span data-stu-id="2dcdf-111">As Eric Evans says, “an object primarily defined by its identity is called an Entity.”</span></span> <span data-ttu-id="2dcdf-112">Entidades são muito importantes no modelo de domínio, pois eles são a base para um modelo.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-112">Entities are very important in the domain model, since they are the base for a model.</span></span> <span data-ttu-id="2dcdf-113">Portanto, você deve identificar e criá-las com cuidado.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-113">Therefore, you should identify and design them carefully.</span></span>

<span data-ttu-id="2dcdf-114">*Identidade de uma entidade pode cruzar vários microservices ou contextos limitada.*</span><span class="sxs-lookup"><span data-stu-id="2dcdf-114">*An entity’s identity can cross multiple microservices or Bounded Contexts.*</span></span>

<span data-ttu-id="2dcdf-115">A mesma identidade (embora não é a mesma entidade) podem ser modelados em vários contextos limitada ou microservices.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-115">The same identity (though not the same entity) can be modeled across multiple Bounded Contexts or microservices.</span></span> <span data-ttu-id="2dcdf-116">No entanto, que não significa que a mesma entidade, com os mesmos atributos e lógica poderia ser implementada em vários contextos limitada.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-116">However, that does not imply that the same entity, with the same attributes and logic would be implemented in multiple Bounded Contexts.</span></span> <span data-ttu-id="2dcdf-117">Em vez disso, as entidades em cada contexto limitado limitam seus atributos e os comportamentos para aqueles necessários no domínio do contexto associado.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-117">Instead, entities in each Bounded Context limit their attributes and behaviors to those required in that Bounded Context’s domain.</span></span>

<span data-ttu-id="2dcdf-118">Por exemplo, a entidade de comprador talvez tenha a maioria dos atributos de uma pessoa que estão definidos na entidade no microsserviço perfil ou a identidade, incluindo a identidade do usuário.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-118">For instance, the buyer entity might have most of a person’s attributes that are defined in the user entity in the profile or identity microservice, including the identity.</span></span> <span data-ttu-id="2dcdf-119">Mas a entidade de comprador no microsserviço a ordenação pode ter menos de atributos, porque somente determinados dados comprador estão relacionados ao processo de ordem.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-119">But the buyer entity in the ordering microservice might have fewer attributes, because only certain buyer data is related to the order process.</span></span> <span data-ttu-id="2dcdf-120">O contexto de cada microsserviço ou contexto limitado afeta o seu modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-120">The context of each microservice or Bounded Context impacts its domain model.</span></span>

<span data-ttu-id="2dcdf-121">*Entidades de domínio devem implementar o comportamento, além de implementar os atributos de dados*</span><span class="sxs-lookup"><span data-stu-id="2dcdf-121">*Domain entities must implement behavior in addition to implementing data attributes*</span></span>

<span data-ttu-id="2dcdf-122">Uma entidade de domínio no DDD deve implementar a lógica do domínio ou o comportamento relacionado aos dados de entidade (o objeto acessado na memória).</span><span class="sxs-lookup"><span data-stu-id="2dcdf-122">A domain entity in DDD must implement the domain logic or behavior related to the entity data (the object accessed in memory).</span></span> <span data-ttu-id="2dcdf-123">Por exemplo, como parte de uma classe de entidade de ordem, você deve ter lógica de negócios e implementadas como métodos para tarefas como adicionar um item do pedido, a validação de dados e o cálculo do total de operações.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-123">For example, as part of an order entity class you must have business logic and operations implemented as methods for tasks such as adding an order item, data validation, and total calculation.</span></span> <span data-ttu-id="2dcdf-124">Métodos da entidade se encarregar as regras da entidade em vez de ter essas regras disseminadas por camada de aplicativo e invariáveis.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-124">The entity’s methods take care of the invariants and rules of the entity instead of having those rules spread across the application layer.</span></span>

<span data-ttu-id="2dcdf-125">Figura 9-8 mostra uma entidade de domínio que implementa não apenas atributos de dados, mas as operações ou métodos com a lógica do domínio relacionadas.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-125">Figure 9-8 shows a domain entity that implements not only data attributes but operations or methods with related domain logic.</span></span>

![](./media/image9.png)

<span data-ttu-id="2dcdf-126">**Figura 9-8**.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-126">**Figure 9-8**.</span></span> <span data-ttu-id="2dcdf-127">Exemplo de um projeto de entidade de domínio implementando dados mais comportamento</span><span class="sxs-lookup"><span data-stu-id="2dcdf-127">Example of a domain entity design implementing data plus behavior</span></span>

<span data-ttu-id="2dcdf-128">É claro que, às vezes, você pode ter entidades que não implementam qualquer lógica como parte da classe da entidade.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-128">Of course, sometimes you can have entities that do not implement any logic as part of the entity class.</span></span> <span data-ttu-id="2dcdf-129">Isso pode ocorrer em entidades filhas dentro de uma agregação se a entidade filho não tiver nenhuma lógica especial porque a maioria da lógica está definida na raiz da agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-129">This can happen in child entities within an aggregate if the child entity does not have any special logic because most of the logic is defined in the aggregate root.</span></span> <span data-ttu-id="2dcdf-130">Se você tiver um microsserviço complexas com muita lógica implementada em classes de serviço em vez de às entidades de domínio, você poderia falha no modelo de domínio anêmica, como explicado na seção a seguir.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-130">If you have a complex microservice that has a lot of logic implemented in the service classes instead of in the domain entities, you could be falling into the anemic domain model, explained in the following section.</span></span>

### <a name="rich-domain-model-versus-anemic-domain-model"></a><span data-ttu-id="2dcdf-131">Modelo de domínio avançado em comparação com o modelo de domínio anêmica</span><span class="sxs-lookup"><span data-stu-id="2dcdf-131">Rich domain model versus anemic domain model</span></span>

<span data-ttu-id="2dcdf-132">Em sua postagem [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler descreve um modelo de domínio anêmica desta forma:</span><span class="sxs-lookup"><span data-stu-id="2dcdf-132">In his post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler describes an anemic domain model this way:</span></span>

<span data-ttu-id="2dcdf-133">O sintoma básico de um modelo de domínio anêmica é que no primeiro um pouco parece que a situação real.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-133">The basic symptom of an Anemic Domain Model is that at first blush it looks like the real thing.</span></span> <span data-ttu-id="2dcdf-134">Existem objetos, muitos nomeado de acordo com os nomes no espaço de domínio e esses objetos estão conectados com o relações avançadas e a estrutura que têm modelos de domínio true.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-134">There are objects, many named after the nouns in the domain space, and these objects are connected with the rich relationships and structure that true domain models have.</span></span> <span data-ttu-id="2dcdf-135">Catch é fornecida quando você observar o comportamento e perceber que há praticamente qualquer comportamento nesses objetos, tornando-os pouco mais pacotes de getters e setters.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-135">The catch comes when you look at the behavior, and you realize that there is hardly any behavior on these objects, making them little more than bags of getters and setters.</span></span>

<span data-ttu-id="2dcdf-136">É claro que, quando você usa um modelo de domínio anêmica, esses modelos de dados serão usados de um conjunto de objetos de serviço (tradicionalmente nomeada a *camada comercial*) que capture toda a lógica de negócios ou de domínio.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-136">Of course, when you use an anemic domain model, those data models will be used from a set of service objects (traditionally named the *business layer*) which capture all the domain or business logic.</span></span> <span data-ttu-id="2dcdf-137">A camada de negócios fica na parte superior do modelo de dados e usa o modelo de dados, assim como os dados.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-137">The business layer sits on top of the data model and uses the data model just as data.</span></span>

<span data-ttu-id="2dcdf-138">O modelo de domínio anêmica é um design de estilo de procedimento.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-138">The anemic domain model is just a procedural style design.</span></span> <span data-ttu-id="2dcdf-139">Objetos de entidade anêmica não são objetos reais, porque eles não têm comportamento (métodos).</span><span class="sxs-lookup"><span data-stu-id="2dcdf-139">Anemic entity objects are not real objects because they lack behavior (methods).</span></span> <span data-ttu-id="2dcdf-140">Mantenham somente propriedades de dados e, portanto, não é orientada a objeto de design.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-140">They only hold data properties and thus it is not object-oriented design.</span></span> <span data-ttu-id="2dcdf-141">Colocando todo o comportamento de expansão em objetos de serviço (a camada de negócios) essencialmente acabar com [código espaguete](https://en.wikipedia.org/wiki/Spaghetti_code) ou [scripts de transação](https://martinfowler.com/eaaCatalog/transactionScript.html), e, portanto, você perde as vantagens que um modelo de domínio fornece.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-141">By putting all the behavior out into service objects (the business layer) you essentially end up with [spaghetti code](https://en.wikipedia.org/wiki/Spaghetti_code) or [transaction scripts](https://martinfowler.com/eaaCatalog/transactionScript.html), and therefore you lose the advantages that a domain model provides.</span></span>

<span data-ttu-id="2dcdf-142">Independentemente se o microsserviço ou contexto associado é muito simple (um serviço CRUD), o modelo de domínio anêmica na forma de objetos de entidade com apenas as propriedades de dados pode ser suficiente, e talvez não seja válido implementar os padrões mais complexos de DDD.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-142">Regardless, if your microservice or Bounded Context is very simple (a CRUD service), the anemic domain model in the form of entity objects with just data properties might be good enough, and it might not be worth implementing more complex DDD patterns.</span></span> <span data-ttu-id="2dcdf-143">Nesse caso, ele poderá ser simplesmente um modelo de persistência, porque você intencionalmente criou uma entidade com apenas os dados para fins CRUD.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-143">In that case, it will be simply a persistence model, because you have intentionally created an entity with only data for CRUD purposes.</span></span>

<span data-ttu-id="2dcdf-144">É por isso que microservices arquiteturas são perfeitas para uma abordagem de arquitetura várias dependendo de cada contexto associado.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-144">That is why microservices architectures are perfect for a multi-architectural approach depending on each Bounded Context.</span></span> <span data-ttu-id="2dcdf-145">Por exemplo, eShopOnContainers, o ordenação microsserviço implementa os padrões de DDD, mas o catálogo microsserviço, que é um serviço CRUD simples, não.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-145">For instance, in eShopOnContainers, the ordering microservice implements DDD patterns, but the catalog microservice, which is a simple CRUD service, does not.</span></span>

<span data-ttu-id="2dcdf-146">Algumas pessoas dizem que o modelo de domínio anêmica é um padrão de um.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-146">Some people say that the anemic domain model is an anti-pattern.</span></span> <span data-ttu-id="2dcdf-147">Isso realmente depende se você estiver implementando.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-147">It really depends on what you are implementing.</span></span> <span data-ttu-id="2dcdf-148">Se o microsserviço que você está criando é simples suficiente (por exemplo, um serviço CRUD), o modelo de domínio anêmica não é um antia padrão de seguir.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-148">If the microservice you are creating is simple enough (for example, a CRUD service), following the anemic domain model it is not an anti-pattern.</span></span> <span data-ttu-id="2dcdf-149">No entanto, se você precisa lidar com a complexidade do domínio do microsserviço que tem várias constantes de regras de negócio, o modelo de domínio anêmica pode ser um antipadrão do contexto associado ou microsserviço.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-149">However, if you need to tackle the complexity of a microservice’s domain that has a lot of ever-changing business rules, the anemic domain model might be an anti-pattern for that microservice or Bounded Context.</span></span> <span data-ttu-id="2dcdf-150">Nesse caso, criando-o como um conjunto avançado modelo com entidades que contém dados mais comportamento, bem como implementar os padrões DDD adicionais (agregações, objetos de valor, etc.) pode ter enormes benefícios para o sucesso a longo prazo de tal um microsserviço.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-150">In that case, designing it as a rich model with entities containing data plus behavior as well as implementing additional DDD patterns (aggregates, value objects, etc.) might have huge benefits for the long-term success of such a microservice.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="2dcdf-151">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="2dcdf-151">Additional resources</span></span>

-   <span data-ttu-id="2dcdf-152">**DevIQ. Entidade de domínio**
    [*http://deviq.com/entity/*](http://deviq.com/entity/)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-152">**DevIQ. Domain Entity**
[*http://deviq.com/entity/*](http://deviq.com/entity/)</span></span>

-   <span data-ttu-id="2dcdf-153">**Martin Fowler. O modelo de domínio**
    [*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-153">**Martin Fowler. The Domain Model**
[*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span></span>

-   <span data-ttu-id="2dcdf-154">**Martin Fowler. O modelo de domínio anêmica**</span><span class="sxs-lookup"><span data-stu-id="2dcdf-154">**Martin Fowler. The Anemic Domain Model**</span></span>

    <span data-ttu-id="2dcdf-155"><https://martinfowler.com/bliki/AnemicDomainModel.HTML></span><span class="sxs-lookup"><span data-stu-id="2dcdf-155"><https://martinfowler.com/bliki/AnemicDomainModel.html></span></span>

### <a name="the-value-object-pattern"></a><span data-ttu-id="2dcdf-156">O padrão de objeto de valor</span><span class="sxs-lookup"><span data-stu-id="2dcdf-156">The Value Object pattern</span></span>

<span data-ttu-id="2dcdf-157">Conforme observado a Eric Evans, "muitos objetos não possuem identidade conceitual.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-157">As Eric Evans has noted, “Many objects do not have conceptual identity.</span></span> <span data-ttu-id="2dcdf-158">Esses objetos descrevem a certas características de um ponto."</span><span class="sxs-lookup"><span data-stu-id="2dcdf-158">These objects describe certain characteristics of a thing.”</span></span>

<span data-ttu-id="2dcdf-159">Uma entidade requer uma identidade, mas há muitos objetos em um sistema que não, como o padrão do objeto de valor.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-159">An entity requires an identity, but there are many objects in a system that do not, like the Value Object pattern.</span></span> <span data-ttu-id="2dcdf-160">Um objeto de valor é um objeto com nenhuma identidade conceitual que descreve um aspecto de domínio.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-160">A value object is an object with no conceptual identity that describes a domain aspect.</span></span> <span data-ttu-id="2dcdf-161">Esses são objetos que você cria uma instância para representar os elementos de design que apenas temporariamente lhe interessam.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-161">These are objects that you instantiate to represent design elements that only concern you temporarily.</span></span> <span data-ttu-id="2dcdf-162">Você gosta *que* , não são *que* estiverem.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-162">You care about *what* they are, not *who* they are.</span></span> <span data-ttu-id="2dcdf-163">Exemplos incluem números e cadeias de caracteres, mas também podem ser conceitos de nível superior como grupos de atributos.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-163">Examples include numbers and strings, but can also be higher-level concepts like groups of attributes.</span></span>

<span data-ttu-id="2dcdf-164">Algo que é uma entidade em um microsserviço não pode ser uma entidade em outro microsserviço, como no segundo caso, o contexto associado pode ter um significado diferente.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-164">Something that is an entity in a microservice might not be an entity in another microservice, because in the second case, the Bounded Context might have a different meaning.</span></span> <span data-ttu-id="2dcdf-165">Por exemplo, um endereço em um aplicativo de comércio eletrônico pode não ter uma identidade, desde que ele pode representar apenas um grupo de atributos de perfil do cliente para uma pessoa ou empresa.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-165">For example, an address in an e-commerce application might not have an identity at all, since it might only represent a group of attributes of the customer’s profile for a person or company.</span></span> <span data-ttu-id="2dcdf-166">Nesse caso, o endereço deve ser classificado como um objeto de valor.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-166">In this case, the address should be classified as a value object.</span></span> <span data-ttu-id="2dcdf-167">No entanto, em um aplicativo para uma empresa de utilitário de energia elétrica, o endereço do cliente pode ser importante para o domínio da empresa.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-167">However, in an application for an electric power utility company, the customer address could be important for the business domain.</span></span> <span data-ttu-id="2dcdf-168">Portanto, o endereço deve ter uma identidade para que o sistema de cobrança pode ser vinculado diretamente para o endereço.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-168">Therefore, the address must have an identity so the billing system can be directly linked to the address.</span></span> <span data-ttu-id="2dcdf-169">Nesse caso, um endereço deve ser classificado como uma entidade de domínio.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-169">In that case, an address should be classified as a domain entity.</span></span>

<span data-ttu-id="2dcdf-170">Uma pessoa com um nome e sobrenome geralmente é uma entidade como uma pessoa tem identidade, mesmo se o nome e sobrenome coincidirem com outro conjunto de valores, como se esses nomes também se refere a uma pessoa diferente.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-170">A person with a name and surname is usually an entity because a person has identity, even if the name and surname coincide with another set of values, such as if those names also refers to a different person.</span></span>

<span data-ttu-id="2dcdf-171">Objetos de valor são difíceis de gerenciar em bancos de dados relacionais e ORMs como EF, enquanto o documento orientado a bancos de dados são mais fáceis de implementar e usar.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-171">Value objects are hard to manage in relational databases and ORMs like EF, whereas in document oriented databases they are easier to implement and use.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="2dcdf-172">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="2dcdf-172">Additional resources</span></span>

-   <span data-ttu-id="2dcdf-173">**Martin Fowler. Padrão de objeto de valor**
    [*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-173">**Martin Fowler. Value Object pattern**
[*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span></span>

-   <span data-ttu-id="2dcdf-174">**Valor de objeto**
    [*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-174">**Value Object**
[*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span></span>

-   <span data-ttu-id="2dcdf-175">**Valor de objetos no Driven Development**
    [*https://leanpub.com/tdd-ebook/read\#leanpub-auto-objetos de valor*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-175">**Value Objects in Test-Driven Development**
[*https://leanpub.com/tdd-ebook/read\#leanpub-auto-value-objects*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span></span>

-   <span data-ttu-id="2dcdf-176">**Eric Evans. Design controlado por domínio: Lidar com a complexidade do Centro de Software.**</span><span class="sxs-lookup"><span data-stu-id="2dcdf-176">**Eric Evans. Domain-Driven Design: Tackling Complexity in the Heart of Software.**</span></span> <span data-ttu-id="2dcdf-177">(Livro; inclui uma discussão sobre objetos de valor) [ *https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-177">(Book; includes a discussion of value objects) [*https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span></span>

### <a name="the-aggregate-pattern"></a><span data-ttu-id="2dcdf-178">O padrão de agregação</span><span class="sxs-lookup"><span data-stu-id="2dcdf-178">The Aggregate pattern</span></span>

<span data-ttu-id="2dcdf-179">Um modelo de domínio contém clusters de entidades de dados diferentes e os processos que podem controlar uma área significativa de funcionalidades, como inventário ou a realização de ordem.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-179">A domain model contains clusters of different data entities and processes that can control a significant area of functionality, such as order fulfilment or inventory.</span></span> <span data-ttu-id="2dcdf-180">Uma unidade DDD mais refinada é a agregação, que descreve um cluster ou o grupo de entidades e os comportamentos que podem ser tratados como uma unidade coesa.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-180">A more fine-grained DDD unit is the aggregate, which describes a cluster or group of entities and behaviors that can be treated as a cohesive unit.</span></span>

<span data-ttu-id="2dcdf-181">Normalmente, você define uma agregação com base em transações que você precisa.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-181">You usually define an aggregate based on the transactions that you need.</span></span> <span data-ttu-id="2dcdf-182">Um exemplo clássico é um pedido que também contém uma lista de itens do pedido.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-182">A classic example is an order that also contains a list of order items.</span></span> <span data-ttu-id="2dcdf-183">Geralmente, um item do pedido será uma entidade.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-183">An order item will usually be an entity.</span></span> <span data-ttu-id="2dcdf-184">Mas é uma entidade filho dentro a agregação de ordem, que também conterá a entidade pedido como sua entidade raiz, geralmente chamada de uma raiz de agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-184">But it will be a child entity within the order aggregate, which will also contain the order entity as its root entity, typically called an aggregate root.</span></span>

<span data-ttu-id="2dcdf-185">Pode ser difícil identificar agregações.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-185">Identifying aggregates can be hard.</span></span> <span data-ttu-id="2dcdf-186">Uma agregação é um grupo de objetos que devem ser consistentes em conjunto, mas apenas não é possível selecionar um grupo de objetos e rotular uma agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-186">An aggregate is a group of objects that must be consistent together, but you cannot just pick a group of objects and label them an aggregate.</span></span> <span data-ttu-id="2dcdf-187">Você deve iniciar com um conceito de domínio e pensar sobre as entidades que são usadas nas transações mais comuns relacionadas a esse conceito.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-187">You must start with a domain concept and think about the entities that are used in the most common transactions related to that concept.</span></span> <span data-ttu-id="2dcdf-188">As entidades que precisam ser transacionalmente consistente são o que forma uma agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-188">Those entities that need to be transactionally consistent are what forms an aggregate.</span></span> <span data-ttu-id="2dcdf-189">Pensar sobre as operações de transação provavelmente é a melhor maneira de identificar as agregações.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-189">Thinking about transaction operations is probably the best way to identify aggregates.</span></span>

### <a name="the-aggregate-root-or-root-entity-pattern"></a><span data-ttu-id="2dcdf-190">O padrão de raiz de agregação ou entidade raiz</span><span class="sxs-lookup"><span data-stu-id="2dcdf-190">The Aggregate Root or Root Entity pattern</span></span>

<span data-ttu-id="2dcdf-191">Uma agregação é composta pelo menos uma entidade: a raiz de agregação, também chamada entidade raiz ou ientity primário.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-191">An aggregate is composed of at least one entity: the aggregate root, also called root entity or primary ientity.</span></span> <span data-ttu-id="2dcdf-192">Além disso, ele pode ter várias entidades filhas e objetos de valor, com todas as entidades e objetos trabalham juntas para implementar transações e comportamento necessário.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-192">Additionally, it can have multiple child entities and value objects, with all entities and objects working together to implement required behavior and transactions.</span></span>

<span data-ttu-id="2dcdf-193">A finalidade de uma raiz agregada é garantir a consistência da agregação; ele deve ser o único ponto de entrada para atualizações para a agregação através dos métodos ou operações de classe raiz em conjunto.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-193">The purpose of an aggregate root is to ensure the consistency of the aggregate; it should be the only entry point for updates to the aggregate through methods or operations in the aggregate root class.</span></span> <span data-ttu-id="2dcdf-194">Você deve fazer alterações às entidades a agregação apenas por meio da raiz de agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-194">You should make changes to entities within the aggregate only via the aggregate root.</span></span> <span data-ttu-id="2dcdf-195">É guardião de consistência da agregação, levando em conta todas as regras de consistência que talvez você precise estar de acordo com seu juntos e invariáveis.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-195">It is the aggregate’s consistency guardian, taking into account all the invariants and consistency rules you might need to comply with in your aggregate.</span></span> <span data-ttu-id="2dcdf-196">Se você alterar um objeto de entidade ou um valor do filho independentemente, a raiz de agregação não pode garantir que a agregação está em um estado válido.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-196">If you change a child entity or value object independently, the aggregate root cannot ensure that the aggregate is in a valid state.</span></span> <span data-ttu-id="2dcdf-197">Seria parecida com uma tabela com um segmento flexível.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-197">It would be like a table with a loose leg.</span></span> <span data-ttu-id="2dcdf-198">Mantendo a consistência é o principal objetivo da raiz da agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-198">Maintaining consistency is the main purpose of the aggregate root.</span></span>

<span data-ttu-id="2dcdf-199">Na Figura 9-9, você pode ver as agregações de exemplo como o comprador de agregação, que contém uma única entidade (a raiz de agregação comprador).</span><span class="sxs-lookup"><span data-stu-id="2dcdf-199">In Figure 9-9, you can see sample aggregates like the buyer aggregate, which contains a single entity (the aggregate root Buyer).</span></span> <span data-ttu-id="2dcdf-200">A agregação de ordem contém várias entidades e um objeto de valor.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-200">The order aggregate contains multiple entities and a value object.</span></span>

![](./media/image10.png)

<span data-ttu-id="2dcdf-201">**Figura 9-9**.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-201">**Figure 9-9**.</span></span> <span data-ttu-id="2dcdf-202">Exemplo de agregações com várias ou únicas entidades</span><span class="sxs-lookup"><span data-stu-id="2dcdf-202">Example of aggregates with multiple or single entities</span></span>

<span data-ttu-id="2dcdf-203">Observe que a agregação de comprador pode ter entidades filho adicionais, dependendo de seu domínio, como ocorre o ordenação microsserviço no aplicativo eShopOnContainers referência.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-203">Note that the Buyer aggregate could have additional child entities, depending on your domain, as it does in the ordering microservice in the eShopOnContainers reference application.</span></span> <span data-ttu-id="2dcdf-204">Figura 9-9 apenas ilustra um caso em que o comprador tem uma única entidade, como um exemplo de uma agregação que contém somente uma raiz de agregação.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-204">Figure 9-9 just illustrates a case in which the buyer has a single entity, as an example of an aggregate that contains only an aggregate root.</span></span>

<span data-ttu-id="2dcdf-205">Para manter a separação de agregações e manter limites claros entre eles, é uma prática recomendada em um modelo de domínio DDD para impedir a navegação direta entre agregações e tendo apenas o campo de chave estrangeira (FK), conforme implementado o [ Ordenação de modelo de domínio de microsserviço](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) em eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-205">In order to maintain separation of aggregates and keep clear boundaries between them, it is a good practice in a DDD domain model to disallow direct navigation between aggregates and only having the foreign key (FK) field, as implemented in the [Ordering microservice domain model](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) in eShopOnContainers.</span></span> <span data-ttu-id="2dcdf-206">A entidade de ordem tem apenas um campo FK para o comprador, mas não uma propriedade de navegação principal EF, conforme mostrado no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="2dcdf-206">The Order entity only has a FK field for the buyer, but not an EF Core navigation property, as shown in the following code:</span></span>

```csharp
public class Order : Entity, IAggregateRoot
{
    private DateTime _orderDate;
    public Address Address { get; private set; }
    private int? _buyerId; //FK pointing to a different aggregate root
    public OrderStatus OrderStatus { get; private set; }
}
```

<span data-ttu-id="2dcdf-207">Identificando e trabalhar com agregações requer pesquisa e experiência.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-207">Identifying and working with aggregates requires research and experience.</span></span> <span data-ttu-id="2dcdf-208">Para obter mais informações, consulte a lista de recursos adicionais a seguir.</span><span class="sxs-lookup"><span data-stu-id="2dcdf-208">For more information, see the following Additional resources list.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="2dcdf-209">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="2dcdf-209">Additional resources</span></span>

-   <span data-ttu-id="2dcdf-210">**Vaughn Vernon. Design de agregação eficaz - parte i: uma única agregação de modelagem**
    [*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_ensaio\_ AGREGAÇÕES\_parte\_pdf 1.*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-210">**Vaughn Vernon. Effective Aggregate Design - Part I: Modeling a Single Aggregate**
[*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_ESSAY\_AGGREGATES\_PART\_1.pdf*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span></span>

-   <span data-ttu-id="2dcdf-211">**Vaughn Vernon. Design de agregação eficaz - parte II: Fazendo agregações funcionam em conjunto**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf>*</span><span class="sxs-lookup"><span data-stu-id="2dcdf-211">**Vaughn Vernon. Effective Aggregate Design - Part II: Making Aggregates Work Together**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf> *</span></span>

-   <span data-ttu-id="2dcdf-212">**Vaughn Vernon. Design de agregação eficaz - parte III: Obtenção de informações por meio da descoberta**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf>*</span><span class="sxs-lookup"><span data-stu-id="2dcdf-212">**Vaughn Vernon. Effective Aggregate Design - Part III: Gaining Insight Through Discovery**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf> *</span></span>

-   <span data-ttu-id="2dcdf-213">**Sergey Grybniak. Padrões de Design táticas DDD**
    [*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-213">**Sergey Grybniak. DDD Tactical Design Patterns**
[*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span></span>

-   <span data-ttu-id="2dcdf-214">**Carlos Richardson. Desenvolvendo Microservices transacional usando agregações**
    [*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-214">**Chris Richardson. Developing Transactional Microservices Using Aggregates**
[*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span></span>

-   <span data-ttu-id="2dcdf-215">**DevIQ. O padrão de agregação**
    [*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-215">**DevIQ. The Aggregate pattern**
[*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="2dcdf-216">[Anterior] (ddd-orientado-microservice.md) [Avançar] (net-core-microsserviço-domínio-model.md)</span><span class="sxs-lookup"><span data-stu-id="2dcdf-216">[Previous] (ddd-oriented-microservice.md) [Next] (net-core-microservice-domain-model.md)</span></span>
