---
title: 'Como: Inspecionar o conteúdo do conjunto usando metadadosLoadContext'
description: Saiba como usar metadataLoadContext, que é uma API que permite carregar conjuntos .NET para fins de inspeção.
author: MSDN-WhiteKnight
ms.date: 03/10/2020
ms.technology: dotnet-standard
ms.openlocfilehash: a782b2db4fb62cfaedaa6768e2131bda6bec864c
ms.sourcegitcommit: b75a45f0cfe012b71b45dd9bf723adf32369d40c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/24/2020
ms.locfileid: "80229297"
---
# <a name="how-to-inspect-assembly-contents-using-metadataloadcontext"></a><span data-ttu-id="b4e0d-103">Como: Inspecionar o conteúdo do conjunto usando metadadosLoadContext</span><span class="sxs-lookup"><span data-stu-id="b4e0d-103">How to: Inspect assembly contents using MetadataLoadContext</span></span>

<span data-ttu-id="b4e0d-104">A API de reflexão no .NET por padrão permite que os desenvolvedores inspecionem o conteúdo dos conjuntos carregados no contexto principal de execução.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-104">The reflection API in .NET by default enables developers to inspect the contents of assemblies loaded into the main execution context.</span></span> <span data-ttu-id="b4e0d-105">No entanto, às vezes não é possível carregar um conjunto no contexto de execução, por exemplo, porque ele foi compilado para outra plataforma ou arquitetura de processador, ou é um conjunto de [referência](reference-assemblies.md).</span><span class="sxs-lookup"><span data-stu-id="b4e0d-105">However, sometimes it isn't possible to load an assembly into the execution context, for example, because it was compiled for another platform or processor architecture, or it's a [reference assembly](reference-assemblies.md).</span></span> <span data-ttu-id="b4e0d-106">A <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API permite carregar e inspecionar tais conjuntos.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-106">The <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API allows you to load and inspect such assemblies.</span></span> <span data-ttu-id="b4e0d-107">Os conjuntos carregados no <xref:System.Reflection.MetadataLoadContext> são tratados apenas como metadados, ou seja, você pode examinar os tipos no conjunto, mas não pode executar nenhum código contido nele.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-107">Assemblies loaded into the <xref:System.Reflection.MetadataLoadContext> are treated only as metadata, that is, you can examine types in the assembly, but you can't execute any code contained in it.</span></span> <span data-ttu-id="b4e0d-108">Ao contrário do contexto <xref:System.Reflection.MetadataLoadContext> de execução principal, o não carrega automaticamente dependências do diretório atual; em vez disso, ele usa <xref:System.Reflection.MetadataAssemblyResolver> a lógica de vinculação personalizada fornecida pelo passado para ele.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-108">Unlike the main execution context, the <xref:System.Reflection.MetadataLoadContext> doesn't automatically load dependencies from the current directory; instead it uses the custom binding logic provided by the <xref:System.Reflection.MetadataAssemblyResolver> passed to it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b4e0d-109">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="b4e0d-109">Prerequisites</span></span>

<span data-ttu-id="b4e0d-110">Para <xref:System.Reflection.MetadataLoadContext>usar, instale o pacote [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) NuGet.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-110">To use <xref:System.Reflection.MetadataLoadContext>, install the [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) NuGet package.</span></span> <span data-ttu-id="b4e0d-111">Ele é suportado em qualquer quadro de destino compatível com .NET Standard 2.0, por exemplo, .NET Core 2.0 ou .NET Framework 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-111">It is supported on any .NET Standard 2.0-compliant target framework, for example, .NET Core 2.0 or .NET Framework 4.6.1.</span></span>

## <a name="create-metadataassemblyresolver-for-metadataloadcontext"></a><span data-ttu-id="b4e0d-112">Criar metadadosResolveresolver para MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b4e0d-112">Create MetadataAssemblyResolver for MetadataLoadContext</span></span>

<span data-ttu-id="b4e0d-113">Criando <xref:System.Reflection.MetadataLoadContext> as obrigações fornecendo a instância do <xref:System.Reflection.MetadataAssemblyResolver>.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-113">Creating the <xref:System.Reflection.MetadataLoadContext> requires providing the instance of the <xref:System.Reflection.MetadataAssemblyResolver>.</span></span> <span data-ttu-id="b4e0d-114">A maneira mais simples de fornecer <xref:System.Reflection.PathAssemblyResolver>um é usar o , que resolve assembléias a partir da coleção dada de strings de caminho de montagem.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-114">The simplest way to provide one is to use the <xref:System.Reflection.PathAssemblyResolver>, which resolves assemblies from the given collection of assembly path strings.</span></span> <span data-ttu-id="b4e0d-115">Esta coleção, além de montagens que você deseja inspecionar diretamente, também deve incluir todas as dependências necessárias.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-115">This collection, besides assemblies you want to inspect directly, should also include all needed dependencies.</span></span> <span data-ttu-id="b4e0d-116">Por exemplo, para ler o atributo personalizado localizado em um conjunto externo, você deve incluir esse conjunto ou uma exceção será lançada.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-116">For example, to read the custom attribute located in an external assembly, you should include that assembly or an exception will be thrown.</span></span> <span data-ttu-id="b4e0d-117">Na maioria dos casos, você deve incluir pelo menos o *conjunto central,* ou <xref:System.Object?displayProperty=nameWithType>seja, o conjunto contendo tipos de sistema incorporados, tais como .</span><span class="sxs-lookup"><span data-stu-id="b4e0d-117">In most cases, you should include at least the *core assembly*, that is, the assembly containing built-in system types, such as <xref:System.Object?displayProperty=nameWithType>.</span></span> <span data-ttu-id="b4e0d-118">O código a seguir <xref:System.Reflection.PathAssemblyResolver> mostra como criar o uso da coleção que consiste no conjunto inspecionado e no conjunto central do tempo de execução atual:</span><span class="sxs-lookup"><span data-stu-id="b4e0d-118">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and the current runtime's core assembly:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CoreAssembly)]

<span data-ttu-id="b4e0d-119">Se você precisar de acesso a todos os tipos de BCL, você pode incluir todos os conjuntos de tempo de execução na coleção.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-119">If you need access to all BCL types, you can include all runtime assemblies in the collection.</span></span> <span data-ttu-id="b4e0d-120">O código a seguir <xref:System.Reflection.PathAssemblyResolver> mostra como criar o uso da coleção constituída pelo conjunto inspecionado e todas as assembléias do tempo de execução atual:</span><span class="sxs-lookup"><span data-stu-id="b4e0d-120">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and all assemblies of the current runtime:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#RuntimeAssemblies)]

## <a name="create-metadataloadcontext"></a><span data-ttu-id="b4e0d-121">Criar metadadosLoadContext</span><span class="sxs-lookup"><span data-stu-id="b4e0d-121">Create MetadataLoadContext</span></span>

<span data-ttu-id="b4e0d-122">Para criar <xref:System.Reflection.MetadataLoadContext>o , <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>invoque seu construtor <xref:System.Reflection.MetadataAssemblyResolver> , passando o previamente criado como o primeiro parâmetro e o nome de montagem do núcleo como o segundo parâmetro.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-122">To create the <xref:System.Reflection.MetadataLoadContext>, invoke its constructor <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>, passing the previously created <xref:System.Reflection.MetadataAssemblyResolver> as the first parameter and the core assembly name as the second parameter.</span></span> <span data-ttu-id="b4e0d-123">Você pode omitir o nome do conjunto principal, nesse caso, o construtor tentará usar nomes padrão: "mscorlib", "System.Runtime" ou "netstandard".</span><span class="sxs-lookup"><span data-stu-id="b4e0d-123">You can omit the core assembly name, in which case the constructor will attempt to use default names: "mscorlib", "System.Runtime", or "netstandard".</span></span>

<span data-ttu-id="b4e0d-124">Depois de criar o contexto, você pode carregar conjuntos nele <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>usando métodos como .</span><span class="sxs-lookup"><span data-stu-id="b4e0d-124">After you've created the context, you can load assemblies into it using methods such as <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span></span> <span data-ttu-id="b4e0d-125">Você pode usar todas as APIs de reflexão em conjuntos carregados, exceto aqueles que envolvem execução de código.</span><span class="sxs-lookup"><span data-stu-id="b4e0d-125">You can use all reflection APIs on loaded assemblies except ones that involve code execution.</span></span> <span data-ttu-id="b4e0d-126">O <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> método envolve a execução de construtores, então use o <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> método em <xref:System.Reflection.MetadataLoadContext>vez disso quando precisar examinar atributos personalizados no .</span><span class="sxs-lookup"><span data-stu-id="b4e0d-126">The <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> method does involve the execution of constructors, so use the <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> method instead when you need to examine custom attributes in the <xref:System.Reflection.MetadataLoadContext>.</span></span>

<span data-ttu-id="b4e0d-127">A seguinte amostra <xref:System.Reflection.MetadataLoadContext>de código cria, carrega o conjunto nele e produz atributos de montagem no console:</span><span class="sxs-lookup"><span data-stu-id="b4e0d-127">The following code sample creates <xref:System.Reflection.MetadataLoadContext>, loads the assembly into it, and outputs assembly attributes into the console:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CreateContext)]

## <a name="example"></a><span data-ttu-id="b4e0d-128">Exemplo</span><span class="sxs-lookup"><span data-stu-id="b4e0d-128">Example</span></span>

<span data-ttu-id="b4e0d-129">Para obter um exemplo de código completo, consulte [Inspecione o conteúdo do conjunto usando MetadataLoadContext](https://docs.microsoft.com/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span><span class="sxs-lookup"><span data-stu-id="b4e0d-129">For a complete code example, see [Inspect assembly contents using MetadataLoadContext](https://docs.microsoft.com/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span></span>
