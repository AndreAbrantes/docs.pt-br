---
title: "Exceções em threads gerenciados"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- unhandled exceptions,in managed threads
- threading [.NET Framework],unhandled exceptions
- threading [.NET Framework],exceptions in managed threads
- managed threading
ms.assetid: 11294769-2e89-43cb-890e-ad4ad79cfbee
caps.latest.revision: "9"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: ebb5559d300bb3db34fe640e87eb8b9e67931561
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="exceptions-in-managed-threads"></a><span data-ttu-id="54cde-102">Exceções em threads gerenciados</span><span class="sxs-lookup"><span data-stu-id="54cde-102">Exceptions in Managed Threads</span></span>
<span data-ttu-id="54cde-103">Iniciando com o .NET Framework versão 2.0, o common language runtime permite mais exceções sem tratamento em threads para continuar naturalmente.</span><span class="sxs-lookup"><span data-stu-id="54cde-103">Starting with the .NET Framework version 2.0, the common language runtime allows most unhandled exceptions in threads to proceed naturally.</span></span> <span data-ttu-id="54cde-104">Na maioria dos casos, isso significa que a exceção não tratada faz com que o aplicativo seja finalizado.</span><span class="sxs-lookup"><span data-stu-id="54cde-104">In most cases this means that the unhandled exception causes the application to terminate.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="54cde-105">Essa é uma alteração significativa das versões do .NET Framework 1.0 e 1.1, que fornecem uma barreira para exceções não tratadas muitos — por exemplo, exceções não tratadas em threads de pool.</span><span class="sxs-lookup"><span data-stu-id="54cde-105">This is a significant change from the .NET Framework versions 1.0 and 1.1, which provide a backstop for many unhandled exceptions — for example, unhandled exceptions in thread pool threads.</span></span> <span data-ttu-id="54cde-106">Consulte [alterar de versões anteriores](#ChangeFromPreviousVersions) mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="54cde-106">See [Change from Previous Versions](#ChangeFromPreviousVersions) later in this topic.</span></span>  
  
 <span data-ttu-id="54cde-107">O common language runtime fornece exceções uma barreira para determinados sem tratamento que são usados para controlar o fluxo do programa:</span><span class="sxs-lookup"><span data-stu-id="54cde-107">The common language runtime provides a backstop for certain unhandled exceptions that are used for controlling program flow:</span></span>  
  
-   <span data-ttu-id="54cde-108">Um <xref:System.Threading.ThreadAbortException> é gerada em um thread porque <xref:System.Threading.Thread.Abort%2A> foi chamado.</span><span class="sxs-lookup"><span data-stu-id="54cde-108">A <xref:System.Threading.ThreadAbortException> is thrown in a thread because <xref:System.Threading.Thread.Abort%2A> was called.</span></span>  
  
-   <span data-ttu-id="54cde-109">Um <xref:System.AppDomainUnloadedException> é gerada em um thread porque o domínio de aplicativo no qual o thread está em execução está sendo descarregado.</span><span class="sxs-lookup"><span data-stu-id="54cde-109">An <xref:System.AppDomainUnloadedException> is thrown in a thread because the application domain in which the thread is executing is being unloaded.</span></span>  
  
-   <span data-ttu-id="54cde-110">O common language runtime ou um processo de host encerra o thread lançando uma exceção interna.</span><span class="sxs-lookup"><span data-stu-id="54cde-110">The common language runtime or a host process terminates the thread by throwing an internal exception.</span></span>  
  
 <span data-ttu-id="54cde-111">Se qualquer uma dessas exceções são sem tratamento em threads criados pelo common language runtime, a exceção encerra o thread, mas o common language runtime não permitir a exceção prossiga.</span><span class="sxs-lookup"><span data-stu-id="54cde-111">If any of these exceptions are unhandled in threads created by the common language runtime, the exception terminates the thread, but the common language runtime does not allow the exception to proceed further.</span></span>  
  
 <span data-ttu-id="54cde-112">Se essas exceções sem tratamento no thread principal ou em threads que inseriu o tempo de execução de código não gerenciado, eles prosseguir normalmente, resultando no encerramento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="54cde-112">If these exceptions are unhandled in the main thread, or in threads that entered the runtime from unmanaged code, they proceed normally, resulting in termination of the application.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="54cde-113">É possível que o tempo de execução lançar uma exceção não tratada, antes de qualquer código gerenciado tenha tido a oportunidade de instalar um manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="54cde-113">It is possible for the runtime to throw an unhandled exception before any managed code has had a chance to install an exception handler.</span></span> <span data-ttu-id="54cde-114">Mesmo se o código gerenciado não tivesse nenhuma possibilidade de manipular tal exceção, a exceção é permitida para prosseguir naturalmente.</span><span class="sxs-lookup"><span data-stu-id="54cde-114">Even though managed code had no chance to handle such an exception, the exception is allowed to proceed naturally.</span></span>  
  
## <a name="exposing-threading-problems-during-development"></a><span data-ttu-id="54cde-115">Expondo Threading problemas durante o desenvolvimento</span><span class="sxs-lookup"><span data-stu-id="54cde-115">Exposing Threading Problems During Development</span></span>  
 <span data-ttu-id="54cde-116">Quando os threads podem falhar em modo silencioso, sem encerrar o aplicativo, graves problemas de programação podem não ser detectados.</span><span class="sxs-lookup"><span data-stu-id="54cde-116">When threads are allowed to fail silently, without terminating the application, serious programming problems can go undetected.</span></span> <span data-ttu-id="54cde-117">Este é um problema específico para serviços e outros aplicativos que são executados por longos períodos.</span><span class="sxs-lookup"><span data-stu-id="54cde-117">This is a particular problem for services and other applications which run for extended periods.</span></span> <span data-ttu-id="54cde-118">Como threads falhar, estado do programa gradualmente torna-se corrompido.</span><span class="sxs-lookup"><span data-stu-id="54cde-118">As threads fail, program state gradually becomes corrupted.</span></span> <span data-ttu-id="54cde-119">Pode degradar o desempenho do aplicativo ou o aplicativo pode travar.</span><span class="sxs-lookup"><span data-stu-id="54cde-119">Application performance may degrade, or the application might hang.</span></span>  
  
 <span data-ttu-id="54cde-120">Permitir exceções sem tratamento em threads para continuar naturalmente, até que o sistema operacional encerra o programa, expõe esses problemas durante o desenvolvimento e teste.</span><span class="sxs-lookup"><span data-stu-id="54cde-120">Allowing unhandled exceptions in threads to proceed naturally, until the operating system terminates the program, exposes such problems during development and testing.</span></span> <span data-ttu-id="54cde-121">Relatórios de erros no programa encerramentos suporte a depuração.</span><span class="sxs-lookup"><span data-stu-id="54cde-121">Error reports on program terminations support debugging.</span></span>  
  
<a name="ChangeFromPreviousVersions"></a>   
## <a name="change-from-previous-versions"></a><span data-ttu-id="54cde-122">Alterar de versões anteriores</span><span class="sxs-lookup"><span data-stu-id="54cde-122">Change from Previous Versions</span></span>  
 <span data-ttu-id="54cde-123">A alteração mais significativa se refere ao threads gerenciados.</span><span class="sxs-lookup"><span data-stu-id="54cde-123">The most significant change pertains to managed threads.</span></span> <span data-ttu-id="54cde-124">Nas versões do .NET Framework 1.0 e 1.1, o common language runtime fornece uma barreira para exceções não tratadas nas seguintes situações:</span><span class="sxs-lookup"><span data-stu-id="54cde-124">In the .NET Framework versions 1.0 and 1.1, the common language runtime provides a backstop for unhandled exceptions in the following situations:</span></span>  
  
-   <span data-ttu-id="54cde-125">Não há nenhum algo como uma exceção sem tratamento em um pool de threads.</span><span class="sxs-lookup"><span data-stu-id="54cde-125">There is no such thing as an unhandled exception on a thread pool thread.</span></span> <span data-ttu-id="54cde-126">Quando uma tarefa gera uma exceção que não processa, o tempo de execução imprime o rastreamento de pilha de exceção para o console e, em seguida, retorna o thread para o pool de threads.</span><span class="sxs-lookup"><span data-stu-id="54cde-126">When a task throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then returns the thread to the thread pool.</span></span>  
  
-   <span data-ttu-id="54cde-127">Existe sem uma exceção sem tratamento em um thread criado com o <xref:System.Threading.Thread.Start%2A> método o <xref:System.Threading.Thread> classe.</span><span class="sxs-lookup"><span data-stu-id="54cde-127">There is no such thing as an unhandled exception on a thread created with the <xref:System.Threading.Thread.Start%2A> method of the <xref:System.Threading.Thread> class.</span></span> <span data-ttu-id="54cde-128">Quando o código em execução em um thread tal gera uma exceção que não processa, o tempo de execução imprime o rastreamento de pilha de exceção para o console e, em seguida, encerra normalmente o thread.</span><span class="sxs-lookup"><span data-stu-id="54cde-128">When code running on such a thread throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then gracefully terminates the thread.</span></span>  
  
-   <span data-ttu-id="54cde-129">Não há nenhum algo como uma exceção sem tratamento no thread do finalizador.</span><span class="sxs-lookup"><span data-stu-id="54cde-129">There is no such thing as an unhandled exception on the finalizer thread.</span></span> <span data-ttu-id="54cde-130">Quando um finalizador gera uma exceção que não processa, o tempo de execução imprime o rastreamento de pilha de exceção para o console e, em seguida, permite que o thread do finalizador continuar a execução finalizadores.</span><span class="sxs-lookup"><span data-stu-id="54cde-130">When a finalizer throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then allows the finalizer thread to resume running finalizers.</span></span>  
  
 <span data-ttu-id="54cde-131">O status de primeiro plano ou plano de fundo de um thread gerenciado não afeta esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="54cde-131">The foreground or background status of a managed thread does not affect this behavior.</span></span>  
  
 <span data-ttu-id="54cde-132">Para obter exceções sem tratamento em threads de origem em código não gerenciado, a diferença é mais sutil.</span><span class="sxs-lookup"><span data-stu-id="54cde-132">For unhandled exceptions on threads originating in unmanaged code, the difference is more subtle.</span></span> <span data-ttu-id="54cde-133">A caixa de diálogo do tempo de execução de anexação JIT impede a caixa de diálogo do sistema operacional para exceções gerenciadas ou nativo exceções em threads que passaram por código nativo.</span><span class="sxs-lookup"><span data-stu-id="54cde-133">The runtime JIT-attach dialog preempts the operating system dialog for managed exceptions or native exceptions on threads that have passed through native code.</span></span> <span data-ttu-id="54cde-134">O processo termina em todos os casos.</span><span class="sxs-lookup"><span data-stu-id="54cde-134">The process terminates in all cases.</span></span>  
  
### <a name="migrating-code"></a><span data-ttu-id="54cde-135">Migrando o código</span><span class="sxs-lookup"><span data-stu-id="54cde-135">Migrating Code</span></span>  
 <span data-ttu-id="54cde-136">Em geral, a alteração irá expor anteriormente não reconhecido de problemas de programação para que eles possam ser corrigidos.</span><span class="sxs-lookup"><span data-stu-id="54cde-136">In general, the change will expose previously unrecognized programming problems so that they can be fixed.</span></span> <span data-ttu-id="54cde-137">Em alguns casos, no entanto, os programadores podem aproveitam a proteção em tempo de execução, por exemplo, para encerrar threads.</span><span class="sxs-lookup"><span data-stu-id="54cde-137">In some cases, however, programmers might have taken advantage of the runtime backstop, for example to terminate threads.</span></span> <span data-ttu-id="54cde-138">Dependendo da situação, eles devem considerar uma das seguintes estratégias de migração:</span><span class="sxs-lookup"><span data-stu-id="54cde-138">Depending on the situation, they should consider one of the following migration strategies:</span></span>  
  
-   <span data-ttu-id="54cde-139">Reestruture o código para que o thread será fechado normalmente quando um sinal.</span><span class="sxs-lookup"><span data-stu-id="54cde-139">Restructure the code so the thread exits gracefully when a signal is received.</span></span>  
  
-   <span data-ttu-id="54cde-140">Use o <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> método para anular o thread.</span><span class="sxs-lookup"><span data-stu-id="54cde-140">Use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method to abort the thread.</span></span>  
  
-   <span data-ttu-id="54cde-141">Se um thread deve ser interrompido para que o encerramento do processo pode continuar, verifique o thread de um thread em segundo plano para que ela será encerrada automaticamente no encerramento do processo.</span><span class="sxs-lookup"><span data-stu-id="54cde-141">If a thread must be stopped so that process termination can proceed, make the thread a background thread so that it is automatically terminated on process exit.</span></span>  
  
 <span data-ttu-id="54cde-142">Em todos os casos, a estratégia deve seguir as diretrizes de design para exceções.</span><span class="sxs-lookup"><span data-stu-id="54cde-142">In all cases, the strategy should follow the design guidelines for exceptions.</span></span> <span data-ttu-id="54cde-143">Consulte [diretrizes de Design para exceções](../../../docs/standard/design-guidelines/exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="54cde-143">See [Design Guidelines for Exceptions](../../../docs/standard/design-guidelines/exceptions.md).</span></span>  
  
### <a name="application-compatibility-flag"></a><span data-ttu-id="54cde-144">Sinalizador de compatibilidade do aplicativo</span><span class="sxs-lookup"><span data-stu-id="54cde-144">Application Compatibility Flag</span></span>  
 <span data-ttu-id="54cde-145">Como uma medida temporária de compatibilidade, os administradores podem colocar um sinalizador de compatibilidade no `<runtime>` seção do arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="54cde-145">As a temporary compatibility measure, administrators can place a compatibility flag in the `<runtime>` section of the application configuration file.</span></span> <span data-ttu-id="54cde-146">Isso faz com que o common language runtime reverter para o comportamento de versões 1.0 e 1.1.</span><span class="sxs-lookup"><span data-stu-id="54cde-146">This causes the common language runtime to revert to the behavior of versions 1.0 and 1.1.</span></span>  
  
```xml  
<legacyUnhandledExceptionPolicy enabled="1"/>  
```  
  
## <a name="host-override"></a><span data-ttu-id="54cde-147">Substituição do host</span><span class="sxs-lookup"><span data-stu-id="54cde-147">Host Override</span></span>  
 <span data-ttu-id="54cde-148">No .NET Framework versão 2.0, um host não gerenciado pode usar o [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) interface na API de hospedagem para substituir o padrão de política de exceções do common language runtime não tratada.</span><span class="sxs-lookup"><span data-stu-id="54cde-148">In the .NET Framework version 2.0, an unmanaged host can use the [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) interface in the Hosting API to override the default unhandled exception policy of the common language runtime.</span></span> <span data-ttu-id="54cde-149">O [: SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) função é usada para definir a política para exceções não tratadas.</span><span class="sxs-lookup"><span data-stu-id="54cde-149">The [ICLRPolicyManager::SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) function is used to set the policy for unhandled exceptions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="54cde-150">Consulte também</span><span class="sxs-lookup"><span data-stu-id="54cde-150">See Also</span></span>  
 [<span data-ttu-id="54cde-151">Noções básicas de threading gerenciado</span><span class="sxs-lookup"><span data-stu-id="54cde-151">Managed Threading Basics</span></span>](../../../docs/standard/threading/managed-threading-basics.md)
