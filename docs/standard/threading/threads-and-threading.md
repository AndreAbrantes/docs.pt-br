---
title: Threads e threading
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- multiple threads
- threading [.NET Framework]
- threading [.NET Framework], multiple threads
ms.assetid: 5baac3aa-e603-4fa6-9f89-0f2c1084e6b1
caps.latest.revision: "14"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: b57cac34009e13c27c6d34a0ab402f9ecbe08305
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="threads-and-threading"></a><span data-ttu-id="11758-102">Threads e threading</span><span class="sxs-lookup"><span data-stu-id="11758-102">Threads and Threading</span></span>
<span data-ttu-id="11758-103">Sistemas operacionais use processos para separar os diferentes aplicativos que estão sendo executados.</span><span class="sxs-lookup"><span data-stu-id="11758-103">Operating systems use processes to separate the different applications that they are executing.</span></span> <span data-ttu-id="11758-104">Threads são a unidade básica para o qual um sistema operacional aloca tempo do processador e mais de um thread pode estar executando o código dentro desse processo.</span><span class="sxs-lookup"><span data-stu-id="11758-104">Threads are the basic unit to which an operating system allocates processor time, and more than one thread can be executing code inside that process.</span></span> <span data-ttu-id="11758-105">Cada thread mantém um conjunto de estruturas que o sistema usa para salvar o contexto do thread até que ela esteja agendada, uma prioridade de agendamento e manipuladores de exceção.</span><span class="sxs-lookup"><span data-stu-id="11758-105">Each thread maintains exception handlers, a scheduling priority, and a set of structures the system uses to save the thread context until it is scheduled.</span></span> <span data-ttu-id="11758-106">O contexto do thread inclui todas as informações que o thread precisa perfeitamente continuar execução, incluindo o conjunto do thread de registros de CPU e a pilha, no espaço de endereço de processo do host do thread.</span><span class="sxs-lookup"><span data-stu-id="11758-106">The thread context includes all the information the thread needs to seamlessly resume execution, including the thread's set of CPU registers and stack, in the address space of the thread's host process.</span></span>  
  
 <span data-ttu-id="11758-107">O .NET Framework mais subdivide um processo do sistema operacional em subprocessos gerenciados leves, chamados de domínios de aplicativo, representados pelo <xref:System.AppDomain?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="11758-107">The .NET Framework further subdivides an operating system process into lightweight managed subprocesses, called application domains, represented by <xref:System.AppDomain?displayProperty=nameWithType>.</span></span> <span data-ttu-id="11758-108">Um ou mais threads gerenciados (representado por <xref:System.Threading.Thread?displayProperty=nameWithType>) podem ser executados em uma ou qualquer número de domínios do aplicativo dentro do mesmo processo gerenciado.</span><span class="sxs-lookup"><span data-stu-id="11758-108">One or more managed threads (represented by <xref:System.Threading.Thread?displayProperty=nameWithType>) can run in one or any number of application domains within the same managed process.</span></span> <span data-ttu-id="11758-109">Embora cada domínio de aplicativo é iniciado com um único thread, o código no domínio de aplicativo pode criar domínios de aplicativo adicionais e threads adicionais.</span><span class="sxs-lookup"><span data-stu-id="11758-109">Although each application domain is started with a single thread, code in that application domain can create additional application domains and additional threads.</span></span> <span data-ttu-id="11758-110">O resultado é que um thread gerenciado pode ser movidos livremente entre domínios de aplicativo no mesmo processo gerenciado; Você pode ter apenas um thread movendo entre vários domínios de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="11758-110">The result is that a managed thread can move freely between application domains inside the same managed process; you might have only one thread moving among several application domains.</span></span>  
  
 <span data-ttu-id="11758-111">Um sistema operacional que dá suporte a multitarefa preemptiva cria o efeito da execução simultânea de vários threads de vários processos.</span><span class="sxs-lookup"><span data-stu-id="11758-111">An operating system that supports preemptive multitasking creates the effect of simultaneous execution of multiple threads from multiple processes.</span></span> <span data-ttu-id="11758-112">Ele faz isso dividindo o tempo do processador disponível entre os threads que precisam dela, alocar um intervalo de tempo do processador para cada thread após o outro.</span><span class="sxs-lookup"><span data-stu-id="11758-112">It does this by dividing the available processor time among the threads that need it, allocating a processor time slice to each thread one after another.</span></span> <span data-ttu-id="11758-113">O thread atualmente em execução será suspensa quando o tempo decorrido de fatia e outro thread em execução é retomada.</span><span class="sxs-lookup"><span data-stu-id="11758-113">The currently executing thread is suspended when its time slice elapses, and another thread resumes running.</span></span> <span data-ttu-id="11758-114">Quando o sistema muda de um thread para outro, ele salva o contexto do thread do thread admitiu preempção e recarrega o contexto do thread salvo do próximo segmento na fila de thread.</span><span class="sxs-lookup"><span data-stu-id="11758-114">When the system switches from one thread to another, it saves the thread context of the preempted thread and reloads the saved thread context of the next thread in the thread queue.</span></span>  
  
 <span data-ttu-id="11758-115">O comprimento da fração de tempo depende do sistema operacional e o processador.</span><span class="sxs-lookup"><span data-stu-id="11758-115">The length of the time slice depends on the operating system and the processor.</span></span> <span data-ttu-id="11758-116">Como cada intervalo de tempo é pequeno, vários threads aparecem em execução ao mesmo tempo, mesmo se houver apenas um processador.</span><span class="sxs-lookup"><span data-stu-id="11758-116">Because each time slice is small, multiple threads appear to be executing at the same time, even if there is only one processor.</span></span> <span data-ttu-id="11758-117">Isso é realmente o caso em sistemas de multiprocessador, em que os threads executável são distribuídos entre os processadores disponíveis.</span><span class="sxs-lookup"><span data-stu-id="11758-117">This is actually the case on multiprocessor systems, where the executable threads are distributed among the available processors.</span></span>  
  
## <a name="when-to-use-multiple-threads"></a><span data-ttu-id="11758-118">Quando usar vários Threads</span><span class="sxs-lookup"><span data-stu-id="11758-118">When To Use Multiple Threads</span></span>  
 <span data-ttu-id="11758-119">Software que requer interação do usuário deve reagir às atividades do usuário mais rápido possível para fornecer uma experiência de usuário.</span><span class="sxs-lookup"><span data-stu-id="11758-119">Software that requires user interaction must react to the user's activities as rapidly as possible to provide a rich user experience.</span></span> <span data-ttu-id="11758-120">No entanto, ao mesmo tempo, ele deve fazer cálculos necessários para apresentar os dados para o usuário mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="11758-120">At the same time, however, it must do the calculations necessary to present data to the user as fast as possible.</span></span> <span data-ttu-id="11758-121">Se seu aplicativo usa apenas um thread de execução, você pode combinar [programação assíncrona](../../../docs/standard/asynchronous-programming-patterns/calling-synchronous-methods-asynchronously.md) com[comunicação remota do .NET Framework](http://msdn.microsoft.com/en-us/eccb1d31-0a22-417a-97fd-f4f1f3aa4462) ou [os XML Web services](http://msdn.microsoft.com/en-us/1e64af78-d705-4384-b08d-591a45f4379c) criados usando ASP .NET para usar o tempo de processamento de outros computadores Além disso, para que seus próprios para aumentar a capacidade de resposta para o usuário e diminuir o tempo de processamento de dados do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="11758-121">If your application uses only one thread of execution, you can combine [asynchronous programming](../../../docs/standard/asynchronous-programming-patterns/calling-synchronous-methods-asynchronously.md) with[.NET Framework remoting](http://msdn.microsoft.com/en-us/eccb1d31-0a22-417a-97fd-f4f1f3aa4462) or [XML Web services](http://msdn.microsoft.com/en-us/1e64af78-d705-4384-b08d-591a45f4379c) created using ASP.NET to use the processing time of other computers in addition to that of your own to increase responsiveness to the user and decrease the data processing time of your application.</span></span> <span data-ttu-id="11758-122">Se você estiver fazendo um trabalho de entrada/saída intensivo, você também pode usar as portas de conclusão de e/s para aumentar a capacidade de resposta do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="11758-122">If you are doing intensive input/output work, you can also use I/O completion ports to increase your application's responsiveness.</span></span>  
  
### <a name="advantages-of-multiple-threads"></a><span data-ttu-id="11758-123">Vantagens de vários Threads</span><span class="sxs-lookup"><span data-stu-id="11758-123">Advantages of Multiple Threads</span></span>  
 <span data-ttu-id="11758-124">No entanto, usar mais de um thread é a técnica mais avançada disponível para aumentar a capacidade de resposta para o usuário e processar os dados necessários para realizar o trabalho quase simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="11758-124">Using more than one thread, however, is the most powerful technique available to increase responsiveness to the user and process the data necessary to get the job done at almost the same time.</span></span> <span data-ttu-id="11758-125">Em um computador com um processador, vários threads podem criar esse efeito, aproveitando os pequenos períodos de tempo entre eventos de usuário para processar os dados em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="11758-125">On a computer with one processor, multiple threads can create this effect, taking advantage of the small periods of time in between user events to process the data in the background.</span></span> <span data-ttu-id="11758-126">Por exemplo, um usuário pode editar uma planilha enquanto outro thread está recalculando outras partes da planilha dentro do mesmo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="11758-126">For example, a user can edit a spreadsheet while another thread is recalculating other parts of the spreadsheet within the same application.</span></span>  
  
 <span data-ttu-id="11758-127">Sem modificação, o mesmo aplicativo seria aumentar a satisfação do usuário quando executado em um computador com mais de um processador.</span><span class="sxs-lookup"><span data-stu-id="11758-127">Without modification, the same application would dramatically increase user satisfaction when run on a computer with more than one processor.</span></span> <span data-ttu-id="11758-128">O único domínio de aplicativo pode usar vários threads para realizar as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="11758-128">Your single application domain could use multiple threads to accomplish the following tasks:</span></span>  
  
-   <span data-ttu-id="11758-129">Se comunicar pela rede, em um servidor Web e um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="11758-129">Communicate over a network, to a Web server, and to a database.</span></span>  
  
-   <span data-ttu-id="11758-130">Execute as operações que levam a uma grande quantidade de tempo.</span><span class="sxs-lookup"><span data-stu-id="11758-130">Perform operations that take a large amount of time.</span></span>  
  
-   <span data-ttu-id="11758-131">Diferenciar as tarefas de prioridade diferentes.</span><span class="sxs-lookup"><span data-stu-id="11758-131">Distinguish tasks of varying priority.</span></span> <span data-ttu-id="11758-132">Por exemplo, um thread de alta prioridade gerencia as tarefas críticas e um thread de baixa prioridade executa outras tarefas.</span><span class="sxs-lookup"><span data-stu-id="11758-132">For example, a high-priority thread manages time-critical tasks, and a low-priority thread performs other tasks.</span></span>  
  
-   <span data-ttu-id="11758-133">Permitir que a interface do usuário continuar responsiva, durante a alocação de tempo para tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="11758-133">Allow the user interface to remain responsive, while allocating time to background tasks.</span></span>  
  
### <a name="disadvantages-of-multiple-threads"></a><span data-ttu-id="11758-134">Desvantagens de vários Threads</span><span class="sxs-lookup"><span data-stu-id="11758-134">Disadvantages of Multiple Threads</span></span>  
 <span data-ttu-id="11758-135">É recomendável que você use o menor número de threads, minimizando, assim, o uso de recursos do sistema operacional e melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="11758-135">It is recommended that you use as few threads as possible, thereby minimizing the use of operating-system resources and improving performance.</span></span> <span data-ttu-id="11758-136">Threading também tem requisitos de recursos e possíveis conflitos a serem considerados ao criar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="11758-136">Threading also has resource requirements and potential conflicts to be considered when designing your application.</span></span> <span data-ttu-id="11758-137">Os requisitos de recursos são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="11758-137">The resource requirements are as follows:</span></span>  
  
-   <span data-ttu-id="11758-138">O sistema consome memória para as informações de contexto exigidas por processos, **AppDomain** objetos e threads.</span><span class="sxs-lookup"><span data-stu-id="11758-138">The system consumes memory for the context information required by processes, **AppDomain** objects, and threads.</span></span> <span data-ttu-id="11758-139">Portanto, o número de processos, **AppDomain** objetos e os threads que podem ser criados é limitado pela memória disponível.</span><span class="sxs-lookup"><span data-stu-id="11758-139">Therefore, the number of processes, **AppDomain** objects, and threads that can be created is limited by available memory.</span></span>  
  
-   <span data-ttu-id="11758-140">Manter o controle de um grande número de threads consome muito tempo do processador.</span><span class="sxs-lookup"><span data-stu-id="11758-140">Keeping track of a large number of threads consumes significant processor time.</span></span> <span data-ttu-id="11758-141">Se houver muitos threads, a maioria deles não fará grande progresso.</span><span class="sxs-lookup"><span data-stu-id="11758-141">If there are too many threads, most of them will not make significant progress.</span></span> <span data-ttu-id="11758-142">Se a maioria dos threads atuais for em um processo, threads em outros processos agendados com menos frequência.</span><span class="sxs-lookup"><span data-stu-id="11758-142">If most of the current threads are in one process, threads in other processes are scheduled less frequently.</span></span>  
  
-   <span data-ttu-id="11758-143">Controlando a execução de código com o número de threads é complexo e pode ser uma fonte de muitos erros.</span><span class="sxs-lookup"><span data-stu-id="11758-143">Controlling code execution with many threads is complex, and can be a source of many bugs.</span></span>  
  
-   <span data-ttu-id="11758-144">Destruindo threads requer saber o que poderia acontecer e manipulação desses problemas.</span><span class="sxs-lookup"><span data-stu-id="11758-144">Destroying threads requires knowing what could happen and handling those issues.</span></span>  
  
 <span data-ttu-id="11758-145">Acesso compartilhado a recursos pode criar conflitos.</span><span class="sxs-lookup"><span data-stu-id="11758-145">Providing shared access to resources can create conflicts.</span></span> <span data-ttu-id="11758-146">Para evitar conflitos, você deve sincronizar ou controlar o acesso aos recursos compartilhados.</span><span class="sxs-lookup"><span data-stu-id="11758-146">To avoid conflicts, you must synchronize, or control the access to, shared resources.</span></span> <span data-ttu-id="11758-147">Falha ao sincronizar o acesso corretamente (nos domínios de aplicativo igual ou diferente) pode causar problemas, como deadlocks (no qual dois threads parar de responder enquanto aguarda a cada um do outro concluir) e condições de corrida (quando ocorre um resultado anômalo devido a uma inesperado crítica dependência de tempo dos dois eventos).</span><span class="sxs-lookup"><span data-stu-id="11758-147">Failure to synchronize access properly (in the same or different application domains) can lead to problems such as deadlocks (in which two threads stop responding while each waits for the other to complete) and race conditions (when an anomalous result occurs due to an unexpected critical dependence on the timing of two events).</span></span> <span data-ttu-id="11758-148">O sistema fornece objetos de sincronização que podem ser usados para coordenar entre vários threads de compartilhamento de recursos.</span><span class="sxs-lookup"><span data-stu-id="11758-148">The system provides synchronization objects that can be used to coordinate resource sharing among multiple threads.</span></span> <span data-ttu-id="11758-149">Reduzir o número de threads torna mais fácil sincronizar os recursos.</span><span class="sxs-lookup"><span data-stu-id="11758-149">Reducing the number of threads makes it easier to synchronize resources.</span></span>  
  
 <span data-ttu-id="11758-150">Os recursos que requerem sincronização incluem:</span><span class="sxs-lookup"><span data-stu-id="11758-150">Resources that require synchronization include:</span></span>  
  
-   <span data-ttu-id="11758-151">Recursos do sistema (como portas de comunicação).</span><span class="sxs-lookup"><span data-stu-id="11758-151">System resources (such as communications ports).</span></span>  
  
-   <span data-ttu-id="11758-152">Recursos compartilhados por vários processos (como identificadores de arquivos).</span><span class="sxs-lookup"><span data-stu-id="11758-152">Resources shared by multiple processes (such as file handles).</span></span>  
  
-   <span data-ttu-id="11758-153">Os recursos de um único domínio de aplicativo (como global, estático e campos de instância) acessados por vários threads.</span><span class="sxs-lookup"><span data-stu-id="11758-153">The resources of a single application domain (such as global, static, and instance fields) accessed by multiple threads.</span></span>  
  
### <a name="threading-and-application-design"></a><span data-ttu-id="11758-154">Design de aplicativo e Threading</span><span class="sxs-lookup"><span data-stu-id="11758-154">Threading and Application Design</span></span>  
 <span data-ttu-id="11758-155">Em geral, usando o <xref:System.Threading.ThreadPool> classe é a maneira mais fácil de lidar com vários threads para tarefas relativamente curtos, que não impede que outros threads e quando você não espera agendamento específico das tarefas.</span><span class="sxs-lookup"><span data-stu-id="11758-155">In general, using the <xref:System.Threading.ThreadPool> class is the easiest way to handle multiple threads for relatively short tasks that will not block other threads and when you do not expect any particular scheduling of the tasks.</span></span> <span data-ttu-id="11758-156">No entanto, há vários motivos para criar seus próprios threads:</span><span class="sxs-lookup"><span data-stu-id="11758-156">However, there are a number of reasons to create your own threads:</span></span>  
  
-   <span data-ttu-id="11758-157">Se você precisar de uma tarefa com uma prioridade específica.</span><span class="sxs-lookup"><span data-stu-id="11758-157">If you need a task to have a particular priority.</span></span>  
  
-   <span data-ttu-id="11758-158">Se você tiver uma tarefa que talvez um longo tempo de execução (e, portanto, bloquear outras tarefas).</span><span class="sxs-lookup"><span data-stu-id="11758-158">If you have a task that might run a long time (and therefore block other tasks).</span></span>  
  
-   <span data-ttu-id="11758-159">Se você precisa colocar os threads em um single-threaded apartment (todos os **ThreadPool** threads estão no multi-threaded apartment).</span><span class="sxs-lookup"><span data-stu-id="11758-159">If you need to place threads into a single-threaded apartment (all **ThreadPool** threads are in the multithreaded apartment).</span></span>  
  
-   <span data-ttu-id="11758-160">Se você precisa de uma identidade estável associada ao segmento.</span><span class="sxs-lookup"><span data-stu-id="11758-160">If you need a stable identity associated with the thread.</span></span> <span data-ttu-id="11758-161">Por exemplo, você deve usar um thread dedicado para anular o thread, suspendê-las ou descobri-lo por nome.</span><span class="sxs-lookup"><span data-stu-id="11758-161">For example, you should use a dedicated thread to abort that thread, suspend it, or discover it by name.</span></span>  
  
-   <span data-ttu-id="11758-162">Se você precisar executar threads em segundo plano que interagem com a interface do usuário, o .NET Framework versão 2.0 fornece um <xref:System.ComponentModel.BackgroundWorker> componente que se comunicam por meio de eventos, com entre threads marshaling para o thread de interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="11758-162">If you need to run background threads that interact with the user interface, the .NET Framework version 2.0 provides a <xref:System.ComponentModel.BackgroundWorker> component that communicates using events, with cross-thread marshaling to the user-interface thread.</span></span>  
  
### <a name="threading-and-exceptions"></a><span data-ttu-id="11758-163">Threading e exceções</span><span class="sxs-lookup"><span data-stu-id="11758-163">Threading and Exceptions</span></span>  
 <span data-ttu-id="11758-164">Manipule exceções em threads.</span><span class="sxs-lookup"><span data-stu-id="11758-164">Do handle exceptions in threads.</span></span> <span data-ttu-id="11758-165">Exceções sem tratamento em threads, threads de plano de fundo até mesmo, geralmente encerrar o processo.</span><span class="sxs-lookup"><span data-stu-id="11758-165">Unhandled exceptions in threads, even background threads, generally terminate the process.</span></span> <span data-ttu-id="11758-166">Há três exceções a essa regra:</span><span class="sxs-lookup"><span data-stu-id="11758-166">There are three exceptions to this rule:</span></span>  
  
-   <span data-ttu-id="11758-167">Um <xref:System.Threading.ThreadAbortException> é gerada em um thread porque <xref:System.Threading.Thread.Abort%2A> foi chamado.</span><span class="sxs-lookup"><span data-stu-id="11758-167">A <xref:System.Threading.ThreadAbortException> is thrown in a thread because <xref:System.Threading.Thread.Abort%2A> was called.</span></span>  
  
-   <span data-ttu-id="11758-168">Um <xref:System.AppDomainUnloadedException> é gerada em um thread porque o domínio de aplicativo está sendo descarregado.</span><span class="sxs-lookup"><span data-stu-id="11758-168">An <xref:System.AppDomainUnloadedException> is thrown in a thread because the application domain is being unloaded.</span></span>  
  
-   <span data-ttu-id="11758-169">O common language runtime ou um processo de host encerra o thread.</span><span class="sxs-lookup"><span data-stu-id="11758-169">The common language runtime or a host process terminates the thread.</span></span>  
  
 <span data-ttu-id="11758-170">Para obter mais informações, consulte [exceções em Threads gerenciados](../../../docs/standard/threading/exceptions-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="11758-170">For more information, see [Exceptions in Managed Threads](../../../docs/standard/threading/exceptions-in-managed-threads.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="11758-171">Nas versões do .NET Framework 1.0 e 1.1, o common language runtime silenciosamente intercepta algumas exceções, por exemplo, em threads de pool.</span><span class="sxs-lookup"><span data-stu-id="11758-171">In the .NET Framework versions 1.0 and 1.1, the common language runtime silently traps some exceptions, for example in thread pool threads.</span></span> <span data-ttu-id="11758-172">Isso pode corromper o estado do aplicativo e, eventualmente, fazer com que aplicativos de suspensão, que podem ser muito difícil de depurar.</span><span class="sxs-lookup"><span data-stu-id="11758-172">This may corrupt application state and eventually cause applications to hang, which might be very difficult to debug.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="11758-173">Consulte também</span><span class="sxs-lookup"><span data-stu-id="11758-173">See Also</span></span>  
 <xref:System.Threading.ThreadPool>  
 <xref:System.ComponentModel.BackgroundWorker>  
 [<span data-ttu-id="11758-174">Sincronizando dados para multithreading</span><span class="sxs-lookup"><span data-stu-id="11758-174">Synchronizing Data for Multithreading</span></span>](../../../docs/standard/threading/synchronizing-data-for-multithreading.md)  
 [<span data-ttu-id="11758-175">O pool de threads gerenciados</span><span class="sxs-lookup"><span data-stu-id="11758-175">The Managed Thread Pool</span></span>](../../../docs/standard/threading/the-managed-thread-pool.md)
