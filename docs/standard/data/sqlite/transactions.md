---
title: Transactions
ms.date: 09/08/2020
description: Saiba como usar transações.
ms.openlocfilehash: 50c4cd1023eac892cafc3ae4395e9168bd8e9f36
ms.sourcegitcommit: aa6d8a90a4f5d8fe0f6e967980b8c98433f05a44
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2020
ms.locfileid: "90678856"
---
# <a name="transactions"></a><span data-ttu-id="4b9d5-103">Transactions</span><span class="sxs-lookup"><span data-stu-id="4b9d5-103">Transactions</span></span>

<span data-ttu-id="4b9d5-104">As transações permitem agrupar várias instruções SQL em uma única unidade de trabalho confirmada no banco de dados como uma unidade atômica.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-104">Transactions let you group multiple SQL statements into a single unit of work that is committed to the database as one atomic unit.</span></span> <span data-ttu-id="4b9d5-105">Se qualquer instrução na transação falhar, as alterações feitas pelas instruções anteriores poderão ser revertidas.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-105">If any statement in the transaction fails, changes made by the previous statements can be rolled back.</span></span> <span data-ttu-id="4b9d5-106">O estado inicial do banco de dados quando a transação foi iniciada é preservado.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-106">The initial state of the database when the transaction was started is preserved.</span></span> <span data-ttu-id="4b9d5-107">O uso de uma transação também pode melhorar o desempenho no SQLite ao fazer inúmeras alterações no banco de dados ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-107">Using a transaction can also improve performance on SQLite when making numerous changes to the database at once.</span></span>

## <a name="concurrency"></a><span data-ttu-id="4b9d5-108">Simultaneidade</span><span class="sxs-lookup"><span data-stu-id="4b9d5-108">Concurrency</span></span>

<span data-ttu-id="4b9d5-109">No SQLite, somente uma transação tem permissão para ter alterações pendentes no banco de dados de cada vez.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-109">In SQLite, only one transaction is allowed to have changes pending in the database at a time.</span></span> <span data-ttu-id="4b9d5-110">Por isso, as chamadas para <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> e os `Execute` métodos em <xref:Microsoft.Data.Sqlite.SqliteCommand> podem atingir o tempo limite se outra transação levar muito tempo para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-110">Because of this, calls to <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> and the `Execute` methods on <xref:Microsoft.Data.Sqlite.SqliteCommand> may time out if another transaction takes too long to complete.</span></span>

<span data-ttu-id="4b9d5-111">Para obter mais informações sobre bloqueio, novas tentativas e tempos limite, consulte [erros de banco de dados](database-errors.md).</span><span class="sxs-lookup"><span data-stu-id="4b9d5-111">For more information about locking, retries, and timeouts, see [Database errors](database-errors.md).</span></span>

## <a name="isolation-levels"></a><span data-ttu-id="4b9d5-112">Níveis de isolamento</span><span class="sxs-lookup"><span data-stu-id="4b9d5-112">Isolation levels</span></span>

<span data-ttu-id="4b9d5-113">As transações são **serializáveis** por padrão no SQLite.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-113">Transactions are **serializable** by default in SQLite.</span></span> <span data-ttu-id="4b9d5-114">Esse nível de isolamento garante que todas as alterações feitas em uma transação sejam completamente isoladas.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-114">This isolation level guarantees that any changes made within a transaction are completely isolated.</span></span> <span data-ttu-id="4b9d5-115">Outras instruções executadas fora da transação não são afetadas pelas alterações da transação.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-115">Other statements executed outside of the transaction aren't affected by the transaction's changes.</span></span>

<span data-ttu-id="4b9d5-116">O SQLite também dá suporte à **leitura não confirmada** ao usar um cache compartilhado.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-116">SQLite also supports **read uncommitted** when using a shared cache.</span></span> <span data-ttu-id="4b9d5-117">Esse nível permite leituras sujas, leituras não repetíveis e fantasmas:</span><span class="sxs-lookup"><span data-stu-id="4b9d5-117">This level allows dirty reads, nonrepeatable reads, and phantoms:</span></span>

- <span data-ttu-id="4b9d5-118">Uma *leitura suja* ocorre quando as alterações pendentes em uma transação são retornadas por uma consulta fora da transação, mas as alterações na transação são revertidas.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-118">A *dirty read* occurs when changes pending in one transaction are returned by a query outside of the transaction, but the changes in the transaction are rolled back.</span></span> <span data-ttu-id="4b9d5-119">Os resultados contêm dados que jamais foram realmente confirmados no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-119">The results contain data that was never actually committed to the database.</span></span>

- <span data-ttu-id="4b9d5-120">Uma *leitura não reproduzível* ocorre quando uma transação consulta a mesma linha duas vezes, mas os resultados são diferentes porque foram alterados entre as duas consultas por outra transação.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-120">A *nonrepeatable read* occurs when a transaction queries same row twice, but the results are different because it was changed between the two queries by another transaction.</span></span>

- <span data-ttu-id="4b9d5-121">*Fantasmas* são linhas que são alteradas ou adicionadas para atender à cláusula WHERE de uma consulta durante uma transação.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-121">*Phantoms* are rows that get changed or added to meet the where clause of a query during a transaction.</span></span> <span data-ttu-id="4b9d5-122">Se permitido, a mesma consulta poderia retornar linhas diferentes quando executado duas vezes na mesma transação.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-122">If allowed, the same query could return different rows when executed twice in the same transaction.</span></span>

<span data-ttu-id="4b9d5-123">Microsoft. Data. sqlite trata o IsolationLevel passado para <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> como um nível mínimo.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-123">Microsoft.Data.Sqlite treats the IsolationLevel passed to <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> as a minimum level.</span></span> <span data-ttu-id="4b9d5-124">O nível de isolamento real será promovido para leitura não confirmada ou serializável.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-124">The actual isolation level will be promoted to either read uncommitted or serializable.</span></span>

<span data-ttu-id="4b9d5-125">O código a seguir simula uma leitura suja.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-125">The following code simulates a dirty read.</span></span> <span data-ttu-id="4b9d5-126">Observe que a cadeia de conexão deve incluir `Cache=Shared` .</span><span class="sxs-lookup"><span data-stu-id="4b9d5-126">Note, the connection string must include `Cache=Shared`.</span></span>

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/DirtyReadSample/Program.cs?name=snippet_DirtyRead)]

## <a name="deferred-transactions"></a><span data-ttu-id="4b9d5-127">Transações adiadas</span><span class="sxs-lookup"><span data-stu-id="4b9d5-127">Deferred transactions</span></span>

<span data-ttu-id="4b9d5-128">A partir do Microsoft. Data. sqlite versão 5,0, as transações podem ser adiadas.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-128">Starting with Microsoft.Data.Sqlite version 5.0, transactions can be deferred.</span></span> <span data-ttu-id="4b9d5-129">Isso adia a criação da transação real no banco de dados até que o primeiro comando seja executado.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-129">This defers the creation of the actual transaction in the database until the first command is executed.</span></span> <span data-ttu-id="4b9d5-130">Ele também faz com que a transação seja atualizada gradualmente de uma transação de leitura para uma transação de gravação conforme necessário por seus comandos.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-130">It also causes the transaction to gradually upgrade from a read transaction to a write transaction as needed by its commands.</span></span> <span data-ttu-id="4b9d5-131">Isso pode ser útil para habilitar o acesso simultâneo ao banco de dados durante a transação.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-131">This can be useful for enabling concurrent access to the database during the transaction.</span></span>

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/DeferredTransactionSample/Program.cs?name=snippet_DeferredTransaction)]

> [!WARNING]
> <span data-ttu-id="4b9d5-132">Os comandos dentro de uma transação adiada poderão falhar se fizerem com que a transação seja atualizada de uma transação de leitura para uma transação de gravação enquanto o banco de dados estiver bloqueado.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-132">Commands inside a deferred transaction can fail if they cause the transaction to be upgraded from a read transaction to a write transaction while the database is locked.</span></span> <span data-ttu-id="4b9d5-133">Quando isso acontecer, o aplicativo precisará repetir a transação inteira.</span><span class="sxs-lookup"><span data-stu-id="4b9d5-133">When this happens, the application will need to retry the entire transaction.</span></span>
