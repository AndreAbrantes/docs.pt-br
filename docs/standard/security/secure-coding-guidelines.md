---
title: Diretrizes de codificação segura para .NET
ms.date: 06/28/2018
helpviewer_keywords:
- managed wrapper to native code implementation
- secure coding
- reusable components
- library code that exposes protected resources
- code, security
- code security
- secure coding, options
- components [.NET], security
- code security, options
- security-neutral code
- security [.NET], coding guidelines
ms.assetid: 4f882d94-262b-4494-b0a6-ba9ba1f5f177
ms.openlocfilehash: 51f835803cc545e2a9982c1c8a90d0c998c2bcb8
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2020
ms.locfileid: "75705906"
---
# <a name="secure-coding-guidelines"></a><span data-ttu-id="cb4d7-102">Diretrizes de codificação segura</span><span class="sxs-lookup"><span data-stu-id="cb4d7-102">Secure coding guidelines</span></span>

<span data-ttu-id="cb4d7-103">Segurança baseada em evidências e segurança de acesso a código fornecem mecanismos muito poderosos e explícitos para implementar a segurança.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-103">Evidence-based security and code access security provide very powerful, explicit mechanisms to implement security.</span></span> <span data-ttu-id="cb4d7-104">A maioria dos códigos de aplicativo pode simplesmente usar a infraestrutura implementada pelo .NET.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-104">Most application code can simply use the infrastructure implemented by .NET.</span></span> <span data-ttu-id="cb4d7-105">Em alguns casos, é necessária uma segurança adicional específica do aplicativo, criada por meio da extensão do sistema de segurança ou usando novos métodos ad hoc.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-105">In some cases, additional application-specific security is required, built either by extending the security system or by using new ad hoc methods.</span></span>

<span data-ttu-id="cb4d7-106">Usando as permissões impostas do .NET e outras imposição em seu código, você deve colocar barreiras para impedir que um código mal-intencionado acesse informações que você não deseja que ele tenha ou execute outras ações indesejadas.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-106">Using .NET enforced permissions and other enforcement in your code, you should erect barriers to prevent malicious code from accessing information that you don't want it to have or performing other undesirable actions.</span></span> <span data-ttu-id="cb4d7-107">Além disso, você deve ter um equilíbrio entre segurança e usabilidade em todos os cenários esperados usando código confiável.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-107">Additionally, you must strike a balance between security and usability in all the expected scenarios using trusted code.</span></span>

<span data-ttu-id="cb4d7-108">Esta visão geral descreve as diferentes maneiras como o código pode ser projetado para funcionar com o sistema de segurança.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-108">This overview describes the different ways code can be designed to work with the security system.</span></span>

## <a name="securing-resource-access"></a><span data-ttu-id="cb4d7-109">Protegendo o acesso aos recursos</span><span class="sxs-lookup"><span data-stu-id="cb4d7-109">Securing resource access</span></span>

<span data-ttu-id="cb4d7-110">Ao projetar e escrever seu código, você precisa proteger e limitar o acesso que o código tem aos recursos, especialmente ao usar ou invocar o código de origem desconhecida.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-110">When designing and writing your code, you need to protect and limit the access that code has to resources, especially when using or invoking code of unknown origin.</span></span> <span data-ttu-id="cb4d7-111">Portanto, tenha em mente as seguintes técnicas para garantir que seu código seja seguro:</span><span class="sxs-lookup"><span data-stu-id="cb4d7-111">So, keep in mind the following techniques to ensure your code is secure:</span></span>

- <span data-ttu-id="cb4d7-112">Não use a CAS (segurança de acesso do código).</span><span class="sxs-lookup"><span data-stu-id="cb4d7-112">Do not use Code Access Security (CAS).</span></span>

- <span data-ttu-id="cb4d7-113">Não use código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-113">Do not use partial trusted code.</span></span>

- <span data-ttu-id="cb4d7-114">Não use o atributo [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) (APTCA).</span><span class="sxs-lookup"><span data-stu-id="cb4d7-114">Do not use the [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) attribute (APTCA).</span></span>

- <span data-ttu-id="cb4d7-115">Não use a comunicação remota do .NET.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-115">Do not use .NET Remoting.</span></span>

- <span data-ttu-id="cb4d7-116">Não use Component Object Model distribuída (DCOM).</span><span class="sxs-lookup"><span data-stu-id="cb4d7-116">Do not use Distributed Component Object Model (DCOM).</span></span>

- <span data-ttu-id="cb4d7-117">Não use formatadores binários.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-117">Do not use binary formatters.</span></span>

<span data-ttu-id="cb4d7-118">Segurança de acesso a código e segurança-o código transparent não tem suporte como um limite de segurança com código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-118">Code Access Security and Security-Transparent Code are not supported as a security boundary with partially trusted code.</span></span> <span data-ttu-id="cb4d7-119">Não aconselhamos carregar e executar códigos de origens desconhecidas sem a adoção de medidas de segurança alternativas no local.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-119">We advise against loading and executing code of unknown origins without putting alternative security measures in place.</span></span> <span data-ttu-id="cb4d7-120">As medidas de segurança alternativas são:</span><span class="sxs-lookup"><span data-stu-id="cb4d7-120">The alternative security measures are:</span></span>

- <span data-ttu-id="cb4d7-121">Virtualização</span><span class="sxs-lookup"><span data-stu-id="cb4d7-121">Virtualization</span></span>

- <span data-ttu-id="cb4d7-122">AppContainers</span><span class="sxs-lookup"><span data-stu-id="cb4d7-122">AppContainers</span></span>

- <span data-ttu-id="cb4d7-123">Usuários e permissões do sistema operacional (SO)</span><span class="sxs-lookup"><span data-stu-id="cb4d7-123">Operating system (OS) users and permissions</span></span>

- <span data-ttu-id="cb4d7-124">Contêineres do Hyper-V</span><span class="sxs-lookup"><span data-stu-id="cb4d7-124">Hyper-V containers</span></span>

## <a name="security-neutral-code"></a><span data-ttu-id="cb4d7-125">Segurança-código neutro</span><span class="sxs-lookup"><span data-stu-id="cb4d7-125">Security-neutral code</span></span>

<span data-ttu-id="cb4d7-126">O código de segurança neutra não faz nada de explícito com o sistema de segurança.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-126">Security-neutral code does nothing explicit with the security system.</span></span> <span data-ttu-id="cb4d7-127">Ele é executado com qualquer permissão que receber.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-127">It runs with whatever permissions it receives.</span></span> <span data-ttu-id="cb4d7-128">Embora os aplicativos que não consigam capturar as exceções de segurança associadas a operações protegidas (como usar arquivos, redes e assim por diante) possam resultar em uma exceção sem tratamento, o código de segurança neutra ainda aproveita as tecnologias de segurança no .NET .</span><span class="sxs-lookup"><span data-stu-id="cb4d7-128">Although applications that fail to catch security exceptions associated with protected operations (such as using files, networking, and so on) can result in an unhandled exception, security-neutral code still takes advantage of the security technologies in .NET.</span></span>

<span data-ttu-id="cb4d7-129">Uma biblioteca com segurança neutra tem características especiais que você deve entender.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-129">A security-neutral library has special characteristics that you should understand.</span></span> <span data-ttu-id="cb4d7-130">Suponha que sua biblioteca forneça elementos de API que usam arquivos ou chamam código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-130">Suppose your library provides API elements that use files or call unmanaged code.</span></span> <span data-ttu-id="cb4d7-131">Se o seu código não tiver a permissão correspondente, ele não será executado conforme descrito.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-131">If your code doesn't have the corresponding permission, it won't run as described.</span></span> <span data-ttu-id="cb4d7-132">No entanto, mesmo que o código tenha a permissão, qualquer código de aplicativo que o chame deve ter a mesma permissão para funcionar.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-132">However, even if the code has the permission, any application code that calls it must have the same permission in order to work.</span></span> <span data-ttu-id="cb4d7-133">Se o código de chamada não tiver a permissão correta, um <xref:System.Security.SecurityException> aparecerá como resultado da movimentação da pilha de segurança de acesso ao código.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-133">If the calling code doesn't have the right permission, a <xref:System.Security.SecurityException> appears as a result of the code access security stack walk.</span></span>

## <a name="application-code-that-isnt-a-reusable-component"></a><span data-ttu-id="cb4d7-134">Código do aplicativo que não é um componente reutilizável</span><span class="sxs-lookup"><span data-stu-id="cb4d7-134">Application code that isn't a reusable component</span></span>

<span data-ttu-id="cb4d7-135">Se seu código fizer parte de um aplicativo que não será chamado por outro código, a segurança será simples e a codificação especial poderá não ser necessária.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-135">If your code is part of an application that won't be called by other code, security is simple and special coding might not be required.</span></span> <span data-ttu-id="cb4d7-136">No entanto, lembre-se de que o código mal-intencionado pode chamar seu código.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-136">However, remember that malicious code can call your code.</span></span> <span data-ttu-id="cb4d7-137">Embora a segurança de acesso ao código possa impedir que o código mal-intencionado acesse recursos, esse código ainda pode ler valores de seus campos ou propriedades que podem conter informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-137">While code access security might stop malicious code from accessing resources, such code could still read values of your fields or properties that might contain sensitive information.</span></span>

<span data-ttu-id="cb4d7-138">Além disso, se o seu código aceitar entrada do usuário da Internet ou de outras fontes não confiáveis, você deverá ter cuidado com a entrada mal-intencionada.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-138">Additionally, if your code accepts user input from the Internet or other unreliable sources, you must be careful about malicious input.</span></span>

## <a name="managed-wrapper-to-native-code-implementation"></a><span data-ttu-id="cb4d7-139">Wrapper gerenciado para implementação de código nativo</span><span class="sxs-lookup"><span data-stu-id="cb4d7-139">Managed wrapper to native code implementation</span></span>

<span data-ttu-id="cb4d7-140">Normalmente, nesse cenário, algumas funcionalidades úteis são implementadas no código nativo que você deseja disponibilizar para o código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-140">Typically in this scenario, some useful functionality is implemented in native code that you want to make available to managed code.</span></span> <span data-ttu-id="cb4d7-141">Wrappers gerenciados são fáceis de escrever usando a invocação de plataforma ou a interoperabilidade COM.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-141">Managed wrappers are easy to write using either platform invoke or COM interop.</span></span> <span data-ttu-id="cb4d7-142">No entanto, se você fizer isso, os chamadores de seus wrappers deverão ter direitos de código não gerenciados para serem bem-sucedidos.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-142">However, if you do this, callers of your wrappers must have unmanaged code rights in order to succeed.</span></span> <span data-ttu-id="cb4d7-143">Na política padrão, isso significa que o código baixado de uma intranet ou da Internet não funcionará com os wrappers.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-143">Under default policy, this means that code downloaded from an intranet or the Internet won't work with the wrappers.</span></span>

<span data-ttu-id="cb4d7-144">Em vez de fornecer direitos de código não gerenciado a todos os aplicativos que usam esses wrappers, é melhor fornecer esses direitos somente ao código do wrapper.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-144">Instead of giving unmanaged code rights to all applications that use these wrappers, it's better to give these rights only to the wrapper code.</span></span> <span data-ttu-id="cb4d7-145">Se a funcionalidade subjacente não expõe recursos e a implementação é segura, o wrapper só precisa declarar seus direitos, o que permite que qualquer código chame através dele.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-145">If the underlying functionality exposes no resources and the implementation is likewise safe, the wrapper only needs to assert its rights, which enables any code to call through it.</span></span> <span data-ttu-id="cb4d7-146">Quando os recursos estão envolvidos, a codificação de segurança deve ser a mesma do caso de código de biblioteca descrito na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-146">When resources are involved, security coding should be the same as the library code case described in the next section.</span></span> <span data-ttu-id="cb4d7-147">Como o wrapper está potencialmente expondo chamadores a esses recursos, a verificação cuidadosa da segurança do código nativo é necessária e é responsabilidade do wrapper.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-147">Because the wrapper is potentially exposing callers to these resources, careful verification of the safety of the native code is necessary and is the wrapper's responsibility.</span></span>

## <a name="library-code-that-exposes-protected-resources"></a><span data-ttu-id="cb4d7-148">Código de biblioteca que expõe recursos protegidos</span><span class="sxs-lookup"><span data-stu-id="cb4d7-148">Library code that exposes protected resources</span></span>

<span data-ttu-id="cb4d7-149">A abordagem a seguir é a mais poderosa e, portanto, potencialmente perigosa (se tiver sido feita incorretamente) para codificação de segurança: sua biblioteca serve como uma interface para que outro código acesse determinados recursos que não estão disponíveis de outra forma, assim como as classes .NET se aplicam permissões para os recursos que eles usam.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-149">The following approach is the most powerful and hence potentially dangerous (if done incorrectly) for security coding: your library serves as an interface for other code to access certain resources that aren't otherwise available, just as the .NET classes enforce permissions for the resources they use.</span></span> <span data-ttu-id="cb4d7-150">Sempre que você expor um recurso, seu código deve primeiro solicitar a permissão apropriada para o recurso (ou seja, ele deve executar uma verificação de segurança) e, em seguida, declarar seus direitos para executar a operação real.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-150">Wherever you expose a resource, your code must first demand the permission appropriate to the resource (that is, it must perform a security check) and then typically assert its rights to perform the actual operation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cb4d7-151">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="cb4d7-151">Related topics</span></span>

|<span data-ttu-id="cb4d7-152">Cargo</span><span class="sxs-lookup"><span data-stu-id="cb4d7-152">Title</span></span>|<span data-ttu-id="cb4d7-153">Descrição</span><span class="sxs-lookup"><span data-stu-id="cb4d7-153">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="cb4d7-154">Proteção de dados de estado</span><span class="sxs-lookup"><span data-stu-id="cb4d7-154">Securing State Data</span></span>](securing-state-data.md)|<span data-ttu-id="cb4d7-155">Descreve como proteger membros privados.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-155">Describes how to protect private members.</span></span>|
|[<span data-ttu-id="cb4d7-156">Segurança e entrada do usuário</span><span class="sxs-lookup"><span data-stu-id="cb4d7-156">Security and User Input</span></span>](security-and-user-input.md)|<span data-ttu-id="cb4d7-157">Descreve as preocupações de segurança para aplicativos que aceitam a entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-157">Describes security concerns for applications that accept user input.</span></span>|
|[<span data-ttu-id="cb4d7-158">Segurança e condições de corrida</span><span class="sxs-lookup"><span data-stu-id="cb4d7-158">Security and Race Conditions</span></span>](security-and-race-conditions.md)|<span data-ttu-id="cb4d7-159">Descreve como evitar condições de corrida em seu código.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-159">Describes how to avoid race conditions in your code.</span></span>|
|[<span data-ttu-id="cb4d7-160">Segurança e geração dinâmica de código</span><span class="sxs-lookup"><span data-stu-id="cb4d7-160">Security and On-the-Fly Code Generation</span></span>](security-and-on-the-fly-code-generation.md)|<span data-ttu-id="cb4d7-161">Descreve as preocupações de segurança para aplicativos que geram código dinâmico.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-161">Describes security concerns for applications that generate dynamic code.</span></span>|
|[<span data-ttu-id="cb4d7-162">Segurança baseada em Função</span><span class="sxs-lookup"><span data-stu-id="cb4d7-162">Role-Based Security</span></span>](role-based-security.md)|<span data-ttu-id="cb4d7-163">Descreve a segurança baseada em funções do .NET em detalhes e fornece instruções para usá-las em seu código.</span><span class="sxs-lookup"><span data-stu-id="cb4d7-163">Describes .NET role-based security in detail and provides instructions for using it in your code.</span></span>|
