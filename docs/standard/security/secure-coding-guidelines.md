---
title: Diretrizes de codificação segura para .NET
ms.date: 06/28/2018
helpviewer_keywords:
- managed wrapper to native code implementation
- secure coding
- reusable components
- library code that exposes protected resources
- code, security
- code security
- secure coding, options
- components [.NET], security
- code security, options
- security-neutral code
- security [.NET], coding guidelines
ms.assetid: 4f882d94-262b-4494-b0a6-ba9ba1f5f177
author: mairaw
ms.author: mairaw
ms.openlocfilehash: b3a8f0dfc1a2b5e09722876b73281ed1d8b6334e
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "62018639"
---
# <a name="secure-coding-guidelines"></a><span data-ttu-id="290bc-102">Diretrizes de codificação segura</span><span class="sxs-lookup"><span data-stu-id="290bc-102">Secure coding guidelines</span></span>

<span data-ttu-id="290bc-103">Segurança baseada em evidência e segurança de acesso do código fornecem mecanismos muito poderosos, explícitos para implementar a segurança.</span><span class="sxs-lookup"><span data-stu-id="290bc-103">Evidence-based security and code access security provide very powerful, explicit mechanisms to implement security.</span></span> <span data-ttu-id="290bc-104">A maioria dos códigos de aplicativo pode simplesmente usar a infra-estrutura implementada pelo .NET.</span><span class="sxs-lookup"><span data-stu-id="290bc-104">Most application code can simply use the infrastructure implemented by .NET.</span></span> <span data-ttu-id="290bc-105">Em alguns casos, os adicionais de segurança específicos do aplicativo é necessária, compilada estendendo o sistema de segurança ou usando novos métodos ad hoc.</span><span class="sxs-lookup"><span data-stu-id="290bc-105">In some cases, additional application-specific security is required, built either by extending the security system or by using new ad hoc methods.</span></span>

<span data-ttu-id="290bc-106">Usando o .NET imposta permissões e outra imposição em seu código, você deve colocar as barreiras para impedir que códigos mal-intencionados de acessar informações que você não deseja que ela tenha ou executar outras ações indesejáveis.</span><span class="sxs-lookup"><span data-stu-id="290bc-106">Using .NET enforced permissions and other enforcement in your code, you should erect barriers to prevent malicious code from accessing information that you don't want it to have or performing other undesirable actions.</span></span> <span data-ttu-id="290bc-107">Além disso, você deve obter um equilíbrio entre segurança e usabilidade em todos os cenários esperados usando código confiável.</span><span class="sxs-lookup"><span data-stu-id="290bc-107">Additionally, you must strike a balance between security and usability in all the expected scenarios using trusted code.</span></span>

<span data-ttu-id="290bc-108">Esta visão geral descreve as diferentes maneiras de código pode ser projetado para trabalhar com o sistema de segurança.</span><span class="sxs-lookup"><span data-stu-id="290bc-108">This overview describes the different ways code can be designed to work with the security system.</span></span>

## <a name="securing-resource-access"></a><span data-ttu-id="290bc-109">Protegendo o acesso aos recursos</span><span class="sxs-lookup"><span data-stu-id="290bc-109">Securing resource access</span></span>

<span data-ttu-id="290bc-110">Ao projetar e escrever seu código, você precisa proteger e limitar o acesso que o código tem a recursos, especialmente ao usar ou chamar o código de origem desconhecida.</span><span class="sxs-lookup"><span data-stu-id="290bc-110">When designing and writing your code, you need to protect and limit the access that code has to resources, especially when using or invoking code of unknown origin.</span></span> <span data-ttu-id="290bc-111">Portanto, tenha em mente as seguintes técnicas para garantir que o código está seguro:</span><span class="sxs-lookup"><span data-stu-id="290bc-111">So, keep in mind the following techniques to ensure your code is secure:</span></span>

- <span data-ttu-id="290bc-112">Não use a segurança de acesso do código (CAS).</span><span class="sxs-lookup"><span data-stu-id="290bc-112">Do not use Code Access Security (CAS).</span></span>

- <span data-ttu-id="290bc-113">Não use o código de confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="290bc-113">Do not use partial trusted code.</span></span>

- <span data-ttu-id="290bc-114">Não use o [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) atributo (APTCA).</span><span class="sxs-lookup"><span data-stu-id="290bc-114">Do not use the [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) attribute (APTCA).</span></span>

- <span data-ttu-id="290bc-115">Não use a comunicação remota do .NET.</span><span class="sxs-lookup"><span data-stu-id="290bc-115">Do not use .NET Remoting.</span></span>

- <span data-ttu-id="290bc-116">Não use o modelo de objeto componente distribuído (DCOM).</span><span class="sxs-lookup"><span data-stu-id="290bc-116">Do not use Distributed Component Object Model (DCOM).</span></span>

- <span data-ttu-id="290bc-117">Não use formatadores binários.</span><span class="sxs-lookup"><span data-stu-id="290bc-117">Do not use binary formatters.</span></span>

<span data-ttu-id="290bc-118">Não há suporte para segurança de acesso do código e o código transparente de segurança como um limite de segurança com código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="290bc-118">Code Access Security and Security-Transparent Code are not supported as a security boundary with partially trusted code.</span></span> <span data-ttu-id="290bc-119">Não aconselhamos carregar e executar códigos de origens desconhecidas sem a adoção de medidas de segurança alternativas no local.</span><span class="sxs-lookup"><span data-stu-id="290bc-119">We advise against loading and executing code of unknown origins without putting alternative security measures in place.</span></span> <span data-ttu-id="290bc-120">As medidas de segurança alternativas são:</span><span class="sxs-lookup"><span data-stu-id="290bc-120">The alternative security measures are:</span></span>

- <span data-ttu-id="290bc-121">Virtualização</span><span class="sxs-lookup"><span data-stu-id="290bc-121">Virtualization</span></span>

- <span data-ttu-id="290bc-122">AppContainers</span><span class="sxs-lookup"><span data-stu-id="290bc-122">AppContainers</span></span>

- <span data-ttu-id="290bc-123">Permissões e os usuários do sistema operacional (SO)</span><span class="sxs-lookup"><span data-stu-id="290bc-123">Operating system (OS) users and permissions</span></span>

- <span data-ttu-id="290bc-124">Contêineres do Hyper-V</span><span class="sxs-lookup"><span data-stu-id="290bc-124">Hyper-V containers</span></span>

## <a name="security-neutral-code"></a><span data-ttu-id="290bc-125">Código de segurança neutra</span><span class="sxs-lookup"><span data-stu-id="290bc-125">Security-neutral code</span></span>

<span data-ttu-id="290bc-126">Código de segurança neutra não faz nada explícito com o sistema de segurança.</span><span class="sxs-lookup"><span data-stu-id="290bc-126">Security-neutral code does nothing explicit with the security system.</span></span> <span data-ttu-id="290bc-127">Ele é executado com quaisquer permissões que ele recebe.</span><span class="sxs-lookup"><span data-stu-id="290bc-127">It runs with whatever permissions it receives.</span></span> <span data-ttu-id="290bc-128">Embora os aplicativos que falham ao capturar exceções de segurança associadas a operações protegidas (como o uso de arquivos, rede e assim por diante) podem resultar em uma exceção sem tratamento, o código neutro de segurança ainda aproveita as tecnologias de segurança no .NET .</span><span class="sxs-lookup"><span data-stu-id="290bc-128">Although applications that fail to catch security exceptions associated with protected operations (such as using files, networking, and so on) can result in an unhandled exception, security-neutral code still takes advantage of the security technologies in .NET.</span></span>

<span data-ttu-id="290bc-129">Uma biblioteca de segurança neutra tem características especiais que você deve compreender.</span><span class="sxs-lookup"><span data-stu-id="290bc-129">A security-neutral library has special characteristics that you should understand.</span></span> <span data-ttu-id="290bc-130">Suponha que sua biblioteca fornece os elementos de API que usam arquivos ou chamam código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="290bc-130">Suppose your library provides API elements that use files or call unmanaged code.</span></span> <span data-ttu-id="290bc-131">Se seu código não tiver a permissão correspondente, ele não será executado conforme descrito.</span><span class="sxs-lookup"><span data-stu-id="290bc-131">If your code doesn't have the corresponding permission, it won't run as described.</span></span> <span data-ttu-id="290bc-132">No entanto, mesmo que o código tenha a permissão, qualquer código de aplicativo que faz a chamada deve ter a mesma permissão para trabalhar.</span><span class="sxs-lookup"><span data-stu-id="290bc-132">However, even if the code has the permission, any application code that calls it must have the same permission in order to work.</span></span> <span data-ttu-id="290bc-133">Se o código de chamada não tem a permissão correta, uma <xref:System.Security.SecurityException> aparece como resultado a movimentação de pilha de segurança de acesso de código.</span><span class="sxs-lookup"><span data-stu-id="290bc-133">If the calling code doesn't have the right permission, a <xref:System.Security.SecurityException> appears as a result of the code access security stack walk.</span></span>

## <a name="application-code-that-isnt-a-reusable-component"></a><span data-ttu-id="290bc-134">Código do aplicativo que não é um componente reutilizável</span><span class="sxs-lookup"><span data-stu-id="290bc-134">Application code that isn't a reusable component</span></span>

<span data-ttu-id="290bc-135">Se seu código fizer parte de um aplicativo que não será chamado por outro código, a segurança é simple e codificação especial pode não ser necessário.</span><span class="sxs-lookup"><span data-stu-id="290bc-135">If your code is part of an application that won't be called by other code, security is simple and special coding might not be required.</span></span> <span data-ttu-id="290bc-136">No entanto, lembre-se de que o código mal-intencionado pode chamar seu código.</span><span class="sxs-lookup"><span data-stu-id="290bc-136">However, remember that malicious code can call your code.</span></span> <span data-ttu-id="290bc-137">Enquanto a segurança de acesso do código poderá parar de códigos mal-intencionados de acessar os recursos, tal código ainda pode ler os valores de seus campos ou propriedades que podem conter informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="290bc-137">While code access security might stop malicious code from accessing resources, such code could still read values of your fields or properties that might contain sensitive information.</span></span>

<span data-ttu-id="290bc-138">Além disso, se seu código aceita entrada do usuário da Internet ou de outras fontes não confiáveis, você deve ser cuidadoso com entrada mal-intencionada.</span><span class="sxs-lookup"><span data-stu-id="290bc-138">Additionally, if your code accepts user input from the Internet or other unreliable sources, you must be careful about malicious input.</span></span>

## <a name="managed-wrapper-to-native-code-implementation"></a><span data-ttu-id="290bc-139">Gerenciado wrapper para a implementação de código nativo</span><span class="sxs-lookup"><span data-stu-id="290bc-139">Managed wrapper to native code implementation</span></span>

<span data-ttu-id="290bc-140">Normalmente nesse cenário, algumas funcionalidades úteis é implementada em código nativo que você deseja disponibilizar para código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="290bc-140">Typically in this scenario, some useful functionality is implemented in native code that you want to make available to managed code.</span></span> <span data-ttu-id="290bc-141">Invólucros gerenciados são fáceis de gravação usando invocação de qualquer plataforma ou a interoperabilidade COM.</span><span class="sxs-lookup"><span data-stu-id="290bc-141">Managed wrappers are easy to write using either platform invoke or COM interop.</span></span> <span data-ttu-id="290bc-142">No entanto, se você fizer isso, os chamadores de sua wrappers devem ter direitos de código não gerenciado para ser bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="290bc-142">However, if you do this, callers of your wrappers must have unmanaged code rights in order to succeed.</span></span> <span data-ttu-id="290bc-143">Sob a política padrão, isso significa que o código baixado de uma intranet ou Internet não funcionará com os wrappers.</span><span class="sxs-lookup"><span data-stu-id="290bc-143">Under default policy, this means that code downloaded from an intranet or the Internet won't work with the wrappers.</span></span>

<span data-ttu-id="290bc-144">Em vez de conceder direitos de código não gerenciado para todos os aplicativos que usam esses wrappers, é melhor fornecer esses direitos somente para o código de wrapper.</span><span class="sxs-lookup"><span data-stu-id="290bc-144">Instead of giving unmanaged code rights to all applications that use these wrappers, it's better to give these rights only to the wrapper code.</span></span> <span data-ttu-id="290bc-145">Se a funcionalidade subjacente não expõe nenhum recurso e a implementação é segura da mesma forma, o wrapper só precisa declarar seus direitos, que permite que qualquer código chame por meio dele.</span><span class="sxs-lookup"><span data-stu-id="290bc-145">If the underlying functionality exposes no resources and the implementation is likewise safe, the wrapper only needs to assert its rights, which enables any code to call through it.</span></span> <span data-ttu-id="290bc-146">Quando os recursos estão envolvidos, codificação de segurança deve ser o mesmo que o caso de código da biblioteca descrito na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="290bc-146">When resources are involved, security coding should be the same as the library code case described in the next section.</span></span> <span data-ttu-id="290bc-147">Porque o wrapper está potencialmente expondo os chamadores a esses recursos, verificação de cuidado do que a segurança do código nativo é necessária e é responsabilidade do wrapper.</span><span class="sxs-lookup"><span data-stu-id="290bc-147">Because the wrapper is potentially exposing callers to these resources, careful verification of the safety of the native code is necessary and is the wrapper's responsibility.</span></span>

## <a name="library-code-that-exposes-protected-resources"></a><span data-ttu-id="290bc-148">Recursos do código da biblioteca que expõe protegidos</span><span class="sxs-lookup"><span data-stu-id="290bc-148">Library code that exposes protected resources</span></span>

<span data-ttu-id="290bc-149">A abordagem a seguir é mais poderosa e, portanto, potencialmente perigosa (caso seja realizado incorretamente) para a codificação de segurança: sua biblioteca serve como uma interface para outro código para acessar determinados recursos que não disponíveis, caso contrário, assim como impõem as classes do .NET permissões para os recursos que eles usam.</span><span class="sxs-lookup"><span data-stu-id="290bc-149">The following approach is the most powerful and hence potentially dangerous (if done incorrectly) for security coding: your library serves as an interface for other code to access certain resources that aren't otherwise available, just as the .NET classes enforce permissions for the resources they use.</span></span> <span data-ttu-id="290bc-150">Sempre que você exponha um recurso, seu código deve exigir primeiro a permissão apropriada para o recurso (ou seja, ele deve executar uma verificação de segurança) e, em seguida, normalmente, declarar seus direitos para executar a operação real.</span><span class="sxs-lookup"><span data-stu-id="290bc-150">Wherever you expose a resource, your code must first demand the permission appropriate to the resource (that is, it must perform a security check) and then typically assert its rights to perform the actual operation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="290bc-151">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="290bc-151">Related topics</span></span>

|<span data-ttu-id="290bc-152">Título</span><span class="sxs-lookup"><span data-stu-id="290bc-152">Title</span></span>|<span data-ttu-id="290bc-153">Descrição</span><span class="sxs-lookup"><span data-stu-id="290bc-153">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="290bc-154">Proteção de dados de estado</span><span class="sxs-lookup"><span data-stu-id="290bc-154">Securing State Data</span></span>](securing-state-data.md)|<span data-ttu-id="290bc-155">Descreve como proteger os membros privados.</span><span class="sxs-lookup"><span data-stu-id="290bc-155">Describes how to protect private members.</span></span>|
|[<span data-ttu-id="290bc-156">Segurança e entrada do usuário</span><span class="sxs-lookup"><span data-stu-id="290bc-156">Security and User Input</span></span>](security-and-user-input.md)|<span data-ttu-id="290bc-157">Descreve problemas de segurança para aplicativos que aceitam a entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="290bc-157">Describes security concerns for applications that accept user input.</span></span>|
|[<span data-ttu-id="290bc-158">Segurança e condições de corrida</span><span class="sxs-lookup"><span data-stu-id="290bc-158">Security and Race Conditions</span></span>](security-and-race-conditions.md)|<span data-ttu-id="290bc-159">Descreve como evitar condições de corrida em seu código.</span><span class="sxs-lookup"><span data-stu-id="290bc-159">Describes how to avoid race conditions in your code.</span></span>|
|[<span data-ttu-id="290bc-160">Segurança e geração dinâmica de código</span><span class="sxs-lookup"><span data-stu-id="290bc-160">Security and On-the-Fly Code Generation</span></span>](security-and-on-the-fly-code-generation.md)|<span data-ttu-id="290bc-161">Descreve problemas de segurança para aplicativos que geram código dinâmico.</span><span class="sxs-lookup"><span data-stu-id="290bc-161">Describes security concerns for applications that generate dynamic code.</span></span>|
|[<span data-ttu-id="290bc-162">Segurança baseada em Função</span><span class="sxs-lookup"><span data-stu-id="290bc-162">Role-Based Security</span></span>](role-based-security.md)|<span data-ttu-id="290bc-163">Descreve a segurança baseada em função do .NET em detalhes e fornece instruções sobre como usá-lo em seu código.</span><span class="sxs-lookup"><span data-stu-id="290bc-163">Describes .NET role-based security in detail and provides instructions for using it in your code.</span></span>|
