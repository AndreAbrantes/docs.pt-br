---
title: Práticas recomendadas para o padrão de design do observador
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- observer design pattern [.NET Framework], best practices
- best practices [.NET Framework], observer design pattern
ms.assetid: c834760f-ddd4-417f-abb7-a059679d5b8c
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 03b77074323346e1a26fa07dc1ec873152da356b
ms.sourcegitcommit: c7f3e2e9d6ead6cc3acd0d66b10a251d0c66e59d
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/09/2018
ms.locfileid: "44195042"
---
# <a name="observer-design-pattern-best-practices"></a><span data-ttu-id="b508a-102">Práticas recomendadas para o padrão de design do observador</span><span class="sxs-lookup"><span data-stu-id="b508a-102">Observer Design Pattern Best Practices</span></span>
<span data-ttu-id="b508a-103">No .NET Framework, o padrão de design de observador é implementado como um conjunto de interfaces.</span><span class="sxs-lookup"><span data-stu-id="b508a-103">In the .NET Framework, the observer design pattern is implemented as a set of interfaces.</span></span> <span data-ttu-id="b508a-104">A interface <xref:System.IObservable%601?displayProperty=nameWithType> representa o provedor de dados, que também é responsável por fornecer uma implementação <xref:System.IDisposable> que permite que os observadores cancelem a assinatura de notificações.</span><span class="sxs-lookup"><span data-stu-id="b508a-104">The <xref:System.IObservable%601?displayProperty=nameWithType> interface represents the data provider, which is also responsible for providing an <xref:System.IDisposable> implementation that lets observers unsubscribe from notifications.</span></span> <span data-ttu-id="b508a-105">A interface <xref:System.IObserver%601?displayProperty=nameWithType> representa o observador.</span><span class="sxs-lookup"><span data-stu-id="b508a-105">The <xref:System.IObserver%601?displayProperty=nameWithType> interface represents the observer.</span></span> <span data-ttu-id="b508a-106">Este tópico descreve as práticas recomendadas que os desenvolvedores devem seguir ao implementar o padrão de design de observador usando essas interfaces.</span><span class="sxs-lookup"><span data-stu-id="b508a-106">This topic describes the best practices that developers should follow when implementing the observer design pattern using these interfaces.</span></span>  
  
## <a name="threading"></a><span data-ttu-id="b508a-107">Threading</span><span class="sxs-lookup"><span data-stu-id="b508a-107">Threading</span></span>  
 <span data-ttu-id="b508a-108">Normalmente, um provedor implementa o método <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> adicionando um observador específico a uma lista de assinantes que é representada por algum objeto de coleção e implementa o método <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> removendo um determinado observador da lista de assinantes.</span><span class="sxs-lookup"><span data-stu-id="b508a-108">Typically, a provider implements the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method by adding a particular observer to a subscriber list that is represented by some collection object, and it implements the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method by removing a particular observer from the subscriber list.</span></span> <span data-ttu-id="b508a-109">Um observador pode chamar esses métodos a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="b508a-109">An observer can call these methods at any time.</span></span> <span data-ttu-id="b508a-110">Além disso, como o contrato de provedor/observador não especifica quem é responsável por cancelar a assinatura após o método de retorno de chamada <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, o provedor e o observador podem tentar ambos remover o mesmo membro da lista.</span><span class="sxs-lookup"><span data-stu-id="b508a-110">In addition, because the provider/observer contract does not specify who is responsible for unsubscribing after the <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> callback method, the provider and observer may both try to remove the same member from the list.</span></span> <span data-ttu-id="b508a-111">Devido a essa possibilidade, tanto o método <xref:System.IObservable%601.Subscribe%2A> quanto o método <xref:System.IDisposable.Dispose%2A> devem ser thread-safe.</span><span class="sxs-lookup"><span data-stu-id="b508a-111">Because of this possibility, both the <xref:System.IObservable%601.Subscribe%2A> and <xref:System.IDisposable.Dispose%2A> methods should be thread-safe.</span></span> <span data-ttu-id="b508a-112">Normalmente, isso envolve o uso de uma [coleção simultânea](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) ou um bloqueio.</span><span class="sxs-lookup"><span data-stu-id="b508a-112">Typically, this involves using a [concurrent collection](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) or a lock.</span></span> <span data-ttu-id="b508a-113">As implementações que não são thread-safe devem documentar explicitamente esse fato.</span><span class="sxs-lookup"><span data-stu-id="b508a-113">Implementations that are not thread-safe should explicitly document that they are not.</span></span>  
  
 <span data-ttu-id="b508a-114">Quaisquer garantias adicionais devem ser especificadas em uma camada no início do contrato de provedor/observador.</span><span class="sxs-lookup"><span data-stu-id="b508a-114">Any additional guarantees have to be specified in a layer on top of the provider/observer contract.</span></span> <span data-ttu-id="b508a-115">Os implementadores devem chamar claramente ao imporem requisitos adicionais para evitar confusão do usuário sobre o contrato do observador.</span><span class="sxs-lookup"><span data-stu-id="b508a-115">Implementers should clearly call out when they impose additional requirements to avoid user confusion about the observer contract.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="b508a-116">Tratando exceções</span><span class="sxs-lookup"><span data-stu-id="b508a-116">Handling Exceptions</span></span>  
 <span data-ttu-id="b508a-117">Devido ao fraco acoplamento entre um provedor de dados e um observador, as exceções no padrão de design do observador devem ser informativas.</span><span class="sxs-lookup"><span data-stu-id="b508a-117">Because of the loose coupling between a data provider and an observer, exceptions in the observer design pattern are intended to be informational.</span></span> <span data-ttu-id="b508a-118">Isso afeta como os provedores e observadores manipulam exceções no padrão de design do observador.</span><span class="sxs-lookup"><span data-stu-id="b508a-118">This affects how providers and observers handle exceptions in the observer design pattern.</span></span>  
  
### <a name="the-provider----calling-the-onerror-method"></a><span data-ttu-id="b508a-119">O provedor – Chamando o método OnError</span><span class="sxs-lookup"><span data-stu-id="b508a-119">The Provider -- Calling the OnError Method</span></span>  
 <span data-ttu-id="b508a-120">O método <xref:System.IObserver%601.OnError%2A> serve como uma mensagem informativa para observadores, da mesma forma que o método <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b508a-120">The <xref:System.IObserver%601.OnError%2A> method is intended as an informational message to observers, much like the <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="b508a-121">No entanto, o método <xref:System.IObserver%601.OnNext%2A> foi projetado para fornecer a um observador dados atuais ou atualizados, enquanto o método <xref:System.IObserver%601.OnError%2A> foi projetado para indicar que o provedor não é capaz de fornecer dados válidos.</span><span class="sxs-lookup"><span data-stu-id="b508a-121">However, the <xref:System.IObserver%601.OnNext%2A> method is designed to provide an observer with current or updated data, whereas the <xref:System.IObserver%601.OnError%2A> method is designed to indicate that the provider is unable to provide valid data.</span></span>  
  
 <span data-ttu-id="b508a-122">O provedor deve seguir essas práticas recomendadas ao manipular exceções e chamar o método <xref:System.IObserver%601.OnError%2A>:</span><span class="sxs-lookup"><span data-stu-id="b508a-122">The provider should follow these best practices when handling exceptions and calling the <xref:System.IObserver%601.OnError%2A> method:</span></span>  
  
-   <span data-ttu-id="b508a-123">O provedor deverá manipular suas próprias exceções se houver algum requisito específico.</span><span class="sxs-lookup"><span data-stu-id="b508a-123">The provider must handle its own exceptions if it has any specific requirements.</span></span>  
  
-   <span data-ttu-id="b508a-124">O provedor não deve esperar ou exigir que os observadores manipulem exceções de alguma maneira específica.</span><span class="sxs-lookup"><span data-stu-id="b508a-124">The provider should not expect or require that observers handle exceptions in any particular way.</span></span>  
  
-   <span data-ttu-id="b508a-125">O provedor deve chamar o método <xref:System.IObserver%601.OnError%2A> ao manipular uma exceção que comprometa sua capacidade de fornecer atualizações.</span><span class="sxs-lookup"><span data-stu-id="b508a-125">The provider should call the <xref:System.IObserver%601.OnError%2A> method when it handles an exception that compromises its ability to provide updates.</span></span> <span data-ttu-id="b508a-126">Informações sobre essas exceções podem ser passadas para o observador.</span><span class="sxs-lookup"><span data-stu-id="b508a-126">Information on such exceptions can be passed to the observer.</span></span> <span data-ttu-id="b508a-127">Em outros casos, não há necessidade de notificar os observadores com relação a uma exceção.</span><span class="sxs-lookup"><span data-stu-id="b508a-127">In other cases, there is no need to notify observers of an exception.</span></span>  
  
 <span data-ttu-id="b508a-128">Uma vez que o provedor chame o método <xref:System.IObserver%601.OnError%2A> ou <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, não deverá haver nenhuma notificação adicional e o provedor poderá cancelar a assinatura de seus observadores.</span><span class="sxs-lookup"><span data-stu-id="b508a-128">Once the provider calls the <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> method, there should be no further notifications, and the provider can unsubscribe its observers.</span></span> <span data-ttu-id="b508a-129">No entanto, os observadores podem também cancelar eles próprios sua assinatura a qualquer momento, inclusive antes e depois de receberem uma notificação <xref:System.IObserver%601.OnError%2A> ou <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b508a-129">However, the observers can also unsubscribe themselves at any time, including both before and after they receive an <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> notification.</span></span> <span data-ttu-id="b508a-130">O padrão de design do observador não determina se o provedor ou o observador é responsável pelo cancelamento da assinatura; portanto, é possível que ambos tentem cancelar a assinatura.</span><span class="sxs-lookup"><span data-stu-id="b508a-130">The observer design pattern does not dictate whether the provider or the observer is responsible for unsubscribing; therefore, there is a possibility that both may attempt to unsubscribe.</span></span> <span data-ttu-id="b508a-131">Normalmente, quando os observadores cancelam a assinatura, eles são removidos de uma coleção de assinantes.</span><span class="sxs-lookup"><span data-stu-id="b508a-131">Typically, when observers unsubscribe, they are removed from a subscribers collection.</span></span> <span data-ttu-id="b508a-132">Em um aplicativo de thread único, a implementação <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> deve garantir que uma referência de objeto seja válida e que o objeto seja um membro da coleção de assinantes antes de tentar removê-lo.</span><span class="sxs-lookup"><span data-stu-id="b508a-132">In a single-threaded application, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation should ensure that an object reference is valid and that the object is a member of the subscribers collection before attempting to remove it.</span></span> <span data-ttu-id="b508a-133">Em um aplicativo com multithread, deve-se usar um objeto de coleção thread-safe, tal como um objeto <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b508a-133">In a multithreaded application, a thread-safe collection object, such as a <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType> object, should be used.</span></span>  
  
### <a name="the-observer----implementing-the-onerror-method"></a><span data-ttu-id="b508a-134">O observador – Implementando o método OnError</span><span class="sxs-lookup"><span data-stu-id="b508a-134">The Observer -- Implementing the OnError Method</span></span>  
 <span data-ttu-id="b508a-135">Quando um observador recebe uma notificação de erro de um provedor, o observador deve tratar a exceção como informativa e não deve ser necessária qualquer ação específica.</span><span class="sxs-lookup"><span data-stu-id="b508a-135">When an observer receives an error notification from a provider, the observer should treat the exception as informational and should not be required to take any particular action.</span></span>  
  
 <span data-ttu-id="b508a-136">O observador deve seguir essas práticas recomendadas ao responder a uma chamada de método <xref:System.IObserver%601.OnError%2A> de um provedor:</span><span class="sxs-lookup"><span data-stu-id="b508a-136">The observer should follow these best practices when responding to an <xref:System.IObserver%601.OnError%2A> method call from a provider:</span></span>  
  
-   <span data-ttu-id="b508a-137">O observador não deve lançar exceções de suas implementações de interface, tais como <xref:System.IObserver%601.OnNext%2A> ou <xref:System.IObserver%601.OnError%2A>.</span><span class="sxs-lookup"><span data-stu-id="b508a-137">The observer should not throw exceptions from its interface implementations, such as <xref:System.IObserver%601.OnNext%2A> or <xref:System.IObserver%601.OnError%2A>.</span></span> <span data-ttu-id="b508a-138">No entanto, se o observador lançar exceções, ele deverá esperar que essas exceções fiquem sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="b508a-138">However, if the observer does throw exceptions, it should expect these exceptions to go unhandled.</span></span>  
  
-   <span data-ttu-id="b508a-139">Para preservar a pilha de chamadas, um observador que deseja gerar um objeto <xref:System.Exception>, que foi passado para o seu método <xref:System.IObserver%601.OnError%2A>, deveria encapsular a exceção antes de lançá-la.</span><span class="sxs-lookup"><span data-stu-id="b508a-139">To preserve the call stack, an observer that wishes to throw an <xref:System.Exception> object that was passed to its <xref:System.IObserver%601.OnError%2A> method should wrap the exception before throwing it.</span></span> <span data-ttu-id="b508a-140">Um objeto de exceção padrão deve ser usado para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="b508a-140">A standard exception object should be used for this purpose.</span></span>  
  
## <a name="additional-best-practices"></a><span data-ttu-id="b508a-141">Práticas recomendadas adicionais</span><span class="sxs-lookup"><span data-stu-id="b508a-141">Additional Best Practices</span></span>  
 <span data-ttu-id="b508a-142">A tentativa de cancelar registro no método <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> pode resultar em uma referência nula.</span><span class="sxs-lookup"><span data-stu-id="b508a-142">Attempting to unregister in the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method may result in a null reference.</span></span> <span data-ttu-id="b508a-143">Portanto, é recomendável que você evite essa prática.</span><span class="sxs-lookup"><span data-stu-id="b508a-143">Therefore, we recommend that you avoid this practice.</span></span>  
  
 <span data-ttu-id="b508a-144">Embora seja possível anexar um observador para vários provedores, o padrão recomendado é anexar uma <xref:System.IObserver%601> instância a uma única instância <xref:System.IObservable%601>.</span><span class="sxs-lookup"><span data-stu-id="b508a-144">Although it is possible to attach an observer to multiple providers, the recommended pattern is to attach an <xref:System.IObserver%601> instance to only one <xref:System.IObservable%601> instance.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b508a-145">Consulte também</span><span class="sxs-lookup"><span data-stu-id="b508a-145">See also</span></span>

- [<span data-ttu-id="b508a-146">Padrão de design do observador</span><span class="sxs-lookup"><span data-stu-id="b508a-146">Observer Design Pattern</span></span>](../../../docs/standard/events/observer-design-pattern.md)  
- [<span data-ttu-id="b508a-147">Como implementar um observador</span><span class="sxs-lookup"><span data-stu-id="b508a-147">How to: Implement an Observer</span></span>](../../../docs/standard/events/how-to-implement-an-observer.md)  
- [<span data-ttu-id="b508a-148">Como implementar um provedor</span><span class="sxs-lookup"><span data-stu-id="b508a-148">How to: Implement a Provider</span></span>](../../../docs/standard/events/how-to-implement-a-provider.md)
