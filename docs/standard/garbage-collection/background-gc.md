---
title: Coleta de lixo de fundo
description: Saiba mais sobre a coleta de lixo em plano .NET e como ela difere na coleta de lixo de estações de trabalho e servidores.
ms.date: 04/21/2020
helpviewer_keywords:
- garbage collection, background
- background garbage collection
ms.openlocfilehash: dcb1d348e679e07646273b8fbc4ea29b44ee4974
ms.sourcegitcommit: 73aa9653547a1cd70ee6586221f79cc29b588ebd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2020
ms.locfileid: "82103558"
---
# <a name="background-garbage-collection"></a><span data-ttu-id="2c726-103">Coleta de lixo de fundo</span><span class="sxs-lookup"><span data-stu-id="2c726-103">Background garbage collection</span></span>

<span data-ttu-id="2c726-104">Na coleta de lixo de fundo (GC), as gerações efêmeras (0 e 1) são coletadas conforme necessário enquanto a coleta da geração 2 está em andamento.</span><span class="sxs-lookup"><span data-stu-id="2c726-104">In background garbage collection (GC), ephemeral generations (0 and 1) are collected as needed while the collection of generation 2 is in progress.</span></span> <span data-ttu-id="2c726-105">A coleta de lixo em segundo plano é realizada em um ou mais threads dedicados, dependendo se é de fundo ou gc servidor, e se aplica apenas às coleções de geração 2.</span><span class="sxs-lookup"><span data-stu-id="2c726-105">Background garbage collection is performed on one or more dedicated threads, depending on whether it's background or server GC, and applies only to generation 2 collections.</span></span>

<span data-ttu-id="2c726-106">A coleta de lixo de fundo é habilitada por padrão.</span><span class="sxs-lookup"><span data-stu-id="2c726-106">Background garbage collection is enabled by default.</span></span> <span data-ttu-id="2c726-107">Ele pode ser ativado ou desativado com a configuração [gcConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) em aplicativos .NET Framework ou na configuração [System.GC.Simultâneo](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) em aplicativos .NET Core.</span><span class="sxs-lookup"><span data-stu-id="2c726-107">It can be enabled or disabled with the [gcConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) configuration setting in .NET Framework apps or the [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) setting in .NET Core apps.</span></span>

> [!NOTE]
> <span data-ttu-id="2c726-108">A coleta de lixo em segundo plano substitui [a coleta de lixo simultânea](#concurrent-garbage-collection) e está disponível nas versões .NET Framework 4 e posteriores.</span><span class="sxs-lookup"><span data-stu-id="2c726-108">Background garbage collection replaces [concurrent garbage collection](#concurrent-garbage-collection) and is available in .NET Framework 4 and later versions.</span></span> <span data-ttu-id="2c726-109">No Quadro .NET 4, ele é suportado apenas para coleta de lixo *de estações de trabalho.*</span><span class="sxs-lookup"><span data-stu-id="2c726-109">In .NET Framework 4, it's supported only for *workstation* garbage collection.</span></span> <span data-ttu-id="2c726-110">A partir do .NET Framework 4.5, a coleta de lixo em segundo plano está disponível tanto para a coleta de lixo *da estação de trabalho* quanto para o *servidor.*</span><span class="sxs-lookup"><span data-stu-id="2c726-110">Starting with .NET Framework 4.5, background garbage collection is available for both *workstation* and *server* garbage collection.</span></span>

<span data-ttu-id="2c726-111">Uma coleta de gerações efêmeras durante a coleta de lixo de fundo é conhecida como coleta de lixo *em primeiro plano.*</span><span class="sxs-lookup"><span data-stu-id="2c726-111">A collection on ephemeral generations during background garbage collection is known as *foreground* garbage collection.</span></span> <span data-ttu-id="2c726-112">Quando as coletas de lixo em primeiro plano ocorrem, todos os threads gerenciados são suspensos.</span><span class="sxs-lookup"><span data-stu-id="2c726-112">When foreground garbage collections occur, all managed threads are suspended.</span></span>

<span data-ttu-id="2c726-113">Quando a coleta de lixo de fundo está em andamento e você alocou objetos suficientes na geração 0, a CLR realiza uma coleta de lixo de geração 0 ou geração 1 em primeiro plano.</span><span class="sxs-lookup"><span data-stu-id="2c726-113">When background garbage collection is in progress and you've allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span></span> <span data-ttu-id="2c726-114">O thread dedicado de coleta de lixo em segundo plano verifica em pontos frequentes de segurança se há uma solicitação de coleta de lixo em primeiro plano.</span><span class="sxs-lookup"><span data-stu-id="2c726-114">The dedicated background garbage collection thread checks at frequent safe points to determine whether there is a request for foreground garbage collection.</span></span> <span data-ttu-id="2c726-115">Se houver, a coleta de plano de fundo suspende a si mesma para que a coleta de lixo em primeiro plano possa ocorrer.</span><span class="sxs-lookup"><span data-stu-id="2c726-115">If there is, the background collection suspends itself so that foreground garbage collection can occur.</span></span> <span data-ttu-id="2c726-116">Depois que a coleta de lixo em primeiro plano é concluída, os segmentos dedicados de coleta de lixo de fundo e os threads do usuário são retomados.</span><span class="sxs-lookup"><span data-stu-id="2c726-116">After the foreground garbage collection is completed, the dedicated background garbage collection threads and user threads resume.</span></span>

<span data-ttu-id="2c726-117">A coleta de lixo em segundo plano remove as restrições de alocação impostas pela coleta de lixo simultânea, pois as coletas de lixo efêmeras podem ocorrer durante a coleta de lixo em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="2c726-117">Background garbage collection removes allocation restrictions imposed by concurrent garbage collection, because ephemeral garbage collections can occur during background garbage collection.</span></span> <span data-ttu-id="2c726-118">A coleta de lixo de fundo pode remover objetos mortos em gerações efêmeras.</span><span class="sxs-lookup"><span data-stu-id="2c726-118">Background garbage collection can remove dead objects in ephemeral generations.</span></span> <span data-ttu-id="2c726-119">Também pode expandir o monte se necessário durante uma coleta de lixo de geração 1.</span><span class="sxs-lookup"><span data-stu-id="2c726-119">It can also expand the heap if needed during a generation 1 garbage collection.</span></span>

## <a name="background-workstation-vs-server-gc"></a><span data-ttu-id="2c726-120">Estação de trabalho de fundo vs. servidor GC</span><span class="sxs-lookup"><span data-stu-id="2c726-120">Background workstation vs. server GC</span></span>

<span data-ttu-id="2c726-121">A partir do .NET Framework 4.5, a coleta de lixo em segundo plano está disponível para o servidor GC.</span><span class="sxs-lookup"><span data-stu-id="2c726-121">Starting with .NET Framework 4.5, background garbage collection is available for server GC.</span></span> <span data-ttu-id="2c726-122">Background GC é o modo padrão para coleta de lixo do servidor.</span><span class="sxs-lookup"><span data-stu-id="2c726-122">Background GC is the default mode for server garbage collection.</span></span>

<span data-ttu-id="2c726-123">A coleta de lixo do servidor em segundo plano funciona de forma semelhante à coleta de lixo em segundo plano, mas há algumas diferenças:</span><span class="sxs-lookup"><span data-stu-id="2c726-123">Background server garbage collection functions similarly to background workstation garbage collection, but there are a few differences:</span></span>

- <span data-ttu-id="2c726-124">A coleta de lixo de base da estação de trabalho usa um segmento dedicado de coleta de lixo em segundo plano, enquanto a coleta de lixo do servidor em segundo plano usa vários threads.</span><span class="sxs-lookup"><span data-stu-id="2c726-124">Background workstation garbage collection uses one dedicated background garbage collection thread, whereas background server garbage collection uses multiple threads.</span></span> <span data-ttu-id="2c726-125">Normalmente, há um segmento dedicado para cada processador lógico.</span><span class="sxs-lookup"><span data-stu-id="2c726-125">Typically, there's a dedicated thread for each logical processor.</span></span>

- <span data-ttu-id="2c726-126">Ao contrário do segmento de coleta de lixo em segundo plano da estação de trabalho, os threads GC do servidor de fundo não têm tempo.</span><span class="sxs-lookup"><span data-stu-id="2c726-126">Unlike the workstation background garbage collection thread, the background server GC threads do not time out.</span></span>

<span data-ttu-id="2c726-127">A ilustração a seguir mostra a coleta de lixo *da estação de trabalho* em segundo plano realizada em um segmento separado e dedicado:</span><span class="sxs-lookup"><span data-stu-id="2c726-127">The following illustration shows background *workstation* garbage collection performed on a separate, dedicated thread:</span></span>

![Coleta de lixo de estação de trabalho em segundo plano](./media/fundamentals/background-workstation-garbage-collection.png)

<span data-ttu-id="2c726-129">A ilustração a seguir mostra a coleta de lixo do *servidor* em plano de fundo realizada em threads separados e dedicados:</span><span class="sxs-lookup"><span data-stu-id="2c726-129">The following illustration shows background *server* garbage collection performed on separate, dedicated threads:</span></span>

![Coleta de lixo de servidor em segundo plano](./media/fundamentals/background-server-garbage-collection.png)

## <a name="concurrent-garbage-collection"></a><span data-ttu-id="2c726-131">Coleta de lixo simultânea</span><span class="sxs-lookup"><span data-stu-id="2c726-131">Concurrent garbage collection</span></span>

> [!TIP]
> <span data-ttu-id="2c726-132">Esta seção aplica-se a:</span><span class="sxs-lookup"><span data-stu-id="2c726-132">This section applies to:</span></span>
>
> - <span data-ttu-id="2c726-133">.NET Framework 3.5 e anteriormente para coleta de lixo de estação de trabalho</span><span class="sxs-lookup"><span data-stu-id="2c726-133">.NET Framework 3.5 and earlier for workstation garbage collection</span></span>
> - <span data-ttu-id="2c726-134">.NET Framework 4 e anteriorpara coleta de lixo do servidor</span><span class="sxs-lookup"><span data-stu-id="2c726-134">.NET Framework 4 and earlier for server garbage collection</span></span>
>
> <span data-ttu-id="2c726-135">O lixo simultâneo é substituído pela coleta de lixo de fundo em versões posteriores.</span><span class="sxs-lookup"><span data-stu-id="2c726-135">Concurrent garbage is replaced by background garbage collection in later versions.</span></span>

<span data-ttu-id="2c726-136">Na coleta de lixo de estação de trabalho ou servidor, você pode [habilitar a coleta simultânea](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md)de lixo, o que permite que os threads funcionem simultaneamente com um segmento dedicado que realiza a coleta de lixo durante a maior parte da duração da coleta.</span><span class="sxs-lookup"><span data-stu-id="2c726-136">In workstation or server garbage collection, you can [enable concurrent garbage collection](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), which enables threads to run concurrently with a dedicated thread that performs the garbage collection for most of the duration of the collection.</span></span> <span data-ttu-id="2c726-137">Essa opção afeta apenas as coletas de lixo na geração 2; gerações 0 e 1 são sempre não simultâneas porque terminam rápido.</span><span class="sxs-lookup"><span data-stu-id="2c726-137">This option affects only garbage collections in generation 2; generations 0 and 1 are always non-concurrent because they finish fast.</span></span>

<span data-ttu-id="2c726-138">A coleta de lixo simultânea permite que aplicativos interativos sejam mais responsivos minimizando a pausa para uma coleta.</span><span class="sxs-lookup"><span data-stu-id="2c726-138">Concurrent garbage collection enables interactive applications to be more responsive by minimizing pauses for a collection.</span></span> <span data-ttu-id="2c726-139">Na maioria das vezes, a execução dos threads gerenciados pode continuar enquanto o thread de coleta de lixo simultânea estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="2c726-139">Managed threads can continue to run most of the time while the concurrent garbage collection thread is running.</span></span> <span data-ttu-id="2c726-140">Isso resulta em pausas menores enquanto uma coleta de lixo estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="2c726-140">This results in shorter pauses while a garbage collection is occurring.</span></span>

<span data-ttu-id="2c726-141">A coleta de lixo simultânea é executada em um thread dedicado.</span><span class="sxs-lookup"><span data-stu-id="2c726-141">Concurrent garbage collection is performed on a dedicated thread.</span></span> <span data-ttu-id="2c726-142">Por padrão, a CLR executa a coleta de lixo da estação de trabalho com coleta de lixo simultânea ativada em computadores de processador único e vários processadores.</span><span class="sxs-lookup"><span data-stu-id="2c726-142">By default, the CLR runs workstation garbage collection with concurrent garbage collection enabled on both single-processor and multi-processor computers.</span></span>

<span data-ttu-id="2c726-143">A ilustração a seguir mostra a coleta de lixo simultânea executada em um thread dedicado separado.</span><span class="sxs-lookup"><span data-stu-id="2c726-143">The following illustration shows concurrent garbage collection performed on a separate dedicated thread.</span></span>

![Fios de coleta de lixo simultâneos](./media/gc-concurrent.png)

## <a name="see-also"></a><span data-ttu-id="2c726-145">Confira também</span><span class="sxs-lookup"><span data-stu-id="2c726-145">See also</span></span>

- [<span data-ttu-id="2c726-146">Coleta de lixo de estação de trabalho ou de servidor</span><span class="sxs-lookup"><span data-stu-id="2c726-146">Workstation and server garbage collection</span></span>](workstation-server-gc.md)
- [<span data-ttu-id="2c726-147">Opções de configuração em tempo de execução para coleta de lixo</span><span class="sxs-lookup"><span data-stu-id="2c726-147">Run-time configuration options for garbage collection</span></span>](../../core/run-time-config/garbage-collector.md)
