---
title: Coleta de lixo em segundo plano
description: Saiba mais sobre a coleta de lixo em segundo plano no .NET e como ela difere na coleta de lixo da estação de trabalho e do servidor.
ms.date: 04/21/2020
helpviewer_keywords:
- garbage collection, background
- background garbage collection
ms.openlocfilehash: bf88c14b2aeed94a548b6116749fa8669576afe1
ms.sourcegitcommit: ef50c99928183a0bba75e07b9f22895cd4c480f8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/07/2020
ms.locfileid: "87916996"
---
# <a name="background-garbage-collection"></a><span data-ttu-id="6c0d8-103">Coleta de lixo em segundo plano</span><span class="sxs-lookup"><span data-stu-id="6c0d8-103">Background garbage collection</span></span>

<span data-ttu-id="6c0d8-104">Na coleta de lixo em segundo plano (GC), as gerações efêmeras (0 e 1) são coletadas conforme necessário enquanto a coleta da geração 2 está em andamento.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-104">In background garbage collection (GC), ephemeral generations (0 and 1) are collected as needed while the collection of generation 2 is in progress.</span></span> <span data-ttu-id="6c0d8-105">A coleta de lixo em segundo plano é executada em um ou mais threads dedicados, dependendo se é o GC do servidor ou em segundo plano e se aplica somente às coleções da geração 2.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-105">Background garbage collection is performed on one or more dedicated threads, depending on whether it's background or server GC, and applies only to generation 2 collections.</span></span>

<span data-ttu-id="6c0d8-106">A coleta de lixo em segundo plano está habilitada por padrão.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-106">Background garbage collection is enabled by default.</span></span> <span data-ttu-id="6c0d8-107">Ele pode ser habilitado ou desabilitado com o parâmetro de configuração [gcConcurrent](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) em aplicativos .NET Framework ou a configuração [System. GC. Decurrent](../../core/run-time-config/garbage-collector.md#background-gc) no .NET Core e no .NET 5 e em aplicativos posteriores.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-107">It can be enabled or disabled with the [gcConcurrent](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) configuration setting in .NET Framework apps or the [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#background-gc) setting in .NET Core and .NET 5 and later apps.</span></span>

> [!NOTE]
> <span data-ttu-id="6c0d8-108">A coleta de lixo em segundo plano substitui a [coleta de lixo simultânea](#concurrent-garbage-collection) e está disponível no .NET Framework 4 e em versões posteriores.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-108">Background garbage collection replaces [concurrent garbage collection](#concurrent-garbage-collection) and is available in .NET Framework 4 and later versions.</span></span> <span data-ttu-id="6c0d8-109">No .NET Framework 4, há suporte apenas para coleta de lixo de *estação de trabalho* .</span><span class="sxs-lookup"><span data-stu-id="6c0d8-109">In .NET Framework 4, it's supported only for *workstation* garbage collection.</span></span> <span data-ttu-id="6c0d8-110">A partir do .NET Framework 4,5, a coleta de lixo em segundo plano está disponível para a coleta de lixo da *estação de trabalho* e do *servidor* .</span><span class="sxs-lookup"><span data-stu-id="6c0d8-110">Starting with .NET Framework 4.5, background garbage collection is available for both *workstation* and *server* garbage collection.</span></span>

<span data-ttu-id="6c0d8-111">Uma coleção em gerações efêmeras durante a coleta de lixo em segundo plano é conhecida como coleta de lixo em *primeiro plano* .</span><span class="sxs-lookup"><span data-stu-id="6c0d8-111">A collection on ephemeral generations during background garbage collection is known as *foreground* garbage collection.</span></span> <span data-ttu-id="6c0d8-112">Quando as coletas de lixo em primeiro plano ocorrem, todos os threads gerenciados são suspensos.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-112">When foreground garbage collections occur, all managed threads are suspended.</span></span>

<span data-ttu-id="6c0d8-113">Quando a coleta de lixo em segundo plano estiver em andamento e você tiver alocado objetos suficientes na geração 0, o CLR executará uma coleta de lixo de primeiro plano de geração 0 ou geração 1.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-113">When background garbage collection is in progress and you've allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span></span> <span data-ttu-id="6c0d8-114">O thread dedicado de coleta de lixo em segundo plano verifica em pontos frequentes de segurança se há uma solicitação de coleta de lixo em primeiro plano.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-114">The dedicated background garbage collection thread checks at frequent safe points to determine whether there is a request for foreground garbage collection.</span></span> <span data-ttu-id="6c0d8-115">Se houver, a coleta de plano de fundo suspende a si mesma para que a coleta de lixo em primeiro plano possa ocorrer.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-115">If there is, the background collection suspends itself so that foreground garbage collection can occur.</span></span> <span data-ttu-id="6c0d8-116">Após a conclusão da coleta de lixo em primeiro plano, os threads de coleta de lixo e os threads de usuário dedicados são retomados.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-116">After the foreground garbage collection is completed, the dedicated background garbage collection threads and user threads resume.</span></span>

<span data-ttu-id="6c0d8-117">A coleta de lixo em segundo plano remove as restrições de alocação impostas pela coleta de lixo simultânea, pois as coletas de lixo efêmeras podem ocorrer durante a coleta de lixo em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-117">Background garbage collection removes allocation restrictions imposed by concurrent garbage collection, because ephemeral garbage collections can occur during background garbage collection.</span></span> <span data-ttu-id="6c0d8-118">A coleta de lixo em segundo plano pode remover objetos inativos em gerações efêmeras.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-118">Background garbage collection can remove dead objects in ephemeral generations.</span></span> <span data-ttu-id="6c0d8-119">Ele também pode expandir o heap, se necessário, durante uma coleta de lixo de geração 1.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-119">It can also expand the heap if needed during a generation 1 garbage collection.</span></span>

## <a name="background-workstation-vs-server-gc"></a><span data-ttu-id="6c0d8-120">Estação de trabalho em segundo plano vs. servidor GC</span><span class="sxs-lookup"><span data-stu-id="6c0d8-120">Background workstation vs. server GC</span></span>

<span data-ttu-id="6c0d8-121">A partir do .NET Framework 4,5, a coleta de lixo em segundo plano está disponível para GC do servidor.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-121">Starting with .NET Framework 4.5, background garbage collection is available for server GC.</span></span> <span data-ttu-id="6c0d8-122">O GC em segundo plano é o modo padrão para a coleta de lixo do servidor.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-122">Background GC is the default mode for server garbage collection.</span></span>

<span data-ttu-id="6c0d8-123">A coleta de lixo do servidor em segundo plano funciona de modo semelhante à coleta de lixo da estação de trabalho em segundo plano, mas há algumas diferenças:</span><span class="sxs-lookup"><span data-stu-id="6c0d8-123">Background server garbage collection functions similarly to background workstation garbage collection, but there are a few differences:</span></span>

- <span data-ttu-id="6c0d8-124">A coleta de lixo da estação de trabalho em segundo plano usa um thread de coleta de lixo de segundo plano dedicado, enquanto a coleta de lixo do servidor de segundo</span><span class="sxs-lookup"><span data-stu-id="6c0d8-124">Background workstation garbage collection uses one dedicated background garbage collection thread, whereas background server garbage collection uses multiple threads.</span></span> <span data-ttu-id="6c0d8-125">Normalmente, há um thread dedicado para cada processador lógico.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-125">Typically, there's a dedicated thread for each logical processor.</span></span>

- <span data-ttu-id="6c0d8-126">Diferentemente do thread de coleta de lixo em segundo plano da estação de trabalho, os threads GC do servidor em segundo plano não expiram</span><span class="sxs-lookup"><span data-stu-id="6c0d8-126">Unlike the workstation background garbage collection thread, the background server GC threads do not time out.</span></span>

<span data-ttu-id="6c0d8-127">A ilustração a seguir mostra a coleta de lixo da *estação de trabalho* em segundo plano executada em um thread separado e dedicado:</span><span class="sxs-lookup"><span data-stu-id="6c0d8-127">The following illustration shows background *workstation* garbage collection performed on a separate, dedicated thread:</span></span>

![Coleta de lixo de estação de trabalho em segundo plano](media/fundamentals/background-workstation-garbage-collection.png)

<span data-ttu-id="6c0d8-129">A ilustração a seguir mostra a coleta de lixo *do servidor* em segundo plano executada em threads separados e dedicados:</span><span class="sxs-lookup"><span data-stu-id="6c0d8-129">The following illustration shows background *server* garbage collection performed on separate, dedicated threads:</span></span>

![Coleta de lixo de servidor em segundo plano](media/fundamentals/background-server-garbage-collection.png)

## <a name="concurrent-garbage-collection"></a><span data-ttu-id="6c0d8-131">Coleta de lixo simultânea</span><span class="sxs-lookup"><span data-stu-id="6c0d8-131">Concurrent garbage collection</span></span>

> [!TIP]
> <span data-ttu-id="6c0d8-132">Esta seção aplica-se a:</span><span class="sxs-lookup"><span data-stu-id="6c0d8-132">This section applies to:</span></span>
>
> - <span data-ttu-id="6c0d8-133">.NET Framework 3,5 e anteriores para coleta de lixo de estação de trabalho</span><span class="sxs-lookup"><span data-stu-id="6c0d8-133">.NET Framework 3.5 and earlier for workstation garbage collection</span></span>
> - <span data-ttu-id="6c0d8-134">.NET Framework 4 e anterior para coleta de lixo do servidor</span><span class="sxs-lookup"><span data-stu-id="6c0d8-134">.NET Framework 4 and earlier for server garbage collection</span></span>
>
> <span data-ttu-id="6c0d8-135">O lixo simultâneo é substituído pela coleta de lixo em segundo plano em versões posteriores.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-135">Concurrent garbage is replaced by background garbage collection in later versions.</span></span>

<span data-ttu-id="6c0d8-136">Na coleta de lixo da estação de trabalho ou do servidor, você pode [habilitar a coleta de lixo simultânea](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), o que permite que os threads sejam executados simultaneamente com um thread dedicado que executa a coleta de lixo para a maior parte da duração da coleção.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-136">In workstation or server garbage collection, you can [enable concurrent garbage collection](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), which enables threads to run concurrently with a dedicated thread that performs the garbage collection for most of the duration of the collection.</span></span> <span data-ttu-id="6c0d8-137">Essa opção afeta apenas as coletas de lixo na geração 2; as gerações 0 e 1 são sempre não simultâneas porque elas são concluídas rapidamente.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-137">This option affects only garbage collections in generation 2; generations 0 and 1 are always non-concurrent because they finish fast.</span></span>

<span data-ttu-id="6c0d8-138">A coleta de lixo simultânea permite que aplicativos interativos sejam mais responsivos minimizando a pausa para uma coleta.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-138">Concurrent garbage collection enables interactive applications to be more responsive by minimizing pauses for a collection.</span></span> <span data-ttu-id="6c0d8-139">Na maioria das vezes, a execução dos threads gerenciados pode continuar enquanto o thread de coleta de lixo simultânea estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-139">Managed threads can continue to run most of the time while the concurrent garbage collection thread is running.</span></span> <span data-ttu-id="6c0d8-140">Esse design resulta em pausas mais curtas enquanto uma coleta de lixo está ocorrendo.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-140">This design results in shorter pauses while a garbage collection is occurring.</span></span>

<span data-ttu-id="6c0d8-141">A coleta de lixo simultânea é executada em um thread dedicado.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-141">Concurrent garbage collection is performed on a dedicated thread.</span></span> <span data-ttu-id="6c0d8-142">Por padrão, o CLR executa a coleta de lixo da estação de trabalho com a coleta de lixo simultânea habilitada em computadores com processador único e com vários processadores.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-142">By default, the CLR runs workstation garbage collection with concurrent garbage collection enabled on both single-processor and multi-processor computers.</span></span>

<span data-ttu-id="6c0d8-143">A ilustração a seguir mostra a coleta de lixo simultânea executada em um thread dedicado separado.</span><span class="sxs-lookup"><span data-stu-id="6c0d8-143">The following illustration shows concurrent garbage collection performed on a separate dedicated thread.</span></span>

![Threads de coleta de lixo simultâneos](media/gc-concurrent.png)

## <a name="see-also"></a><span data-ttu-id="6c0d8-145">Consulte também</span><span class="sxs-lookup"><span data-stu-id="6c0d8-145">See also</span></span>

- [<span data-ttu-id="6c0d8-146">Coleta de lixo de estação de trabalho ou de servidor</span><span class="sxs-lookup"><span data-stu-id="6c0d8-146">Workstation and server garbage collection</span></span>](workstation-server-gc.md)
- [<span data-ttu-id="6c0d8-147">Opções de configuração de tempo de execução para coleta de lixo</span><span class="sxs-lookup"><span data-stu-id="6c0d8-147">Run-time configuration options for garbage collection</span></span>](../../core/run-time-config/garbage-collector.md)
