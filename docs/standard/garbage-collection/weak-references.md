---
title: Referências fracas
description: Saiba mais sobre referências fracas, que permitem que o coletor de lixo do .NET colete um objeto e, ao mesmo tempo, permita que o aplicativo acesse o objeto.
ms.date: 03/30/2017
helpviewer_keywords:
- weak references, short
- weak references, using
- weak references, long
- garbage collection, weak references
ms.assetid: 6a600fe5-3af3-4c64-82da-10a0a8e2d79b
ms.openlocfilehash: 40d17009c98a73b7cb51779663360726c5fc7403
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94827354"
---
# <a name="weak-references"></a><span data-ttu-id="b6a08-103">Referências fracas</span><span class="sxs-lookup"><span data-stu-id="b6a08-103">Weak References</span></span>
<span data-ttu-id="b6a08-104">O coletor de lixo não pode coletar um objeto em uso por um aplicativo enquanto o código do aplicativo pode acessar esse objeto.</span><span class="sxs-lookup"><span data-stu-id="b6a08-104">The garbage collector cannot collect an object in use by an application while the application's code can reach that object.</span></span> <span data-ttu-id="b6a08-105">O aplicativo tem uma referência forte para o objeto.</span><span class="sxs-lookup"><span data-stu-id="b6a08-105">The application is said to have a strong reference to the object.</span></span>  
  
 <span data-ttu-id="b6a08-106">Uma referência fraca permite que o coletor de lixo colete o objeto enquanto ainda permite que o aplicativo o acesse.</span><span class="sxs-lookup"><span data-stu-id="b6a08-106">A weak reference permits the garbage collector to collect the object while still allowing the application to access the object.</span></span> <span data-ttu-id="b6a08-107">Uma referência fraca é válida somente durante o período indeterminado até que o objeto seja coletado quando não há nenhuma referência forte.</span><span class="sxs-lookup"><span data-stu-id="b6a08-107">A weak reference is valid only during the indeterminate amount of time until the object is collected when no strong references exist.</span></span> <span data-ttu-id="b6a08-108">Quando você usa uma referência fraca, o aplicativo ainda pode obter uma referência forte para o objeto, o que impede que ele seja coletado.</span><span class="sxs-lookup"><span data-stu-id="b6a08-108">When you use a weak reference, the application can still obtain a strong reference to the object, which prevents it from being collected.</span></span> <span data-ttu-id="b6a08-109">No entanto, sempre há o risco de o coletor de lixo obter o objeto primeiro antes de uma referência forte ser restabelecida.</span><span class="sxs-lookup"><span data-stu-id="b6a08-109">However, there is always the risk that the garbage collector will get to the object first before a strong reference is reestablished.</span></span>  
  
 <span data-ttu-id="b6a08-110">As referências fracas são úteis para objetos que usam muita memória, mas podem ser facilmente recriados se forem recuperados pela coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="b6a08-110">Weak references are useful for objects that use a lot of memory, but can be recreated easily if they are reclaimed by garbage collection.</span></span>  
  
 <span data-ttu-id="b6a08-111">Suponha que um modo de exibição de árvore em um aplicativo do Windows Forms exiba uma escolha hierárquica complexa de opções para o usuário.</span><span class="sxs-lookup"><span data-stu-id="b6a08-111">Suppose a tree view in a Windows Forms application displays a complex hierarchical choice of options to the user.</span></span> <span data-ttu-id="b6a08-112">Se os dados subjacentes forem grandes, manter a árvore na memória é ineficiente quando o usuário está envolvido com outra coisa no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b6a08-112">If the underlying data is large, keeping the tree in memory is inefficient when the user is involved with something else in the application.</span></span>  
  
 <span data-ttu-id="b6a08-113">Quando o usuário alterna para outra parte do aplicativo, você pode usar a classe <xref:System.WeakReference> para criar uma referência fraca para a árvore e destruir todas as referências fortes.</span><span class="sxs-lookup"><span data-stu-id="b6a08-113">When the user switches away to another part of the application, you can use the <xref:System.WeakReference> class to create a weak reference to the tree and destroy all strong references.</span></span> <span data-ttu-id="b6a08-114">Quando o usuário alterna de volta para a árvore, o aplicativo tenta obter uma referência forte para a árvore e, se tiver êxito, evita a reconstrução da árvore.</span><span class="sxs-lookup"><span data-stu-id="b6a08-114">When the user switches back to the tree, the application attempts to obtain a strong reference to the tree and, if successful, avoids reconstructing the tree.</span></span>  
  
 <span data-ttu-id="b6a08-115">Para estabelecer uma referência fraca com um objeto, você cria uma <xref:System.WeakReference> usando a instância do objeto a ser rastreada.</span><span class="sxs-lookup"><span data-stu-id="b6a08-115">To establish a weak reference with an object, you create a <xref:System.WeakReference> using the instance of the object to be tracked.</span></span> <span data-ttu-id="b6a08-116">Em seguida, você deve define a propriedade <xref:System.WeakReference.Target%2A> para aquele objeto e define a referência original para o objeto como `null`.</span><span class="sxs-lookup"><span data-stu-id="b6a08-116">You then set the <xref:System.WeakReference.Target%2A> property to that object and set the original reference to the object to `null`.</span></span> <span data-ttu-id="b6a08-117">Para obter um exemplo de código, consulte <xref:System.WeakReference> na biblioteca de classes.</span><span class="sxs-lookup"><span data-stu-id="b6a08-117">For a code example, see <xref:System.WeakReference> in the class library.</span></span>  
  
## <a name="short-and-long-weak-references"></a><span data-ttu-id="b6a08-118">Referências fracas curtas e longas</span><span class="sxs-lookup"><span data-stu-id="b6a08-118">Short and Long Weak References</span></span>  
 <span data-ttu-id="b6a08-119">Você pode criar uma referência fraca curta ou uma referência fraca longa:</span><span class="sxs-lookup"><span data-stu-id="b6a08-119">You can create a short weak reference or a long weak reference:</span></span>  
  
- <span data-ttu-id="b6a08-120">Short</span><span class="sxs-lookup"><span data-stu-id="b6a08-120">Short</span></span>  
  
     <span data-ttu-id="b6a08-121">O destino de uma referência fraca curta se torna `null` quando o objeto é recuperado pela coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="b6a08-121">The target of a short weak reference becomes `null` when the object is reclaimed by garbage collection.</span></span> <span data-ttu-id="b6a08-122">A referência fraca é um objeto gerenciado e está sujeita à coleta de lixo assim como qualquer outro objeto gerenciado.</span><span class="sxs-lookup"><span data-stu-id="b6a08-122">The weak reference is itself a managed object, and is subject to garbage collection just like any other managed object.</span></span>  <span data-ttu-id="b6a08-123">Uma referência fraca curta é o construtor sem parâmetros para <xref:System.WeakReference>.</span><span class="sxs-lookup"><span data-stu-id="b6a08-123">A short weak reference is the parameterless constructor for <xref:System.WeakReference>.</span></span>  
  
- <span data-ttu-id="b6a08-124">long</span><span class="sxs-lookup"><span data-stu-id="b6a08-124">Long</span></span>  
  
     <span data-ttu-id="b6a08-125">Uma referência fraca longa é mantida após o método <xref:System.Object.Finalize%2A> do objeto ter sido chamado.</span><span class="sxs-lookup"><span data-stu-id="b6a08-125">A long weak reference is retained after the object's <xref:System.Object.Finalize%2A> method has been called.</span></span> <span data-ttu-id="b6a08-126">Isso permite que o objeto seja recriado, mas o estado do objeto permanece imprevisível.</span><span class="sxs-lookup"><span data-stu-id="b6a08-126">This allows the object to be recreated, but the state of the object remains unpredictable.</span></span> <span data-ttu-id="b6a08-127">Para usar uma referência longa, especifique `true` no construtor <xref:System.WeakReference>.</span><span class="sxs-lookup"><span data-stu-id="b6a08-127">To use a long reference, specify `true` in the <xref:System.WeakReference> constructor.</span></span>  
  
     <span data-ttu-id="b6a08-128">Se o tipo de objeto não tiver um método <xref:System.Object.Finalize%2A>, a funcionalidade de referência fraca curta é aplicada e a referência fraca é válida apenas até o destino ser coletado, o que pode ocorrer a qualquer momento após o finalizador ser executado.</span><span class="sxs-lookup"><span data-stu-id="b6a08-128">If the object's type does not have a <xref:System.Object.Finalize%2A> method, the short weak reference functionality applies and the weak reference is valid only until the target is collected, which can occur anytime after the finalizer is run.</span></span>  
  
 <span data-ttu-id="b6a08-129">Para estabelecer uma referência forte e usar o objeto novamente, converta a propriedade <xref:System.WeakReference.Target%2A> de um <xref:System.WeakReference> para o tipo do objeto.</span><span class="sxs-lookup"><span data-stu-id="b6a08-129">To establish a strong reference and use the object again, cast the <xref:System.WeakReference.Target%2A> property of a <xref:System.WeakReference> to the type of the object.</span></span> <span data-ttu-id="b6a08-130">Se a propriedade <xref:System.WeakReference.Target%2A> retornar `null`, o objeto terá sido coletado, caso contrário, continue usando o objeto, pois o aplicativo recuperou uma referência forte para ele.</span><span class="sxs-lookup"><span data-stu-id="b6a08-130">If the <xref:System.WeakReference.Target%2A> property returns `null`, the object was collected; otherwise, you can continue to use the object because the application has regained a strong reference to it.</span></span>  
  
## <a name="guidelines-for-using-weak-references"></a><span data-ttu-id="b6a08-131">Diretrizes para usar referências fracas</span><span class="sxs-lookup"><span data-stu-id="b6a08-131">Guidelines for Using Weak References</span></span>  
 <span data-ttu-id="b6a08-132">Use referências fracas longas somente quando necessário, uma vez que o estado do objeto é imprevisível após a finalização.</span><span class="sxs-lookup"><span data-stu-id="b6a08-132">Use long weak references only when necessary as the state of the object is unpredictable after finalization.</span></span>  
  
 <span data-ttu-id="b6a08-133">Evite usar referências fracas para objetos pequenos, pois o ponteiro em si pode ser tão grande quanto ou maior.</span><span class="sxs-lookup"><span data-stu-id="b6a08-133">Avoid using weak references to small objects because the pointer itself may be as large or larger.</span></span>  
  
 <span data-ttu-id="b6a08-134">Evite usar referências fracas como uma solução automática para problemas de gerenciamento de memória.</span><span class="sxs-lookup"><span data-stu-id="b6a08-134">Avoid using weak references as an automatic solution to memory management problems.</span></span> <span data-ttu-id="b6a08-135">Em vez disso, desenvolva uma política de cache efetiva para lidar com os objetos do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b6a08-135">Instead, develop an effective caching policy for handling your application's objects.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b6a08-136">Confira também</span><span class="sxs-lookup"><span data-stu-id="b6a08-136">See also</span></span>

- [<span data-ttu-id="b6a08-137">Coleta de lixo</span><span class="sxs-lookup"><span data-stu-id="b6a08-137">Garbage Collection</span></span>](index.md)
