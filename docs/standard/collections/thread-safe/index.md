---
title: Coleções thread-safe
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: ''
ms.suite: ''
ms.technology: dotnet-standard
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- thread-safe collections, overview
ms.assetid: 2e7ca21f-786c-4367-96be-0cf3f3dcc6bd
caps.latest.revision: 24
author: mairaw
ms.author: mairaw
manager: wpickett
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 5850335a13960df9094c1a6276799de043eb28f3
ms.sourcegitcommit: 86adcc06e35390f13c1e372c36d2e044f1fc31ef
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/26/2018
---
# <a name="thread-safe-collections"></a><span data-ttu-id="b2111-102">Coleções thread-safe</span><span class="sxs-lookup"><span data-stu-id="b2111-102">Thread-Safe Collections</span></span>
<span data-ttu-id="b2111-103">O [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] introduz o namespace <xref:System.Collections.Concurrent?displayProperty=nameWithType> que inclui várias classes de coleção que são tanto thread-safe quanto escalonáveis.</span><span class="sxs-lookup"><span data-stu-id="b2111-103">The [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] introduces the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, which includes several collection classes that are both thread-safe and scalable.</span></span> <span data-ttu-id="b2111-104">Vários threads podem adicionar ou remover itens dessas coleções de modo seguro e eficiente sem a necessidade de sincronização adicional no código do usuário.</span><span class="sxs-lookup"><span data-stu-id="b2111-104">Multiple threads can safely and efficiently add or remove items from these collections, without requiring additional synchronization in user code.</span></span> <span data-ttu-id="b2111-105">Ao escrever novo código, use as classes de coleção simultâneas sempre que a coleção for gravada em vários threads simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="b2111-105">When you write new code, use the concurrent collection classes whenever the collection will be writing to multiple threads concurrently.</span></span> <span data-ttu-id="b2111-106">Se estiver lendo apenas de uma coleção compartilhada, você poderá usar as classes no namespace <xref:System.Collections.Generic?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b2111-106">If you are only reading from a shared collection, then you can use the classes in the <xref:System.Collections.Generic?displayProperty=nameWithType> namespace.</span></span> <span data-ttu-id="b2111-107">É recomendável não usar as classes da coleção 1.0, a menos que você precise ter como destino o tempo de execução do .NET Framework 1.1 ou anterior.</span><span class="sxs-lookup"><span data-stu-id="b2111-107">We recommend that you do not use 1.0 collection classes unless you are required to target the .NET Framework 1.1 or earlier runtime.</span></span>  
  
## <a name="thread-synchronization-in-the-net-framework-10-and-20-collections"></a><span data-ttu-id="b2111-108">Sincronização de thread nas coleções do .NET Framework 1.0 e 2.0</span><span class="sxs-lookup"><span data-stu-id="b2111-108">Thread Synchronization in the .NET Framework 1.0 and 2.0 Collections</span></span>  
 <span data-ttu-id="b2111-109">As coleções introduzidas no .NET Framework 1.0 são encontradas no namespace <xref:System.Collections?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b2111-109">The collections introduced in the .NET Framework 1.0 are found in the <xref:System.Collections?displayProperty=nameWithType> namespace.</span></span> <span data-ttu-id="b2111-110">Essas coleções, que incluem os comumente usados <xref:System.Collections.ArrayList> e <xref:System.Collections.Hashtable>, fornecem algum acesso thread-safe por meio da propriedade `Synchronized`, que retorna um wrapper thread-safe em torno da coleção.</span><span class="sxs-lookup"><span data-stu-id="b2111-110">These collections, which include the commonly used <xref:System.Collections.ArrayList> and <xref:System.Collections.Hashtable>, provide some thread-safety through the `Synchronized` property, which returns a thread-safe wrapper around the collection.</span></span> <span data-ttu-id="b2111-111">O wrapper funciona bloqueando toda a coleção a cada operação de adição ou remoção.</span><span class="sxs-lookup"><span data-stu-id="b2111-111">The wrapper works by locking the entire collection on every add or remove operation.</span></span> <span data-ttu-id="b2111-112">Portanto, cada thread que está tentando acessar a coleção deve aguardar por sua vez para receber esse bloqueio.</span><span class="sxs-lookup"><span data-stu-id="b2111-112">Therefore, each thread that is attempting to access the collection must wait for its turn to take the one lock.</span></span> <span data-ttu-id="b2111-113">Isso não é escalonável e pode causar degradação significativa no desempenho para coleções grandes.</span><span class="sxs-lookup"><span data-stu-id="b2111-113">This is not scalable and can cause significant performance degradation for large collections.</span></span> <span data-ttu-id="b2111-114">Além disso, o design não é totalmente protegido contra condições de corrida.</span><span class="sxs-lookup"><span data-stu-id="b2111-114">Also, the design is not completely protected from race conditions.</span></span> <span data-ttu-id="b2111-115">Para saber mais, confira [Synchronization in Generic Collections](https://blogs.msdn.microsoft.com/bclteam/2005/03/15/synchronization-in-generic-collections-brian-grunkemeyer/) (Sincronização em coleções genéricas).</span><span class="sxs-lookup"><span data-stu-id="b2111-115">For more information, see [Synchronization in Generic Collections](https://blogs.msdn.microsoft.com/bclteam/2005/03/15/synchronization-in-generic-collections-brian-grunkemeyer/).</span></span>  
  
 <span data-ttu-id="b2111-116">As classes de coleções introduzidas no .NET Framework 2.0 são encontradas no namespace <xref:System.Collections.Generic?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b2111-116">The collection classes introduced in the .NET Framework 2.0 are found in the <xref:System.Collections.Generic?displayProperty=nameWithType> namespace.</span></span> <span data-ttu-id="b2111-117">Entre elas <xref:System.Collections.Generic.List%601>, <xref:System.Collections.Generic.Dictionary%602> e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="b2111-117">These include <xref:System.Collections.Generic.List%601>, <xref:System.Collections.Generic.Dictionary%602>, and so on.</span></span> <span data-ttu-id="b2111-118">Essas classes fornecem desempenho e segurança de tipos aprimorados em comparação com as classes do .NET Framework 1.0.</span><span class="sxs-lookup"><span data-stu-id="b2111-118">These classes provide improved type safety and performance compared to the .NET Framework 1.0 classes.</span></span> <span data-ttu-id="b2111-119">No entanto, as classes de coleção do .NET Framework 2.0 não fornecem nenhuma sincronização de thread; o código de usuário deve fornecer sincronização quando itens são adicionados ou removidos simultaneamente em vários threads.</span><span class="sxs-lookup"><span data-stu-id="b2111-119">However, the .NET Framework 2.0 collection classes do not provide any thread synchronization; user code must provide all synchronization when items are added or removed on multiple threads concurrently.</span></span>  
  
 <span data-ttu-id="b2111-120">O recomendável são as classes de coleções simultâneas [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)], pois elas fornecem não apenas a segurança de tipos das classes de coleção do .NET Framework 2.0, mas também acesso thread-safe mais eficiente e completo do que o fornecido pelas coleções [!INCLUDE[net_v10_short](../../../../includes/net-v10-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b2111-120">We recommend the concurrent collections classes in the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] because they provide not only the type safety of the .NET Framework 2.0 collection classes, but also more efficient and more complete thread safety than the [!INCLUDE[net_v10_short](../../../../includes/net-v10-short-md.md)] collections provide.</span></span>  
  
## <a name="fine-grained-locking-and-lock-free-mechanisms"></a><span data-ttu-id="b2111-121">Bloqueio refinado e mecanismos sem bloqueio</span><span class="sxs-lookup"><span data-stu-id="b2111-121">Fine-Grained Locking and Lock-Free Mechanisms</span></span>  
 <span data-ttu-id="b2111-122">Alguns dos tipos de coleção simultâneos usam mecanismos de sincronização leves como <xref:System.Threading.SpinLock>, <xref:System.Threading.SpinWait>, <xref:System.Threading.SemaphoreSlim> e <xref:System.Threading.CountdownEvent>, que são novos no [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b2111-122">Some of the concurrent collection types use lightweight synchronization mechanisms such as <xref:System.Threading.SpinLock>, <xref:System.Threading.SpinWait>, <xref:System.Threading.SemaphoreSlim>, and <xref:System.Threading.CountdownEvent>, which are new in the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)].</span></span> <span data-ttu-id="b2111-123">Esses tipos de sincronização geralmente usam *giro ocupado* por breves períodos antes de colocarem o thread em um verdadeiro estado de espera.</span><span class="sxs-lookup"><span data-stu-id="b2111-123">These synchronization types typically use *busy spinning* for brief periods before they put the thread into a true Wait state.</span></span> <span data-ttu-id="b2111-124">Quando espera-se que os tempos de espera sejam muito curtos, girar é muito menos dispendioso em termos de recursos computacionais do que esperar, o que envolve uma transição de kernel que utiliza muitos recursos.</span><span class="sxs-lookup"><span data-stu-id="b2111-124">When wait times are expected to be very short, spinning is far less computationally expensive than waiting, which involves an expensive kernel transition.</span></span> <span data-ttu-id="b2111-125">Para classes de coleção que usam o giro, essa eficiência significa que vários threads podem adicionar e remover itens em uma taxa muito alta.</span><span class="sxs-lookup"><span data-stu-id="b2111-125">For collection classes that use spinning, this efficiency means that multiple threads can add and remove items at a very high rate.</span></span> <span data-ttu-id="b2111-126">Para saber mais sobre rotação versus bloqueio, confira [SpinLock](../../../../docs/standard/threading/spinlock.md) e [SpinWait](../../../../docs/standard/threading/spinwait.md).</span><span class="sxs-lookup"><span data-stu-id="b2111-126">For more information about spinning vs. blocking, see [SpinLock](../../../../docs/standard/threading/spinlock.md) and [SpinWait](../../../../docs/standard/threading/spinwait.md).</span></span>  
  
 <span data-ttu-id="b2111-127">As classes <xref:System.Collections.Concurrent.ConcurrentQueue%601> e <xref:System.Collections.Concurrent.ConcurrentStack%601> não usam bloqueios.</span><span class="sxs-lookup"><span data-stu-id="b2111-127">The <xref:System.Collections.Concurrent.ConcurrentQueue%601> and <xref:System.Collections.Concurrent.ConcurrentStack%601> classes do not use locks at all.</span></span> <span data-ttu-id="b2111-128">Em vez disso, elas usam operações do <xref:System.Threading.Interlocked> para obter acesso thread-safe.</span><span class="sxs-lookup"><span data-stu-id="b2111-128">Instead, they rely on <xref:System.Threading.Interlocked> operations to achieve thread-safety.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b2111-129">Considerando que as classes de coleções simultâneas dão suporte a <xref:System.Collections.ICollection>, elas fornecem implementações para as propriedades <xref:System.Collections.ICollection.IsSynchronized%2A> e <xref:System.Collections.ICollection.SyncRoot%2A>, embora essas propriedades sejam irrelevantes.</span><span class="sxs-lookup"><span data-stu-id="b2111-129">Because the concurrent collections classes support <xref:System.Collections.ICollection>, they provide implementations for the <xref:System.Collections.ICollection.IsSynchronized%2A> and <xref:System.Collections.ICollection.SyncRoot%2A> properties, even though these properties are irrelevant.</span></span> <span data-ttu-id="b2111-130">`IsSynchronized` sempre retorna `false` e `SyncRoot` é sempre `null` (`Nothing` no Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="b2111-130">`IsSynchronized` always returns `false` and `SyncRoot` is always `null` (`Nothing` in Visual Basic).</span></span>  
  
 <span data-ttu-id="b2111-131">A tabela a seguir lista os tipos de coleção no namespace <xref:System.Collections.Concurrent?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b2111-131">The following table lists the collection types in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace.</span></span>  
  
|<span data-ttu-id="b2111-132">Tipo</span><span class="sxs-lookup"><span data-stu-id="b2111-132">Type</span></span>|<span data-ttu-id="b2111-133">Descrição</span><span class="sxs-lookup"><span data-stu-id="b2111-133">Description</span></span>|  
|----------|-----------------|  
|<xref:System.Collections.Concurrent.BlockingCollection%601>|<span data-ttu-id="b2111-134">Fornece funcionalidade de delimitação e bloqueio de qualquer tipo que implemente <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="b2111-134">Provides bounding and blocking functionality for any type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span></span> <span data-ttu-id="b2111-135">Para obter mais informações, veja [Visão geral de BlockingCollection](../../../../docs/standard/collections/thread-safe/blockingcollection-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b2111-135">For more information, see [BlockingCollection Overview](../../../../docs/standard/collections/thread-safe/blockingcollection-overview.md).</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentDictionary%602>|<span data-ttu-id="b2111-136">Implementação thread-safe de um dicionário de pares chave-valor.</span><span class="sxs-lookup"><span data-stu-id="b2111-136">Thread-safe implementation of a dictionary of key-value pairs.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentQueue%601>|<span data-ttu-id="b2111-137">Implementação thread-safe de uma fila PEPS (primeiro a entrar, primeiro a sair).</span><span class="sxs-lookup"><span data-stu-id="b2111-137">Thread-safe implementation of a FIFO (first-in, first-out) queue.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentStack%601>|<span data-ttu-id="b2111-138">Implementação thread-safe de uma fila LIFO (último a entrar, primeiro a sair).</span><span class="sxs-lookup"><span data-stu-id="b2111-138">Thread-safe implementation of a LIFO (last-in, first-out) stack.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentBag%601>|<span data-ttu-id="b2111-139">Implementação thread-safe de uma coleção não ordenada de elementos.</span><span class="sxs-lookup"><span data-stu-id="b2111-139">Thread-safe implementation of an unordered collection of elements.</span></span>|  
|<xref:System.Collections.Concurrent.IProducerConsumerCollection%601>|<span data-ttu-id="b2111-140">A interface que um tipo deve implementar para uso em um `BlockingCollection`.</span><span class="sxs-lookup"><span data-stu-id="b2111-140">The interface that a type must implement to be used in a `BlockingCollection`.</span></span>|  
  
## <a name="related-topics"></a><span data-ttu-id="b2111-141">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="b2111-141">Related Topics</span></span>  
  
|<span data-ttu-id="b2111-142">Título</span><span class="sxs-lookup"><span data-stu-id="b2111-142">Title</span></span>|<span data-ttu-id="b2111-143">Descrição</span><span class="sxs-lookup"><span data-stu-id="b2111-143">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="b2111-144">Visão geral de BlockingCollection</span><span class="sxs-lookup"><span data-stu-id="b2111-144">BlockingCollection Overview</span></span>](../../../../docs/standard/collections/thread-safe/blockingcollection-overview.md)|<span data-ttu-id="b2111-145">Este tópico descreve a funcionalidade fornecida pelo tipo <xref:System.Collections.Concurrent.BlockingCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="b2111-145">Describes the functionality provided by the <xref:System.Collections.Concurrent.BlockingCollection%601> type.</span></span>|  
|[<span data-ttu-id="b2111-146">Como Adicionar e Remover Itens de um ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="b2111-146">How to: Add and Remove Items from a ConcurrentDictionary</span></span>](../../../../docs/standard/collections/thread-safe/how-to-add-and-remove-items.md)|<span data-ttu-id="b2111-147">Descreve como adicionar e remover elementos de um <xref:System.Collections.Concurrent.ConcurrentDictionary%602></span><span class="sxs-lookup"><span data-stu-id="b2111-147">Describes how to add and remove elements from a <xref:System.Collections.Concurrent.ConcurrentDictionary%602></span></span>|  
|[<span data-ttu-id="b2111-148">Como Adicionar e Retirar Itens Individualmente de uma BlockingCollection</span><span class="sxs-lookup"><span data-stu-id="b2111-148">How to: Add and Take Items Individually from a BlockingCollection</span></span>](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md)|<span data-ttu-id="b2111-149">Descreve como adicionar e recuperar itens de uma coleta de bloqueio sem usar o enumerador de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="b2111-149">Describes how to add and retrieve items from a blocking collection without using the read-only enumerator.</span></span>|  
|[<span data-ttu-id="b2111-150">Como Adicionar a Funcionalidade de Delimitação e Bloqueio a uma Coleção</span><span class="sxs-lookup"><span data-stu-id="b2111-150">How to: Add Bounding and Blocking Functionality to a Collection</span></span>](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md)|<span data-ttu-id="b2111-151">Descreve como usar qualquer classe de coleção como o mecanismo de armazenamento subjacente para uma coleção <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="b2111-151">Describes how to use any collection class as the underlying storage mechanism for an <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> collection.</span></span>|  
|[<span data-ttu-id="b2111-152">Como Usar ForEach para Remover Itens de uma BlockingCollection</span><span class="sxs-lookup"><span data-stu-id="b2111-152">How to: Use ForEach to Remove Items in a BlockingCollection</span></span>](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md)|<span data-ttu-id="b2111-153">Descreve como usar `foreach` (`For Each` no Visual Basic) para remover todos os itens em uma coleção de bloqueios.</span><span class="sxs-lookup"><span data-stu-id="b2111-153">Describes how to use `foreach`, (`For Each` in Visual Basic) to remove all items in a blocking collection.</span></span>|  
|[<span data-ttu-id="b2111-154">Como Usar Matrizes de Coleções Blocking em um Pipeline</span><span class="sxs-lookup"><span data-stu-id="b2111-154">How to: Use Arrays of Blocking Collections in a Pipeline</span></span>](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md)|<span data-ttu-id="b2111-155">Descreve como usar várias coleções de bloqueio ao mesmo tempo para implementar um pipeline.</span><span class="sxs-lookup"><span data-stu-id="b2111-155">Describes how to use multiple blocking collections at the same time to implement a pipeline.</span></span>|  
|[<span data-ttu-id="b2111-156">Como Criar um Pool de Objetos Usando um ConcurrentBag</span><span class="sxs-lookup"><span data-stu-id="b2111-156">How to: Create an Object Pool by Using a ConcurrentBag</span></span>](../../../../docs/standard/collections/thread-safe/how-to-create-an-object-pool.md)|<span data-ttu-id="b2111-157">Mostra como usar um recipiente simultâneo para melhorar o desempenho em cenários nos quais, em vez de criar novos objetos continuamente, você pode reutilizá-los.</span><span class="sxs-lookup"><span data-stu-id="b2111-157">Shows how to use a concurrent bag to improve performance in scenarios where you can reuse objects instead of continually creating new ones.</span></span>|  
  
## <a name="reference"></a><span data-ttu-id="b2111-158">Referência</span><span class="sxs-lookup"><span data-stu-id="b2111-158">Reference</span></span>  
 <xref:System.Collections.Concurrent?displayProperty=nameWithType>
