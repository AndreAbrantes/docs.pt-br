---
title: Visão geral de BlockingCollection
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 257435516b38d0e4389b7feceba68371bcc8f90e
ms.sourcegitcommit: ad99773e5e45068ce03b99518008397e1299e0d1
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/24/2018
ms.locfileid: "46711136"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="739cb-102">Visão geral de BlockingCollection</span><span class="sxs-lookup"><span data-stu-id="739cb-102">BlockingCollection Overview</span></span>
<span data-ttu-id="739cb-103"><xref:System.Collections.Concurrent.BlockingCollection%601> é uma classe de coleção thread-safe que fornece os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="739cb-103"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
-   <span data-ttu-id="739cb-104">Uma implementação do padrão de produtor-consumidor.</span><span class="sxs-lookup"><span data-stu-id="739cb-104">An implementation of the Producer-Consumer pattern.</span></span>  
  
-   <span data-ttu-id="739cb-105">Adição e remoção simultâneas de itens de vários threads.</span><span class="sxs-lookup"><span data-stu-id="739cb-105">Concurrent adding and taking of items from multiple threads.</span></span>  
  
-   <span data-ttu-id="739cb-106">Capacidade máxima opcional.</span><span class="sxs-lookup"><span data-stu-id="739cb-106">Optional maximum capacity.</span></span>  
  
-   <span data-ttu-id="739cb-107">Operações de inserção e remoção que bloqueiam quando a coleção está vazia ou cheia.</span><span class="sxs-lookup"><span data-stu-id="739cb-107">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
-   <span data-ttu-id="739cb-108">Operações “try” de inserção e remoção que não bloqueiam ou bloqueiam até um período específico.</span><span class="sxs-lookup"><span data-stu-id="739cb-108">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
-   <span data-ttu-id="739cb-109">Encapsula qualquer tipo de coleção que implemente <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span><span class="sxs-lookup"><span data-stu-id="739cb-109">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
-   <span data-ttu-id="739cb-110">Cancelamento com tokens de cancelamento.</span><span class="sxs-lookup"><span data-stu-id="739cb-110">Cancellation with cancellation tokens.</span></span>  
  
-   <span data-ttu-id="739cb-111">Dois tipos de enumeração com `foreach` (`For Each` no Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="739cb-111">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1.  <span data-ttu-id="739cb-112">Enumeração de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="739cb-112">Read-only enumeration.</span></span>  
  
    2.  <span data-ttu-id="739cb-113">Enumeração que remove itens conforme eles são enumerados.</span><span class="sxs-lookup"><span data-stu-id="739cb-113">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="739cb-114">Suporte a delimitação e bloqueio</span><span class="sxs-lookup"><span data-stu-id="739cb-114">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="739cb-115"><xref:System.Collections.Concurrent.BlockingCollection%601> dá suporte à delimitação e ao bloqueio.</span><span class="sxs-lookup"><span data-stu-id="739cb-115"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="739cb-116">Delimitação significa que você pode definir a capacidade máxima da coleção.</span><span class="sxs-lookup"><span data-stu-id="739cb-116">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="739cb-117">A delimitação é importante em determinados cenários, porque permite que você controle o tamanho máximo da coleção na memória e impede que os threads de produção se distanciem muito a frente dos threads de consumo.</span><span class="sxs-lookup"><span data-stu-id="739cb-117">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="739cb-118">Várias tarefas ou threads podem adicionar itens à coleção simultaneamente e se a coleção atingir sua capacidade máxima especificada, os threads de produção serão bloqueados até que um item seja removido.</span><span class="sxs-lookup"><span data-stu-id="739cb-118">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="739cb-119">Vários consumidores podem remover itens simultaneamente e, se a coleção ficar vazia, os threads de consumo serão bloqueados até que um produtor adicione um item.</span><span class="sxs-lookup"><span data-stu-id="739cb-119">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="739cb-120">Um thread de produção pode chamar <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> para indicar que não serão adicionados mais itens.</span><span class="sxs-lookup"><span data-stu-id="739cb-120">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="739cb-121">Os consumidores monitoram a propriedade <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> para saber quando a coleção está vazia e não serão adicionados mais itens.</span><span class="sxs-lookup"><span data-stu-id="739cb-121">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="739cb-122">O exemplo a seguir mostra uma BlockingCollection simples com uma capacidade limitada igual a 100.</span><span class="sxs-lookup"><span data-stu-id="739cb-122">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="739cb-123">Uma tarefa de produtor adiciona itens à coleção contanto que algumas condições sejam verdadeiras e, em seguida, chama <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span><span class="sxs-lookup"><span data-stu-id="739cb-123">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="739cb-124">A tarefa de consumidor tira itens até que a propriedade <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> seja true.</span><span class="sxs-lookup"><span data-stu-id="739cb-124">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="739cb-125">Para obter um exemplo completo, consulte [Como adicionar e tirar itens individualmente de uma BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="739cb-125">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="739cb-126">Operações de bloqueio cronometrado</span><span class="sxs-lookup"><span data-stu-id="739cb-126">Timed Blocking Operations</span></span>  
 <span data-ttu-id="739cb-127">Nas operações <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> e <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> de bloqueio cronometrado em coleções limitadas, o método tenta adicionar ou tirar um item.</span><span class="sxs-lookup"><span data-stu-id="739cb-127">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="739cb-128">Se houver um item disponível, ele será colocado na variável que foi passada por referência e o método retornará true.</span><span class="sxs-lookup"><span data-stu-id="739cb-128">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="739cb-129">Se nenhum item for recuperado após um período de tempo limite especificado, o método retornará false.</span><span class="sxs-lookup"><span data-stu-id="739cb-129">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="739cb-130">O thread fica, então, livre para realizar outro trabalho útil antes de tentar acessar a coleção novamente.</span><span class="sxs-lookup"><span data-stu-id="739cb-130">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="739cb-131">Para obter um exemplo de acesso com bloqueio cronometrado, consulte o segundo exemplo em [Como adicionar e tirar itens individualmente de uma BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="739cb-131">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="739cb-132">Cancelando as operações Add e Take</span><span class="sxs-lookup"><span data-stu-id="739cb-132">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="739cb-133">As operações Add e Take normalmente são realizadas em um loop.</span><span class="sxs-lookup"><span data-stu-id="739cb-133">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="739cb-134">Você pode cancelar um loop, passando um <xref:System.Threading.CancellationToken> para o método <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> ou <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> e, em seguida, verificando o valor da propriedade <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> do token em cada iteração.</span><span class="sxs-lookup"><span data-stu-id="739cb-134">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="739cb-135">Se o valor for true, caberá a você responder à solicitação de cancelamento limpando os recursos e saindo do loop.</span><span class="sxs-lookup"><span data-stu-id="739cb-135">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="739cb-136">O exemplo a seguir mostra uma sobrecarga de <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> que usa um token de cancelamento e o código que ele usa:</span><span class="sxs-lookup"><span data-stu-id="739cb-136">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="739cb-137">Para obter um exemplo de como adicionar suporte a cancelamento, veja o segundo exemplo em [Instruções: adicionar e remover itens individualmente de uma BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="739cb-137">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="739cb-138">Especificando o tipo de coleção</span><span class="sxs-lookup"><span data-stu-id="739cb-138">Specifying the Collection Type</span></span>  
 <span data-ttu-id="739cb-139">Ao criar um <xref:System.Collections.Concurrent.BlockingCollection%601>, você pode especificar não apenas a capacidade limitada, mas também o tipo de coleção a ser usado.</span><span class="sxs-lookup"><span data-stu-id="739cb-139">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="739cb-140">Por exemplo, seria possível especificar um <xref:System.Collections.Concurrent.ConcurrentQueue%601> para o comportamento PEPS (primeiro a entrar, primeiro a sair) ou um <xref:System.Collections.Concurrent.ConcurrentStack%601> para o comportamento UEPS (último a entrar, primeiro a sair).</span><span class="sxs-lookup"><span data-stu-id="739cb-140">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="739cb-141">Você pode usar qualquer classe de coleção que implemente a interface <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="739cb-141">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="739cb-142">O tipo de coleção padrão para <xref:System.Collections.Concurrent.BlockingCollection%601> é <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span><span class="sxs-lookup"><span data-stu-id="739cb-142">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="739cb-143">O exemplo de código a seguir mostra como criar um <xref:System.Collections.Concurrent.BlockingCollection%601> de cadeias de caracteres que tenha uma capacidade de 1000 e use um <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span><span class="sxs-lookup"><span data-stu-id="739cb-143">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="739cb-144">Para obter mais informações, consulte [Instruções: adicionar as funcionalidades de limitação e bloqueio a uma coleção](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="739cb-144">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="739cb-145">Suporte a IEnumerable</span><span class="sxs-lookup"><span data-stu-id="739cb-145">IEnumerable Support</span></span>  
 <span data-ttu-id="739cb-146">O <xref:System.Collections.Concurrent.BlockingCollection%601> fornece um método <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> que permite que os consumidores usem `foreach` (`For Each` em Visual Basic) para remover itens até que a coleção seja concluída, ou seja, que ela esteja vazia e que não sejam adicionados mais itens.</span><span class="sxs-lookup"><span data-stu-id="739cb-146"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="739cb-147">Para obter mais informações, confira [Como usar ForEach para remover itens de uma BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="739cb-147">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="739cb-148">Usando vários BlockingCollections como um</span><span class="sxs-lookup"><span data-stu-id="739cb-148">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="739cb-149">Para cenários em que um consumidor precisa remover itens de várias coleções simultaneamente, é possível criar matrizes de <xref:System.Collections.Concurrent.BlockingCollection%601> e usar os métodos estáticos como <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> e <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> que adicionarão ou retirarão de qualquer uma das coleções na matriz.</span><span class="sxs-lookup"><span data-stu-id="739cb-149">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="739cb-150">Se uma coleção for de bloqueio, o método imediatamente tenta outra até encontrar uma que possa realizar a operação.</span><span class="sxs-lookup"><span data-stu-id="739cb-150">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="739cb-151">Para obter mais informações, confira [Como usar matrizes de coleções Blocking em um pipeline](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="739cb-151">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="739cb-152">Consulte também</span><span class="sxs-lookup"><span data-stu-id="739cb-152">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>  
- [<span data-ttu-id="739cb-153">Coleções e Estruturas de Dados</span><span class="sxs-lookup"><span data-stu-id="739cb-153">Collections and Data Structures</span></span>](../../../../docs/standard/collections/index.md)  
- [<span data-ttu-id="739cb-154">Coleções Thread-Safe</span><span class="sxs-lookup"><span data-stu-id="739cb-154">Thread-Safe Collections</span></span>](../../../../docs/standard/collections/thread-safe/index.md)
