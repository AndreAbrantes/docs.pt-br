---
title: "Compilação e reutilização em expressões regulares"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- parsing text with regular expressions, compilation
- searching with regular expressions, compilation
- .NET Framework regular expressions, engines
- .NET Framework regular expressions, compilation
- regular expressions, compilation
- compilation, regular expressions
- pattern-matching with regular expressions, compilation
- regular expressions, engines
ms.assetid: 182ec76d-5a01-4d73-996c-0b0d14fcea18
caps.latest.revision: "11"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 76acdf2d0d2f7805ec78ea44136bfc63441b9bc9
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="compilation-and-reuse-in-regular-expressions"></a><span data-ttu-id="378d8-102">Compilação e reutilização em expressões regulares</span><span class="sxs-lookup"><span data-stu-id="378d8-102">Compilation and Reuse in Regular Expressions</span></span>
<span data-ttu-id="378d8-103">Você pode otimizar o desempenho de aplicativos que fazem uso intensivo de expressões regulares compreendendo como o mecanismo de expressões regulares compila expressões e como as expressões regulares são armazenadas em cache.</span><span class="sxs-lookup"><span data-stu-id="378d8-103">You can optimize the performance of applications that make extensive use of regular expressions by understanding how the regular expression engine compiles expressions and by understanding how regular expressions are cached.</span></span> <span data-ttu-id="378d8-104">Este tópico discute a compilação e o cache.</span><span class="sxs-lookup"><span data-stu-id="378d8-104">This topic discusses both compilation and caching.</span></span>  
  
## <a name="compiled-regular-expressions"></a><span data-ttu-id="378d8-105">Expressões regulares compiladas</span><span class="sxs-lookup"><span data-stu-id="378d8-105">Compiled Regular Expressions</span></span>  
 <span data-ttu-id="378d8-106">Por padrão, o mecanismo de expressões regulares compila uma expressão regular para uma sequência de instruções internas (esses são códigos de alto nível que são diferentes da Microsoft Intermediate Language ou MSIL).</span><span class="sxs-lookup"><span data-stu-id="378d8-106">By default, the regular expression engine compiles a regular expression to a sequence of internal instructions (these are high-level codes that are different from Microsoft intermediate language, or MSIL).</span></span> <span data-ttu-id="378d8-107">Quando o mecanismo executa uma expressão regular, ele interpreta os códigos internos.</span><span class="sxs-lookup"><span data-stu-id="378d8-107">When the engine executes a regular expression, it interprets the internal codes.</span></span>  
  
 <span data-ttu-id="378d8-108">Se um <xref:System.Text.RegularExpressions.Regex> objeto for construído com o <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> opção, ele compila a expressão regular ao código explícito MSIL em vez de instruções internas de expressão regular de alto nível.</span><span class="sxs-lookup"><span data-stu-id="378d8-108">If a <xref:System.Text.RegularExpressions.Regex> object is constructed with the <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> option, it compiles the regular expression to explicit MSIL code instead of high-level regular expression internal instructions.</span></span> <span data-ttu-id="378d8-109">Isso permite que o compilador JIT (just-in-time) do .NET converta a expressão para um código de computador nativo para um melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="378d8-109">This allows .NET's just-in-time (JIT) compiler to convert the expression to native machine code for higher performance.</span></span>  
  
<span data-ttu-id="378d8-110">No entanto, a MSIL gerada não pode ser descarregada.</span><span class="sxs-lookup"><span data-stu-id="378d8-110">However, generated MSIL cannot be unloaded.</span></span> <span data-ttu-id="378d8-111">A única maneira de descarregar o código é descarregar todo o domínio de aplicativo (ou seja, descarregar todo o código do aplicativo).</span><span class="sxs-lookup"><span data-stu-id="378d8-111">The only way to unload code is to unload an entire application domain (that is, to unload all of your application's code.).</span></span> <span data-ttu-id="378d8-112">Efetivamente, uma vez que uma expressão regular é compilada com o <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> opção, nunca os libera os recursos usados pela expressão compilada, mesmo se a expressão regular foi criada por uma <xref:System.Text.RegularExpressions.Regex> objeto é liberado para coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="378d8-112">Effectively, once a regular expression is compiled with the <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> option,   never releases the resources used by the compiled expression, even if the regular expression was created by a <xref:System.Text.RegularExpressions.Regex> object that is itself released to garbage collection.</span></span>  
  
 <span data-ttu-id="378d8-113">Você deve ter cuidado para limitar o número de expressões regulares diferentes que você compila com a <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> opção para evitar que consuma muitos recursos.</span><span class="sxs-lookup"><span data-stu-id="378d8-113">You must be careful to limit the number of different regular expressions you compile with the <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> option to avoid consuming too many resources.</span></span> <span data-ttu-id="378d8-114">Se um aplicativo precisar usar um número grande ou ilimitado de expressões regulares, cada expressão deve ser interpretada, não compilada.</span><span class="sxs-lookup"><span data-stu-id="378d8-114">If an application must use a large or unbounded number of regular expressions, each expression should be interpreted, not compiled.</span></span> <span data-ttu-id="378d8-115">No entanto, se um número pequeno de expressões regulares forem usado repetidamente, devem ser compiladas com <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="378d8-115">However, if a small number of regular expressions are used repeatedly, they should be compiled with <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType> for better performance.</span></span> <span data-ttu-id="378d8-116">Uma alternativa é usar expressões regulares pré-compilados.</span><span class="sxs-lookup"><span data-stu-id="378d8-116">An alternative is to use precompiled regular expressions.</span></span> <span data-ttu-id="378d8-117">Você pode compilar todas as suas expressões em uma DLL reutilizável, usando o <xref:System.Text.RegularExpressions.Regex.CompileToAssembly%2A> método.</span><span class="sxs-lookup"><span data-stu-id="378d8-117">You can compile all of your expressions into a reusable DLL by using the <xref:System.Text.RegularExpressions.Regex.CompileToAssembly%2A> method.</span></span> <span data-ttu-id="378d8-118">Isso evita a necessidade de compilar no tempo de execução enquanto ainda se beneficia da velocidade de expressões regulares compiladas.</span><span class="sxs-lookup"><span data-stu-id="378d8-118">This avoids the need to compile at runtime while still benefiting from the speed of compiled regular expressions.</span></span>  
  
## <a name="the-regular-expressions-cache"></a><span data-ttu-id="378d8-119">Cache de expressões regulares</span><span class="sxs-lookup"><span data-stu-id="378d8-119">The Regular Expressions Cache</span></span>  
 <span data-ttu-id="378d8-120">Para melhorar o desempenho, o mecanismo de expressões regulares mantém um cache em todo o aplicativo com as expressões regulares compiladas.</span><span class="sxs-lookup"><span data-stu-id="378d8-120">To improve performance, the regular expression engine maintains an application-wide cache of compiled regular expressions.</span></span> <span data-ttu-id="378d8-121">O cache armazena padrões de expressões regulares que são usados somente em chamadas de método estático.</span><span class="sxs-lookup"><span data-stu-id="378d8-121">The cache stores regular expression patterns that are used only in static method calls.</span></span> <span data-ttu-id="378d8-122">(Padrões de expressão regular fornecidos para métodos de instância não são armazenados). Isso evita a necessidade de analisar novamente uma expressão em código de bytes de alto nível cada vez que ela for usada.</span><span class="sxs-lookup"><span data-stu-id="378d8-122">(Regular expression patterns supplied to instance methods are not cached.) This avoids the need to reparse an expression into high-level byte code each time it is used.</span></span>  
  
 <span data-ttu-id="378d8-123">O número máximo de expressões regulares em cache é determinado pelo valor da `static` (`Shared` no Visual Basic) <xref:System.Text.RegularExpressions.Regex.CacheSize%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="378d8-123">The maximum number of cached regular expressions is determined by the value of the `static` (`Shared` in Visual Basic) <xref:System.Text.RegularExpressions.Regex.CacheSize%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="378d8-124">Por padrão, o mecanismo de expressões regulares armazena em cache até 15 expressões regulares compiladas.</span><span class="sxs-lookup"><span data-stu-id="378d8-124">By default, the regular expression engine caches up to 15 compiled regular expressions.</span></span> <span data-ttu-id="378d8-125">Se o número de expressões regulares compiladas ultrapassar o tamanho do cache, a expressão regular menos utilizada recentemente será descartada e a nova expressão regular será armazenada em cache.</span><span class="sxs-lookup"><span data-stu-id="378d8-125">If the number of compiled regular expressions exceeds the cache size, the least recently used regular expression is discarded and the new regular expression is cached.</span></span>  
  
 <span data-ttu-id="378d8-126">Seu aplicativo pode tirar proveito de expressões regulares pré-compiladas de uma das duas maneiras a seguir:</span><span class="sxs-lookup"><span data-stu-id="378d8-126">Your application can take advantage of precompiled regular expressions in one of the following two ways:</span></span>  
  
-   <span data-ttu-id="378d8-127">Usando um método estático do <xref:System.Text.RegularExpressions.Regex> objeto para definir a expressão regular.</span><span class="sxs-lookup"><span data-stu-id="378d8-127">By using a static method of the <xref:System.Text.RegularExpressions.Regex> object to define the regular expression.</span></span> <span data-ttu-id="378d8-128">Se você estiver usando um padrão de expressão regular que já foi definido em outra chamada de método estático, o mecanismo de expressões regulares o recuperará do cache.</span><span class="sxs-lookup"><span data-stu-id="378d8-128">If you are using a regular expression pattern that has already been defined in another static method call, the regular expression engine will retrieve it from the cache.</span></span> <span data-ttu-id="378d8-129">Caso contrário, o mecanismo compilará a expressão regular e a adicionará ao cache.</span><span class="sxs-lookup"><span data-stu-id="378d8-129">If not, the engine will compile the regular expression and add it to the cache.</span></span>  
  
-   <span data-ttu-id="378d8-130">Reutilizando um <xref:System.Text.RegularExpressions.Regex> objeto como o padrão de expressão regular é necessário.</span><span class="sxs-lookup"><span data-stu-id="378d8-130">By reusing an existing <xref:System.Text.RegularExpressions.Regex> object as long as its regular expression pattern is needed.</span></span>  
  
 <span data-ttu-id="378d8-131">Devido à sobrecarga de instanciação do objeto e da compilação da expressão regular, criar e destruir rapidamente vários <xref:System.Text.RegularExpressions.Regex> objetos é um processo muito caro.</span><span class="sxs-lookup"><span data-stu-id="378d8-131">Because of the overhead of object instantiation and regular expression compilation, creating and rapidly destroying numerous <xref:System.Text.RegularExpressions.Regex> objects is a very expensive process.</span></span> <span data-ttu-id="378d8-132">Para aplicativos que usam um grande número de expressões regulares diferentes, você pode otimizar o desempenho por meio de chamadas para estático `Regex` métodos e possivelmente aumentar o tamanho do cache de expressão regular.</span><span class="sxs-lookup"><span data-stu-id="378d8-132">For applications that use a large number of different regular expressions, you can optimize performance by using calls to static `Regex` methods and possibly by increasing the size of the regular expression cache.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="378d8-133">Consulte também</span><span class="sxs-lookup"><span data-stu-id="378d8-133">See Also</span></span>  
 [<span data-ttu-id="378d8-134">Expressões regulares do .NET</span><span class="sxs-lookup"><span data-stu-id="378d8-134">.NET Regular Expressions</span></span>](../../../docs/standard/base-types/regular-expressions.md)
