---
title: Algoritmo de carregamento de assembly gerenciado-.NET Core
description: Descrição dos detalhes do algoritmo de carregamento de assembly gerenciado no .NET Core
ms.date: 08/09/2019
author: sdmaclea
ms.author: stmaclea
ms.openlocfilehash: bf95cbd0eebed064f0198ae9b0f7a4288a938f8a
ms.sourcegitcommit: 6f28b709592503d27077b16fff2e2eacca569992
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/28/2019
ms.locfileid: "70234617"
---
# <a name="managed-assembly-loading-algorithm"></a><span data-ttu-id="1fc90-103">Algoritmo de carregamento de assembly gerenciado</span><span class="sxs-lookup"><span data-stu-id="1fc90-103">Managed assembly loading algorithm</span></span>

<span data-ttu-id="1fc90-104">Os assemblies gerenciados são localizados e carregados com um algoritmo que envolve vários estágios.</span><span class="sxs-lookup"><span data-stu-id="1fc90-104">Managed assemblies are located and loaded with an algorithm involving various stages.</span></span>

<span data-ttu-id="1fc90-105">Todos os assemblies gerenciados, exceto `WinRT` assemblies satélite e assemblies, usam o mesmo algoritmo.</span><span class="sxs-lookup"><span data-stu-id="1fc90-105">All managed assemblies except satellite assemblies and `WinRT` assemblies use the same algorithm.</span></span>

## <a name="when-are-managed-assemblies-loaded"></a><span data-ttu-id="1fc90-106">Quando os assemblies gerenciados são carregados?</span><span class="sxs-lookup"><span data-stu-id="1fc90-106">When are managed assemblies loaded?</span></span>

<span data-ttu-id="1fc90-107">O mecanismo mais comum para disparar uma carga de assembly gerenciada é uma referência de assembly estática.</span><span class="sxs-lookup"><span data-stu-id="1fc90-107">The most common mechanism to trigger a managed assembly load is a static assembly reference.</span></span> <span data-ttu-id="1fc90-108">Essas referências são inseridas pelo compilador sempre que o código usa um tipo definido em outro assembly.</span><span class="sxs-lookup"><span data-stu-id="1fc90-108">These references are inserted by the compiler whenever code uses a type defined in another assembly.</span></span> <span data-ttu-id="1fc90-109">Esses assemblies são carregados (`load-by-name`) conforme necessário pelo tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="1fc90-109">These assemblies are loaded (`load-by-name`) as needed by the runtime.</span></span>

<span data-ttu-id="1fc90-110">O uso direto de APIs específicas também irá disparar cargas:</span><span class="sxs-lookup"><span data-stu-id="1fc90-110">The direct use of specific APIs will also trigger loads:</span></span>

|<span data-ttu-id="1fc90-111">API</span><span class="sxs-lookup"><span data-stu-id="1fc90-111">API</span></span>  |<span data-ttu-id="1fc90-112">Descrição</span><span class="sxs-lookup"><span data-stu-id="1fc90-112">Description</span></span>  |<span data-ttu-id="1fc90-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="1fc90-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span></span> |
|---------|---------|---------|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyName%2A?displayProperty=nameWithType>|`Load-by-name`|<span data-ttu-id="1fc90-114">A instância [deste](../../csharp/language-reference/keywords/this.md) .</span><span class="sxs-lookup"><span data-stu-id="1fc90-114">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyPath%2A?displayProperty=nameWithType><p><xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromNativeImagePath%2A?displayProperty=nameWithType>|<span data-ttu-id="1fc90-115">Carregar do caminho.</span><span class="sxs-lookup"><span data-stu-id="1fc90-115">Load from path.</span></span>|<span data-ttu-id="1fc90-116">A instância [deste](../../csharp/language-reference/keywords/this.md) .</span><span class="sxs-lookup"><span data-stu-id="1fc90-116">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromStream%2A?displayProperty=nameWithType>|<span data-ttu-id="1fc90-117">Carregar do objeto.</span><span class="sxs-lookup"><span data-stu-id="1fc90-117">Load from object.</span></span>|<span data-ttu-id="1fc90-118">A instância [deste](../../csharp/language-reference/keywords/this.md) .</span><span class="sxs-lookup"><span data-stu-id="1fc90-118">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Reflection.Assembly.LoadFile%2A?displayProperty=nameWithType>|<span data-ttu-id="1fc90-119">Carregar do caminho em uma nova <xref:System.Runtime.Loader.AssemblyLoadContext> instância</span><span class="sxs-lookup"><span data-stu-id="1fc90-119">Load from path in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance</span></span>|<span data-ttu-id="1fc90-120">A nova instância <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="1fc90-120">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType>|<span data-ttu-id="1fc90-121">Carregar do caminho na <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instância.</span><span class="sxs-lookup"><span data-stu-id="1fc90-121">Load from path in the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span><p><span data-ttu-id="1fc90-122">Adiciona um <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> manipulador a <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="1fc90-122">Adds a <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> handler to <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="1fc90-123">O manipulador carregará as dependências do assembly de seu diretório.</span><span class="sxs-lookup"><span data-stu-id="1fc90-123">The handler will load the assembly's dependencies from its directory.</span></span>|<span data-ttu-id="1fc90-124">A instância <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="1fc90-124">The <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Reflection.AssemblyName)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.String)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=nameWithType>|<span data-ttu-id="1fc90-125">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="1fc90-125">`Load-by-name`.</span></span>|<span data-ttu-id="1fc90-126">Inferido do chamador.</span><span class="sxs-lookup"><span data-stu-id="1fc90-126">Inferred from caller.</span></span><p><span data-ttu-id="1fc90-127">Prefira <xref:System.Runtime.Loader.AssemblyLoadContext> métodos.</span><span class="sxs-lookup"><span data-stu-id="1fc90-127">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Byte[])?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.Byte[],System.Byte[])?displayProperty=nameWithType>|<span data-ttu-id="1fc90-128">Carregar do objeto.</span><span class="sxs-lookup"><span data-stu-id="1fc90-128">Load from object.</span></span>|<span data-ttu-id="1fc90-129">Inferido do chamador.</span><span class="sxs-lookup"><span data-stu-id="1fc90-129">Inferred from caller.</span></span><p><span data-ttu-id="1fc90-130">Prefira <xref:System.Runtime.Loader.AssemblyLoadContext> métodos.</span><span class="sxs-lookup"><span data-stu-id="1fc90-130">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
<xref:System.Type.GetType(System.String)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean,System.Boolean)?displayProperty=nameWithType>|<span data-ttu-id="1fc90-131">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="1fc90-131">`Load-by-name`.</span></span>|<span data-ttu-id="1fc90-132">Inferido do chamador.</span><span class="sxs-lookup"><span data-stu-id="1fc90-132">Inferred from caller.</span></span><p><span data-ttu-id="1fc90-133">Prefira <xref:System.Type.GetType%2A?displayProperty=nameWithType> métodos com um `assemblyResolver` argumento.</span><span class="sxs-lookup"><span data-stu-id="1fc90-133">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> methods with an `assemblyResolver` argument.</span></span>|
<xref:System.Reflection.Assembly.GetType%2A?displayProperty=nameWithType>|<span data-ttu-id="1fc90-134">Se Type `name` descrever um tipo genérico de assembly qualificado, dispare um `Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="1fc90-134">If type `name` describes an assembly qualified generic type, trigger a `Load-by-name`.</span></span>|<span data-ttu-id="1fc90-135">Inferido do chamador.</span><span class="sxs-lookup"><span data-stu-id="1fc90-135">Inferred from caller.</span></span><p><span data-ttu-id="1fc90-136">Prefira <xref:System.Type.GetType%2A?displayProperty=nameWithType> ao usar nomes de tipo qualificado de assembly.</span><span class="sxs-lookup"><span data-stu-id="1fc90-136">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> when using assembly qualified type names.</span></span>|
<xref:System.Activator.CreateInstance(System.String,System.String)?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Object[])?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Boolean,System.Reflection.BindingFlags,System.Reflection.Binder,System.Object[],System.Globalization.CultureInfo,System.Object[])?displayProperty=nameWithType>|<span data-ttu-id="1fc90-137">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="1fc90-137">`Load-by-name`.</span></span>|<span data-ttu-id="1fc90-138">Inferido do chamador.</span><span class="sxs-lookup"><span data-stu-id="1fc90-138">Inferred from caller.</span></span><p><span data-ttu-id="1fc90-139">Prefira <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> métodos que tomam <xref:System.Type> um argumento.</span><span class="sxs-lookup"><span data-stu-id="1fc90-139">Prefer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> methods taking a <xref:System.Type> argument.</span></span>|

## <a name="algorithm"></a><span data-ttu-id="1fc90-140">Algoritmo</span><span class="sxs-lookup"><span data-stu-id="1fc90-140">Algorithm</span></span>

<span data-ttu-id="1fc90-141">O algoritmo a seguir descreve como o tempo de execução carrega um assembly gerenciado.</span><span class="sxs-lookup"><span data-stu-id="1fc90-141">The following algorithm describes how the runtime loads a managed assembly.</span></span>

1. <span data-ttu-id="1fc90-142">Determine o `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="1fc90-142">Determine the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

    - <span data-ttu-id="1fc90-143">Para uma referência de assembly estática, `active` a <xref:System.Runtime.Loader.AssemblyLoadContext> é a instância que carregou o assembly de referência.</span><span class="sxs-lookup"><span data-stu-id="1fc90-143">For a static assembly reference, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> is the instance that loaded the referring assembly.</span></span>
    - <span data-ttu-id="1fc90-144">As APIs preferenciais `active` tornam o <xref:System.Runtime.Loader.AssemblyLoadContext> explícito.</span><span class="sxs-lookup"><span data-stu-id="1fc90-144">Preferred APIs make the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicit.</span></span>
    - <span data-ttu-id="1fc90-145">Outras APIs inferem o `active`. <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="1fc90-145">Other APIs infer the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span> <span data-ttu-id="1fc90-146">Para essas APIs, a <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> propriedade é usada.</span><span class="sxs-lookup"><span data-stu-id="1fc90-146">For these APIs, the <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> property is used.</span></span> <span data-ttu-id="1fc90-147">Se seu valor for `null`, a instância inferida <xref:System.Runtime.Loader.AssemblyLoadContext> será usada.</span><span class="sxs-lookup"><span data-stu-id="1fc90-147">If its value is `null`, then the inferred <xref:System.Runtime.Loader.AssemblyLoadContext> instance is used.</span></span>
    - <span data-ttu-id="1fc90-148">Consulte a tabela acima.</span><span class="sxs-lookup"><span data-stu-id="1fc90-148">See table above.</span></span>

2. <span data-ttu-id="1fc90-149">Para os `Load-by-name` métodos, o ativo <xref:System.Runtime.Loader.AssemblyLoadContext> carrega o assembly.</span><span class="sxs-lookup"><span data-stu-id="1fc90-149">For the `Load-by-name` methods, the active <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="1fc90-150">Em ordem de prioridade por:</span><span class="sxs-lookup"><span data-stu-id="1fc90-150">In priority order by:</span></span>
    - <span data-ttu-id="1fc90-151">Verificando `cache-by-name`seu.</span><span class="sxs-lookup"><span data-stu-id="1fc90-151">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="1fc90-152">Chamando a <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> função.</span><span class="sxs-lookup"><span data-stu-id="1fc90-152">Calling the <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> function.</span></span>

    - <span data-ttu-id="1fc90-153">Verificando <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> o cache de instâncias e executando a lógica de [investigação padrão do assembly gerenciado](default-probing.md#managed-assembly-default-probing) .</span><span class="sxs-lookup"><span data-stu-id="1fc90-153">Checking the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instances' cache and running [managed assembly default probing](default-probing.md#managed-assembly-default-probing) logic.</span></span>

    - <span data-ttu-id="1fc90-154">Gerando <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> o evento para o AssemblyLoadContext ativo.</span><span class="sxs-lookup"><span data-stu-id="1fc90-154">Raising the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event for the active AssemblyLoadContext.</span></span>

    - <span data-ttu-id="1fc90-155">Gerando <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> o evento.</span><span class="sxs-lookup"><span data-stu-id="1fc90-155">Raising the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

3. <span data-ttu-id="1fc90-156">Para os outros tipos de cargas, o `active` <xref:System.Runtime.Loader.AssemblyLoadContext> carrega o assembly.</span><span class="sxs-lookup"><span data-stu-id="1fc90-156">For the other types of loads, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="1fc90-157">Em ordem de prioridade por:</span><span class="sxs-lookup"><span data-stu-id="1fc90-157">In priority order by:</span></span>
    - <span data-ttu-id="1fc90-158">Verificando `cache-by-name`seu.</span><span class="sxs-lookup"><span data-stu-id="1fc90-158">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="1fc90-159">Carregando a partir do caminho especificado ou do objeto de assembly bruto.</span><span class="sxs-lookup"><span data-stu-id="1fc90-159">Loading from the specified path or raw assembly object.</span></span>

4. <span data-ttu-id="1fc90-160">Em ambos os casos, se um assembly for carregado recentemente, então:</span><span class="sxs-lookup"><span data-stu-id="1fc90-160">In either case, if an assembly is newly loaded, then:</span></span>
   - <span data-ttu-id="1fc90-161">O <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> evento é gerado.</span><span class="sxs-lookup"><span data-stu-id="1fc90-161">The <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> event is raised.</span></span>
   - <span data-ttu-id="1fc90-162">Uma referência é adicionada à <xref:System.Runtime.Loader.AssemblyLoadContext> `cache-by-name`instância do assembly.</span><span class="sxs-lookup"><span data-stu-id="1fc90-162">A reference is added to the assembly's <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

5. <span data-ttu-id="1fc90-163">Se o assembly for encontrado, uma referência será adicionada conforme necessário para a `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instância do `cache-by-name`.</span><span class="sxs-lookup"><span data-stu-id="1fc90-163">If the assembly is found, a reference is added as needed to the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>
