---
title: Algoritmo de carregamento de montagem gerenciado - .NET Core
description: Descrição dos detalhes do algoritmo de carregamento de montagem gerenciado no .NET Core
ms.date: 08/09/2019
author: sdmaclea
ms.author: stmaclea
ms.openlocfilehash: 312a320676be6eb453697e0704ab771a6707618b
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/14/2020
ms.locfileid: "73973510"
---
# <a name="managed-assembly-loading-algorithm"></a><span data-ttu-id="80311-103">Algoritmo de carregamento de montagem gerenciado</span><span class="sxs-lookup"><span data-stu-id="80311-103">Managed assembly loading algorithm</span></span>

<span data-ttu-id="80311-104">Os conjuntos gerenciados são localizados e carregados com um algoritmo que envolve vários estágios.</span><span class="sxs-lookup"><span data-stu-id="80311-104">Managed assemblies are located and loaded with an algorithm involving various stages.</span></span>

<span data-ttu-id="80311-105">Todos os conjuntos gerenciados, `WinRT` exceto conjuntos de satélites e conjuntos, usam o mesmo algoritmo.</span><span class="sxs-lookup"><span data-stu-id="80311-105">All managed assemblies except satellite assemblies and `WinRT` assemblies use the same algorithm.</span></span>

## <a name="when-are-managed-assemblies-loaded"></a><span data-ttu-id="80311-106">Quando os conjuntos gerenciados são carregados?</span><span class="sxs-lookup"><span data-stu-id="80311-106">When are managed assemblies loaded?</span></span>

<span data-ttu-id="80311-107">O mecanismo mais comum para ativar uma carga de montagem gerenciada é uma referência de montagem estática.</span><span class="sxs-lookup"><span data-stu-id="80311-107">The most common mechanism to trigger a managed assembly load is a static assembly reference.</span></span> <span data-ttu-id="80311-108">Essas referências são inseridas pelo compilador sempre que o código usa um tipo definido em outro conjunto.</span><span class="sxs-lookup"><span data-stu-id="80311-108">These references are inserted by the compiler whenever code uses a type defined in another assembly.</span></span> <span data-ttu-id="80311-109">Estas montagens são`load-by-name`carregadas ( ) conforme necessário pelo tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="80311-109">These assemblies are loaded (`load-by-name`) as needed by the runtime.</span></span>

<span data-ttu-id="80311-110">O uso direto de APIs específicas também acionará cargas:</span><span class="sxs-lookup"><span data-stu-id="80311-110">The direct use of specific APIs will also trigger loads:</span></span>

|<span data-ttu-id="80311-111">API</span><span class="sxs-lookup"><span data-stu-id="80311-111">API</span></span>  |<span data-ttu-id="80311-112">Descrição</span><span class="sxs-lookup"><span data-stu-id="80311-112">Description</span></span>  |<span data-ttu-id="80311-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="80311-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span></span> |
|---------|---------|---------|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyName%2A?displayProperty=nameWithType>|`Load-by-name`|<span data-ttu-id="80311-114">O [caso deste.](../../csharp/language-reference/keywords/this.md)</span><span class="sxs-lookup"><span data-stu-id="80311-114">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyPath%2A?displayProperty=nameWithType><p><xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromNativeImagePath%2A?displayProperty=nameWithType>|<span data-ttu-id="80311-115">Carga do caminho.</span><span class="sxs-lookup"><span data-stu-id="80311-115">Load from path.</span></span>|<span data-ttu-id="80311-116">O [caso deste.](../../csharp/language-reference/keywords/this.md)</span><span class="sxs-lookup"><span data-stu-id="80311-116">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromStream%2A?displayProperty=nameWithType>|<span data-ttu-id="80311-117">Carregar do objeto.</span><span class="sxs-lookup"><span data-stu-id="80311-117">Load from object.</span></span>|<span data-ttu-id="80311-118">O [caso deste.](../../csharp/language-reference/keywords/this.md)</span><span class="sxs-lookup"><span data-stu-id="80311-118">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Reflection.Assembly.LoadFile%2A?displayProperty=nameWithType>|<span data-ttu-id="80311-119">Carregar do caminho <xref:System.Runtime.Loader.AssemblyLoadContext> em uma nova instância</span><span class="sxs-lookup"><span data-stu-id="80311-119">Load from path in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance</span></span>|<span data-ttu-id="80311-120">A nova instância <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="80311-120">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType>|<span data-ttu-id="80311-121">Carregar do caminho <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> na instância.</span><span class="sxs-lookup"><span data-stu-id="80311-121">Load from path in the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span><p><span data-ttu-id="80311-122">Adiciona <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> um <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>manipulador a .</span><span class="sxs-lookup"><span data-stu-id="80311-122">Adds a <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> handler to <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="80311-123">O manipulador carregará as dependências da montagem de seu diretório.</span><span class="sxs-lookup"><span data-stu-id="80311-123">The handler will load the assembly's dependencies from its directory.</span></span>|<span data-ttu-id="80311-124">A instância <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="80311-124">The <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Reflection.AssemblyName)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.String)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=nameWithType>|<span data-ttu-id="80311-125">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="80311-125">`Load-by-name`.</span></span>|<span data-ttu-id="80311-126">Inferido de ouvinte.</span><span class="sxs-lookup"><span data-stu-id="80311-126">Inferred from caller.</span></span><p><span data-ttu-id="80311-127">Prefiro <xref:System.Runtime.Loader.AssemblyLoadContext> métodos.</span><span class="sxs-lookup"><span data-stu-id="80311-127">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Byte[])?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.Byte[],System.Byte[])?displayProperty=nameWithType>|<span data-ttu-id="80311-128">Carregar do objeto <xref:System.Runtime.Loader.AssemblyLoadContext> em uma nova instância.</span><span class="sxs-lookup"><span data-stu-id="80311-128">Load from object in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|<span data-ttu-id="80311-129">A nova instância <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="80311-129">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Type.GetType(System.String)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean,System.Boolean)?displayProperty=nameWithType>|<span data-ttu-id="80311-130">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="80311-130">`Load-by-name`.</span></span>|<span data-ttu-id="80311-131">Inferido de ouvinte.</span><span class="sxs-lookup"><span data-stu-id="80311-131">Inferred from caller.</span></span><p><span data-ttu-id="80311-132">Prefira <xref:System.Type.GetType%2A?displayProperty=nameWithType> métodos com argumentos. `assemblyResolver`</span><span class="sxs-lookup"><span data-stu-id="80311-132">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> methods with an `assemblyResolver` argument.</span></span>|
<xref:System.Reflection.Assembly.GetType%2A?displayProperty=nameWithType>|<span data-ttu-id="80311-133">Se `name` o tipo descrever um tipo `Load-by-name`genérico qualificado de montagem, acione um .</span><span class="sxs-lookup"><span data-stu-id="80311-133">If type `name` describes an assembly qualified generic type, trigger a `Load-by-name`.</span></span>|<span data-ttu-id="80311-134">Inferido de ouvinte.</span><span class="sxs-lookup"><span data-stu-id="80311-134">Inferred from caller.</span></span><p><span data-ttu-id="80311-135">Prefira <xref:System.Type.GetType%2A?displayProperty=nameWithType> ao usar nomes de tipo qualificados para montagem.</span><span class="sxs-lookup"><span data-stu-id="80311-135">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> when using assembly qualified type names.</span></span>|
<xref:System.Activator.CreateInstance(System.String,System.String)?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Object[])?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Boolean,System.Reflection.BindingFlags,System.Reflection.Binder,System.Object[],System.Globalization.CultureInfo,System.Object[])?displayProperty=nameWithType>|<span data-ttu-id="80311-136">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="80311-136">`Load-by-name`.</span></span>|<span data-ttu-id="80311-137">Inferido de ouvinte.</span><span class="sxs-lookup"><span data-stu-id="80311-137">Inferred from caller.</span></span><p><span data-ttu-id="80311-138">Prefira <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> métodos para <xref:System.Type> argumentar.</span><span class="sxs-lookup"><span data-stu-id="80311-138">Prefer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> methods taking a <xref:System.Type> argument.</span></span>|

## <a name="algorithm"></a><span data-ttu-id="80311-139">Algoritmo</span><span class="sxs-lookup"><span data-stu-id="80311-139">Algorithm</span></span>

<span data-ttu-id="80311-140">O algoritmo a seguir descreve como o tempo de execução carrega um conjunto gerenciado.</span><span class="sxs-lookup"><span data-stu-id="80311-140">The following algorithm describes how the runtime loads a managed assembly.</span></span>

1. <span data-ttu-id="80311-141">Determine `active` <xref:System.Runtime.Loader.AssemblyLoadContext>o .</span><span class="sxs-lookup"><span data-stu-id="80311-141">Determine the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

    - <span data-ttu-id="80311-142">Para uma referência de `active` <xref:System.Runtime.Loader.AssemblyLoadContext> montagem estática, é a instância que carregou o conjunto de referência.</span><span class="sxs-lookup"><span data-stu-id="80311-142">For a static assembly reference, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> is the instance that loaded the referring assembly.</span></span>
    - <span data-ttu-id="80311-143">As APIs `active` <xref:System.Runtime.Loader.AssemblyLoadContext> preferidas deixam explícito.</span><span class="sxs-lookup"><span data-stu-id="80311-143">Preferred APIs make the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicit.</span></span>
    - <span data-ttu-id="80311-144">Outras APIs `active` <xref:System.Runtime.Loader.AssemblyLoadContext>inferem o .</span><span class="sxs-lookup"><span data-stu-id="80311-144">Other APIs infer the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span> <span data-ttu-id="80311-145">Para essas APIs, a <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> propriedade é usada.</span><span class="sxs-lookup"><span data-stu-id="80311-145">For these APIs, the <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> property is used.</span></span> <span data-ttu-id="80311-146">Se o `null`seu valor for, então a instância inferida <xref:System.Runtime.Loader.AssemblyLoadContext> é usada.</span><span class="sxs-lookup"><span data-stu-id="80311-146">If its value is `null`, then the inferred <xref:System.Runtime.Loader.AssemblyLoadContext> instance is used.</span></span>
    - <span data-ttu-id="80311-147">Veja a tabela acima.</span><span class="sxs-lookup"><span data-stu-id="80311-147">See table above.</span></span>

2. <span data-ttu-id="80311-148">Para `Load-by-name` os métodos, <xref:System.Runtime.Loader.AssemblyLoadContext> o ativo carrega a montagem.</span><span class="sxs-lookup"><span data-stu-id="80311-148">For the `Load-by-name` methods, the active <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="80311-149">Em ordem prioritária por:</span><span class="sxs-lookup"><span data-stu-id="80311-149">In priority order by:</span></span>
    - <span data-ttu-id="80311-150">Verificando `cache-by-name`seu .</span><span class="sxs-lookup"><span data-stu-id="80311-150">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="80311-151">Chamando <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> a função.</span><span class="sxs-lookup"><span data-stu-id="80311-151">Calling the <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> function.</span></span>

    - <span data-ttu-id="80311-152">Verificando <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> o cache das instâncias e executando a lógica [de sondagem padrão do conjunto gerenciado.](default-probing.md#managed-assembly-default-probing)</span><span class="sxs-lookup"><span data-stu-id="80311-152">Checking the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instances' cache and running [managed assembly default probing](default-probing.md#managed-assembly-default-probing) logic.</span></span>

    - <span data-ttu-id="80311-153">Elevando <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> o evento para o AssemblyLoadContext ativo.</span><span class="sxs-lookup"><span data-stu-id="80311-153">Raising the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event for the active AssemblyLoadContext.</span></span>

    - <span data-ttu-id="80311-154">Levantando <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> o evento.</span><span class="sxs-lookup"><span data-stu-id="80311-154">Raising the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

3. <span data-ttu-id="80311-155">Para os outros tipos de `active` <xref:System.Runtime.Loader.AssemblyLoadContext> cargas, as cargas do conjunto.</span><span class="sxs-lookup"><span data-stu-id="80311-155">For the other types of loads, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="80311-156">Em ordem prioritária por:</span><span class="sxs-lookup"><span data-stu-id="80311-156">In priority order by:</span></span>
    - <span data-ttu-id="80311-157">Verificando `cache-by-name`seu .</span><span class="sxs-lookup"><span data-stu-id="80311-157">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="80311-158">Carregando a partir do caminho especificado ou do objeto de montagem bruto.</span><span class="sxs-lookup"><span data-stu-id="80311-158">Loading from the specified path or raw assembly object.</span></span>

4. <span data-ttu-id="80311-159">Em ambos os casos, se uma montagem estiver recém-carregada, então:</span><span class="sxs-lookup"><span data-stu-id="80311-159">In either case, if an assembly is newly loaded, then:</span></span>
   - <span data-ttu-id="80311-160">O <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> evento foi levantado.</span><span class="sxs-lookup"><span data-stu-id="80311-160">The <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> event is raised.</span></span>
   - <span data-ttu-id="80311-161">Uma referência é adicionada à <xref:System.Runtime.Loader.AssemblyLoadContext> instância `cache-by-name`da assembléia.</span><span class="sxs-lookup"><span data-stu-id="80311-161">A reference is added to the assembly's <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

5. <span data-ttu-id="80311-162">Se a montagem for encontrada, uma referência `active` <xref:System.Runtime.Loader.AssemblyLoadContext> será `cache-by-name`adicionada conforme necessário à da instância.</span><span class="sxs-lookup"><span data-stu-id="80311-162">If the assembly is found, a reference is added as needed to the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>
