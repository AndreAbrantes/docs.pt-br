---
title: Arquitetura das ferramentas de linha de comando do .NET Core
description: Saiba mais sobre as camadas de ferramentas do .NET Core e o que foi alterado nas versões recentes.
ms.date: 03/06/2017
ms.openlocfilehash: fde1a0acb6af9dd65aa3466b4ea37473b2eab6fb
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/09/2020
ms.locfileid: "77092909"
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a><span data-ttu-id="a349b-103">Visão geral de alto nível das alterações nas ferramentas do .NET Core</span><span class="sxs-lookup"><span data-stu-id="a349b-103">High-level overview of changes in the .NET Core tools</span></span>

<span data-ttu-id="a349b-104">Este documento descreve as alterações associadas à movimentação de *project.json* para o MSBuild e para o sistema de projeto *csproj*, com informações sobre as alterações na camada de ferramentas do .NET Core e a implementação dos comandos da CLI.</span><span class="sxs-lookup"><span data-stu-id="a349b-104">This document describes the changes associated with moving from *project.json* to MSBuild and the *csproj* project system with information on the changes to the layering of the .NET Core tooling and the implementation of the CLI commands.</span></span> <span data-ttu-id="a349b-105">Essas alterações ocorreram com o lançamento do SDK 1.0 do .NET Core e do Visual Studio 2017 em 7 de março de 2017 (veja o [comunicado](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)), mas foram implementadas inicialmente com o lançamento do SDK Preview 3 do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a349b-105">These changes occurred with the release of .NET Core SDK 1.0 and Visual Studio 2017 on March 7, 2017 (see the [announcement](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)) but were initially implemented with the release of the .NET Core SDK Preview 3.</span></span>

## <a name="moving-away-from-projectjson"></a><span data-ttu-id="a349b-106">Deixando o project.json</span><span class="sxs-lookup"><span data-stu-id="a349b-106">Moving away from project.json</span></span>

<span data-ttu-id="a349b-107">A maior alteração nas ferramentas do .NET Core é certamente a [mudança de project.json para csproj](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) como o sistema de projeto.</span><span class="sxs-lookup"><span data-stu-id="a349b-107">The biggest change in the tooling for .NET Core is certainly the [move away from project.json to csproj](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) as the project system.</span></span> <span data-ttu-id="a349b-108">As últimas versões das ferramentas de linha de comando não dão suporte a arquivos *project.json*.</span><span class="sxs-lookup"><span data-stu-id="a349b-108">The latest versions of the command-line tools don't support *project.json* files.</span></span> <span data-ttu-id="a349b-109">Isso significa que ele não pode ser usado para compilar, executar ou publicar aplicativos e bibliotecas com base em Project. JSON.</span><span class="sxs-lookup"><span data-stu-id="a349b-109">That means that it cannot be used to build, run, or publish project.json based applications and libraries.</span></span> <span data-ttu-id="a349b-110">Para usar esta versão das ferramentas, migre seus projetos existentes ou inicie novos.</span><span class="sxs-lookup"><span data-stu-id="a349b-110">To use this version of the tools, migrate your existing projects or start new ones.</span></span>

<span data-ttu-id="a349b-111">Como parte dessa mudança, o mecanismo de build personalizado desenvolvido para compilar projetos project.json foi substituído por um mecanismo de build maduro e totalmente capaz, chamado [MSBuild](https://github.com/Microsoft/msbuild).</span><span class="sxs-lookup"><span data-stu-id="a349b-111">As part of this move, the custom build engine that was developed to build project.json projects was replaced with a mature and fully capable build engine called [MSBuild](https://github.com/Microsoft/msbuild).</span></span> <span data-ttu-id="a349b-112">O MSBuild é um mecanismo bem conhecido na Comunidade do .NET.</span><span class="sxs-lookup"><span data-stu-id="a349b-112">MSBuild is a well-known engine in the .NET community.</span></span> <span data-ttu-id="a349b-113">Ele tem sido uma tecnologia fundamental desde o primeiro lançamento da plataforma.</span><span class="sxs-lookup"><span data-stu-id="a349b-113">It has been a key technology since the platform's first release.</span></span> <span data-ttu-id="a349b-114">Como ele precisa criar aplicativos .NET Core, o MSBuild foi portado para o .NET Core e pode ser usado em qualquer plataforma em que o .NET Core seja executado.</span><span class="sxs-lookup"><span data-stu-id="a349b-114">Because it needs to build .NET Core applications, MSBuild has been ported to .NET Core and can be used on any platform that .NET Core runs on.</span></span> <span data-ttu-id="a349b-115">Uma das principais promessas do .NET Core é uma pilha de desenvolvimento de plataforma cruzada e nós garantimos que essa mudança não quebra essa promessa.</span><span class="sxs-lookup"><span data-stu-id="a349b-115">One of the main promises of .NET Core is that of a cross-platform development stack, and we have made sure that this move does not break that promise.</span></span>

> [!TIP]
> <span data-ttu-id="a349b-116">Se você for novo no MSBuild e quiser saber mais sobre ele, poderá começar lendo o artigo [conceitos do MSBuild](/visualstudio/msbuild/msbuild-concepts) .</span><span class="sxs-lookup"><span data-stu-id="a349b-116">If you are new to MSBuild and would like to learn more about it, you can start by reading the [MSBuild concepts](/visualstudio/msbuild/msbuild-concepts) article.</span></span>

## <a name="the-tooling-layers"></a><span data-ttu-id="a349b-117">As camadas de ferramentas</span><span class="sxs-lookup"><span data-stu-id="a349b-117">The tooling layers</span></span>

<span data-ttu-id="a349b-118">Com a mudança no mecanismo de compilação e a movimentação para longe do sistema de projeto existente, algumas perguntas são seguidas naturalmente.</span><span class="sxs-lookup"><span data-stu-id="a349b-118">With the change in build engine and the move away from the existing project system, some questions naturally follow.</span></span> <span data-ttu-id="a349b-119">Qualquer uma dessas alterações altera a "disposição" geral do ecossistema de ferramentas do .NET Core?</span><span class="sxs-lookup"><span data-stu-id="a349b-119">Do any of these changes change the overall "layering" of the .NET Core tooling ecosystem?</span></span> <span data-ttu-id="a349b-120">Existem novos bits e componentes?</span><span class="sxs-lookup"><span data-stu-id="a349b-120">Are there new bits and components?</span></span>

<span data-ttu-id="a349b-121">Vamos começar recapitulando as camadas na Visualização 2, conforme mostrado na figura a seguir:</span><span class="sxs-lookup"><span data-stu-id="a349b-121">Let's start with a quick refresher on Preview 2 layering as shown in the following picture:</span></span>

![A arquitetura de alto nível das ferramentas da Visualização 2](media/cli-msbuild-architecture/p2-arch.png)

<span data-ttu-id="a349b-123">A disposição em camadas das ferramentas na visualização 2 é simples.</span><span class="sxs-lookup"><span data-stu-id="a349b-123">The layering of the tools in Preview 2 is straightforward.</span></span> <span data-ttu-id="a349b-124">Na parte inferior, a base é a CLI do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a349b-124">At the bottom, the foundation is the .NET Core CLI.</span></span> <span data-ttu-id="a349b-125">Todas as outras ferramentas de nível superior, como o Visual Studio ou o Visual Studio Code, dependem e contam com a CLI para criar projetos, restaurar dependências e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a349b-125">All other, higher-level tools, such as Visual Studio or Visual Studio Code, depend and rely on the CLI to build projects, restore dependencies, and so on.</span></span> <span data-ttu-id="a349b-126">Por exemplo, se o Visual Studio quisesse executar uma operação de restauração, ele chamaria o comando `dotnet restore` ([ver observação](#dotnet-restore-note)) na CLI.</span><span class="sxs-lookup"><span data-stu-id="a349b-126">For example, if Visual Studio wanted to perform a restore operation, it would call into the `dotnet restore` ([see note](#dotnet-restore-note)) command in the CLI.</span></span>

<span data-ttu-id="a349b-127">Com a mudança para o novo sistema de projeto, o diagrama anterior se altera:</span><span class="sxs-lookup"><span data-stu-id="a349b-127">With the move to the new project system, the previous diagram changes:</span></span>

![Arquitetura de alto nível do SDK 1.0.0 do .NET Core](media/cli-msbuild-architecture/p3-arch.png)

<span data-ttu-id="a349b-129">A principal diferença é que a CLI não é mais a camada básica; agora, essa função é executada pelo "componente SDK compartilhado".</span><span class="sxs-lookup"><span data-stu-id="a349b-129">The main difference is that the CLI is not the foundational layer anymore; this role is now filled by the "shared SDK component".</span></span> <span data-ttu-id="a349b-130">Esse componente SDK compartilhado é um conjunto de destinos e tarefas associadas que são responsáveis por compilar código, publicá-lo, empacotar pacotes do NuGet e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a349b-130">This shared SDK component is a set of targets and associated tasks that are responsible for compiling code, publishing it, packing NuGet packages, and so on.</span></span> <span data-ttu-id="a349b-131">O SDK do .NET Core é de código-fonte aberto e está disponível no GitHub no [repositório do SDK](https://github.com/dotnet/sdk).</span><span class="sxs-lookup"><span data-stu-id="a349b-131">The .NET Core SDK is open-source and is available on GitHub on the [SDK repo](https://github.com/dotnet/sdk).</span></span>

> [!NOTE]
> <span data-ttu-id="a349b-132">Um "destino" é um termo do MSBuild que indica uma operação nomeada que o MSBuild pode invocar.</span><span class="sxs-lookup"><span data-stu-id="a349b-132">A "target" is an MSBuild term that indicates a named operation that MSBuild can invoke.</span></span> <span data-ttu-id="a349b-133">Normalmente, ele está acoplado com uma ou mais tarefas que executam alguma lógica que o destino deve realizar.</span><span class="sxs-lookup"><span data-stu-id="a349b-133">It is usually coupled with one or more tasks that execute some logic that the target is supposed to do.</span></span> <span data-ttu-id="a349b-134">O MSBuild oferece suporte a muitos destinos prontos como `Copy` ou `Execute`; ele também permite aos usuários gravar suas próprias tarefas usando código gerenciado e definir metas para executar essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="a349b-134">MSBuild supports many ready-made targets such as `Copy` or `Execute`; it also allows users to write their own tasks using managed code and define targets to execute those tasks.</span></span> <span data-ttu-id="a349b-135">Para mais informações, consulte [Tarefas do MSBuild](/visualstudio/msbuild/msbuild-tasks).</span><span class="sxs-lookup"><span data-stu-id="a349b-135">For more information, see [MSBuild tasks](/visualstudio/msbuild/msbuild-tasks).</span></span>

<span data-ttu-id="a349b-136">Todos os conjuntos de ferramentas agora consumem o componente SDK compartilhado e seus destinos, incluindo a CLI.</span><span class="sxs-lookup"><span data-stu-id="a349b-136">All the toolsets now consume the shared SDK component and its targets, CLI included.</span></span> <span data-ttu-id="a349b-137">Por exemplo, o Visual Studio 2019 não chama o comando `dotnet restore` ([consulte observação](#dotnet-restore-note)) para restaurar dependências para projetos do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a349b-137">For example, Visual Studio 2019 doesn't call into the `dotnet restore` ([see note](#dotnet-restore-note)) command to restore dependencies for .NET Core projects.</span></span> <span data-ttu-id="a349b-138">Em vez disso, ele usa o destino "Restore" diretamente.</span><span class="sxs-lookup"><span data-stu-id="a349b-138">Instead, it uses the "Restore" target directly.</span></span> <span data-ttu-id="a349b-139">Como esses são os destinos do MSBuild, também é possível usar o MSBuild bruto para executá-los, usando o comando [dotnet msbuild](dotnet-msbuild.md).</span><span class="sxs-lookup"><span data-stu-id="a349b-139">Since these are MSBuild targets, you can also use raw MSBuild to execute them using the [dotnet msbuild](dotnet-msbuild.md) command.</span></span>

### <a name="cli-commands"></a><span data-ttu-id="a349b-140">Comandos de CLI</span><span class="sxs-lookup"><span data-stu-id="a349b-140">CLI commands</span></span>

<span data-ttu-id="a349b-141">O componente SDK compartilhado significa que a maioria dos comandos existentes da CLI foi reimplementada como destinos e tarefas do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="a349b-141">The shared SDK component means that the majority of existing CLI commands have been reimplemented as MSBuild tasks and targets.</span></span> <span data-ttu-id="a349b-142">O que isso significa para os comandos CLI e o uso do conjunto de ferramentas?</span><span class="sxs-lookup"><span data-stu-id="a349b-142">What does this mean for the CLI commands and your usage of the toolset?</span></span>

<span data-ttu-id="a349b-143">De uma perspectiva de uso, ele não altera a maneira como você usa a CLI.</span><span class="sxs-lookup"><span data-stu-id="a349b-143">From a usage perspective, it doesn't change the way you use the CLI.</span></span> <span data-ttu-id="a349b-144">A CLI ainda tem os comandos principais que existiam na versão do .NET Core 1,0 Preview 2:</span><span class="sxs-lookup"><span data-stu-id="a349b-144">The CLI still has the core commands that existed in the .NET Core 1.0 Preview 2 release:</span></span>

- `new`
- `restore`
- `run`
- `build`
- `publish`
- `test`
- `pack`

<span data-ttu-id="a349b-145">Esses comandos ainda fazem o que você espera que eles façam (criar um projeto, compilá-lo, publicá-lo, agrupá-lo e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="a349b-145">These commands still do what you expect them to do (new up a project, build it, publish it, pack it, and so on).</span></span> <span data-ttu-id="a349b-146">Você pode consultar a tela de ajuda do comando (usando `dotnet <command> --help`) ou a documentação neste site para se familiarizar com seu comportamento.</span><span class="sxs-lookup"><span data-stu-id="a349b-146">You can consult either the command's help screen (using `dotnet <command> --help`) or documentation on this site to get familiar with their behavior.</span></span>

<span data-ttu-id="a349b-147">De uma perspectiva de execução, os comandos da CLI usam seus parâmetros e constroem uma chamada para o MSBuild "RAW" que define as propriedades necessárias e executa o destino desejado.</span><span class="sxs-lookup"><span data-stu-id="a349b-147">From an execution perspective, the CLI commands take their parameters and construct a call to "raw" MSBuild that sets the needed properties and runs the desired target.</span></span> <span data-ttu-id="a349b-148">Para ilustrar melhor, considere o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="a349b-148">To better illustrate this, consider the following command:</span></span>

   ```dotnetcli
   dotnet publish -o pub -c Release
   ```

<span data-ttu-id="a349b-149">Esse comando publica um aplicativo em uma pasta `pub` usando a configuração "versão".</span><span class="sxs-lookup"><span data-stu-id="a349b-149">This command publishes an application into a `pub` folder using the "Release" configuration.</span></span> <span data-ttu-id="a349b-150">Internamente, esse comando é convertido na seguinte invocação do MSBuild:</span><span class="sxs-lookup"><span data-stu-id="a349b-150">Internally, this command gets translated into the following MSBuild invocation:</span></span>

   ```dotnetcli
   dotnet msbuild -t:Publish -p:OutputPath=pub -p:Configuration=Release
   ```

<span data-ttu-id="a349b-151">As exceções notáveis a essa regra são os comandos `new` e `run`.</span><span class="sxs-lookup"><span data-stu-id="a349b-151">Notable exceptions to this rule are the `new` and `run` commands.</span></span> <span data-ttu-id="a349b-152">Eles não foram implementados como destinos do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="a349b-152">They have not been implemented as MSBuild targets.</span></span>

<a name="dotnet-restore-note"></a>
[!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]
