---
title: Arquitetura das ferramentas de linha de comando do .NET Core
description: Saiba mais sobre as camadas de ferramentas do .NET Core e o que foi alterado nas versões recentes.
author: blackdwarf
ms.date: 03/06/2017
ms.openlocfilehash: 1d96a0b1e19bf84af0ab645ebd104afc899ae656
ms.sourcegitcommit: 70c76a12449439bac0f7a359866be5a0311ce960
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/25/2018
ms.locfileid: "39245123"
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a><span data-ttu-id="4ea2d-103">Visão geral de alto nível das alterações nas ferramentas do .NET Core</span><span class="sxs-lookup"><span data-stu-id="4ea2d-103">High-level overview of changes in the .NET Core tools</span></span>

<span data-ttu-id="4ea2d-104">Este documento descreve as alterações associadas à movimentação de *project.json* para o MSBuild e para o sistema de projeto *csproj*, com informações sobre as alterações na camada de ferramentas do .NET Core e a implementação dos comandos da CLI.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-104">This document describes the changes associated with moving from *project.json* to MSBuild and the *csproj* project system with information on the changes to the layering of the .NET Core tooling and the implementation of the CLI commands.</span></span> <span data-ttu-id="4ea2d-105">Essas alterações ocorreram com o lançamento do SDK 1.0 do .NET Core e do Visual Studio 2017 em 7 de março de 2017 (veja o [comunicado](https://blogs.msdn.microsoft.com/dotnet/2017/03/07/announcing-net-core-tools-1-0/)), mas foram implementadas inicialmente com o lançamento do SDK Preview 3 do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-105">These changes occurred with the release of .NET Core SDK 1.0 and Visual Studio 2017 on March 7, 2017 (see the [announcement](https://blogs.msdn.microsoft.com/dotnet/2017/03/07/announcing-net-core-tools-1-0/)) but were initially implemented with the release of the .NET Core SDK Preview 3.</span></span>

## <a name="moving-away-from-projectjson"></a><span data-ttu-id="4ea2d-106">Deixando o project.json</span><span class="sxs-lookup"><span data-stu-id="4ea2d-106">Moving away from project.json</span></span>
<span data-ttu-id="4ea2d-107">A maior alteração nas ferramentas do .NET Core é certamente a [mudança de project.json para csproj](https://blogs.msdn.microsoft.com/dotnet/2016/05/23/changes-to-project-json/) como o sistema de projeto.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-107">The biggest change in the tooling for .NET Core is certainly the [move away from project.json to csproj](https://blogs.msdn.microsoft.com/dotnet/2016/05/23/changes-to-project-json/) as the project system.</span></span> <span data-ttu-id="4ea2d-108">As últimas versões das ferramentas de linha de comando não dão suporte a arquivos *project.json*.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-108">The latest versions of the command-line tools don't support *project.json* files.</span></span> <span data-ttu-id="4ea2d-109">Isso significa que ele não pode ser usado para compilar, executar ou publicar aplicativos e bibliotecas baseados no project.json.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-109">That means that it cannot be used to build, run or publish project.json based applications and libraries.</span></span> <span data-ttu-id="4ea2d-110">Para usar essa versão das ferramentas, é necessário migrar os projetos existentes ou iniciar projetos novos.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-110">In order to use this version of the tools, you will need to migrate your existing projects or start new ones.</span></span> 

<span data-ttu-id="4ea2d-111">Como parte dessa mudança, o mecanismo de build personalizado desenvolvido para compilar projetos project.json foi substituído por um mecanismo de build maduro e totalmente capaz, chamado [MSBuild](https://github.com/Microsoft/msbuild).</span><span class="sxs-lookup"><span data-stu-id="4ea2d-111">As part of this move, the custom build engine that was developed to build project.json projects was replaced with a mature and fully capable build engine called [MSBuild](https://github.com/Microsoft/msbuild).</span></span> <span data-ttu-id="4ea2d-112">O MSBuild é um mecanismo conhecido na comunidade do .NET, pois que tem sido uma tecnologia chave desde a primeira versão da plataforma.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-112">MSBuild is a well-known engine in the .NET community, since it has been a key technology since the platform's first release.</span></span> <span data-ttu-id="4ea2d-113">Naturalmente, como precisa compilar aplicativos .NET Core, o MSBuild foi movido para o .NET Core e pode ser usado em qualquer plataforma que executa o .NET Core.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-113">Of course, because it needs to build .NET Core applications, MSBuild has been ported to .NET Core and can be used on any platform that .NET Core runs on.</span></span> <span data-ttu-id="4ea2d-114">Uma das principais promessas do .NET Core é uma pilha de desenvolvimento de plataforma cruzada e nós garantimos que essa mudança não quebra essa promessa.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-114">One of the main promises of .NET Core is that of a cross-platform development stack, and we have made sure that this move does not break that promise.</span></span>

> [!NOTE]
> <span data-ttu-id="4ea2d-115">Se você é iniciante no MSBuild e deseja de saber mais sobre ele, comece lendo o artigo [Conceitos do MSBuild](/visualstudio/msbuild/msbuild-concepts).</span><span class="sxs-lookup"><span data-stu-id="4ea2d-115">If you are new to MSBuild and would like to learn more about it, you can start by reading the [MSBuild Concepts](/visualstudio/msbuild/msbuild-concepts) article.</span></span> 

## <a name="the-tooling-layers"></a><span data-ttu-id="4ea2d-116">As camadas de ferramentas</span><span class="sxs-lookup"><span data-stu-id="4ea2d-116">The tooling layers</span></span>
<span data-ttu-id="4ea2d-117">Com a mudança do sistema de projeto existente, bem como com a criação de comutadores de mecanismo, a pergunta que surge naturalmente é: essas mudanças alteram as "camadas" gerais do ecossistema de ferramentas do .NET Core?</span><span class="sxs-lookup"><span data-stu-id="4ea2d-117">With the move away from the existing project system as well as with building engine switches, the question that naturally follows is do any of these changes change the overall "layering" of the whole .NET Core tooling ecosystem?</span></span> <span data-ttu-id="4ea2d-118">Existem novos bits e componentes?</span><span class="sxs-lookup"><span data-stu-id="4ea2d-118">Are there new bits and components?</span></span>

<span data-ttu-id="4ea2d-119">Vamos começar recapitulando as camadas na Visualização 2, conforme mostrado na figura a seguir:</span><span class="sxs-lookup"><span data-stu-id="4ea2d-119">Let's start with a quick refresher on Preview 2 layering as shown in the following picture:</span></span>

![A arquitetura de alto nível das ferramentas da Visualização 2](media/cli-msbuild-architecture/p2-arch.png)

<span data-ttu-id="4ea2d-121">As camadas das ferramentas são bastante simples.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-121">The layering of the tools is quite simple.</span></span> <span data-ttu-id="4ea2d-122">Na parte inferior, temos as ferramentas de Linha de Comando do .NET Core como base.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-122">At the bottom we have the .NET Core Command Line tools as a foundation.</span></span> <span data-ttu-id="4ea2d-123">Todas as outras ferramentas de alto nível, como o Visual Studio ou o Visual Studio Code, dependem e contam com a CLI para criar projetos, restaurar dependências e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-123">All other, higher-level tools such as Visual Studio or Visual Studio Code, depend and rely on the CLI to build projects, restore dependencies and so on.</span></span> <span data-ttu-id="4ea2d-124">Isso significa que, por exemplo, se o Visual Studio quisesse executar uma operação de restauração, ele chamaria o comando `dotnet restore` ([confira a observação](#dotnet-restore-note)) na CLI.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-124">This meant that, for example, if Visual Studio wanted to perform a restore operation, it would call into `dotnet restore` ([see note](#dotnet-restore-note)) command in the CLI.</span></span> 

<span data-ttu-id="4ea2d-125">Com a mudança para o novo sistema de projeto, o diagrama anterior se altera:</span><span class="sxs-lookup"><span data-stu-id="4ea2d-125">With the move to the new project system, the previous diagram changes:</span></span> 

![Arquitetura de alto nível do SDK 1.0.0 do .NET Core](media/cli-msbuild-architecture/p3-arch.png)

<span data-ttu-id="4ea2d-127">A principal diferença é que a CLI não é mais a camada básica; agora, essa função é executada pelo "componente SDK compartilhado".</span><span class="sxs-lookup"><span data-stu-id="4ea2d-127">The main difference is that the CLI is not the foundational layer anymore; this role is now filled by the "shared SDK component".</span></span> <span data-ttu-id="4ea2d-128">Esse componente SDK compartilhado é um conjunto de destinos e tarefas associadas responsáveis por compilar o seu código, publicá-lo, empacotar pacotes NuGet etc. O SDK em si é aberto e está disponível no GitHub no [repositório SDK](https://github.com/dotnet/sdk).</span><span class="sxs-lookup"><span data-stu-id="4ea2d-128">This shared SDK component is a set of targets and associated tasks that are responsible for compiling your code, publishing it, packing NuGet packages etc. The SDK itself is open-source and is available on GitHub on the [SDK repo](https://github.com/dotnet/sdk).</span></span> 

> [!NOTE]
> <span data-ttu-id="4ea2d-129">Um "destino" é um termo do MSBuild que indica uma operação nomeada que o MSBuild pode invocar.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-129">A "target" is a MSBuild term that indicates a named operation that MSBuild can invoke.</span></span> <span data-ttu-id="4ea2d-130">Normalmente, ele está acoplado com uma ou mais tarefas que executam alguma lógica que o destino deve realizar.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-130">It is usually coupled with one or more tasks that execute some logic that the target is supposed to do.</span></span> <span data-ttu-id="4ea2d-131">O MSBuild oferece suporte a muitos destinos prontos como `Copy` ou `Execute`; ele também permite aos usuários gravar suas próprias tarefas usando código gerenciado e definir metas para executar essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-131">MSBuild supports many ready-made targets such as `Copy` or `Execute`; it also allows users to write their own tasks using managed code and define targets to execute those tasks.</span></span> <span data-ttu-id="4ea2d-132">Para mais informações, consulte [Tarefas do MSBuild](/visualstudio/msbuild/msbuild-tasks).</span><span class="sxs-lookup"><span data-stu-id="4ea2d-132">For more information, see [MSBuild tasks](/visualstudio/msbuild/msbuild-tasks).</span></span> 

<span data-ttu-id="4ea2d-133">Todos os conjuntos de ferramentas agora consumem o componente SDK compartilhado e seus destinos, incluindo a CLI.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-133">All the toolsets now consume the shared SDK component and its targets, CLI included.</span></span> <span data-ttu-id="4ea2d-134">Por exemplo, a próxima versão do Visual Studio não chamará o comando `dotnet restore` ([confira a observação](#dotnet-restore-note)) para restaurar dependências para projetos do .NET Core, ela usará diretamente o destino "Restore".</span><span class="sxs-lookup"><span data-stu-id="4ea2d-134">For example, the next version of Visual Studio will not call into `dotnet restore` ([see note](#dotnet-restore-note)) command to restore dependencies for .NET Core projects, it will use the "Restore" target directly.</span></span> <span data-ttu-id="4ea2d-135">Como esses são os destinos do MSBuild, também é possível usar o MSBuild bruto para executá-los, usando o comando [dotnet msbuild](dotnet-msbuild.md).</span><span class="sxs-lookup"><span data-stu-id="4ea2d-135">Since these are MSBuild targets, you can also use raw MSBuild to execute them using the [dotnet msbuild](dotnet-msbuild.md) command.</span></span> 

### <a name="cli-commands"></a><span data-ttu-id="4ea2d-136">Comandos da CLI</span><span class="sxs-lookup"><span data-stu-id="4ea2d-136">CLI commands</span></span>
<span data-ttu-id="4ea2d-137">O componente SDK compartilhado significa que a maioria dos comandos CLI existentes foram reimplementados como destinos e tarefas do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-137">The shared SDK component means that the majority of existing CLI commands have been re-implemented as MSBuild tasks and targets.</span></span> <span data-ttu-id="4ea2d-138">O que isso significa para os comandos CLI e o uso do conjunto de ferramentas?</span><span class="sxs-lookup"><span data-stu-id="4ea2d-138">What does this mean for the CLI commands and your usage of the toolset?</span></span> 

<span data-ttu-id="4ea2d-139">De uma perspectiva de uso, ele não altera a maneira de usar a CLI.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-139">From an usage perspective, it doesn't change the way you use the CLI.</span></span> <span data-ttu-id="4ea2d-140">A CLI ainda tem os comandos principais que existem na versão da Visualização 2:</span><span class="sxs-lookup"><span data-stu-id="4ea2d-140">The CLI still has the core commands that exist in Preview 2 release:</span></span>

* `new`
* `restore`
* `run` 
* `build`
* `publish`
* `test`
* `pack` 

<span data-ttu-id="4ea2d-141">Esses comandos ainda fazem o que você espera que eles façam (criar um projeto, compilá-lo, publicá-lo, empacotá-lo e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="4ea2d-141">These commands still do what you expect them to do (new up a project, build it, publish it, pack it and so on).</span></span> <span data-ttu-id="4ea2d-142">A maioria das opções não foi alterada e ainda está disponível. Além disso, é possível consultar as telas de ajuda dos comandos (usando `dotnet <command> --help`) ou a documentação neste site para se familiarizar com as alterações.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-142">Majority of the options are not changed, and are still there, and you can consult either the commands' help screens (using `dotnet <command> --help`) or documentation on this site to get familiar with any changes.</span></span> 

<span data-ttu-id="4ea2d-143">De uma perspectiva de execução, os comandos CLI assumirão seus parâmetros e construirão uma chamada para o MSBuild "bruto" que defina as propriedades necessárias e execute o destino desejado.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-143">From an execution perspective, the CLI commands will take their parameters and construct a call to "raw" MSBuild that will set the needed properties and run the desired target.</span></span> <span data-ttu-id="4ea2d-144">Para ilustrar melhor, considere o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="4ea2d-144">To better illustrate this, consider the following command:</span></span> 

   `dotnet publish -o pub -c Release`
    
<span data-ttu-id="4ea2d-145">Esse comando está publicando um aplicativo em uma pasta `pub` usando a configuração de "Versão".</span><span class="sxs-lookup"><span data-stu-id="4ea2d-145">This command is publishing an application into a `pub` folder using the "Release" configuration.</span></span> <span data-ttu-id="4ea2d-146">Internamente, esse comando é convertido na seguinte invocação do MSBuild:</span><span class="sxs-lookup"><span data-stu-id="4ea2d-146">Internally, this command gets translated into the following MSBuild invocation:</span></span> 

   `dotnet msbuild /t:Publish /p:OutputPath=pub /p:Configuration=Release`

<span data-ttu-id="4ea2d-147">A exceção notável a essa regra são os comandos `new` e `run`, pois eles não foram implementados como destinos do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="4ea2d-147">The notable exception to this rule are `new` and `run` commands, as they have not been implemented as MSBuild targets.</span></span>

<a name="dotnet-restore-note"></a>  
[!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]
