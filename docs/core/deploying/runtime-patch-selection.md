---
title: Roll forward de tempo de execução de implantação autossuficiente
description: Saiba mais as alterações de dotnet publish em implantações autossuficientes.
author: jralexander
ms.author: kdollard
ms.date: 05/31/2018
ms.openlocfilehash: 39a23917dec1aba5142839265c555da5c1e6f09c
ms.sourcegitcommit: 9e18e4a18284ae9e54c515e30d019c0bbff9cd37
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/28/2018
ms.locfileid: "37071026"
---
# <a name="self-contained-deployment-runtime-roll-forward"></a><span data-ttu-id="7158b-103">Roll forward de tempo de execução de implantação autossuficiente</span><span class="sxs-lookup"><span data-stu-id="7158b-103">Self-contained deployment runtime roll forward</span></span>

<span data-ttu-id="7158b-104">As [implantações de aplicativo autossuficientes](index.md) do .NET Core incluem as bibliotecas e o tempo de execução do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7158b-104">.NET Core [self-contained application deployments](index.md) include both the .NET Core libraries and the .NET Core runtime.</span></span> <span data-ttu-id="7158b-105">A partir do SDK do .NET Core 2.1.300 (.NET Core 2.1), uma implantação de aplicativo autossuficiente [publica o tempo de execução de patch mais recente no computador](https://github.com/dotnet/designs/pull/36).</span><span class="sxs-lookup"><span data-stu-id="7158b-105">Starting in .NET Core SDK 2.1.300 (.NET Core 2.1), a self-contained application deployment [publishes the highest patch runtime on your machine](https://github.com/dotnet/designs/pull/36).</span></span> <span data-ttu-id="7158b-106">Por padrão, [`dotnet publish`](../tools/dotnet-publish.md) para uma implantação autossuficiente seleciona a última versão instalada como parte do SDK no computador de publicação.</span><span class="sxs-lookup"><span data-stu-id="7158b-106">By default, [`dotnet publish`](../tools/dotnet-publish.md) for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine.</span></span> <span data-ttu-id="7158b-107">Isso permite que o aplicativo implantado seja executado com correções de segurança (e outras correções) disponíveis durante `publish`.</span><span class="sxs-lookup"><span data-stu-id="7158b-107">This enables your deployed application to run with security fixes (and other fixes) available during `publish`.</span></span> <span data-ttu-id="7158b-108">O aplicativo precisa ser publicado novamente para obter um novo patch.</span><span class="sxs-lookup"><span data-stu-id="7158b-108">The application must be re-published to obtain a new patch.</span></span> <span data-ttu-id="7158b-109">Os aplicativos autossuficientes são criados pela especificação de `-r <RID>` no comando `dotnet publish`, pela especificação do [RID (identificador de tempo de execução)](../rid-catalog.md) no arquivo de projeto (csproj/vbproj) ou na linha de comando.</span><span class="sxs-lookup"><span data-stu-id="7158b-109">Self-contained applications are created by specifying `-r <RID>` on `dotnet publish` command or by specifying the [runtime identifier (RID)](../rid-catalog.md) in the project file (csproj / vbproj) or on the command line.</span></span>

## <a name="patch-version-roll-forward-overview"></a><span data-ttu-id="7158b-110">Visão geral do roll forward da versão de patch</span><span class="sxs-lookup"><span data-stu-id="7158b-110">Patch version roll forward overview</span></span>

<span data-ttu-id="7158b-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) e [`publish`](../tools/dotnet-publish.md) são comandos `dotnet` que podem ser executados separadamente.</span><span class="sxs-lookup"><span data-stu-id="7158b-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) and [`publish`](../tools/dotnet-publish.md) are `dotnet` commands that can run separately.</span></span> <span data-ttu-id="7158b-112">A opção de tempo de execução faz parte da operação `restore`, não de `publish` nem de `build`.</span><span class="sxs-lookup"><span data-stu-id="7158b-112">The runtime choice is part of the `restore` operation, not `publish` or `build`.</span></span> <span data-ttu-id="7158b-113">Se você chamar `publish`, a última versão de patch será escolhida.</span><span class="sxs-lookup"><span data-stu-id="7158b-113">If you call `publish`, the latest patch version will be chosen.</span></span> <span data-ttu-id="7158b-114">Se você chamar `publish` com o argumento `--no-restore`, poderá não obter a versão de patch desejada, porque um `restore` anterior pode não ter sido executado com a nova política de publicação do aplicativo autossuficiente.</span><span class="sxs-lookup"><span data-stu-id="7158b-114">If you call `publish` with the `--no-restore` argument, then you may not get the desired patch version because a prior `restore` may not have been executed with the new self-contained application publishing policy.</span></span> <span data-ttu-id="7158b-115">Nesse caso, um erro de build é gerado com um texto semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="7158b-115">In this case, a build error is generated with text similar to the following:</span></span>

  <span data-ttu-id="7158b-116">"O projeto foi restaurado usando o Microsoft.NETCore.App versão 2.0.0, mas com as configurações atuais, a versão 2.0.6 será usada em seu lugar.</span><span class="sxs-lookup"><span data-stu-id="7158b-116">"The project was restored using Microsoft.NETCore.App version 2.0.0, but with current settings, version 2.0.6 would be used instead.</span></span> <span data-ttu-id="7158b-117">Para resolver esse problema, verifique se as mesmas configurações são usadas para restauração e para as operações seguintes, como build ou publicação.</span><span class="sxs-lookup"><span data-stu-id="7158b-117">To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish.</span></span> <span data-ttu-id="7158b-118">Normalmente, esse problema pode ocorrer se a propriedade RuntimeIdentifier é definida durante o build ou a publicação, mas não durante a restauração."</span><span class="sxs-lookup"><span data-stu-id="7158b-118">Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore."</span></span>

> [!NOTE]
> <span data-ttu-id="7158b-119">`restore` e `build` podem ser executados implicitamente como parte de outro comando, como `publish`.</span><span class="sxs-lookup"><span data-stu-id="7158b-119">`restore` and `build` can be run implicitly as part of another command, like `publish`.</span></span> <span data-ttu-id="7158b-120">Quando executados implicitamente como parte de outro comando, eles são fornecidos com um contexto adicional para que os artefatos corretos sejam produzidos.</span><span class="sxs-lookup"><span data-stu-id="7158b-120">When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced.</span></span> <span data-ttu-id="7158b-121">Quando você executa `publish` com um tempo de execução (por exemplo, `dotnet publish -r linux-x64`), o `restore` implícito restaura os pacotes para o tempo de execução linux-x64.</span><span class="sxs-lookup"><span data-stu-id="7158b-121">When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime.</span></span> <span data-ttu-id="7158b-122">Se você chama `restore` explicitamente, ele não restaura os pacotes de tempo de execução por padrão, porque não tem esse contexto.</span><span class="sxs-lookup"><span data-stu-id="7158b-122">If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.</span></span>

## <a name="how-to-avoid-restore-during-publish"></a><span data-ttu-id="7158b-123">Como evitar a restauração durante a publicação</span><span class="sxs-lookup"><span data-stu-id="7158b-123">How to avoid restore during publish</span></span>

<span data-ttu-id="7158b-124">A execução de `restore` como parte da operação `publish` pode ser indesejável para seu cenário.</span><span class="sxs-lookup"><span data-stu-id="7158b-124">Running `restore` as part of the `publish` operation may be undesirable for your scenario.</span></span> <span data-ttu-id="7158b-125">Para evitar `restore` durante `publish` ao criar aplicativos autossuficientes, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="7158b-125">To avoid `restore` during `publish` while creating self-contained applications, do the following:</span></span>

* <span data-ttu-id="7158b-126">Defina a propriedade `RuntimeIdentifiers` como uma lista separada por ponto e vírgula de todos os [RIDs](../rid-catalog.md) a serem publicados.</span><span class="sxs-lookup"><span data-stu-id="7158b-126">Set the `RuntimeIdentifiers` property to a semicolon-separated list of all the [RIDs](../rid-catalog.md) to be published.</span></span>
* <span data-ttu-id="7158b-127">Defina a propriedade `TargetLatestRuntimePatch` como `true`.</span><span class="sxs-lookup"><span data-stu-id="7158b-127">Set the `TargetLatestRuntimePatch` property to `true`.</span></span>

## <a name="no-restore-argument-with-dotnet-publish-options"></a><span data-ttu-id="7158b-128">Argumento no-restore com opções dotnet publish</span><span class="sxs-lookup"><span data-stu-id="7158b-128">No-restore argument with dotnet publish options</span></span>

<span data-ttu-id="7158b-129">Caso deseje criar aplicativos autossuficientes e [aplicativos dependentes de estrutura](index.md) com o mesmo arquivo de projeto e usar o argumento `--no-restore` com `dotnet publish`, escolha um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="7158b-129">If you want to create both self-contained applications and [framework-dependent applications](index.md) with the same project file, and you want to use the `--no-restore` argument with `dotnet publish`, then choose one of the following:</span></span>

1. <span data-ttu-id="7158b-130">Prefira o comportamento dependente de estrutura.</span><span class="sxs-lookup"><span data-stu-id="7158b-130">Prefer the framework-dependent behavior.</span></span> <span data-ttu-id="7158b-131">Se o aplicativo depende de uma estrutura, esse é o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="7158b-131">If the application is framework-dependent, this is the default behavior.</span></span> <span data-ttu-id="7158b-132">Se o aplicativo for autossuficiente e puder usar um tempo de execução local 2.1.0 sem patch, defina o `TargetLatestRuntimePatch` como `false` no arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="7158b-132">If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the `TargetLatestRuntimePatch` to `false` in the project file.</span></span>

2. <span data-ttu-id="7158b-133">Prefira o comportamento autossuficiente.</span><span class="sxs-lookup"><span data-stu-id="7158b-133">Prefer the self-contained behavior.</span></span> <span data-ttu-id="7158b-134">Se o aplicativo é autossuficiente, esse é o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="7158b-134">If the application is self-contained, this is the default behavior.</span></span> <span data-ttu-id="7158b-135">Se o aplicativo depende de uma estrutura e exige o último patch instalado, defina `TargetLatestRuntimePatch` como `true` no arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="7158b-135">If the application is framework-dependent, and requires the latest patch installed, set `TargetLatestRuntimePatch` to `true` in the project file.</span></span>

3. <span data-ttu-id="7158b-136">Assuma o controle explícito da versão da estrutura de tempo de execução definindo `RuntimeFrameworkVersion` como a versão de patch específica no arquivo de projeto.</span><span class="sxs-lookup"><span data-stu-id="7158b-136">Take explicit control of the runtime framework version by setting `RuntimeFrameworkVersion` to the specific patch version in the project file.</span></span>
