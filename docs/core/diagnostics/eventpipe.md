---
title: Visão geral do EventPipe
description: Saiba mais sobre o EventPipe e como usá-lo para rastrear seus aplicativos .NET para diagnosticar problemas de desempenho.
ms.date: 11/09/2020
ms.topic: overview
ms.openlocfilehash: 00378c4f409b307afa9183e40de6078cdafd3ae7
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94820612"
---
# <a name="eventpipe"></a><span data-ttu-id="c000f-103">EventPipe</span><span class="sxs-lookup"><span data-stu-id="c000f-103">EventPipe</span></span>

<span data-ttu-id="c000f-104">EventPipe é um componente de tempo de execução que pode ser usado para coletar dados de rastreamento, semelhante ao ETW ou ao LTTng.</span><span class="sxs-lookup"><span data-stu-id="c000f-104">EventPipe is a runtime component that can be used to collect tracing data, similar to ETW or LTTng.</span></span> <span data-ttu-id="c000f-105">O objetivo do EventPipe é permitir que os desenvolvedores do .NET rastreiem facilmente seus aplicativos .NET sem precisar contar com componentes nativos do sistema operacional específicos da plataforma, como o ETW ou o LTTng.</span><span class="sxs-lookup"><span data-stu-id="c000f-105">The goal of EventPipe is to allow .NET developers to easily trace their .NET applications without having to rely on platform-specific OS-native components such as ETW or LTTng.</span></span>

<span data-ttu-id="c000f-106">EventPipe é o mecanismo por trás de muitas das ferramentas de diagnóstico e pode ser usado para consumir eventos emitidos pelo tempo de execução, bem como eventos personalizados escritos com [EventSource](xref:System.Diagnostics.Tracing.EventSource).</span><span class="sxs-lookup"><span data-stu-id="c000f-106">EventPipe is the mechanism behind many of the diagnostic tools and can be used for consuming events emitted by the runtime as well as custom events written with [EventSource](xref:System.Diagnostics.Tracing.EventSource).</span></span>

<span data-ttu-id="c000f-107">Este artigo é uma visão geral de alto nível do EventPipe que descreve quando e como usar o EventPipe e como configurá-lo para melhor atender às suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="c000f-107">This article is a high-level overview of EventPipe describing when and how to use EventPipe, and how to configure it to best suit your needs.</span></span>

## <a name="eventpipe-basics"></a><span data-ttu-id="c000f-108">Noções básicas do EventPipe</span><span class="sxs-lookup"><span data-stu-id="c000f-108">EventPipe basics</span></span>

<span data-ttu-id="c000f-109">O EventPipe agrega eventos emitidos por componentes de tempo de execução, por exemplo, o compilador just-in-time ou o coletor de lixo e eventos gravados de instâncias de [EventSource](xref:System.Diagnostics.Tracing.EventSource) nas bibliotecas e no código do usuário.</span><span class="sxs-lookup"><span data-stu-id="c000f-109">EventPipe aggregates events emitted by runtime components - for example, the Just-In-Time compiler or the garbage collector - and events written from [EventSource](xref:System.Diagnostics.Tracing.EventSource) instances in the libraries and user code.</span></span>

<span data-ttu-id="c000f-110">Os eventos são serializados e podem ser gravados diretamente em um arquivo ou consumidos por meio de uma porta de diagnóstico a partir de um processo de saída.</span><span class="sxs-lookup"><span data-stu-id="c000f-110">The events are then serialized and can be written directly to a file or consumed through a Diagnostics Port from out-of-proces.</span></span> <span data-ttu-id="c000f-111">No Windows, as portas de diagnóstico são implementadas como `NamedPipe` s.</span><span class="sxs-lookup"><span data-stu-id="c000f-111">On Windows, Diagnostic Ports are implemented as `NamedPipe`s.</span></span> <span data-ttu-id="c000f-112">Em plataformas não Windows, como Linux ou macOS, ele é implementado usando soquetes de domínio do UNIX.</span><span class="sxs-lookup"><span data-stu-id="c000f-112">On non-Windows platforms, such as Linux or macOS, it is implemented using Unix Domain Sockets.</span></span> <span data-ttu-id="c000f-113">Para obter mais informações sobre a porta de diagnóstico e como interagir com ela por meio de seu protocolo de comunicação entre processos personalizado, consulte a [documentação do protocolo IPC do Diagnostics](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span><span class="sxs-lookup"><span data-stu-id="c000f-113">For more information about the Diagnostics Port and how to interact with it via its custom inter-process communication protocol, see the [diagnostics IPC protocol documentation](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span></span>

<span data-ttu-id="c000f-114">Em seguida, o EventPipe grava os eventos serializados no `.nettrace` formato de arquivo, seja como um fluxo por meio de portas de diagnóstico ou diretamente para um arquivo.</span><span class="sxs-lookup"><span data-stu-id="c000f-114">EventPipe then writes the serialized events in the `.nettrace` file format, either as a stream via Diagnostic Ports or directly to a file.</span></span> <span data-ttu-id="c000f-115">Para saber mais sobre o formato de serialização EventPipe, consulte a [documentação do formato EventPipe](https://github.com/microsoft/perfview/blob/master/src/TraceEvent/EventPipe/EventPipeFormat.md).</span><span class="sxs-lookup"><span data-stu-id="c000f-115">To learn more about the EventPipe serialization format, refer to the [EventPipe format documentation](https://github.com/microsoft/perfview/blob/master/src/TraceEvent/EventPipe/EventPipeFormat.md).</span></span>

## <a name="eventpipe-vs-etwlttng"></a><span data-ttu-id="c000f-116">EventPipe vs. ETW/LTTng</span><span class="sxs-lookup"><span data-stu-id="c000f-116">EventPipe vs. ETW/LTTng</span></span>

<span data-ttu-id="c000f-117">O EventPipe faz parte do tempo de execução do .NET (CoreCLR) e foi projetado para funcionar da mesma forma em todas as plataformas com suporte do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="c000f-117">EventPipe is part of the .NET runtime (CoreCLR) and is designed to work the same way across all the platforms .NET Core supports.</span></span> <span data-ttu-id="c000f-118">Isso permite que as ferramentas de rastreamento baseadas em EventPipe, como `dotnet-counters` , `dotnet-gcdump` e `dotnet-trace` , funcionem diretamente entre as plataformas.</span><span class="sxs-lookup"><span data-stu-id="c000f-118">This allows tracing tools based on EventPipe, such as `dotnet-counters`, `dotnet-gcdump`, and `dotnet-trace`, to work seamlessly across platforms.</span></span>

<span data-ttu-id="c000f-119">No entanto, como EventPipe é um componente interno de tempo de execução, seu escopo é limitado ao código gerenciado e ao próprio tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="c000f-119">However, because EventPipe is a runtime built-in component, its scope is limited to managed code and the runtime itself.</span></span> <span data-ttu-id="c000f-120">EventPipe não pode ser usado para acompanhar alguns eventos de nível inferior, como a resolução de uma pilha de código nativa ou a obtenção de vários eventos de kernel.</span><span class="sxs-lookup"><span data-stu-id="c000f-120">EventPipe cannot be used for tracking some lower-level events, such as resolving native code stack or getting various kernel events.</span></span> <span data-ttu-id="c000f-121">Se você usar a interoperabilidade C/C++ em seu aplicativo ou desejar rastrear o tempo de execução em si (que é escrito em C++) ou desejar um diagnóstico mais profundo no comportamento do aplicativo que requer eventos de kernel (ou seja, eventos de alternância de contexto de thread nativo), você deve usar ETW ou [perf/LTTng](./trace-perfcollect-lttng.md).</span><span class="sxs-lookup"><span data-stu-id="c000f-121">If you use C/C++ interop in your app or you want to trace the runtime itself (which is written in C++), or want deeper diagnostics into the behavior of the app that requires kernel events (that is, native-thread context-switching events) you should use ETW or [perf/LTTng](./trace-perfcollect-lttng.md).</span></span>

<span data-ttu-id="c000f-122">Outra grande diferença entre EventPipe e ETW/LTTng é o requisito de privilégio de administrador/raiz.</span><span class="sxs-lookup"><span data-stu-id="c000f-122">Another major difference between EventPipe and ETW/LTTng is admin/root privilege requirement.</span></span> <span data-ttu-id="c000f-123">Para rastrear um aplicativo usando ETW ou LTTng, você precisa ser um administrador/raiz.</span><span class="sxs-lookup"><span data-stu-id="c000f-123">To trace an application using ETW or LTTng you need to be an admin/root.</span></span> <span data-ttu-id="c000f-124">Usando o EventPipe, você pode rastrear aplicativos, desde que o rastreador (por exemplo, `dotnet-trace` ) seja executado como o mesmo usuário que o usuário que iniciou o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c000f-124">Using EventPipe, you can trace applications as long as the tracer (for example, `dotnet-trace`) is run as the same user as the user that launched the application.</span></span>

<span data-ttu-id="c000f-125">A tabela a seguir é um resumo das diferenças entre EventPipe e ETW/LTTng.</span><span class="sxs-lookup"><span data-stu-id="c000f-125">The following table is a summary of the differences between EventPipe and ETW/LTTng.</span></span>

|<span data-ttu-id="c000f-126">Recurso</span><span class="sxs-lookup"><span data-stu-id="c000f-126">Feature</span></span>|<span data-ttu-id="c000f-127">EventPipe</span><span class="sxs-lookup"><span data-stu-id="c000f-127">EventPipe</span></span>|<span data-ttu-id="c000f-128">ETW</span><span class="sxs-lookup"><span data-stu-id="c000f-128">ETW</span></span>|<span data-ttu-id="c000f-129">LTTng</span><span class="sxs-lookup"><span data-stu-id="c000f-129">LTTng</span></span>|
|-------|---------|---|-----------|
|<span data-ttu-id="c000f-130">Plataforma cruzada</span><span class="sxs-lookup"><span data-stu-id="c000f-130">Cross-platform</span></span>|<span data-ttu-id="c000f-131">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-131">Yes</span></span>|<span data-ttu-id="c000f-132">Não (somente no Windows)</span><span class="sxs-lookup"><span data-stu-id="c000f-132">No (only on Windows)</span></span>|<span data-ttu-id="c000f-133">Não (somente em distribuições do Linux com suporte)</span><span class="sxs-lookup"><span data-stu-id="c000f-133">No (only on supported Linux distros)</span></span>|
|<span data-ttu-id="c000f-134">Exigir privilégio de administrador/raiz</span><span class="sxs-lookup"><span data-stu-id="c000f-134">Require admin/root privilege</span></span>|<span data-ttu-id="c000f-135">Não</span><span class="sxs-lookup"><span data-stu-id="c000f-135">No</span></span>|<span data-ttu-id="c000f-136">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-136">Yes</span></span>|<span data-ttu-id="c000f-137">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-137">Yes</span></span>|
|<span data-ttu-id="c000f-138">Pode obter eventos de sistema operacional/kernel</span><span class="sxs-lookup"><span data-stu-id="c000f-138">Can get OS/kernel events</span></span>|<span data-ttu-id="c000f-139">Não</span><span class="sxs-lookup"><span data-stu-id="c000f-139">No</span></span>|<span data-ttu-id="c000f-140">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-140">Yes</span></span>|<span data-ttu-id="c000f-141">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-141">Yes</span></span>|
|<span data-ttu-id="c000f-142">Pode resolver transchamadas nativas</span><span class="sxs-lookup"><span data-stu-id="c000f-142">Can resolve native callstacks</span></span>|<span data-ttu-id="c000f-143">Não</span><span class="sxs-lookup"><span data-stu-id="c000f-143">No</span></span>|<span data-ttu-id="c000f-144">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-144">Yes</span></span>|<span data-ttu-id="c000f-145">Sim</span><span class="sxs-lookup"><span data-stu-id="c000f-145">Yes</span></span>|

## <a name="use-eventpipe-to-trace-your-net-application"></a><span data-ttu-id="c000f-146">Usar o EventPipe para rastrear seu aplicativo .NET</span><span class="sxs-lookup"><span data-stu-id="c000f-146">Use EventPipe to trace your .NET application</span></span>

<span data-ttu-id="c000f-147">Você pode usar o EventPipe para rastrear seu aplicativo .NET de várias maneiras:</span><span class="sxs-lookup"><span data-stu-id="c000f-147">You can use EventPipe to trace your .NET application in many ways:</span></span>

* <span data-ttu-id="c000f-148">Use uma das [ferramentas de diagnóstico](#tools-that-use-eventpipe) criadas com base no EventPipe.</span><span class="sxs-lookup"><span data-stu-id="c000f-148">Use one of the [diagnostics tools](#tools-that-use-eventpipe) that are built on top of EventPipe.</span></span>

* <span data-ttu-id="c000f-149">Use a biblioteca [Microsoft. Diagnostics. NetCore. cliente](https://github.com/dotnet/diagnostics/blob/master/documentation/diagnostics-client-library-instructions.md) para escrever sua própria ferramenta para configurar e iniciar as sessões do EventPipe por conta própria.</span><span class="sxs-lookup"><span data-stu-id="c000f-149">Use [Microsoft.Diagnostics.NETCore.Client](https://github.com/dotnet/diagnostics/blob/master/documentation/diagnostics-client-library-instructions.md) library to write your own tool to configure and start EventPipe sessions yourself.</span></span>

* <span data-ttu-id="c000f-150">Use [variáveis de ambiente](#trace-using-environment-variables) para iniciar o EventPipe.</span><span class="sxs-lookup"><span data-stu-id="c000f-150">Use [environment variables](#trace-using-environment-variables) to start EventPipe.</span></span>

<span data-ttu-id="c000f-151">Depois de produzir um `nettrace` arquivo que contém seus eventos do EventPipe, você pode exibir o arquivo no [`PerfView`](https://github.com/Microsoft/perfview#perfview-overview) ou no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c000f-151">After you've produced a `nettrace` file that contains your EventPipe events, you can view the file in [`PerfView`](https://github.com/Microsoft/perfview#perfview-overview) or Visual Studio.</span></span> <span data-ttu-id="c000f-152">Em plataformas não Windows, você pode converter o `nettrace` arquivo em um `speedscope` formato de `Chromium` rastreamento ou usando o [`dotnet-trace convert`](./dotnet-trace.md#dotnet-trace-convert) comando e exibi-lo com o [`speedscope`](https://www.speedscope.app/) ou o Chrome devtools.</span><span class="sxs-lookup"><span data-stu-id="c000f-152">On non-Windows platforms, you can convert the `nettrace` file to a `speedscope` or `Chromium` trace format by using [`dotnet-trace convert`](./dotnet-trace.md#dotnet-trace-convert) command and view it with [`speedscope`](https://www.speedscope.app/) or Chrome DevTools.</span></span>

<span data-ttu-id="c000f-153">Você também pode analisar rastreamentos de EventPipe programaticamente com [TraceEvent](https://github.com/Microsoft/perfview/blob/master/documentation/TraceEvent/TraceEventLibrary.md).</span><span class="sxs-lookup"><span data-stu-id="c000f-153">You can also analyze EventPipe traces programmatically with [TraceEvent](https://github.com/Microsoft/perfview/blob/master/documentation/TraceEvent/TraceEventLibrary.md).</span></span>

### <a name="tools-that-use-eventpipe"></a><span data-ttu-id="c000f-154">Ferramentas que usam EventPipe</span><span class="sxs-lookup"><span data-stu-id="c000f-154">Tools that use EventPipe</span></span>

<span data-ttu-id="c000f-155">Essa é a maneira mais fácil de usar o EventPipe para rastrear seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c000f-155">This is the easiest way to use EventPipe to trace your application.</span></span> <span data-ttu-id="c000f-156">Para saber mais sobre como usar cada uma dessas ferramentas, consulte a documentação de cada ferramenta.</span><span class="sxs-lookup"><span data-stu-id="c000f-156">To learn more about how to use each of these tools, refer to each tool's documentation.</span></span>

* <span data-ttu-id="c000f-157">[dotnet-os contadores](./dotnet-counters.md) permitem monitorar e coletar várias métricas emitidas pelo tempo de execução do .net e pelas bibliotecas principais, bem como métricas personalizadas que você pode escrever.</span><span class="sxs-lookup"><span data-stu-id="c000f-157">[dotnet-counters](./dotnet-counters.md) lets you monitor and collect various metrics emitted by the .NET runtime and core libraries, as well as custom metrics you can write.</span></span>

* <span data-ttu-id="c000f-158">[dotnet-gcdump](./dotnet-gcdump.md) permite coletar despejos de heap de GC de processos ao vivo para analisar o heap gerenciado de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c000f-158">[dotnet-gcdump](./dotnet-gcdump.md) lets you collect GC heap dumps of live processes for analyzing an application's managed heap.</span></span>

* <span data-ttu-id="c000f-159">[dotnet-Trace](./dotnet-trace.md) permite que você colete rastreamentos de aplicativos para analisar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="c000f-159">[dotnet-trace](./dotnet-trace.md) lets you collect traces of applications to analyze for performance.</span></span>

## <a name="trace-using-environment-variables"></a><span data-ttu-id="c000f-160">Rastrear usando variáveis de ambiente</span><span class="sxs-lookup"><span data-stu-id="c000f-160">Trace using environment variables</span></span>

<span data-ttu-id="c000f-161">O mecanismo preferencial para usar EventPipe é usar `dotnet-trace` ou a `Microsoft.Diagnostics.NETCore.Client` biblioteca.</span><span class="sxs-lookup"><span data-stu-id="c000f-161">The preferred mechanism for using EventPipe is to use `dotnet-trace` or the `Microsoft.Diagnostics.NETCore.Client` library.</span></span>

<span data-ttu-id="c000f-162">No entanto, você pode usar as seguintes variáveis de ambiente para configurar uma sessão EventPipe em um aplicativo e fazer com que ela grave o rastreamento diretamente em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="c000f-162">However, you can use the following environment variables to set up an EventPipe session on an app and have it write the trace directly to a file.</span></span> <span data-ttu-id="c000f-163">Para interromper o rastreamento, saia do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c000f-163">To stop tracing, exit the application.</span></span>

* <span data-ttu-id="c000f-164">`COMPlus_EnableEventPipe`: Defina isso como `1` para iniciar uma sessão EventPipe que grava diretamente em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="c000f-164">`COMPlus_EnableEventPipe`: Set this to `1` to start an EventPipe session that writes directly to a file.</span></span> <span data-ttu-id="c000f-165">O valor padrão é `0`.</span><span class="sxs-lookup"><span data-stu-id="c000f-165">The default value is `0`.</span></span>

* <span data-ttu-id="c000f-166">`COMPlus_EventPipeOutputPath`: O caminho para o arquivo de rastreamento EventPipe de saída quando ele é configurado para ser executado via `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="c000f-166">`COMPlus_EventPipeOutputPath`: The path to the output EventPipe trace file when it's configured to run via `COMPlus_EnableEventPipe`.</span></span> <span data-ttu-id="c000f-167">O valor padrão é `trace.nettrace` , que será criado no mesmo diretório do qual o aplicativo está sendo executado.</span><span class="sxs-lookup"><span data-stu-id="c000f-167">The default value is `trace.nettrace`, which will be created in the same directory that the app is running from.</span></span>

* <span data-ttu-id="c000f-168">`COMPlus_CircularBufferMB`: O tamanho do buffer interno usado pelo EventPipe quando ele é configurado para ser executado via `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="c000f-168">`COMPlus_CircularBufferMB`: The size of the internal buffer that is used by EventPipe when it's configured to run via `COMPlus_EnableEventPipe`.</span></span>

* <span data-ttu-id="c000f-169">`COMPlus_EventPipeConfig`: Define a configuração de sessão EventPipe ao iniciar uma sessão EventPipe com `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="c000f-169">`COMPlus_EventPipeConfig`: Sets up the EventPipe session configuration when starting an EventPipe session with `COMPlus_EnableEventPipe`.</span></span>

  <span data-ttu-id="c000f-170">A sintaxe dela é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="c000f-170">The syntax is as follows:</span></span>

  `<provider>:<keyword>:<level>`

  <span data-ttu-id="c000f-171">Você também pode especificar vários provedores concatenando-os com uma vírgula:</span><span class="sxs-lookup"><span data-stu-id="c000f-171">You can also specify multiple providers by concatenating them with a comma:</span></span>

  `<provider1>:<keyword1>:<level1>,<provider2>:<keyword2>:<level2>`

  <span data-ttu-id="c000f-172">Se essa variável de ambiente não estiver definida, mas o EventPipe estiver habilitado pelo `COMPlus_EnableEventPipe` , ele iniciará o rastreamento habilitando os provedores a seguir com as seguintes palavras-chave e níveis:</span><span class="sxs-lookup"><span data-stu-id="c000f-172">If this environment variable is not set but EventPipe is enabled by `COMPlus_EnableEventPipe`, it will start tracing by enabling the following providers with the following keywords and levels:</span></span>

  - `Microsoft-Windows-DotNETRuntime:4c14fccbd:5`
  - `Microsoft-Windows-DotNETRuntimePrivate:4002000b:5`
  - `Microsoft-DotNETCore-SampleProfiler:0:5`
