---
title: Atualize sua base de código para usar tipos de referência anulados
description: Escolha a melhor estratégia para atualizar sua base de código para usar tipos de referência anulados.
ms.technology: csharp-null-safety
ms.date: 07/31/2019
ms.openlocfilehash: b4a10863aea5c47b47c2a017afb20786b1e67528
ms.sourcegitcommit: 73aa9653547a1cd70ee6586221f79cc29b588ebd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2020
ms.locfileid: "82103523"
---
# <a name="update-libraries-to-use-nullable-reference-types-and-communicate-nullable-rules-to-callers"></a><span data-ttu-id="67bc4-103">Atualize bibliotecas para usar tipos de referência anulados e comunicar regras anuladas aos chamadores</span><span class="sxs-lookup"><span data-stu-id="67bc4-103">Update libraries to use nullable reference types and communicate nullable rules to callers</span></span>

<span data-ttu-id="67bc4-104">A adição de tipos de [referência anulados](nullable-references.md) significa que você pode declarar se um `null` valor é permitido ou esperado para cada variável.</span><span class="sxs-lookup"><span data-stu-id="67bc4-104">The addition of [nullable reference types](nullable-references.md) means you can declare whether or not a `null` value is allowed or expected for every variable.</span></span> <span data-ttu-id="67bc4-105">Além disso, você pode aplicar uma `AllowNull` `DisallowNull`série `MaybeNull` `NotNull`de `NotNullWhen` `MaybeNullWhen`atributos: , , , , , , , , e `NotNullIfNotNull` descrever completamente os estados nulos de argumento e valores de devolução.</span><span class="sxs-lookup"><span data-stu-id="67bc4-105">In addition, you can apply a number of attributes: `AllowNull`, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull` to completely describe the null states of argument and return values.</span></span> <span data-ttu-id="67bc4-106">Isso proporciona uma grande experiência enquanto você escreve código.</span><span class="sxs-lookup"><span data-stu-id="67bc4-106">That provides a great experience as you write code.</span></span> <span data-ttu-id="67bc4-107">Você recebe avisos se uma variável não-nula pode ser definida como `null`.</span><span class="sxs-lookup"><span data-stu-id="67bc4-107">You get warnings if a non-nullable variable might be set to `null`.</span></span> <span data-ttu-id="67bc4-108">Você recebe avisos se uma variável anulada não for verificada nula antes de desreferencia-la.</span><span class="sxs-lookup"><span data-stu-id="67bc4-108">You get warnings if a nullable variable isn't null-checked before you dereference it.</span></span> <span data-ttu-id="67bc4-109">Atualizar suas bibliotecas pode levar tempo, mas os pagamentos valem a pena.</span><span class="sxs-lookup"><span data-stu-id="67bc4-109">Updating your libraries can take time, but the payoffs are worth it.</span></span> <span data-ttu-id="67bc4-110">Quanto mais informações você fornecer ao compilador sobre *quando* um `null` valor é permitido ou proibido, melhores avisos os usuários de sua API receberão.</span><span class="sxs-lookup"><span data-stu-id="67bc4-110">The more information you provide to the compiler about *when* a `null` value is allowed or prohibited, the better warnings users of your API will get.</span></span> <span data-ttu-id="67bc4-111">Vamos começar com um exemplo familiar.</span><span class="sxs-lookup"><span data-stu-id="67bc4-111">Let's start with a familiar example.</span></span> <span data-ttu-id="67bc4-112">Imagine que sua biblioteca tem a seguinte API para recuperar uma seqüência de recursos:</span><span class="sxs-lookup"><span data-stu-id="67bc4-112">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="67bc4-113">O exemplo anterior segue `Try*` o padrão familiar em .NET.</span><span class="sxs-lookup"><span data-stu-id="67bc4-113">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="67bc4-114">Existem dois argumentos de referência `key` para `message` esta API: o e o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="67bc4-114">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="67bc4-115">Esta API tem as seguintes regras relativas à nulidade desses argumentos:</span><span class="sxs-lookup"><span data-stu-id="67bc4-115">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="67bc4-116">Os chamadores `null` não devem `key`passar como argumento para .</span><span class="sxs-lookup"><span data-stu-id="67bc4-116">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="67bc4-117">Os chamadores podem passar `null` uma variável `message`cujo valor é como o argumento para .</span><span class="sxs-lookup"><span data-stu-id="67bc4-117">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="67bc4-118">Se `TryGetMessage` o `true`método retornar, `message` o valor de não é nulo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-118">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="67bc4-119">Se o valor `false,` de `message` devolução for o valor de (e seu estado nulo) é nulo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-119">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="67bc4-120">A regra `key` para pode ser completamente expressa `key` pelo tipo de variável: deve ser um tipo de referência não anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-120">The rule for `key` can be completely expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="67bc4-121">O `message` parâmetro é mais complexo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-121">The `message` parameter is more complex.</span></span> <span data-ttu-id="67bc4-122">Permite `null` como argumento, mas garante que, `out` no sucesso, esse argumento não é nulo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-122">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="67bc4-123">Para esses cenários, você precisa de um vocabulário mais rico para descrever as expectativas.</span><span class="sxs-lookup"><span data-stu-id="67bc4-123">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="67bc4-124">Atualizar sua biblioteca para referências anuladas `?` requer mais do que polvilhar algumas das variáveis e nomes de tipo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-124">Updating your library for nullable references requires more than sprinkling `?` on some of the variables and type names.</span></span> <span data-ttu-id="67bc4-125">O exemplo anterior mostra que você precisa examinar suas APIs e considerar suas expectativas para cada argumento de entrada.</span><span class="sxs-lookup"><span data-stu-id="67bc4-125">The preceding example shows that you need to examine your APIs and consider your expectations for each input argument.</span></span> <span data-ttu-id="67bc4-126">Considere as garantias para o `out` valor `ref` de devolução, e quaisquer ou argumentos sobre o retorno do método.</span><span class="sxs-lookup"><span data-stu-id="67bc4-126">Consider the guarantees for the return value, and any `out` or `ref` arguments upon the method's return.</span></span> <span data-ttu-id="67bc4-127">Em seguida, comunique essas regras ao compilador, e o compilador fornecerá avisos quando os chamadores não cumprirem essas regras.</span><span class="sxs-lookup"><span data-stu-id="67bc4-127">Then communicate those rules to the compiler, and the compiler will provide warnings when callers don't abide by those rules.</span></span>

<span data-ttu-id="67bc4-128">Este trabalho leva tempo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-128">This work takes time.</span></span> <span data-ttu-id="67bc4-129">Vamos começar com estratégias para tornar sua biblioteca ou aplicativo anulado, ao mesmo tempo em que equilibra mos outros requisitos e entregas.</span><span class="sxs-lookup"><span data-stu-id="67bc4-129">Let's start with strategies to make your library or application nullable-aware, while balancing other requirements and deliverables.</span></span> <span data-ttu-id="67bc4-130">Você verá como equilibrar o desenvolvimento contínuo permitindo tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="67bc4-130">You'll see how to balance ongoing development enabling nullable reference types.</span></span> <span data-ttu-id="67bc4-131">Você aprenderá desafios para definições de tipos genéricos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-131">You'll learn challenges for generic type definitions.</span></span> <span data-ttu-id="67bc4-132">Você aprenderá a aplicar atributos para descrever pré e pós-condições em APIs individuais.</span><span class="sxs-lookup"><span data-stu-id="67bc4-132">You'll learn to apply attributes to describe pre- and post-conditions on individual APIs.</span></span>

## <a name="choose-a-strategy-for-nullable-reference-types"></a><span data-ttu-id="67bc4-133">Escolha uma estratégia para tipos de referência anulados</span><span class="sxs-lookup"><span data-stu-id="67bc4-133">Choose a strategy for nullable reference types</span></span>

<span data-ttu-id="67bc4-134">A primeira escolha é se os tipos de referência anulados devem estar ligados ou desligados por padrão.</span><span class="sxs-lookup"><span data-stu-id="67bc4-134">The first choice is whether nullable reference types should be on or off by default.</span></span> <span data-ttu-id="67bc4-135">Você tem duas estratégias:</span><span class="sxs-lookup"><span data-stu-id="67bc4-135">You have two strategies:</span></span>

- <span data-ttu-id="67bc4-136">Habilite tipos de referência anulados para todo o projeto e desative-o em código que não está pronto.</span><span class="sxs-lookup"><span data-stu-id="67bc4-136">Enable nullable reference types for the entire project, and disable it in code that's not ready.</span></span>
- <span data-ttu-id="67bc4-137">Apenas habilite tipos de referência anulados para código que tenha sido anotado para tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="67bc4-137">Only enable nullable reference types for code that's been annotated for nullable reference types.</span></span>

<span data-ttu-id="67bc4-138">A primeira estratégia funciona melhor quando você está adicionando outros recursos à biblioteca à medida que você atualizá-la para tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="67bc4-138">The first strategy works best when you're adding other features to the library as you update it for nullable reference types.</span></span> <span data-ttu-id="67bc4-139">Todo novo desenvolvimento é anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-139">All new development is nullable aware.</span></span> <span data-ttu-id="67bc4-140">Ao atualizar o código existente, você habilita tipos de referência anulados nessas classes.</span><span class="sxs-lookup"><span data-stu-id="67bc4-140">As you update existing code, you enable nullable reference types in those classes.</span></span>

<span data-ttu-id="67bc4-141">Seguindo esta primeira estratégia, você faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="67bc4-141">Following this first strategy, you do the following:</span></span>

1. <span data-ttu-id="67bc4-142">Habilite tipos de referência anulados `<Nullable>enable</Nullable>` para todo o projeto adicionando o elemento aos seus arquivos *csproj.*</span><span class="sxs-lookup"><span data-stu-id="67bc4-142">Enable nullable reference types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="67bc4-143">Adicione `#nullable disable` o pragma a cada arquivo de origem do seu projeto.</span><span class="sxs-lookup"><span data-stu-id="67bc4-143">Add the `#nullable disable` pragma to every source file in your project.</span></span>
1. <span data-ttu-id="67bc4-144">Ao trabalhar em cada arquivo, remova o pragma e aborde quaisquer avisos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-144">As you work on each file, remove the pragma and address any warnings.</span></span>

<span data-ttu-id="67bc4-145">Esta primeira estratégia tem um trabalho mais inicial para adicionar o pragma a cada arquivo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-145">This first strategy has more up-front work to add the pragma to every file.</span></span> <span data-ttu-id="67bc4-146">A vantagem é que cada novo arquivo de código adicionado ao projeto será anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-146">The advantage is that every new code file added to the project will be nullable enabled.</span></span> <span data-ttu-id="67bc4-147">Qualquer novo trabalho será anulado; apenas o código existente deve ser atualizado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-147">Any new work will be nullable aware; only existing code must be updated.</span></span>

<span data-ttu-id="67bc4-148">A segunda estratégia funciona melhor se a biblioteca estiver geralmente estável, e o foco principal do desenvolvimento é adotar tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="67bc4-148">The second strategy works better if the library is generally stable, and the main focus of the development is to adopt nullable reference types.</span></span> <span data-ttu-id="67bc4-149">Você liga os tipos de referência anulados à medida que anota APIs.</span><span class="sxs-lookup"><span data-stu-id="67bc4-149">You turn on nullable reference types as you annotate APIs.</span></span> <span data-ttu-id="67bc4-150">Quando terminar, você habilita tipos de referência anulados para todo o projeto.</span><span class="sxs-lookup"><span data-stu-id="67bc4-150">When you've finished, you enable nullable reference types for the entire project.</span></span>

<span data-ttu-id="67bc4-151">Seguindo esta segunda estratégia você faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="67bc4-151">Following this second strategy you do the following:</span></span>

1. <span data-ttu-id="67bc4-152">Adicione `#nullable enable` o pragma ao arquivo que você deseja tornar anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-152">Add the `#nullable enable` pragma to the file you want to make nullable aware.</span></span>
1. <span data-ttu-id="67bc4-153">Dirija qualquer aviso.</span><span class="sxs-lookup"><span data-stu-id="67bc4-153">Address any warnings.</span></span>
1. <span data-ttu-id="67bc4-154">Continue estes dois primeiros passos até que você tenha feito toda a biblioteca anulada.</span><span class="sxs-lookup"><span data-stu-id="67bc4-154">Continue these first two steps until you've made the entire library nullable aware.</span></span>
1. <span data-ttu-id="67bc4-155">Habilite tipos anulados para `<Nullable>enable</Nullable>` todo o projeto adicionando o elemento aos seus arquivos *csproj.*</span><span class="sxs-lookup"><span data-stu-id="67bc4-155">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="67bc4-156">Remova `#nullable enable` os pragmas, já que eles não são mais necessários.</span><span class="sxs-lookup"><span data-stu-id="67bc4-156">Remove the `#nullable enable` pragmas, as they're no longer needed.</span></span>

<span data-ttu-id="67bc4-157">Esta segunda estratégia tem menos trabalho na frente.</span><span class="sxs-lookup"><span data-stu-id="67bc4-157">This second strategy has less work up-front.</span></span> <span data-ttu-id="67bc4-158">A troca é que a primeira tarefa quando você cria um novo arquivo é adicionar o pragma e torná-lo anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-158">The tradeoff is that the first task when you create a new file is to add the pragma and make it nullable aware.</span></span> <span data-ttu-id="67bc4-159">Se algum desenvolvedor da sua equipe esquecer, esse novo código está agora em atraso no trabalho para tornar todo o código anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-159">If any developers on your team forget, that new code is now in the backlog of work to make all code nullable aware.</span></span>

<span data-ttu-id="67bc4-160">Qual dessas estratégias você escolhe depende de quanto desenvolvimento ativo está acontecendo em seu projeto.</span><span class="sxs-lookup"><span data-stu-id="67bc4-160">Which of these strategies you pick depends on how much active development is taking place in your project.</span></span> <span data-ttu-id="67bc4-161">Quanto mais maduro e estável o seu projeto, melhor a segunda estratégia.</span><span class="sxs-lookup"><span data-stu-id="67bc4-161">The more mature and stable your project, the better the second strategy.</span></span> <span data-ttu-id="67bc4-162">Quanto mais recursos estão sendo desenvolvidos, melhor a primeira estratégia.</span><span class="sxs-lookup"><span data-stu-id="67bc4-162">The more features being developed, the better the first strategy.</span></span>

## <a name="should-nullable-warnings-introduce-breaking-changes"></a><span data-ttu-id="67bc4-163">Os avisos anulados devem introduzir alterações de quebra?</span><span class="sxs-lookup"><span data-stu-id="67bc4-163">Should nullable warnings introduce breaking changes?</span></span>

<span data-ttu-id="67bc4-164">Antes de habilitar tipos de referência anulados, as variáveis são consideradas *alheias a nulidade*.</span><span class="sxs-lookup"><span data-stu-id="67bc4-164">Before you enable nullable reference types, variables are considered *nullable oblivious*.</span></span> <span data-ttu-id="67bc4-165">Uma vez habilitado tipos de referência anulados, todas essas variáveis são *não anuladas*.</span><span class="sxs-lookup"><span data-stu-id="67bc4-165">Once you enable nullable reference types, all those variables are *non-nullable*.</span></span> <span data-ttu-id="67bc4-166">O compilador emitirá avisos se essas variáveis não forem inicializadas para valores não nulos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-166">The compiler will issue warnings if those variables aren't initialized to non-null values.</span></span>

<span data-ttu-id="67bc4-167">Outra fonte provável de avisos são os valores de devolução quando o valor não foi inicializado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-167">Another likely source of warnings is return values when the value hasn't been initialized.</span></span>

<span data-ttu-id="67bc4-168">O primeiro passo para abordar os avisos `?` do compilador é usar anotações em parâmetros e tipos de retorno para indicar quando argumentos ou valores de devolução podem ser nulos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-168">The first step in addressing the compiler warnings is to use `?` annotations on parameter and return types to indicate when arguments or return values may be null.</span></span> <span data-ttu-id="67bc4-169">Quando as variáveis de referência não devem ser nulas, a declaração original está correta.</span><span class="sxs-lookup"><span data-stu-id="67bc4-169">When reference variables must not be null, the original declaration is correct.</span></span> <span data-ttu-id="67bc4-170">Ao fazer isso, seu objetivo não é apenas corrigir avisos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-170">As you do this, your goal isn't just to fix warnings.</span></span> <span data-ttu-id="67bc4-171">O objetivo mais importante é fazer com que o compilador entenda sua intenção de potenciais valores nulos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-171">The more important goal is to make the compiler understand your intent for potential null values.</span></span> <span data-ttu-id="67bc4-172">Ao examinar os avisos, você chega à sua próxima grande decisão para sua biblioteca.</span><span class="sxs-lookup"><span data-stu-id="67bc4-172">As you examine the warnings, you reach your next major decision for your library.</span></span> <span data-ttu-id="67bc4-173">Deseja considerar modificar assinaturas de API para comunicar mais claramente sua intenção de design?</span><span class="sxs-lookup"><span data-stu-id="67bc4-173">Do you want to consider modifying API signatures to more clearly communicate your design intent?</span></span> <span data-ttu-id="67bc4-174">Uma melhor assinatura de `TryGetMessage` API para o método examinado anteriormente poderia ser:</span><span class="sxs-lookup"><span data-stu-id="67bc4-174">A better API signature for the `TryGetMessage` method examined earlier could be:</span></span>

```csharp
string? TryGetMessage(string key);
```

<span data-ttu-id="67bc4-175">O valor de retorno indica sucesso ou falha, e carrega o valor se o valor foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-175">The return value indicates success or failure, and carries the value if the value was found.</span></span> <span data-ttu-id="67bc4-176">Em muitos casos, alterar assinaturas de API pode melhorar a forma como comunicam valores nulos.</span><span class="sxs-lookup"><span data-stu-id="67bc4-176">In many cases, changing API signatures can improve how they communicate null values.</span></span>

<span data-ttu-id="67bc4-177">No entanto, para bibliotecas públicas ou bibliotecas com grandes bases de usuários, você pode preferir não introduzir nenhuma alteração de assinatura da API.</span><span class="sxs-lookup"><span data-stu-id="67bc4-177">However, for public libraries, or libraries with large user bases, you may prefer not introducing any API signature changes.</span></span> <span data-ttu-id="67bc4-178">Para esses casos e outros padrões comuns, você pode aplicar atributos `null`para definir mais claramente quando um argumento ou valor de retorno pode ser .</span><span class="sxs-lookup"><span data-stu-id="67bc4-178">For those cases, and other common patterns, you can apply attributes to more clearly define when an argument or return value may be `null`.</span></span> <span data-ttu-id="67bc4-179">Se você considerar ou não alterar a superfície de sua API, você provavelmente descobrirá `null` que anotações de tipo por si só não são suficientes para descrever valores para argumentos ou valores de retorno.</span><span class="sxs-lookup"><span data-stu-id="67bc4-179">Whether or not you consider changing the surface of your API, you'll likely find that type annotations alone aren't sufficient for describing `null` values for arguments or return values.</span></span> <span data-ttu-id="67bc4-180">Nesses casos, você pode aplicar atributos para descrever mais claramente uma API.</span><span class="sxs-lookup"><span data-stu-id="67bc4-180">In those instances, you can apply attributes to more clearly describe an API.</span></span>

## <a name="attributes-extend-type-annotations"></a><span data-ttu-id="67bc4-181">Atributos estendem anotações de tipo</span><span class="sxs-lookup"><span data-stu-id="67bc4-181">Attributes extend type annotations</span></span>

<span data-ttu-id="67bc4-182">Vários atributos foram adicionados para expressar informações adicionais sobre o estado nulo das variáveis.</span><span class="sxs-lookup"><span data-stu-id="67bc4-182">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="67bc4-183">Todo o código que você escreveu antes de C# 8 introduzir tipos de referência nulos foi *nulo alheio*.</span><span class="sxs-lookup"><span data-stu-id="67bc4-183">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="67bc4-184">Isso significa que qualquer variável de tipo de referência pode ser nula, mas verificações nulas não são necessárias.</span><span class="sxs-lookup"><span data-stu-id="67bc4-184">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="67bc4-185">Uma vez que seu código é *anulado ciente,* essas regras mudam.</span><span class="sxs-lookup"><span data-stu-id="67bc4-185">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="67bc4-186">Os tipos de `null` referência nunca devem ser o valor, e os tipos de referência anulados devem ser verificados `null` antes de serem desreferenciados.</span><span class="sxs-lookup"><span data-stu-id="67bc4-186">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="67bc4-187">As regras para suas APIs são provavelmente `TryGetValue` mais complicadas, como você viu com o cenário da API.</span><span class="sxs-lookup"><span data-stu-id="67bc4-187">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="67bc4-188">Muitas de suas APIs têm regras mais complexas para `null`quando as variáveis podem ou não ser .</span><span class="sxs-lookup"><span data-stu-id="67bc4-188">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="67bc4-189">Nestes casos, você usará atributos para expressar essas regras.</span><span class="sxs-lookup"><span data-stu-id="67bc4-189">In these cases, you'll use attributes to express those rules.</span></span> <span data-ttu-id="67bc4-190">Os atributos que descrevem a semântica de sua API são encontrados no artigo sobre [Atributos que impactam a análise anulada](./language-reference/attributes/nullable-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="67bc4-190">The attributes that describe the semantics of your API are found in the article on [Attributes that impact nullable analysis](./language-reference/attributes/nullable-analysis.md).</span></span>

## <a name="generic-definitions-and-nullability"></a><span data-ttu-id="67bc4-191">Definições genéricas e nulidade</span><span class="sxs-lookup"><span data-stu-id="67bc4-191">Generic definitions and nullability</span></span>

<span data-ttu-id="67bc4-192">Comunicar corretamente o estado nulo de tipos genéricos e métodos genéricos requer cuidados especiais.</span><span class="sxs-lookup"><span data-stu-id="67bc4-192">Correctly communicating the null state of generic types and generic methods requires special care.</span></span> <span data-ttu-id="67bc4-193">Isso decorre do fato de que um tipo de valor anulado e um tipo de referência anulado são fundamentalmente diferentes.</span><span class="sxs-lookup"><span data-stu-id="67bc4-193">This stems from the fact that a nullable value type and a nullable reference type are fundamentally different.</span></span> <span data-ttu-id="67bc4-194">Um `int?` é um `Nullable<int>`sinônimo `string?` de `string` , enquanto é com um atributo adicionado pelo compilador.</span><span class="sxs-lookup"><span data-stu-id="67bc4-194">An `int?` is a synonym for `Nullable<int>`, whereas `string?` is `string` with an attribute added by the compiler.</span></span> <span data-ttu-id="67bc4-195">O resultado é que o compilador não `T?` pode gerar `T` código `class` correto `struct`para sem saber se é um ou um .</span><span class="sxs-lookup"><span data-stu-id="67bc4-195">The result is that the compiler can't generate correct code for `T?` without knowing if `T` is a `class` or a `struct`.</span></span>

<span data-ttu-id="67bc4-196">Isso não significa que você não pode usar um tipo de valor (tipo de valor ou tipo de referência) como o argumento de tipo para um tipo genérico fechado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-196">This doesn't mean you can't use a nullable type (either value type or reference type) as the type argument for a closed generic type.</span></span> <span data-ttu-id="67bc4-197">Ambos `List<string?>` `List<int?>` são instanciações `List<T>`válidas de .</span><span class="sxs-lookup"><span data-stu-id="67bc4-197">Both `List<string?>` and `List<int?>` are valid instantiations of `List<T>`.</span></span>

<span data-ttu-id="67bc4-198">O que isso significa é que `T?` você não pode usar em uma classe genérica ou declaração de método sem restrições.</span><span class="sxs-lookup"><span data-stu-id="67bc4-198">What it does mean is that you can't use `T?` in a generic class or method declaration without constraints.</span></span> <span data-ttu-id="67bc4-199">Por exemplo, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> não será alterado `T?`para retornar .</span><span class="sxs-lookup"><span data-stu-id="67bc4-199">For example, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> won't be changed to return `T?`.</span></span> <span data-ttu-id="67bc4-200">Você pode superar essa limitação adicionando ou a `struct` `class` restrição.</span><span class="sxs-lookup"><span data-stu-id="67bc4-200">You can overcome this limitation by adding either the `struct` or `class` constraint.</span></span> <span data-ttu-id="67bc4-201">Com qualquer uma dessas restrições, o compilador sabe `T` `T?`como gerar código para ambos e .</span><span class="sxs-lookup"><span data-stu-id="67bc4-201">With either of those constraints, the compiler knows how to generate code for both `T` and `T?`.</span></span>

<span data-ttu-id="67bc4-202">Você pode querer restringir os tipos usados para um argumento de tipo genérico para serem tipos não anulados.</span><span class="sxs-lookup"><span data-stu-id="67bc4-202">You may want to restrict the types used for a generic type argument to be non-nullable types.</span></span> <span data-ttu-id="67bc4-203">Você pode fazer isso `notnull` adicionando a restrição nesse argumento de tipo.</span><span class="sxs-lookup"><span data-stu-id="67bc4-203">You can do that by adding the `notnull` constraint on that type argument.</span></span> <span data-ttu-id="67bc4-204">Quando essa restrição é aplicada, o argumento do tipo não deve ser um tipo anulado.</span><span class="sxs-lookup"><span data-stu-id="67bc4-204">When that constraint is applied, the type argument must not be a nullable type.</span></span>
