---
title: Noções básicas sobre expressões de consulta (LINQ em C#)
description: Apresenta os conceitos relacionados a expressões de consulta
ms.date: 11/30/2016
ms.assetid: 027db1f8-346f-44d2-a16e-043fcea3a4e0
ms.openlocfilehash: 68f338381e354f4944539d63ca3a3cc3500031c1
ms.sourcegitcommit: 6eac9a01ff5d70c6d18460324c016a3612c5e268
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2018
ms.locfileid: "45625488"
---
# <a name="query-expression-basics"></a><span data-ttu-id="93abb-103">Noções básicas sobre expressões de consulta</span><span class="sxs-lookup"><span data-stu-id="93abb-103">Query expression basics</span></span>

<span data-ttu-id="93abb-104">Este artigo apresenta os conceitos básicos relacionados a expressões de consulta em C#.</span><span class="sxs-lookup"><span data-stu-id="93abb-104">This article introduces the basic concepts related to query expressions in C#.</span></span>

## <a name="what-is-a-query-and-what-does-it-do"></a><span data-ttu-id="93abb-105">O que é uma consulta e o que ela faz?</span><span class="sxs-lookup"><span data-stu-id="93abb-105">What is a query and what does it do?</span></span>

<span data-ttu-id="93abb-106">Uma *consulta* é um conjunto de instruções que descreve quais dados recuperar de uma determinada fonte de dados (ou fontes) e que forma e organização os dados retornados devem ter.</span><span class="sxs-lookup"><span data-stu-id="93abb-106">A *query* is a set of instructions that describes what data to retrieve from a given data source (or sources) and what shape and organization the returned data should have.</span></span> <span data-ttu-id="93abb-107">Uma consulta é diferente dos resultados que ela produz.</span><span class="sxs-lookup"><span data-stu-id="93abb-107">A query is distinct from the results that it produces.</span></span>

<span data-ttu-id="93abb-108">Em geral, os dados de origem são organizados de forma lógica como uma sequência de elementos do mesmo tipo.</span><span class="sxs-lookup"><span data-stu-id="93abb-108">Generally, the source data is organized logically as a sequence of elements of the same kind.</span></span> <span data-ttu-id="93abb-109">Por exemplo, uma tabela de banco de dados SQL contém uma sequência de linhas.</span><span class="sxs-lookup"><span data-stu-id="93abb-109">For example, a SQL database table contains a sequence of rows.</span></span> <span data-ttu-id="93abb-110">Em um arquivo XML, há uma "sequência" de elementos XML (embora eles estejam organizados hierarquicamente em uma estrutura de árvore).</span><span class="sxs-lookup"><span data-stu-id="93abb-110">In an XML file, there is a "sequence" of XML elements (although these are organized hierarchically in a tree structure).</span></span> <span data-ttu-id="93abb-111">Uma coleção na memória contém uma sequência de objetos.</span><span class="sxs-lookup"><span data-stu-id="93abb-111">An in-memory collection contains a sequence of objects.</span></span>

<span data-ttu-id="93abb-112">Do ponto de vista do aplicativo, o tipo específico e a estrutura dos dados de origem original não são importantes.</span><span class="sxs-lookup"><span data-stu-id="93abb-112">From an application's viewpoint, the specific type and structure of the original source data is not important.</span></span> <span data-ttu-id="93abb-113">O aplicativo sempre vê os dados de origem como uma coleção de <xref:System.Collections.Generic.IEnumerable%601> ou de <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="93abb-113">The application always sees the source data as an <xref:System.Collections.Generic.IEnumerable%601> or <xref:System.Linq.IQueryable%601> collection.</span></span> <span data-ttu-id="93abb-114">Por exemplo, no LINQ to XML, os dados de origem ficam visíveis como um `IEnumerable`\<<xref:System.Xml.Linq.XElement>>.</span><span class="sxs-lookup"><span data-stu-id="93abb-114">For example, in LINQ to XML, the source data is made visible as an `IEnumerable`\<<xref:System.Xml.Linq.XElement>>.</span></span>

<span data-ttu-id="93abb-115">Dada essa sequência de origem, uma consulta pode executar uma das três ações:</span><span class="sxs-lookup"><span data-stu-id="93abb-115">Given this source sequence, a query may do one of three things:</span></span>

- <span data-ttu-id="93abb-116">Recuperar um subconjunto dos elementos para produzir uma nova sequência sem modificar os elementos individuais.</span><span class="sxs-lookup"><span data-stu-id="93abb-116">Retrieve a subset of the elements to produce a new sequence without modifying the individual elements.</span></span> <span data-ttu-id="93abb-117">A consulta pode, em seguida, classificar ou agrupar a sequência retornada de várias maneiras, conforme mostrado no exemplo a seguir (suponha que `scores` é um `int[]`):</span><span class="sxs-lookup"><span data-stu-id="93abb-117">The query may then sort or group the returned sequence in various ways, as shown in the following example (assume `scores` is an `int[]`):</span></span>

    [!code-csharp[csrefQueryExpBasics#45](~/samples/snippets/csharp/concepts/linq/query-expression-basics_1.cs)]

- <span data-ttu-id="93abb-118">Recuperar uma sequência de elementos, como no exemplo anterior, mas transformá-los em um novo tipo de objeto.</span><span class="sxs-lookup"><span data-stu-id="93abb-118">Retrieve a sequence of elements as in the previous example but transform them to a new type of object.</span></span> <span data-ttu-id="93abb-119">Por exemplo, uma consulta pode recuperar apenas os sobrenomes de determinados registros de cliente em uma fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="93abb-119">For example, a query may retrieve only the last names from certain customer records in a data source.</span></span> <span data-ttu-id="93abb-120">Ou pode recuperar o registro completo e, em seguida, usá-lo para construir outro tipo de objeto na memória ou até mesmo dados XML antes de gerar a sequência de resultados final.</span><span class="sxs-lookup"><span data-stu-id="93abb-120">Or it may retrieve the complete record and then use it to construct another in-memory object type or even XML data before generating the final result sequence.</span></span> <span data-ttu-id="93abb-121">O exemplo a seguir mostra uma projeção de um `int` para um `string`.</span><span class="sxs-lookup"><span data-stu-id="93abb-121">The following example shows a projection from an `int` to a `string`.</span></span> <span data-ttu-id="93abb-122">Observe o novo tipo de `highScoresQuery`.</span><span class="sxs-lookup"><span data-stu-id="93abb-122">Note the new type of `highScoresQuery`.</span></span>

    [!code-csharp[csrefQueryExpBasics#46](~/samples/snippets/csharp/concepts/linq/query-expression-basics_2.cs)]

- <span data-ttu-id="93abb-123">Recuperar um valor singleton sobre os dados de origem, como:</span><span class="sxs-lookup"><span data-stu-id="93abb-123">Retrieve a singleton value about the source data, such as:</span></span>

  - <span data-ttu-id="93abb-124">O número de elementos que correspondem a uma determinada condição.</span><span class="sxs-lookup"><span data-stu-id="93abb-124">The number of elements that match a certain condition.</span></span>

  - <span data-ttu-id="93abb-125">O elemento que tem o maior ou menor valor.</span><span class="sxs-lookup"><span data-stu-id="93abb-125">The element that has the greatest or least value.</span></span>

  - <span data-ttu-id="93abb-126">O primeiro elemento que corresponde a uma condição ou a soma dos valores específicos em um conjunto de elementos especificado.</span><span class="sxs-lookup"><span data-stu-id="93abb-126">The first element that matches a condition, or the sum of particular values in a specified set of elements.</span></span> <span data-ttu-id="93abb-127">Por exemplo, a consulta a seguir retorna o número pontuações maiores que 80 na matriz de inteiros `scores`:</span><span class="sxs-lookup"><span data-stu-id="93abb-127">For example, the following query returns the number of scores greater than 80 from the `scores` integer array:</span></span>

    [!code-csharp[csrefQueryExpBasics#47](~/samples/snippets/csharp/concepts/linq/query-expression-basics_3.cs)]

    <span data-ttu-id="93abb-128">No exemplo anterior, observe o uso de parênteses ao redor da expressão de consulta antes da chamada para o método `Count`.</span><span class="sxs-lookup"><span data-stu-id="93abb-128">In the previous example, note the use of parentheses around the query expression before the call to the `Count` method.</span></span> <span data-ttu-id="93abb-129">Também é possível expressar isso usando uma nova variável para armazenar o resultado concreto.</span><span class="sxs-lookup"><span data-stu-id="93abb-129">You can also express this by using a new variable to store the concrete result.</span></span> <span data-ttu-id="93abb-130">Essa técnica é mais legível porque mantém a variável que armazena a consulta separada da consulta que armazena um resultado.</span><span class="sxs-lookup"><span data-stu-id="93abb-130">This technique is more readable because it keeps the variable that stores the query separate from the query that stores a result.</span></span>

    [!code-csharp[csrefQueryExpBasics#48](~/samples/snippets/csharp/concepts/linq/query-expression-basics_4.cs)]

<span data-ttu-id="93abb-131">No exemplo anterior, a consulta é executada na chamada para `Count`, pois `Count` deve iterar os resultados para determinar o número de elementos retornados por `highScoresQuery`.</span><span class="sxs-lookup"><span data-stu-id="93abb-131">In the previous example, the query is executed in the call to `Count`, because `Count` must iterate over the results in order to determine the number of elements returned by `highScoresQuery`.</span></span>

## <a name="what-is-a-query-expression"></a><span data-ttu-id="93abb-132">O que é uma expressão de consulta?</span><span class="sxs-lookup"><span data-stu-id="93abb-132">What is a query expression?</span></span>

<span data-ttu-id="93abb-133">Uma *expressão de consulta* é uma consulta expressada na sintaxe da consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-133">A *query expression* is a query expressed in query syntax.</span></span> <span data-ttu-id="93abb-134">Uma expressão de consulta é um constructo de linguagem de primeira classe.</span><span class="sxs-lookup"><span data-stu-id="93abb-134">A query expression is a first-class language construct.</span></span> <span data-ttu-id="93abb-135">É exatamente como qualquer outra expressão e pode ser usada em qualquer contexto em que uma expressão C# é válida.</span><span class="sxs-lookup"><span data-stu-id="93abb-135">It is just like any other expression and can be used in any context in which a C# expression is valid.</span></span> <span data-ttu-id="93abb-136">Uma expressão de consulta consiste em um conjunto de cláusulas escritas em uma sintaxe declarativa semelhante ao SQL ou XQuery.</span><span class="sxs-lookup"><span data-stu-id="93abb-136">A query expression consists of a set of clauses written in a declarative syntax similar to SQL or XQuery.</span></span> <span data-ttu-id="93abb-137">Cada cláusula, por sua vez, contém uma ou mais expressões C# e essas expressões podem ser uma expressão de consulta ou conter uma expressão de consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-137">Each clause in turn contains one or more C# expressions, and these expressions may themselves be either a query expression or contain a query expression.</span></span>

<span data-ttu-id="93abb-138">Uma expressão de consulta deve começar com uma cláusula [from](../language-reference/keywords/from-clause.md) e deve terminar com uma cláusula [select](../language-reference/keywords/select-clause.md) ou [group](../language-reference/keywords/group-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-138">A query expression must begin with a [from](../language-reference/keywords/from-clause.md) clause and must end with a [select](../language-reference/keywords/select-clause.md) or [group](../language-reference/keywords/group-clause.md) clause.</span></span> <span data-ttu-id="93abb-139">Entre a primeira cláusula `from` e a última cláusula `select` ou `group`, ela pode conter uma ou mais dessas cláusulas opcionais: [where](../language-reference/keywords/where-clause.md), [orderby](../language-reference/keywords/orderby-clause.md), [join](../language-reference/keywords/join-clause.md), [let](../language-reference/keywords/let-clause.md) e até mesmo cláusulas [from](../language-reference/keywords/from-clause.md) adicionais.</span><span class="sxs-lookup"><span data-stu-id="93abb-139">Between the first `from` clause and the last `select` or `group` clause, it can contain one or more of these optional clauses: [where](../language-reference/keywords/where-clause.md), [orderby](../language-reference/keywords/orderby-clause.md), [join](../language-reference/keywords/join-clause.md), [let](../language-reference/keywords/let-clause.md) and even additional [from](../language-reference/keywords/from-clause.md) clauses.</span></span> <span data-ttu-id="93abb-140">Você também pode usar a palavra-chave [into](../language-reference/keywords/into.md) para permitir que o resultado de uma cláusula `join` ou `group` sirva como a fonte para cláusulas de consulta adicionais na mesma expressão de consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-140">You can also use the [into](../language-reference/keywords/into.md) keyword to enable the result of a `join` or `group` clause to serve as the source for additional query clauses in the same query expression.</span></span>

### <a name="query-variable"></a><span data-ttu-id="93abb-141">Variável da consulta</span><span class="sxs-lookup"><span data-stu-id="93abb-141">Query variable</span></span>

<span data-ttu-id="93abb-142">Em LINQ, uma variável de consulta é qualquer variável que armazena uma *consulta* em vez dos *resultados* de uma consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-142">In LINQ, a query variable is any variable that stores a *query* instead of the *results* of a query.</span></span> <span data-ttu-id="93abb-143">Mais especificamente, uma variável de consulta é sempre um tipo enumerável que produzirá uma sequência de elementos quando for iterada em uma instrução `foreach` ou uma chamada direta para seu método `IEnumerator.MoveNext`.</span><span class="sxs-lookup"><span data-stu-id="93abb-143">More specifically, a query variable is always an enumerable type that will produce a sequence of elements when it is iterated over in a `foreach` statement or a direct call to its `IEnumerator.MoveNext` method.</span></span>

<span data-ttu-id="93abb-144">O exemplo de código a seguir mostra uma expressão de consulta simples com uma fonte de dados, uma cláusula de filtragem, uma cláusula de ordenação e nenhuma transformação dos elementos de origem.</span><span class="sxs-lookup"><span data-stu-id="93abb-144">The following code example shows a simple query expression with one data source, one filtering clause, one ordering clause, and no transformation of the source elements.</span></span> <span data-ttu-id="93abb-145">A cláusula `select` termina a consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-145">The `select` clause ends the query.</span></span>

[!code-csharp[csrefQueryExpBasics#49](~/samples/snippets/csharp/concepts/linq/query-expression-basics_5.cs)]

<span data-ttu-id="93abb-146">No exemplo anterior, `scoreQuery` é uma *variável de consulta*, o que às vezes é chamado apenas de uma *consulta*.</span><span class="sxs-lookup"><span data-stu-id="93abb-146">In the previous example, `scoreQuery` is a *query variable,* which is sometimes referred to as just a *query*.</span></span> <span data-ttu-id="93abb-147">A variável de consulta não armazena nenhum dado de resultado real, que é produzido no loop `foreach`.</span><span class="sxs-lookup"><span data-stu-id="93abb-147">The query variable stores no actual result data, which is produced in the `foreach` loop.</span></span> <span data-ttu-id="93abb-148">E quando instrução `foreach` é executada, os resultados da consulta não são retornados pela variável de consulta `scoreQuery`.</span><span class="sxs-lookup"><span data-stu-id="93abb-148">And when the `foreach` statement executes, the query results are not returned through the query variable `scoreQuery`.</span></span> <span data-ttu-id="93abb-149">Em vez disso, eles são retornados pela variável de iteração `testScore`.</span><span class="sxs-lookup"><span data-stu-id="93abb-149">Rather, they are returned through the iteration variable `testScore`.</span></span> <span data-ttu-id="93abb-150">A variável `scoreQuery` pode ser iterada em um segundo loop `foreach`.</span><span class="sxs-lookup"><span data-stu-id="93abb-150">The `scoreQuery` variable can be iterated in a second `foreach` loop.</span></span> <span data-ttu-id="93abb-151">Ele produzirá os mesmos resultados contanto que nem ele nem a fonte de dados tenham sido modificados.</span><span class="sxs-lookup"><span data-stu-id="93abb-151">It will produce the same results as long as neither it nor the data source has been modified.</span></span>

<span data-ttu-id="93abb-152">Uma variável de consulta pode armazenar uma consulta que é expressada na sintaxe de consulta ou na sintaxe de método ou uma combinação das duas.</span><span class="sxs-lookup"><span data-stu-id="93abb-152">A query variable may store a query that is expressed in query syntax or method syntax, or a combination of the two.</span></span> <span data-ttu-id="93abb-153">Nos exemplos a seguir, `queryMajorCities` e `queryMajorCities2` são variáveis de consulta:</span><span class="sxs-lookup"><span data-stu-id="93abb-153">In the following examples, both `queryMajorCities` and `queryMajorCities2` are query variables:</span></span>

[!code-csharp[csrefQueryExpBasics#50](~/samples/snippets/csharp/concepts/linq/query-expression-basics_6.cs)]

<span data-ttu-id="93abb-154">Por outro lado, os dois exemplos a seguir mostram variáveis que não são variáveis de consulta, embora sejam inicializadas com uma consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-154">On the other hand, the following two examples show variables that are not query variables even though each is initialized with a query.</span></span> <span data-ttu-id="93abb-155">Elas não são variáveis de consulta porque armazenam resultados:</span><span class="sxs-lookup"><span data-stu-id="93abb-155">They are not query variables because they store results:</span></span>

[!code-csharp[csrefQueryExpBasics#51](~/samples/snippets/csharp/concepts/linq/query-expression-basics_7.cs)]

<span data-ttu-id="93abb-156">Para obter mais informações sobre as diferentes maneiras de expressar consultas, consulte [Sintaxe de consulta e sintaxe de método em LINQ](../programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-156">For more information about the different ways to express queries, see [Query syntax and method syntax in LINQ](../programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq.md).</span></span>

#### <a name="explicit-and-implicit-typing-of-query-variables"></a><span data-ttu-id="93abb-157">Tipagem explícita e implícita de variáveis de consulta</span><span class="sxs-lookup"><span data-stu-id="93abb-157">Explicit and implicit typing of query variables</span></span>

<span data-ttu-id="93abb-158">Esta documentação normalmente fornece o tipo explícito da variável de consulta para mostrar a relação de tipo entre a variável de consulta e a [cláusula select](../language-reference/keywords/select-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-158">This documentation usually provides the explicit type of the query variable in order to show the type relationship between the query variable and the [select clause](../language-reference/keywords/select-clause.md).</span></span> <span data-ttu-id="93abb-159">No entanto, você também pode usar a palavra-chave [var](../language-reference/keywords/var.md) para instruir o compilador a inferir o tipo de uma variável de consulta (ou qualquer outra variável local) em tempo de compilação.</span><span class="sxs-lookup"><span data-stu-id="93abb-159">However, you can also use the [var](../language-reference/keywords/var.md) keyword to instruct the compiler to infer the type of a query variable (or any other local variable) at compile time.</span></span> <span data-ttu-id="93abb-160">Por exemplo, o exemplo de consulta que foi mostrado anteriormente neste tópico também pode ser expressado usando a tipagem implícita:</span><span class="sxs-lookup"><span data-stu-id="93abb-160">For example, the query example that was shown previously in this topic can also be expressed by using implicit typing:</span></span>

[!code-csharp[csrefQueryExpBasics#52](~/samples/snippets/csharp/concepts/linq/query-expression-basics_8.cs)]

<span data-ttu-id="93abb-161">Para obter mais informações, consulte [Variáveis locais de tipo implícito](../programming-guide/classes-and-structs/implicitly-typed-local-variables.md) e [Relacionamentos de tipo em operações de consulta LINQ](../programming-guide/concepts/linq/type-relationships-in-linq-query-operations.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-161">For more information, see [Implicitly typed local variables](../programming-guide/classes-and-structs/implicitly-typed-local-variables.md) and [Type relationships in LINQ query operations](../programming-guide/concepts/linq/type-relationships-in-linq-query-operations.md).</span></span>

### <a name="starting-a-query-expression"></a><span data-ttu-id="93abb-162">Iniciando uma expressão de consulta</span><span class="sxs-lookup"><span data-stu-id="93abb-162">Starting a query expression</span></span>

<span data-ttu-id="93abb-163">Uma expressão de consulta deve começar com uma cláusula `from`.</span><span class="sxs-lookup"><span data-stu-id="93abb-163">A query expression must begin with a `from` clause.</span></span> <span data-ttu-id="93abb-164">Especifica uma fonte de dados junto com uma variável de intervalo.</span><span class="sxs-lookup"><span data-stu-id="93abb-164">It specifies a data source together with a range variable.</span></span> <span data-ttu-id="93abb-165">A variável de intervalo representa cada elemento sucessivo na sequência de origem como a sequência de origem que está sendo percorrida.</span><span class="sxs-lookup"><span data-stu-id="93abb-165">The range variable represents each successive element in the source sequence as the source sequence is being traversed.</span></span> <span data-ttu-id="93abb-166">A variável de intervalo é fortemente tipada com base no tipo dos elementos na fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="93abb-166">The range variable is strongly typed based on the type of elements in the data source.</span></span> <span data-ttu-id="93abb-167">No exemplo a seguir, como `countries` é uma matriz de objetos `Country`, a variável de intervalo também é tipada como `Country`.</span><span class="sxs-lookup"><span data-stu-id="93abb-167">In the following example, because `countries` is an array of `Country` objects, the range variable is also typed as `Country`.</span></span> <span data-ttu-id="93abb-168">Como a variável de intervalo é fortemente tipada, você pode usar o operador ponto para acessar todos os membros disponíveis do tipo.</span><span class="sxs-lookup"><span data-stu-id="93abb-168">Because the range variable is strongly typed, you can use the dot operator to access any available members of the type.</span></span>

[!code-csharp[csrefQueryExpBasics#53](~/samples/snippets/csharp/concepts/linq/query-expression-basics_9.cs)]

<span data-ttu-id="93abb-169">A variável de intervalo está no escopo até a consulta ser encerrada com ponto e vírgula ou com uma cláusula *continuation*.</span><span class="sxs-lookup"><span data-stu-id="93abb-169">The range variable is in scope until the query is exited either with a semicolon or with a *continuation* clause.</span></span>

<span data-ttu-id="93abb-170">Uma expressão de consulta pode conter várias cláusulas `from`.</span><span class="sxs-lookup"><span data-stu-id="93abb-170">A query expression may contain multiple `from` clauses.</span></span> <span data-ttu-id="93abb-171">Use cláusulas `from` adicionais quando cada elemento na sequência de origem for uma coleção em si ou contiver uma coleção.</span><span class="sxs-lookup"><span data-stu-id="93abb-171">Use additional `from` clauses when each element in the source sequence is itself a collection or contains a collection.</span></span> <span data-ttu-id="93abb-172">Por exemplo, suponha que você tem uma coleção de objetos `Country` e cada um dos quais contém uma coleção de objetos `City` chamada `Cities`.</span><span class="sxs-lookup"><span data-stu-id="93abb-172">For example, assume that you have a collection of `Country` objects, each of which contains a collection of `City` objects named `Cities`.</span></span> <span data-ttu-id="93abb-173">Para consular os objetos `City` em cada `Country`, use duas cláusulas `from` como mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="93abb-173">To query the `City` objects in each `Country`, use two `from` clauses as shown here:</span></span>

[!code-csharp[csrefQueryExpBasics#54](~/samples/snippets/csharp/concepts/linq/query-expression-basics_10.cs)]

<span data-ttu-id="93abb-174">Para obter mais informações, consulte [Cláusula from](../language-reference/keywords/from-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-174">For more information, see [from clause](../language-reference/keywords/from-clause.md).</span></span>

### <a name="ending-a-query-expression"></a><span data-ttu-id="93abb-175">Encerrando uma expressão de consulta</span><span class="sxs-lookup"><span data-stu-id="93abb-175">Ending a query expression</span></span>

<span data-ttu-id="93abb-176">Uma expressão de consulta deve ser encerrada com uma cláusula `group` ou uma cláusula `select`.</span><span class="sxs-lookup"><span data-stu-id="93abb-176">A query expression must end with either a `group` clause or a `select` clause.</span></span>

#### <a name="group-clause"></a><span data-ttu-id="93abb-177">Cláusula group</span><span class="sxs-lookup"><span data-stu-id="93abb-177">group clause</span></span>

<span data-ttu-id="93abb-178">Use a cláusula `group` para produzir uma sequência de grupos organizada por uma chave que você especificar.</span><span class="sxs-lookup"><span data-stu-id="93abb-178">Use the `group` clause to produce a sequence of groups organized by a key that you specify.</span></span> <span data-ttu-id="93abb-179">A chave pode ter qualquer tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="93abb-179">The key can be any data type.</span></span> <span data-ttu-id="93abb-180">Por exemplo, a consulta a seguir cria uma sequência de grupos que contém um ou mais objetos `Country` e cuja chave é um valor `char`.</span><span class="sxs-lookup"><span data-stu-id="93abb-180">For example, the following query creates a sequence of groups that contains one or more `Country` objects and whose key is a `char` value.</span></span>

[!code-csharp[csrefQueryExpBasics#55](~/samples/snippets/csharp/concepts/linq/query-expression-basics_11.cs)]

<span data-ttu-id="93abb-181">Para obter mais informações sobre o agrupamento, consulte [Cláusula group](../language-reference/keywords/group-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-181">For more information about grouping, see [group clause](../language-reference/keywords/group-clause.md).</span></span>

#### <a name="select-clause"></a><span data-ttu-id="93abb-182">Cláusula select</span><span class="sxs-lookup"><span data-stu-id="93abb-182">select clause</span></span>

<span data-ttu-id="93abb-183">Use a cláusula `select` para produzir todos os outros tipos de sequências.</span><span class="sxs-lookup"><span data-stu-id="93abb-183">Use the `select` clause to produce all other types of sequences.</span></span> <span data-ttu-id="93abb-184">Uma cláusula `select` simples produz apenas uma sequência do mesmo tipo dos objetos contidos na fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="93abb-184">A simple `select` clause just produces a sequence of the same type of objects as the objects that are contained in the data source.</span></span> <span data-ttu-id="93abb-185">Neste exemplo, a fonte de dados contém objetos `Country`.</span><span class="sxs-lookup"><span data-stu-id="93abb-185">In this example, the data source contains `Country` objects.</span></span> <span data-ttu-id="93abb-186">A cláusula `orderby` simplesmente classifica os elementos em uma nova ordem e a cláusula `select` produz uma sequência dos objetos `Country` reordenados.</span><span class="sxs-lookup"><span data-stu-id="93abb-186">The `orderby` clause just sorts the elements into a new order and the `select` clause produces a sequence of the reordered `Country` objects.</span></span>

[!code-csharp[csrefQueryExpBasics#56](~/samples/snippets/csharp/concepts/linq/query-expression-basics_12.cs)]

<span data-ttu-id="93abb-187">A cláusula `select` pode ser usada para transformar dados de origem em sequências de novos tipos.</span><span class="sxs-lookup"><span data-stu-id="93abb-187">The `select` clause can be used to transform source data into sequences of new types.</span></span> <span data-ttu-id="93abb-188">Essa transformação também é chamada de *projeção*.</span><span class="sxs-lookup"><span data-stu-id="93abb-188">This transformation is also named a *projection*.</span></span> <span data-ttu-id="93abb-189">No exemplo a seguir, a cláusula `select` *projeta* uma sequência de tipos anônimos que contém apenas um subconjunto dos campos no elemento original.</span><span class="sxs-lookup"><span data-stu-id="93abb-189">In the following example, the `select` clause *projects* a sequence of anonymous types which contains only a subset of the fields in the original element.</span></span> <span data-ttu-id="93abb-190">Observe que os novos objetos são inicializados usando um inicializador de objeto.</span><span class="sxs-lookup"><span data-stu-id="93abb-190">Note that the new objects are initialized by using an object initializer.</span></span>

[!code-csharp[csrefQueryExpBasics#57](~/samples/snippets/csharp/concepts/linq/query-expression-basics_13.cs)]

<span data-ttu-id="93abb-191">Para obter mais informações sobre todas as maneiras que uma cláusula `select` pode ser usada para transformar os dados de origem, consulte [Cláusula select](../language-reference/keywords/select-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-191">For more information about all the ways that a `select` clause can be used to transform source data, see [select clause](../language-reference/keywords/select-clause.md).</span></span>

#### <a name="continuations-with-into"></a><span data-ttu-id="93abb-192">Continuações com "into"</span><span class="sxs-lookup"><span data-stu-id="93abb-192">Continuations with "into"</span></span>

<span data-ttu-id="93abb-193">Você pode usar a palavra-chave `into` em uma cláusula `select` ou `group` para criar um identificador temporário que armazena uma consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-193">You can use the `into` keyword in a `select` or `group` clause to create a temporary identifier that stores a query.</span></span> <span data-ttu-id="93abb-194">Faça isso quando precisar executar operações de consulta adicionais em uma consulta após a operação de agrupamento ou seleção.</span><span class="sxs-lookup"><span data-stu-id="93abb-194">Do this when you must perform additional query operations on a query after a grouping or select operation.</span></span> <span data-ttu-id="93abb-195">No exemplo a seguir `countries` são agrupados de acordo com a população em intervalos de 10 milhões.</span><span class="sxs-lookup"><span data-stu-id="93abb-195">In the following example `countries` are grouped according to population in ranges of 10 million.</span></span> <span data-ttu-id="93abb-196">Depois que esses grupos são criados, cláusulas adicionais filtram alguns grupos e, em seguida, classificam os grupos em ordem crescente.</span><span class="sxs-lookup"><span data-stu-id="93abb-196">After these groups are created, additional clauses filter out some groups, and then to sort the groups in ascending order.</span></span> <span data-ttu-id="93abb-197">Para executar essas operações adicionais, a continuação representada por `countryGroup` é necessária.</span><span class="sxs-lookup"><span data-stu-id="93abb-197">To perform those additional operations, the continuation represented by `countryGroup` is required.</span></span>

[!code-csharp[csrefQueryExpBasics#58](~/samples/snippets/csharp/concepts/linq/query-expression-basics_14.cs)]

<span data-ttu-id="93abb-198">Para obter mais informações, consulte [into](../language-reference/keywords/into.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-198">For more information, see [into](../language-reference/keywords/into.md).</span></span>

### <a name="filtering-ordering-and-joining"></a><span data-ttu-id="93abb-199">Filtragem, ordenação e junção</span><span class="sxs-lookup"><span data-stu-id="93abb-199">Filtering, ordering, and joining</span></span>

<span data-ttu-id="93abb-200">Entre a cláusula `from` inicial e a cláusula `select` ou `group` final, todas as outras cláusulas (`where`, `join`, `orderby`, `from`, `let`) são opcionais.</span><span class="sxs-lookup"><span data-stu-id="93abb-200">Between the starting `from` clause, and the ending `select` or `group` clause, all other clauses (`where`, `join`, `orderby`, `from`, `let`) are optional.</span></span> <span data-ttu-id="93abb-201">Todas as cláusulas opcionais podem ser usadas várias vezes ou nenhuma vez no corpo de uma consulta.</span><span class="sxs-lookup"><span data-stu-id="93abb-201">Any of the optional clauses may be used zero times or multiple times in a query body.</span></span>

#### <a name="where-clause"></a><span data-ttu-id="93abb-202">Cláusula where</span><span class="sxs-lookup"><span data-stu-id="93abb-202">where clause</span></span>

<span data-ttu-id="93abb-203">Use a cláusula `where` para filtrar os elementos dos dados de origem com base em uma ou mais expressões de predicado.</span><span class="sxs-lookup"><span data-stu-id="93abb-203">Use the `where` clause to filter out elements from the source data based on one or more predicate expressions.</span></span> <span data-ttu-id="93abb-204">A cláusula `where` no exemplo a seguir tem um predicado com duas condições.</span><span class="sxs-lookup"><span data-stu-id="93abb-204">The `where` clause in the following example has one predicate with two conditions.</span></span>

[!code-csharp[csrefQueryExpBasics#59](~/samples/snippets/csharp/concepts/linq/query-expression-basics_15.cs)]

<span data-ttu-id="93abb-205">Para obter mais informações, consulte [Cláusula where](../language-reference/keywords/where-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-205">For more information, see [where clause](../language-reference/keywords/where-clause.md).</span></span>

#### <a name="orderby-clause"></a><span data-ttu-id="93abb-206">Cláusula orderby</span><span class="sxs-lookup"><span data-stu-id="93abb-206">orderby clause</span></span>

<span data-ttu-id="93abb-207">Use a cláusula `orderby` para classificar os resultados em ordem crescente ou decrescente.</span><span class="sxs-lookup"><span data-stu-id="93abb-207">Use the `orderby` clause to sort the results in either ascending or descending order.</span></span> <span data-ttu-id="93abb-208">Você também pode especificar as ordens de classificação secundárias.</span><span class="sxs-lookup"><span data-stu-id="93abb-208">You can also specify secondary sort orders.</span></span> <span data-ttu-id="93abb-209">O exemplo a seguir executa uma classificação primária nos objetos `country` usando a propriedade `Area`.</span><span class="sxs-lookup"><span data-stu-id="93abb-209">The following example performs a primary sort on the `country` objects by using the `Area` property.</span></span> <span data-ttu-id="93abb-210">Em seguida, ele executa a classificação secundária usando a propriedade `Population`.</span><span class="sxs-lookup"><span data-stu-id="93abb-210">It then performs a secondary sort by using the `Population` property.</span></span>

[!code-csharp[csrefQueryExpBasics#60](~/samples/snippets/csharp/concepts/linq/query-expression-basics_16.cs)]

<span data-ttu-id="93abb-211">A palavra-chave `ascending` é opcional. Será a ordem de classificação padrão se nenhuma ordem for especificada.</span><span class="sxs-lookup"><span data-stu-id="93abb-211">The `ascending` keyword is optional; it is the default sort order if no order is specified.</span></span> <span data-ttu-id="93abb-212">Para obter mais informações, consulte [Cláusula orderby](../language-reference/keywords/orderby-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-212">For more information, see [orderby clause](../language-reference/keywords/orderby-clause.md).</span></span>

#### <a name="join-clause"></a><span data-ttu-id="93abb-213">Cláusula join</span><span class="sxs-lookup"><span data-stu-id="93abb-213">join clause</span></span>

<span data-ttu-id="93abb-214">Use a cláusula `join` para associar e/ou combinar elementos de uma fonte de dados com elementos de outra fonte de dados com base em uma comparação de igualdade entre as chaves especificadas em cada elemento.</span><span class="sxs-lookup"><span data-stu-id="93abb-214">Use the `join` clause to associate and/or combine elements from one data source with elements from another data source based on an equality comparison between specified keys in each element.</span></span> <span data-ttu-id="93abb-215">Na LINQ, as operações join são executadas em sequências de objetos cujos elementos são de tipos diferentes.</span><span class="sxs-lookup"><span data-stu-id="93abb-215">In LINQ, join operations are performed on sequences of objects whose elements are different types.</span></span> <span data-ttu-id="93abb-216">Após ter unido duas sequências, você deve usar uma instrução `select` ou `group` para especificar qual elemento armazenar na sequência de saída.</span><span class="sxs-lookup"><span data-stu-id="93abb-216">After you have joined two sequences, you must use a `select` or `group` statement to specify which element to store in the output sequence.</span></span> <span data-ttu-id="93abb-217">Você também pode usar um tipo anônimo para combinar propriedades de cada conjunto de elementos associados em um novo tipo para a sequência de saída.</span><span class="sxs-lookup"><span data-stu-id="93abb-217">You can also use an anonymous type to combine properties from each set of associated elements into a new type for the output sequence.</span></span> <span data-ttu-id="93abb-218">O exemplo a seguir associa objetos `prod` cuja propriedade `Category` corresponde a uma das categorias na matriz de cadeias de caracteres `categories`.</span><span class="sxs-lookup"><span data-stu-id="93abb-218">The following example associates `prod` objects whose `Category` property matches one of the categories in the `categories` string array.</span></span> <span data-ttu-id="93abb-219">Produtos cuja `Category` não corresponde a nenhuma cadeia de caracteres em `categories` são filtrados. A instrução `select` projeta um novo tipo cujas propriedades são tiradas de `cat` e `prod`.</span><span class="sxs-lookup"><span data-stu-id="93abb-219">Products whose `Category` does not match any string in `categories` are filtered out. The `select` statement projects a new type whose properties are taken from both `cat` and `prod`.</span></span>

[!code-csharp[csrefQueryExpBasics#61](~/samples/snippets/csharp/concepts/linq/query-expression-basics_17.cs)]

<span data-ttu-id="93abb-220">Você também pode executar uma junção de grupo armazenando os resultados da operação `join` em uma variável temporária usando a palavra-chave [into](../language-reference/keywords/into.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-220">You can also perform a group join by storing the results of the `join` operation into a temporary variable by using the [into](../language-reference/keywords/into.md) keyword.</span></span> <span data-ttu-id="93abb-221">Para obter mais informações, consulte [Cláusula join](../language-reference/keywords/join-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-221">For more information, see [join clause](../language-reference/keywords/join-clause.md).</span></span>

#### <a name="let-clause"></a><span data-ttu-id="93abb-222">Cláusula let</span><span class="sxs-lookup"><span data-stu-id="93abb-222">let clause</span></span> 

<span data-ttu-id="93abb-223">Use a cláusula `let` para armazenar o resultado de uma expressão, como uma chamada de método, em uma nova variável de intervalo.</span><span class="sxs-lookup"><span data-stu-id="93abb-223">Use the `let` clause to store the result of an expression, such as a method call, in a new range variable.</span></span> <span data-ttu-id="93abb-224">No exemplo a seguir, a variável de intervalo `firstName` armazena o primeiro elemento da matriz de cadeias de caracteres que é retornado pelo `Split`.</span><span class="sxs-lookup"><span data-stu-id="93abb-224">In the following example, the range variable `firstName` stores the first element of the array of strings that is returned by `Split`.</span></span>

[!code-csharp[csrefQueryExpBasics#62](~/samples/snippets/csharp/concepts/linq/query-expression-basics_18.cs)]

<span data-ttu-id="93abb-225">Para obter mais informações, consulte [Cláusula let](../language-reference/keywords/let-clause.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-225">For more information, see [let clause](../language-reference/keywords/let-clause.md).</span></span>

### <a name="subqueries-in-a-query-expression"></a><span data-ttu-id="93abb-226">Subconsultas em uma expressão de consulta</span><span class="sxs-lookup"><span data-stu-id="93abb-226">Subqueries in a query expression</span></span>

<span data-ttu-id="93abb-227">Uma cláusula de consulta pode conter uma expressão de consulta, que às vezes é chamada de *subconsulta*.</span><span class="sxs-lookup"><span data-stu-id="93abb-227">A query clause may itself contain a query expression, which is sometimes referred to as a *subquery*.</span></span> <span data-ttu-id="93abb-228">Cada subconsulta começa com sua própria cláusula `from` que não necessariamente aponta para a mesma fonte de dados na primeira cláusula `from`.</span><span class="sxs-lookup"><span data-stu-id="93abb-228">Each subquery starts with its own `from` clause that does not necessarily point to the same data source in the first `from` clause.</span></span> <span data-ttu-id="93abb-229">Por exemplo, a consulta a seguir mostra uma expressão de consulta que é usada na instrução select para recuperar os resultados de uma operação de agrupamento.</span><span class="sxs-lookup"><span data-stu-id="93abb-229">For example, the following query shows a query expression that is used in the select statement to retrieve the results of a grouping operation.</span></span>

[!code-csharp[csrefQueryExpBasics#63](~/samples/snippets/csharp/concepts/linq/query-expression-basics_19.cs)]

<span data-ttu-id="93abb-230">Para obter mais informações, consulte [Como executar uma subconsulta em uma operação de agrupamento](perform-a-subquery-on-a-grouping-operation.md).</span><span class="sxs-lookup"><span data-stu-id="93abb-230">For more information, see [How to: perform a subquery on a grouping operation](perform-a-subquery-on-a-grouping-operation.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="93abb-231">Consulte também</span><span class="sxs-lookup"><span data-stu-id="93abb-231">See also</span></span>

- [<span data-ttu-id="93abb-232">Guia de programação em C#</span><span class="sxs-lookup"><span data-stu-id="93abb-232">C# programming guide</span></span>](../programming-guide/index.md)  
- [<span data-ttu-id="93abb-233">LINQ (Consulta Integrada à Linguagem)</span><span class="sxs-lookup"><span data-stu-id="93abb-233">Language Integrated Query (LINQ)</span></span>](index.md)  
- [<span data-ttu-id="93abb-234">Palavras-chave de consulta (LINQ)</span><span class="sxs-lookup"><span data-stu-id="93abb-234">Query keywords (LINQ)</span></span>](../language-reference/keywords/query-keywords.md)  
- [<span data-ttu-id="93abb-235">Visão geral de operadores de consulta padrão</span><span class="sxs-lookup"><span data-stu-id="93abb-235">Standard query operators overview</span></span>](../programming-guide/concepts/linq/standard-query-operators-overview.md)  