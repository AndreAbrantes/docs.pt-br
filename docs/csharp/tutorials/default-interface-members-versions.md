---
title: Atualizar interfaces com segurança usando membros de interface padrão em C#
description: Este tutorial avançado explora como adicionar novos recursos com segurança às definições de interface existentes sem interromper todas as classes e structs que implementam essa interface.
ms.date: 05/06/2019
ms.custom: mvc
ms.openlocfilehash: 2daa40ead5902454c6d45390233e1491fe6d369b
ms.sourcegitcommit: c4e9d05644c9cb89de5ce6002723de107ea2e2c4
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/19/2019
ms.locfileid: "65877910"
---
# <a name="tutorial-update-interfaces-with-default-interface-members-in-c-80"></a><span data-ttu-id="3ba31-103">Tutorial: Atualizar interfaces com membros da interface padrão no C# 8.0</span><span class="sxs-lookup"><span data-stu-id="3ba31-103">Tutorial: Update interfaces with default interface members in C# 8.0</span></span>

<span data-ttu-id="3ba31-104">Desde o C# 8.0 no .NET Core 3.0, é possível definir uma implementação em que você declara um membro de uma interface.</span><span class="sxs-lookup"><span data-stu-id="3ba31-104">Beginning with C# 8.0 on .NET Core 3.0, you can define an implementation when you declare a member of an interface.</span></span> <span data-ttu-id="3ba31-105">O cenário mais comum é adicionar membros com segurança a uma interface já lançada e usada por vários clientes.</span><span class="sxs-lookup"><span data-stu-id="3ba31-105">The most common scenario is to safely add members to an interface already released and used by innumerable clients.</span></span>

<span data-ttu-id="3ba31-106">Neste tutorial, você aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="3ba31-106">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="3ba31-107">Estender interfaces com segurança, adicionando métodos com implementações.</span><span class="sxs-lookup"><span data-stu-id="3ba31-107">Extend interfaces safely by adding methods with implementations.</span></span>
> * <span data-ttu-id="3ba31-108">Criar implementações parametrizadas para oferecer maior flexibilidade.</span><span class="sxs-lookup"><span data-stu-id="3ba31-108">Create parameterized implementations to provide greater flexibility.</span></span>
> * <span data-ttu-id="3ba31-109">Permitir que os implementadores forneçam uma implementação mais específica na forma de uma substituição.</span><span class="sxs-lookup"><span data-stu-id="3ba31-109">Enable implementers to provide a more specific implementation in the form of an override.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="3ba31-110">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="3ba31-110">Prerequisites</span></span>

<span data-ttu-id="3ba31-111">Você precisará configurar o computador para executar o .NET Core, incluindo o compilador da versão prévia do C# 8.0.</span><span class="sxs-lookup"><span data-stu-id="3ba31-111">You’ll need to set up your machine to run .NET Core, including the C# 8.0 preview compiler.</span></span> <span data-ttu-id="3ba31-112">O compilador da versão prévia do C# 8.0 está disponível no [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) ou no [SDK de versão prévia do .NET Core 3.0](https://dotnet.microsoft.com/download/dotnet-core/3.0) mais recente.</span><span class="sxs-lookup"><span data-stu-id="3ba31-112">The C# 8.0 preview compiler is available starting with [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019), or the latest [.NET Core 3.0 preview SDK](https://dotnet.microsoft.com/download/dotnet-core/3.0).</span></span> <span data-ttu-id="3ba31-113">Membros de interface padrão estão disponíveis desde a versão prévia 4 do .NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="3ba31-113">Default interface members are available beginning with .NET Core 3.0 preview 4.</span></span>

## <a name="scenario-overview"></a><span data-ttu-id="3ba31-114">Visão geral do cenário</span><span class="sxs-lookup"><span data-stu-id="3ba31-114">Scenario overview</span></span>

<span data-ttu-id="3ba31-115">Este tutorial começa com a versão 1 de uma biblioteca de relacionamento com o cliente.</span><span class="sxs-lookup"><span data-stu-id="3ba31-115">This tutorial starts with version 1 of a customer relationship library.</span></span> <span data-ttu-id="3ba31-116">Você pode obter o aplicativo de iniciante em nosso [repositório de exemplos no GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="3ba31-116">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span> <span data-ttu-id="3ba31-117">A empresa que criou essa biblioteca pretendia que clientes com aplicativos existentes adotassem a biblioteca.</span><span class="sxs-lookup"><span data-stu-id="3ba31-117">The company that built this library intended customers with existing applications to adopt their library.</span></span> <span data-ttu-id="3ba31-118">Eles forneciam definições de interface mínimas para os usuários da biblioteca implementarem.</span><span class="sxs-lookup"><span data-stu-id="3ba31-118">They provided minimal interface definitions for users of their library to implement.</span></span> <span data-ttu-id="3ba31-119">Aqui está a definição de interface para um cliente:</span><span class="sxs-lookup"><span data-stu-id="3ba31-119">Here's the interface definition for a customer:</span></span>

[!code-csharp[InitialCustomerInterface](~/samples/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/ICustomer.cs?name=SnippetICustomerVersion1)]

<span data-ttu-id="3ba31-120">Eles definiram uma segunda interface que representava um pedido:</span><span class="sxs-lookup"><span data-stu-id="3ba31-120">They defined a second interface that represents an order:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/IOrder.cs?name=SnippetIorderVersion1)]

<span data-ttu-id="3ba31-121">Dessas interfaces, a equipe poderia criar uma biblioteca para os usuários criarem uma experiência melhor para os clientes.</span><span class="sxs-lookup"><span data-stu-id="3ba31-121">From those interfaces, the team could build a library for their users to create a better experience for their customers.</span></span> <span data-ttu-id="3ba31-122">A meta era criar um relacionamento mais profundo com os clientes existentes e melhorar o relacionamento com clientes novos.</span><span class="sxs-lookup"><span data-stu-id="3ba31-122">Their goal was to create a deeper relationship with existing customers and improve their relationships with new customers.</span></span>

<span data-ttu-id="3ba31-123">Agora é hora de atualizar a biblioteca para a próxima versão.</span><span class="sxs-lookup"><span data-stu-id="3ba31-123">Now, it's time to upgrade the library for the next release.</span></span> <span data-ttu-id="3ba31-124">Um dos recursos solicitados habilitará um desconto de fidelidade para os clientes que tiverem muitos pedidos.</span><span class="sxs-lookup"><span data-stu-id="3ba31-124">One of the requested features enables a loyalty discount for customers that have lots of orders.</span></span> <span data-ttu-id="3ba31-125">Esse novo desconto de fidelidade é aplicado sempre que um cliente faz um pedido.</span><span class="sxs-lookup"><span data-stu-id="3ba31-125">This new loyalty discount gets applied whenever a customer makes an order.</span></span> <span data-ttu-id="3ba31-126">O desconto específico é uma propriedade de cada cliente.</span><span class="sxs-lookup"><span data-stu-id="3ba31-126">The specific discount is a property of each individual customer.</span></span> <span data-ttu-id="3ba31-127">Cada implementação de ICustomer pode definir regras diferentes para o desconto de fidelidade.</span><span class="sxs-lookup"><span data-stu-id="3ba31-127">Each implementation of ICustomer can set different rules for the loyalty discount.</span></span> 

<span data-ttu-id="3ba31-128">A forma mais natural de adicionar essa funcionalidade é melhorar a interface `ICustomer` com um método para aplicar qualquer desconto de fidelidade.</span><span class="sxs-lookup"><span data-stu-id="3ba31-128">The most natural way to add this functionality is to enhance the `ICustomer` interface with a method to apply any loyalty discount.</span></span> <span data-ttu-id="3ba31-129">Essa sugestão de design causou preocupação entre desenvolvedores experientes: "Interfaces são imutáveis depois que são lançadas!</span><span class="sxs-lookup"><span data-stu-id="3ba31-129">This design suggestion caused concern among experienced developers: "Interfaces are immutable once they've been released!</span></span> <span data-ttu-id="3ba31-130">Esta é uma alteração da falha!"</span><span class="sxs-lookup"><span data-stu-id="3ba31-130">This is a breaking change!"</span></span> <span data-ttu-id="3ba31-131">O C# 8.0 adiciona *implementações de interface padrão* para interfaces de atualização.</span><span class="sxs-lookup"><span data-stu-id="3ba31-131">C# 8.0 adds *default interface implementations* for upgrading interfaces.</span></span> <span data-ttu-id="3ba31-132">Os autores de biblioteca podem adicionar novos membros à interface e fornecer uma implementação padrão para esses membros.</span><span class="sxs-lookup"><span data-stu-id="3ba31-132">The library authors can add new members to the interface and provide a default implementation for those members.</span></span>

<span data-ttu-id="3ba31-133">Implementações de interface padrão permitem que os desenvolvedores atualizem uma interface, permitindo que qualquer implementador substitua essa implementação.</span><span class="sxs-lookup"><span data-stu-id="3ba31-133">Default interface implementations enable developers to upgrade an interface while still enabling any implementors to override that implementation.</span></span> <span data-ttu-id="3ba31-134">Os usuários da biblioteca podem aceitar a implementação padrão como uma alteração da falha.</span><span class="sxs-lookup"><span data-stu-id="3ba31-134">Users of the library can accept the default implementation as a non-breaking change.</span></span> <span data-ttu-id="3ba31-135">Se as regras de negócio forem diferentes, elas poderão substituir a implementação.</span><span class="sxs-lookup"><span data-stu-id="3ba31-135">If their business rules are different, they can override.</span></span>

## <a name="upgrade-with-default-interface-members"></a><span data-ttu-id="3ba31-136">Atualizar com membros de interface padrão</span><span class="sxs-lookup"><span data-stu-id="3ba31-136">Upgrade with default interface members</span></span>

<span data-ttu-id="3ba31-137">A equipe concordou na implementação padrão mais provável: um desconto de fidelidade para os clientes.</span><span class="sxs-lookup"><span data-stu-id="3ba31-137">The team agreed on the most likely default implementation: a loyalty discount for customers.</span></span>

<span data-ttu-id="3ba31-138">A atualização deve fornecer a funcionalidade para definir duas propriedades: o número de pedidos necessários para ser qualificado para o desconto e o percentual de desconto.</span><span class="sxs-lookup"><span data-stu-id="3ba31-138">The upgrade should provide the functionality to set two properties: the number of orders needed to be eligible for the discount, and the percentage of the discount.</span></span> <span data-ttu-id="3ba31-139">Isso se constitui em um cenário perfeito para membros de interface padrão.</span><span class="sxs-lookup"><span data-stu-id="3ba31-139">This makes it a perfect scenario for default interface members.</span></span> <span data-ttu-id="3ba31-140">Você pode adicionar um método à interface ICustomer e fornecer a implementação mais provável.</span><span class="sxs-lookup"><span data-stu-id="3ba31-140">You can add a method to the ICustomer interface, and provide the most likely implementation.</span></span> <span data-ttu-id="3ba31-141">Todas as implementações novas e existentes podem usar a implementação padrão ou fornecer as suas próprias.</span><span class="sxs-lookup"><span data-stu-id="3ba31-141">All existing, and any new implementations can use the default implementation, or provide their own.</span></span>

<span data-ttu-id="3ba31-142">Primeiro, adicione o novo método à implementação:</span><span class="sxs-lookup"><span data-stu-id="3ba31-142">First, add the new method to the implementation:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionOne)]

<span data-ttu-id="3ba31-143">O autor da biblioteca escreveu um primeiro teste para verificar a implementação:</span><span class="sxs-lookup"><span data-stu-id="3ba31-143">The library author wrote a first test to check the implementation:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetTestDefaultImplementation)]

<span data-ttu-id="3ba31-144">Observe a seguinte parte do teste:</span><span class="sxs-lookup"><span data-stu-id="3ba31-144">Notice the following portion of the test:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetHighlightCast)]

<span data-ttu-id="3ba31-145">Essa conversão de `SampleCustomer` em `ICustomer` é necessária.</span><span class="sxs-lookup"><span data-stu-id="3ba31-145">That cast from `SampleCustomer` to `ICustomer` is necessary.</span></span> <span data-ttu-id="3ba31-146">A classe `SampleCustomer` não precisa fornecer uma implementação de `ComputeLoyaltyDiscount`; isso é fornecido pela interface `ICustomer`.</span><span class="sxs-lookup"><span data-stu-id="3ba31-146">The `SampleCustomer` class doesn't need to provide an implementation for `ComputeLoyaltyDiscount`; that's provided by the `ICustomer` interface.</span></span> <span data-ttu-id="3ba31-147">No entanto, a classe `SampleCustomer` não herda membros de suas interfaces.</span><span class="sxs-lookup"><span data-stu-id="3ba31-147">However, the `SampleCustomer` class doesn't inherit members from its interfaces.</span></span> <span data-ttu-id="3ba31-148">Essa regra não foi alterada.</span><span class="sxs-lookup"><span data-stu-id="3ba31-148">That rule hasn't changed.</span></span> <span data-ttu-id="3ba31-149">Para chamar qualquer método declarado e implementado na interface, a variável deve ser o tipo da interface: `ICustomer` neste exemplo.</span><span class="sxs-lookup"><span data-stu-id="3ba31-149">In order to call any method declared and implemented in the interface, the variable must be the type of the interface, `ICustomer` in this example.</span></span>

## <a name="provide-parameterization"></a><span data-ttu-id="3ba31-150">Fornecer parametrização</span><span class="sxs-lookup"><span data-stu-id="3ba31-150">Provide parameterization</span></span>

<span data-ttu-id="3ba31-151">Esse é um bom início.</span><span class="sxs-lookup"><span data-stu-id="3ba31-151">That's a good start.</span></span> <span data-ttu-id="3ba31-152">Porém, a implementação padrão é restritiva demais.</span><span class="sxs-lookup"><span data-stu-id="3ba31-152">But, the default implementation is too restrictive.</span></span> <span data-ttu-id="3ba31-153">Muitos consumidores desse sistema podem escolher limites diferentes para o número de compras, um período diferente de associação ou um percentual de desconto diferente.</span><span class="sxs-lookup"><span data-stu-id="3ba31-153">Many consumers of this system may choose different thresholds for number of purchases, a different length of membership, or a different percentage discount.</span></span> <span data-ttu-id="3ba31-154">Você pode fornecer uma experiência de atualização melhor para mais clientes, fornecendo uma maneira de definir esses parâmetros.</span><span class="sxs-lookup"><span data-stu-id="3ba31-154">You can provide a better upgrade experience for more customers by providing a way to set those parameters.</span></span> <span data-ttu-id="3ba31-155">Vamos adicionar um método estático que defina esses três parâmetros, controlando a implementação padrão:</span><span class="sxs-lookup"><span data-stu-id="3ba31-155">Let's add a static method that sets those three parameters controlling the default implementation:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionTwo)]

<span data-ttu-id="3ba31-156">Há vários recursos novos de linguagem mostrados nesse pequeno fragmento de código.</span><span class="sxs-lookup"><span data-stu-id="3ba31-156">There's many new language capabilities shown in that small code fragment.</span></span> <span data-ttu-id="3ba31-157">Agora as interfaces podem incluir membros estáticos, incluindo campos e métodos.</span><span class="sxs-lookup"><span data-stu-id="3ba31-157">Interfaces can now include static members, including fields and methods.</span></span> <span data-ttu-id="3ba31-158">Modificadores de acesso diferentes também estão habilitados.</span><span class="sxs-lookup"><span data-stu-id="3ba31-158">Different access modifiers are also enabled.</span></span> <span data-ttu-id="3ba31-159">Os campos adicionais são particulares, o novo método é público.</span><span class="sxs-lookup"><span data-stu-id="3ba31-159">The additional fields are private, the new method is public.</span></span> <span data-ttu-id="3ba31-160">Qualquer dos modificadores são permitidos em membros de interface.</span><span class="sxs-lookup"><span data-stu-id="3ba31-160">Any of the modifiers are allowed on interface members.</span></span>

<span data-ttu-id="3ba31-161">Aplicativos que usam a fórmula geral para calcular o desconto de fidelidade, mas que usam parâmetros diferentes, não precisam fornecer uma implementação personalizada; eles podem definir os argumentos por meio de um método estático.</span><span class="sxs-lookup"><span data-stu-id="3ba31-161">Applications that use the general formula for computing the loyalty discount, but different parameters, don't need to provide a custom implementation; they can set the arguments through a static method.</span></span> <span data-ttu-id="3ba31-162">Por exemplo, o código a seguir define um "agradecimento ao cliente" que recompensa qualquer cliente com mais de um mês de associação:</span><span class="sxs-lookup"><span data-stu-id="3ba31-162">For example, the following code sets a "customer appreciation" that rewards any customer with more than one month's membership:</span></span>

[!code-csharp[SetLoyaltyThresholds](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetSetLoyaltyThresholds)]

## <a name="extend-the-default-implementation"></a><span data-ttu-id="3ba31-163">Estender a implementação padrão</span><span class="sxs-lookup"><span data-stu-id="3ba31-163">Extend the default implementation</span></span>

<span data-ttu-id="3ba31-164">O código que você adicionou até agora forneceu uma implementação conveniente para esses cenários em que os usuários querem algo semelhante à implementação padrão ou para fornecer um conjunto de regras não relacionado.</span><span class="sxs-lookup"><span data-stu-id="3ba31-164">The code you've added so far has provided a convenient implementation for those scenarios where users want something like the default implementation, or to provide an unrelated set of rules.</span></span> <span data-ttu-id="3ba31-165">Como um último recurso, vamos refatorar o código um pouco para permitir cenários em que os usuários queiram criar com base na implementação padrão.</span><span class="sxs-lookup"><span data-stu-id="3ba31-165">For a final feature, let's refactor the code a bit to enable scenarios where users may want to build on the default implementation.</span></span> 

<span data-ttu-id="3ba31-166">Considere uma startup que deseja atrair novos clientes.</span><span class="sxs-lookup"><span data-stu-id="3ba31-166">Consider a startup that wants to attract new customers.</span></span> <span data-ttu-id="3ba31-167">Eles oferecem um desconto de 50% no primeiro pedido de um novo cliente.</span><span class="sxs-lookup"><span data-stu-id="3ba31-167">They offer a 50% discount off a new customer's first order.</span></span> <span data-ttu-id="3ba31-168">Por outro lado, clientes existentes obtém o desconto padrão.</span><span class="sxs-lookup"><span data-stu-id="3ba31-168">Otherwise, existing customers get the standard discount.</span></span> <span data-ttu-id="3ba31-169">O autor da biblioteca precisa mover a implementação padrão para um método `protected static`, de modo que qualquer classe que implemente essa interface possa reutilizar o código em sua implementação.</span><span class="sxs-lookup"><span data-stu-id="3ba31-169">The library author needs to move the default implementation into a `protected static` method so that any class implementing this interface can reuse the code in their implementation.</span></span> <span data-ttu-id="3ba31-170">A implementação padrão do membro da interface também chama esse método compartilhado:</span><span class="sxs-lookup"><span data-stu-id="3ba31-170">The default implementation of the interface member calls this shared method as well:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetFinalVersion)]

<span data-ttu-id="3ba31-171">Em uma implementação de uma classe que implementa essa interface, a substituição pode chamar o método auxiliar estático e estender essa lógica para fornecer o desconto de "novo cliente":</span><span class="sxs-lookup"><span data-stu-id="3ba31-171">In an implementation of a class that implements this interface, the override can call the static helper method, and extend that logic to provide the "new customer" discount:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/SampleCustomer.cs?name=SnippetOverrideAndExtend)]

<span data-ttu-id="3ba31-172">Você pode ver todo o código concluído em nosso [repositório de exemplos no GitHub] (Você pode obter o aplicativo de iniciante em nosso [repositório de exemplos no GitHub)](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="3ba31-172">You can see the entire finished code in our [samples repo on GitHub](You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span></span>

<span data-ttu-id="3ba31-173">Esses novos recursos significam que interfaces podem ser atualizadas com segurança quando há uma implementação padrão razoável para os novos membros.</span><span class="sxs-lookup"><span data-stu-id="3ba31-173">These new features mean that interfaces can be updated safely when there's a reasonable default implementation for those new members.</span></span> <span data-ttu-id="3ba31-174">Projete interfaces cuidadosamente para expressar ideias funcionais únicas que possam ser implementadas por várias classes.</span><span class="sxs-lookup"><span data-stu-id="3ba31-174">Carefully design interfaces to express single functional ideas that can be implemented by multiple classes.</span></span> <span data-ttu-id="3ba31-175">Isso torna mais fácil atualizar essas definições de interface quando são descobertos novos requisitos para a mesma ideia funcional.</span><span class="sxs-lookup"><span data-stu-id="3ba31-175">That makes it easier to upgrade those interface definitions when new requirements are discovered for that same functional idea.</span></span>
