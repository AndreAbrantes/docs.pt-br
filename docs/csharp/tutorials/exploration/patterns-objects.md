---
title: Usar padrões em objetos – tutorial em C#
description: Este tutorial ensina técnicas para usar a correspondência de padrões em membros de classe para criar modelos melhores para comportamento de objeto
ms.date: 11/05/2020
ms.openlocfilehash: 072f6f57696504c2d691473e3a43c1cda53f227f
ms.sourcegitcommit: 6bef8abde346c59771a35f4f76bf037ff61c5ba3
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/06/2020
ms.locfileid: "94332184"
---
# <a name="use-pattern-matching-to-build-your-class-behavior-for-better-code"></a><span data-ttu-id="8d902-103">Use a correspondência de padrões para criar seu comportamento de classe para um código melhor</span><span class="sxs-lookup"><span data-stu-id="8d902-103">Use pattern matching to build your class behavior for better code</span></span>

<span data-ttu-id="8d902-104">Os recursos de correspondência de padrões no C# fornecem sintaxe para expressar seus algoritmos.</span><span class="sxs-lookup"><span data-stu-id="8d902-104">The pattern matching features in C# provide syntax to express your algorithms.</span></span> <span data-ttu-id="8d902-105">Você pode usar essas técnicas para implementar o comportamento em suas classes.</span><span class="sxs-lookup"><span data-stu-id="8d902-105">You can use these techniques to implement the behavior in your classes.</span></span> <span data-ttu-id="8d902-106">Você pode combinar o design de classe orientado a objeto com uma implementação orientada a dados para fornecer código conciso ao modelar objetos do mundo real.</span><span class="sxs-lookup"><span data-stu-id="8d902-106">You can combine object-oriented class design with a data-oriented implementation to provide concise code while modeling real-world objects.</span></span>

<span data-ttu-id="8d902-107">Neste tutorial, você aprenderá como:</span><span class="sxs-lookup"><span data-stu-id="8d902-107">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> - <span data-ttu-id="8d902-108">Expresse suas classes orientadas a objeto usando padrões de dados.</span><span class="sxs-lookup"><span data-stu-id="8d902-108">Express your object oriented classes using data patterns.</span></span>
> - <span data-ttu-id="8d902-109">Implemente esses padrões usando os recursos de correspondência de padrões do C#.</span><span class="sxs-lookup"><span data-stu-id="8d902-109">Implement those patterns using C#'s pattern matching features.</span></span>
> - <span data-ttu-id="8d902-110">Aproveite o diagnóstico do compilador para validar sua implementação.</span><span class="sxs-lookup"><span data-stu-id="8d902-110">Leverage compiler diagnostics to validate your implementation.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8d902-111">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="8d902-111">Prerequisites</span></span>

<span data-ttu-id="8d902-112">Você precisará configurar seu computador para executar o .NET 5, incluindo o compilador C# 9,0.</span><span class="sxs-lookup"><span data-stu-id="8d902-112">You’ll need to set up your machine to run .NET 5, including the C# 9.0 compiler.</span></span> <span data-ttu-id="8d902-113">O compilador C# 9,0 está disponível a partir do [Visual Studio 2019 versão 16,8 Preview](https://visualstudio.microsoft.com/vs/preview/) ou da [visualização do SDK do .NET 5,0](https://dotnet.microsoft.com/download/dotnet/5.0).</span><span class="sxs-lookup"><span data-stu-id="8d902-113">The C# 9.0 compiler is available starting with [Visual Studio 2019 version 16.8 preview](https://visualstudio.microsoft.com/vs/preview/) or the [.NET 5.0 SDK preview](https://dotnet.microsoft.com/download/dotnet/5.0).</span></span>

## <a name="build-a-simulation-of-a-canal-lock"></a><span data-ttu-id="8d902-114">Criar uma simulação de um bloqueio canal</span><span class="sxs-lookup"><span data-stu-id="8d902-114">Build a simulation of a canal lock</span></span>

<span data-ttu-id="8d902-115">Neste tutorial, você criará uma classe C# que simula um [bloqueio canal](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span><span class="sxs-lookup"><span data-stu-id="8d902-115">In this tutorial, you'll build a C# class that simulates a [canal lock](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span></span> <span data-ttu-id="8d902-116">Resumidamente, um bloqueio canal é um dispositivo que gera e reduz o Boats à medida que eles viajam entre dois esticamentos de água em diferentes níveis.</span><span class="sxs-lookup"><span data-stu-id="8d902-116">Briefly, a canal lock is a device that raises and lowers boats as they travel between two stretches of water at different levels.</span></span> <span data-ttu-id="8d902-117">Um bloqueio tem duas Gates e algum mecanismo para alterar o nível de água.</span><span class="sxs-lookup"><span data-stu-id="8d902-117">A lock has two gates and some mechanism to change the water level.</span></span>

<span data-ttu-id="8d902-118">Em sua operação normal, um barco entra em uma das Gates, enquanto o nível de água no bloqueio corresponde ao nível de água no lado em que o barco entra.</span><span class="sxs-lookup"><span data-stu-id="8d902-118">In its normal operation, a boat enters one of the gates while the water level in the lock matches the water level on the side the boat enters.</span></span> <span data-ttu-id="8d902-119">Uma vez no bloqueio, o nível de água será alterado para corresponder ao nível de água onde o barco deixará o bloqueio.</span><span class="sxs-lookup"><span data-stu-id="8d902-119">Once in the lock, the water level is changed to match the water level where the boat will leave the lock.</span></span> <span data-ttu-id="8d902-120">Quando o nível de água corresponde ao lado, o portão no lado de saída é aberto.</span><span class="sxs-lookup"><span data-stu-id="8d902-120">Once the water level matches that side, the gate on the exit side opens.</span></span> <span data-ttu-id="8d902-121">As medidas de segurança garantem que um operador não possa criar uma situação perigosa no canal.</span><span class="sxs-lookup"><span data-stu-id="8d902-121">Safety measures make sure an operator can't create a dangerous situation in the canal.</span></span> <span data-ttu-id="8d902-122">O nível de água só pode ser alterado quando ambos os Gates são fechados.</span><span class="sxs-lookup"><span data-stu-id="8d902-122">The water level can be changed only when both gates are closed.</span></span> <span data-ttu-id="8d902-123">No máximo uma porta pode ser aberta.</span><span class="sxs-lookup"><span data-stu-id="8d902-123">At most one gate can be open.</span></span> <span data-ttu-id="8d902-124">Para abrir um portão, o nível de água no bloqueio deve corresponder ao nível de água fora do portão que está sendo aberto.</span><span class="sxs-lookup"><span data-stu-id="8d902-124">To open a gate, the water level in the lock must match the water level outside the gate being opened.</span></span>

<span data-ttu-id="8d902-125">Você pode criar uma classe C# para modelar esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="8d902-125">You can build a C# class to model this behavior.</span></span> <span data-ttu-id="8d902-126">Uma `CanalLock` classe ofereceria suporte a comandos para abrir ou fechar qualquer portão.</span><span class="sxs-lookup"><span data-stu-id="8d902-126">A `CanalLock` class would support commands to open or close either gate.</span></span> <span data-ttu-id="8d902-127">Ele teria outros comandos para aumentar ou diminuir a água.</span><span class="sxs-lookup"><span data-stu-id="8d902-127">It would have other commands to raise or lower the water.</span></span> <span data-ttu-id="8d902-128">A classe também deve dar suporte a propriedades para ler o estado atual de Gates e o nível de água.</span><span class="sxs-lookup"><span data-stu-id="8d902-128">The class should also support properties to read the current state of both gates and the water level.</span></span> <span data-ttu-id="8d902-129">Seus métodos implementam as medidas de segurança.</span><span class="sxs-lookup"><span data-stu-id="8d902-129">Your methods implement the safety measures.</span></span>

## <a name="define-a-class"></a><span data-ttu-id="8d902-130">Definir um classe</span><span class="sxs-lookup"><span data-stu-id="8d902-130">Define a class</span></span>

<span data-ttu-id="8d902-131">Você criará um aplicativo de console para testar sua `CanalLock` classe.</span><span class="sxs-lookup"><span data-stu-id="8d902-131">You'll build a console application to test your `CanalLock` class.</span></span> <span data-ttu-id="8d902-132">Crie um novo projeto de console para o .NET 5 usando o Visual Studio ou a CLI do .NET.</span><span class="sxs-lookup"><span data-stu-id="8d902-132">Create a new console project for .NET 5 using either Visual Studio or the .NET CLI.</span></span> <span data-ttu-id="8d902-133">Em seguida, adicione uma nova classe e nomeie-a `CanalLock` .</span><span class="sxs-lookup"><span data-stu-id="8d902-133">Then, add a new class and name it `CanalLock`.</span></span> <span data-ttu-id="8d902-134">Em seguida, projete sua API pública, mas deixe os métodos não implementados:</span><span class="sxs-lookup"><span data-stu-id="8d902-134">Next, design your public API, but leave the methods not implemented:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="APIDesign":::

<span data-ttu-id="8d902-135">O código anterior Inicializa o objeto para que ambos os Gates sejam fechados e o nível de água é baixo.</span><span class="sxs-lookup"><span data-stu-id="8d902-135">The preceding code initializes the object so both gates are closed, and the water level is low.</span></span> <span data-ttu-id="8d902-136">Em seguida, escreva o código de teste a seguir em seu `Main` método para orientá-lo enquanto cria uma primeira implementação da classe:</span><span class="sxs-lookup"><span data-stu-id="8d902-136">Next, write the following test code in your `Main` method to guide you as you create a first implementation of the class:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HappyTests":::

<span data-ttu-id="8d902-137">Em seguida, adicione uma primeira implementação de cada método na `CanalLock` classe.</span><span class="sxs-lookup"><span data-stu-id="8d902-137">Next, add a first implementation of each method in the `CanalLock` class.</span></span> <span data-ttu-id="8d902-138">O código a seguir implementa os métodos da classe sem preocupação com as regras de segurança.</span><span class="sxs-lookup"><span data-stu-id="8d902-138">The following code implements the methods of the class without concern to the safety rules.</span></span> <span data-ttu-id="8d902-139">Você adicionará testes de segurança mais tarde:</span><span class="sxs-lookup"><span data-stu-id="8d902-139">You'll add safety tests later:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="FirstImplementation":::

<span data-ttu-id="8d902-140">Os testes que você escreveu até agora são aprovados.</span><span class="sxs-lookup"><span data-stu-id="8d902-140">The tests you've written so far pass.</span></span> <span data-ttu-id="8d902-141">Você implementou os conceitos básicos.</span><span class="sxs-lookup"><span data-stu-id="8d902-141">You've implemented the basics.</span></span> <span data-ttu-id="8d902-142">Agora, grave um teste para a primeira condição de falha.</span><span class="sxs-lookup"><span data-stu-id="8d902-142">Now, write a test for the first failure condition.</span></span> <span data-ttu-id="8d902-143">No final dos testes anteriores, ambos os Gates são fechados e o nível de água é definido como baixo.</span><span class="sxs-lookup"><span data-stu-id="8d902-143">At the end of the previous tests, both gates are closed, and the water level is set to low.</span></span> <span data-ttu-id="8d902-144">Adicione um teste para tentar abrir o portão superior:</span><span class="sxs-lookup"><span data-stu-id="8d902-144">Add a test to try opening the upper gate:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HighGateSafetyTest":::

<span data-ttu-id="8d902-145">Esse teste falha porque a porta é aberta.</span><span class="sxs-lookup"><span data-stu-id="8d902-145">This test fails because the gate opens.</span></span> <span data-ttu-id="8d902-146">Como uma primeira implementação, você pode corrigi-lo com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="8d902-146">As a first implementation, you could fix it with the following code:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="SecondImplementation":::

<span data-ttu-id="8d902-147">Seus testes são aprovados.</span><span class="sxs-lookup"><span data-stu-id="8d902-147">Your tests pass.</span></span> <span data-ttu-id="8d902-148">Mas, à medida que você adiciona mais testes, você adicionará mais `if` cláusulas e testará propriedades diferentes.</span><span class="sxs-lookup"><span data-stu-id="8d902-148">But, as you add more tests, you'll add more and more `if` clauses and test different properties.</span></span> <span data-ttu-id="8d902-149">Em breve, esses métodos ficarão muito complicados à medida que você adicionar mais condicionais.</span><span class="sxs-lookup"><span data-stu-id="8d902-149">Soon, these methods will get too complicated as you add more conditionals.</span></span>

## <a name="implement-the-commands-with-patterns"></a><span data-ttu-id="8d902-150">Implementar os comandos com padrões</span><span class="sxs-lookup"><span data-stu-id="8d902-150">Implement the commands with patterns</span></span>

<span data-ttu-id="8d902-151">Uma maneira melhor é usar *padrões* para determinar se o objeto está em um estado válido para executar um comando.</span><span class="sxs-lookup"><span data-stu-id="8d902-151">A better way is to use *patterns* to determine if the object is in a valid state to execute a command.</span></span> <span data-ttu-id="8d902-152">Você pode expressar se um comando é permitido como uma função de três variáveis: o estado da porta, o nível da água e a nova configuração:</span><span class="sxs-lookup"><span data-stu-id="8d902-152">You can express if a command is allowed as a function of three variables: the state of the gate, the level of the water, and the new setting:</span></span>

| <span data-ttu-id="8d902-153">Nova configuração</span><span class="sxs-lookup"><span data-stu-id="8d902-153">New setting</span></span> | <span data-ttu-id="8d902-154">Estado da porta</span><span class="sxs-lookup"><span data-stu-id="8d902-154">Gate state</span></span> | <span data-ttu-id="8d902-155">Nível de água</span><span class="sxs-lookup"><span data-stu-id="8d902-155">Water Level</span></span> | <span data-ttu-id="8d902-156">Resultado</span><span class="sxs-lookup"><span data-stu-id="8d902-156">Result</span></span>             |
| ----------- | ---------- | ----------- | ------------------ |
| <span data-ttu-id="8d902-157">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-157">Closed</span></span>      | <span data-ttu-id="8d902-158">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-158">Closed</span></span>     | <span data-ttu-id="8d902-159">Alta</span><span class="sxs-lookup"><span data-stu-id="8d902-159">High</span></span>        | <span data-ttu-id="8d902-160">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-160">Closed</span></span>             |
| <span data-ttu-id="8d902-161">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-161">Closed</span></span>      | <span data-ttu-id="8d902-162">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-162">Closed</span></span>     | <span data-ttu-id="8d902-163">Baixo</span><span class="sxs-lookup"><span data-stu-id="8d902-163">Low</span></span>         | <span data-ttu-id="8d902-164">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-164">Closed</span></span>             |
| <span data-ttu-id="8d902-165">Fechado</span><span class="sxs-lookup"><span data-stu-id="8d902-165">Closed</span></span>      | <span data-ttu-id="8d902-166">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-166">Open</span></span>       | <span data-ttu-id="8d902-167">Alta</span><span class="sxs-lookup"><span data-stu-id="8d902-167">High</span></span>        | <span data-ttu-id="8d902-168">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-168">Open</span></span>               |
| <span data-ttu-id="8d902-169">~~Fechadas~~</span><span class="sxs-lookup"><span data-stu-id="8d902-169">~~Closed~~</span></span>  | <span data-ttu-id="8d902-170">~~Abrir~~</span><span class="sxs-lookup"><span data-stu-id="8d902-170">~~Open~~</span></span>   | <span data-ttu-id="8d902-171">~~Baixa~~</span><span class="sxs-lookup"><span data-stu-id="8d902-171">~~Low~~</span></span>     | <span data-ttu-id="8d902-172">~~Fechadas~~</span><span class="sxs-lookup"><span data-stu-id="8d902-172">~~Closed~~</span></span>         |
| <span data-ttu-id="8d902-173">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-173">Open</span></span>        | <span data-ttu-id="8d902-174">Fechadas</span><span class="sxs-lookup"><span data-stu-id="8d902-174">Closed</span></span>     | <span data-ttu-id="8d902-175">Alta</span><span class="sxs-lookup"><span data-stu-id="8d902-175">High</span></span>        | <span data-ttu-id="8d902-176">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-176">Open</span></span>               |
| <span data-ttu-id="8d902-177">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-177">Open</span></span>        | <span data-ttu-id="8d902-178">Fechadas</span><span class="sxs-lookup"><span data-stu-id="8d902-178">Closed</span></span>     | <span data-ttu-id="8d902-179">Baixo</span><span class="sxs-lookup"><span data-stu-id="8d902-179">Low</span></span>         | <span data-ttu-id="8d902-180">Fechado (erro)</span><span class="sxs-lookup"><span data-stu-id="8d902-180">Closed (Error)</span></span>     |
| <span data-ttu-id="8d902-181">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-181">Open</span></span>        | <span data-ttu-id="8d902-182">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-182">Open</span></span>       | <span data-ttu-id="8d902-183">Alta</span><span class="sxs-lookup"><span data-stu-id="8d902-183">High</span></span>        | <span data-ttu-id="8d902-184">Aberto</span><span class="sxs-lookup"><span data-stu-id="8d902-184">Open</span></span>               |
| <span data-ttu-id="8d902-185">~~Abrir~~</span><span class="sxs-lookup"><span data-stu-id="8d902-185">~~Open~~</span></span>    | <span data-ttu-id="8d902-186">~~Abrir~~</span><span class="sxs-lookup"><span data-stu-id="8d902-186">~~Open~~</span></span>   | <span data-ttu-id="8d902-187">~~Baixa~~</span><span class="sxs-lookup"><span data-stu-id="8d902-187">~~Low~~</span></span>     | <span data-ttu-id="8d902-188">~~Fechado (erro)~~</span><span class="sxs-lookup"><span data-stu-id="8d902-188">~~Closed (Error)~~</span></span> |

<span data-ttu-id="8d902-189">A quarta e última linhas na tabela têm texto tachado porque são inválidas.</span><span class="sxs-lookup"><span data-stu-id="8d902-189">The fourth and last rows in the table have strike through text because they're invalid.</span></span> <span data-ttu-id="8d902-190">O código que você está adicionando agora deve garantir que a porta de água alta nunca seja aberta quando a água estiver baixa.</span><span class="sxs-lookup"><span data-stu-id="8d902-190">The code you're adding now should make sure the high water gate is never opened when the water is low.</span></span>  <span data-ttu-id="8d902-191">Esses Estados podem ser codificados como uma única expressão de comutador (Lembre-se de que `false` indica "closed"):</span><span class="sxs-lookup"><span data-stu-id="8d902-191">Those states can be coded as a single switch expression (remember that `false` indicates "Closed"):</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="ThirdImplementation":::

<span data-ttu-id="8d902-192">Experimente esta versão.</span><span class="sxs-lookup"><span data-stu-id="8d902-192">Try this version.</span></span> <span data-ttu-id="8d902-193">Seus testes são aprovados, validando o código.</span><span class="sxs-lookup"><span data-stu-id="8d902-193">Your tests pass, validating the code.</span></span> <span data-ttu-id="8d902-194">A tabela completa mostra as possíveis combinações de entradas e resultados.</span><span class="sxs-lookup"><span data-stu-id="8d902-194">The full table shows the possible combinations of inputs and results.</span></span> <span data-ttu-id="8d902-195">Isso significa que você e outros desenvolvedores podem examinar rapidamente a tabela e ver que você abordou todas as entradas possíveis.</span><span class="sxs-lookup"><span data-stu-id="8d902-195">That means you and other developers can quickly look at the table and see that you've covered all the possible inputs.</span></span> <span data-ttu-id="8d902-196">Ainda mais fácil, o compilador também pode ajudar.</span><span class="sxs-lookup"><span data-stu-id="8d902-196">Even easier, the compiler can help as well.</span></span> <span data-ttu-id="8d902-197">Depois de adicionar o código anterior, você pode ver que o compilador gera um aviso: *CS8524* indica que a expressão switch não cobre todas as entradas possíveis.</span><span class="sxs-lookup"><span data-stu-id="8d902-197">After you add the previous code, you can see that the compiler generates a warning: *CS8524* indicates the switch expression doesn't cover all possible inputs.</span></span> <span data-ttu-id="8d902-198">O motivo para esse aviso é que uma das entradas é um `enum` tipo.</span><span class="sxs-lookup"><span data-stu-id="8d902-198">The reason for that warning is that one of the inputs is an `enum` type.</span></span> <span data-ttu-id="8d902-199">O compilador interpreta "todas as entradas possíveis" como todas as entradas do tipo subjacente, normalmente um `int` .</span><span class="sxs-lookup"><span data-stu-id="8d902-199">The compiler interprets "all possible inputs" as all inputs from the underlying type, typically an `int`.</span></span> <span data-ttu-id="8d902-200">Esta `switch` expressão verifica apenas os valores declarados no `enum` .</span><span class="sxs-lookup"><span data-stu-id="8d902-200">This `switch` expression only checks the values declared in the `enum`.</span></span> <span data-ttu-id="8d902-201">Para remover o aviso, você pode adicionar um padrão de descarte catch-all para o último ARM da expressão.</span><span class="sxs-lookup"><span data-stu-id="8d902-201">To remove the warning, you can add a catch-all discard pattern for the last arm of the expression.</span></span> <span data-ttu-id="8d902-202">Essa condição gera uma exceção, porque ela indica entrada inválida:</span><span class="sxs-lookup"><span data-stu-id="8d902-202">This condition throws an exception, because it indicates invalid input:</span></span>

```csharp
_  => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="8d902-203">O braço de comutador anterior deve ser o último em sua `switch` expressão, pois ele corresponde a todas as entradas.</span><span class="sxs-lookup"><span data-stu-id="8d902-203">The preceding switch arm must be last in your `switch` expression because it matches all inputs.</span></span> <span data-ttu-id="8d902-204">Experimente movê-lo anteriormente na ordem.</span><span class="sxs-lookup"><span data-stu-id="8d902-204">Experiment by moving it earlier in the order.</span></span> <span data-ttu-id="8d902-205">Isso causa um erro do compilador *CS8510* para código inacessível em um padrão.</span><span class="sxs-lookup"><span data-stu-id="8d902-205">That causes a compiler error *CS8510* for unreachable code in a pattern.</span></span>  <span data-ttu-id="8d902-206">A estrutura natural de expressões switch permite que o compilador gere erros e avisos para possíveis erros.</span><span class="sxs-lookup"><span data-stu-id="8d902-206">The natural structure of switch expressions enables the compiler to generate errors and warnings for possible mistakes.</span></span> <span data-ttu-id="8d902-207">O compilador "rede de segurança" facilita a criação de código correto em menos iterações e a liberdade de combinar os braços de switch com caracteres curinga.</span><span class="sxs-lookup"><span data-stu-id="8d902-207">The compiler "safety net" makes it easier for you to create correct code in fewer iterations, and the freedom to combine switch arms with wildcards.</span></span> <span data-ttu-id="8d902-208">O compilador emitirá erros se sua combinação resultar em braços inacessíveis que você não esperava e avisos se você remover um ARM necessário.</span><span class="sxs-lookup"><span data-stu-id="8d902-208">The compiler will issue errors if your combination results in unreachable arms you didn't expect, and warnings if you remove an arm that's needed.</span></span>

<span data-ttu-id="8d902-209">A primeira alteração é combinar todos os braços em que o comando é para fechar a porta; Isso é sempre permitido.</span><span class="sxs-lookup"><span data-stu-id="8d902-209">The first change is to combine all the arms where the command is to close the gate; that's always allowed.</span></span> <span data-ttu-id="8d902-210">Adicione o seguinte código como o primeiro ARM em sua expressão de comutador:</span><span class="sxs-lookup"><span data-stu-id="8d902-210">Add the following code as the first arm in your switch expression:</span></span>

```csharp
(false, _, _) => false,
```

<span data-ttu-id="8d902-211">Depois de adicionar o braço de comutador anterior, você obterá quatro erros de compilador, um em cada um dos braços em que o comando é `false` .</span><span class="sxs-lookup"><span data-stu-id="8d902-211">After you add the previous switch arm, you'll get four compiler errors, one on each of the arms where the command is `false`.</span></span> <span data-ttu-id="8d902-212">Esses braços já estão cobertos pelo ARM recém-adicionado.</span><span class="sxs-lookup"><span data-stu-id="8d902-212">Those arms are already covered by the newly added arm.</span></span> <span data-ttu-id="8d902-213">Você pode remover essas quatro linhas com segurança.</span><span class="sxs-lookup"><span data-stu-id="8d902-213">You can safely remove those four lines.</span></span> <span data-ttu-id="8d902-214">Você pretendia esse novo braço de comutador para substituir essas condições.</span><span class="sxs-lookup"><span data-stu-id="8d902-214">You intended this new switch arm to replace those conditions.</span></span>

<span data-ttu-id="8d902-215">Em seguida, você pode simplificar os quatro braços em que o comando é para abrir o portão.</span><span class="sxs-lookup"><span data-stu-id="8d902-215">Next, you can simplify the four arms where the command is to open the gate.</span></span> <span data-ttu-id="8d902-216">Em ambos os casos em que o nível de água é alto, o portão pode ser aberto.</span><span class="sxs-lookup"><span data-stu-id="8d902-216">In both cases where the water level is high, the gate can be opened.</span></span> <span data-ttu-id="8d902-217">(Em um, ele já está aberto.) Um caso em que o nível de água está baixo gera uma exceção e o outro não deve acontecer.</span><span class="sxs-lookup"><span data-stu-id="8d902-217">(In one, it's already open.) One case where the water level is low throws an exception, and the other shouldn't happen.</span></span> <span data-ttu-id="8d902-218">Deve ser seguro lançar a mesma exceção se o bloqueio de água já estiver em um estado inválido.</span><span class="sxs-lookup"><span data-stu-id="8d902-218">It should be safe to throw the same exception if the water lock is already in an invalid state.</span></span> <span data-ttu-id="8d902-219">Você pode fazer as seguintes simplificações para esses braços:</span><span class="sxs-lookup"><span data-stu-id="8d902-219">You can make the following simplifications for those arms:</span></span>

```csharp
(true, _, WaterLevel.High) => true,
(true, false, WaterLevel.Low) => throw new InvalidOperationException("Cannot open high gate when the water is low"),
_ => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="8d902-220">Execute os testes novamente e eles passam.</span><span class="sxs-lookup"><span data-stu-id="8d902-220">Run your tests again, and they pass.</span></span> <span data-ttu-id="8d902-221">Esta é a versão final do `SetHighGate` método:</span><span class="sxs-lookup"><span data-stu-id="8d902-221">Here's the final version of the `SetHighGate` method:</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalImplementaton":::

## <a name="implement-patterns-yourself"></a><span data-ttu-id="8d902-222">Implementar padrões por conta própria</span><span class="sxs-lookup"><span data-stu-id="8d902-222">Implement patterns yourself</span></span>

<span data-ttu-id="8d902-223">Agora que você já viu a técnica, preencha os `SetLowGate` métodos e por `SetWaterLevel` conta própria.</span><span class="sxs-lookup"><span data-stu-id="8d902-223">Now that you've seen the technique, fill in the `SetLowGate` and `SetWaterLevel` methods yourself.</span></span>  <span data-ttu-id="8d902-224">Comece adicionando o código a seguir para testar operações inválidas nesses métodos:</span><span class="sxs-lookup"><span data-stu-id="8d902-224">Start by adding the following code to test invalid operations on those methods:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="FinalTestCode":::

<span data-ttu-id="8d902-225">Execute o aplicativo novamente.</span><span class="sxs-lookup"><span data-stu-id="8d902-225">Run your application again.</span></span> <span data-ttu-id="8d902-226">Você pode ver que os novos testes falham e o bloqueio canal entra em um estado inválido.</span><span class="sxs-lookup"><span data-stu-id="8d902-226">You can see the new tests fail, and the canal lock gets into an invalid state.</span></span> <span data-ttu-id="8d902-227">Tente implementar os métodos restantes por conta própria.</span><span class="sxs-lookup"><span data-stu-id="8d902-227">Try to implement the remaining methods yourself.</span></span> <span data-ttu-id="8d902-228">O método para definir o portão inferior deve ser semelhante ao método para definir o portão superior.</span><span class="sxs-lookup"><span data-stu-id="8d902-228">The method to set the lower gate should be similar to the method to set the upper gate.</span></span> <span data-ttu-id="8d902-229">O método que altera o nível de água tem verificações diferentes, mas deve seguir uma estrutura semelhante.</span><span class="sxs-lookup"><span data-stu-id="8d902-229">The method that changes the water level has different checks, but should follow a similar structure.</span></span> <span data-ttu-id="8d902-230">Talvez você ache útil usar o mesmo processo para o método que define o nível de água.</span><span class="sxs-lookup"><span data-stu-id="8d902-230">You may find it helpful to use the same process for the method that sets the water level.</span></span> <span data-ttu-id="8d902-231">Comece com todas as quatro entradas: o estado de ambos os Gates, o estado atual do nível de água e o novo nível de água solicitado.</span><span class="sxs-lookup"><span data-stu-id="8d902-231">Start with all four inputs: The state of both gates, the current state of the water level, and the requested new water level.</span></span> <span data-ttu-id="8d902-232">A expressão switch deve começar com:</span><span class="sxs-lookup"><span data-stu-id="8d902-232">The switch expression should start with:</span></span>

```csharp
CanalLockWaterLevel = (newLevel, CanalLockWaterLevel, LowWaterGateOpen, HighWaterGateOpen) switch
{
    // elided
};
```

<span data-ttu-id="8d902-233">Você terá 16 braços de comutação total para preencher.</span><span class="sxs-lookup"><span data-stu-id="8d902-233">You'll have 16 total switch arms to fill in.</span></span> <span data-ttu-id="8d902-234">Em seguida, teste e simplifique.</span><span class="sxs-lookup"><span data-stu-id="8d902-234">Then, test and simplify.</span></span>

<span data-ttu-id="8d902-235">Você fez métodos como este?</span><span class="sxs-lookup"><span data-stu-id="8d902-235">Did you make methods something like this?</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalExercise":::

<span data-ttu-id="8d902-236">Seus testes devem passar e o bloqueio canal deve funcionar com segurança.</span><span class="sxs-lookup"><span data-stu-id="8d902-236">Your tests should pass, and the canal lock should operate safely.</span></span>

## <a name="summary"></a><span data-ttu-id="8d902-237">Resumo</span><span class="sxs-lookup"><span data-stu-id="8d902-237">Summary</span></span>

<span data-ttu-id="8d902-238">Neste tutorial, você aprendeu a usar a correspondência de padrões para verificar o estado interno de um objeto antes de aplicar qualquer alteração a esse estado.</span><span class="sxs-lookup"><span data-stu-id="8d902-238">In this tutorial, you learned to use pattern matching to check the internal state of an object before applying any changes to that state.</span></span> <span data-ttu-id="8d902-239">Você pode verificar combinações de propriedades.</span><span class="sxs-lookup"><span data-stu-id="8d902-239">You can check combinations of properties.</span></span> <span data-ttu-id="8d902-240">Depois de criar tabelas para qualquer uma dessas transições, você testará seu código e, em seguida, simplificará a legibilidade e a capacidade de manutenção.</span><span class="sxs-lookup"><span data-stu-id="8d902-240">Once you've built tables for any of those transitions, you test your code, then simplify for readability and maintainability.</span></span> <span data-ttu-id="8d902-241">Essas refatoridades iniciais podem sugerir refatoração adicional que validam o estado interno ou gerenciam outras alterações de API.</span><span class="sxs-lookup"><span data-stu-id="8d902-241">These initial refactorings may suggest further refactorings that validate internal state or manage other API changes.</span></span> <span data-ttu-id="8d902-242">Este tutorial combinou classes e objetos com uma abordagem mais orientada a dados, baseada em padrões, para implementar essas classes.</span><span class="sxs-lookup"><span data-stu-id="8d902-242">This tutorial combined classes and objects with a more data-oriented, pattern-based approach to implement those classes.</span></span>
