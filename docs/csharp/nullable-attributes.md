---
title: Atualizar APIs para tipos de referência anulados com atributos que definem expectativas de valores nulos
description: Aprenda a usar os atributos descritivos AllowNull, DisallowNull, MaybeNull, NotNull e muito mais para descrever completamente o estado nulo de suas APIs.
ms.technology: csharp-null-safety
ms.date: 07/31/2019
ms.openlocfilehash: 5d7a864ba1b66ad6b4ae7b0391d170a29147c537
ms.sourcegitcommit: f87ad41b8e62622da126aa928f7640108c4eff98
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/07/2020
ms.locfileid: "80805839"
---
# <a name="update-libraries-to-use-nullable-reference-types-and-communicate-nullable-rules-to-callers"></a><span data-ttu-id="5483c-103">Atualize bibliotecas para usar tipos de referência anulados e comunicar regras anuladas aos chamadores</span><span class="sxs-lookup"><span data-stu-id="5483c-103">Update libraries to use nullable reference types and communicate nullable rules to callers</span></span>

<span data-ttu-id="5483c-104">A adição de tipos de [referência anulados](nullable-references.md) significa que você pode declarar se um `null` valor é permitido ou esperado para cada variável.</span><span class="sxs-lookup"><span data-stu-id="5483c-104">The addition of [nullable reference types](nullable-references.md) means you can declare whether or not a `null` value is allowed or expected for every variable.</span></span> <span data-ttu-id="5483c-105">Além disso, você pode aplicar uma `AllowNull` `DisallowNull`série `MaybeNull` `NotNull`de `NotNullWhen` `MaybeNullWhen`atributos: , , , , , , , , e `NotNullIfNotNull` descrever completamente os estados nulos de argumento e valores de devolução.</span><span class="sxs-lookup"><span data-stu-id="5483c-105">In addition, you can apply a number of attributes: `AllowNull`, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull` to completely describe the null states of argument and return values.</span></span> <span data-ttu-id="5483c-106">Isso proporciona uma grande experiência enquanto você escreve código.</span><span class="sxs-lookup"><span data-stu-id="5483c-106">That provides a great experience as you write code.</span></span> <span data-ttu-id="5483c-107">Você recebe avisos se uma variável não-nula pode ser definida como `null`.</span><span class="sxs-lookup"><span data-stu-id="5483c-107">You get warnings if a non-nullable variable might be set to `null`.</span></span> <span data-ttu-id="5483c-108">Você recebe avisos se uma variável anulada não for verificada nula antes de desreferencia-la.</span><span class="sxs-lookup"><span data-stu-id="5483c-108">You get warnings if a nullable variable isn't null-checked before you dereference it.</span></span> <span data-ttu-id="5483c-109">Atualizar suas bibliotecas pode levar tempo, mas os pagamentos valem a pena.</span><span class="sxs-lookup"><span data-stu-id="5483c-109">Updating your libraries can take time, but the payoffs are worth it.</span></span> <span data-ttu-id="5483c-110">Quanto mais informações você fornecer ao compilador sobre *quando* um `null` valor é permitido ou proibido, melhores avisos os usuários de sua API receberão.</span><span class="sxs-lookup"><span data-stu-id="5483c-110">The more information you provide to the compiler about *when* a `null` value is allowed or prohibited, the better warnings users of your API will get.</span></span> <span data-ttu-id="5483c-111">Vamos começar com um exemplo familiar.</span><span class="sxs-lookup"><span data-stu-id="5483c-111">Let's start with a familiar example.</span></span> <span data-ttu-id="5483c-112">Imagine que sua biblioteca tem a seguinte API para recuperar uma seqüência de recursos:</span><span class="sxs-lookup"><span data-stu-id="5483c-112">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="5483c-113">O exemplo anterior segue `Try*` o padrão familiar em .NET.</span><span class="sxs-lookup"><span data-stu-id="5483c-113">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="5483c-114">Existem dois argumentos de referência `key` para `message` esta API: o e o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="5483c-114">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="5483c-115">Esta API tem as seguintes regras relativas à nulidade desses argumentos:</span><span class="sxs-lookup"><span data-stu-id="5483c-115">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="5483c-116">Os chamadores `null` não devem `key`passar como argumento para .</span><span class="sxs-lookup"><span data-stu-id="5483c-116">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="5483c-117">Os chamadores podem passar `null` uma variável `message`cujo valor é como o argumento para .</span><span class="sxs-lookup"><span data-stu-id="5483c-117">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="5483c-118">Se `TryGetMessage` o `true`método retornar, `message` o valor de não é nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-118">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="5483c-119">Se o valor `false,` de `message` devolução for o valor de (e seu estado nulo) é nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-119">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="5483c-120">A regra `key` para pode ser completamente expressa `key` pelo tipo de variável: deve ser um tipo de referência não anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-120">The rule for `key` can be completely expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="5483c-121">O `message` parâmetro é mais complexo.</span><span class="sxs-lookup"><span data-stu-id="5483c-121">The `message` parameter is more complex.</span></span> <span data-ttu-id="5483c-122">Permite `null` como argumento, mas garante que, `out` no sucesso, esse argumento não é nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-122">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="5483c-123">Para esses cenários, você precisa de um vocabulário mais rico para descrever as expectativas.</span><span class="sxs-lookup"><span data-stu-id="5483c-123">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="5483c-124">Atualizar sua biblioteca para referências anuladas `?` requer mais do que polvilhar algumas das variáveis e nomes de tipo.</span><span class="sxs-lookup"><span data-stu-id="5483c-124">Updating your library for nullable references requires more than sprinkling `?` on some of the variables and type names.</span></span> <span data-ttu-id="5483c-125">O exemplo anterior mostra que você precisa examinar suas APIs e considerar suas expectativas para cada argumento de entrada.</span><span class="sxs-lookup"><span data-stu-id="5483c-125">The preceding example shows that you need to examine your APIs and consider your expectations for each input argument.</span></span> <span data-ttu-id="5483c-126">Considere as garantias para o `out` valor `ref` de devolução, e quaisquer ou argumentos sobre o retorno do método.</span><span class="sxs-lookup"><span data-stu-id="5483c-126">Consider the guarantees for the return value, and any `out` or `ref` arguments upon the method's return.</span></span> <span data-ttu-id="5483c-127">Em seguida, comunique essas regras ao compilador, e o compilador fornecerá avisos quando os chamadores não cumprirem essas regras.</span><span class="sxs-lookup"><span data-stu-id="5483c-127">Then communicate those rules to the compiler, and the compiler will provide warnings when callers don't abide by those rules.</span></span>

<span data-ttu-id="5483c-128">Este trabalho leva tempo.</span><span class="sxs-lookup"><span data-stu-id="5483c-128">This work takes time.</span></span> <span data-ttu-id="5483c-129">Vamos começar com estratégias para tornar sua biblioteca ou aplicativo anulado, ao mesmo tempo em que equilibra mos outros requisitos e entregas.</span><span class="sxs-lookup"><span data-stu-id="5483c-129">Let's start with strategies to make your library or application nullable-aware, while balancing other requirements and deliverables.</span></span> <span data-ttu-id="5483c-130">Você verá como equilibrar o desenvolvimento contínuo permitindo tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="5483c-130">You'll see how to balance ongoing development enabling nullable reference types.</span></span> <span data-ttu-id="5483c-131">Você aprenderá desafios para definições de tipos genéricos.</span><span class="sxs-lookup"><span data-stu-id="5483c-131">You'll learn challenges for generic type definitions.</span></span> <span data-ttu-id="5483c-132">Você aprenderá a aplicar atributos para descrever pré e pós-condições em APIs individuais.</span><span class="sxs-lookup"><span data-stu-id="5483c-132">You'll learn to apply attributes to describe pre- and post-conditions on individual APIs.</span></span>

## <a name="choose-a-strategy-for-nullable-reference-types"></a><span data-ttu-id="5483c-133">Escolha uma estratégia para tipos de referência anulados</span><span class="sxs-lookup"><span data-stu-id="5483c-133">Choose a strategy for nullable reference types</span></span>

<span data-ttu-id="5483c-134">A primeira escolha é se os tipos de referência anulados devem estar ligados ou desligados por padrão.</span><span class="sxs-lookup"><span data-stu-id="5483c-134">The first choice is whether nullable reference types should be on or off by default.</span></span> <span data-ttu-id="5483c-135">Você tem duas estratégias:</span><span class="sxs-lookup"><span data-stu-id="5483c-135">You have two strategies:</span></span>

- <span data-ttu-id="5483c-136">Habilite tipos de referência anulados para todo o projeto e desative-o em código que não está pronto.</span><span class="sxs-lookup"><span data-stu-id="5483c-136">Enable nullable reference types for the entire project, and disable it in code that's not ready.</span></span>
- <span data-ttu-id="5483c-137">Apenas habilite tipos de referência anulados para código que tenha sido anotado para tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="5483c-137">Only enable nullable reference types for code that's been annotated for nullable reference types.</span></span>

<span data-ttu-id="5483c-138">A primeira estratégia funciona melhor quando você está adicionando outros recursos à biblioteca à medida que você atualizá-la para tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="5483c-138">The first strategy works best when you're adding other features to the library as you update it for nullable reference types.</span></span> <span data-ttu-id="5483c-139">Todo novo desenvolvimento é anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-139">All new development is nullable aware.</span></span> <span data-ttu-id="5483c-140">Ao atualizar o código existente, você habilita tipos de referência anulados nessas classes.</span><span class="sxs-lookup"><span data-stu-id="5483c-140">As you update existing code, you enable nullable reference types in those classes.</span></span>

<span data-ttu-id="5483c-141">Seguindo esta primeira estratégia, você faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5483c-141">Following this first strategy, you do the following:</span></span>

1. <span data-ttu-id="5483c-142">Habilite tipos de referência anulados `<Nullable>enable</Nullable>` para todo o projeto adicionando o elemento aos seus arquivos *csproj.*</span><span class="sxs-lookup"><span data-stu-id="5483c-142">Enable nullable reference types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="5483c-143">Adicione `#nullable disable` o pragma a cada arquivo de origem do seu projeto.</span><span class="sxs-lookup"><span data-stu-id="5483c-143">Add the `#nullable disable` pragma to every source file in your project.</span></span>
1. <span data-ttu-id="5483c-144">Ao trabalhar em cada arquivo, remova o pragma e aborde quaisquer avisos.</span><span class="sxs-lookup"><span data-stu-id="5483c-144">As you work on each file, remove the pragma and address any warnings.</span></span>

<span data-ttu-id="5483c-145">Esta primeira estratégia tem um trabalho mais inicial para adicionar o pragma a cada arquivo.</span><span class="sxs-lookup"><span data-stu-id="5483c-145">This first strategy has more up-front work to add the pragma to every file.</span></span> <span data-ttu-id="5483c-146">A vantagem é que cada novo arquivo de código adicionado ao projeto será anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-146">The advantage is that every new code file added to the project will be nullable enabled.</span></span> <span data-ttu-id="5483c-147">Qualquer novo trabalho será anulado; apenas o código existente deve ser atualizado.</span><span class="sxs-lookup"><span data-stu-id="5483c-147">Any new work will be nullable aware; only existing code must be updated.</span></span>

<span data-ttu-id="5483c-148">A segunda estratégia funciona melhor se a biblioteca estiver geralmente estável, e o foco principal do desenvolvimento é adotar tipos de referência anulados.</span><span class="sxs-lookup"><span data-stu-id="5483c-148">The second strategy works better if the library is generally stable, and the main focus of the development is to adopt nullable reference types.</span></span> <span data-ttu-id="5483c-149">Você liga os tipos de referência anulados à medida que anota APIs.</span><span class="sxs-lookup"><span data-stu-id="5483c-149">You turn on nullable reference types as you annotate APIs.</span></span> <span data-ttu-id="5483c-150">Quando terminar, você habilita tipos de referência anulados para todo o projeto.</span><span class="sxs-lookup"><span data-stu-id="5483c-150">When you've finished, you enable nullable reference types for the entire project.</span></span>

<span data-ttu-id="5483c-151">Seguindo esta segunda estratégia você faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5483c-151">Following this second strategy you do the following:</span></span>

1. <span data-ttu-id="5483c-152">Adicione `#nullable enable` o pragma ao arquivo que você deseja tornar anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-152">Add the `#nullable enable` pragma to the file you want to make nullable aware.</span></span>
1. <span data-ttu-id="5483c-153">Dirija qualquer aviso.</span><span class="sxs-lookup"><span data-stu-id="5483c-153">Address any warnings.</span></span>
1. <span data-ttu-id="5483c-154">Continue estes dois primeiros passos até que você tenha feito toda a biblioteca anulada.</span><span class="sxs-lookup"><span data-stu-id="5483c-154">Continue these first two steps until you've made the entire library nullable aware.</span></span>
1. <span data-ttu-id="5483c-155">Habilite tipos anulados para `<Nullable>enable</Nullable>` todo o projeto adicionando o elemento aos seus arquivos *csproj.*</span><span class="sxs-lookup"><span data-stu-id="5483c-155">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="5483c-156">Remova `#nullable enable` os pragmas, já que eles não são mais necessários.</span><span class="sxs-lookup"><span data-stu-id="5483c-156">Remove the `#nullable enable` pragmas, as they're no longer needed.</span></span>

<span data-ttu-id="5483c-157">Esta segunda estratégia tem menos trabalho na frente.</span><span class="sxs-lookup"><span data-stu-id="5483c-157">This second strategy has less work up-front.</span></span> <span data-ttu-id="5483c-158">A troca é que a primeira tarefa quando você cria um novo arquivo é adicionar o pragma e torná-lo anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-158">The tradeoff is that the first task when you create a new file is to add the pragma and make it nullable aware.</span></span> <span data-ttu-id="5483c-159">Se algum desenvolvedor da sua equipe esquecer, esse novo código está agora em atraso no trabalho para tornar todo o código anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-159">If any developers on your team forget, that new code is now in the backlog of work to make all code nullable aware.</span></span>

<span data-ttu-id="5483c-160">Qual dessas estratégias você escolhe depende de quanto desenvolvimento ativo está acontecendo em seu projeto.</span><span class="sxs-lookup"><span data-stu-id="5483c-160">Which of these strategies you pick depends on how much active development is taking place in your project.</span></span> <span data-ttu-id="5483c-161">Quanto mais maduro e estável o seu projeto, melhor a segunda estratégia.</span><span class="sxs-lookup"><span data-stu-id="5483c-161">The more mature and stable your project, the better the second strategy.</span></span> <span data-ttu-id="5483c-162">Quanto mais recursos estão sendo desenvolvidos, melhor a primeira estratégia.</span><span class="sxs-lookup"><span data-stu-id="5483c-162">The more features being developed, the better the first strategy.</span></span>

## <a name="should-nullable-warnings-introduce-breaking-changes"></a><span data-ttu-id="5483c-163">Os avisos anulados devem introduzir alterações de quebra?</span><span class="sxs-lookup"><span data-stu-id="5483c-163">Should nullable warnings introduce breaking changes?</span></span>

<span data-ttu-id="5483c-164">Antes de habilitar tipos de referência anulados, as variáveis são consideradas *alheias a nulidade*.</span><span class="sxs-lookup"><span data-stu-id="5483c-164">Before you enable nullable reference types, variables are considered *nullable oblivious*.</span></span> <span data-ttu-id="5483c-165">Uma vez habilitado tipos de referência anulados, todas essas variáveis são *não anuladas*.</span><span class="sxs-lookup"><span data-stu-id="5483c-165">Once you enable nullable reference types, all those variables are *non-nullable*.</span></span> <span data-ttu-id="5483c-166">O compilador emitirá avisos se essas variáveis não forem inicializadas para valores não nulos.</span><span class="sxs-lookup"><span data-stu-id="5483c-166">The compiler will issue warnings if those variables aren't initialized to non-null values.</span></span>

<span data-ttu-id="5483c-167">Outra fonte provável de avisos são os valores de devolução quando o valor não foi inicializado.</span><span class="sxs-lookup"><span data-stu-id="5483c-167">Another likely source of warnings is return values when the value hasn't been initialized.</span></span>

<span data-ttu-id="5483c-168">O primeiro passo para abordar os avisos `?` do compilador é usar anotações em parâmetros e tipos de retorno para indicar quando argumentos ou valores de devolução podem ser nulos.</span><span class="sxs-lookup"><span data-stu-id="5483c-168">The first step in addressing the compiler warnings is to use `?` annotations on parameter and return types to indicate when arguments or return values may be null.</span></span> <span data-ttu-id="5483c-169">Quando as variáveis de referência não devem ser nulas, a declaração original está correta.</span><span class="sxs-lookup"><span data-stu-id="5483c-169">When reference variables must not be null, the original declaration is correct.</span></span> <span data-ttu-id="5483c-170">Ao fazer isso, seu objetivo não é apenas corrigir avisos.</span><span class="sxs-lookup"><span data-stu-id="5483c-170">As you do this, your goal isn't just to fix warnings.</span></span> <span data-ttu-id="5483c-171">O objetivo mais importante é fazer com que o compilador entenda sua intenção de potenciais valores nulos.</span><span class="sxs-lookup"><span data-stu-id="5483c-171">The more important goal is to make the compiler understand your intent for potential null values.</span></span> <span data-ttu-id="5483c-172">Ao examinar os avisos, você chega à sua próxima grande decisão para sua biblioteca.</span><span class="sxs-lookup"><span data-stu-id="5483c-172">As you examine the warnings, you reach your next major decision for your library.</span></span> <span data-ttu-id="5483c-173">Deseja considerar modificar assinaturas de API para comunicar mais claramente sua intenção de design?</span><span class="sxs-lookup"><span data-stu-id="5483c-173">Do you want to consider modifying API signatures to more clearly communicate your design intent?</span></span> <span data-ttu-id="5483c-174">Uma melhor assinatura de `TryGetMessage` API para o método examinado anteriormente poderia ser:</span><span class="sxs-lookup"><span data-stu-id="5483c-174">A better API signature for the `TryGetMessage` method examined earlier could be:</span></span>

```csharp
string? TryGetMessage(string key);
```

<span data-ttu-id="5483c-175">O valor de retorno indica sucesso ou falha, e carrega o valor se o valor foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="5483c-175">The return value indicates success or failure, and carries the value if the value was found.</span></span> <span data-ttu-id="5483c-176">Em muitos casos, alterar assinaturas de API pode melhorar a forma como comunicam valores nulos.</span><span class="sxs-lookup"><span data-stu-id="5483c-176">In many cases, changing API signatures can improve how they communicate null values.</span></span>

<span data-ttu-id="5483c-177">No entanto, para bibliotecas públicas ou bibliotecas com grandes bases de usuários, você pode preferir não introduzir nenhuma alteração de assinatura da API.</span><span class="sxs-lookup"><span data-stu-id="5483c-177">However, for public libraries, or libraries with large user bases, you may prefer not introducing any API signature changes.</span></span> <span data-ttu-id="5483c-178">Para esses casos e outros padrões comuns, você pode aplicar atributos `null`para definir mais claramente quando um argumento ou valor de retorno pode ser .</span><span class="sxs-lookup"><span data-stu-id="5483c-178">For those cases, and other common patterns, you can apply attributes to more clearly define when an argument or return value may be `null`.</span></span> <span data-ttu-id="5483c-179">Se você considerar ou não alterar a superfície de sua API, você provavelmente descobrirá `null` que anotações de tipo por si só não são suficientes para descrever valores para argumentos ou valores de retorno.</span><span class="sxs-lookup"><span data-stu-id="5483c-179">Whether or not you consider changing the surface of your API, you'll likely find that type annotations alone aren't sufficient for describing `null` values for arguments or return values.</span></span> <span data-ttu-id="5483c-180">Nesses casos, você pode aplicar atributos para descrever mais claramente uma API.</span><span class="sxs-lookup"><span data-stu-id="5483c-180">In those instances, you can apply attributes to more clearly describe an API.</span></span>

## <a name="attributes-extend-type-annotations"></a><span data-ttu-id="5483c-181">Atributos estendem anotações de tipo</span><span class="sxs-lookup"><span data-stu-id="5483c-181">Attributes extend type annotations</span></span>

<span data-ttu-id="5483c-182">Vários atributos foram adicionados para expressar informações adicionais sobre o estado nulo das variáveis.</span><span class="sxs-lookup"><span data-stu-id="5483c-182">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="5483c-183">Todo o código que você escreveu antes de C# 8 introduzir tipos de referência nulos foi *nulo alheio*.</span><span class="sxs-lookup"><span data-stu-id="5483c-183">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="5483c-184">Isso significa que qualquer variável de tipo de referência pode ser nula, mas verificações nulas não são necessárias.</span><span class="sxs-lookup"><span data-stu-id="5483c-184">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="5483c-185">Uma vez que seu código é *anulado ciente,* essas regras mudam.</span><span class="sxs-lookup"><span data-stu-id="5483c-185">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="5483c-186">Os tipos de `null` referência nunca devem ser o valor, e os tipos de referência anulados devem ser verificados `null` antes de serem desreferenciados.</span><span class="sxs-lookup"><span data-stu-id="5483c-186">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="5483c-187">As regras para suas APIs são provavelmente `TryGetValue` mais complicadas, como você viu com o cenário da API.</span><span class="sxs-lookup"><span data-stu-id="5483c-187">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="5483c-188">Muitas de suas APIs têm regras mais complexas para `null`quando as variáveis podem ou não ser .</span><span class="sxs-lookup"><span data-stu-id="5483c-188">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="5483c-189">Nestes casos, você usará um dos seguintes atributos para expressar essas regras:</span><span class="sxs-lookup"><span data-stu-id="5483c-189">In these cases, you'll use one of the following attributes to express those rules:</span></span>

- <span data-ttu-id="5483c-190">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): Um argumento de entrada não anulado pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-190">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="5483c-191">[DesautorizarNu:](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute)Um argumento de entrada nulo nunca deve ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-191">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>
- <span data-ttu-id="5483c-192">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): Um valor de retorno não anulado pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-192">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="5483c-193">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): Um valor de retorno nulo nunca será nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-193">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>
- <span data-ttu-id="5483c-194">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): Um argumento de entrada não anulado pode ser `bool` nulo quando o método retorna o valor especificado.</span><span class="sxs-lookup"><span data-stu-id="5483c-194">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable input argument may be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="5483c-195">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): Um argumento de entrada anulado não será `bool` nulo quando o método retornar o valor especificado.</span><span class="sxs-lookup"><span data-stu-id="5483c-195">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable input argument will not be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="5483c-196">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): Um valor de retorno não é nulo se o argumento para o parâmetro especificado não for nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-196">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the argument for the specified parameter isn't null.</span></span>

<span data-ttu-id="5483c-197">As descrições anteriores são uma referência rápida ao que cada atributo faz.</span><span class="sxs-lookup"><span data-stu-id="5483c-197">The preceding descriptions are a quick reference to what each attribute does.</span></span> <span data-ttu-id="5483c-198">Cada seção a seguir descreve o comportamento e o significado mais detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="5483c-198">Each following section describes the behavior and meaning more thoroughly.</span></span>

<span data-ttu-id="5483c-199">A adição desses atributos dá ao compilador mais informações sobre as regras para sua API.</span><span class="sxs-lookup"><span data-stu-id="5483c-199">Adding these attributes gives the compiler more information about the rules for your API.</span></span> <span data-ttu-id="5483c-200">Quando o código de chamada é compilado em um contexto ativado anulado, o compilador avisará os chamadores quando eles violarem essas regras.</span><span class="sxs-lookup"><span data-stu-id="5483c-200">When calling code is compiled in a nullable enabled context, the compiler will warn callers when they violate those rules.</span></span> <span data-ttu-id="5483c-201">Esses atributos não permitem verificações adicionais na sua implementação.</span><span class="sxs-lookup"><span data-stu-id="5483c-201">These attributes don't enable additional checks on your implementation.</span></span>

## <a name="specify-preconditions-allownull-and-disallownull"></a><span data-ttu-id="5483c-202">Especificar pré-condições: `AllowNull` e`DisallowNull`</span><span class="sxs-lookup"><span data-stu-id="5483c-202">Specify preconditions: `AllowNull` and `DisallowNull`</span></span>

<span data-ttu-id="5483c-203">Considere uma propriedade de leitura/gravação que nunca retorna `null` porque tem um valor padrão razoável.</span><span class="sxs-lookup"><span data-stu-id="5483c-203">Consider a read/write property that never returns `null` because it has a reasonable default value.</span></span> <span data-ttu-id="5483c-204">Os chamadores passam `null` para o acessório definido ao defini-lo para esse valor padrão.</span><span class="sxs-lookup"><span data-stu-id="5483c-204">Callers pass `null` to the set accessor when setting it to that default value.</span></span> <span data-ttu-id="5483c-205">Por exemplo, considere um sistema de mensagens que pede um nome de tela em uma sala de bate-papo.</span><span class="sxs-lookup"><span data-stu-id="5483c-205">For example, consider a messaging system that asks for a screen name in a chat room.</span></span> <span data-ttu-id="5483c-206">Se nenhum for fornecido, o sistema gera um nome aleatório:</span><span class="sxs-lookup"><span data-stu-id="5483c-206">If none is provided, the system generates a random name:</span></span>

```csharp
public string ScreenName
{
   get => screenName;
   set => screenName = value ?? GenerateRandomScreenName();
}
private string screenName;
```

<span data-ttu-id="5483c-207">Quando você compila o código anterior em um contexto alheio nulo, tudo está bem.</span><span class="sxs-lookup"><span data-stu-id="5483c-207">When you compile the preceding code in a nullable oblivious context, everything is fine.</span></span> <span data-ttu-id="5483c-208">Uma vez habilitado tipos `ScreenName` de referência anulados, a propriedade se torna uma referência não anulada.</span><span class="sxs-lookup"><span data-stu-id="5483c-208">Once you enable nullable reference types, the `ScreenName` property becomes a non-nullable reference.</span></span> <span data-ttu-id="5483c-209">Isso é correto `get` para o acessório: ele nunca retorna `null`.</span><span class="sxs-lookup"><span data-stu-id="5483c-209">That's correct for the `get` accessor: it never returns `null`.</span></span> <span data-ttu-id="5483c-210">Os chamadores não precisam verificar a `null`propriedade devolvida para .</span><span class="sxs-lookup"><span data-stu-id="5483c-210">Callers don't need to check the returned property for `null`.</span></span> <span data-ttu-id="5483c-211">Mas agora definir `null` a propriedade para gera um aviso.</span><span class="sxs-lookup"><span data-stu-id="5483c-211">But now setting the property to `null` generates a warning.</span></span> <span data-ttu-id="5483c-212">Para continuar a suportar esse tipo de <xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute?displayProperty=nameWithType> código, você adiciona o atributo à propriedade, conforme mostrado no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="5483c-212">In order to continue to support this type of code, you add the <xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute?displayProperty=nameWithType> attribute to the property, as shown in the following code:</span></span>

```csharp
[AllowNull]
public string ScreenName
{
   get => screenName;
   set => screenName = value ?? GenerateRandomScreenName();
}
private string screenName = GenerateRandomScreenName();
```

<span data-ttu-id="5483c-213">Você pode precisar `using` adicionar <xref:System.Diagnostics.CodeAnalysis> uma diretiva para usar este e outros atributos discutidos neste artigo.</span><span class="sxs-lookup"><span data-stu-id="5483c-213">You may need to add a `using` directive for <xref:System.Diagnostics.CodeAnalysis> to use this and other attributes discussed in this article.</span></span> <span data-ttu-id="5483c-214">O atributo é aplicado à `set` propriedade, não ao acessório.</span><span class="sxs-lookup"><span data-stu-id="5483c-214">The attribute is applied to the property, not the `set` accessor.</span></span> <span data-ttu-id="5483c-215">O `AllowNull` atributo especifica *pré-condições*e só se aplica a entradas.</span><span class="sxs-lookup"><span data-stu-id="5483c-215">The `AllowNull` attribute specifies *pre-conditions*, and only applies to inputs.</span></span> <span data-ttu-id="5483c-216">O `get` acessório tem um valor de retorno, mas sem argumentos de entrada.</span><span class="sxs-lookup"><span data-stu-id="5483c-216">The `get` accessor has a return value, but no input arguments.</span></span> <span data-ttu-id="5483c-217">Portanto, o `AllowNull` atributo só `set` se aplica ao acessório.</span><span class="sxs-lookup"><span data-stu-id="5483c-217">Therefore, the `AllowNull` attribute only applies to the `set` accessor.</span></span>

<span data-ttu-id="5483c-218">O exemplo anterior demonstra o que `AllowNull` procurar ao adicionar o atributo em um argumento:</span><span class="sxs-lookup"><span data-stu-id="5483c-218">The preceding example demonstrates what to look for when adding the `AllowNull` attribute on an argument:</span></span>

1. <span data-ttu-id="5483c-219">O contrato geral para essa variável é `null`que não deveria ser, então você quer um tipo de referência não anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-219">The general contract for that variable is that it shouldn't be `null`, so you want a non-nullable reference type.</span></span>
1. <span data-ttu-id="5483c-220">Existem cenários para a `null`variável de entrada ser , embora eles não sejam o uso mais comum.</span><span class="sxs-lookup"><span data-stu-id="5483c-220">There are scenarios for the input variable to be `null`, though they aren't the most common usage.</span></span>

<span data-ttu-id="5483c-221">Na maioria das vezes você precisará `in`deste `out`atributo para propriedades, ou , e `ref` argumentos.</span><span class="sxs-lookup"><span data-stu-id="5483c-221">Most often you'll need this attribute for properties, or `in`, `out`, and `ref` arguments.</span></span> <span data-ttu-id="5483c-222">O `AllowNull` atributo é a melhor escolha quando uma variável é `null` tipicamente não nula, mas você precisa permitir como uma pré-condição.</span><span class="sxs-lookup"><span data-stu-id="5483c-222">The `AllowNull` attribute is the best choice when a variable is typically non-null, but you need to allow `null` as a precondition.</span></span>

<span data-ttu-id="5483c-223">Contraste isso com `DisallowNull`cenários para usar : Você usa este atributo para especificar que uma variável de entrada de um tipo de referência anulada não deve ser `null`.</span><span class="sxs-lookup"><span data-stu-id="5483c-223">Contrast that with scenarios for using `DisallowNull`: You use this attribute to specify that an input variable of a nullable reference type shouldn't be `null`.</span></span> <span data-ttu-id="5483c-224">Considere um `null` imóvel onde está o valor padrão, mas os clientes só podem defini-lo como um valor não nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-224">Consider a property where `null` is the default value, but clients can only set it to a non-null value.</span></span> <span data-ttu-id="5483c-225">Considere o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="5483c-225">Consider the following code:</span></span>

```csharp
public string ReviewComment
{
    get => _comment;
    set => _comment = value ?? throw new ArgumentNullException(nameof(value), "Cannot set to null");
}
string _comment;
```

<span data-ttu-id="5483c-226">O código anterior é a melhor maneira `ReviewComment` de `null`expressar o seu design `null`que o poderia ser , mas não pode ser definido para .</span><span class="sxs-lookup"><span data-stu-id="5483c-226">The preceding code is the best way to express your design that the `ReviewComment` could be `null`, but can't be set to `null`.</span></span> <span data-ttu-id="5483c-227">Uma vez que este código esteja ciente nulo, você <xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute?displayProperty=nameWithType>pode expressar este conceito mais claramente aos chamadores usando o :</span><span class="sxs-lookup"><span data-stu-id="5483c-227">Once this code is nullable aware, you can express this concept more clearly to callers using the <xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute?displayProperty=nameWithType>:</span></span>

```csharp
[DisallowNull]
public string? ReviewComment
{
    get => _comment;
    set => _comment = value ?? throw new ArgumentNullException(nameof(value), "Cannot set to null");
}
string? _comment;
```

<span data-ttu-id="5483c-228">Em um contexto nulo, o `ReviewComment` `get` acessório `null`poderia retornar o valor padrão de .</span><span class="sxs-lookup"><span data-stu-id="5483c-228">In a nullable context, the `ReviewComment` `get` accessor could return the default value of `null`.</span></span> <span data-ttu-id="5483c-229">O compilador avisa que deve ser verificado antes do acesso.</span><span class="sxs-lookup"><span data-stu-id="5483c-229">The compiler warns that it must be checked before access.</span></span> <span data-ttu-id="5483c-230">Além disso, ele adverte os chamadores `null`que, embora possa ser, os `null`chamadores não devem explicitamente defini-lo para .</span><span class="sxs-lookup"><span data-stu-id="5483c-230">Furthermore, it warns callers that, even though it could be `null`, callers shouldn't explicitly set it to `null`.</span></span> <span data-ttu-id="5483c-231">O `DisallowNull` atributo também especifica uma *pré-condição,* não afeta o `get` acessório.</span><span class="sxs-lookup"><span data-stu-id="5483c-231">The `DisallowNull` attribute also specifies a *pre-condition*, it does not affect the `get` accessor.</span></span> <span data-ttu-id="5483c-232">Você deve optar `DisallowNull` por usar o atributo ao observar essas características sobre:</span><span class="sxs-lookup"><span data-stu-id="5483c-232">You should choose to use the `DisallowNull` attribute when you observe these characteristics about:</span></span>

1. <span data-ttu-id="5483c-233">A variável `null` pode estar em cenários centrais, muitas vezes quando instanciado pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="5483c-233">The variable could be `null` in core scenarios, often when first instantiated.</span></span>
1. <span data-ttu-id="5483c-234">A variável não deve ser `null`explicitamente definida para .</span><span class="sxs-lookup"><span data-stu-id="5483c-234">The variable shouldn't be explicitly set to `null`.</span></span>

<span data-ttu-id="5483c-235">Essas situações são comuns em códigos que originalmente *eram nulos.*</span><span class="sxs-lookup"><span data-stu-id="5483c-235">These situations are common in code that was originally *null oblivious*.</span></span> <span data-ttu-id="5483c-236">Pode ser que as propriedades do objeto sejam definidas em duas operações de inicialização distintas.</span><span class="sxs-lookup"><span data-stu-id="5483c-236">It may be that object properties are set in two distinct initialization operations.</span></span> <span data-ttu-id="5483c-237">Pode ser que algumas propriedades sejam definidas somente após algum trabalho assíncrono ter sido concluído.</span><span class="sxs-lookup"><span data-stu-id="5483c-237">It may be that some properties are set only after some asynchronous work has completed.</span></span>

<span data-ttu-id="5483c-238">Os `AllowNull` `DisallowNull` atributos permitem especificar que as pré-condições nas variáveis podem não corresponder às anotações anuladas nessas variáveis.</span><span class="sxs-lookup"><span data-stu-id="5483c-238">The `AllowNull` and `DisallowNull` attributes enable you to specify that preconditions on variables may not match the nullable annotations on those variables.</span></span> <span data-ttu-id="5483c-239">Estes fornecem mais detalhes sobre as características de sua API.</span><span class="sxs-lookup"><span data-stu-id="5483c-239">These provide more detail about the characteristics of your API.</span></span> <span data-ttu-id="5483c-240">Essas informações adicionais ajudam os chamadores a usar sua API corretamente.</span><span class="sxs-lookup"><span data-stu-id="5483c-240">This additional information helps callers use your API correctly.</span></span> <span data-ttu-id="5483c-241">Lembre-se de especificar pré-condições usando os seguintes atributos:</span><span class="sxs-lookup"><span data-stu-id="5483c-241">Remember you specify preconditions using the following attributes:</span></span>

- <span data-ttu-id="5483c-242">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): Um argumento de entrada não anulado pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-242">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="5483c-243">[DesautorizarNu:](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute)Um argumento de entrada nulo nunca deve ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-243">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>

## <a name="specify-post-conditions-maybenull-and-notnull"></a><span data-ttu-id="5483c-244">Especificar pós-condições: `MaybeNull` e`NotNull`</span><span class="sxs-lookup"><span data-stu-id="5483c-244">Specify post-conditions: `MaybeNull` and `NotNull`</span></span>

<span data-ttu-id="5483c-245">Suponha que você tenha um método com a seguinte assinatura:</span><span class="sxs-lookup"><span data-stu-id="5483c-245">Suppose you have a method with the following signature:</span></span>

```csharp
public Customer FindCustomer(string lastName, string firstName)
```

<span data-ttu-id="5483c-246">Você provavelmente escreveu um método `null` como este para retornar quando o nome procurado não foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="5483c-246">You've likely written a method like this to return `null` when the name sought wasn't found.</span></span> <span data-ttu-id="5483c-247">O `null` registro indica que o registro não foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="5483c-247">The `null` clearly indicates that the record wasn't found.</span></span> <span data-ttu-id="5483c-248">Neste exemplo, você provavelmente mudaria o `Customer` `Customer?`tipo de retorno de .</span><span class="sxs-lookup"><span data-stu-id="5483c-248">In this example, you'd likely change the return type from `Customer` to `Customer?`.</span></span> <span data-ttu-id="5483c-249">Declarar o valor de retorno como um tipo de referência anulado especifica claramente a intenção desta API.</span><span class="sxs-lookup"><span data-stu-id="5483c-249">Declaring the return value as a nullable reference type specifies the intent of this API clearly.</span></span>

<span data-ttu-id="5483c-250">Por razões cobertas por [definições genéricas e nulidade](#generic-definitions-and-nullability) essa técnica não funciona com métodos genéricos.</span><span class="sxs-lookup"><span data-stu-id="5483c-250">For reasons covered under [Generic definitions and nullability](#generic-definitions-and-nullability) that technique does not work with generic methods.</span></span> <span data-ttu-id="5483c-251">Você pode ter um método genérico que segue um padrão semelhante:</span><span class="sxs-lookup"><span data-stu-id="5483c-251">You may have a generic method that follows a similar pattern:</span></span>

```csharp
public T Find<T>(IEnumerable<T> sequence, Func<T, bool> match)
```

<span data-ttu-id="5483c-252">Você não pode especificar que `T?`o valor de retorno é .</span><span class="sxs-lookup"><span data-stu-id="5483c-252">You can't specify that the return value is `T?`.</span></span> <span data-ttu-id="5483c-253">O método `null` retorna quando o item procurado não é encontrado.</span><span class="sxs-lookup"><span data-stu-id="5483c-253">The method returns `null` when the sought item isn't found.</span></span> <span data-ttu-id="5483c-254">Como você não pode `T?` declarar um tipo `MaybeNull` de retorno, você adiciona a anotação ao retorno do método:</span><span class="sxs-lookup"><span data-stu-id="5483c-254">Since you can't declare a `T?` return type, you add the `MaybeNull` annotation to the method return:</span></span>

```csharp
[return: MaybeNull]
public T Find<T>(IEnumerable<T> sequence, Func<T, bool> match)
```

<span data-ttu-id="5483c-255">O código precedente informa aos chamadores que o contrato implica um tipo não anulado, mas o valor de devolução *pode* realmente ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-255">The preceding code informs callers that the contract implies a non-nullable type, but the return value *may* actually be null.</span></span>  <span data-ttu-id="5483c-256">Use `MaybeNull` o atributo quando sua API deve ser um tipo não anulado, tipicamente `null` um parâmetro de tipo genérico, mas pode haver casos em que a Sua API seria devolvida.</span><span class="sxs-lookup"><span data-stu-id="5483c-256">Use the `MaybeNull` attribute when your API should be a non-nullable type, typically a generic type parameter, but there may be instances where `null` would be returned.</span></span>

<span data-ttu-id="5483c-257">Você também pode especificar que `out` `ref` um valor de retorno ou um argumento ou argumento não é nulo, mesmo que o tipo seja um tipo de referência anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-257">You can also specify that a return value or an `out` or `ref` argument isn't null even though the type is a nullable reference type.</span></span> <span data-ttu-id="5483c-258">Considere um método que garanta que uma matriz seja grande o suficiente para conter uma série de elementos.</span><span class="sxs-lookup"><span data-stu-id="5483c-258">Consider a method that ensures an array is large enough to hold a number of elements.</span></span> <span data-ttu-id="5483c-259">Se o argumento de entrada não tiver capacidade, a rotina alocaria uma nova matriz e copiaria todos os elementos existentes nele.</span><span class="sxs-lookup"><span data-stu-id="5483c-259">If the input argument doesn't have capacity, the routine would allocate a new array and copy all the existing elements into it.</span></span> <span data-ttu-id="5483c-260">Se o argumento `null`de entrada for, a rotina alocaria um novo armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5483c-260">If the input argument is `null`, the routine would allocate new storage.</span></span> <span data-ttu-id="5483c-261">Se há capacidade suficiente, a rotina não faz nada:</span><span class="sxs-lookup"><span data-stu-id="5483c-261">If there's sufficient capacity, the routine does nothing:</span></span>

```csharp
public void EnsureCapacity<T>(ref T[] storage, int size)
```

<span data-ttu-id="5483c-262">Você pode chamar essa rotina da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="5483c-262">You could call this routine as follows:</span></span>

```csharp
// messages has the default value (null) when EnsureCapacity is called:
EnsureCapacity<string>(ref messages, 10);
// messages is not null.
EnsureCapacity<string>(messages, 50);
```

<span data-ttu-id="5483c-263">Depois de habilitar tipos de referência nulos, você deseja garantir que o código anterior seja compilado sem avisos.</span><span class="sxs-lookup"><span data-stu-id="5483c-263">After enabling null reference types, you want to ensure that the preceding code compiles without warnings.</span></span> <span data-ttu-id="5483c-264">Quando o método `storage` retorna, o argumento é garantido não ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-264">When the method returns, the `storage` argument is guaranteed to be not null.</span></span> <span data-ttu-id="5483c-265">No entanto, é aceitável `EnsureCapacity` ligar com uma referência nula.</span><span class="sxs-lookup"><span data-stu-id="5483c-265">However, it's acceptable to call `EnsureCapacity` with a null reference.</span></span> <span data-ttu-id="5483c-266">Você pode `storage` fazer um tipo de `NotNull` referência anulada e adicionar a pós-condição à declaração de parâmetro:</span><span class="sxs-lookup"><span data-stu-id="5483c-266">You can make `storage` a nullable reference type, and add the `NotNull` post-condition to the parameter declaration:</span></span>

```csharp
public void EnsureCapacity<T>([NotNull]ref T[]? storage, int size)
```

<span data-ttu-id="5483c-267">O código anterior expressa o contrato existente muito claramente: `null` os chamadores podem passar uma variável com o valor, mas o valor de retorno é garantido para nunca ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-267">The preceding code expresses the existing contract very clearly: Callers can pass a variable with the `null` value, but the return value is guaranteed to never be null.</span></span> <span data-ttu-id="5483c-268">O `NotNull` atributo é `ref` `out` mais útil `null` para e argumentos onde pode ser passado como argumento, mas esse argumento é garantido não ser nulo quando o método retorna.</span><span class="sxs-lookup"><span data-stu-id="5483c-268">The `NotNull` attribute is most useful for `ref` and `out` arguments where `null` may be passed as an argument, but that argument is guaranteed to be not null when the method returns.</span></span>

<span data-ttu-id="5483c-269">Você especifica postcondições incondicionais usando os seguintes atributos:</span><span class="sxs-lookup"><span data-stu-id="5483c-269">You specify unconditional postconditions using the following attributes:</span></span>

- <span data-ttu-id="5483c-270">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): Um valor de retorno não anulado pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-270">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="5483c-271">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): Um valor de retorno nulo nunca será nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-271">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>

## <a name="specify-conditional-post-conditions-notnullwhen-maybenullwhen-and-notnullifnotnull"></a><span data-ttu-id="5483c-272">Especificar pós-condições `NotNullWhen`condicionais: , `MaybeNullWhen`e`NotNullIfNotNull`</span><span class="sxs-lookup"><span data-stu-id="5483c-272">Specify conditional post-conditions: `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull`</span></span>

<span data-ttu-id="5483c-273">Você provavelmente está `string` familiarizado <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType>com o método.</span><span class="sxs-lookup"><span data-stu-id="5483c-273">You're likely familiar with the `string` method <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType>.</span></span> <span data-ttu-id="5483c-274">Este método `true` retorna quando o argumento é nulo ou uma seqüência vazia.</span><span class="sxs-lookup"><span data-stu-id="5483c-274">This method returns `true` when the argument is null or an empty string.</span></span> <span data-ttu-id="5483c-275">É uma forma de verificação nula: os chamadores não precisam verificar `false`nulo o argumento se o método retornar .</span><span class="sxs-lookup"><span data-stu-id="5483c-275">It's a form of null-check: Callers don't need to null-check the argument if the method returns `false`.</span></span> <span data-ttu-id="5483c-276">Para tornar um método como este anulado, você definiria o argumento para `NotNullWhen` um tipo de referência anulado e adicionaria o atributo:</span><span class="sxs-lookup"><span data-stu-id="5483c-276">To make a method like this nullable aware, you'd set the argument to a nullable reference type, and add the `NotNullWhen` attribute:</span></span>

```csharp
bool IsNullOrEmpty([NotNullWhen(false)]string? value);
```

<span data-ttu-id="5483c-277">Isso informa o compilador de que qualquer `false` código onde o valor de devolução é não precisa ser verificado nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-277">That informs the compiler that any code where the return value is `false` need not be null-checked.</span></span> <span data-ttu-id="5483c-278">A adição do atributo informa a análise `IsNullOrEmpty` estática do compilador `false`que realiza a `null`verificação nula necessária: quando ele retorna, o argumento de entrada não é .</span><span class="sxs-lookup"><span data-stu-id="5483c-278">The addition of the attribute informs the compiler's static analysis that `IsNullOrEmpty` performs the necessary null check: when it returns `false`, the input argument is not `null`.</span></span>

```csharp
string? userInput = GetUserInput();
if (!string.IsNullOrEmpty(userInput))
{
   int messageLength = userInput.Length; // no null check needed.
}
// null check needed on userInput here.
```

<span data-ttu-id="5483c-279">O <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> método será anotado conforme mostrado acima para .NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="5483c-279">The <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> method will be annotated as shown above for .NET Core 3.0.</span></span> <span data-ttu-id="5483c-280">Você pode ter métodos semelhantes em sua base de código que verificam o estado dos objetos em busca de valores nulos.</span><span class="sxs-lookup"><span data-stu-id="5483c-280">You may have similar methods in your codebase that check the state of objects for null values.</span></span> <span data-ttu-id="5483c-281">O compilador não reconhecerá métodos de verificação nulas personalizados, e você precisará adicionar as anotações você mesmo.</span><span class="sxs-lookup"><span data-stu-id="5483c-281">The compiler won't recognize custom null check methods, and you'll need to add the annotations yourself.</span></span> <span data-ttu-id="5483c-282">Quando você adiciona o atributo, a análise estática do compilador sabe quando a variável testada foi verificada.</span><span class="sxs-lookup"><span data-stu-id="5483c-282">When you add the attribute, the compiler's static analysis knows when the tested variable has been null checked.</span></span>

<span data-ttu-id="5483c-283">Outro uso para esses `Try*` atributos é o padrão.</span><span class="sxs-lookup"><span data-stu-id="5483c-283">Another use for these attributes is the `Try*` pattern.</span></span> <span data-ttu-id="5483c-284">As condições `ref` e `out` variáveis são comunicadas através do valor de retorno.</span><span class="sxs-lookup"><span data-stu-id="5483c-284">The postconditions for `ref` and `out` variables are communicated through the return value.</span></span> <span data-ttu-id="5483c-285">Considere este método mostrado anteriormente:</span><span class="sxs-lookup"><span data-stu-id="5483c-285">Consider this method shown earlier:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="5483c-286">O método anterior segue um idioma típico .NET: `message` o valor de retorno indica se foi definido como valor encontrado ou, se nenhuma mensagem for encontrada, para o valor padrão.</span><span class="sxs-lookup"><span data-stu-id="5483c-286">The preceding method follows a typical .NET idiom: the return value indicates if `message` was set to the found value or, if no message is found, to the default value.</span></span> <span data-ttu-id="5483c-287">Se o `true`método retornar, `message` o valor de não é nulo; caso contrário, o `message` método define como nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-287">If the method returns `true`, the value of `message` isn't null; otherwise, the method sets `message` to null.</span></span>

<span data-ttu-id="5483c-288">Você pode comunicar esse `NotNullWhen` idioma usando o atributo.</span><span class="sxs-lookup"><span data-stu-id="5483c-288">You can communicate that idiom using the `NotNullWhen` attribute.</span></span> <span data-ttu-id="5483c-289">Quando você atualizar a assinatura para `message` tipos `string?` de referência anulados, faça a e adicione um atributo:</span><span class="sxs-lookup"><span data-stu-id="5483c-289">When you update the signature for nullable reference types, make `message` a `string?` and add an attribute:</span></span>

```csharp
bool TryGetMessage(string key, [NotNullWhen(true)] out string? message)
```

<span data-ttu-id="5483c-290">No exemplo anterior, sabe-se que o valor de `message` não é nulo quando `TryGetMessage` retorna. `true`</span><span class="sxs-lookup"><span data-stu-id="5483c-290">In the preceding example, the value of `message` is known to be not null when `TryGetMessage` returns `true`.</span></span> <span data-ttu-id="5483c-291">Você deve anotar métodos semelhantes em sua base de código `null`da mesma forma: os argumentos `true`podem ser , e são conhecidos por não serem nulos quando o método retorna .</span><span class="sxs-lookup"><span data-stu-id="5483c-291">You should annotate similar methods in your codebase in the same way: the arguments could be `null`, and are known to be not null when the method returns `true`.</span></span>

<span data-ttu-id="5483c-292">Há um atributo final que você também pode precisar.</span><span class="sxs-lookup"><span data-stu-id="5483c-292">There's one final attribute you may also need.</span></span> <span data-ttu-id="5483c-293">Às vezes, o estado nulo de um valor de retorno depende do estado nulo de um ou mais argumentos de entrada.</span><span class="sxs-lookup"><span data-stu-id="5483c-293">Sometimes the null state of a return value depends on the null state of one or more input arguments.</span></span> <span data-ttu-id="5483c-294">Esses métodos retornarão um valor não nulo sempre `null`que determinados argumentos de entrada não forem .</span><span class="sxs-lookup"><span data-stu-id="5483c-294">These methods will return a non-null value whenever certain input arguments aren't `null`.</span></span> <span data-ttu-id="5483c-295">Para anotar corretamente esses métodos, `NotNullIfNotNull` você usa o atributo.</span><span class="sxs-lookup"><span data-stu-id="5483c-295">To correctly annotate these methods, you use the `NotNullIfNotNull` attribute.</span></span> <span data-ttu-id="5483c-296">Considere o seguinte método:</span><span class="sxs-lookup"><span data-stu-id="5483c-296">Consider the following method:</span></span>

```csharp
string GetTopLevelDomainFromFullUrl(string url);
```

<span data-ttu-id="5483c-297">Se `url` o argumento não é nulo, `null`a saída não é .</span><span class="sxs-lookup"><span data-stu-id="5483c-297">If the `url` argument isn't null, the output isn't `null`.</span></span> <span data-ttu-id="5483c-298">Uma vez que as referências anuladas são habilitadas, essa assinatura funciona corretamente, desde que sua API nunca aceite uma entrada nula.</span><span class="sxs-lookup"><span data-stu-id="5483c-298">Once nullable references are enabled, that signature works correctly, provided your API never accepts a null input.</span></span> <span data-ttu-id="5483c-299">No entanto, se a entrada pode ser nula, então o valor de devolução também pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-299">However, if the input could be null, then return value could also be null.</span></span> <span data-ttu-id="5483c-300">Portanto, você pode alterar a assinatura para o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="5483c-300">Therefore, you could change the signature to the following code:</span></span>

```csharp
string? GetTopLevelDomainFromFullUrl(string? url);
```

<span data-ttu-id="5483c-301">Isso também funciona, mas muitas vezes `null` forçará os chamadores a implementar verificações extras.</span><span class="sxs-lookup"><span data-stu-id="5483c-301">That also works, but will often force callers to implement extra `null` checks.</span></span> <span data-ttu-id="5483c-302">O contrato é que o `null` valor de `url` retorno `null`seria apenas quando o argumento de entrada é .</span><span class="sxs-lookup"><span data-stu-id="5483c-302">The contract is that the return value would be `null` only when the input argument `url` is `null`.</span></span> <span data-ttu-id="5483c-303">Para expressar esse contrato, você anotaria este método como mostrado no seguinte código:</span><span class="sxs-lookup"><span data-stu-id="5483c-303">To express that contract, you would annotate this method as shown in the following code:</span></span>

```csharp
[return: NotNullIfNotNull("url")]
string? GetTopLevelDomainFromFullUrl(string? url);
```

<span data-ttu-id="5483c-304">O valor de devolução e o argumento `?` foram ambos anotados com a indicação de que qualquer um poderia ser `null`.</span><span class="sxs-lookup"><span data-stu-id="5483c-304">The return value and the argument have both been annotated with the `?` indicating that either could be `null`.</span></span> <span data-ttu-id="5483c-305">O atributo esclarece ainda que o valor de `url` retorno não `null`será nulo quando o argumento não for .</span><span class="sxs-lookup"><span data-stu-id="5483c-305">The attribute further clarifies that the return value won't be null when the `url` argument isn't `null`.</span></span>

<span data-ttu-id="5483c-306">Você especifica postcondições condicionais usando esses atributos:</span><span class="sxs-lookup"><span data-stu-id="5483c-306">You specify conditional postconditions using these attributes:</span></span>

- <span data-ttu-id="5483c-307">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): Um argumento de entrada não anulado pode ser `bool` nulo quando o método retorna o valor especificado.</span><span class="sxs-lookup"><span data-stu-id="5483c-307">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable input argument may be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="5483c-308">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): Um argumento de entrada anulado não será `bool` nulo quando o método retornar o valor especificado.</span><span class="sxs-lookup"><span data-stu-id="5483c-308">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable input argument will not be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="5483c-309">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): Um valor de retorno não é nulo se o argumento de entrada para o parâmetro especificado não for nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-309">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>

## <a name="generic-definitions-and-nullability"></a><span data-ttu-id="5483c-310">Definições genéricas e nulidade</span><span class="sxs-lookup"><span data-stu-id="5483c-310">Generic definitions and nullability</span></span>

<span data-ttu-id="5483c-311">Comunicar corretamente o estado nulo de tipos genéricos e métodos genéricos requer cuidados especiais.</span><span class="sxs-lookup"><span data-stu-id="5483c-311">Correctly communicating the null state of generic types and generic methods requires special care.</span></span> <span data-ttu-id="5483c-312">Isso decorre do fato de que um tipo de valor anulado e um tipo de referência anulado são fundamentalmente diferentes.</span><span class="sxs-lookup"><span data-stu-id="5483c-312">This stems from the fact that a nullable value type and a nullable reference type are fundamentally different.</span></span> <span data-ttu-id="5483c-313">Um `int?` é um `Nullable<int>`sinônimo `string?` de `string` , enquanto é com um atributo adicionado pelo compilador.</span><span class="sxs-lookup"><span data-stu-id="5483c-313">An `int?` is a synonym for `Nullable<int>`, whereas `string?` is `string` with an attribute added by the compiler.</span></span> <span data-ttu-id="5483c-314">O resultado é que o compilador não `T?` pode gerar `T` código `class` correto `struct`para sem saber se é um ou um .</span><span class="sxs-lookup"><span data-stu-id="5483c-314">The result is that the compiler can't generate correct code for `T?` without knowing if `T` is a `class` or a `struct`.</span></span>

<span data-ttu-id="5483c-315">Isso não significa que você não pode usar um tipo de valor (tipo de valor ou tipo de referência) como o argumento de tipo para um tipo genérico fechado.</span><span class="sxs-lookup"><span data-stu-id="5483c-315">This doesn't mean you can't use a nullable type (either value type or reference type) as the type argument for a closed generic type.</span></span> <span data-ttu-id="5483c-316">Ambos `List<string?>` `List<int?>` são instanciações `List<T>`válidas de .</span><span class="sxs-lookup"><span data-stu-id="5483c-316">Both `List<string?>` and `List<int?>` are valid instantiations of `List<T>`.</span></span>

<span data-ttu-id="5483c-317">O que isso significa é que `T?` você não pode usar em uma classe genérica ou declaração de método sem restrições.</span><span class="sxs-lookup"><span data-stu-id="5483c-317">What it does mean is that you can't use `T?` in a generic class or method declaration without constraints.</span></span> <span data-ttu-id="5483c-318">Por exemplo, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> não será alterado `T?`para retornar .</span><span class="sxs-lookup"><span data-stu-id="5483c-318">For example, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> won't be changed to return `T?`.</span></span> <span data-ttu-id="5483c-319">Você pode superar essa limitação adicionando ou a `struct` `class` restrição.</span><span class="sxs-lookup"><span data-stu-id="5483c-319">You can overcome this limitation by adding either the `struct` or `class` constraint.</span></span> <span data-ttu-id="5483c-320">Com qualquer uma dessas restrições, o compilador sabe `T` `T?`como gerar código para ambos e .</span><span class="sxs-lookup"><span data-stu-id="5483c-320">With either of those constraints, the compiler knows how to generate code for both `T` and `T?`.</span></span>

<span data-ttu-id="5483c-321">Você pode querer restringir os tipos usados para um argumento de tipo genérico para serem tipos não anulados.</span><span class="sxs-lookup"><span data-stu-id="5483c-321">You may want to restrict the types used for a generic type argument to be non-nullable types.</span></span> <span data-ttu-id="5483c-322">Você pode fazer isso `notnull` adicionando a restrição nesse argumento de tipo.</span><span class="sxs-lookup"><span data-stu-id="5483c-322">You can do that by adding the `notnull` constraint on that type argument.</span></span> <span data-ttu-id="5483c-323">Quando essa restrição é aplicada, o argumento do tipo não deve ser um tipo anulado.</span><span class="sxs-lookup"><span data-stu-id="5483c-323">When that constraint is applied, the type argument must not be a nullable type.</span></span>

## <a name="conclusions"></a><span data-ttu-id="5483c-324">Conclusões</span><span class="sxs-lookup"><span data-stu-id="5483c-324">Conclusions</span></span>

<span data-ttu-id="5483c-325">Adicionar tipos de referência anulados fornece um vocabulário inicial para descrever `null`suas expectativas de APIs para variáveis que poderiam ser .</span><span class="sxs-lookup"><span data-stu-id="5483c-325">Adding nullable reference types provides an initial vocabulary to describe your APIs expectations for variables that could be `null`.</span></span> <span data-ttu-id="5483c-326">Os atributos adicionais fornecem um vocabulário mais rico para descrever o estado nulo das variáveis como pré-condições e pós-condições.</span><span class="sxs-lookup"><span data-stu-id="5483c-326">The additional attributes provide a richer vocabulary to describe the null state of variables as preconditions and postconditions.</span></span> <span data-ttu-id="5483c-327">Esses atributos descrevem mais claramente suas expectativas e fornecem uma melhor experiência para os desenvolvedores que usam suas APIs.</span><span class="sxs-lookup"><span data-stu-id="5483c-327">These attributes more clearly describe your expectations and provide a better experience for the developers using your APIs.</span></span>

<span data-ttu-id="5483c-328">À medida que você atualiza bibliotecas para um contexto anulado, adicione esses atributos para orientar os usuários de suas APIs ao uso correto.</span><span class="sxs-lookup"><span data-stu-id="5483c-328">As you update libraries for a nullable context, add these attributes to guide users of your APIs to the correct usage.</span></span> <span data-ttu-id="5483c-329">Esses atributos ajudam a descrever completamente o estado nulo dos argumentos de entrada e valores de retorno:</span><span class="sxs-lookup"><span data-stu-id="5483c-329">These attributes help you fully describe the null-state of input arguments and return values:</span></span>

- <span data-ttu-id="5483c-330">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): Um argumento de entrada não anulado pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-330">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="5483c-331">[DesautorizarNu:](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute)Um argumento de entrada nulo nunca deve ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-331">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>
- <span data-ttu-id="5483c-332">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): Um valor de retorno não anulado pode ser nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-332">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="5483c-333">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): Um valor de retorno nulo nunca será nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-333">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>
- <span data-ttu-id="5483c-334">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): Um argumento de entrada não anulado pode ser `bool` nulo quando o método retorna o valor especificado.</span><span class="sxs-lookup"><span data-stu-id="5483c-334">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable input argument may be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="5483c-335">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): Um argumento de entrada anulado não será `bool` nulo quando o método retornar o valor especificado.</span><span class="sxs-lookup"><span data-stu-id="5483c-335">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable input argument will not be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="5483c-336">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): Um valor de retorno não é nulo se o argumento de entrada para o parâmetro especificado não for nulo.</span><span class="sxs-lookup"><span data-stu-id="5483c-336">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>
