---
title: Programação assíncrona em C#
description: Uma visão geral do suporte de linguagem C# para programação assíncrona usando async, await, Task e Task<T>
ms.date: 06/04/2020
ms.openlocfilehash: 992ccd3a015653ea9ee13dfc309d47711ad0fca4
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85619709"
---
# <a name="asynchronous-programming-with-async-and-await"></a><span data-ttu-id="e2a4c-103">Programação assíncrona com async e await</span><span class="sxs-lookup"><span data-stu-id="e2a4c-103">Asynchronous programming with async and await</span></span>

<span data-ttu-id="e2a4c-104">O [modelo de programação assíncrona de tarefa (TAP)](task-asynchronous-programming-model.md) fornece uma abstração sobre código assíncrono.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-104">The [Task asynchronous programming model (TAP)](task-asynchronous-programming-model.md) provides an abstraction over asynchronous code.</span></span> <span data-ttu-id="e2a4c-105">Você escreve o código como uma sequência de instruções, como usual.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-105">You write code as a sequence of statements, just like always.</span></span> <span data-ttu-id="e2a4c-106">Você pode ler o código como se cada instrução fosse concluída antes do início da próxima.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-106">You can read that code as though each statement completes before the next begins.</span></span> <span data-ttu-id="e2a4c-107">O compilador realiza uma série de transformações, porque algumas dessas instruções podem iniciar o trabalho e retornar um <xref:System.Threading.Tasks.Task> que representa o trabalho em andamento.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-107">The compiler performs a number of transformations because some of those statements may start work and return a <xref:System.Threading.Tasks.Task> that represents the ongoing work.</span></span>

<span data-ttu-id="e2a4c-108">Essa é a meta dessa sintaxe: habilitar um código que leia como uma sequência de instruções, mas que execute em uma ordem muito mais complicada com base na alocação de recurso externo e em quando as tarefas são concluídas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-108">That's the goal of this syntax: enable code that reads like a sequence of statements, but executes in a much more complicated order based on external resource allocation and when tasks complete.</span></span> <span data-ttu-id="e2a4c-109">Isso é semelhante à maneira como as pessoas dão instruções para processos que incluem tarefas assíncronas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-109">It's analogous to how people give instructions for processes that include asynchronous tasks.</span></span> <span data-ttu-id="e2a4c-110">Ao longo deste artigo, você usará um exemplo de instruções para fazer uma café de manhã para ver como as `async` palavras-chave e facilitam o `await` motivo do código, que inclui uma série de instruções assíncronas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-110">Throughout this article, you'll use an example of instructions for making a breakfast to see how the `async` and `await` keywords make it easier to reason about code, that includes a series of asynchronous instructions.</span></span> <span data-ttu-id="e2a4c-111">Você deve escrever as instruções de maneira parecida com a lista a seguir para explicar como fazer um café da manhã:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-111">You'd write the instructions something like the following list to explain how to make a breakfast:</span></span>

1. <span data-ttu-id="e2a4c-112">Encher uma xícara de café.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-112">Pour a cup of coffee.</span></span>
1. <span data-ttu-id="e2a4c-113">Aquecer uma frigideira e, em seguida, fritar dois ovos.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-113">Heat up a pan, then fry two eggs.</span></span>
1. <span data-ttu-id="e2a4c-114">Frita três fatias de bacon.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-114">Fry three slices of bacon.</span></span>
1. <span data-ttu-id="e2a4c-115">Torrar dois pedaços de pão.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-115">Toast two pieces of bread.</span></span>
1. <span data-ttu-id="e2a4c-116">Adicionar manteiga e a geleia na torrada.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-116">Add butter and jam to the toast.</span></span>
1. <span data-ttu-id="e2a4c-117">Encher um copo com suco de laranja.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-117">Pour a glass of orange juice.</span></span>

<span data-ttu-id="e2a4c-118">Se tivesse experiência em culinária, você executaria essas instruções **assincronamente**.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-118">If you have experience with cooking, you'd execute those instructions **asynchronously**.</span></span> <span data-ttu-id="e2a4c-119">Você iniciaria aquecendo a frigideira para os ovos e, em seguida, começaria a preparar o bacon.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-119">You'd start warming the pan for eggs, then start the bacon.</span></span> <span data-ttu-id="e2a4c-120">Você colocaria o pão na torradeira e começaria a preparar os ovos.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-120">You'd put the bread in the toaster, then start the eggs.</span></span> <span data-ttu-id="e2a4c-121">Em cada etapa do processo, iniciaria uma tarefa e voltaria sua atenção para as tarefas que estivessem prontas para a sua atenção.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-121">At each step of the process, you'd start a task, then turn your attention to tasks that are ready for your attention.</span></span>

<span data-ttu-id="e2a4c-122">Preparar o café da manhã é um bom exemplo de trabalho assíncrono que não é paralelo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-122">Cooking breakfast is a good example of asynchronous work that isn't parallel.</span></span> <span data-ttu-id="e2a4c-123">Uma pessoa (ou um thread) pode lidar com todas essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-123">One person (or thread) can handle all these tasks.</span></span> <span data-ttu-id="e2a4c-124">Continuando com a analogia do café da manhã, uma pessoa pode fazer café da manhã assincronamente iniciando a tarefa seguinte antes de concluir a primeira.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-124">Continuing the breakfast analogy, one person can make breakfast asynchronously by starting the next task before the first completes.</span></span> <span data-ttu-id="e2a4c-125">O preparo progride independentemente de haver alguém observando.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-125">The cooking progresses whether or not someone is watching it.</span></span> <span data-ttu-id="e2a4c-126">Assim que inicia o aquecimento da frigideira para os ovos, você pode começar a fritar o bacon.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-126">As soon as you start warming the pan for the eggs, you can begin frying the bacon.</span></span> <span data-ttu-id="e2a4c-127">Quando começar a preparar o bacon, você pode colocar o pão na torradeira.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-127">Once the bacon starts, you can put the bread into the toaster.</span></span>

<span data-ttu-id="e2a4c-128">Para um algoritmo paralelo, você precisaria de vários cozinheiros (ou threads).</span><span class="sxs-lookup"><span data-stu-id="e2a4c-128">For a parallel algorithm, you'd need multiple cooks (or threads).</span></span> <span data-ttu-id="e2a4c-129">Um prepararia os ovos, outro o bacon e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-129">One would make the eggs, one the bacon, and so on.</span></span> <span data-ttu-id="e2a4c-130">Cada um se concentraria apenas naquela tarefa específica.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-130">Each one would be focused on just that one task.</span></span> <span data-ttu-id="e2a4c-131">Cada cozinheiro (ou thread) ficaria bloqueado de forma síncrona, esperando que o bacon estivesse pronto para ser virado ou que a torrada pulasse.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-131">Each cook (or thread) would be blocked synchronously waiting for bacon to be ready to flip, or the toast to pop.</span></span>

<span data-ttu-id="e2a4c-132">Agora, considere essas mesmas instruções escritas como instruções em C#:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-132">Now, consider those same instructions written as C# statements:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-starter/Program.cs" highlight="8-27":::

:::image type="content" source="media/synchronous-breakfast.png" alt-text="café de manhã síncrono":::

<span data-ttu-id="e2a4c-134">O café de manhã preparado de forma síncrona levou aproximadamente 30 minutos porque o total é a soma de cada tarefa individual.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-134">The synchronously prepared breakfast, took roughly 30 minutes because the total is the sum of each individual task.</span></span>

> [!NOTE]
> <span data-ttu-id="e2a4c-135">As `Coffee` `Egg` classes,, `Bacon` , `Toast` e `Juice` estão vazias.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-135">The `Coffee`, `Egg`, `Bacon`, `Toast`, and `Juice` classes are empty.</span></span> <span data-ttu-id="e2a4c-136">Eles são simplesmente classes de marcador para fins de demonstração, não contêm propriedades e não servem para nenhuma outra finalidade.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-136">They are simply marker classes for the purpose of demonstration, contain no properties, and serve no other purpose.</span></span>

<span data-ttu-id="e2a4c-137">Os computadores não interpretam essas instruções da mesma forma que as pessoas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-137">Computers don't interpret those instructions the same way people do.</span></span> <span data-ttu-id="e2a4c-138">O computador ficará bloqueado em cada instrução até que o trabalho seja concluído, antes de passar para a próxima instrução.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-138">The computer will block on each statement until the work is complete before moving on to the next statement.</span></span> <span data-ttu-id="e2a4c-139">Isso cria um café da manhã insatisfatório.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-139">That creates an unsatisfying breakfast.</span></span> <span data-ttu-id="e2a4c-140">As tarefas posteriores não seriam iniciadas até que as tarefas anteriores fossem concluídas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-140">The later tasks wouldn't be started until the earlier tasks had completed.</span></span> <span data-ttu-id="e2a4c-141">Levaria muito mais tempo para criar o café da manhã e alguns itens ficariam frios antes de serem servidos.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-141">It would take much longer to create the breakfast, and some items would have gotten cold before being served.</span></span>

<span data-ttu-id="e2a4c-142">Se você quiser que o computador execute as instruções acima de forma assíncrona, deverá escrever o código assíncrono.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-142">If you want the computer to execute the above instructions asynchronously, you must write asynchronous code.</span></span>

<span data-ttu-id="e2a4c-143">Essas questões são importantes para os programas que você escreve atualmente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-143">These concerns are important for the programs you write today.</span></span> <span data-ttu-id="e2a4c-144">Ao escrever programas de cliente, você quer que a interface do usuário responda de acordo com as solicitações do usuário.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-144">When you write client programs, you want the UI to be responsive to user input.</span></span> <span data-ttu-id="e2a4c-145">Seu aplicativo não deve fazer um telefone parecer travado enquanto ele está baixando dados da Web.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-145">Your application shouldn't make a phone appear frozen while it's downloading data from the web.</span></span> <span data-ttu-id="e2a4c-146">Ao escrever programas de servidor, você não quer threads bloqueados.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-146">When you write server programs, you don't want threads blocked.</span></span> <span data-ttu-id="e2a4c-147">Esses threads poderiam servir a outras solicitações.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-147">Those threads could be serving other requests.</span></span> <span data-ttu-id="e2a4c-148">O uso de código síncrono quando existem alternativas assíncronas afeta sua capacidade de aumentar de forma menos custosa.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-148">Using synchronous code when asynchronous alternatives exist hurts your ability to scale out less expensively.</span></span> <span data-ttu-id="e2a4c-149">Você paga pelos threads bloqueados.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-149">You pay for those blocked threads.</span></span>

<span data-ttu-id="e2a4c-150">Aplicativos modernos bem-sucedidos exigem código assíncrono.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-150">Successful modern applications require asynchronous code.</span></span> <span data-ttu-id="e2a4c-151">Sem suporte de linguagem, escrever código assíncrono exigia retornos de chamada, eventos de conclusão ou outros meios que obscureciam a intenção original do código.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-151">Without language support, writing asynchronous code required callbacks, completion events, or other means that obscured the original intent of the code.</span></span> <span data-ttu-id="e2a4c-152">A vantagem do código síncrono é que ele é fácil de entender.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-152">The advantage of the synchronous code is that it's easy to understand.</span></span> <span data-ttu-id="e2a4c-153">As ações passo a passo facilitam o exame e o entendimento.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-153">The step-by-step actions make it easy to scan and understand.</span></span> <span data-ttu-id="e2a4c-154">Modelos assíncronos tradicionais forçavam você a se concentrar na natureza assíncrona do código e não nas ações fundamentais do código.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-154">Traditional asynchronous models forced you to focus on the asynchronous nature of the code, not on the fundamental actions of the code.</span></span>

## <a name="dont-block-await-instead"></a><span data-ttu-id="e2a4c-155">Não bloquear, mas aguardar</span><span class="sxs-lookup"><span data-stu-id="e2a4c-155">Don't block, await instead</span></span>

<span data-ttu-id="e2a4c-156">O código anterior demonstra uma prática inadequada: construção de código síncrono para realizar operações assíncronas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-156">The preceding code demonstrates a bad practice: constructing synchronous code to perform asynchronous operations.</span></span> <span data-ttu-id="e2a4c-157">Como escrito, esse código bloqueia o thread que o está executando, impedindo-o de realizar qualquer outra tarefa.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-157">As written, this code blocks the thread executing it from doing any other work.</span></span> <span data-ttu-id="e2a4c-158">Ele não será interrompido enquanto qualquer uma das tarefas estiver em andamento.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-158">It won't be interrupted while any of the tasks are in progress.</span></span> <span data-ttu-id="e2a4c-159">Seria como se você fixasse o olhar na torradeira depois de colocar o pão.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-159">It would be as though you stared at the toaster after putting the bread in.</span></span> <span data-ttu-id="e2a4c-160">Você ignoraria qualquer pessoa que estivesse conversando com você até que a torrada pulasse.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-160">You'd ignore anyone talking to you until the toast popped.</span></span>

<span data-ttu-id="e2a4c-161">Vamos começar atualizando esse código para que o thread não seja bloqueado enquanto houver tarefas em execução.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-161">Let's start by updating this code so that the thread doesn't block while tasks are running.</span></span> <span data-ttu-id="e2a4c-162">A palavra-chave `await` oferece uma maneira sem bloqueio de iniciar uma tarefa e, em seguida, continuar a execução quando essa tarefa for concluída.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-162">The `await` keyword provides a non-blocking way to start a task, then continue execution when that task completes.</span></span> <span data-ttu-id="e2a4c-163">Uma versão assíncrona simples do código de fazer café da manhã ficaria como o snippet a seguir:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-163">A simple asynchronous version of the make a breakfast code would look like the following snippet:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V2/Program.cs" id="SnippetMain":::

> [!IMPORTANT]
> <span data-ttu-id="e2a4c-164">O tempo total decorrido é aproximadamente o mesmo que a versão inicial do synchonous.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-164">The total elapsed time is roughly the same as the initial synchonous version.</span></span> <span data-ttu-id="e2a4c-165">O código ainda tem de aproveitar alguns dos principais recursos da programação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-165">The code has yet to take advantage of some of the key features of asynchronous programming.</span></span>

> [!TIP]
> <span data-ttu-id="e2a4c-166">Os corpos de método do `FryEggsAsync` , `FryBaconAsync` , e `ToastBreadAsync` foram atualizados para retornar `Task<Egg>` , `Task<Bacon>` e, `Task<Toast>` respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-166">The method bodies of the `FryEggsAsync`, `FryBaconAsync`, and `ToastBreadAsync` have all been updated to return `Task<Egg>`, `Task<Bacon>`, and `Task<Toast>` respectively.</span></span> <span data-ttu-id="e2a4c-167">Os métodos são renomeados de sua versão original para incluir o sufixo "Async".</span><span class="sxs-lookup"><span data-stu-id="e2a4c-167">The methods are renamed from their original version to include the "Async" suffix.</span></span> <span data-ttu-id="e2a4c-168">Suas implementações são mostradas como parte da [versão final](#final-version) mais adiante neste artigo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-168">Their implementations are shown as part of the [final version](#final-version) later in this article.</span></span>

<span data-ttu-id="e2a4c-169">Esse código não bloqueia enquanto os ovos ou o bacon são preparados.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-169">This code doesn't block while the eggs or the bacon are cooking.</span></span> <span data-ttu-id="e2a4c-170">Entretanto, esse código não iniciará outras tarefas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-170">This code won't start any other tasks though.</span></span> <span data-ttu-id="e2a4c-171">Você ainda colocaria o pão na torradeira e ficaria olhando até ele pular.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-171">You'd still put the toast in the toaster and stare at it until it pops.</span></span> <span data-ttu-id="e2a4c-172">Mas, pelo menos, você responderia a qualquer pessoa que quisesse sua atenção.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-172">But at least, you'd respond to anyone that wanted your attention.</span></span> <span data-ttu-id="e2a4c-173">Em um restaurante em que vários pedidos são feitos, o cozinheiro pode iniciar o preparo de outro café da manhã enquanto prepara o primeiro.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-173">In a restaurant where multiple orders are placed, the cook could start another breakfast while the first is cooking.</span></span>

<span data-ttu-id="e2a4c-174">Agora, o thread trabalhando no café da manhã não fica bloqueado aguardando qualquer tarefa iniciada que ainda não tenha terminado.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-174">Now, the thread working on the breakfast isn't blocked while awaiting any started task that hasn't yet finished.</span></span> <span data-ttu-id="e2a4c-175">Para alguns aplicativos, essa alteração já basta.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-175">For some applications, this change is all that's needed.</span></span> <span data-ttu-id="e2a4c-176">Um aplicativo de GUI ainda responde ao usuário com apenas essa alteração.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-176">A GUI application still responds to the user with just this change.</span></span> <span data-ttu-id="e2a4c-177">No entanto, neste cenário, você quer mais.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-177">However, for this scenario, you want more.</span></span> <span data-ttu-id="e2a4c-178">Você não deseja que cada uma das tarefas componentes seja executada em sequência.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-178">You don't want each of the component tasks to be executed sequentially.</span></span> <span data-ttu-id="e2a4c-179">É melhor iniciar cada uma das tarefas componentes antes de aguardar a conclusão da tarefa anterior.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-179">It's better to start each of the component tasks before awaiting the previous task's completion.</span></span>

## <a name="start-tasks-concurrently"></a><span data-ttu-id="e2a4c-180">Iniciar tarefas simultaneamente</span><span class="sxs-lookup"><span data-stu-id="e2a4c-180">Start tasks concurrently</span></span>

<span data-ttu-id="e2a4c-181">Em muitos cenários, convém iniciar várias tarefas independentes imediatamente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-181">In many scenarios, you want to start several independent tasks immediately.</span></span> <span data-ttu-id="e2a4c-182">Em seguida, conforme cada tarefa é concluída, você pode continuar outro trabalho que esteja pronto.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-182">Then, as each task finishes, you can continue other work that's ready.</span></span> <span data-ttu-id="e2a4c-183">Na analogia do café da manhã, é assim que você prepara o café da manhã muito mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-183">In the breakfast analogy, that's how you get breakfast done more quickly.</span></span> <span data-ttu-id="e2a4c-184">Você também prepara tudo quase ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-184">You also get everything done close to the same time.</span></span> <span data-ttu-id="e2a4c-185">Você terá um café da manhã quente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-185">You'll get a hot breakfast.</span></span>

<span data-ttu-id="e2a4c-186">O <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> e os tipos relacionados são classes que você pode usar para pensar nas tarefas que estão em andamento.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-186">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and related types are classes you can use to reason about tasks that are in progress.</span></span> <span data-ttu-id="e2a4c-187">Elas permitem que você escreva código que se assemelhe mais à maneira como você realmente prepara o café da manhã.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-187">That enables you to write code that more closely resembles the way you'd actually create breakfast.</span></span> <span data-ttu-id="e2a4c-188">Você começaria a preparar os ovos, o bacon e a torrada ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-188">You'd start cooking the eggs, bacon, and toast at the same time.</span></span> <span data-ttu-id="e2a4c-189">Como cada um exige ação, você voltaria sua atenção para essa tarefa, cuidaria da próxima ação e aguardaria algo mais que exigisse sua atenção.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-189">As each requires action, you'd turn your attention to that task, take care of the next action, then await for something else that requires your attention.</span></span>

<span data-ttu-id="e2a4c-190">Você inicia uma tarefa e espera o objeto <xref:System.Threading.Tasks.Task> que representa o trabalho.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-190">You start a task and hold on to the <xref:System.Threading.Tasks.Task> object that represents the work.</span></span> <span data-ttu-id="e2a4c-191">Você vai `await` cada tarefa antes de trabalhar com o respectivo resultado.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-191">You'll `await` each task before working with its result.</span></span>

<span data-ttu-id="e2a4c-192">Vamos fazer essas alterações no código do café da manhã.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-192">Let's make these changes to the breakfast code.</span></span> <span data-ttu-id="e2a4c-193">A primeira etapa é armazenar as tarefas para as operações quando elas forem iniciadas, em vez de aguardá-las:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-193">The first step is to store the tasks for operations when they start, rather than awaiting them:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");

Task<Egg> eggsTask = FryEggsAsync(2);
Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");

Task<Bacon> baconTask = FryBaconAsync(3);
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Task<Toast> toastTask = ToastBreadAsync(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");

Juice oj = PourOJ();
Console.WriteLine("oj is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="e2a4c-194">Em seguida, você pode mover as instruções `await` do bacon e dos ovos até o final do método, antes de servir o café da manhã:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-194">Next, you can move the `await` statements for the bacon and eggs to the end of the method, before serving breakfast:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");

Task<Egg> eggsTask = FryEggsAsync(2);
Task<Bacon> baconTask = FryBaconAsync(3);
Task<Toast> toastTask = ToastBreadAsync(2);

Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Console.WriteLine("Breakfast is ready!");
```

:::image type="content" source="media/asynchronous-breakfast.png" alt-text="café de manhã assíncrono":::

<span data-ttu-id="e2a4c-196">A manhã preparada assincronamente levou aproximadamente 20 minutos, isso porque algumas tarefas podiam ser executadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-196">The asynchronously prepared breakfast took roughly 20 minutes, this is because some tasks were able to run concurrently.</span></span>

<span data-ttu-id="e2a4c-197">O código anterior funciona melhor.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-197">The preceding code works better.</span></span> <span data-ttu-id="e2a4c-198">Você inicia todas as tarefas assíncronas ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-198">You start all the asynchronous tasks at once.</span></span> <span data-ttu-id="e2a4c-199">Você aguarda cada tarefa somente quando precisar dos resultados.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-199">You await each task only when you need the results.</span></span> <span data-ttu-id="e2a4c-200">O código anterior pode ser semelhante a um código em um aplicativo Web que faz solicitações de diferentes microsserviços e combina os resultados em uma única página.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-200">The preceding code may be similar to code in a web application that makes requests of different microservices, then combines the results into a single page.</span></span> <span data-ttu-id="e2a4c-201">Você fará todas as solicitações imediatamente e, em seguida, `await` em todas essas tarefas e comporá a página da Web.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-201">You'll make all the requests immediately, then `await` all those tasks and compose the web page.</span></span>

## <a name="composition-with-tasks"></a><span data-ttu-id="e2a4c-202">Composição com tarefas</span><span class="sxs-lookup"><span data-stu-id="e2a4c-202">Composition with tasks</span></span>

 <span data-ttu-id="e2a4c-203">Você prepara tudo para o café da manhã ao mesmo tempo, exceto a torrada.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-203">You have everything ready for breakfast at the same time except the toast.</span></span> <span data-ttu-id="e2a4c-204">Preparar a torrada é a composição de uma operação assíncrona (torrar o pão) com operações síncronas (adicionar a manteiga e a geleia).</span><span class="sxs-lookup"><span data-stu-id="e2a4c-204">Making the toast is the composition of an asynchronous operation (toasting the bread), and synchronous operations (adding the butter and the jam).</span></span> <span data-ttu-id="e2a4c-205">A atualização deste código ilustra um conceito importante:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-205">Updating this code illustrates an important concept:</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e2a4c-206">A composição de uma operação assíncrona seguida por trabalho síncrono é uma operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-206">The composition of an asynchronous operation followed by synchronous work is an asynchronous operation.</span></span> <span data-ttu-id="e2a4c-207">Explicando de outra forma, se qualquer parte de uma operação for assíncrona, toda a operação será assíncrona.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-207">Stated another way, if any portion of an operation is asynchronous, the entire operation is asynchronous.</span></span>

<span data-ttu-id="e2a4c-208">O código anterior mostrou que você pode usar objetos <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601> para manter tarefas em execução.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-208">The preceding code showed you that you can use <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to hold running tasks.</span></span> <span data-ttu-id="e2a4c-209">Você `await` em cada tarefa antes de usar seu resultado.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-209">You `await` each task before using its result.</span></span> <span data-ttu-id="e2a4c-210">A próxima etapa é criar métodos que declarem a combinação de outro trabalho.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-210">The next step is to create methods that represent the combination of other work.</span></span> <span data-ttu-id="e2a4c-211">Antes de servir o café da manhã, você quer aguardar a tarefa que representa torrar o pão antes de adicionar manteiga e geleia.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-211">Before serving breakfast, you want to await the task that represents toasting the bread before adding butter and jam.</span></span> <span data-ttu-id="e2a4c-212">Você pode declarar esse trabalho com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-212">You can represent that work with the following code:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V3/Program.cs" id="SnippetComposeToastTask":::

<span data-ttu-id="e2a4c-213">O método anterior tem o modificador `async` na sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-213">The preceding method has the `async` modifier in its signature.</span></span> <span data-ttu-id="e2a4c-214">Isso sinaliza ao compilador que esse método contém uma instrução `await`; ele contém operações assíncronas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-214">That signals to the compiler that this method contains an `await` statement; it contains asynchronous operations.</span></span> <span data-ttu-id="e2a4c-215">Este método representa a tarefa que torra o pão e, em seguida, adiciona manteiga e geleia.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-215">This method represents the task that toasts the bread, then adds butter and jam.</span></span> <span data-ttu-id="e2a4c-216">Esse método retorna um <xref:System.Threading.Tasks.Task%601> que representa a composição dessas três operações.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-216">This method returns a <xref:System.Threading.Tasks.Task%601> that represents the composition of those three operations.</span></span> <span data-ttu-id="e2a4c-217">O principal bloco de código agora se torna:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-217">The main block of code now becomes:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V3/Program.cs" id="SnippetMain":::

<span data-ttu-id="e2a4c-218">A alteração anterior ilustrou uma técnica importante para trabalhar com código assíncrono.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-218">The previous change illustrated an important technique for working with asynchronous code.</span></span> <span data-ttu-id="e2a4c-219">Você pode compor tarefas, separando as operações em um novo método que retorna uma tarefa.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-219">You compose tasks by separating the operations into a new method that returns a task.</span></span> <span data-ttu-id="e2a4c-220">Você pode escolher quando aguardar essa tarefa.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-220">You can choose when to await that task.</span></span> <span data-ttu-id="e2a4c-221">Você pode iniciar outras tarefas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-221">You can start other tasks concurrently.</span></span>

## <a name="await-tasks-efficiently"></a><span data-ttu-id="e2a4c-222">Aguardar tarefas com eficiência</span><span class="sxs-lookup"><span data-stu-id="e2a4c-222">Await tasks efficiently</span></span>

<span data-ttu-id="e2a4c-223">A série de instruções `await` no final do código anterior pode ser melhorada usando métodos da classe `Task`.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-223">The series of `await` statements at the end of the preceding code can be improved by using methods of the `Task` class.</span></span> <span data-ttu-id="e2a4c-224">Uma dessas APIs é a <xref:System.Threading.Tasks.Task.WhenAll%2A>, que retorna um <xref:System.Threading.Tasks.Task> que é concluído ao final de todas as tarefas na lista de argumentos, conforme mostrado no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="e2a4c-224">One of those APIs is <xref:System.Threading.Tasks.Task.WhenAll%2A>, which returns a <xref:System.Threading.Tasks.Task> that completes when all the tasks in its argument list have completed, as shown in the following code:</span></span>

```csharp
await Task.WhenAll(eggsTask, baconTask, toastTask);
Console.WriteLine("eggs are ready");
Console.WriteLine("bacon is ready");
Console.WriteLine("toast is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="e2a4c-225">Outra opção é usar <xref:System.Threading.Tasks.Task.WhenAny%2A>, que retorna uma `Task<Task>` que é concluída quando qualquer um dos argumentos é concluído.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-225">Another option is to use <xref:System.Threading.Tasks.Task.WhenAny%2A>, which returns a `Task<Task>` that completes when any of its arguments completes.</span></span> <span data-ttu-id="e2a4c-226">Você pode aguardar a tarefa retornada, sabendo que ela já foi concluída.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-226">You can await the returned task, knowing that it has already finished.</span></span> <span data-ttu-id="e2a4c-227">O código a seguir mostra como você poderia usar <xref:System.Threading.Tasks.Task.WhenAny%2A> para aguardar a primeira tarefa concluir e, em seguida, processar seu resultado.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-227">The following code shows how you could use <xref:System.Threading.Tasks.Task.WhenAny%2A> to await the first task to finish and then process its result.</span></span> <span data-ttu-id="e2a4c-228">Depois de processar o resultado da tarefa concluída, você remove essa tarefa concluída da lista de tarefas passada para `WhenAny`.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-228">After processing the result from the completed task, you remove that completed task from the list of tasks passed to `WhenAny`.</span></span>

```csharp
var breakfastTasks = new List<Task> { eggsTask, baconTask, toastTask };
while (breakfastTasks.Count > 0)
{
    Task finishedTask = await Task.WhenAny(breakfastTasks);
    if (finishedTask == eggsTask)
    {
        Console.WriteLine("eggs are ready");
    }
    else if (finishedTask == baconTask)
    {
        Console.WriteLine("bacon is ready");
    }
    else if (finishedTask == toastTask)
    {
        Console.WriteLine("toast is ready");
    }
    breakfastTasks.Remove(finishedTask);
}
```

<span data-ttu-id="e2a4c-229">Depois de todas essas alterações, a versão final do código tem esta aparência:<a id="final-version"></a></span><span class="sxs-lookup"><span data-stu-id="e2a4c-229">After all those changes, the final version of the code looks like this: <a id="final-version"></a></span></span>
:::code language="csharp" source="snippets/index/AsyncBreakfast-final/Program.cs" highlight="9-40":::

:::image type="content" source="media/whenany-async-breakfast.png" alt-text="Quando qualquer café assíncrono":::

<span data-ttu-id="e2a4c-231">A versão final do café da manhã preparado de forma assíncrona levou aproximadamente 15 minutos, isso porque algumas tarefas podiam ser executadas simultaneamente, e o código conseguiu monitorar várias tarefas de uma só vez e agir apenas quando fosse necessário.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-231">The final version of the asynchronously prepared breakfast took roughly 15 minutes, this is because some tasks were able to run concurrently, and the code was able to monitor multiple tasks at once and only take action when it was needed.</span></span>

<span data-ttu-id="e2a4c-232">Esse código final é assíncrono.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-232">This final code is asynchronous.</span></span> <span data-ttu-id="e2a4c-233">Ele reflete mais precisamente como uma pessoa poderia preparar um café da manhã.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-233">It more accurately reflects how a person would cook a breakfast.</span></span> <span data-ttu-id="e2a4c-234">Compare o código anterior com o primeiro exemplo de código neste artigo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-234">Compare the preceding code with the first code sample in this article.</span></span> <span data-ttu-id="e2a4c-235">As ações principais permanecem claras ao ler o código.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-235">The core actions are still clear from reading the code.</span></span> <span data-ttu-id="e2a4c-236">Você pode ler esse código da mesma forma como faria ao ler essas instruções para fazer um café da manhã no início deste artigo.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-236">You can read this code the same way you'd read those instructions for making a breakfast at the beginning of this article.</span></span> <span data-ttu-id="e2a4c-237">Os recursos de linguagem para `async` e `await` fornecem a tradução que todas as pessoas fazem para seguir essas instruções escritas: iniciar tarefas assim que possível e não ficar bloqueado ao aguardar a conclusão de tarefas.</span><span class="sxs-lookup"><span data-stu-id="e2a4c-237">The language features for `async` and `await` provide the translation every person makes to follow those written instructions: start tasks as you can and don't block waiting for tasks to complete.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e2a4c-238">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e2a4c-238">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="e2a4c-239">Saiba mais sobre o modelo de programação assíncrona de tarefas</span><span class="sxs-lookup"><span data-stu-id="e2a4c-239">Learn about the task asynchronous programming model</span></span>](task-asynchronous-programming-model.md)
