---
title: Tipos de retorno assíncronos (C#)
ms.date: 05/29/2017
ms.assetid: ddb2539c-c898-48c1-ad92-245e4a996df8
ms.openlocfilehash: 327168e3ac77ab1ed7c9841d592781c704839660
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64599783"
---
# <a name="async-return-types-c"></a><span data-ttu-id="db72d-102">Tipos de retorno assíncronos (C#)</span><span class="sxs-lookup"><span data-stu-id="db72d-102">Async Return Types (C#)</span></span>
<span data-ttu-id="db72d-103">Métodos assíncronos podem conter os seguintes tipos de retorno:</span><span class="sxs-lookup"><span data-stu-id="db72d-103">Async methods can have the following return types:</span></span>

- <span data-ttu-id="db72d-104"><xref:System.Threading.Tasks.Task%601>, para um método assíncrono que retorna um valor.</span><span class="sxs-lookup"><span data-stu-id="db72d-104"><xref:System.Threading.Tasks.Task%601>, for an async method that returns a value.</span></span> 
 
- <span data-ttu-id="db72d-105"><xref:System.Threading.Tasks.Task>, para um método assíncrono que executa uma operação, mas não retorna nenhum valor.</span><span class="sxs-lookup"><span data-stu-id="db72d-105"><xref:System.Threading.Tasks.Task>, for an async method that performs an operation but returns no value.</span></span>

- <span data-ttu-id="db72d-106">`void`, para um manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="db72d-106">`void`, for an event handler.</span></span> 

- <span data-ttu-id="db72d-107">Começando com o C# 7.0, qualquer tipo que tenha um método acessível `GetAwaiter`.</span><span class="sxs-lookup"><span data-stu-id="db72d-107">Starting with C# 7.0, any type that has an accessible `GetAwaiter` method.</span></span> <span data-ttu-id="db72d-108">O objeto retornado pelo método `GetAwaiter` deve implementar a interface <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="db72d-108">The object returned by the `GetAwaiter` method must implement the <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> interface.</span></span>
  
<span data-ttu-id="db72d-109">Para obter mais informações sobre os métodos assíncronos, consulte [Programação assíncrona com async e await (C#)](../../../../csharp/programming-guide/concepts/async/index.md).</span><span class="sxs-lookup"><span data-stu-id="db72d-109">For more information about async methods, see [Asynchronous Programming with async and await (C#)](../../../../csharp/programming-guide/concepts/async/index.md).</span></span>  
  
<span data-ttu-id="db72d-110">Cada tipo de retorno é examinado em uma das seções a seguir e você pode encontrar um exemplo completo que usa todos os três tipos no final do tópico.</span><span class="sxs-lookup"><span data-stu-id="db72d-110">Each return type is examined in one of the following sections, and you can find a full example that uses all three types at the end of the topic.</span></span>  
  
## <a name="BKMK_TaskTReturnType"></a> <span data-ttu-id="db72d-111">Tipo de retorno Task\<TResult\></span><span class="sxs-lookup"><span data-stu-id="db72d-111">Task\<TResult\> Return Type</span></span>  
<span data-ttu-id="db72d-112">O tipo de retorno <xref:System.Threading.Tasks.Task%601> é usado para um método assíncrono que contém uma instrução [return](../../../../csharp/language-reference/keywords/return.md) (C#), na qual o operando tem o tipo `TResult`.</span><span class="sxs-lookup"><span data-stu-id="db72d-112">The <xref:System.Threading.Tasks.Task%601> return type is used for an async method that contains a [return](../../../../csharp/language-reference/keywords/return.md) (C#) statement in which the operand has type `TResult`.</span></span>  
  
<span data-ttu-id="db72d-113">No exemplo a seguir, o método assíncrono `GetLeisureHours` contém uma instrução `return` que retorna um número inteiro.</span><span class="sxs-lookup"><span data-stu-id="db72d-113">In the following example, the `GetLeisureHours` async method contains a `return` statement that returns an integer.</span></span> <span data-ttu-id="db72d-114">Portanto, a declaração do método deve especificar um tipo de retorno de `Task<int>`.</span><span class="sxs-lookup"><span data-stu-id="db72d-114">Therefore, the method declaration must specify a return type of `Task<int>`.</span></span>  <span data-ttu-id="db72d-115">O método assíncrono <xref:System.Threading.Tasks.Task.FromResult%2A> é um espaço reservado para uma operação que retorna uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="db72d-115">The <xref:System.Threading.Tasks.Task.FromResult%2A> async method is a placeholder for an operation that returns a string.</span></span>
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1.cs)]

<span data-ttu-id="db72d-116">Quando `GetLeisureHours` é chamado de dentro de uma expressão await no método `ShowTodaysInfo`, a expressão await recupera o valor inteiro (o valor de `leisureHours`) que está armazenado na tarefa que é retornada pelo método `GetLeisureHours`.</span><span class="sxs-lookup"><span data-stu-id="db72d-116">When `GetLeisureHours` is called from within an await expression in the `ShowTodaysInfo` method, the await expression retrieves the integer value (the value of `leisureHours`) that's stored in the task returned by the `GetLeisureHours` method.</span></span> <span data-ttu-id="db72d-117">Para obter mais informações sobre expressões await, consulte [await](../../../../csharp/language-reference/keywords/await.md).</span><span class="sxs-lookup"><span data-stu-id="db72d-117">For more information about await expressions, see [await](../../../../csharp/language-reference/keywords/await.md).</span></span>  
  
<span data-ttu-id="db72d-118">Você pode entender melhor como isso acontece, separando a chamada ao `GetLeisureHours` da aplicação do `await`, como mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="db72d-118">You can better understand how this happens by separating the call to `GetLeisureHours` from the application of `await`, as the following code shows.</span></span> <span data-ttu-id="db72d-119">Uma chamada ao método `GetLeisureHours` que não é aguardada imediatamente, retorna um `Task<int>`, como você esperaria da declaração do método.</span><span class="sxs-lookup"><span data-stu-id="db72d-119">A call to method `GetLeisureHours` that isn't immediately awaited returns a `Task<int>`, as you would expect from the declaration of the method.</span></span> <span data-ttu-id="db72d-120">A tarefa é atribuída à variável `integerTask` no exemplo.</span><span class="sxs-lookup"><span data-stu-id="db72d-120">The task is assigned to the `integerTask` variable in the example.</span></span> <span data-ttu-id="db72d-121">Já que `integerTask` é um <xref:System.Threading.Tasks.Task%601>, ele contém uma propriedade <xref:System.Threading.Tasks.Task%601.Result> do tipo `TResult`.</span><span class="sxs-lookup"><span data-stu-id="db72d-121">Because `integerTask` is a <xref:System.Threading.Tasks.Task%601>, it contains a <xref:System.Threading.Tasks.Task%601.Result> property of type `TResult`.</span></span> <span data-ttu-id="db72d-122">Nesse caso, `TResult` representa um tipo inteiro.</span><span class="sxs-lookup"><span data-stu-id="db72d-122">In this case, `TResult` represents an integer type.</span></span> <span data-ttu-id="db72d-123">Quando `await` é aplicado à `integerTask`, a expressão await é avaliada como o conteúdo da propriedade <xref:System.Threading.Tasks.Task%601.Result%2A> de `integerTask`.</span><span class="sxs-lookup"><span data-stu-id="db72d-123">When `await` is applied to `integerTask`, the await expression evaluates to the contents of the <xref:System.Threading.Tasks.Task%601.Result%2A> property of `integerTask`.</span></span> <span data-ttu-id="db72d-124">O valor é atribuído à variável `ret`.</span><span class="sxs-lookup"><span data-stu-id="db72d-124">The value is assigned to the `ret` variable.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="db72d-125">A propriedade <xref:System.Threading.Tasks.Task%601.Result%2A> é uma propriedade de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="db72d-125">The <xref:System.Threading.Tasks.Task%601.Result%2A> property is a blocking property.</span></span> <span data-ttu-id="db72d-126">Se você tentar acessá-la antes que sua tarefa seja concluída, o thread que está ativo no momento será bloqueado até que a tarefa seja concluída e o valor esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="db72d-126">If you try to access it before its task is finished, the thread that's currently active is blocked until the task completes and the value is available.</span></span> <span data-ttu-id="db72d-127">Na maioria dos casos, você deve acessar o valor usando `await` em vez de acessar a propriedade diretamente.</span><span class="sxs-lookup"><span data-stu-id="db72d-127">In most cases, you should access the value by using `await` instead of accessing the property directly.</span></span> <br/> <span data-ttu-id="db72d-128">O exemplo anterior recuperou o valor da propriedade <xref:System.Threading.Tasks.Task%601.Result%2A> para bloquear o thread principal, de modo que o método `ShowTodaysInfo` pudesse concluir a execução antes do encerramento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="db72d-128">The previous example retrieved the value of the <xref:System.Threading.Tasks.Task%601.Result%2A> property to block the main thread so that the `ShowTodaysInfo` method could finish execution before the application ended.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1a.cs#1)]
  
## <a name="BKMK_TaskReturnType"></a> <span data-ttu-id="db72d-129">Tipo de retorno Task</span><span class="sxs-lookup"><span data-stu-id="db72d-129">Task Return Type</span></span>  
<span data-ttu-id="db72d-130">Os métodos assíncronos que não contêm uma instrução `return` ou que contêm uma instrução `return` que não retorna um operando, normalmente têm um tipo de retorno de <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="db72d-130">Async methods that don't contain a `return` statement or that contain a `return` statement that doesn't return an operand usually have a return type of <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="db72d-131">Esses métodos retornam `void` se eles são executados de forma síncrona.</span><span class="sxs-lookup"><span data-stu-id="db72d-131">Such methods return `void` if they run synchronously.</span></span> <span data-ttu-id="db72d-132">Se você usar um tipo de retorno <xref:System.Threading.Tasks.Task> para um método assíncrono, um método de chamada poderá usar um operador `await` para suspender a conclusão do chamador até que o método assíncrono chamado seja concluído.</span><span class="sxs-lookup"><span data-stu-id="db72d-132">If you use a <xref:System.Threading.Tasks.Task> return type for an async method, a calling method can use an `await` operator to suspend the caller's completion until the called async method has finished.</span></span>  
  
<span data-ttu-id="db72d-133">No exemplo a seguir, o método assíncrono `WaitAndApologize` não contém uma instrução `return`, então o método retorna um objeto <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="db72d-133">In the following example, the `WaitAndApologize` async method doesn't contain a `return` statement, so the method returns a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="db72d-134">Isso permite que `WaitAndApologize` seja aguardado.</span><span class="sxs-lookup"><span data-stu-id="db72d-134">This enables `WaitAndApologize` to be awaited.</span></span> <span data-ttu-id="db72d-135">Observe que o tipo <xref:System.Threading.Tasks.Task> não inclui uma propriedade `Result` porque ele não tem nenhum valor retornado.</span><span class="sxs-lookup"><span data-stu-id="db72d-135">Note that the <xref:System.Threading.Tasks.Task> type doesn't include a `Result` property because it has no return value.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2.cs)]  
  
<span data-ttu-id="db72d-136">O `WaitAndApologize` é aguardado, usando uma instrução await, em vez de uma expressão await, semelhante à instrução de chamada a um método síncrono de retorno void.</span><span class="sxs-lookup"><span data-stu-id="db72d-136">`WaitAndApologize` is awaited by using an await statement instead of an await expression, similar to the calling statement for a synchronous void-returning method.</span></span> <span data-ttu-id="db72d-137">A aplicação de um operador await, nesse caso, não produz um valor.</span><span class="sxs-lookup"><span data-stu-id="db72d-137">The application of an await operator in this case doesn't produce a value.</span></span>  
  
<span data-ttu-id="db72d-138">Como no exemplo <xref:System.Threading.Tasks.Task%601> anterior, você pode separar a chamada ao `WaitAndApologize`, da aplicação de um operador await, como mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="db72d-138">As in the previous <xref:System.Threading.Tasks.Task%601> example, you can separate the call to `WaitAndApologize` from the application of an await operator, as the following code shows.</span></span> <span data-ttu-id="db72d-139">No entanto, lembre-se que uma `Task` não tem uma propriedade `Result` e que nenhum valor será produzido quando um operador await for aplicado a uma `Task`.</span><span class="sxs-lookup"><span data-stu-id="db72d-139">However, remember that a `Task` doesn't have a `Result` property, and that no value is produced when an await operator is applied to a `Task`.</span></span>  
  
<span data-ttu-id="db72d-140">O código a seguir separa a chamada ao método `WaitAndApologize` da espera pela tarefa que o método retorna.</span><span class="sxs-lookup"><span data-stu-id="db72d-140">The following code separates calling the `WaitAndApologize` method from awaiting the task that the method returns.</span></span>  
 
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2a.cs#1)]  
 
## <a name="BKMK_VoidReturnType"></a> <span data-ttu-id="db72d-141">Tipo de retorno void</span><span class="sxs-lookup"><span data-stu-id="db72d-141">Void return type</span></span>

<span data-ttu-id="db72d-142">O tipo de retorno `void` é usado em manipuladores de eventos assíncronos, que exigem um tipo de retorno `void`.</span><span class="sxs-lookup"><span data-stu-id="db72d-142">You use the `void` return type in asynchronous event handlers, which require a `void` return type.</span></span> <span data-ttu-id="db72d-143">Para métodos diferentes de manipuladores de eventos que não retornam um valor, você deve retornar um <xref:System.Threading.Tasks.Task>, porque não é possível esperar por um método assíncrono que retorna `void`.</span><span class="sxs-lookup"><span data-stu-id="db72d-143">For methods other than event handlers that don't return a value, you should return a <xref:System.Threading.Tasks.Task> instead, because an async method that returns `void` can't be awaited.</span></span> <span data-ttu-id="db72d-144">Qualquer chamador desse método deve ser capaz de continuar até a conclusão, sem aguardar a conclusão do método assíncrono chamado e o chamador deve ser independente de todos os valores ou exceções gerados pelo método assíncrono.</span><span class="sxs-lookup"><span data-stu-id="db72d-144">Any caller of such a method must be able to continue to completion without waiting for the called async method to finish, and the caller must be independent of any values or exceptions that the async method generates.</span></span>  
  
<span data-ttu-id="db72d-145">O chamador de um método assíncrono de retorno void não pode capturar exceções que são lançadas pelo método e essas exceções sem tratamento provavelmente causarão falha do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="db72d-145">The caller of a void-returning async method can't catch exceptions that are thrown from the method, and such unhandled exceptions are likely to cause your application to fail.</span></span> <span data-ttu-id="db72d-146">Se ocorrer uma exceção em um método assíncrono que retorna uma <xref:System.Threading.Tasks.Task> ou uma <xref:System.Threading.Tasks.Task%601>, a exceção será armazenada na tarefa retornada e relançada quando a tarefa for aguardada.</span><span class="sxs-lookup"><span data-stu-id="db72d-146">If an exception occurs in an async method that returns a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, the exception is stored in the returned task and is rethrown when the task is awaited.</span></span> <span data-ttu-id="db72d-147">Portanto, verifique se qualquer método assíncrono que pode produzir uma exceção tem um tipo de retorno de <xref:System.Threading.Tasks.Task> ou <xref:System.Threading.Tasks.Task%601> e que as chamadas ao método são aguardadas.</span><span class="sxs-lookup"><span data-stu-id="db72d-147">Therefore, make sure that any async method that can produce an exception has a return type of <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> and that calls to the method are awaited.</span></span>  
  
<span data-ttu-id="db72d-148">Para obter mais informações de como capturar exceções em métodos assíncronos, confira a seção [Exceções em métodos assíncronos](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) do tópico [try-catch](../../../language-reference/keywords/try-catch.md).</span><span class="sxs-lookup"><span data-stu-id="db72d-148">For more information about how to catch exceptions in async methods, see the [Exceptions in Async Methods](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) section of the [try-catch](../../../language-reference/keywords/try-catch.md) topic.</span></span>  
  
<span data-ttu-id="db72d-149">O exemplo a seguir mostra o comportamento de um manipulador de eventos assíncrono.</span><span class="sxs-lookup"><span data-stu-id="db72d-149">The following example shows the behavior of an async event handler.</span></span> <span data-ttu-id="db72d-150">Observe que o código de exemplo, um manipulador de eventos assíncrono, deve informar o thread principal quando ele for concluído.</span><span class="sxs-lookup"><span data-stu-id="db72d-150">Note that in the example code, an async event handler must let the main thread know when it finishes.</span></span> <span data-ttu-id="db72d-151">Em seguida, o thread principal pode aguardar um manipulador de eventos assíncronos ser concluído antes de sair do programa.</span><span class="sxs-lookup"><span data-stu-id="db72d-151">Then the main thread can wait for an async event handler to complete before exiting the program.</span></span>
 
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns3.cs)]  
 
## <a name="generalized-async-return-types-and-valuetasktresult"></a><span data-ttu-id="db72d-152">Tipos de retorno assíncronos generalizados e ValueTask\<TResult\></span><span class="sxs-lookup"><span data-stu-id="db72d-152">Generalized async return types and ValueTask\<TResult\></span></span>

<span data-ttu-id="db72d-153">Começando com o C# 7.0, um método assíncrono pode retornar qualquer tipo que tenha um método `GetAwaiter` acessível.</span><span class="sxs-lookup"><span data-stu-id="db72d-153">Starting with C# 7.0, an async method can return any type that has an accessible `GetAwaiter` method.</span></span>
 
<span data-ttu-id="db72d-154">Já que <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601> são tipos de referência, a alocação de memória em caminhos críticos para o desempenho, especialmente quando alocações ocorrerem em loops estreitos, podem afetar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="db72d-154">Because <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> are reference types, memory allocation in performance-critical paths, particularly when allocations occur in tight loops, can adversely affect performance.</span></span> <span data-ttu-id="db72d-155">Suporte para tipos de retorno generalizados significa que você pode retornar um tipo de valor leve em vez de um tipo de referência para evitar as alocações de memória adicionais.</span><span class="sxs-lookup"><span data-stu-id="db72d-155">Support for generalized return types means that you can return a lightweight value type instead of a reference type to avoid additional memory allocations.</span></span> 

<span data-ttu-id="db72d-156">O .NET fornece a estrutura <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> como uma implementação leve de um valor de retorno de tarefa generalizado.</span><span class="sxs-lookup"><span data-stu-id="db72d-156">.NET provides the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> structure as a light-weight implementation of a generalized task-returning value.</span></span> <span data-ttu-id="db72d-157">Para usar o tipo <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType>, você deve adicionar o pacote NuGet `System.Threading.Tasks.Extensions` ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="db72d-157">To use the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> type, you must add the `System.Threading.Tasks.Extensions` NuGet package to your project.</span></span> <span data-ttu-id="db72d-158">O exemplo a seguir usa a estrutura <xref:System.Threading.Tasks.ValueTask%601> para recuperar o valor de dois lançamentos de dados.</span><span class="sxs-lookup"><span data-stu-id="db72d-158">The following example uses the <xref:System.Threading.Tasks.ValueTask%601> structure to retrieve the value of two dice rolls.</span></span> 
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-valuetask.cs)]

## <a name="see-also"></a><span data-ttu-id="db72d-159">Consulte também</span><span class="sxs-lookup"><span data-stu-id="db72d-159">See also</span></span>

- <xref:System.Threading.Tasks.Task.FromResult%2A>
- [<span data-ttu-id="db72d-160">Passo a passo: acesso à Web com o uso de Async e Await (C#)</span><span class="sxs-lookup"><span data-stu-id="db72d-160">Walkthrough: Accessing the Web by Using async and await (C#)</span></span>](../../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md)
- [<span data-ttu-id="db72d-161">Fluxo de controle em programas assíncronos (C#)</span><span class="sxs-lookup"><span data-stu-id="db72d-161">Control Flow in Async Programs (C#)</span></span>](../../../../csharp/programming-guide/concepts/async/control-flow-in-async-programs.md)
- [<span data-ttu-id="db72d-162">async</span><span class="sxs-lookup"><span data-stu-id="db72d-162">async</span></span>](../../../../csharp/language-reference/keywords/async.md)
- [<span data-ttu-id="db72d-163">await</span><span class="sxs-lookup"><span data-stu-id="db72d-163">await</span></span>](../../../../csharp/language-reference/keywords/await.md)
