---
title: Valores ref return e ref local (Guia de C#)
description: Saiba como definir e usar os valores ref return e ref local
author: rpetrusha
ms.author: ronpet
ms.date: 05/30/2017
ms.topic: article
ms.prod: .net
ms.technology: devlang-csharp
ms.devlang: csharp
ms.assetid: 18cf7a4b-29f0-4b14-85b8-80af754aabd8
ms.openlocfilehash: 1d8fb092b578602b5d4f791a3fd14f47dfae1ba6
ms.sourcegitcommit: 7e99f66ef09d2903e22c789c67ff5a10aa953b2f
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/18/2017
---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="1f2a6-103">Ref returns e ref locals</span><span class="sxs-lookup"><span data-stu-id="1f2a6-103">Ref returns and ref locals</span></span>

<span data-ttu-id="1f2a6-104">Começando com o C# 7, o C# dá suporte a valores retornados por referência (ref returns).</span><span class="sxs-lookup"><span data-stu-id="1f2a6-104">Starting with C# 7, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="1f2a6-105">Um valor retornado por referência permite que um método retorne uma referência a um objeto, em vez de um valor, de volta para um chamador.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-105">A reference return value allows a method to return a reference to an object, rather than a value, back to a caller.</span></span> <span data-ttu-id="1f2a6-106">O chamador pode optar por tratar o objeto retornado como se ele tivesse sido retornado por valor ou por referência.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-106">The caller can then choose to treat the returned object returned as if it were returned by value or by reference.</span></span> <span data-ttu-id="1f2a6-107">Um valor retornado por referência que o chamador trata como uma referência em vez de um valor é um ref local.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-107">A value returned by reference that the caller handles as a reference rather than a value is a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="1f2a6-108">O que é um valor retornado por referência?</span><span class="sxs-lookup"><span data-stu-id="1f2a6-108">What is a reference return value?</span></span>

<span data-ttu-id="1f2a6-109">A maioria dos desenvolvedores estão familiarizados com passar um argumento para um método chamado *por referência*.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="1f2a6-110">A lista de argumentos de um método chamado inclui um valor passado por referência e todas as alterações ao valor dele pelo método chamado são retornadas ao chamador.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-110">A called method's argument list includes a value passed by reference, and any changes made to its value by the called method are returned to the caller.</span></span> <span data-ttu-id="1f2a6-111">Um *valor retornado por referência* é o oposto:</span><span class="sxs-lookup"><span data-stu-id="1f2a6-111">A *reference return value* is the opposite:</span></span>

- <span data-ttu-id="1f2a6-112">O valor retornado do método chamado é uma referência, em vez de ser um argumento passado a ele.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-112">The called method's return value, rather than an argument passed to it, is a reference.</span></span>

- <span data-ttu-id="1f2a6-113">O chamador, em vez do método chamado, pode modificar o valor retornado pelo método.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-113">The caller, rather than the called method, can modify the value returned by the method.</span></span>

- <span data-ttu-id="1f2a6-114">Em vez de modificações ao argumento que são refletidas no estado do objeto no chamador, as modificações para o valor retornado do método pelo chamador são refletidas no estado do objeto cujo método foi chamado.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-114">Instead of modifications to the argument that are reflected in state of the object on the caller, modifications to the method's return value by the caller are reflected in the state of the object whose method was called.</span></span>

<span data-ttu-id="1f2a6-115">Valores retornados por referência podem produzir um código mais compacto, bem como permitir que um objeto exponha apenas os itens de dados individuais, tais como um elemento de matriz, que são de interesse do chamador.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-115">Reference return values can produce more compact code, as well as allow an object to expose only the individual data items, such as an array element, that are of interest to the caller.</span></span> <span data-ttu-id="1f2a6-116">Isso reduz a probabilidade de que o chamador modifique inadvertidamente o estado do objeto.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-116">This reduces the likelihood that the caller will inadvertently modify the object's state.</span></span>

<span data-ttu-id="1f2a6-117">Há algumas restrições quanto ao valor que um método pode retornar como um valor retornado por referência.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-117">There are some restrictions on the value that a method can return as a reference return value.</span></span> <span data-ttu-id="1f2a6-118">Elas incluem:</span><span class="sxs-lookup"><span data-stu-id="1f2a6-118">These include:</span></span>

- <span data-ttu-id="1f2a6-119">O valor retornado não pode ser `void`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-119">The return value cannot be `void`.</span></span> <span data-ttu-id="1f2a6-120">Tentar definir um método com um valor retornado por referência `void` gera o erro do compilador CS1547, "A palavra-chave 'void' não pode ser usada neste contexto".</span><span class="sxs-lookup"><span data-stu-id="1f2a6-120">Attempting to define a method with a `void` reference return value generates compiler error CS1547, "Keyword 'void' cannot be used in this context."</span></span>
 
- <span data-ttu-id="1f2a6-121">O valor retornado não pode ser uma variável local no método que o retorna; ele deve ter um escopo que está fora do método que o retorna.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-121">The return value cannot be a local variable in the method that returns it; it must have a scope that is outside the method that returns it.</span></span> <span data-ttu-id="1f2a6-122">Ele pode ser uma instância ou um campo estático de uma classe ou pode ser um argumento passado para o método.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-122">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="1f2a6-123">Tentar retornar a uma variável local gera o erro do compilador CS8168, "não é possível retornar o 'obj' local por referência porque ele não é um ref local".</span><span class="sxs-lookup"><span data-stu-id="1f2a6-123">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="1f2a6-124">O valor retornado não pode ser um `null`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-124">The return value cannot be a `null`.</span></span> <span data-ttu-id="1f2a6-125">A tentativa de retornar `null` gera o erro do compilador CS8156, "Uma expressão não pode ser usada neste contexto porque ela não pode ser retornada por referência."</span><span class="sxs-lookup"><span data-stu-id="1f2a6-125">Attempting to return `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="1f2a6-126">Se um método com um ref return precisar retornar um valor nulo, você poderá retornar um valor nulo (não instanciado) para um tipo de referência ou um [tipo que permite valor nulo](../nullable-types/index.md) para um tipo de valor.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-126">If a method with a ref return needs to return a null value, you can either return a null (uninstantiated) value for a reference type or a [nullable type](../nullable-types/index.md) for a value type.</span></span>
 
- <span data-ttu-id="1f2a6-127">O valor retornado não pode ser uma constante, um membro de enumeração ou uma propriedade de um `class` ou `struct`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-127">The return value cannot be a constant, an enumeration member, or a property of a `class` or `struct`.</span></span> <span data-ttu-id="1f2a6-128">A tentativa de retornar um deles gera o erro do compilador CS8156, "Uma expressão não pode ser usada neste contexto porque ela não pode ser retornada por referência."</span><span class="sxs-lookup"><span data-stu-id="1f2a6-128">Attempting to return these generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="1f2a6-129">Além disso, como um método assíncrono pode ser retornado antes de sua execução ser concluída, embora seu valor retornado ainda seja desconhecido, os valores retornados de referência não são permitidos em métodos assíncronos.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-129">In addition, because an asynchronous method may return before it has finished execution, while its return value is still unknown, reference return values are not allowed on async methods.</span></span>
 
## <a name="defining-a-ref-return-value"></a><span data-ttu-id="1f2a6-130">Definindo um valor retornado ref</span><span class="sxs-lookup"><span data-stu-id="1f2a6-130">Defining a ref return value</span></span>

<span data-ttu-id="1f2a6-131">Você define um valor retornado ref adicionando a palavra-chave [ref](../../language-reference/keywords/ref.md) ao tipo de retorno da assinatura de método.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-131">You define a ref return value by adding the [ref](../../language-reference/keywords/ref.md) keyword to the return type of the method signature.</span></span> <span data-ttu-id="1f2a6-132">Por exemplo, a assinatura a seguir indica que a propriedade `GetContactInformation` retorna uma referência a um objeto `Person` ao chamador:</span><span class="sxs-lookup"><span data-stu-id="1f2a6-132">For example, the following signature indicates that the `GetContactInformation` property returns a reference to a `Person` object to the caller:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname);
```

<span data-ttu-id="1f2a6-133">Além disso, o nome do objeto retornado por cada instrução [return](../../language-reference/keywords/return.md) no corpo do método deve ser precedida pela palavra-chave [ref](../../language-reference/keywords/ref.md).</span><span class="sxs-lookup"><span data-stu-id="1f2a6-133">In addition, the name of the object returned by each [return](../../language-reference/keywords/return.md) statement in the method body must be preceded by the [ref](../../language-reference/keywords/ref.md) keyword.</span></span> <span data-ttu-id="1f2a6-134">Por exemplo, a instrução `return` a seguir retorna um objeto `Person` chamado `p` por referência:</span><span class="sxs-lookup"><span data-stu-id="1f2a6-134">For example, the following `return` statement returns a `Person` object named `p` by reference:</span></span>

```csharp
return ref p;
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="1f2a6-135">Consumindo um valor retornado ref</span><span class="sxs-lookup"><span data-stu-id="1f2a6-135">Consuming a ref return value</span></span>

<span data-ttu-id="1f2a6-136">Um chamador pode lidar com um valor retornado ref de uma de duas maneiras:</span><span class="sxs-lookup"><span data-stu-id="1f2a6-136">A caller can handle a ref return value in either of two ways:</span></span>

- <span data-ttu-id="1f2a6-137">Como um valor comum retornado pelo valor de um método.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-137">As an ordinary value returned by value from a method.</span></span> <span data-ttu-id="1f2a6-138">O chamador pode optar por ignorar que o valor retornado é um valor retornado por referência.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-138">The caller can choose to ignore that the return value is a reference return value.</span></span> <span data-ttu-id="1f2a6-139">Nesse caso, todas as alterações feitas ao valor retornado pela chamada de método não são refletidas no estado do tipo chamado.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-139">In this case, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span> <span data-ttu-id="1f2a6-140">Se o valor retornado é um tipo de valor, todas as alterações feitas ao valor retornado pela chamada de método não são refletidas no estado do tipo chamado.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-140">If the returned value is a value type, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span>

- <span data-ttu-id="1f2a6-141">Como um valor retornado por referência.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-141">As a reference return value.</span></span> <span data-ttu-id="1f2a6-142">O chamador deve definir a variável à qual o valor retornado por referência é atribuído como um [ref local](#ref-local) e as alterações para o valor retornado pela chamada de método são refletidas no estado do tipo chamado.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-142">The caller must define the variable to which the reference return value is assigned as a [ref local](#ref-local), and any changes to the value returned by the method call are reflected in the state of the called type.</span></span> 

## <a name="ref-locals"></a><span data-ttu-id="1f2a6-143">Ref locals</span><span class="sxs-lookup"><span data-stu-id="1f2a6-143">Ref locals</span></span>

<span data-ttu-id="1f2a6-144">Para lidar com o valor retornado por referência como uma referência, o chamador deve declarar o valor como sendo um *ref local* usando a palavra-chave `ref`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-144">To handle the reference return value as a reference, the caller must declare the value to be a *ref local* by using the `ref` keyword.</span></span> <span data-ttu-id="1f2a6-145">Por exemplo, se o valor retornado pelo método `Person.GetContactInfomation` deve ser consumido como uma referência em vez de um valor, a chamada de método é exibida como:</span><span class="sxs-lookup"><span data-stu-id="1f2a6-145">For example, if the value returned by the `Person.GetContactInfomation` method is to be consumed as a reference rather than a value, the method call appears as:</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="1f2a6-146">Observe que a palavra-chave `ref` é usada antes da declaração de variável local *e* antes da chamada de método.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-146">Note that the `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span> <span data-ttu-id="1f2a6-147">Falha ao incluir palavras-chave `ref` na declaração da variável e resultados de atribuição no erro do compilador CS8172, "Não é possível inicializar uma variável por referência com um valor."</span><span class="sxs-lookup"><span data-stu-id="1f2a6-147">Failure to include both `ref` keywords in the variable declaration and assignment results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span> 
 
<span data-ttu-id="1f2a6-148">As alterações subsequentes ao objeto `Person` retornado pelo método são refletidas no objeto `contacts`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-148">Subsequent changes to the `Person` object returned by the method are reflected in the `contacts` object.</span></span>

<span data-ttu-id="1f2a6-149">Se `p` não estiver definido como um ref local usando a palavra-chave `ref`, quaisquer alterações feitas a `p` pelo chamador não serão refletidas no objeto `contacts`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-149">If `p` is not defined as a ref local by using the `ref` keyword, any changes made to `p` by the caller are not reflected in the `contacts` object.</span></span>
 
## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="1f2a6-150">Ref returns e ref locals: um exemplo</span><span class="sxs-lookup"><span data-stu-id="1f2a6-150">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="1f2a6-151">O exemplo a seguir define uma classe `NumberStore` que armazena uma matriz de valores inteiros.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-151">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="1f2a6-152">O método `FindNumber` retorna por referência o primeiro número maior ou igual ao número passado como um argumento.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-152">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="1f2a6-153">Se nenhum número for maior ou igual ao argumento, o método retornará o número no índice 0.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-153">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span> 

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]

<span data-ttu-id="1f2a6-154">A exemplo a seguir chama o método `NumberStore.FindNumber` para recuperar o primeiro valor maior ou igual a 16.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-154">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="1f2a6-155">O chamador então dobra o valor retornado pelo método.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-155">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="1f2a6-156">Assim como mostra a saída do exemplo, essa alteração é refletida no valor dos elementos de matriz da instância `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-156">As the output from the example shows, this change is reflected in the value of the array elements of the `NumberStore` instance.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]

<span data-ttu-id="1f2a6-157">Sem suporte para valores retornados por referência, essa operação normalmente é executada retornando-se o índice do elemento de matriz, juntamente com o respectivo valor.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-157">Without support for reference return values, such an operation is usually performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="1f2a6-158">O chamador pode usar esse índice para modificar o valor em uma chamada de método separada.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-158">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="1f2a6-159">No entanto, o chamador também pode modificar o índice para acessar e possivelmente modificar outros valores de matriz.</span><span class="sxs-lookup"><span data-stu-id="1f2a6-159">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  
 
## <a name="see-also"></a><span data-ttu-id="1f2a6-160">Consulte também</span><span class="sxs-lookup"><span data-stu-id="1f2a6-160">See also</span></span>

[<span data-ttu-id="1f2a6-161">ref keyword</span><span class="sxs-lookup"><span data-stu-id="1f2a6-161">ref keyword</span></span>](../../language-reference/keywords/ref.md)
