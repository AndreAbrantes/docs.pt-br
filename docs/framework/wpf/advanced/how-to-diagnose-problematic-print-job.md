---
title: 'Como: Diagnosticar um trabalho de impressão problemático'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- troubleshooting print job problems [WPF]
- print jobs [WPF], troubleshooting
- print jobs [WPF], diagnosing problems
ms.assetid: b081a170-84c6-48f9-a487-5766a8d58a82
ms.openlocfilehash: 7a2f6cd76cf44a3a6bd431e53ba0c10d3438037e
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54665793"
---
# <a name="how-to-diagnose-problematic-print-job"></a><span data-ttu-id="99e83-102">Como: Diagnosticar um trabalho de impressão problemático</span><span class="sxs-lookup"><span data-stu-id="99e83-102">How to: Diagnose Problematic Print Job</span></span>
<span data-ttu-id="99e83-103">Administradores de rede frequentemente recebem reclamações de usuários sobre trabalhos de impressão que não são impressos ou são impressos lentamente.</span><span class="sxs-lookup"><span data-stu-id="99e83-103">Network administrators often field complaints from users about print jobs that do not print or print slowly.</span></span> <span data-ttu-id="99e83-104">O conjunto avançado de propriedades do trabalho de impressão exposto no [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] do Microsoft .NET Framework fornecem um meio para executar um diagnóstico remoto rápido dos trabalhos de impressão.</span><span class="sxs-lookup"><span data-stu-id="99e83-104">The rich set of print job properties exposed in the [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] of Microsoft .NET Framework provide a means for performing a rapid remote diagnosis of print jobs.</span></span>  
  
## <a name="example"></a><span data-ttu-id="99e83-105">Exemplo</span><span class="sxs-lookup"><span data-stu-id="99e83-105">Example</span></span>  
 <span data-ttu-id="99e83-106">As principais etapas para criar esse tipo de utilitário são as apresentadas a seguir.</span><span class="sxs-lookup"><span data-stu-id="99e83-106">The major steps for creating this kind of utility are as follows.</span></span>  
  
1.  <span data-ttu-id="99e83-107">Identifique o trabalho de impressão sobre o qual o usuário está reclamando.</span><span class="sxs-lookup"><span data-stu-id="99e83-107">Identify the print job that the user is complaining about.</span></span> <span data-ttu-id="99e83-108">Frequentemente, os usuários não conseguem fazer isso com precisão.</span><span class="sxs-lookup"><span data-stu-id="99e83-108">Users often cannot do this precisely.</span></span> <span data-ttu-id="99e83-109">Talvez eles não saibam os nomes dos servidores de impressão ou impressoras.</span><span class="sxs-lookup"><span data-stu-id="99e83-109">They may not know the names of the print servers or printers.</span></span> <span data-ttu-id="99e83-110">Eles podem descrevem a localização da impressora em uma terminologia diferente da que foi usada na configuração seu <xref:System.Printing.PrintQueue.Location%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="99e83-110">They may describe the location of the printer in different terminology than was used in setting its <xref:System.Printing.PrintQueue.Location%2A> property.</span></span> <span data-ttu-id="99e83-111">Portanto, é uma boa ideia gerar uma lista dos trabalhos enviados atualmente pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="99e83-111">Accordingly, it is a good idea to generate a list of the user's currently submitted jobs.</span></span> <span data-ttu-id="99e83-112">Se houver mais de um, a comunicação entre o usuário e o administrador de sistema de impressão poderá ser usada para identificar o trabalho que está tendo problemas.</span><span class="sxs-lookup"><span data-stu-id="99e83-112">If there is more than one, then communication between the user and the print system administrator can be used to pinpoint the job that is having problems.</span></span> <span data-ttu-id="99e83-113">As subetapas são as seguintes.</span><span class="sxs-lookup"><span data-stu-id="99e83-113">The substeps are as follows.</span></span>  
  
    1.  <span data-ttu-id="99e83-114">Obter uma lista de todos os servidores de impressão.</span><span class="sxs-lookup"><span data-stu-id="99e83-114">Obtain a list of all print servers.</span></span>  
  
    2.  <span data-ttu-id="99e83-115">Executar um loop pelos servidores para consultar suas filas de impressão.</span><span class="sxs-lookup"><span data-stu-id="99e83-115">Loop through the servers to query their print queues.</span></span>  
  
    3.  <span data-ttu-id="99e83-116">Em cada passagem do loop do servidor, percorra em loop todas as filas do servidor para consultar seus trabalhos</span><span class="sxs-lookup"><span data-stu-id="99e83-116">Within each pass of the server loop, loop through all the server's queues to query their jobs</span></span>  
  
    4.  <span data-ttu-id="99e83-117">Em cada passo do loop da fila, percorra em loop sobre seus trabalhos e colete informações de identificação sobre aqueles que foram enviados pelo usuário que fez a reclamação.</span><span class="sxs-lookup"><span data-stu-id="99e83-117">Within each pass of the queue loop, loop through its jobs and gather identifying information about those that were submitted by the complaining user.</span></span>  
  
2.  <span data-ttu-id="99e83-118">Quando o trabalho de impressão problemático for identificado, examine as propriedades relevantes para ver qual pode ser o problema.</span><span class="sxs-lookup"><span data-stu-id="99e83-118">When the problematic print job has been identified, examine relevant properties to see what might be the problem.</span></span> <span data-ttu-id="99e83-119">Por exemplo, o trabalho está em estado de erro ou a impressora que atende a fila ficou offline antes que o trabalho fosse impresso?</span><span class="sxs-lookup"><span data-stu-id="99e83-119">For example, is job in an error state or did the printer servicing the queue go offline before the job could print?</span></span>  
  
 <span data-ttu-id="99e83-120">O código a seguir é uma série de exemplos de código.</span><span class="sxs-lookup"><span data-stu-id="99e83-120">The code below is series of code examples.</span></span> <span data-ttu-id="99e83-121">O primeiro exemplo de código contém o loop pelas filas de impressão.</span><span class="sxs-lookup"><span data-stu-id="99e83-121">The first code example contains the loop through the print queues.</span></span> <span data-ttu-id="99e83-122">(Etapa 1c acima.) A variável `myPrintQueues` é o <xref:System.Printing.PrintQueueCollection> objeto para o servidor de impressão atual.</span><span class="sxs-lookup"><span data-stu-id="99e83-122">(Step 1c above.) The variable `myPrintQueues` is the <xref:System.Printing.PrintQueueCollection> object for the current print server.</span></span>  
  
 <span data-ttu-id="99e83-123">O exemplo de código começa atualizando o objeto de fila de impressão atual com <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="99e83-123">The code example begins by refreshing the current print queue object with <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="99e83-124">Isso garante que as propriedades do objeto representem precisamente o estado da impressora física que ele representa.</span><span class="sxs-lookup"><span data-stu-id="99e83-124">This ensures that the object's properties accurately represent the state of the physical printer that it represents.</span></span> <span data-ttu-id="99e83-125">Em seguida, o aplicativo obtém a coleção de trabalhos de impressão atualmente na fila de impressão usando <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span><span class="sxs-lookup"><span data-stu-id="99e83-125">Then the application gets the collection of print jobs currently in the print queue by using <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span></span>  
  
 <span data-ttu-id="99e83-126">Em seguida o aplicativo faz um loop por meio de <xref:System.Printing.PrintSystemJobInfo> coleta e o compara <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> propriedade com o alias do usuário que fez a reclamação.</span><span class="sxs-lookup"><span data-stu-id="99e83-126">Next the application loops through the <xref:System.Printing.PrintSystemJobInfo> collection and compares each <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> property with the alias of the complaining user.</span></span> <span data-ttu-id="99e83-127">Se forem iguais, o aplicativo adiciona informações de identificação sobre o trabalho à cadeia de caracteres que será apresentada.</span><span class="sxs-lookup"><span data-stu-id="99e83-127">If they match, the application adds identifying information about the job to the string that will be presented.</span></span> <span data-ttu-id="99e83-128">(As variáveis `userName` e `jobList` são inicializadas anteriormente no aplicativo.)</span><span class="sxs-lookup"><span data-stu-id="99e83-128">(The `userName` and `jobList` variables are initialized earlier in the application.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#enumeratejobsinqueues)]
 [!code-csharp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#enumeratejobsinqueues)]
 [!code-vb[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#enumeratejobsinqueues)]  
  
 <span data-ttu-id="99e83-129">O exemplo de código a seguir usa o aplicativo a partir da Etapa 2.</span><span class="sxs-lookup"><span data-stu-id="99e83-129">The next code example picks up the application at Step 2.</span></span> <span data-ttu-id="99e83-130">(Veja acima.) O trabalho problemático foi identificado e o aplicativo solicita as informações que o identificarão.</span><span class="sxs-lookup"><span data-stu-id="99e83-130">(See above.) The problematic job has been identified and the application prompts for the information that will identify it.</span></span> <span data-ttu-id="99e83-131">Com essas informações, ele cria <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, e <xref:System.Printing.PrintSystemJobInfo> objetos.</span><span class="sxs-lookup"><span data-stu-id="99e83-131">From this information it creates <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, and <xref:System.Printing.PrintSystemJobInfo> objects.</span></span>  
  
 <span data-ttu-id="99e83-132">Nesse ponto, o aplicativo contém uma estrutura de ramificação correspondente às duas maneiras de verificar o status do trabalho da impressora:</span><span class="sxs-lookup"><span data-stu-id="99e83-132">At this point the application contains a branching structure corresponding to the two ways of checking a print job's status:</span></span>  
  
-   <span data-ttu-id="99e83-133">Você pode ler os sinalizadores do <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriedade que é do tipo <xref:System.Printing.PrintJobStatus>.</span><span class="sxs-lookup"><span data-stu-id="99e83-133">You can read the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property which is of type <xref:System.Printing.PrintJobStatus>.</span></span>  
  
-   <span data-ttu-id="99e83-134">Você pode ler cada propriedade relevante, como <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> e <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span><span class="sxs-lookup"><span data-stu-id="99e83-134">You can read each relevant property such as <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> and <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span></span>  
  
 <span data-ttu-id="99e83-135">Este exemplo demonstra ambos métodos, o usuário foi previamente consultado sobre qual método usar e respondeu com "Y" se quiser usar os sinalizadores do <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="99e83-135">This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with "Y" if he or she wanted to use the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property.</span></span> <span data-ttu-id="99e83-136">Veja abaixo os detalhes dos dois métodos.</span><span class="sxs-lookup"><span data-stu-id="99e83-136">See below for the details of the two methods.</span></span> <span data-ttu-id="99e83-137">Por fim, o aplicativo usa um método chamado **ReportQueueAndJobAvailability** para relatar se o trabalho pode ser impresso a esta hora do dia.</span><span class="sxs-lookup"><span data-stu-id="99e83-137">Finally, the application uses a method called **ReportQueueAndJobAvailability** to report on whether the job can be printed at this time of day.</span></span> <span data-ttu-id="99e83-138">Esse método é abordado em [Descobrir se um trabalho de impressão pode ser impresso a esta hora do dia](../../../../docs/framework/wpf/advanced/how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span><span class="sxs-lookup"><span data-stu-id="99e83-138">This method is discussed in [Discover Whether a Print Job Can Be Printed At This Time of Day](../../../../docs/framework/wpf/advanced/how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#identifyanddiagnoseproblematicjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#identifyanddiagnoseproblematicjob)]
 [!code-vb[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#identifyanddiagnoseproblematicjob)]  
  
 <span data-ttu-id="99e83-139">Para verificar o status do trabalho de impressão usando os sinalizadores do <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriedade, que você verifique cada sinalizador relevante para ver se ele está definido.</span><span class="sxs-lookup"><span data-stu-id="99e83-139">To check print job status using the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property, you check each relevant flag to see if it is set.</span></span> <span data-ttu-id="99e83-140">O modo padrão para ver se um bit está definido em um conjunto de sinalizadores de bit é realizar uma operação lógica AND com o conjunto de sinalizadores como um operando e o próprio sinalizador como o outro.</span><span class="sxs-lookup"><span data-stu-id="99e83-140">The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.</span></span> <span data-ttu-id="99e83-141">Uma vez que o próprio sinalizador tem apenas um bit definido, o resultado do AND lógico é que, no máximo, esse mesmo bit é definido.</span><span class="sxs-lookup"><span data-stu-id="99e83-141">Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.</span></span> <span data-ttu-id="99e83-142">Para saber se ele é ou não, basta comparar o resultado do AND lógico com o sinalizador em si.</span><span class="sxs-lookup"><span data-stu-id="99e83-142">To find out whether it is or not, just compare the result of the logical AND with the flag itself.</span></span> <span data-ttu-id="99e83-143">Para obter mais informações, consulte <xref:System.Printing.PrintJobStatus>, o [& operador (C# referência)](~/docs/csharp/language-reference/operators/and-operator.md), e <xref:System.FlagsAttribute>.</span><span class="sxs-lookup"><span data-stu-id="99e83-143">For more information, see <xref:System.Printing.PrintJobStatus>, the [& Operator (C# Reference)](~/docs/csharp/language-reference/operators/and-operator.md), and <xref:System.FlagsAttribute>.</span></span>  
  
 <span data-ttu-id="99e83-144">Para cada atributo cujo bit estiver definido, o código relata isso para a tela do console e, às vezes, sugere uma maneira de responder.</span><span class="sxs-lookup"><span data-stu-id="99e83-144">For each attribute whose bit is set, the code reports this to the console screen and sometimes suggests a way to respond.</span></span> <span data-ttu-id="99e83-145">(O método **HandlePausedJob** que é chamado se a fila ou o trabalho estiver em pausa é abordado abaixo.)</span><span class="sxs-lookup"><span data-stu-id="99e83-145">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobattributes)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobattributes)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobattributes)]  
  
 <span data-ttu-id="99e83-146">Para verificar o status do trabalho de impressão usando propriedades separadas, basta ler cada propriedade e, se a propriedade for `true`, relatar isso para a tela do console e, possivelmente, sugerir uma maneira de responder.</span><span class="sxs-lookup"><span data-stu-id="99e83-146">To check print job status using separate properties, you simply read each property and, if the property is `true`, report to the console screen and possibly suggest a way to respond.</span></span> <span data-ttu-id="99e83-147">(O método **HandlePausedJob** que é chamado se a fila ou o trabalho estiver em pausa é abordado abaixo.)</span><span class="sxs-lookup"><span data-stu-id="99e83-147">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobproperties)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobproperties)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobproperties)]  
  
 <span data-ttu-id="99e83-148">O método **HandlePausedJob** permite que o usuário do aplicativo retome remotamente trabalhos em pausa.</span><span class="sxs-lookup"><span data-stu-id="99e83-148">The **HandlePausedJob** method enables the application's user to remotely resume paused jobs.</span></span> <span data-ttu-id="99e83-149">Como pode haver um bom motivo para a fila de impressão ter sido colocada em pausa, o método começa solicitando que o usuário decida se deseja retomá-la.</span><span class="sxs-lookup"><span data-stu-id="99e83-149">Because there might be a good reason why the print queue was paused, the method begins by prompting for a user decision about whether to resume it.</span></span> <span data-ttu-id="99e83-150">Se a resposta for "Y", então o <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> método é chamado.</span><span class="sxs-lookup"><span data-stu-id="99e83-150">If the answer is "Y", then the <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> method is called.</span></span>  
  
 <span data-ttu-id="99e83-151">Em seguida, será solicitado que o decida se o trabalho propriamente dito deve ser retomado, caso ele tenha sido colocado em pausa independentemente da fila de impressão.</span><span class="sxs-lookup"><span data-stu-id="99e83-151">Next the user is prompted to decide if the job itself should be resumed, just in case it is paused independently of the print queue.</span></span> <span data-ttu-id="99e83-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> e <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) Se a resposta for "Y", em seguida <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> é chamado; caso contrário <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> é chamado.</span><span class="sxs-lookup"><span data-stu-id="99e83-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> and <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) If the answer is "Y", then <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> is called; otherwise <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> is called.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#HandlePausedJob](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#handlepausedjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#HandlePausedJob](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#handlepausedjob)]
 [!code-vb[DiagnoseProblematicPrintJob#HandlePausedJob](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#handlepausedjob)]  
  
## <a name="see-also"></a><span data-ttu-id="99e83-153">Consulte também</span><span class="sxs-lookup"><span data-stu-id="99e83-153">See also</span></span>
- <xref:System.Printing.PrintJobStatus>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.FlagsAttribute>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="99e83-154">& Operador (C# referência)</span><span class="sxs-lookup"><span data-stu-id="99e83-154">& Operator (C# Reference)</span></span>](~/docs/csharp/language-reference/operators/and-operator.md)
- [<span data-ttu-id="99e83-155">Documentos no WPF</span><span class="sxs-lookup"><span data-stu-id="99e83-155">Documents in WPF</span></span>](../../../../docs/framework/wpf/advanced/documents-in-wpf.md)
- [<span data-ttu-id="99e83-156">Visão Geral da Impressão</span><span class="sxs-lookup"><span data-stu-id="99e83-156">Printing Overview</span></span>](../../../../docs/framework/wpf/advanced/printing-overview.md)
