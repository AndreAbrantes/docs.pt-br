---
title: Considerações sobre desempenho para interoperabilidade entre Direct3D9 e WPF
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: fd3c99f22a1d097c82494ba6eff344820162ed87
ms.sourcegitcommit: 0c48191d6d641ce88d7510e319cf38c0e35697d0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/05/2019
ms.locfileid: "57356709"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="e6474-102">Considerações sobre desempenho para interoperabilidade entre Direct3D9 e WPF</span><span class="sxs-lookup"><span data-stu-id="e6474-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="e6474-103">Você pode hospedar conteúdo de Direct3D9 usando a <xref:System.Windows.Interop.D3DImage> classe.</span><span class="sxs-lookup"><span data-stu-id="e6474-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="e6474-104">Hospedar conteúdo de Direct3D9 pode afetar o desempenho do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e6474-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="e6474-105">Este tópico descreve as práticas recomendadas para otimizar o desempenho ao hospedar conteúdo de Direct3D9 em um aplicativo WPF (Windows Presentation Foundation).</span><span class="sxs-lookup"><span data-stu-id="e6474-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="e6474-106">Essas práticas recomendadas incluem como usar <xref:System.Windows.Interop.D3DImage> e as práticas recomendadas quando você estiver usando o Windows Vista, Windows XP, e exibe vários monitores.</span><span class="sxs-lookup"><span data-stu-id="e6474-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e6474-107">Para ver exemplos de códigos que demonstram essas práticas recomendadas, consulte [Interoperação Direct3D9 e WPF](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="e6474-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="e6474-108">Use D3DImage com moderação</span><span class="sxs-lookup"><span data-stu-id="e6474-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="e6474-109">Conteúdo de Direct3D9 hospedado em um <xref:System.Windows.Interop.D3DImage> instância não é renderizado tão rapidamente quanto seria em um aplicativo Direct3D puro.</span><span class="sxs-lookup"><span data-stu-id="e6474-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="e6474-110">Copiar a superfície e liberar o buffer de comando podem ser operações dispendiosas.</span><span class="sxs-lookup"><span data-stu-id="e6474-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="e6474-111">Como o número de <xref:System.Windows.Interop.D3DImage> aumentos de instâncias, mais liberação ocorre e afeta o desempenho.</span><span class="sxs-lookup"><span data-stu-id="e6474-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="e6474-112">Portanto, você deve usar <xref:System.Windows.Interop.D3DImage> com moderação.</span><span class="sxs-lookup"><span data-stu-id="e6474-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="e6474-113">Práticas recomendadas no Windows Vista</span><span class="sxs-lookup"><span data-stu-id="e6474-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="e6474-114">Para ter um melhor desempenho no Windows Vista com um visor configurado para usar o WDDM (Windows Display Driver Model), crie sua superfície de Direct3D9 em um dispositivo `IDirect3DDevice9Ex`.</span><span class="sxs-lookup"><span data-stu-id="e6474-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="e6474-115">Isso permite o compartilhamento de superfície.</span><span class="sxs-lookup"><span data-stu-id="e6474-115">This enables surface sharing.</span></span> <span data-ttu-id="e6474-116">A placa de vídeo deve dar suporte aos recursos de driver `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` e `D3DCAPS2_CANSHARERESOURCE` no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e6474-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="e6474-117">Qualquer outra configuração faz com que a superfície seja copiada por meio do software, o que reduz significativamente o desempenho.</span><span class="sxs-lookup"><span data-stu-id="e6474-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e6474-118">Se o Windows Vista tiver um visor configurado para usar o XDDM (Display Driver Model) do Windows XP, a superfície sempre será copiada por meio do software, independentemente das configurações.</span><span class="sxs-lookup"><span data-stu-id="e6474-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="e6474-119">Com as configurações e a placa de vídeo apropriadas, você verá um melhor desempenho no Windows Vista quando usar o WDDM, porque as cópias de superfície são executadas no hardware.</span><span class="sxs-lookup"><span data-stu-id="e6474-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="e6474-120">Práticas recomendadas no Windows XP</span><span class="sxs-lookup"><span data-stu-id="e6474-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="e6474-121">Para obter um melhor desempenho no Windows XP, que usa o XDDM (Display Driver Model) do Windows XP, crie uma superfície bloqueável que se comporta corretamente quando o método `IDirect3DSurface9::GetDC` for chamado.</span><span class="sxs-lookup"><span data-stu-id="e6474-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="e6474-122">Internamente, o método `BitBlt` transfere a superfície em todos os dispositivos do hardware.</span><span class="sxs-lookup"><span data-stu-id="e6474-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="e6474-123">O método `GetDC` sempre funciona em superfícies XRGB.</span><span class="sxs-lookup"><span data-stu-id="e6474-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="e6474-124">No entanto, se o computador cliente estiver executando o Windows XP com SP3 ou SP2 e, se o cliente também tiver o hotfix para o recurso de janela em camadas, esse método só funcionará em superfícies ARGB.</span><span class="sxs-lookup"><span data-stu-id="e6474-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="e6474-125">A placa de vídeo deve dar suporte à capacidade do driver `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES`.</span><span class="sxs-lookup"><span data-stu-id="e6474-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="e6474-126">Uma profundidade de exibição de área de trabalho de 16 bits pode reduzir significativamente o desempenho.</span><span class="sxs-lookup"><span data-stu-id="e6474-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="e6474-127">Recomenda-se uma área de trabalho de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="e6474-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="e6474-128">Se você estiver desenvolvendo para Windows Vista e Windows XP, teste o desempenho no Windows XP.</span><span class="sxs-lookup"><span data-stu-id="e6474-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="e6474-129">A falta de memória de vídeo no Windows XP é uma preocupação.</span><span class="sxs-lookup"><span data-stu-id="e6474-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="e6474-130">Além disso, <xref:System.Windows.Interop.D3DImage> no Windows XP usa mais memória de vídeo e largura de banda que o Windows Vista WDDM, devido a uma cópia de memória de vídeo extra necessária.</span><span class="sxs-lookup"><span data-stu-id="e6474-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="e6474-131">Portanto, você pode esperar que o desempenho seja pior no Windows XP do que no Windows Vista para o mesmo hardware de vídeo.</span><span class="sxs-lookup"><span data-stu-id="e6474-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e6474-132">O XDDM está disponível no Windows XP e Windows Vista. No entanto, o WDDM está disponível apenas no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e6474-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="e6474-133">Práticas recomendadas gerais</span><span class="sxs-lookup"><span data-stu-id="e6474-133">General Best Practices</span></span>  
 <span data-ttu-id="e6474-134">Ao criar o dispositivo, use o sinalizador de criação `D3DCREATE_MULTITHREADED`.</span><span class="sxs-lookup"><span data-stu-id="e6474-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="e6474-135">Isso reduz o desempenho, mas o sistema de renderização do WPF chama métodos neste dispositivo de outro thread.</span><span class="sxs-lookup"><span data-stu-id="e6474-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="e6474-136">Certifique-se de seguir o protocolo de bloqueio corretamente, para que dois threads não acessem o dispositivo ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="e6474-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="e6474-137">Se sua renderização for executada em um thread gerenciado do WPF, será altamente recomendável que você crie o dispositivo com o sinalizador de criação `D3DCREATE_FPU_PRESERVE`.</span><span class="sxs-lookup"><span data-stu-id="e6474-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="e6474-138">Sem essa configuração, a renderização D3D pode reduzir a precisão das operações de precisão dupla do WPF e introduzir problemas de processamento.</span><span class="sxs-lookup"><span data-stu-id="e6474-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="e6474-139">Lado a lado uma <xref:System.Windows.Interop.D3DImage> é rápido, a menos que você lado a lado uma superfície não pow2 sem suporte de hardware, ou se você lado a lado uma <xref:System.Windows.Media.DrawingBrush> ou <xref:System.Windows.Media.VisualBrush> que contém um <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="e6474-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="e6474-140">Práticas recomendadas para visores com vários monitores</span><span class="sxs-lookup"><span data-stu-id="e6474-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="e6474-141">Se estiver usando um computador que tenha vários monitores, você deverá seguir as práticas recomendadas descritas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e6474-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="e6474-142">Também há algumas considerações de desempenho adicionais para uma configuração com vários monitores.</span><span class="sxs-lookup"><span data-stu-id="e6474-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="e6474-143">Quando você cria o buffer de fundo, ele é criado em um adaptador e um dispositivo específico, mas o WPF pode exibir o buffer frontal em qualquer adaptador.</span><span class="sxs-lookup"><span data-stu-id="e6474-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="e6474-144">Copiar entre adaptadores para atualizar o buffer frontal pode ser muito caro.</span><span class="sxs-lookup"><span data-stu-id="e6474-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="e6474-145">No Windows Vista, que está configurado para usar o WDDM com várias placas de vídeo e um dispositivo `IDirect3DDevice9Ex`, se o buffer frontal estiver em um adaptador diferente, mas ainda for a mesma placa de vídeo, não haverá nenhuma penalidade de desempenho.</span><span class="sxs-lookup"><span data-stu-id="e6474-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="e6474-146">No entanto, no Windows XP e no XDDM com várias placas de vídeo, há uma redução de desempenho significativa quando o buffer frontal é exibido em um adaptador diferente do buffer de fundo.</span><span class="sxs-lookup"><span data-stu-id="e6474-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="e6474-147">Para obter mais informações, consulte [Interoperação Direct3D9 e WPF](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="e6474-147">For more information, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="e6474-148">Resumo de desempenho</span><span class="sxs-lookup"><span data-stu-id="e6474-148">Performance Summary</span></span>  
 <span data-ttu-id="e6474-149">A tabela a seguir mostra o desempenho da atualização do buffer frontal como uma função do sistema operacional, do formato de pixel e da capacidade de bloqueio da superfície.</span><span class="sxs-lookup"><span data-stu-id="e6474-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="e6474-150">O buffer frontal e o buffer de fundo devem estar no mesmo adaptador.</span><span class="sxs-lookup"><span data-stu-id="e6474-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="e6474-151">Dependendo da configuração do adaptador, atualizações de hardware geralmente são muito mais rápidas que atualizações de software.</span><span class="sxs-lookup"><span data-stu-id="e6474-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="e6474-152">Formato de pixel da superfície</span><span class="sxs-lookup"><span data-stu-id="e6474-152">Surface pixel format</span></span>|<span data-ttu-id="e6474-153">Windows Vista, WDDM e 9Ex</span><span class="sxs-lookup"><span data-stu-id="e6474-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="e6474-154">Outras configurações do Windows Vista</span><span class="sxs-lookup"><span data-stu-id="e6474-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="e6474-155">Windows XP SP3 ou SP2 com hotfix</span><span class="sxs-lookup"><span data-stu-id="e6474-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="e6474-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="e6474-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="e6474-157">D3DFMT_X8R8G8B8 (não bloqueável)</span><span class="sxs-lookup"><span data-stu-id="e6474-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="e6474-158">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-158">**Hardware Update**</span></span>|<span data-ttu-id="e6474-159">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-159">Software Update</span></span>|<span data-ttu-id="e6474-160">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-160">Software Update</span></span>|<span data-ttu-id="e6474-161">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-161">Software Update</span></span>|  
|<span data-ttu-id="e6474-162">D3DFMT_X8R8G8B8 (bloqueável)</span><span class="sxs-lookup"><span data-stu-id="e6474-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="e6474-163">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-163">**Hardware Update**</span></span>|<span data-ttu-id="e6474-164">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-164">Software Update</span></span>|<span data-ttu-id="e6474-165">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-165">**Hardware Update**</span></span>|<span data-ttu-id="e6474-166">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="e6474-167">D3DFMT_A8R8G8B8 (não bloqueável)</span><span class="sxs-lookup"><span data-stu-id="e6474-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="e6474-168">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-168">**Hardware Update**</span></span>|<span data-ttu-id="e6474-169">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-169">Software Update</span></span>|<span data-ttu-id="e6474-170">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-170">Software Update</span></span>|<span data-ttu-id="e6474-171">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-171">Software Update</span></span>|  
|<span data-ttu-id="e6474-172">D3DFMT_A8R8G8B8 (bloqueável)</span><span class="sxs-lookup"><span data-stu-id="e6474-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="e6474-173">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-173">**Hardware Update**</span></span>|<span data-ttu-id="e6474-174">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-174">Software Update</span></span>|<span data-ttu-id="e6474-175">**Atualização de hardware**</span><span class="sxs-lookup"><span data-stu-id="e6474-175">**Hardware Update**</span></span>|<span data-ttu-id="e6474-176">Atualização de software</span><span class="sxs-lookup"><span data-stu-id="e6474-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e6474-177">Consulte também</span><span class="sxs-lookup"><span data-stu-id="e6474-177">See also</span></span>
- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="e6474-178">Interoperação Direct3D9 e WPF</span><span class="sxs-lookup"><span data-stu-id="e6474-178">WPF and Direct3D9 Interoperation</span></span>](wpf-and-direct3d9-interoperation.md)
- [<span data-ttu-id="e6474-179">Passo a passo: Criando conteúdo Direct3D9 para hospedar no WPF</span><span class="sxs-lookup"><span data-stu-id="e6474-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="e6474-180">Passo a passo: Hospedando conteúdo Direct3D9 no WPF</span><span class="sxs-lookup"><span data-stu-id="e6474-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](walkthrough-hosting-direct3d9-content-in-wpf.md)
