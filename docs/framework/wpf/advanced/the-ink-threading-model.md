---
title: O modelo de threading da tinta
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- application user interface thread [WPF]
- stylus plug-in
- ink threading model [WPF]
- ink [WPF], rendering
- pen thread [WPF]
- threading model [WPF]
- rendering ink [WPF]
- dynamic rendering thread [WPF]
- ink collection plug-in
- plug-ins [WPF], for ink
ms.assetid: c85fcad1-cb50-4431-847c-ac4145a35c89
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: c8eb0cf9f1cbb1be688f228b7bbd10a3a3ca6ed0
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="the-ink-threading-model"></a><span data-ttu-id="162ce-102">O modelo de threading da tinta</span><span class="sxs-lookup"><span data-stu-id="162ce-102">The Ink Threading Model</span></span>
<span data-ttu-id="162ce-103">Um dos benefícios da tinta em um Tablet PC é que ela se parece muito com escrever com uma caneta comum e papel.</span><span class="sxs-lookup"><span data-stu-id="162ce-103">One of the benefits of ink on a Tablet PC is that it feels a lot like writing with a regular pen and paper.</span></span>  <span data-ttu-id="162ce-104">Para fazer isso, a caneta eletrônica coleta dados de entrada a uma taxa muito maior do que um mouse e renderiza a tinta enquanto o usuário escreve.</span><span class="sxs-lookup"><span data-stu-id="162ce-104">To accomplish this, the tablet pen collects input data at a much higher rate than a mouse does and renders the ink as the user writes.</span></span>  <span data-ttu-id="162ce-105">O thread da interface do usuário do aplicativo não é suficiente para coletar dados da caneta e renderizar a tinta, porque ele pode ser bloqueado.</span><span class="sxs-lookup"><span data-stu-id="162ce-105">The application's user interface (UI) thread is not sufficient for collecting pen data and rendering ink, because it can become blocked.</span></span>  <span data-ttu-id="162ce-106">Para resolver isso, um aplicativo [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] usa dois threads adicionais quando um usuário escreve com tinta.</span><span class="sxs-lookup"><span data-stu-id="162ce-106">To solve this, a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application uses two additional threads when a user writes ink.</span></span>  
  
 <span data-ttu-id="162ce-107">A lista a seguir descreve os threads que fazem parte da coleta e renderização da tinta digital:</span><span class="sxs-lookup"><span data-stu-id="162ce-107">The following list describes the threads that take part in collecting and rendering digital ink:</span></span>  
  
-   <span data-ttu-id="162ce-108">Thread de caneta – o thread que coleta dados da caneta.</span><span class="sxs-lookup"><span data-stu-id="162ce-108">Pen thread - the thread that takes input from the stylus.</span></span>  <span data-ttu-id="162ce-109">(Na realidade, trata-se de um pool de threads, mas este tópico refere-se a ele como um thread de caneta.)</span><span class="sxs-lookup"><span data-stu-id="162ce-109">(In reality, this is a thread pool, but this topic refers to it as a pen thread.)</span></span>  
  
-   <span data-ttu-id="162ce-110">Thread da interface do usuário do aplicativo – o thread que controla a interface do usuário do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="162ce-110">Application user interface thread - the thread that controls the user interface of the application.</span></span>  
  
-   <span data-ttu-id="162ce-111">Thread de renderização dinâmica – o thread que renderiza a tinta enquanto o usuário desenha um traço.</span><span class="sxs-lookup"><span data-stu-id="162ce-111">Dynamic rendering thread - the thread that renders the ink while the user draws a stroke.</span></span> <span data-ttu-id="162ce-112">O thread de renderização dinâmica é diferente do thread que renderiza outros elementos da interface do usuário para o aplicativo, conforme mencionado no [Modelo de threading](../../../../docs/framework/wpf/advanced/threading-model.md) da Windows Presentation Foundation.</span><span class="sxs-lookup"><span data-stu-id="162ce-112">The dynamic rendering thread is different than the thread that renders other UI elements for the application, as mentioned in Window Presentation Foundation [Threading Model](../../../../docs/framework/wpf/advanced/threading-model.md).</span></span>  
  
 <span data-ttu-id="162ce-113">O modelo de tinta é o mesmo se o aplicativo usa o <xref:System.Windows.Controls.InkCanvas> ou um controle personalizado semelhante àquele [criando um controle de entrada de tinta](../../../../docs/framework/wpf/advanced/creating-an-ink-input-control.md).</span><span class="sxs-lookup"><span data-stu-id="162ce-113">The inking model is the same whether the application uses the <xref:System.Windows.Controls.InkCanvas> or a custom control similar to the one in [Creating an Ink Input Control](../../../../docs/framework/wpf/advanced/creating-an-ink-input-control.md).</span></span>  <span data-ttu-id="162ce-114">Embora este tópico discute threading em termos do <xref:System.Windows.Controls.InkCanvas>, os mesmos conceitos se aplicam quando você cria um controle personalizado.</span><span class="sxs-lookup"><span data-stu-id="162ce-114">Although this topic discusses threading in terms of the <xref:System.Windows.Controls.InkCanvas>, the same concepts apply when you create a custom control.</span></span>  
  
## <a name="threading-overview"></a><span data-ttu-id="162ce-115">Visão geral do threading</span><span class="sxs-lookup"><span data-stu-id="162ce-115">Threading Overview</span></span>  
 <span data-ttu-id="162ce-116">O diagrama a seguir ilustra o modelo de threading quando um usuário desenha um traço:</span><span class="sxs-lookup"><span data-stu-id="162ce-116">The following diagram illustrates the threading model when a user draws a stroke:</span></span>  
  
 <span data-ttu-id="162ce-117">![Modelo de threading ao desenhar um traço. ] (../../../../docs/framework/wpf/advanced/media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span><span class="sxs-lookup"><span data-stu-id="162ce-117">![Threading model while drawing a stroke.](../../../../docs/framework/wpf/advanced/media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span></span>  
  
1.  <span data-ttu-id="162ce-118">Ações que ocorrem enquanto o usuário desenha o traço</span><span class="sxs-lookup"><span data-stu-id="162ce-118">Actions occurring while the user draws the stroke</span></span>  
  
    1.  <span data-ttu-id="162ce-119">Quando o usuário desenha um traço, os pontos da caneta entram no thread da caneta.</span><span class="sxs-lookup"><span data-stu-id="162ce-119">When the user draws a stroke, the stylus points come in on the pen thread.</span></span>  <span data-ttu-id="162ce-120">Plug-ins de caneta, incluindo o <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, aceite os pontos de caneta no thread de caneta e terá a chance de modificá-las antes do <xref:System.Windows.Controls.InkCanvas> recebe.</span><span class="sxs-lookup"><span data-stu-id="162ce-120">Stylus plug-ins, including the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, accept the stylus points on the pen thread and have the chance to modify them before the <xref:System.Windows.Controls.InkCanvas> receives them.</span></span>  
  
    2.  <span data-ttu-id="162ce-121">O <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renderiza os pontos de caneta no thread de processamento dinâmico.</span><span class="sxs-lookup"><span data-stu-id="162ce-121">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the stylus points on the dynamic rendering thread.</span></span> <span data-ttu-id="162ce-122">Isso acontece ao mesmo tempo em que a etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="162ce-122">This happens at the same time as the previous step.</span></span>  
  
    3.  <span data-ttu-id="162ce-123">O <xref:System.Windows.Controls.InkCanvas> recebe os pontos de caneta no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="162ce-123">The <xref:System.Windows.Controls.InkCanvas> receives the stylus points on the UI thread.</span></span>  
  
2.  <span data-ttu-id="162ce-124">Ações que ocorrem após o usuário terminar o traço</span><span class="sxs-lookup"><span data-stu-id="162ce-124">Actions occurring after the user ends the stroke</span></span>  
  
    1.  <span data-ttu-id="162ce-125">Quando o usuário termina o traço de desenho a <xref:System.Windows.Controls.InkCanvas> cria um <xref:System.Windows.Ink.Stroke> e o adiciona ao <xref:System.Windows.Controls.InkPresenter>, que é processada estaticamente.</span><span class="sxs-lookup"><span data-stu-id="162ce-125">When the user finishes drawing the stroke, the <xref:System.Windows.Controls.InkCanvas> creates a <xref:System.Windows.Ink.Stroke> object and adds it to the <xref:System.Windows.Controls.InkPresenter>, which statically renders it.</span></span>  
  
    2.  <span data-ttu-id="162ce-126">Os alertas de thread de interface do usuário a <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> que o traço é estaticamente renderizado, portanto, o <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> remove sua representação visual do traço.</span><span class="sxs-lookup"><span data-stu-id="162ce-126">The UI thread alerts the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> that the stroke is statically rendered, so the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> removes its visual representation of the stroke.</span></span>  
  
## <a name="ink-collection-and-stylus-plug-ins"></a><span data-ttu-id="162ce-127">Plug-ins de caneta e coleta de tinta</span><span class="sxs-lookup"><span data-stu-id="162ce-127">Ink collection and Stylus Plug-ins</span></span>  
 <span data-ttu-id="162ce-128">Cada <xref:System.Windows.UIElement> tem um <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="162ce-128">Each <xref:System.Windows.UIElement> has a <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  <span data-ttu-id="162ce-129">O <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objetos no <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> recebem e podem modificar os pontos de caneta no thread de caneta.</span><span class="sxs-lookup"><span data-stu-id="162ce-129">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> receive and can modify the stylus points on the pen thread.</span></span> <span data-ttu-id="162ce-130">O <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objetos recebem os pontos de caneta de acordo com sua ordem no <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="162ce-130">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects receive the stylus points according to their order in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  
  
 <span data-ttu-id="162ce-131">O diagrama a seguir ilustra a situação hipotética onde o <xref:System.Windows.UIElement.StylusPlugIns%2A> coleção de um <xref:System.Windows.UIElement> contém `stylusPlugin1`, um <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, e `stylusPlugin2`, nessa ordem.</span><span class="sxs-lookup"><span data-stu-id="162ce-131">The following diagram illustrates the hypothetical situation where the <xref:System.Windows.UIElement.StylusPlugIns%2A> collection of a <xref:System.Windows.UIElement> contains `stylusPlugin1`, a <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, and `stylusPlugin2`, in that order.</span></span>  
  
 <span data-ttu-id="162ce-132">![Ordem dos plug-ins da caneta afeta a saída. ] (../../../../docs/framework/wpf/advanced/media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span><span class="sxs-lookup"><span data-stu-id="162ce-132">![Order of Stylus Plugins affect output.](../../../../docs/framework/wpf/advanced/media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span></span>  
  
 <span data-ttu-id="162ce-133">No diagrama anterior, o seguinte comportamento ocorre:</span><span class="sxs-lookup"><span data-stu-id="162ce-133">In the previous diagram, the following behavior takes place:</span></span>  
  
1.  <span data-ttu-id="162ce-134">`StylusPlugin1` modifica os valores de x e y.</span><span class="sxs-lookup"><span data-stu-id="162ce-134">`StylusPlugin1` modifies the values for x and y.</span></span>  
  
2.  <span data-ttu-id="162ce-135"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>recebe os pontos de caneta modificados e renderiza-os no thread de processamento dinâmico.</span><span class="sxs-lookup"><span data-stu-id="162ce-135"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the modified stylus points and renders them on the dynamic rendering thread.</span></span>  
  
3.  <span data-ttu-id="162ce-136">`StylusPlugin2` recebe os pontos da caneta modificados e modifica mais os valores de x e y.</span><span class="sxs-lookup"><span data-stu-id="162ce-136">`StylusPlugin2` receives the modified stylus points and further modifies the values for x and y.</span></span>  
  
4.  <span data-ttu-id="162ce-137">O aplicativo coleta os pontos da caneta e, quando o usuário termina o traço, renderiza estaticamente o traço.</span><span class="sxs-lookup"><span data-stu-id="162ce-137">The application collects the stylus points, and, when the user finishes the stroke, statically renders the stroke.</span></span>  
  
 <span data-ttu-id="162ce-138">Suponha que `stylusPlugin1` restrinja os pontos da caneta a um retângulo e `stylusPlugin2` mova os pontos da caneta para a direita.</span><span class="sxs-lookup"><span data-stu-id="162ce-138">Suppose that `stylusPlugin1` restricts the stylus points to a rectangle and `stylusPlugin2` translates the stylus points to the right.</span></span>  <span data-ttu-id="162ce-139">No cenário anterior, o <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> recebe os pontos de caneta restrito, mas não os pontos de caneta traduzidos.</span><span class="sxs-lookup"><span data-stu-id="162ce-139">In the previous scenario, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the restricted stylus points, but not the translated stylus points.</span></span>  <span data-ttu-id="162ce-140">Quando o usuário desenha o traço, o traço é renderizado dentro dos limites do retângulo, mas o traço não parece ser movido até que o usuário levante a caneta.</span><span class="sxs-lookup"><span data-stu-id="162ce-140">When the user draws the stroke, the stroke is rendered within the bounds of the rectangle, but the stroke doesn't appear to be translated until the user lifts the pen.</span></span>  
  
### <a name="performing-operations-with-a-stylus-plug-in-on-the-ui-thread"></a><span data-ttu-id="162ce-141">Executando operações com um plug-in de caneta no thread da interface do usuário</span><span class="sxs-lookup"><span data-stu-id="162ce-141">Performing operations with a Stylus Plug-in on the UI thread</span></span>  
 <span data-ttu-id="162ce-142">Como testes de acertos precisos não podem ser executados no thread da caneta, alguns elementos podem, ocasionalmente, receber entradas da caneta destinadas a outros elementos.</span><span class="sxs-lookup"><span data-stu-id="162ce-142">Because accurate hit-testing cannot be performed on the pen thread, some elements might occasionally receive stylus input intended for other elements.</span></span> <span data-ttu-id="162ce-143">Se você precisar certificar-se de que a entrada foi roteada corretamente antes de executar uma operação, assine e execute a operação no <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, ou <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> método.</span><span class="sxs-lookup"><span data-stu-id="162ce-143">If you need to make sure the input was routed correctly before performing an operation, subscribe to and perform the operation in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, or <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> method.</span></span> <span data-ttu-id="162ce-144">Esses métodos são invocados pelo thread do aplicativo após testes de acertos precisos terem sido executados.</span><span class="sxs-lookup"><span data-stu-id="162ce-144">These methods are invoked by the application thread after accurate hit-testing has been performed.</span></span> <span data-ttu-id="162ce-145">Para assinar esses métodos, chame o <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> método no método que ocorre no thread de caneta.</span><span class="sxs-lookup"><span data-stu-id="162ce-145">To subscribe to these methods, call the <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> method in the method that occurs on the pen thread.</span></span>  
  
 <span data-ttu-id="162ce-146">O diagrama a seguir ilustra o relacionamento entre o encadeamento de caneta e o thread de interface do usuário em relação a eventos caneta de um <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span><span class="sxs-lookup"><span data-stu-id="162ce-146">The following diagram illustrates the relationship between the pen thread and UI thread with respect to the stylus events of a <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span></span>  
  
 <span data-ttu-id="162ce-147">![Modelos de threading de tinta &#40;interface do usuário e caneta&#41;](../../../../docs/framework/wpf/advanced/media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span><span class="sxs-lookup"><span data-stu-id="162ce-147">![Ink Threading Models &#40;UI and Pen&#41;](../../../../docs/framework/wpf/advanced/media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span></span>  
  
## <a name="rendering-ink"></a><span data-ttu-id="162ce-148">Renderizando tinta</span><span class="sxs-lookup"><span data-stu-id="162ce-148">Rendering Ink</span></span>  
 <span data-ttu-id="162ce-149">Assim que o usuário desenha um traço, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renderiza a tinta em um thread separado, para que a tinta pareça "fluir" a partir da caneta, mesmo quando o thread de interface do usuário estiver ocupado.</span><span class="sxs-lookup"><span data-stu-id="162ce-149">As the user draws a stroke, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the ink on a separate thread so the ink appears to "flow" from the pen even when the UI thread is busy.</span></span>  <span data-ttu-id="162ce-150">O <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cria uma árvore visual no thread de processamento dinâmico assim que ele coleta pontos de caneta.</span><span class="sxs-lookup"><span data-stu-id="162ce-150">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds a visual tree on the dynamic rendering thread as it collects stylus points.</span></span>  <span data-ttu-id="162ce-151">Quando o usuário termina de traço, o <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> pede para ser notificado quando o aplicativo faz o próximo passo de renderização.</span><span class="sxs-lookup"><span data-stu-id="162ce-151">When the user finishes the stroke, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> asks to be notified when the application does the next rendering pass.</span></span>  <span data-ttu-id="162ce-152">Após o aplicativo concluir a próxima passagem de renderização, o <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> limpa sua árvore visual.</span><span class="sxs-lookup"><span data-stu-id="162ce-152">After the application completes the next rendering pass, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up its visual tree.</span></span>  <span data-ttu-id="162ce-153">O diagrama a seguir ilustra esse processo.</span><span class="sxs-lookup"><span data-stu-id="162ce-153">The following diagram illustrates this process.</span></span>  
  
 <span data-ttu-id="162ce-154">![Diagrama de threading de tinta](../../../../docs/framework/wpf/advanced/media/inkthreading-visualtree.png "InkThreading_VisualTree")</span><span class="sxs-lookup"><span data-stu-id="162ce-154">![Ink threading diagram](../../../../docs/framework/wpf/advanced/media/inkthreading-visualtree.png "InkThreading_VisualTree")</span></span>  
  
1.  <span data-ttu-id="162ce-155">O usuário inicia o traço.</span><span class="sxs-lookup"><span data-stu-id="162ce-155">The user begins the stroke.</span></span>  
  
    1.  <span data-ttu-id="162ce-156">O <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cria a árvore visual.</span><span class="sxs-lookup"><span data-stu-id="162ce-156">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> creates the visual tree.</span></span>  
  
2.  <span data-ttu-id="162ce-157">O usuário está desenhando o traço.</span><span class="sxs-lookup"><span data-stu-id="162ce-157">The user is drawing the stroke.</span></span>  
  
    1.  <span data-ttu-id="162ce-158">O <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cria a árvore visual.</span><span class="sxs-lookup"><span data-stu-id="162ce-158">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds the visual tree.</span></span>  
  
3.  <span data-ttu-id="162ce-159">O usuário termina o traço.</span><span class="sxs-lookup"><span data-stu-id="162ce-159">The user ends the stroke.</span></span>  
  
    1.  <span data-ttu-id="162ce-160">O <xref:System.Windows.Controls.InkPresenter> adiciona o traço à sua árvore visual.</span><span class="sxs-lookup"><span data-stu-id="162ce-160">The <xref:System.Windows.Controls.InkPresenter> adds the stroke to its visual tree.</span></span>  
  
    2.  <span data-ttu-id="162ce-161">A MIL (camada de integração de mídia) renderiza estaticamente os traços.</span><span class="sxs-lookup"><span data-stu-id="162ce-161">The Media Integration Layer (MIL) statically renders the strokes.</span></span>  
  
    3.  <span data-ttu-id="162ce-162">O <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> limpa os elementos visuais.</span><span class="sxs-lookup"><span data-stu-id="162ce-162">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up the visuals.</span></span>
