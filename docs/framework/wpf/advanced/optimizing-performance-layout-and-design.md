---
title: 'Otimizando desempenho: Layout e design'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- layout [WPF], optimizing performance
- design considerations [WPF]
- layout pass [WPF]
ms.assetid: 005f4cda-a849-448b-916b-38d14d9a96fe
ms.openlocfilehash: e62b439926465aa1a61abd39c7c942acf26732c4
ms.sourcegitcommit: 0c48191d6d641ce88d7510e319cf38c0e35697d0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/05/2019
ms.locfileid: "57367929"
---
# <a name="optimizing-performance-layout-and-design"></a><span data-ttu-id="40676-102">Otimizando desempenho: Layout e design</span><span class="sxs-lookup"><span data-stu-id="40676-102">Optimizing Performance: Layout and Design</span></span>
<span data-ttu-id="40676-103">O design de seu aplicativo [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] pode afetar o desempenho criando sobrecarga desnecessária no cálculo de layout e validando referências de objetos.</span><span class="sxs-lookup"><span data-stu-id="40676-103">The design of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application can impact its performance by creating unnecessary overhead in calculating layout and validating object references.</span></span> <span data-ttu-id="40676-104">A construção de objetos, particularmente no tempo de execução, pode afetar as características de desempenho do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="40676-104">The construction of objects, particularly at run time, can affect the performance characteristics of your application.</span></span>  
  
 <span data-ttu-id="40676-105">Este tópico apresenta recomendações de desempenho nessas áreas.</span><span class="sxs-lookup"><span data-stu-id="40676-105">This topic provides performance recommendations in these areas.</span></span>  
  
## <a name="layout"></a><span data-ttu-id="40676-106">Layout</span><span class="sxs-lookup"><span data-stu-id="40676-106">Layout</span></span>  
 <span data-ttu-id="40676-107">O termo "cálculo de layout" descreve o processo de medir e organizar os membros de um <xref:System.Windows.Controls.Panel>-derivados do coleção objeto de filhos e então desenhá-los na tela.</span><span class="sxs-lookup"><span data-stu-id="40676-107">The term "layout pass" describes the process of measuring and arranging the members of a <xref:System.Windows.Controls.Panel>-derived object's collection of children, and then drawing them onscreen.</span></span> <span data-ttu-id="40676-108">O cálculo de layout é um processo matematicamente intensivo: quanto maior o número de filhos na coleção, maior será o número de cálculos necessários.</span><span class="sxs-lookup"><span data-stu-id="40676-108">The layout pass is a mathematically-intensive process—the larger the number of children in the collection, the greater the number of calculations required.</span></span> <span data-ttu-id="40676-109">Por exemplo, cada vez que um filho <xref:System.Windows.UIElement> objeto na coleção muda de posição, ele tem o potencial de disparar uma nova passagem pelo sistema de layout.</span><span class="sxs-lookup"><span data-stu-id="40676-109">For example, each time a child <xref:System.Windows.UIElement> object in the collection changes its position, it has the potential to trigger a new pass by the layout system.</span></span> <span data-ttu-id="40676-110">Devido ao forte relacionamento entre as características de objeto e comportamento de layout, é importante compreender os tipos de eventos que podem invocar o sistema de layout.</span><span class="sxs-lookup"><span data-stu-id="40676-110">Because of the close relationship between object characteristics and layout behavior, it's important to understand the type of events that can invoke the layout system.</span></span> <span data-ttu-id="40676-111">Seu aplicativo terá um desempenho melhor reduzindo ao máximo as invocações desnecessárias do cálculo de layout.</span><span class="sxs-lookup"><span data-stu-id="40676-111">Your application will perform better by reducing as much as possible any unnecessary invocations of the layout pass.</span></span>  
  
 <span data-ttu-id="40676-112">O sistema de layout completa dois cálculos para cada membro filho em uma coleção: um cálculo de medição e um cálculo de organização.</span><span class="sxs-lookup"><span data-stu-id="40676-112">The layout system completes two passes for each child member in a collection: a measure pass, and an arrange pass.</span></span> <span data-ttu-id="40676-113">Cada objeto filho oferece sua própria implementação substituída do <xref:System.Windows.UIElement.Measure%2A> e <xref:System.Windows.UIElement.Arrange%2A> métodos para fornecer seu próprio comportamento específico de layout.</span><span class="sxs-lookup"><span data-stu-id="40676-113">Each child object provides its own overridden implementation of the <xref:System.Windows.UIElement.Measure%2A> and <xref:System.Windows.UIElement.Arrange%2A> methods in order to provide its own specific layout behavior.</span></span> <span data-ttu-id="40676-114">Em sua forma mais simples, o layout é um sistema recursivo que leva a um elemento a ser dimensionado, posicionado e desenhado na tela.</span><span class="sxs-lookup"><span data-stu-id="40676-114">At its simplest, layout is a recursive system that leads to an element being sized, positioned, and drawn onscreen.</span></span>  
  
-   <span data-ttu-id="40676-115">Um filho <xref:System.Windows.UIElement> objeto começa o processo de layout primeiro tendo suas propriedades principais medidas.</span><span class="sxs-lookup"><span data-stu-id="40676-115">A child <xref:System.Windows.UIElement> object begins the layout process by first having its core properties measured.</span></span>  
  
-   <span data-ttu-id="40676-116">O objeto <xref:System.Windows.FrameworkElement> as propriedades relacionadas ao tamanho, como <xref:System.Windows.FrameworkElement.Width%2A>, <xref:System.Windows.FrameworkElement.Height%2A>, e <xref:System.Windows.FrameworkElement.Margin%2A>, são avaliadas.</span><span class="sxs-lookup"><span data-stu-id="40676-116">The object's <xref:System.Windows.FrameworkElement> properties that are related to size, such as <xref:System.Windows.FrameworkElement.Width%2A>, <xref:System.Windows.FrameworkElement.Height%2A>, and <xref:System.Windows.FrameworkElement.Margin%2A>, are evaluated.</span></span>  
  
-   <span data-ttu-id="40676-117"><xref:System.Windows.Controls.Panel>-lógica específica é aplicada, como o <xref:System.Windows.Controls.DockPanel.Dock%2A> propriedade do <xref:System.Windows.Controls.DockPanel>, ou o <xref:System.Windows.Controls.StackPanel.Orientation%2A> propriedade do <xref:System.Windows.Controls.StackPanel>.</span><span class="sxs-lookup"><span data-stu-id="40676-117"><xref:System.Windows.Controls.Panel>-specific logic is applied, such as the <xref:System.Windows.Controls.DockPanel.Dock%2A> property of the <xref:System.Windows.Controls.DockPanel>, or the <xref:System.Windows.Controls.StackPanel.Orientation%2A> property of the <xref:System.Windows.Controls.StackPanel>.</span></span>  
  
-   <span data-ttu-id="40676-118">O conteúdo é organizado, ou posicionado, após a medição de todos os objetos filho.</span><span class="sxs-lookup"><span data-stu-id="40676-118">Content is arranged, or positioned, after all child objects have been measured.</span></span>  
  
-   <span data-ttu-id="40676-119">A coleção de objetos filho é desenhada na tela.</span><span class="sxs-lookup"><span data-stu-id="40676-119">The collection of child objects is drawn to the screen.</span></span>  
  
 <span data-ttu-id="40676-120">O processo de cálculo de layout será invocado novamente se qualquer uma das ações a seguir ocorrer:</span><span class="sxs-lookup"><span data-stu-id="40676-120">The layout pass process is invoked again if any of the following actions occur:</span></span>  
  
-   <span data-ttu-id="40676-121">Um objeto filho é adicionado à coleção.</span><span class="sxs-lookup"><span data-stu-id="40676-121">A child object is added to the collection.</span></span>  
  
-   <span data-ttu-id="40676-122">Um <xref:System.Windows.FrameworkElement.LayoutTransform%2A> é aplicada ao objeto filho.</span><span class="sxs-lookup"><span data-stu-id="40676-122">A <xref:System.Windows.FrameworkElement.LayoutTransform%2A> is applied to the child object.</span></span>  
  
-   <span data-ttu-id="40676-123">O <xref:System.Windows.UIElement.UpdateLayout%2A> método é chamado para o objeto filho.</span><span class="sxs-lookup"><span data-stu-id="40676-123">The <xref:System.Windows.UIElement.UpdateLayout%2A> method is called for the child object.</span></span>  
  
-   <span data-ttu-id="40676-124">Quando ocorre uma alteração ao valor da propriedade de dependência marcada com metadados que afetam a medida ou cálculos da organização.</span><span class="sxs-lookup"><span data-stu-id="40676-124">When a change occurs to the value of a dependency property that is marked with metadata affecting the measure or arrange passes.</span></span>  
  
### <a name="use-the-most-efficient-panel-where-possible"></a><span data-ttu-id="40676-125">Usar o painel mais eficiente quando possível</span><span class="sxs-lookup"><span data-stu-id="40676-125">Use the Most Efficient Panel where Possible</span></span>  
 <span data-ttu-id="40676-126">A complexidade do processo de layout é baseada diretamente no comportamento de layout do <xref:System.Windows.Controls.Panel>-derivados de elementos que você usar.</span><span class="sxs-lookup"><span data-stu-id="40676-126">The complexity of the layout process is directly based on the layout behavior of the <xref:System.Windows.Controls.Panel>-derived elements you use.</span></span> <span data-ttu-id="40676-127">Por exemplo, uma <xref:System.Windows.Controls.Grid> ou <xref:System.Windows.Controls.StackPanel> controle fornece muito mais funcionalidade do que um <xref:System.Windows.Controls.Canvas> controle.</span><span class="sxs-lookup"><span data-stu-id="40676-127">For example, a <xref:System.Windows.Controls.Grid> or <xref:System.Windows.Controls.StackPanel> control provides much more functionality than a <xref:System.Windows.Controls.Canvas> control.</span></span> <span data-ttu-id="40676-128">O preço para esse aumento de funcionalidade é um aumento maior nos custos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="40676-128">The price for this greater increase in functionality is a greater increase in performance costs.</span></span> <span data-ttu-id="40676-129">No entanto, se você não precisar da funcionalidade que um <xref:System.Windows.Controls.Grid> fornece controle, você deve usar as alternativas menos dispendiosas, como um <xref:System.Windows.Controls.Canvas> ou um painel personalizado.</span><span class="sxs-lookup"><span data-stu-id="40676-129">However, if you do not require the functionality that a <xref:System.Windows.Controls.Grid> control provides, you should use the less costly alternatives, such as a <xref:System.Windows.Controls.Canvas> or a custom panel.</span></span>  
  
 <span data-ttu-id="40676-130">Para obter mais informações, consulte [Visão geral dos painéis](../controls/panels-overview.md).</span><span class="sxs-lookup"><span data-stu-id="40676-130">For more information, see [Panels Overview](../controls/panels-overview.md).</span></span>  
  
### <a name="update-rather-than-replace-a-rendertransform"></a><span data-ttu-id="40676-131">Atualizar, em vez de substituir, uma RenderTransform</span><span class="sxs-lookup"><span data-stu-id="40676-131">Update Rather than Replace a RenderTransform</span></span>  
 <span data-ttu-id="40676-132">Você poderá atualizar uma <xref:System.Windows.Media.Transform> em vez de substituí-la como o valor de um <xref:System.Windows.UIElement.RenderTransform%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="40676-132">You may be able to update a <xref:System.Windows.Media.Transform> rather than replacing it as the value of a <xref:System.Windows.UIElement.RenderTransform%2A> property.</span></span> <span data-ttu-id="40676-133">Isso é especialmente verdadeiro em cenários que envolvem animação.</span><span class="sxs-lookup"><span data-stu-id="40676-133">This is particularly true in scenarios that involve animation.</span></span> <span data-ttu-id="40676-134">Atualizando uma existente <xref:System.Windows.Media.Transform>, você evita iniciar um cálculo de layout desnecessário.</span><span class="sxs-lookup"><span data-stu-id="40676-134">By updating an existing <xref:System.Windows.Media.Transform>, you avoid initiating an unnecessary layout calculation.</span></span>  
  
### <a name="build-your-tree-top-down"></a><span data-ttu-id="40676-135">Compilar sua árvore de cima para baixo</span><span class="sxs-lookup"><span data-stu-id="40676-135">Build Your Tree Top-Down</span></span>  
 <span data-ttu-id="40676-136">Quando um nó é adicionado ou removido da árvore lógica, invalidações de propriedade são geradas no pai do nó e todos os seus filhos.</span><span class="sxs-lookup"><span data-stu-id="40676-136">When a node is added or removed from the logical tree, property invalidations are raised on the node's parent and all its children.</span></span> <span data-ttu-id="40676-137">Como resultado, um padrão de construção de cima para baixo deve sempre ser seguido para evitar o custo de invalidações desnecessárias em nós que já foram validados.</span><span class="sxs-lookup"><span data-stu-id="40676-137">As a result, a top-down construction pattern should always be followed to avoid the cost of unnecessary invalidations on nodes that have already been validated.</span></span> <span data-ttu-id="40676-138">A tabela a seguir mostra a diferença no tempo de execução entre compilar uma árvore de cima para baixo versus de baixo para cima, onde a árvore tem 150 níveis de profundidade com um único <xref:System.Windows.Controls.TextBlock> e <xref:System.Windows.Controls.DockPanel> em cada nível.</span><span class="sxs-lookup"><span data-stu-id="40676-138">The following table shows the difference in execution speed between building a tree top-down versus bottom-up, where the tree is 150 levels deep with a single <xref:System.Windows.Controls.TextBlock> and <xref:System.Windows.Controls.DockPanel> at each level.</span></span>  
  
|<span data-ttu-id="40676-139">**Ação**</span><span class="sxs-lookup"><span data-stu-id="40676-139">**Action**</span></span>|<span data-ttu-id="40676-140">**Build da árvore (em ms)**</span><span class="sxs-lookup"><span data-stu-id="40676-140">**Tree building (in ms)**</span></span>|<span data-ttu-id="40676-141">**Renderizar – inclui o build da árvore (em ms)**</span><span class="sxs-lookup"><span data-stu-id="40676-141">**Render—includes tree building (in ms)**</span></span>|  
|----------------|---------------------------------|-------------------------------------------------|  
|<span data-ttu-id="40676-142">De baixo para cima</span><span class="sxs-lookup"><span data-stu-id="40676-142">Bottom-up</span></span>|<span data-ttu-id="40676-143">366</span><span class="sxs-lookup"><span data-stu-id="40676-143">366</span></span>|<span data-ttu-id="40676-144">454</span><span class="sxs-lookup"><span data-stu-id="40676-144">454</span></span>|  
|<span data-ttu-id="40676-145">De cima para baixo</span><span class="sxs-lookup"><span data-stu-id="40676-145">Top-down</span></span>|<span data-ttu-id="40676-146">11</span><span class="sxs-lookup"><span data-stu-id="40676-146">11</span></span>|<span data-ttu-id="40676-147">96</span><span class="sxs-lookup"><span data-stu-id="40676-147">96</span></span>|  
  
 <span data-ttu-id="40676-148">O exemplo de código a seguir demonstra como criar uma árvore de cima para baixo.</span><span class="sxs-lookup"><span data-stu-id="40676-148">The following code example demonstrates how to create a tree top down.</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet1](~/samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet1)]
 [!code-vb[Performance#PerformanceSnippet1](~/samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet1)]  
  
 <span data-ttu-id="40676-149">Para obter mais informações sobre a árvore lógica, consulte [Árvores no WPF](trees-in-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="40676-149">For more information on the logical tree, see [Trees in WPF](trees-in-wpf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="40676-150">Consulte também</span><span class="sxs-lookup"><span data-stu-id="40676-150">See also</span></span>
- [<span data-ttu-id="40676-151">Otimizando o desempenho do aplicativo WPF</span><span class="sxs-lookup"><span data-stu-id="40676-151">Optimizing WPF Application Performance</span></span>](optimizing-wpf-application-performance.md)
- [<span data-ttu-id="40676-152">Planejando para desempenho do aplicativo</span><span class="sxs-lookup"><span data-stu-id="40676-152">Planning for Application Performance</span></span>](planning-for-application-performance.md)
- [<span data-ttu-id="40676-153">Aproveitando o hardware</span><span class="sxs-lookup"><span data-stu-id="40676-153">Taking Advantage of Hardware</span></span>](optimizing-performance-taking-advantage-of-hardware.md)
- [<span data-ttu-id="40676-154">Elementos gráficos e geração de imagens 2D</span><span class="sxs-lookup"><span data-stu-id="40676-154">2D Graphics and Imaging</span></span>](optimizing-performance-2d-graphics-and-imaging.md)
- [<span data-ttu-id="40676-155">Comportamento do objeto</span><span class="sxs-lookup"><span data-stu-id="40676-155">Object Behavior</span></span>](optimizing-performance-object-behavior.md)
- [<span data-ttu-id="40676-156">Recursos do aplicativo</span><span class="sxs-lookup"><span data-stu-id="40676-156">Application Resources</span></span>](optimizing-performance-application-resources.md)
- [<span data-ttu-id="40676-157">Texto</span><span class="sxs-lookup"><span data-stu-id="40676-157">Text</span></span>](optimizing-performance-text.md)
- [<span data-ttu-id="40676-158">Associação de dados</span><span class="sxs-lookup"><span data-stu-id="40676-158">Data Binding</span></span>](optimizing-performance-data-binding.md)
- [<span data-ttu-id="40676-159">Outras recomendações de desempenho</span><span class="sxs-lookup"><span data-stu-id="40676-159">Other Performance Recommendations</span></span>](optimizing-performance-other-recommendations.md)
- [<span data-ttu-id="40676-160">Layout</span><span class="sxs-lookup"><span data-stu-id="40676-160">Layout</span></span>](layout.md)
