---
title: Propriedades de dependência do tipo de coleção
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- properties [WPF], dependency
- properties [WPF], collection-type
- dependency properties [WPF]
- collection-type properties [WPF]
ms.assetid: 99f96a42-3ab7-4f64-a16b-2e10d654e97c
ms.openlocfilehash: 039ae0cb314eba2f1bb3e5b39f2127a5e694f334
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/12/2019
ms.locfileid: "73974151"
---
# <a name="collection-type-dependency-properties"></a><span data-ttu-id="ce7d8-102">Propriedades de dependência do tipo de coleção</span><span class="sxs-lookup"><span data-stu-id="ce7d8-102">Collection-Type Dependency Properties</span></span>
<span data-ttu-id="ce7d8-103">Este tópico fornece diretrizes e padrões sugeridos para como implementar uma propriedade de dependência em que o tipo da propriedade é um tipo de coleção.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-103">This topic provides guidance and suggested patterns for how to implement a dependency property where the type of the property is a collection type.</span></span>  

<a name="implementing"></a>   
## <a name="implementing-a-collection-type-dependency-property"></a><span data-ttu-id="ce7d8-104">Implementando uma Propriedade de Dependência do Tipo de Coleção</span><span class="sxs-lookup"><span data-stu-id="ce7d8-104">Implementing a Collection-Type Dependency Property</span></span>  
 <span data-ttu-id="ce7d8-105">Para uma propriedade de dependência em geral, o padrão de implementação que você segue é definir um wrapper de propriedade CLR, em que essa propriedade é apoiada por um identificador de <xref:System.Windows.DependencyProperty> em vez de um campo ou outro constructo.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-105">For a dependency property in general, the implementation pattern that you follow is that you define a CLR property wrapper, where that property is backed by a <xref:System.Windows.DependencyProperty> identifier rather than a field or other construct.</span></span> <span data-ttu-id="ce7d8-106">Você segue esse mesmo padrão quando implementa uma propriedade de tipo de coleção.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-106">You follow this same pattern when you implement a collection-type property.</span></span> <span data-ttu-id="ce7d8-107">No entanto, uma propriedade do tipo coleção apresenta alguma complexidade ao padrão sempre que o tipo contido na coleção é, por si só, uma <xref:System.Windows.DependencyObject> ou <xref:System.Windows.Freezable> classe derivada.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-107">However, a collection-type property introduces some complexity to the pattern whenever the type that is contained within the collection is itself a <xref:System.Windows.DependencyObject> or <xref:System.Windows.Freezable> derived class.</span></span>  
  
<a name="initializing"></a>   
## <a name="initializing-the-collection-beyond-the-default-value"></a><span data-ttu-id="ce7d8-108">Inicializando a coleção além do valor padrão</span><span class="sxs-lookup"><span data-stu-id="ce7d8-108">Initializing the Collection Beyond the Default Value</span></span>  
 <span data-ttu-id="ce7d8-109">Quando você cria uma propriedade de dependência, você não especificar o valor padrão da propriedade como o valor do campo inicial.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-109">When you create a dependency property, you do not specify the property default value as the initial field value.</span></span> <span data-ttu-id="ce7d8-110">Em vez disso, você pode especificar o valor padrão por meio de metadados de propriedade de dependência.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-110">Instead, you specify the default value through the dependency property metadata.</span></span> <span data-ttu-id="ce7d8-111">Se a propriedade for um tipo de referência, o valor padrão especificado nos metadados de propriedade de dependência não será um valor padrão por instância; em vez disso, será um valor padrão que se aplica a todas as instâncias do tipo.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-111">If your property is a reference type, the default value specified in dependency property metadata is not a default value per instance; instead it is a default value that applies to all instances of the type.</span></span> <span data-ttu-id="ce7d8-112">Portanto, você deve ter cuidado para não usar a coleção estática singular definida pelos metadados de propriedade de coleção como o valor padrão de trabalho para instâncias recém-criadas do seu tipo.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-112">Therefore you must be careful to not use the singular static collection defined by the collection property metadata as the working default value for newly created instances of your type.</span></span> <span data-ttu-id="ce7d8-113">Em vez disso, você deve verificar se definiu deliberadamente o valor da coleção para uma coleção exclusiva (instância) como parte da lógica do construtor de classe.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-113">Instead, you must make sure that you deliberately set the collection value to a unique (instance) collection as part of your class constructor logic.</span></span> <span data-ttu-id="ce7d8-114">Caso contrário, você terá criado uma classe singleton não intencional.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-114">Otherwise you will have created an unintentional singleton class.</span></span>  
  
 <span data-ttu-id="ce7d8-115">Considere o exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-115">Consider the following example.</span></span> <span data-ttu-id="ce7d8-116">A seção a seguir do exemplo mostra a definição de uma classe `Aquarium`, que contém uma falha com o valor padrão.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-116">The following section of the example shows the definition for a class `Aquarium`, which contains a flaw with the default value.</span></span> <span data-ttu-id="ce7d8-117">A classe define a propriedade de dependência de tipo de coleção `AquariumObjects`, que usa o tipo genérico <xref:System.Collections.Generic.List%601> com uma restrição de tipo <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-117">The class defines the collection type dependency property `AquariumObjects`, which uses the generic <xref:System.Collections.Generic.List%601> type with a <xref:System.Windows.FrameworkElement> type constraint.</span></span> <span data-ttu-id="ce7d8-118">Na chamada de <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> para a propriedade de dependência, os metadados estabelecem o valor padrão como um novo <xref:System.Collections.Generic.List%601>genérico.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-118">In the <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> call for the dependency property, the metadata establishes the default value to be a new generic <xref:System.Collections.Generic.List%601>.</span></span>

> [!WARNING]
> <span data-ttu-id="ce7d8-119">O código a seguir não se comporta corretamente.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-119">The following code does not behave correctly.</span></span>

 [!code-csharp[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport2/CSharp/page.xaml.cs#collectionproblemdefinition)]
 [!code-vb[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport2/visualbasic/page.xaml.vb#collectionproblemdefinition)]  
  
 <span data-ttu-id="ce7d8-120">No entanto, se você apenas deixar o código como mostrado, aquele valor padrão de lista será compartilhado para todas as instâncias de `Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-120">However, if you just left the code as shown, that single list default value is shared for all instances of `Aquarium`.</span></span> <span data-ttu-id="ce7d8-121">Se você tiver executado o seguinte código de teste, que destina-se a mostrar como você poderia instanciar duas instâncias separadas de `Aquarium` e adicionado um único `Fish` diferente para cada um deles, você verá um resultado surpreendente:</span><span class="sxs-lookup"><span data-stu-id="ce7d8-121">If you ran the following test code, which is intended to show how you would instantiate two separate `Aquarium` instances and add a single different `Fish` to each of them, you would see a surprising result:</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemtestcode)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemtestcode)]  
  
 <span data-ttu-id="ce7d8-122">Em vez de cada coleção ter uma contagem de um, cada conjunto possui uma contagem de dois.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-122">Instead of each collection having a count of one, each collection has a count of two!</span></span> <span data-ttu-id="ce7d8-123">Isso ocorre porque cada `Aquarium` adicionou `Fish` à coleção de valores padrão, o que resultou de uma única chamada a construtor nos metadados e, portanto, é compartilhado entre todas as instâncias.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-123">This is because each `Aquarium` added its `Fish` to the default value collection, which resulted from a single constructor call in the metadata and is therefore shared between all instances.</span></span> <span data-ttu-id="ce7d8-124">Essa situação quase nunca é o que você deseja.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-124">This situation is almost never what you want.</span></span>  
  
 <span data-ttu-id="ce7d8-125">Para corrigir esse problema, você deve redefinir o valor da propriedade de dependência da coleção para uma instância única, como parte da chamada do construtor de classe.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-125">To correct this problem, you must reset the collection dependency property value to a unique instance, as part of the class constructor call.</span></span> <span data-ttu-id="ce7d8-126">Como a propriedade é uma propriedade de dependência somente leitura, você usa o método <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> para defini-la, usando a <xref:System.Windows.DependencyPropertyKey> que só pode ser acessada dentro da classe.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-126">Because the property is a read-only dependency property, you use the <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> method to set it, using the <xref:System.Windows.DependencyPropertyKey> that is only accessible within the class.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemctor)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemctor)]  
  
 <span data-ttu-id="ce7d8-127">Agora, se você executasse novamente esse mesmo código de teste, você poderia ver resultados mais esperados, no qual cada `Aquarium` daria suporte à sua própria coleção única.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-127">Now, if you ran that same test code again, you could see more expected results, where each `Aquarium` supported its own unique collection.</span></span>  
  
 <span data-ttu-id="ce7d8-128">Haveria uma variação pequena nesse padrão se você optasse por ter sua propriedade da coleção a ser leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-128">There would be a slight variation on this pattern if you chose to have your collection property be read-write.</span></span> <span data-ttu-id="ce7d8-129">Nesse caso, você poderia chamar o acessador set público do construtor para fazer a inicialização, que ainda estaria chamando a assinatura não chave de <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> no seu wrapper definido, usando um identificador de <xref:System.Windows.DependencyProperty> público.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-129">In that case, you could call the public set accessor from the constructor to do the initialization, which would still be calling the nonkey signature of <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> within your set wrapper, using a public <xref:System.Windows.DependencyProperty> identifier.</span></span>  
  
## <a name="reporting-binding-value-changes-from-collection-properties"></a><span data-ttu-id="ce7d8-130">Relatório de alterações de valor de associação de propriedades de coleção</span><span class="sxs-lookup"><span data-stu-id="ce7d8-130">Reporting Binding Value Changes from Collection Properties</span></span>  
 <span data-ttu-id="ce7d8-131">Uma propriedade de coleção que é uma propriedade de dependência não relata automaticamente alterações para suas subpropriedades.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-131">A collection property that is itself a dependency property does not automatically report changes to its subproperties.</span></span> <span data-ttu-id="ce7d8-132">Se você estiver criando vínculos em uma coleção, isso poderá impedir que a associação relate alterações, portanto invalidando alguns cenários de vinculação de dados.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-132">If you are creating bindings into a collection, this can prevent the binding from reporting changes, thus invalidating some data binding scenarios.</span></span> <span data-ttu-id="ce7d8-133">No entanto, se você usar o tipo de coleção <xref:System.Windows.FreezableCollection%601> como o tipo de coleção, subpropriedade alterações nos elementos contidos na coleção serão relatadas corretamente e a associação funcionará conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-133">However, if you use the collection type <xref:System.Windows.FreezableCollection%601> as your collection type, then subproperty changes to contained elements in the collection are properly reported, and binding works as expected.</span></span>  
  
 <span data-ttu-id="ce7d8-134">Para habilitar a associação subpropriedade em uma coleção de objetos de dependência, crie a propriedade de coleção como tipo <xref:System.Windows.FreezableCollection%601>, com uma restrição de tipo para essa coleção para qualquer classe derivada <xref:System.Windows.DependencyObject>.</span><span class="sxs-lookup"><span data-stu-id="ce7d8-134">To enable subproperty binding in a dependency object collection, create the collection property as type <xref:System.Windows.FreezableCollection%601>, with a type constraint for that collection to any <xref:System.Windows.DependencyObject> derived class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ce7d8-135">Consulte também</span><span class="sxs-lookup"><span data-stu-id="ce7d8-135">See also</span></span>

- <xref:System.Windows.FreezableCollection%601>
- [<span data-ttu-id="ce7d8-136">XAML e classes personalizadas para WPF</span><span class="sxs-lookup"><span data-stu-id="ce7d8-136">XAML and Custom Classes for WPF</span></span>](xaml-and-custom-classes-for-wpf.md)
- [<span data-ttu-id="ce7d8-137">Visão geral da vinculação de dados</span><span class="sxs-lookup"><span data-stu-id="ce7d8-137">Data Binding Overview</span></span>](../../../desktop-wpf/data/data-binding-overview.md)
- [<span data-ttu-id="ce7d8-138">Visão geral das propriedades da dependência</span><span class="sxs-lookup"><span data-stu-id="ce7d8-138">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="ce7d8-139">Propriedades de dependência personalizada</span><span class="sxs-lookup"><span data-stu-id="ce7d8-139">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="ce7d8-140">Metadados de propriedade da dependência</span><span class="sxs-lookup"><span data-stu-id="ce7d8-140">Dependency Property Metadata</span></span>](dependency-property-metadata.md)
