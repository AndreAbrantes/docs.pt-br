---
title: Definindo e especificando falhas
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], specifying
- handling faults [WCF], defining
ms.assetid: c00c84f1-962d-46a7-b07f-ebc4f80fbfc1
caps.latest.revision: "13"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 713b9594ac628c2c256e8592d3894feee8029332
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="defining-and-specifying-faults"></a><span data-ttu-id="e1259-102">Definindo e especificando falhas</span><span class="sxs-lookup"><span data-stu-id="e1259-102">Defining and Specifying Faults</span></span>
<span data-ttu-id="e1259-103">Falhas de SOAP transmitem condição informações de erro de um serviço para um cliente e, no caso de duplex, de um cliente para um serviço de forma interoperável.</span><span class="sxs-lookup"><span data-stu-id="e1259-103">SOAP faults convey error condition information from a service to a client and, in the duplex case, from a client to a service in an interoperable way.</span></span> <span data-ttu-id="e1259-104">Este tópico discute quando e como definir o conteúdo de falhas personalizado e especificar quais operações podem retorná-los.</span><span class="sxs-lookup"><span data-stu-id="e1259-104">This topic discusses when and how to define custom fault content and specify which operations can return them.</span></span> [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e1259-105">como um serviço ou cliente duplex, pode enviar as falhas e como um cliente ou aplicativo de serviço lida com essas falhas, consulte [enviando e recebendo falhas](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="e1259-105"> how a service, or duplex client, can send those faults and how a client or service application handles these faults, see [Sending and Receiving Faults](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span></span> <span data-ttu-id="e1259-106">Para obter uma visão geral de tratamento de erros em [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] aplicativos, consulte [especificando e tratamento de falhas em contratos e serviços](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="e1259-106">For an overview of error handling in [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] applications, see [Specifying and Handling Faults in Contracts and Services](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="e1259-107">Visão geral</span><span class="sxs-lookup"><span data-stu-id="e1259-107">Overview</span></span>  
 <span data-ttu-id="e1259-108">Declarado falhas de SOAP são aquelas em que uma operação tem um <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> que especifica um tipo personalizado de falhas SOAP.</span><span class="sxs-lookup"><span data-stu-id="e1259-108">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="e1259-109">Falhas de SOAP não declaradas são aqueles que não são especificados no contrato para uma operação.</span><span class="sxs-lookup"><span data-stu-id="e1259-109">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span> <span data-ttu-id="e1259-110">Este tópico ajuda você a identificar as condições de erro e criar um contrato de falha para o serviço que os clientes podem usar para lidar adequadamente com essas condições de erro quando notificado por falhas de SOAP personalizadas.</span><span class="sxs-lookup"><span data-stu-id="e1259-110">This topic helps you identify those error conditions and create a fault contract for your service that clients can use to properly handle those error conditions when notified by custom SOAP faults.</span></span> <span data-ttu-id="e1259-111">As tarefas básicas são, em ordem:</span><span class="sxs-lookup"><span data-stu-id="e1259-111">The basic tasks are, in order:</span></span>  
  
1.  <span data-ttu-id="e1259-112">Defina as condições de erro que um cliente do seu serviço deve conhecer.</span><span class="sxs-lookup"><span data-stu-id="e1259-112">Define the error conditions that a client of your service should know about.</span></span>  
  
2.  <span data-ttu-id="e1259-113">Defina o conteúdo personalizado das falhas SOAP para essas condições de erro.</span><span class="sxs-lookup"><span data-stu-id="e1259-113">Define the custom content of the SOAP faults for those error conditions.</span></span>  
  
3.  <span data-ttu-id="e1259-114">Marca as operações para que as falhas SOAP específicas que elas geram são expostas aos clientes em WSDL.</span><span class="sxs-lookup"><span data-stu-id="e1259-114">Mark your operations so that the specific SOAP faults that they throw are exposed to clients in WSDL.</span></span>  
  
### <a name="defining-error-conditions-that-clients-should-know-about"></a><span data-ttu-id="e1259-115">Definir condições de erro que os clientes devem saber sobre</span><span class="sxs-lookup"><span data-stu-id="e1259-115">Defining Error Conditions That Clients Should Know About</span></span>  
 <span data-ttu-id="e1259-116">Falhas de SOAP são publicamente descritas mensagens que contêm informações de falha de uma determinada operação.</span><span class="sxs-lookup"><span data-stu-id="e1259-116">SOAP faults are publicly described messages that carry fault information for a particular operation.</span></span> <span data-ttu-id="e1259-117">Porque eles são descritos junto com outras mensagens de operação em WSDL, os clientes saberem e, portanto, esperam lidar com tais falhas ao invocar uma operação.</span><span class="sxs-lookup"><span data-stu-id="e1259-117">Because they are described along with other operation messages in WSDL, clients know and, therefore, expect to handle such faults when invoking an operation.</span></span> <span data-ttu-id="e1259-118">Mas porque [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] serviços são escritos em código gerenciado, decidir qual erro condições em código gerenciado devem ser convertidos em falhas e retornada ao cliente fornece a oportunidade para separar as condições de erro e os bugs no seu serviço a partir de conversa de erro formal com um cliente.</span><span class="sxs-lookup"><span data-stu-id="e1259-118">But because [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] services are written in managed code, deciding which error conditions in managed code are to be converted into faults and returned to the client provides you the opportunity to separate error conditions and bugs in your service from the formal error conversation you have with a client.</span></span>  
  
 <span data-ttu-id="e1259-119">Por exemplo, o exemplo de código a seguir mostra uma operação que utiliza dois inteiros e retorna outro inteiro.</span><span class="sxs-lookup"><span data-stu-id="e1259-119">For example, the following code example shows an operation that takes two integers and returns another integer.</span></span> <span data-ttu-id="e1259-120">Várias exceções podem ser geradas aqui, portanto ao criar o contrato de falha, você deve determinar quais condições de erro são importantes para seu cliente.</span><span class="sxs-lookup"><span data-stu-id="e1259-120">Several exceptions can be thrown here, so when designing the fault contract, you must determine which error conditions are important for your client.</span></span> <span data-ttu-id="e1259-121">Nesse caso, o serviço deve detectar o <xref:System.DivideByZeroException?displayProperty=nameWithType> exceção.</span><span class="sxs-lookup"><span data-stu-id="e1259-121">In this case, the service should detect the <xref:System.DivideByZeroException?displayProperty=nameWithType> exception.</span></span>  
  
```csharp  
[ServiceContract]  
public class CalculatorService  
{  
    [OperationContract]   
    int Divide(int a, int b)  
    {  
      if (b==0) throw new Exception("Division by zero!");  
      return a/b;  
    }  
}  
```  
  
```vb  
<ServiceContract> _  
Public Class CalculatorService  
    <OperationContract]> _  
    Public Function Divide(ByVal a As Integer, ByVal b As Integer) _  
       As Integer  
      If (b==0) Then   
            Throw New Exception("Division by zero!")  
      Return a/b  
    End Function  
End Class  
```  
  
 <span data-ttu-id="e1259-122">No exemplo anterior, a operação pode retornará uma falha SOAP personalizada específicas para a divisão por zero, uma falha personalizada que é específico para as operações matemáticas, mas que contém informações específicas de divisão por zero, várias falhas de vários diferentes situações de erro, ou nenhuma falha SOAP em todos os.</span><span class="sxs-lookup"><span data-stu-id="e1259-122">In the preceding example the operation can either return a custom SOAP fault that is specific to dividing by zero, a custom fault that is specific to math operations but that contains information specific to dividing by zero, multiple faults for several different error situations, or no SOAP fault at all.</span></span>  
  
### <a name="define-the-content-of-error-conditions"></a><span data-ttu-id="e1259-123">Definir o conteúdo das condições de erro</span><span class="sxs-lookup"><span data-stu-id="e1259-123">Define the Content of Error Conditions</span></span>  
 <span data-ttu-id="e1259-124">Depois que uma condição de erro foi identificada como aquele útil pode retornar uma falha SOAP personalizada, a próxima etapa é definir o conteúdo que falha e certifique-se de que a estrutura de conteúdo pode ser serializada.</span><span class="sxs-lookup"><span data-stu-id="e1259-124">Once an error condition has been identified as one that can usefully return a custom SOAP fault, the next step is to define the contents of that fault and ensure that the content structure can be serialized.</span></span> <span data-ttu-id="e1259-125">O exemplo de código na seção anterior mostra um erro específico para um `Divide` operação, mas se há outras operações no `Calculator` de serviço, em seguida, uma única falha SOAP personalizada pode informar ao cliente de todas as condições de erro de cálculo, `Divide`incluídos.</span><span class="sxs-lookup"><span data-stu-id="e1259-125">The code example in the preceding section shows an error specific to a `Divide` operation, but if there are other operations on the `Calculator` service, then a single custom SOAP fault can inform the client of all calculator error conditions, `Divide` included.</span></span> <span data-ttu-id="e1259-126">O exemplo de código a seguir mostra a criação de uma falha SOAP personalizada, `MathFault`, que podem relatar erros feitos usando todas as operações matemáticas, incluindo `Divide`.</span><span class="sxs-lookup"><span data-stu-id="e1259-126">The following code example shows the creation of a custom SOAP fault, `MathFault`, which can report errors made using all math operations, including `Divide`.</span></span> <span data-ttu-id="e1259-127">Enquanto a classe pode especificar uma operação (o `Operation` propriedade) e um valor que descreve o problema (a `ProblemType` propriedade), a classe e essas propriedades devem ser serializáveis devem ser transferidos para o cliente em uma falha SOAP personalizado.</span><span class="sxs-lookup"><span data-stu-id="e1259-127">While the class can specify an operation (the `Operation` property) and a value that describes the problem (the `ProblemType` property), the class and these properties must be serializable to be transferred to the client in a custom SOAP fault.</span></span> <span data-ttu-id="e1259-128">Portanto, o <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> e <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> atributos são usados para tornar serializável e interoperável como possível o tipo e suas propriedades.</span><span class="sxs-lookup"><span data-stu-id="e1259-128">Therefore, the <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> and <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> attributes are used to make the type and its properties serializable and as interoperable as possible.</span></span>  
  
 [!code-csharp[Faults#2](../../../samples/snippets/csharp/VS_Snippets_CFX/faults/cs/service.cs#2)]
 [!code-vb[Faults#2](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faults/vb/service.vb#2)]  
  
 [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e1259-129">como garantir que seus dados é serializável, consulte [especificando a transferência de dados em contratos de serviço](../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="e1259-129"> how to ensure your data is serializable, see [Specifying Data Transfer in Service Contracts](../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md).</span></span> <span data-ttu-id="e1259-130">Para obter uma lista de serialização de suporte que <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> fornece, consulte [tipos suportados pelo serializador de contrato de dados](../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md).</span><span class="sxs-lookup"><span data-stu-id="e1259-130">For a list of the serialization support that <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> provides, see [Types Supported by the Data Contract Serializer](../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md).</span></span>  
  
### <a name="mark-operations-to-establish-the-fault-contract"></a><span data-ttu-id="e1259-131">Operações de marca para estabelecer o contrato de falha</span><span class="sxs-lookup"><span data-stu-id="e1259-131">Mark Operations to Establish the Fault Contract</span></span>  
 <span data-ttu-id="e1259-132">Depois que uma estrutura de dados serializáveis que é retornada como parte de uma falha SOAP personalizada é definida, a última etapa é marcar seu contrato de operação como gerar uma falha SOAP desse tipo.</span><span class="sxs-lookup"><span data-stu-id="e1259-132">Once a serializable data structure that is returned as part of a custom SOAP fault is defined, the last step is to mark your operation contract as throwing a SOAP fault of that type.</span></span> <span data-ttu-id="e1259-133">Para fazer isso, use o <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> de atributos e passar o tipo do tipo de dados personalizado que você tenha criado.</span><span class="sxs-lookup"><span data-stu-id="e1259-133">To do this, use the <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute and pass the type of the custom data type that you have constructed.</span></span> <span data-ttu-id="e1259-134">O exemplo de código a seguir mostra como usar o <xref:System.ServiceModel.FaultContractAttribute> atributo para especificar que o `Divide` operação pode retornar uma falha SOAP do tipo `MathFault`.</span><span class="sxs-lookup"><span data-stu-id="e1259-134">The following code example shows how to use the <xref:System.ServiceModel.FaultContractAttribute> attribute to specify that the `Divide` operation can return a SOAP fault of type `MathFault`.</span></span> <span data-ttu-id="e1259-135">Outras operações matemáticas agora também podem especificar que eles podem retornar um `MathFault`.</span><span class="sxs-lookup"><span data-stu-id="e1259-135">Other math-based operations can now also specify that they can return a `MathFault`.</span></span>  
  
 [!code-csharp[Faults#1](../../../samples/snippets/csharp/VS_Snippets_CFX/faults/cs/service.cs#1)]
 [!code-vb[Faults#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faults/vb/service.vb#1)]  
  
 <span data-ttu-id="e1259-136">Uma operação pode especificar que retorna mais de uma falha personalizada ao marcar essa operação com mais de um <xref:System.ServiceModel.FaultContractAttribute> atributo.</span><span class="sxs-lookup"><span data-stu-id="e1259-136">An operation can specify that it returns more than one custom fault by marking that operation with more than one <xref:System.ServiceModel.FaultContractAttribute> attribute.</span></span>  
  
 <span data-ttu-id="e1259-137">A próxima etapa, para implementar o contrato de falha em sua implementação de operação, é descrita no tópico [enviando e recebendo falhas](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="e1259-137">The next step, to implement the fault contract in your operation implementation, is described in the topic [Sending and Receiving Faults](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span></span>  
  
#### <a name="soap-wsdl-and-interoperability-considerations"></a><span data-ttu-id="e1259-138">Considerações de interoperabilidade, SOAP e WSDL</span><span class="sxs-lookup"><span data-stu-id="e1259-138">SOAP, WSDL, and Interoperability Considerations</span></span>  
 <span data-ttu-id="e1259-139">Em algumas circunstâncias, especialmente ao interagir com outras plataformas, é importante controlar a maneira como uma falha é exibido em uma mensagem SOAP ou a forma como é descrito nos metadados de WSDL.</span><span class="sxs-lookup"><span data-stu-id="e1259-139">In some circumstances, especially when interoperating with other platforms, it may be important to control the way a fault appears in a SOAP message or the way it is described in the WSDL metadata.</span></span>  
  
 <span data-ttu-id="e1259-140">O <xref:System.ServiceModel.FaultContractAttribute> atributo tem um <xref:System.ServiceModel.FaultContractAttribute.Name%2A> propriedade que permite controlar o nome do elemento de falhas WSDL gerado nos metadados para essa falha.</span><span class="sxs-lookup"><span data-stu-id="e1259-140">The <xref:System.ServiceModel.FaultContractAttribute> attribute has a <xref:System.ServiceModel.FaultContractAttribute.Name%2A> property that allows control of the WSDL fault element name that is generated in the metadata for that fault.</span></span>  
  
 <span data-ttu-id="e1259-141">Acordo com o padrão SOAP, uma falha pode ter um `Action`, um `Code`e um `Reason`.</span><span class="sxs-lookup"><span data-stu-id="e1259-141">According to the SOAP standard, a fault can have an `Action`, a `Code`, and a `Reason`.</span></span> <span data-ttu-id="e1259-142">O `Action` é controlado pelo <xref:System.ServiceModel.FaultContractAttribute.Action%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="e1259-142">The `Action` is controlled by the <xref:System.ServiceModel.FaultContractAttribute.Action%2A> property.</span></span> <span data-ttu-id="e1259-143">O <xref:System.ServiceModel.FaultException.Code%2A> propriedade e <xref:System.ServiceModel.FaultException.Reason%2A> propriedade são ambas as propriedades do <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> classe, que é a classe pai de genérica <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e1259-143">The <xref:System.ServiceModel.FaultException.Code%2A> property and <xref:System.ServiceModel.FaultException.Reason%2A> property are both properties of the <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> class, which is the parent class of the generic <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType>.</span></span> <span data-ttu-id="e1259-144">O `Code` propriedade inclui um <xref:System.ServiceModel.FaultCode.SubCode%2A> membro.</span><span class="sxs-lookup"><span data-stu-id="e1259-144">The `Code` property includes a <xref:System.ServiceModel.FaultCode.SubCode%2A> member.</span></span>  
  
 <span data-ttu-id="e1259-145">Ao acessar não serviços que geram falhas, existem certas limitações.</span><span class="sxs-lookup"><span data-stu-id="e1259-145">When accessing non-services that generate faults, certain limitations exist.</span></span> [!INCLUDE[indigo2](../../../includes/indigo2-md.md)]<span data-ttu-id="e1259-146">dá suporte a falhas somente com tipos de detalhe que descreve o esquema e que são compatíveis com os contratos de dados.</span><span class="sxs-lookup"><span data-stu-id="e1259-146"> supports only faults with detail types that the schema describes and that are compatible with data contracts.</span></span> <span data-ttu-id="e1259-147">Por exemplo, como mencionado acima, [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] não oferece suporte a falhas que usam atributos XML em seus tipos de detalhes, ou falhas com mais de um elemento de nível superior na seção de detalhes.</span><span class="sxs-lookup"><span data-stu-id="e1259-147">For example, as mentioned above, [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] does not support faults that use XML attributes in their detail types, or faults with more than one top-level element in the detail section.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e1259-148">Consulte também</span><span class="sxs-lookup"><span data-stu-id="e1259-148">See Also</span></span>  
 <xref:System.ServiceModel.FaultContractAttribute>  
 <xref:System.Runtime.Serialization.DataContractAttribute>  
 <xref:System.Runtime.Serialization.DataMemberAttribute>  
 [<span data-ttu-id="e1259-149">Especificando e lidando com falhas em contratos e serviços</span><span class="sxs-lookup"><span data-stu-id="e1259-149">Specifying and Handling Faults in Contracts and Services</span></span>](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md)  
 [<span data-ttu-id="e1259-150">Enviando e recebendo falhas</span><span class="sxs-lookup"><span data-stu-id="e1259-150">Sending and Receiving Faults</span></span>](../../../docs/framework/wcf/sending-and-receiving-faults.md)  
 [<span data-ttu-id="e1259-151">Como declarar falhas em contratos de serviço</span><span class="sxs-lookup"><span data-stu-id="e1259-151">How to: Declare Faults in Service Contracts</span></span>](../../../docs/framework/wcf/how-to-declare-faults-in-service-contracts.md)  
 [<span data-ttu-id="e1259-152">Noções básicas de nível de proteção</span><span class="sxs-lookup"><span data-stu-id="e1259-152">Understanding Protection Level</span></span>](../../../docs/framework/wcf/understanding-protection-level.md)  
 [<span data-ttu-id="e1259-153">Como definir a propriedade ProtectionLevel</span><span class="sxs-lookup"><span data-stu-id="e1259-153">How to: Set the ProtectionLevel Property</span></span>](../../../docs/framework/wcf/how-to-set-the-protectionlevel-property.md)  
 [<span data-ttu-id="e1259-154">Especificando transferência de dados em contratos de serviço</span><span class="sxs-lookup"><span data-stu-id="e1259-154">Specifying Data Transfer in Service Contracts</span></span>](../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md)
