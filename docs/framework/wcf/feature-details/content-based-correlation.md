---
title: Correlação baseada em conteúdo
ms.date: 03/30/2017
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
ms.openlocfilehash: 48009420788b8678f842c4368926e04f8a745a52
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
---
# <a name="content-based-correlation"></a><span data-ttu-id="b7fc8-102">Correlação baseada em conteúdo</span><span class="sxs-lookup"><span data-stu-id="b7fc8-102">Content Based Correlation</span></span>
<span data-ttu-id="b7fc8-103">Quando os serviços de fluxo de trabalho se comunicar com clientes e outros serviços, geralmente há alguns dados de mensagens trocadas que relaciona exclusivamente uma mensagem para uma determinada instância.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="b7fc8-104">Correlação baseada em conteúdo usa esses dados na mensagem, como um número ou a ordem de ID de cliente, para rotear mensagens para a instância de fluxo de trabalho adequado.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="b7fc8-105">Este tópico explica como usar a correlação baseada em conteúdo em fluxos de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="b7fc8-106">Usando a correlação baseada em conteúdo</span><span class="sxs-lookup"><span data-stu-id="b7fc8-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="b7fc8-107">Correlação baseada em conteúdo é usada quando um serviço de fluxo de trabalho tem vários métodos que são acessados por um único cliente e uma parte dos dados nas mensagens trocadas identifica a instância desejada.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b7fc8-108">Correlação baseada em conteúdo é útil quando a correlação de contexto não pode ser usada porque a associação não é uma das ligações de troca de contexto com suporte.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> <span data-ttu-id="b7fc8-109">Para obter mais informações sobre a correlação de contexto, consulte [intercâmbio de contexto](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="b7fc8-109">For more information about context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="b7fc8-110">Cada atividade mensagens nessas comunicações deve especificar o local dos dados na mensagem que identifica exclusivamente a instância.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="b7fc8-111">Isso é feito fornecendo uma <xref:System.ServiceModel.MessageQuerySet>, usando um <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> ou <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, que consulta a mensagem para a parte ou partes de dados que identificam exclusivamente a instância.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="b7fc8-112">Os dados que são usados para identificar a instância são transformados em uma chave de correlação.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="b7fc8-113">Deve-se ter cuidado para garantir que os dados usados para correlação são exclusivos ou então colisões na chave de hash podem ocorrer e gerar mensagens acabe sendo enviado.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="b7fc8-114">Por exemplo, uma correlação baseada apenas em um nome de cliente pode causar um conflito porque pode haver vários clientes com o mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="b7fc8-115">Os dois-pontos (`:`) não deve ser usado como parte dos dados usados para correlacionar a mensagem porque ele já é usado para delimitar a consulta de mensagem chave e valor para formar a cadeia de caracteres que é transformado em hash posteriormente.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="b7fc8-116">No exemplo a seguir, inicial <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> em um serviço de fluxo de trabalho retorna um `OrderId`, que é passado novamente pelo cliente na chamada para o seguinte <xref:System.ServiceModel.Activities.Receive> atividade no serviço de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="b7fc8-117">O exemplo anterior mostra uma correlação baseada em conteúdo que é inicializada através de <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="b7fc8-118">O <xref:System.ServiceModel.MessageQuerySet> Especifica que os dados usados para identificar mensagens subsequentes para este serviço são o `OrderId`.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="b7fc8-119">O <xref:System.ServiceModel.Activities.Receive> atividade que segue o <xref:System.ServiceModel.Activities.SendReply> no fluxo de trabalho segue a correlação que foi inicializada pelo <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="b7fc8-120">As duas atividades compartilham o mesmo <xref:System.ServiceModel.Activities.CorrelationHandle>, mas cada uma tem seu próprio <xref:System.ServiceModel.MessageQuerySet> e <xref:System.ServiceModel.XPathMessageQuery> que especifica onde os dados que identificam nessa mensagem específica.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="b7fc8-121">Sobre a atividade que inicializa a correlação, isso <xref:System.ServiceModel.MessageQuerySet> é especificado no <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> propriedade e para qualquer das seguintes <xref:System.ServiceModel.Activities.Receive> atividades, for especificado usando o <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="b7fc8-122">Uma correlação baseada em conteúdo pode ser inicializada por qualquer atividade de mensagens (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) quando os dados fluem como parte de uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="b7fc8-123">Se a parte específica de dados de fluxo não como parte de uma mensagem, pode ser inicializado explicitamente usando o <xref:System.ServiceModel.Activities.InitializeCorrelation> atividade.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="b7fc8-124">Se várias partes de dados são necessários para identificar exclusivamente a mensagem, várias consultas podem ser adicionadas para o <xref:System.ServiceModel.MessageQuerySet>.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="b7fc8-125">Nestes exemplos, uma <xref:System.ServiceModel.Activities.CorrelationHandle> foi fornecido explicitamente para cada uma das atividades usando o `CorrelatesWith` ou `CorrelationHandle` propriedades, mas se houver apenas uma correlação necessária para todo o fluxo de trabalho, como neste exemplo onde tudo o que se correlaciona em `OrderId`, o gerenciamento de identificador de correlação implícita fornecido pelo <xref:System.ServiceModel.Activities.WorkflowServiceHost> é suficiente.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="b7fc8-126">Usando a atividade de InitializeCorrelation</span><span class="sxs-lookup"><span data-stu-id="b7fc8-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="b7fc8-127">No exemplo anterior, o `OrderId` fluíram para o chamador por meio de <xref:System.ServiceModel.Activities.SendReply> atividade e isso é onde a correlação foi inicializada.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="b7fc8-128">O mesmo comportamento pode ser feito usando o <xref:System.ServiceModel.Activities.InitializeCorrelation> atividade.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="b7fc8-129">O <xref:System.ServiceModel.Activities.InitializeCorrelation> atividade leva o <xref:System.ServiceModel.Activities.CorrelationHandle> e um dicionário de itens que representam os dados usados para mapear a mensagem para a instância correta.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="b7fc8-130">Para usar o <xref:System.ServiceModel.Activities.InitializeCorrelation> atividade no exemplo anterior, remova o <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> do <xref:System.ServiceModel.Activities.SendReply> atividade e inicializar a correlação usando o <xref:System.ServiceModel.Activities.InitializeCorrelation> atividade.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="b7fc8-131">O <xref:System.ServiceModel.Activities.InitializeCorrelation> atividade é usada no fluxo de trabalho, após as variáveis que mantêm os dados são populados mas antes de <xref:System.ServiceModel.Activities.Receive> atividade que se correlaciona com o inicializado <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="b7fc8-132">Configuração de consultas XPath usando o Designer de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="b7fc8-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="b7fc8-133">Nos exemplos anteriores, as atividades e as consultas XPath usadas em consultas de mensagens foram especificadas no código.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="b7fc8-134">O designer de fluxo de trabalho do [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] também fornece a capacidade de gerar XPaths de `DataContract` tipos para correlação baseada em conteúdo.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="b7fc8-135">O XPath primeiro configurado no exemplo anterior foi configurado para o <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="b7fc8-136">Para configurar o XPath para uma atividade de mensagens no designer de fluxo de trabalho, selecione a atividade no designer de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="b7fc8-137">Se a atividade está inicializando a correlação, como no exemplo anterior, clique no botão de reticências para o **CorrelationInitializers** propriedade o **propriedades** janela.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="b7fc8-138">Isso exibe o **adicionar inicializadores de correlação** janela da caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="b7fc8-139">Essa caixa de diálogo, você pode especificar o tipo de correlação e selecione o conteúdo que é usado para a correlação.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="b7fc8-140">O <xref:System.ServiceModel.Activities.CorrelationHandle> especificada na variável de **adicionar inicializador** caixa e o tipo de correlação e usados para a correlação de dados é selecionado do **consultas XPath** seção da caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="b7fc8-141">![Caixa de diálogo de CorrelationInitializer](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="b7fc8-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="b7fc8-142">A segunda consulta XPath no exemplo anterior foi configurada no <xref:System.ServiceModel.Activities.Receive> atividade.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="b7fc8-143">Para configurar a consulta XPath para uma atividade de mensagens que não inicializa a correlação, selecione a atividade no designer de fluxo de trabalho e, em seguida, clique no botão de reticências para o **CorrelatesOn** propriedade o  **Propriedades** janela.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="b7fc8-144">Isso exibe o **definição de CorrelatesOn** janela da caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="b7fc8-145">![Definição de CorrelatesOn](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="b7fc8-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="b7fc8-146">Nessa caixa de diálogo que você especificar o <xref:System.ServiceModel.Activities.CorrelationHandle> e escolha os itens a **consultas XPath** lista para criar a consulta XPath.</span><span class="sxs-lookup"><span data-stu-id="b7fc8-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
