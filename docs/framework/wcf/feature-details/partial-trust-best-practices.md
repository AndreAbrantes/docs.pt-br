---
title: Práticas recomendadas de confiança parcial
ms.date: 03/30/2017
ms.assetid: 0d052bc0-5b98-4c50-8bb5-270cc8a8b145
ms.openlocfilehash: fca975ff4216384b970535273511eb07cd6ded68
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33497263"
---
# <a name="partial-trust-best-practices"></a><span data-ttu-id="b5584-102">Práticas recomendadas de confiança parcial</span><span class="sxs-lookup"><span data-stu-id="b5584-102">Partial Trust Best Practices</span></span>
<span data-ttu-id="b5584-103">Este tópico descreve as práticas recomendadas ao executar o Windows Communication Foundation (WCF) em um ambiente de confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="b5584-103">This topic describes best practices when running Windows Communication Foundation (WCF) in a partial trust environment.</span></span>  
  
## <a name="serialization"></a><span data-ttu-id="b5584-104">Serialização</span><span class="sxs-lookup"><span data-stu-id="b5584-104">Serialization</span></span>  
 <span data-ttu-id="b5584-105">Aplique as seguintes práticas ao usar o <xref:System.Runtime.Serialization.DataContractSerializer> em um aplicativo parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="b5584-105">Apply the following practices when using the <xref:System.Runtime.Serialization.DataContractSerializer> in a partially-trusted application.</span></span>  
  
-   <span data-ttu-id="b5584-106">Todos os tipos serializáveis devem ser marcados explicitamente com o `[DataContract]` atributo.</span><span class="sxs-lookup"><span data-stu-id="b5584-106">All serializable types must be explicitly marked with the `[DataContract]` attribute.</span></span> <span data-ttu-id="b5584-107">As técnicas a seguir não têm suporte em um ambiente de confiança parcial:</span><span class="sxs-lookup"><span data-stu-id="b5584-107">The following techniques are not supported in a partial trust environment:</span></span>  
  
-   <span data-ttu-id="b5584-108">Marcação de classes para ser serializada com o <xref:System.SerializableAttribute>.</span><span class="sxs-lookup"><span data-stu-id="b5584-108">Marking classes to be serialized with the <xref:System.SerializableAttribute>.</span></span>  
  
-   <span data-ttu-id="b5584-109">Implementando o <xref:System.Runtime.Serialization.ISerializable> interface para permitir que uma classe controlar o processo de serialização.</span><span class="sxs-lookup"><span data-stu-id="b5584-109">Implementing the <xref:System.Runtime.Serialization.ISerializable> interface to allow a class to control its serialization process.</span></span>  
  
### <a name="using-datacontractserializer"></a><span data-ttu-id="b5584-110">Usando o DataContractSerializer</span><span class="sxs-lookup"><span data-stu-id="b5584-110">Using DataContractSerializer</span></span>  
  
-   <span data-ttu-id="b5584-111">Todos os tipos marcados com o `[DataContract]` atributo deve ser público.</span><span class="sxs-lookup"><span data-stu-id="b5584-111">All types marked with the `[DataContract]` attribute must be public.</span></span> <span data-ttu-id="b5584-112">Tipos não públicos não podem ser serializados em um ambiente de confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="b5584-112">Non-public types cannot be serialized in a partial trust environment.</span></span>  
  
-   <span data-ttu-id="b5584-113">Todos os `[DataContract]` membros em um serializável `[DataContract]` tipo deve ser público.</span><span class="sxs-lookup"><span data-stu-id="b5584-113">All `[DataContract]` members in a serializable `[DataContract]` type must be public.</span></span> <span data-ttu-id="b5584-114">Um tipo não público `[DataMember]` não pode ser serializado em um ambiente de confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="b5584-114">A type with a non-public `[DataMember]` cannot be serialized in a partial trust environment.</span></span>  
  
-   <span data-ttu-id="b5584-115">Os métodos que tratam os eventos de serialização (como `OnSerializing`, `OnSerialized`, `OnDeserializing`, e `OnDeserialized`) deve ser declarado como público.</span><span class="sxs-lookup"><span data-stu-id="b5584-115">Methods that handle serialization events (such as `OnSerializing`, `OnSerialized`, `OnDeserializing`, and `OnDeserialized`) must be declared as public.</span></span> <span data-ttu-id="b5584-116">No entanto, as implementações explícitas e implícitas de <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29> têm suporte.</span><span class="sxs-lookup"><span data-stu-id="b5584-116">However, both explicit and implicit implementations of <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29> are supported.</span></span>  
  
-   <span data-ttu-id="b5584-117">`[DataContract]` tipos implementados em assemblies marcados com o <xref:System.Security.AllowPartiallyTrustedCallersAttribute> não deve executar ações relacionadas à segurança no construtor de tipo, como o <xref:System.Runtime.Serialization.DataContractSerializer> não chamar o construtor do objeto recentemente criada durante a desserialização.</span><span class="sxs-lookup"><span data-stu-id="b5584-117">`[DataContract]` types implemented in assemblies marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> must not perform security-related actions in the type constructor, as the <xref:System.Runtime.Serialization.DataContractSerializer> does not call the constructor of the newly-instantiated object during deserialization.</span></span> <span data-ttu-id="b5584-118">Especificamente, as seguintes técnicas comuns de segurança devem ser evitadas para `[DataContract]` tipos:</span><span class="sxs-lookup"><span data-stu-id="b5584-118">Specifically, the following common security techniques must be avoided for `[DataContract]` types:</span></span>  
  
-   <span data-ttu-id="b5584-119">Tentativa de restringir o acesso de confiança parcial, tornando o construtor do tipo interno ou privado.</span><span class="sxs-lookup"><span data-stu-id="b5584-119">Attempting to restrict partial trust access by making the type's constructor internal or private.</span></span>  
  
-   <span data-ttu-id="b5584-120">Restringir o acesso ao tipo adicionando um `[LinkDemand]` para o construtor do tipo.</span><span class="sxs-lookup"><span data-stu-id="b5584-120">Restricting access to the type by adding a `[LinkDemand]` to the type's constructor.</span></span>  
  
-   <span data-ttu-id="b5584-121">Supondo que porque o objeto foi instanciado com êxito, qualquer impostas pelo construtor de verificações de validação passaram com êxito.</span><span class="sxs-lookup"><span data-stu-id="b5584-121">Assuming that because the object has been successfully instantiated, any validation checks enforced by the constructor have passed successfully.</span></span>  
  
### <a name="using-ixmlserializable"></a><span data-ttu-id="b5584-122">Usando IXmlSerializable</span><span class="sxs-lookup"><span data-stu-id="b5584-122">Using IXmlSerializable</span></span>  
 <span data-ttu-id="b5584-123">Práticas recomendadas a seguir se aplicam a tipos que implementam <xref:System.Xml.Serialization.IXmlSerializable> e são serializados usando o <xref:System.Runtime.Serialization.DataContractSerializer>:</span><span class="sxs-lookup"><span data-stu-id="b5584-123">The following best practices apply for types that implement <xref:System.Xml.Serialization.IXmlSerializable> and are serialized using the <xref:System.Runtime.Serialization.DataContractSerializer>:</span></span>  
  
-   <span data-ttu-id="b5584-124">O <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> implementações de método estático devem ser `public`.</span><span class="sxs-lookup"><span data-stu-id="b5584-124">The <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> static method implementations must be `public`.</span></span>  
  
-   <span data-ttu-id="b5584-125">Os métodos de instância que implementam o <xref:System.Xml.Serialization.IXmlSerializable> interface deve ser `public`.</span><span class="sxs-lookup"><span data-stu-id="b5584-125">The instance methods that implement the <xref:System.Xml.Serialization.IXmlSerializable> interface must be `public`.</span></span>  
  
## <a name="using-wcf-from-fully-trusted-platform-code-that-allows-calls-from-partially-trusted-callers"></a><span data-ttu-id="b5584-126">Usando o WCF do código totalmente confiável de plataforma que permite chamadas de parcialmente confiável chamadores</span><span class="sxs-lookup"><span data-stu-id="b5584-126">Using WCF from Fully-Trusted Platform Code that Allows Calls from Partially Trusted Callers</span></span>  
 <span data-ttu-id="b5584-127">O modelo de segurança de confiança parcial do WCF pressupõe que qualquer chamador de uma propriedade ou método público do WCF estiver sendo executado no contexto de segurança (ACS) de acesso de código, do aplicativo host.</span><span class="sxs-lookup"><span data-stu-id="b5584-127">The WCF partial trust security model assumes that any caller of a WCF public method or property is running in the code access security (CAS) context of the hosting application.</span></span> <span data-ttu-id="b5584-128">WCF também assume o contexto de segurança apenas um aplicativo existe para cada <xref:System.AppDomain>, e este contexto estabelecido em <xref:System.AppDomain> hora de criação por um host confiável (por exemplo, por uma chamada para <xref:System.AppDomain.CreateDomain%2A> ou pelo Gerenciador de aplicativos ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="b5584-128">WCF also assumes that only one application security context exists for each <xref:System.AppDomain>, and that this context is established at <xref:System.AppDomain> creation time by a trusted host (for example, by a call to <xref:System.AppDomain.CreateDomain%2A> or by the ASP.NET Application Manager).</span></span>  
  
 <span data-ttu-id="b5584-129">Esse modelo de segurança se aplica a aplicativos gravados pelo usuário que não é possível declarar permissões CAS adicionais, como o código do usuário em execução em um aplicativo ASP.NET de confiança média.</span><span class="sxs-lookup"><span data-stu-id="b5584-129">This security model applies to user-written applications that cannot assert additional CAS permissions, such as user code running in a Medium Trust ASP.NET application.</span></span> <span data-ttu-id="b5584-130">No entanto, o código de plataforma totalmente confiáveis (por exemplo, um assembly de terceiros que está instalado no cache de assembly global e aceita chamadas de código parcialmente confiável) deve tomar cuidado explícito ao chamar WCF em nome de um aplicativo parcialmente confiável para Evite a introdução de vulnerabilidades de segurança de nível de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b5584-130">However, fully-trusted platform code (for example, a third-party assembly that is installed in the global assembly cache and accepts calls from partially-trusted code) must take explicit care when calling into WCF on behalf of a partially-trusted application to avoid introducing application-level security vulnerabilities.</span></span>  
  
 <span data-ttu-id="b5584-131">Código de confiança total evite alterar o conjunto de permissões de CAS do thread atual (chamando <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, ou <xref:System.Security.PermissionSet.Deny%2A>) antes de chamar APIs do WCF em nome de código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="b5584-131">Full-trust code should avoid altering the CAS permission set of the current thread (by calling <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, or <xref:System.Security.PermissionSet.Deny%2A>) prior to calling WCF APIs on behalf of partially-trusted code.</span></span> <span data-ttu-id="b5584-132">Declarando, negar ou caso contrário, criar um contexto de permissão de thread específica que é independente do contexto de segurança de nível de aplicativo pode resultar em comportamento inesperado.</span><span class="sxs-lookup"><span data-stu-id="b5584-132">Asserting, denying, or otherwise creating a thread-specific permission context that is independent of the application-level security context can result in unexpected behavior.</span></span> <span data-ttu-id="b5584-133">Dependendo do aplicativo, esse comportamento pode resultar em vulnerabilidades de segurança de nível de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b5584-133">Depending on the application, this behavior may result in application-level security vulnerabilities.</span></span>  
  
 <span data-ttu-id="b5584-134">Código que chama o WCF usando um contexto de permissões específicas de thread deve estar preparada para lidar com as seguintes situações podem ocorrer:</span><span class="sxs-lookup"><span data-stu-id="b5584-134">Code that calls into WCF using a thread-specific permission context must be prepared to handle the following situations that may arise:</span></span>  
  
-   <span data-ttu-id="b5584-135">O contexto de segurança específicas de thread não pode ser mantido para a duração da operação, o que resulta em exceções de segurança potencial.</span><span class="sxs-lookup"><span data-stu-id="b5584-135">The thread-specific security context may not be maintained for the duration of the operation, which results in potential security exceptions.</span></span>  
  
-   <span data-ttu-id="b5584-136">O código interno do WCF, bem como qualquer retornos de chamada fornecida pelo usuário podem ser executado em um contexto de segurança diferente daquele em que a chamada foi originalmente iniciada.</span><span class="sxs-lookup"><span data-stu-id="b5584-136">Internal WCF code as well as any user-provided callbacks may run in a different security context than the one under which the call was originally initiated.</span></span> <span data-ttu-id="b5584-137">Nesses contextos incluem:</span><span class="sxs-lookup"><span data-stu-id="b5584-137">These contexts include:</span></span>  
  
    -   <span data-ttu-id="b5584-138">O contexto de permissão do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b5584-138">The application permission context.</span></span>  
  
    -   <span data-ttu-id="b5584-139">Qualquer contexto específicas de thread permissão criado anteriormente por outros threads de usuário usados para chamar WCF durante o tempo de vida da execução no momento <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="b5584-139">Any thread-specific permission context previously created by other user threads used to call into WCF during the lifetime of the currently running <xref:System.AppDomain>.</span></span>  
  
 <span data-ttu-id="b5584-140">WCF garante que o código parcialmente confiável não pode obter permissões de confiança total, a menos que essas permissões são declaradas por um componente totalmente confiáveis antes de chamar APIs públicas do WCF.</span><span class="sxs-lookup"><span data-stu-id="b5584-140">WCF guarantees that partially-trusted code cannot obtain full-trust permissions unless such permissions are asserted by a fully-trusted component prior to calling into WCF public APIs.</span></span> <span data-ttu-id="b5584-141">No entanto, eles não garantem que os efeitos de confiança total é isolado a um segmento específico, uma operação ou uma ação do usuário.</span><span class="sxs-lookup"><span data-stu-id="b5584-141">However, it does not guarantee that the effects of asserting full trust is isolated to a particular thread, operation, or user action.</span></span>  
  
 <span data-ttu-id="b5584-142">Como prática recomendada, evite criar contexto de permissões específicas de thread chamando <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, ou <xref:System.Security.PermissionSet.Deny%2A>.</span><span class="sxs-lookup"><span data-stu-id="b5584-142">As a best practice, avoid creating thread-specific permission context by calling <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, or <xref:System.Security.PermissionSet.Deny%2A>.</span></span> <span data-ttu-id="b5584-143">Em vez disso, conceda ou negue o privilégio para o aplicativo em si, para que nenhum <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.Deny%2A>, ou <xref:System.Security.PermissionSet.PermitOnly%2A> é necessário.</span><span class="sxs-lookup"><span data-stu-id="b5584-143">Instead, grant or deny the privilege to the application itself, so that no <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.Deny%2A>, or <xref:System.Security.PermissionSet.PermitOnly%2A> is required.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b5584-144">Consulte também</span><span class="sxs-lookup"><span data-stu-id="b5584-144">See Also</span></span>  
 <xref:System.Runtime.Serialization.DataContractSerializer>  
 <xref:System.Xml.Serialization.IXmlSerializable>
