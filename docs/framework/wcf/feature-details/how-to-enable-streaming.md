---
title: 'Como: habilitar a transmissão'
description: Saiba como habilitar as mensagens transmitidas no WCF em vez das transferências em buffer padrão, que devem ser completamente recebidas antes de serem processadas.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 7f77c406e1cfd4def116a1abe24aa92be74c6abe
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96237736"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="3ce9c-103">Como: habilitar a transmissão</span><span class="sxs-lookup"><span data-stu-id="3ce9c-103">How to: Enable Streaming</span></span>

<span data-ttu-id="3ce9c-104">O Windows Communication Foundation (WCF) pode enviar mensagens usando transferências em buffer ou em fluxo.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-104">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="3ce9c-105">No modo de transferência em buffer padrão, uma mensagem deve ser totalmente entregue antes que um receptor possa lê-la.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-105">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="3ce9c-106">No modo de transferência de streaming, o receptor pode começar a processar a mensagem antes de ser totalmente entregue.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-106">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="3ce9c-107">O modo de streaming é útil quando as informações que são passadas são demoradas e podem ser processadas em série.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-107">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="3ce9c-108">O modo de streaming também é útil quando a mensagem é muito grande para ser totalmente armazenada em buffer.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-108">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="3ce9c-109">Para habilitar o streaming, defina o de forma `OperationContract` apropriada e habilite o streaming no nível de transporte.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-109">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="3ce9c-110">Para transmitir dados</span><span class="sxs-lookup"><span data-stu-id="3ce9c-110">To stream data</span></span>  
  
1. <span data-ttu-id="3ce9c-111">Para transmitir dados, o `OperationContract` para o serviço deve atender a dois requisitos:</span><span class="sxs-lookup"><span data-stu-id="3ce9c-111">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="3ce9c-112">O parâmetro que mantém os dados a serem transmitidos deve ser o único parâmetro no método.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-112">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="3ce9c-113">Por exemplo, se a mensagem de entrada for aquela a ser transmitida, a operação deverá ter exatamente um parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-113">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="3ce9c-114">Da mesma forma, se a mensagem de saída for para ser transmitida, a operação deverá ter exatamente um parâmetro de saída ou um valor de retorno.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-114">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="3ce9c-115">Pelo menos um dos tipos do parâmetro e do valor de retorno deve ser <xref:System.IO.Stream> , <xref:System.ServiceModel.Channels.Message> ou <xref:System.Xml.Serialization.IXmlSerializable> .</span><span class="sxs-lookup"><span data-stu-id="3ce9c-115">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="3ce9c-116">Veja a seguir um exemplo de um contrato para dados transmitidos.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-116">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="3ce9c-117">A `GetStream` operação recebe alguns dados de entrada em buffer como um `string` , que é armazenado em buffer e retorna um `Stream` , que é transmitido.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-117">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="3ce9c-118">Por outro lado `UploadStream` , o leva em um `Stream` (transmitido) e retorna um `bool` (em buffer).</span><span class="sxs-lookup"><span data-stu-id="3ce9c-118">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="3ce9c-119">`EchoStream` Pega e retorna `Stream` e é um exemplo de uma operação cujas mensagens de entrada e saída são transmitidas.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-119">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="3ce9c-120">Por fim, `GetReversedStream` o não usa entradas e retorna um `Stream` (transmitido).</span><span class="sxs-lookup"><span data-stu-id="3ce9c-120">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="3ce9c-121">O streaming deve ser habilitado na associação.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-121">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="3ce9c-122">Você define uma `TransferMode` propriedade, que pode usar um dos seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="3ce9c-122">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="3ce9c-123">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="3ce9c-123">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="3ce9c-124">`Streamed`, que permite a comunicação de streaming em ambas as direções.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-124">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="3ce9c-125">`StreamedRequest`, que permite transmitir apenas a solicitação.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-125">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="3ce9c-126">`StreamedResponse`, que permite transmitir apenas a resposta.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-126">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="3ce9c-127">O `BasicHttpBinding` expõe a `TransferMode` Propriedade na associação, como faz `NetTcpBinding` e `NetNamedPipeBinding` .</span><span class="sxs-lookup"><span data-stu-id="3ce9c-127">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="3ce9c-128">A `TransferMode` propriedade também pode ser definida no elemento de associação de transporte e usada em uma associação personalizada.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-128">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="3ce9c-129">Os exemplos a seguir mostram como definir `TransferMode` pelo código e alterando o arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-129">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="3ce9c-130">Os exemplos também definem a `maxReceivedMessageSize` propriedade como 64 MB, que coloca um limite no tamanho máximo permitido de mensagens em recebimento.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-130">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="3ce9c-131">O padrão `maxReceivedMessageSize` é 64 KB, que geralmente é muito baixo para cenários de streaming.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-131">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="3ce9c-132">Defina essa configuração de cota conforme apropriado, dependendo do tamanho máximo das mensagens que seu aplicativo espera receber.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-132">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="3ce9c-133">Observe também que `maxBufferSize` o controla o tamanho máximo que é armazenado em buffer e o define adequadamente.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-133">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="3ce9c-134">O trecho de configuração a seguir do exemplo mostra a configuração da `TransferMode` propriedade como streaming no `basicHttpBinding` e uma associação http personalizada.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-134">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="3ce9c-135">O trecho de código a seguir mostra a configuração da `TransferMode` propriedade como streaming no `basicHttpBinding` e uma associação http personalizada.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-135">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="3ce9c-136">O trecho de código a seguir mostra a configuração da `TransferMode` propriedade como streaming em uma associação TCP personalizada.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-136">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="3ce9c-137">As operações `GetStream` , `UploadStream` e `EchoStream` todas lidam com o envio de dados diretamente de um arquivo ou salvam dados recebidos diretamente em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-137">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="3ce9c-138">O código a seguir é para `GetStream` .</span><span class="sxs-lookup"><span data-stu-id="3ce9c-138">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="3ce9c-139">Escrevendo um fluxo personalizado</span><span class="sxs-lookup"><span data-stu-id="3ce9c-139">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="3ce9c-140">Para fazer um processamento especial em cada parte de um fluxo de dados como ele está sendo enviado ou recebido, derive uma classe de fluxo personalizada de <xref:System.IO.Stream> .</span><span class="sxs-lookup"><span data-stu-id="3ce9c-140">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="3ce9c-141">Como um exemplo de um fluxo personalizado, o código a seguir contém um `GetReversedStream` método e uma `ReverseStream` classe-.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-141">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="3ce9c-142">`GetReversedStream` Cria e retorna uma nova instância do `ReverseStream` .</span><span class="sxs-lookup"><span data-stu-id="3ce9c-142">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="3ce9c-143">O processamento real ocorre à medida que o sistema lê do `ReverseStream` objeto.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-143">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="3ce9c-144">O `ReverseStream.Read` método lê um bloco de bytes do arquivo subjacente, reverte-os e retorna os bytes invertidos.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-144">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="3ce9c-145">Esse método não reverte todo o conteúdo do arquivo; Ele reverte uma parte de bytes de cada vez.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-145">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="3ce9c-146">Este exemplo mostra como você pode executar o processamento de fluxo, pois o conteúdo está sendo lido ou gravado no fluxo.</span><span class="sxs-lookup"><span data-stu-id="3ce9c-146">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="3ce9c-147">Veja também</span><span class="sxs-lookup"><span data-stu-id="3ce9c-147">See also</span></span>

- [<span data-ttu-id="3ce9c-148">Dados grandes e streaming</span><span class="sxs-lookup"><span data-stu-id="3ce9c-148">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="3ce9c-149">STREAM</span><span class="sxs-lookup"><span data-stu-id="3ce9c-149">Stream</span></span>](../samples/stream.md)
