---
title: "Extensibilidade de host de serviço do fluxo de trabalho"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: c0e8f7bb-cb13-49ec-852f-b85d7c23972f
caps.latest.revision: "14"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 29e4fb590733392ebae10fe1ad18781653c0d202
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/02/2017
---
# <a name="workflow-service-host-extensibility"></a><span data-ttu-id="e7dac-102">Extensibilidade de host de serviço do fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="e7dac-102">Workflow Service Host Extensibility</span></span>
[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]<span data-ttu-id="e7dac-103">fornece o <xref:System.ServiceModel.Activities.WorkflowServiceHost> classe para hospedar os serviços de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-103"> provides the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class for hosting workflow services.</span></span> <span data-ttu-id="e7dac-104">Essa classe é usada quando você usa a auto-hospedagem um serviço de fluxo de trabalho em um aplicativo gerenciado ou um serviço do Windows.</span><span class="sxs-lookup"><span data-stu-id="e7dac-104">This class is used when you are self-hosting a workflow service in a managed application or a Windows service.</span></span> <span data-ttu-id="e7dac-105">Essa classe também é usada ao hospedar um serviço de fluxo de trabalho com serviços de informações da Internet (IIS) ou o serviço de ativação de processos do Windows (WAS).</span><span class="sxs-lookup"><span data-stu-id="e7dac-105">This class is also used when hosting a workflow service with Internet Information Services (IIS) or Windows Process Activation Service (WAS).</span></span> <span data-ttu-id="e7dac-106">O <xref:System.ServiceModel.Activities.WorkflowServiceHost> classe fornece pontos de extensão que permitem adicionar extensões personalizadas, alterar o comportamento ocioso e hospedar fluxos de trabalho sem serviço (fluxos de trabalho que não usam atividades de mensagens).</span><span class="sxs-lookup"><span data-stu-id="e7dac-106">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> class provides extension points that allow you to add custom extensions, change the idle behavior, and host non-service workflows (workflows that do not use messaging activities).</span></span>  
  
## <a name="workflow-service-host-extensions"></a><span data-ttu-id="e7dac-107">Extensões de Host do serviço de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="e7dac-107">Workflow Service Host Extensions</span></span>  
 <span data-ttu-id="e7dac-108">O <xref:System.ServiceModel.Activities.WorkflowServiceHost> contém um <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> propriedade do tipo <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> que fornece métodos para adicionar extensões para o <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="e7dac-108">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> contains a <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> property of type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> that provides methods to add extensions to the <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="e7dac-109">Use o <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> método para adicionar uma extensão para cada instância de serviço de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-109">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service instance.</span></span> <span data-ttu-id="e7dac-110">O delegado especificado é chamado para criar uma nova extensão quando uma instância de serviço de fluxo de trabalho é criada ou carregada de um repositório de persistência.</span><span class="sxs-lookup"><span data-stu-id="e7dac-110">The delegate specified is called to create a new extension when a workflow service instance is created or loaded from a persistence store.</span></span> <span data-ttu-id="e7dac-111">Use o <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> método para adicionar uma extensão para cada host de serviço de fluxo de trabalho, uma instância da extensão é compartilhada para todas as instâncias de serviço de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-111">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service host, one instance of the extension is shared for all workflow service instances.</span></span>  
  
## <a name="react-to-unhandled-exceptions"></a><span data-ttu-id="e7dac-112">Reagir às exceções não tratadas</span><span class="sxs-lookup"><span data-stu-id="e7dac-112">React to Unhandled Exceptions</span></span>  
 <span data-ttu-id="e7dac-113">O <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> permite que você especifique a ação a ser tomada se uma exceção não tratada ocorrer dentro de um serviço de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-113">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> enables you to specify the action to take if an unhandled exception occurs within a workflow service.</span></span> <span data-ttu-id="e7dac-114">O <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> propriedade especifica o <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> valores:</span><span class="sxs-lookup"><span data-stu-id="e7dac-114">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> property specifies one of the <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> values:</span></span>  
  
-   <span data-ttu-id="e7dac-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon>– Anula a instância do serviço de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Aborts the workflow service instance.</span></span>  
  
-   <span data-ttu-id="e7dac-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend>– Reverte para o último estado persistente e suspende a instância do serviço de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Rolls back to the last persisted state and suspends the workflow service instance.</span></span> <span data-ttu-id="e7dac-117">Isso ocorre apenas se o fluxo de trabalho já havia sido persistido pelo menos uma vez.</span><span class="sxs-lookup"><span data-stu-id="e7dac-117">This only occurs if the workflow has already been persisted at least once.</span></span> <span data-ttu-id="e7dac-118">Se não for a instância de fluxo de trabalho foi anulada.</span><span class="sxs-lookup"><span data-stu-id="e7dac-118">If not the workflow instance is aborted.</span></span>  
  
-   <span data-ttu-id="e7dac-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel>– Cancela a instância.</span><span class="sxs-lookup"><span data-stu-id="e7dac-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Cancels the instance.</span></span>  
  
-   <span data-ttu-id="e7dac-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate>– Finaliza a instância.</span><span class="sxs-lookup"><span data-stu-id="e7dac-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Terminates the instance.</span></span>  
  
 <span data-ttu-id="e7dac-121">Esse comportamento pode ser configurado no código, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e7dac-121">This behavior can be configured in code as shown in the following example.</span></span>  
  
```csharp  
host.Description.Behaviors.Add(new WorkflowUnhandledExceptionBehavior { Action = WorkflowUnhandledExceptionAction.Abandon });  
```  
  
 <span data-ttu-id="e7dac-122">Ele também pode ser configurado em um arquivo de configuração, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e7dac-122">It can also be configured in a configuration file as shown in the following example.</span></span>  
  
```xml
<behaviors>  
      <serviceBehaviors>  
        <behavior>  
          <serviceMetadata httpGetEnabled="True"/>  
          <serviceDebug includeExceptionDetailInFaults="False" />  
          <workflowUnhandledExceptionBehavior action="Abandon" />        
        </behavior>  
      </serviceBehaviors>  
```  
  
## <a name="hosting-non-service-workflows"></a><span data-ttu-id="e7dac-123">Hospedando fluxos de trabalho sem serviço</span><span class="sxs-lookup"><span data-stu-id="e7dac-123">Hosting Non-Service Workflows</span></span>  
 <span data-ttu-id="e7dac-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost>pode ser usado para hospedar fluxos de trabalho sem serviço ou fluxos de trabalho que o não começar com um <xref:System.ServiceModel.Activities.Receive> atividade ou fluxos de trabalho que não usam as atividades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="e7dac-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> can be used to host non-service workflows, or workflows that either do not begin with a <xref:System.ServiceModel.Activities.Receive> activity or workflows that do not use the messaging activities.</span></span> <span data-ttu-id="e7dac-125">Serviços de fluxo de trabalho normalmente começam com um <xref:System.ServiceModel.Activities.Receive> atividade.</span><span class="sxs-lookup"><span data-stu-id="e7dac-125">Workflow services normally begin with a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="e7dac-126">Quando o <xref:System.ServiceModel.Activities.WorkflowServiceHost> recebe uma mensagem para um serviço de fluxo de trabalho, se ele não estiver sendo executado (ou persistentes) uma nova instância de serviço de fluxo de trabalho é criado.</span><span class="sxs-lookup"><span data-stu-id="e7dac-126">When the <xref:System.ServiceModel.Activities.WorkflowServiceHost> receives a message for a workflow service, if it is not already running (or persisted) a new workflow service instance is created.</span></span> <span data-ttu-id="e7dac-127">Se um fluxo de trabalho não começar com uma atividade de recebimento, não pode ser iniciado ao enviar uma mensagem porque não há nenhuma atividade para receber a mensagem.</span><span class="sxs-lookup"><span data-stu-id="e7dac-127">If a workflow does not begin with a Receive activity, it cannot be started by sending a message because there is no activity to receive the message.</span></span> <span data-ttu-id="e7dac-128">Para hospedar um fluxo de trabalho sem serviço, derive uma classe de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> e substituir <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, e <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7dac-128">To host a non-service workflow, derive a class from <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> and override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, and <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span></span> <span data-ttu-id="e7dac-129">Substituir <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> se você deseja fornecer uma ID de instância preferencial.</span><span class="sxs-lookup"><span data-stu-id="e7dac-129">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> if you want to provide a preferred instance ID.</span></span> <span data-ttu-id="e7dac-130">Substituir <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> para criar um contexto de criação de fluxo de trabalho personalizado ou preencher uma instância do existente <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span><span class="sxs-lookup"><span data-stu-id="e7dac-130">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> to create a custom workflow creation context or populate an instance of the existing <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span></span> <span data-ttu-id="e7dac-131">Substituir <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> para extrair manualmente o indicador de mensagem de entrada.</span><span class="sxs-lookup"><span data-stu-id="e7dac-131">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> to manually extract the bookmark from the incoming message.</span></span> <span data-ttu-id="e7dac-132">Se você substituir esse método, você deve chamar <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> em seu corpo para responder à mensagem enviada para o WorkflowHostingEndpoint.</span><span class="sxs-lookup"><span data-stu-id="e7dac-132">If you override this method, you must invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in its body so as to respond to the message sent to the WorkflowHostingEndpoint.</span></span> <span data-ttu-id="e7dac-133">Se você não fizer isso, um <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limite pode ser eventualmente excedido.</span><span class="sxs-lookup"><span data-stu-id="e7dac-133">If you do not do so, a <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limit may be eventually exceeded.</span></span> <span data-ttu-id="e7dac-134">Em contratos bidirecionais, você pode ser capaz de detectar a falha para chamar <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> devido a falha do cliente para receber uma resposta.</span><span class="sxs-lookup"><span data-stu-id="e7dac-134">In two-way contracts, you may be able to detect your   failure to invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> because of the client’s failure to receive a response.</span></span> <span data-ttu-id="e7dac-135">Em contratos unidirecionais, você pode não reconhecer o erro de falha ao chamar <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> até que seja muito tarde, após o <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limite for excedido.</span><span class="sxs-lookup"><span data-stu-id="e7dac-135">In one-way contracts, you may not recognize the mistake of failing to call <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> until it’s too late, after the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> throttle limit is exceeded.</span></span> <span data-ttu-id="e7dac-136">Para obter mais informações, consulte o [WorkflowHostingEndpoint retomar indicador](../../../../docs/framework/windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)para criar uma nova instância de fluxo de trabalho sem serviço, declare um contrato de serviço que define uma operação que cria uma nova instância.</span><span class="sxs-lookup"><span data-stu-id="e7dac-136">For more information, please see the [WorkflowHostingEndpoint Resume Bookmark](../../../../docs/framework/windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)To create a new instance of a non-service workflow, declare a service contract that defines an operation that creates a new instance.</span></span> <span data-ttu-id="e7dac-137">A operação de criação deve levar a um IDictionary\<de cadeia de caracteres, objeto > para passar por nenhuma necessários parâmetros de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e7dac-137">The creation operation should take an IDictionary\<string, object> to pass any required workflow parameters.</span></span> <span data-ttu-id="e7dac-138">Este contrato é implementado implicitamente pelo <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-classe derivada.</span><span class="sxs-lookup"><span data-stu-id="e7dac-138">This contract is implicitly implemented by the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class.</span></span> <span data-ttu-id="e7dac-139">Ao hospedar o fluxo de trabalho, adicionar uma instância do <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-classe derivada para o host chamando <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> e chame <!--zz xref:System.ServiceModel.Activities.WorkflowServiceHost.Open%2A--> `System.ServiceModel.Activities.WorkflowServiceHost.Open`.</span><span class="sxs-lookup"><span data-stu-id="e7dac-139">When hosting the workflow, add an instance of the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class to the host by calling <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> and call <!--zz xref:System.ServiceModel.Activities.WorkflowServiceHost.Open%2A--> `System.ServiceModel.Activities.WorkflowServiceHost.Open`.</span></span> <span data-ttu-id="e7dac-140">Para criar uma instância do fluxo de trabalho, crie um <xref:System.ServiceModel.ChannelFactory%601> do tipo de contrato de serviço e chamada <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7dac-140">To create an instance of the workflow, create a <xref:System.ServiceModel.ChannelFactory%601> of your service contract type and call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span></span> <span data-ttu-id="e7dac-141">Em seguida, você pode chamar a operação de criação definida no seu contrato de serviço.</span><span class="sxs-lookup"><span data-stu-id="e7dac-141">You can then call the create operation defined in your service contract.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e7dac-142">Consulte também</span><span class="sxs-lookup"><span data-stu-id="e7dac-142">See Also</span></span>  
 [<span data-ttu-id="e7dac-143">Serviços de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="e7dac-143">Workflow Services</span></span>](../../../../docs/framework/wcf/feature-details/workflow-services.md)  
 [<span data-ttu-id="e7dac-144">Atividades de mensagens</span><span class="sxs-lookup"><span data-stu-id="e7dac-144">Messaging Activities</span></span>](../../../../docs/framework/wcf/feature-details/messaging-activities.md)
