---
title: "Depurando erros de autenticação do Windows"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: b24d5a8ebccbd454579394a986614e0d40d8d0e6
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="fd10d-102">Depurando erros de autenticação do Windows</span><span class="sxs-lookup"><span data-stu-id="fd10d-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="fd10d-103">Ao usar a autenticação do Windows como um mecanismo de segurança, a Interface de provedor de suporte de segurança (SSPI) gerencia os processos de segurança.</span><span class="sxs-lookup"><span data-stu-id="fd10d-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="fd10d-104">Quando ocorrem erros de segurança na camada de SSPI, eles são apresentados pelo [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="fd10d-104">When security errors occur at the SSPI layer, they are surfaced by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span> <span data-ttu-id="fd10d-105">Este tópico fornece uma estrutura e um conjunto de perguntas para ajudar a diagnosticar os erros.</span><span class="sxs-lookup"><span data-stu-id="fd10d-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="fd10d-106">Para obter uma visão geral do protocolo Kerberos, consulte [Kerberos explicado](http://go.microsoft.com/fwlink/?LinkID=86946); para obter uma visão geral de SSPI, consulte [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="fd10d-106">For an overview of the Kerberos protocol, see [Kerberos Explained](http://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="fd10d-107">Para autenticação do Windows, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] geralmente usa a *Negotiate* segurança suporte Provider (SSP), que executa a autenticação mútua entre o cliente e o serviço Kerberos.</span><span class="sxs-lookup"><span data-stu-id="fd10d-107">For Windows authentication, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="fd10d-108">Se o protocolo Kerberos não está disponível, por padrão [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] reverterá para o NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="fd10d-108">If the Kerberos protocol is not available, by default [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="fd10d-109">No entanto, você pode configurar [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] para usar apenas o protocolo Kerberos (e lançar uma exceção se o Kerberos não estiver disponível).</span><span class="sxs-lookup"><span data-stu-id="fd10d-109">However, you can configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="fd10d-110">Você também pode configurar [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] usar formas restritas do protocolo Kerberos.</span><span class="sxs-lookup"><span data-stu-id="fd10d-110">You can also configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="fd10d-111">Metodologia de depuração</span><span class="sxs-lookup"><span data-stu-id="fd10d-111">Debugging Methodology</span></span>  
 <span data-ttu-id="fd10d-112">O método básico é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="fd10d-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="fd10d-113">Determine se você estiver usando autenticação do Windows.</span><span class="sxs-lookup"><span data-stu-id="fd10d-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="fd10d-114">Se você estiver usando qualquer outro esquema, este tópico não se aplica.</span><span class="sxs-lookup"><span data-stu-id="fd10d-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="fd10d-115">Se tiver certeza de que você estiver usando autenticação do Windows, determine se sua [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuração usa direta de Kerberos ou Negotiate.</span><span class="sxs-lookup"><span data-stu-id="fd10d-115">If you are sure you are using Windows authentication, determine whether your [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="fd10d-116">Depois de determinar se sua configuração está usando o protocolo Kerberos ou NTLM, você pode entender as mensagens de erro no contexto correto.</span><span class="sxs-lookup"><span data-stu-id="fd10d-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="fd10d-117">Disponibilidade do protocolo Kerberos e NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="fd10d-118">O SSP do Kerberos requer um controlador de domínio para agir como Kerberos Key Distribution Center (KDC).</span><span class="sxs-lookup"><span data-stu-id="fd10d-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="fd10d-119">O protocolo Kerberos está disponível somente quando o cliente e o serviço estiver usando identidades do domínio.</span><span class="sxs-lookup"><span data-stu-id="fd10d-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="fd10d-120">Em outras combinações de conta, NTLM é usado, como resumido na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="fd10d-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="fd10d-121">Os cabeçalhos da tabela mostram os tipos de conta possível usados pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="fd10d-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="fd10d-122">A coluna esquerda mostra os tipos possíveis de conta usados pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="fd10d-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="fd10d-123">Usuário local</span><span class="sxs-lookup"><span data-stu-id="fd10d-123">Local User</span></span>|<span data-ttu-id="fd10d-124">Sistema Local</span><span class="sxs-lookup"><span data-stu-id="fd10d-124">Local System</span></span>|<span data-ttu-id="fd10d-125">Usuário de domínio</span><span class="sxs-lookup"><span data-stu-id="fd10d-125">Domain User</span></span>|<span data-ttu-id="fd10d-126">Máquina de domínio</span><span class="sxs-lookup"><span data-stu-id="fd10d-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="fd10d-127">Usuário local</span><span class="sxs-lookup"><span data-stu-id="fd10d-127">Local User</span></span>|<span data-ttu-id="fd10d-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-128">NTLM</span></span>|<span data-ttu-id="fd10d-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-129">NTLM</span></span>|<span data-ttu-id="fd10d-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-130">NTLM</span></span>|<span data-ttu-id="fd10d-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-131">NTLM</span></span>|  
|<span data-ttu-id="fd10d-132">Sistema Local</span><span class="sxs-lookup"><span data-stu-id="fd10d-132">Local System</span></span>|<span data-ttu-id="fd10d-133">NTLM anônimo</span><span class="sxs-lookup"><span data-stu-id="fd10d-133">Anonymous NTLM</span></span>|<span data-ttu-id="fd10d-134">NTLM anônimo</span><span class="sxs-lookup"><span data-stu-id="fd10d-134">Anonymous NTLM</span></span>|<span data-ttu-id="fd10d-135">NTLM anônimo</span><span class="sxs-lookup"><span data-stu-id="fd10d-135">Anonymous NTLM</span></span>|<span data-ttu-id="fd10d-136">NTLM anônimo</span><span class="sxs-lookup"><span data-stu-id="fd10d-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="fd10d-137">Usuário de domínio</span><span class="sxs-lookup"><span data-stu-id="fd10d-137">Domain User</span></span>|<span data-ttu-id="fd10d-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-138">NTLM</span></span>|<span data-ttu-id="fd10d-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-139">NTLM</span></span>|<span data-ttu-id="fd10d-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fd10d-140">Kerberos</span></span>|<span data-ttu-id="fd10d-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fd10d-141">Kerberos</span></span>|  
|<span data-ttu-id="fd10d-142">Máquina de domínio</span><span class="sxs-lookup"><span data-stu-id="fd10d-142">Domain Machine</span></span>|<span data-ttu-id="fd10d-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-143">NTLM</span></span>|<span data-ttu-id="fd10d-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-144">NTLM</span></span>|<span data-ttu-id="fd10d-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fd10d-145">Kerberos</span></span>|<span data-ttu-id="fd10d-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fd10d-146">Kerberos</span></span>|  
  
 <span data-ttu-id="fd10d-147">Especificamente, os quatro tipos de conta incluem:</span><span class="sxs-lookup"><span data-stu-id="fd10d-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="fd10d-148">: Local somente máquina perfil de usuário.</span><span class="sxs-lookup"><span data-stu-id="fd10d-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="fd10d-149">Por exemplo `MachineName\Administrator` ou `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="fd10d-150">Sistema local: A conta interna sistema em um computador que não tenha ingressado em um domínio.</span><span class="sxs-lookup"><span data-stu-id="fd10d-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="fd10d-151">Usuário de domínio: Uma conta de usuário em um domínio do Windows.</span><span class="sxs-lookup"><span data-stu-id="fd10d-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="fd10d-152">Por exemplo: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="fd10d-153">Máquina de domínio: Um processo com a identidade da máquina executando em um computador que ingressou em um domínio do Windows.</span><span class="sxs-lookup"><span data-stu-id="fd10d-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="fd10d-154">Por exemplo: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="fd10d-155">A credencial de serviço é capturada quando o <xref:System.ServiceModel.ICommunicationObject.Open%2A> método o <xref:System.ServiceModel.ServiceHost> classe é chamada.</span><span class="sxs-lookup"><span data-stu-id="fd10d-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="fd10d-156">A credencial do cliente é lida sempre que o cliente envia uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="fd10d-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="fd10d-157">Problemas comuns de autenticação do Windows</span><span class="sxs-lookup"><span data-stu-id="fd10d-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="fd10d-158">Esta seção aborda alguns problemas comuns de autenticação do Windows e as possíveis soluções.</span><span class="sxs-lookup"><span data-stu-id="fd10d-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="fd10d-159">Protocolo Kerberos</span><span class="sxs-lookup"><span data-stu-id="fd10d-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="fd10d-160">Problemas SPN/UPN com o protocolo Kerberos</span><span class="sxs-lookup"><span data-stu-id="fd10d-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="fd10d-161">Ao usar a autenticação do Windows e o protocolo é usado ou negociado por SSPI do Kerberos, a URL que usa o ponto de extremidade do cliente deve incluir o nome de domínio totalmente qualificado do host do serviço dentro da URL de serviço.</span><span class="sxs-lookup"><span data-stu-id="fd10d-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="fd10d-162">Isso pressupõe que a conta sob a qual o serviço está sendo executado tem acesso para a chave de nome principal (SPN) de serviço do computador (padrão) que é criado quando o computador é adicionado ao domínio do Active Directory, que geralmente é feito através da execução do serviço no Conta de serviço de rede.</span><span class="sxs-lookup"><span data-stu-id="fd10d-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="fd10d-163">Se o serviço não tiver acesso à chave SPN de máquina, você deve fornecer o correta SPN nome UPN ou (UPN) da conta sob a qual o serviço está em execução na identidade do ponto de extremidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="fd10d-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="fd10d-164">como [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] funciona com o SPN e UPN, consulte [autenticação e identidade de serviço](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="fd10d-164"> how [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="fd10d-165">No balanceamento de carga cenários, como Web farms ou ambientes Web, uma prática comum é definir uma conta exclusiva para cada aplicativo, atribua um SPN para essa conta, e certifique-se de que todos os serviços do aplicativo executados nessa conta.</span><span class="sxs-lookup"><span data-stu-id="fd10d-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="fd10d-166">Para obter um SPN para a conta de serviço, você precisa ser um administrador de domínio do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fd10d-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="fd10d-167">[Suplemento técnico do Kerberos para Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="fd10d-167"> [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="fd10d-168">Direta do protocolo Kerberos requer que o serviço para execução em uma conta de computador do domínio</span><span class="sxs-lookup"><span data-stu-id="fd10d-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="fd10d-169">Isso ocorre quando o `ClientCredentialType` está definida como `Windows` e <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> está definida como `false`, conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="fd10d-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="fd10d-170">Para corrigir, execute o serviço usando uma conta de máquina do domínio, como serviço de rede, em um domínio ingressou na máquina.</span><span class="sxs-lookup"><span data-stu-id="fd10d-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="fd10d-171">A delegação exige a negociação de credencial</span><span class="sxs-lookup"><span data-stu-id="fd10d-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="fd10d-172">Para usar o protocolo de autenticação Kerberos com delegação, você deve implementar o protocolo Kerberos com a negociação de credencial (às vezes chamada de "vários trecho" ou "várias etapas" Kerberos).</span><span class="sxs-lookup"><span data-stu-id="fd10d-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="fd10d-173">Se você implementar a autenticação Kerberos sem negociação de credencial (às vezes chamada de "todos" ou "segmento único" Kerberos), uma exceção será lançada.</span><span class="sxs-lookup"><span data-stu-id="fd10d-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="fd10d-174">Para implementar o Kerberos com a negociação de credencial, siga as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="fd10d-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="fd10d-175">Implementar a delegação definindo <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> para <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="fd10d-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="fd10d-176">Exigir negociação SSPI:</span><span class="sxs-lookup"><span data-stu-id="fd10d-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="fd10d-177">Se você estiver usando associações padrão, defina o `NegotiateServiceCredential` propriedade `true`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="fd10d-178">Se você estiver usando associações personalizadas, definir o `AuthenticationMode` atributo do `Security` elemento `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="fd10d-179">Exigir a negociação de SSPI para usar o Kerberos, não permitindo o uso do NTLM:</span><span class="sxs-lookup"><span data-stu-id="fd10d-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="fd10d-180">Faça isso no código, com a seguinte instrução:`ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="fd10d-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2.  <span data-ttu-id="fd10d-181">Ou você pode fazer isso no arquivo de configuração, definindo o `allowNtlm` atributo `false`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="fd10d-182">Esse atributo está contido no [ \<windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="fd10d-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="fd10d-183">Protocolo NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="fd10d-184">Negociar SSP cai para NTLM, mas NTLM está desabilitado</span><span class="sxs-lookup"><span data-stu-id="fd10d-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="fd10d-185">O <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> está definida como `false`, que faz com que [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] para fazer um esforço para lançar uma exceção se NTLM é usado.</span><span class="sxs-lookup"><span data-stu-id="fd10d-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="fd10d-186">Observe que a definição dessa propriedade `false` talvez não impeçam que as credenciais do NTLM seja enviado pela conexão.</span><span class="sxs-lookup"><span data-stu-id="fd10d-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="fd10d-187">O exemplo a seguir mostra como desabilitar o fallback para NTLM.</span><span class="sxs-lookup"><span data-stu-id="fd10d-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="fd10d-188">Falha de Logon NTLM</span><span class="sxs-lookup"><span data-stu-id="fd10d-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="fd10d-189">As credenciais do cliente não são válidas no serviço.</span><span class="sxs-lookup"><span data-stu-id="fd10d-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="fd10d-190">Verifique se o nome de usuário e a senha estão definidas corretamente e correspondem a uma conta que é conhecida para o computador onde o serviço está em execução.</span><span class="sxs-lookup"><span data-stu-id="fd10d-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="fd10d-191">NTLM usa as credenciais especificadas para fazer logon no computador do serviço.</span><span class="sxs-lookup"><span data-stu-id="fd10d-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="fd10d-192">Enquanto as credenciais podem ser válidas no computador onde o cliente está sendo executado, esse logon falhará se as credenciais não são válidas no computador do serviço.</span><span class="sxs-lookup"><span data-stu-id="fd10d-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="fd10d-193">Logon anônimo NTLM ocorre, mas são de Logons anônimo é desabilitado por padrão</span><span class="sxs-lookup"><span data-stu-id="fd10d-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="fd10d-194">Ao criar um cliente, o <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> está definida como <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, conforme mostrado no exemplo a seguir, mas, por padrão, o servidor não permite logons anônimos.</span><span class="sxs-lookup"><span data-stu-id="fd10d-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="fd10d-195">Isso ocorre porque o valor padrão de <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> propriedade do <xref:System.ServiceModel.Security.WindowsServiceCredential> classe é `false`.</span><span class="sxs-lookup"><span data-stu-id="fd10d-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="fd10d-196">O seguinte código de cliente tenta ativar logons anônimos (Observe que a propriedade padrão é `Identification`).</span><span class="sxs-lookup"><span data-stu-id="fd10d-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="fd10d-197">O código de serviço a seguir altera o padrão para habilitar logons anônimos pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="fd10d-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="fd10d-198">representação, consulte [delegação e representação](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="fd10d-198"> impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="fd10d-199">Como alternativa, o cliente está sendo executado como um serviço do Windows, usando a conta interna do sistema.</span><span class="sxs-lookup"><span data-stu-id="fd10d-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="fd10d-200">Outros problemas</span><span class="sxs-lookup"><span data-stu-id="fd10d-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="fd10d-201">As credenciais do cliente não estão definidas corretamente</span><span class="sxs-lookup"><span data-stu-id="fd10d-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="fd10d-202">Usa a autenticação do Windows a <xref:System.ServiceModel.Security.WindowsClientCredential> instância retornada pelo <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> propriedade do <xref:System.ServiceModel.ClientBase%601> classe, não o <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="fd10d-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="fd10d-203">O exemplo a seguir mostra um exemplo incorreto.</span><span class="sxs-lookup"><span data-stu-id="fd10d-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="fd10d-204">O exemplo a seguir mostra o exemplo correto.</span><span class="sxs-lookup"><span data-stu-id="fd10d-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="fd10d-205">SSPI não está disponível</span><span class="sxs-lookup"><span data-stu-id="fd10d-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="fd10d-206">Os seguintes sistemas operacionais têm suporte quando usado como um servidor de autenticação do Windows: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, e [!INCLUDE[wv](../../../../includes/wv-md.md)]inicial edições.</span><span class="sxs-lookup"><span data-stu-id="fd10d-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="fd10d-207">Desenvolvimento e implantação com diferentes identidades</span><span class="sxs-lookup"><span data-stu-id="fd10d-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="fd10d-208">Se você desenvolve seu aplicativo em um computador e implanta em outro e usa diferentes tipos de conta para autenticar em cada computador, você pode enfrentar um comportamento diferente.</span><span class="sxs-lookup"><span data-stu-id="fd10d-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="fd10d-209">Por exemplo, suponha que você desenvolve seu aplicativo em um computador Windows XP Pro usando o `SSPI Negotiated` modo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="fd10d-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="fd10d-210">Se você usar uma conta de usuário local para autenticação, protocolo NTLM será usado.</span><span class="sxs-lookup"><span data-stu-id="fd10d-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="fd10d-211">Depois que o aplicativo é desenvolvido, implante o serviço em uma máquina Windows Server 2003 onde ele é executado sob uma conta de domínio.</span><span class="sxs-lookup"><span data-stu-id="fd10d-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="fd10d-212">Agora o cliente não será capaz de autenticar o serviço porque ele irá usar o Kerberos e um controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="fd10d-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fd10d-213">Consulte também</span><span class="sxs-lookup"><span data-stu-id="fd10d-213">See Also</span></span>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.Security.WindowsServiceCredential>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.ClientBase%601>  
 [<span data-ttu-id="fd10d-214">Delegação e representação</span><span class="sxs-lookup"><span data-stu-id="fd10d-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)  
 [<span data-ttu-id="fd10d-215">Cenários sem suporte</span><span class="sxs-lookup"><span data-stu-id="fd10d-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
