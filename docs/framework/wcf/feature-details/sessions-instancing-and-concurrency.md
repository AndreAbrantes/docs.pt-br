---
title: Sessões,instanciação e simultaneidade
ms.date: 03/30/2017
ms.assetid: 50797a3b-7678-44ed-8138-49ac1602f35b
ms.openlocfilehash: b8c0b40ca67de92f4f1b481298a8a26d96e887d4
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/12/2019
ms.locfileid: "73976085"
---
# <a name="sessions-instancing-and-concurrency"></a><span data-ttu-id="c8a6b-102">Sessões,instanciação e simultaneidade</span><span class="sxs-lookup"><span data-stu-id="c8a6b-102">Sessions, Instancing, and Concurrency</span></span>
<span data-ttu-id="c8a6b-103">Uma *sessão* é uma correlação de todas as mensagens enviadas entre dois pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-103">A *session* is a correlation of all messages sent between two endpoints.</span></span> <span data-ttu-id="c8a6b-104">A *instanciação* refere-se ao controle do tempo de vida de objetos de serviço definidos pelo usuário e seus objetos <xref:System.ServiceModel.InstanceContext> relacionados.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-104">*Instancing* refers to controlling the lifetime of user-defined service objects and their related <xref:System.ServiceModel.InstanceContext> objects.</span></span> <span data-ttu-id="c8a6b-105">*Simultaneidade* é o termo dado ao controle do número de threads em execução em um <xref:System.ServiceModel.InstanceContext> ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-105">*Concurrency* is the term given to the control of the number of threads executing in an <xref:System.ServiceModel.InstanceContext> at the same time.</span></span>  
  
 <span data-ttu-id="c8a6b-106">Este tópico descreve essas configurações, como usá-las e as várias interações entre elas.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-106">This topic describes these settings, how to use them, and the various interactions between them.</span></span>  
  
## <a name="sessions"></a><span data-ttu-id="c8a6b-107">Sessões</span><span class="sxs-lookup"><span data-stu-id="c8a6b-107">Sessions</span></span>  
 <span data-ttu-id="c8a6b-108">Quando um contrato de serviço define a propriedade <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> como <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, esse contrato diz que todas as chamadas (ou seja, as trocas de mensagens subjacentes que dão suporte às chamadas) devem fazer parte da mesma conversa.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-108">When a service contract sets the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, that contract is saying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="c8a6b-109">Se um contrato especifica que ele permite sessões, mas não requer uma, os clientes podem se conectar e estabelecer uma sessão ou não.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-109">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not.</span></span> <span data-ttu-id="c8a6b-110">Se a sessão terminar e uma mensagem for enviada pelo mesmo canal baseado em sessão, uma exceção será lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-110">If the session ends and a message is sent over the same session-based channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="c8a6b-111">As sessões do WCF têm os seguintes recursos conceituais principais:</span><span class="sxs-lookup"><span data-stu-id="c8a6b-111">WCF sessions have the following main conceptual features:</span></span>  
  
- <span data-ttu-id="c8a6b-112">Elas são explicitamente iniciadas e terminadas pelo aplicativo de chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-112">They are explicitly initiated and terminated by the calling application.</span></span>  
  
- <span data-ttu-id="c8a6b-113">As mensagens entregues durante uma sessão são processadas na ordem em que são recebidas.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-113">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
- <span data-ttu-id="c8a6b-114">As sessões correlacionam um grupo de mensagens em uma conversa.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-114">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="c8a6b-115">O significado dessa correlação é uma abstração.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-115">The meaning of that correlation is an abstraction.</span></span> <span data-ttu-id="c8a6b-116">Por exemplo, um canal baseado em sessão pode correlacionar mensagens com base em uma conexão de rede compartilhada enquanto outro canal baseado em sessão pode correlacionar mensagens com base em uma marca compartilhada no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-116">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="c8a6b-117">Os recursos que podem ser derivados da sessão dependem da natureza da correlação.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-117">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
- <span data-ttu-id="c8a6b-118">Não há nenhum repositório de dados geral associado a uma sessão WCF.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-118">There is no general data store associated with a WCF session.</span></span>  
  
 <span data-ttu-id="c8a6b-119">Se você estiver familiarizado com a classe <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> em aplicativos ASP.NET e a funcionalidade que ele fornece, você poderá observar as seguintes diferenças entre esse tipo de sessão e sessões do WCF:</span><span class="sxs-lookup"><span data-stu-id="c8a6b-119">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in ASP.NET applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:</span></span>  
  
- <span data-ttu-id="c8a6b-120">As sessões ASP.NET são sempre iniciadas pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-120">ASP.NET sessions are always server-initiated.</span></span>  
  
- <span data-ttu-id="c8a6b-121">As sessões ASP.NET são implicitamente desordenadas.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-121">ASP.NET sessions are implicitly unordered.</span></span>  
  
- <span data-ttu-id="c8a6b-122">As sessões ASP.NET fornecem um mecanismo de armazenamento de dados geral entre solicitações.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-122">ASP.NET sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="c8a6b-123">Aplicativos cliente e aplicativos de serviço interagem com sessões de maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-123">Client applications and service applications interact with sessions in different ways.</span></span> <span data-ttu-id="c8a6b-124">Os aplicativos cliente iniciam sessões e recebem e processam as mensagens enviadas dentro da sessão.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-124">Client applications initiate sessions and then receive and process the messages sent within the session.</span></span> <span data-ttu-id="c8a6b-125">Os aplicativos de serviço podem usar sessões como um ponto de extensibilidade para adicionar um comportamento adicional.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-125">Service applications can use sessions as an extensibility point to add additional behavior.</span></span> <span data-ttu-id="c8a6b-126">Isso é feito trabalhando diretamente com o <xref:System.ServiceModel.InstanceContext> ou implementando um provedor de contexto de instância personalizado.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-126">This is done by working directly with the <xref:System.ServiceModel.InstanceContext> or implementing a custom instance context provider.</span></span>  
  
## <a name="instancing"></a><span data-ttu-id="c8a6b-127">Instanciação</span><span class="sxs-lookup"><span data-stu-id="c8a6b-127">Instancing</span></span>  
 <span data-ttu-id="c8a6b-128">O comportamento de instanciação (definido usando a propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType>) controla como o <xref:System.ServiceModel.InstanceContext> é criado em resposta a mensagens de entrada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-128">The instancing behavior (set by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property) controls how the <xref:System.ServiceModel.InstanceContext> is created in response to incoming messages.</span></span> <span data-ttu-id="c8a6b-129">Por padrão, cada <xref:System.ServiceModel.InstanceContext> é associada a um objeto de serviço definido pelo usuário, portanto (no caso padrão) definir a propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> também controla a instanciação de objetos de serviço definidos pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-129">By default, each <xref:System.ServiceModel.InstanceContext> is associated with one user-defined service object, so (in the default case) setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property also controls the instancing of user-defined service objects.</span></span> <span data-ttu-id="c8a6b-130">A enumeração <xref:System.ServiceModel.InstanceContextMode> define os modos de instanciação.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-130">The <xref:System.ServiceModel.InstanceContextMode> enumeration defines the instancing modes.</span></span>  
  
 <span data-ttu-id="c8a6b-131">Os seguintes modos de instanciação estão disponíveis:</span><span class="sxs-lookup"><span data-stu-id="c8a6b-131">The following instancing modes are available:</span></span>  
  
- <span data-ttu-id="c8a6b-132"><xref:System.ServiceModel.InstanceContextMode.PerCall>: um novo <xref:System.ServiceModel.InstanceContext> (e, portanto, objeto de serviço) é criado para cada solicitação do cliente.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-132"><xref:System.ServiceModel.InstanceContextMode.PerCall>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each client request.</span></span>  
  
- <span data-ttu-id="c8a6b-133"><xref:System.ServiceModel.InstanceContextMode.PerSession>: um novo <xref:System.ServiceModel.InstanceContext> (e, portanto, objeto de serviço) é criado para cada nova sessão de cliente e mantido durante o tempo de vida dessa sessão (isso requer uma ligação que dê suporte a sessões).</span><span class="sxs-lookup"><span data-stu-id="c8a6b-133"><xref:System.ServiceModel.InstanceContextMode.PerSession>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each new client session and maintained for the lifetime of that session (this requires a binding that supports sessions).</span></span>  
  
- <span data-ttu-id="c8a6b-134"><xref:System.ServiceModel.InstanceContextMode.Single>: um único <xref:System.ServiceModel.InstanceContext> (e, portanto, o objeto de serviço) trata todas as solicitações do cliente durante o tempo de vida do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-134"><xref:System.ServiceModel.InstanceContextMode.Single>: A single <xref:System.ServiceModel.InstanceContext> (and therefore service object) handles all client requests for the lifetime of the application.</span></span>  
  
 <span data-ttu-id="c8a6b-135">O exemplo de código a seguir mostra o valor de <xref:System.ServiceModel.InstanceContextMode> padrão <xref:System.ServiceModel.InstanceContextMode.PerSession> ser explicitamente definido em uma classe de serviço.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-135">The following code example shows the default <xref:System.ServiceModel.InstanceContextMode> value, <xref:System.ServiceModel.InstanceContextMode.PerSession> being explicitly set on a service class.</span></span>  
  
```csharp  
[ServiceBehavior(InstanceContextMode=InstanceContextMode.PerSession)]   
public class CalculatorService : ICalculatorInstance   
{   
    ...  
}  
```  
  
 <span data-ttu-id="c8a6b-136">E, embora a propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> controle com que frequência a <xref:System.ServiceModel.InstanceContext> é liberada, as propriedades <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> e <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> são controladas quando o objeto de serviço é liberado.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-136">And while the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property controls how often the <xref:System.ServiceModel.InstanceContext> is released, the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> and <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> properties control when the service object is released.</span></span>  
  
### <a name="well-known-singleton-services"></a><span data-ttu-id="c8a6b-137">Serviços singleton conhecidos</span><span class="sxs-lookup"><span data-stu-id="c8a6b-137">Well-Known Singleton Services</span></span>  
 <span data-ttu-id="c8a6b-138">Às vezes, uma variação em objetos de serviço de instância única é útil: você pode criar um objeto de serviço por conta própria e criar o host de serviço usando esse objeto.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-138">One variation on single instance service objects is sometimes useful: you can create a service object yourself and create the service host using that object.</span></span> <span data-ttu-id="c8a6b-139">Para fazer isso, você também deve definir a propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> como <xref:System.ServiceModel.InstanceContextMode.Single> ou uma exceção é lançada quando o host de serviço é aberto.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-139">To do so, you must also set the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.InstanceContextMode.Single> or an exception is thrown when the service host is opened.</span></span>  
  
 <span data-ttu-id="c8a6b-140">Use o Construtor <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> para criar um serviço desse tipo.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-140">Use the <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> constructor to create such a service.</span></span> <span data-ttu-id="c8a6b-141">Ele fornece uma alternativa à implementação de um <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> personalizado quando você deseja fornecer uma instância de objeto específica para uso por um serviço singleton.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-141">It provides an alternative to implementing a custom <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> when you wish to provide a specific object instance for use by a singleton service.</span></span> <span data-ttu-id="c8a6b-142">Você pode usar essa sobrecarga quando o tipo de implementação de serviço for difícil de construir (por exemplo, se ele não implementar um construtor público sem parâmetros).</span><span class="sxs-lookup"><span data-stu-id="c8a6b-142">You can use this overload when your service implementation type is difficult to construct (for example, if it does not implement a parameterless public constructor).</span></span>  
  
 <span data-ttu-id="c8a6b-143">Observe que, quando um objeto é fornecido a esse construtor, alguns recursos relacionados ao comportamento de instanciação do Windows Communication Foundation (WCF) funcionam de maneira diferente.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-143">Note that when an object is provided to this constructor, some features related to the Windows Communication Foundation (WCF) instancing behavior work differently.</span></span> <span data-ttu-id="c8a6b-144">Por exemplo, chamar <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> não tem efeito quando uma instância de objeto singleton é fornecida.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-144">For example, calling <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> has no effect when a singleton object instance is provided.</span></span> <span data-ttu-id="c8a6b-145">Da mesma forma, qualquer outro mecanismo de liberação de instância é ignorado.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-145">Similarly, any other instance-release mechanism is ignored.</span></span> <span data-ttu-id="c8a6b-146">O <xref:System.ServiceModel.ServiceHost> sempre se comporta como se a propriedade <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> estiver definida como <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> para todas as operações.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-146">The <xref:System.ServiceModel.ServiceHost> always behaves as if the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> for all operations.</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="c8a6b-147">Compartilhando objetos InstanceContext</span><span class="sxs-lookup"><span data-stu-id="c8a6b-147">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="c8a6b-148">Você também pode controlar qual canal ou chamada de sessão está associado a qual <xref:System.ServiceModel.InstanceContext> objeto executando a associação por conta própria.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-148">You can also control which sessionful channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span>  
  
## <a name="concurrency"></a><span data-ttu-id="c8a6b-149">Concorrência</span><span class="sxs-lookup"><span data-stu-id="c8a6b-149">Concurrency</span></span>  
 <span data-ttu-id="c8a6b-150">A simultaneidade é o controle do número de threads ativos em um <xref:System.ServiceModel.InstanceContext> a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-150">Concurrency is the control of the number of threads active in an <xref:System.ServiceModel.InstanceContext> at any one time.</span></span> <span data-ttu-id="c8a6b-151">Isso é controlado usando o <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> com a enumeração <xref:System.ServiceModel.ConcurrencyMode>.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-151">This is controlled by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> with the <xref:System.ServiceModel.ConcurrencyMode> enumeration.</span></span>  
  
 <span data-ttu-id="c8a6b-152">Os três modos de simultaneidade a seguir estão disponíveis:</span><span class="sxs-lookup"><span data-stu-id="c8a6b-152">The following three concurrency modes are available:</span></span>  
  
- <span data-ttu-id="c8a6b-153"><xref:System.ServiceModel.ConcurrencyMode.Single>: cada contexto de instância tem permissão para ter um máximo de um thread processando mensagens no contexto de instância por vez.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-153"><xref:System.ServiceModel.ConcurrencyMode.Single>: Each instance context is allowed to have a maximum of one thread processing messages in the instance context at a time.</span></span> <span data-ttu-id="c8a6b-154">Outros threads que desejam usar o mesmo contexto de instância devem ser bloqueados até que o thread original saia do contexto da instância.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-154">Other threads wishing to use the same instance context must block until the original thread exits the instance context.</span></span>  
  
- <span data-ttu-id="c8a6b-155"><xref:System.ServiceModel.ConcurrencyMode.Multiple>: cada instância de serviço pode ter vários threads processando mensagens simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-155"><xref:System.ServiceModel.ConcurrencyMode.Multiple>: Each service instance can have multiple threads processing messages concurrently.</span></span> <span data-ttu-id="c8a6b-156">A implementação do serviço deve ser thread-safe para usar esse modo de simultaneidade.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-156">The service implementation must be thread-safe to use this concurrency mode.</span></span>  
  
- <span data-ttu-id="c8a6b-157"><xref:System.ServiceModel.ConcurrencyMode.Reentrant>: cada instância de serviço processa uma mensagem por vez, mas aceita chamadas de operação reentrante.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-157"><xref:System.ServiceModel.ConcurrencyMode.Reentrant>: Each service instance processes one message at a time, but accepts re-entrant operation calls.</span></span> <span data-ttu-id="c8a6b-158">O serviço só aceita essas chamadas quando está chamando por meio de um objeto de cliente WCF.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-158">The service only accepts these calls when it is calling out through a WCF client object.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c8a6b-159">Compreender e desenvolver código que usa com segurança mais de um thread pode ser difícil de gravar com êxito.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-159">Understanding and developing code that safely uses more than one thread can be difficult to write successfully.</span></span> <span data-ttu-id="c8a6b-160">Antes de usar <xref:System.ServiceModel.ConcurrencyMode.Multiple> ou valores de <xref:System.ServiceModel.ConcurrencyMode.Reentrant>, verifique se o serviço foi projetado corretamente para esses modos.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-160">Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes.</span></span> <span data-ttu-id="c8a6b-161">Para obter mais informações, consulte <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-161">For more information, see <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.</span></span>  
  
 <span data-ttu-id="c8a6b-162">O uso da simultaneidade está relacionado ao modo de instanciação.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-162">The use of concurrency is related to the instancing mode.</span></span> <span data-ttu-id="c8a6b-163">Em <xref:System.ServiceModel.InstanceContextMode.PerCall> instanciação, a simultaneidade não é relevante, pois cada mensagem é processada por um novo <xref:System.ServiceModel.InstanceContext> e, portanto, nunca mais de um thread está ativo no <xref:System.ServiceModel.InstanceContext>.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-163">In <xref:System.ServiceModel.InstanceContextMode.PerCall> instancing, concurrency is not relevant, because each message is processed by a new <xref:System.ServiceModel.InstanceContext> and, therefore, never more than one thread is active in the <xref:System.ServiceModel.InstanceContext>.</span></span>  
  
 <span data-ttu-id="c8a6b-164">O exemplo de código a seguir demonstra a definição da propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> como <xref:System.ServiceModel.ConcurrencyMode.Multiple>.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-164">The following code example demonstrates setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> property to <xref:System.ServiceModel.ConcurrencyMode.Multiple>.</span></span>  
  
```csharp
[ServiceBehavior(ConcurrencyMode=ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]   
public class CalculatorService : ICalculatorConcurrency   
{   
    ...  
}  
```  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="c8a6b-165">Sessões interagem com configurações de InstanceContext</span><span class="sxs-lookup"><span data-stu-id="c8a6b-165">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="c8a6b-166">As sessões e <xref:System.ServiceModel.InstanceContext> interagem dependendo da combinação do valor da enumeração <xref:System.ServiceModel.SessionMode> em um contrato e da propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> na implementação do serviço, que controla a associação entre canais e objetos de serviço específicos.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-166">Sessions and <xref:System.ServiceModel.InstanceContext> interact depending upon the combination of the value of the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property on the service implementation, which controls the association between channels and specific service objects.</span></span>  
  
 <span data-ttu-id="c8a6b-167">A tabela a seguir mostra o resultado de um canal de entrada que dá suporte a sessões ou não suporte a sessões, dada a combinação de um serviço dos valores da propriedade <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> e da propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-167">The following table shows the result of an incoming channel either supporting sessions or not supporting sessions given a service's combination of the values of the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property.</span></span>  
  
|<span data-ttu-id="c8a6b-168">Valor de InstanceContextmode</span><span class="sxs-lookup"><span data-stu-id="c8a6b-168">InstanceContextMode value</span></span>|<xref:System.ServiceModel.SessionMode.Required>|<xref:System.ServiceModel.SessionMode.Allowed>|<xref:System.ServiceModel.SessionMode.NotAllowed>|  
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|  
|<span data-ttu-id="c8a6b-169">PerCall</span><span class="sxs-lookup"><span data-stu-id="c8a6b-169">PerCall</span></span>|<span data-ttu-id="c8a6b-170">-Comportamento com o canal de sessão: uma sessão e <xref:System.ServiceModel.InstanceContext> para cada chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-170">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.</span></span><br /><span data-ttu-id="c8a6b-171">-Comportamento com canal sem sessão: uma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-171">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="c8a6b-172">-Comportamento com o canal de sessão: uma sessão e <xref:System.ServiceModel.InstanceContext> para cada chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-172">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.</span></span><br /><span data-ttu-id="c8a6b-173">-Comportamento com canal sem sessão: um <xref:System.ServiceModel.InstanceContext> para cada chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-173">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|<span data-ttu-id="c8a6b-174">-Comportamento com o canal de sessão: uma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-174">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="c8a6b-175">-Comportamento com canal sem sessão: um <xref:System.ServiceModel.InstanceContext> para cada chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-175">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|  
|<span data-ttu-id="c8a6b-176">PerSession</span><span class="sxs-lookup"><span data-stu-id="c8a6b-176">PerSession</span></span>|<span data-ttu-id="c8a6b-177">-Comportamento com o canal de sessão: uma sessão e <xref:System.ServiceModel.InstanceContext> para cada canal.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-177">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.</span></span><br /><span data-ttu-id="c8a6b-178">-Comportamento com canal sem sessão: uma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-178">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="c8a6b-179">-Comportamento com o canal de sessão: uma sessão e <xref:System.ServiceModel.InstanceContext> para cada canal.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-179">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.</span></span><br /><span data-ttu-id="c8a6b-180">-Comportamento com canal sem sessão: um <xref:System.ServiceModel.InstanceContext> para cada chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-180">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|<span data-ttu-id="c8a6b-181">-Comportamento com o canal de sessão: uma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-181">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="c8a6b-182">-Comportamento com canal sem sessão: um <xref:System.ServiceModel.InstanceContext> para cada chamada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-182">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|  
|<span data-ttu-id="c8a6b-183">Simples</span><span class="sxs-lookup"><span data-stu-id="c8a6b-183">Single</span></span>|<span data-ttu-id="c8a6b-184">-Comportamento com o canal de sessão: uma sessão e uma <xref:System.ServiceModel.InstanceContext> para todas as chamadas.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-184">-   Behavior with sessionful channel: A session and one <xref:System.ServiceModel.InstanceContext> for all calls.</span></span><br /><span data-ttu-id="c8a6b-185">-Comportamento com canal sem sessão: uma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-185">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="c8a6b-186">-Comportamento com o canal de sessão: uma sessão e <xref:System.ServiceModel.InstanceContext> para o singleton criado ou especificado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-186">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.</span></span><br /><span data-ttu-id="c8a6b-187">-Comportamento com canal sem sessão: um <xref:System.ServiceModel.InstanceContext> para o singleton criado ou especificado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-187">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.</span></span>|<span data-ttu-id="c8a6b-188">-Comportamento com o canal de sessão: uma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-188">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="c8a6b-189">-Comportamento com canal sem sessão: um <xref:System.ServiceModel.InstanceContext> para cada singleton criado ou para o singleton especificado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="c8a6b-189">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each created singleton or for the user-specified singleton.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="c8a6b-190">Consulte também</span><span class="sxs-lookup"><span data-stu-id="c8a6b-190">See also</span></span>

- [<span data-ttu-id="c8a6b-191">Usando sessões</span><span class="sxs-lookup"><span data-stu-id="c8a6b-191">Using Sessions</span></span>](../../../../docs/framework/wcf/using-sessions.md)
- [<span data-ttu-id="c8a6b-192">Como criar um serviço que requer sessões</span><span class="sxs-lookup"><span data-stu-id="c8a6b-192">How to: Create a Service That Requires Sessions</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)
- [<span data-ttu-id="c8a6b-193">Como controlar instanciação de serviço</span><span class="sxs-lookup"><span data-stu-id="c8a6b-193">How to: Control Service Instancing</span></span>](../../../../docs/framework/wcf/feature-details/how-to-control-service-instancing.md)
- [<span data-ttu-id="c8a6b-194">Simultaneidade</span><span class="sxs-lookup"><span data-stu-id="c8a6b-194">Concurrency</span></span>](../../../../docs/framework/wcf/samples/concurrency.md)
- [<span data-ttu-id="c8a6b-195">Instanciação</span><span class="sxs-lookup"><span data-stu-id="c8a6b-195">Instancing</span></span>](../../../../docs/framework/wcf/samples/instancing.md)
- [<span data-ttu-id="c8a6b-196">Sessão</span><span class="sxs-lookup"><span data-stu-id="c8a6b-196">Session</span></span>](../../../../docs/framework/wcf/samples/session.md)
