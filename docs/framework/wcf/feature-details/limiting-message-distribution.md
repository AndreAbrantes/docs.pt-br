---
title: "Limitando a distribuição de mensagens"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
caps.latest.revision: "10"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: ab46b1c908e8eb61ea49315e120973f1ea381bc6
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="d0ef1-102">Limitando a distribuição de mensagens</span><span class="sxs-lookup"><span data-stu-id="d0ef1-102">Limiting Message Distribution</span></span>
<span data-ttu-id="d0ef1-103">Canal par ocorre por design, uma malha de difusão.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="d0ef1-104">Seu modelo básico de inundação envolve a distribuição de cada mensagem enviada por qualquer membro de uma malha para todos os outros membros dessa malha.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="d0ef1-105">Isso é ideal em situações em que cada mensagem gerada por um membro é relevantes e úteis para todos os outros membros (por exemplo, uma sala de bate-papo).</span><span class="sxs-lookup"><span data-stu-id="d0ef1-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="d0ef1-106">No entanto, muitos aplicativos têm uma necessidade ocasional de limitando a distribuição de mensagem.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="d0ef1-107">Por exemplo, se um novo membro une uma malha e deseja recuperar a última mensagem enviada por meio da malha, esta solicitação não precisa ser inundados para todos os membros da malha.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="d0ef1-108">A solicitação pode ser limitada a perto vizinhos ou mensagens geradas localmente podem ser filtradas. As mensagens também podem ser enviadas a um nó individual na malha.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="d0ef1-109">Este tópico discute o uso de contagem de salto, um filtro de propagação de mensagem, um filtro local ou uma conexão direta para controlar como as mensagens são encaminhadas em toda a malha e fornece diretrizes gerais para escolher uma abordagem.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>  
  
## <a name="hop-counts"></a><span data-ttu-id="d0ef1-110">Contagens de saltos</span><span class="sxs-lookup"><span data-stu-id="d0ef1-110">Hop Counts</span></span>  
 <span data-ttu-id="d0ef1-111">O conceito de `PeerHopCount` é semelhante a TTL (Time-To-Live) usado no protocolo IP.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="d0ef1-112">O valor de `PeerHopCount` está associada a uma instância de mensagem, e especifica quantas vezes uma mensagem deve ser encaminhada antes de ser descartado.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="d0ef1-113">Cada vez que uma mensagem é recebida por um cliente de canal par, o cliente examina a mensagem para ver se `PeerHopCount` for especificado.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="d0ef1-114">Se for especificado, em seguida, diminui o cliente o salto contar valor por um antes de encaminhar a mensagem para nós vizinhos.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="d0ef1-115">Quando um cliente recebe uma mensagem com um valor de contagem de salto de zero, o cliente processa a mensagem, mas não encaminhar a mensagem vizinhos.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>  
  
 <span data-ttu-id="d0ef1-116">Contagem de salto pode ser adicionada a uma mensagem adicionando `PeerHopCount` como um atributo para a propriedade aplicável ou o campo na implementação da classe de mensagem.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="d0ef1-117">Você pode definir isso como um valor específico antes de enviar a mensagem para a malha.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="d0ef1-118">Dessa forma, você pode usar a contagem de saltos para limitar a distribuição de mensagens em toda a malha quando necessário, potencialmente evitar a duplicação de mensagens desnecessárias.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="d0ef1-119">Isso é útil em casos em que a malha contém uma grande quantidade de dados redundantes, ou para enviar uma mensagem ao vizinhas ou vizinhos dentro de alguns saltos.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>  
  
-   <span data-ttu-id="d0ef1-120">Para trechos de código e informações relacionadas, consulte o [blog de canal par](http://go.microsoft.com/fwlink/?LinkID=114531) (http://go.microsoft.com/fwlink/?LinkID=114531).</span><span class="sxs-lookup"><span data-stu-id="d0ef1-120">For code snippets and related information, see the [Peer Channel blog](http://go.microsoft.com/fwlink/?LinkID=114531) (http://go.microsoft.com/fwlink/?LinkID=114531).</span></span>  
  
## <a name="message-propagation-filter"></a><span data-ttu-id="d0ef1-121">Filtro de propagação de mensagem</span><span class="sxs-lookup"><span data-stu-id="d0ef1-121">Message Propagation Filter</span></span>  
 <span data-ttu-id="d0ef1-122">`MessagePropagationFilter`pode ser usado para o controle personalizado de inundação de mensagens, especialmente quando a propagação de determinar o conteúdo da mensagem ou outros cenários específicos.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="d0ef1-123">O filtro toma decisões de propagação para cada mensagem que passa através do nó.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="d0ef1-124">Isso é verdadeiro para as mensagens originadas em outro lugar na malha que seu nó tenha recebido, bem como mensagens criadas pelo seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="d0ef1-125">O filtro tem acesso à mensagem e sua origem, para que decisões sobre encaminhamento ou descartar a mensagem podem ser baseadas nas informações completas disponíveis.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>  
  
 <span data-ttu-id="d0ef1-126"><xref:System.ServiceModel.PeerMessagePropagationFilter>é uma classe base abstrata com uma única função, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="d0ef1-127">O primeiro argumento da chamada de método passa em uma cópia completa da mensagem.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="d0ef1-128">Todas as alterações feitas a mensagem não afetam a mensagem real.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="d0ef1-129">O último argumento da chamada de método identifica a origem da mensagem (`PeerMessageOrigination.Local` ou `PeerMessageOrigination.Remote`).</span><span class="sxs-lookup"><span data-stu-id="d0ef1-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="d0ef1-130">Implementações concretas desse método devem retornar uma constante do <xref:System.ServiceModel.PeerMessagePropagation> enumeração que indica que a mensagem será encaminhado para o aplicativo local (`Local`), encaminhado para clientes remotos (`Remote`), ambos (`LocalAndRemote`), ou nenhum deles (`None`).</span><span class="sxs-lookup"><span data-stu-id="d0ef1-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="d0ef1-131">Esse filtro pode ser aplicado, acessando correspondente `PeerNode` objeto e especificando uma instância da propagação derivada filtram classe o `PeerNode.MessagePropagationFilter` propriedade.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="d0ef1-132">Certifique-se de que o filtro de propagação está conectado antes de abrir o canal par.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>  
  
-   <span data-ttu-id="d0ef1-133">Para trechos de código e informações relacionadas, consulte o [blog de canal par](http://go.microsoft.com/fwlink/?LinkID=114532) (http://go.microsoft.com/fwlink/?LinkID=114532).</span><span class="sxs-lookup"><span data-stu-id="d0ef1-133">For code snippets and related information, see the [Peer Channel blog](http://go.microsoft.com/fwlink/?LinkID=114532) (http://go.microsoft.com/fwlink/?LinkID=114532).</span></span>  
  
## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="d0ef1-134">Entrar em contato com um nó Individual na malha</span><span class="sxs-lookup"><span data-stu-id="d0ef1-134">Contacting an Individual Node in the Mesh</span></span>  
 <span data-ttu-id="d0ef1-135">Um nó individual em uma malha pode ser contatado definindo um filtro local ou configurando uma conexão direta.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>  
  
 <span data-ttu-id="d0ef1-136">Se os nós em uma malha tem uma ID individual, uma ID de destino pode ser especificada na implementação de sua mensagem.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="d0ef1-137">Um filtro local pode ser configurado gravando uma função no seu contrato de mensagem que só exibirá a mensagem para o nó atual se sua ID corresponde à ID de destino especificado.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="d0ef1-138">A malha transporta a mensagem, a sobrecarga de configurar uma nova conexão precisa ser cobradas.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="d0ef1-139">No entanto, há uma perda de eficiência desde que a mensagem é enviada muitas vezes em toda a malha.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="d0ef1-140">Isso funciona bem para enviar mensagens para membros individuais de uma malha, como as mensagens são muito grande, nem muito frequentes.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>  
  
 <span data-ttu-id="d0ef1-141">Para conexões de alta largura de banda, de longa duração, conexões diretas são preferidas.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="d0ef1-142">Você pode enviar informações de conexão sobre a malha e, em seguida, configurar uma conexão direta de sua escolha para enviar/receber mensagens.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>  
  
## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="d0ef1-143">Escolher uma abordagem para limitar a distribuição de mensagens</span><span class="sxs-lookup"><span data-stu-id="d0ef1-143">Choosing an Approach for Limiting Message Distribution</span></span>  
 <span data-ttu-id="d0ef1-144">Quando você descobrir um cenário em que é necessário limitar a distribuição de mensagens, faça as seguintes perguntas:</span><span class="sxs-lookup"><span data-stu-id="d0ef1-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>  
  
-   <span data-ttu-id="d0ef1-145">**Quem** precisa receber a mensagem?</span><span class="sxs-lookup"><span data-stu-id="d0ef1-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="d0ef1-146">Nó de um vizinho?</span><span class="sxs-lookup"><span data-stu-id="d0ef1-146">Just one neighbor node?</span></span> <span data-ttu-id="d0ef1-147">Um nó em outro lugar na malha?</span><span class="sxs-lookup"><span data-stu-id="d0ef1-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="d0ef1-148">Metade a malha?</span><span class="sxs-lookup"><span data-stu-id="d0ef1-148">Half the mesh?</span></span>  
  
-   <span data-ttu-id="d0ef1-149">**Frequência** esta mensagem ser enviada?</span><span class="sxs-lookup"><span data-stu-id="d0ef1-149">**How often** will this message be sent?</span></span>  
  
-   <span data-ttu-id="d0ef1-150">Que tipo de **largura de banda** usará esta mensagem?</span><span class="sxs-lookup"><span data-stu-id="d0ef1-150">What kind of **bandwidth** will this message use?</span></span>  
  
 <span data-ttu-id="d0ef1-151">As respostas a essas perguntas podem ajudá-lo a determinar se deve usar a contagem de salto, um filtro de propagação de mensagem, um filtro local ou uma conexão direta.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="d0ef1-152">Considere as seguintes diretrizes gerais:</span><span class="sxs-lookup"><span data-stu-id="d0ef1-152">Consider the following general guidelines:</span></span>  
  
-   <span data-ttu-id="d0ef1-153">**Quem**</span><span class="sxs-lookup"><span data-stu-id="d0ef1-153">**Who**</span></span>  
  
    -   <span data-ttu-id="d0ef1-154">*Nó individual*: filtro Local ou conexão direta.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-154">*Individual node*:  Local filter or direct connection.</span></span>  
  
    -   <span data-ttu-id="d0ef1-155">*Vizinhos dentro de um determinado ambiente*: PeerHopCount.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>  
  
    -   <span data-ttu-id="d0ef1-156">*Subconjuntos complexos da malha*: MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>  
  
-   <span data-ttu-id="d0ef1-157">**Frequência**</span><span class="sxs-lookup"><span data-stu-id="d0ef1-157">**How often**</span></span>  
  
    -   <span data-ttu-id="d0ef1-158">*Muito frequentes*: direcionar a conexão, PeerHopCount, MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>  
  
    -   <span data-ttu-id="d0ef1-159">*Ocasionais*: filtro Local.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-159">*Occasional*:  Local filter.</span></span>  
  
-   <span data-ttu-id="d0ef1-160">**Uso de largura de banda**</span><span class="sxs-lookup"><span data-stu-id="d0ef1-160">**Bandwidth use**</span></span>  
  
    -   <span data-ttu-id="d0ef1-161">*Alta*: direcionar a conexão, menor é aconselhável usar MessagePropagationFilter ou filtro local.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>  
  
    -   <span data-ttu-id="d0ef1-162">*Baixo*: qualquer, conexão direta provavelmente não é necessária.</span><span class="sxs-lookup"><span data-stu-id="d0ef1-162">*Low*:  Any, direct connection probably not needed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d0ef1-163">Consulte também</span><span class="sxs-lookup"><span data-stu-id="d0ef1-163">See Also</span></span>  
 [<span data-ttu-id="d0ef1-164">Criando um aplicativo de canal par</span><span class="sxs-lookup"><span data-stu-id="d0ef1-164">Building a Peer Channel Application</span></span>](../../../../docs/framework/wcf/feature-details/building-a-peer-channel-application.md)
