---
title: "Práticas recomendadas para sessões confiáveis"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
caps.latest.revision: "6"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 6e20b5cf02e7aef31127bb88e27e21965a192a6b
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="best-practices-for-reliable-sessions"></a><span data-ttu-id="c6608-102">Práticas recomendadas para sessões confiáveis</span><span class="sxs-lookup"><span data-stu-id="c6608-102">Best Practices for Reliable Sessions</span></span>

<span data-ttu-id="c6608-103">Este tópico discute as práticas recomendadas para sessões confiáveis.</span><span class="sxs-lookup"><span data-stu-id="c6608-103">This topic discusses best practices for reliable sessions.</span></span>

## <a name="setting-maxtransferwindowsize"></a><span data-ttu-id="c6608-104">Configuração MaxTransferWindowSize</span><span class="sxs-lookup"><span data-stu-id="c6608-104">Setting MaxTransferWindowSize</span></span>

<span data-ttu-id="c6608-105">Sessões confiáveis em [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] usam uma janela de transferência para manter as mensagens no cliente e no serviço.</span><span class="sxs-lookup"><span data-stu-id="c6608-105">Reliable sessions in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] use a transfer window to hold messages on the client and service.</span></span> <span data-ttu-id="c6608-106">A propriedade configurável <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indica quantas mensagens pode manter a janela de transferência.</span><span class="sxs-lookup"><span data-stu-id="c6608-106">The configurable property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages the transfer window can hold.</span></span>

<span data-ttu-id="c6608-107">O remetente, isso indica quantas mensagens pode manter a janela de transferência durante a espera por confirmações; no destinatário, ele indica quantas mensagens para armazenar em buffer para o serviço.</span><span class="sxs-lookup"><span data-stu-id="c6608-107">On the sender, this indicates how many messages the transfer window can hold while waiting for acknowledgements; on the receiver, it indicates how many messages to buffer for the service.</span></span>

<span data-ttu-id="c6608-108">Escolher o tamanho correto afeta a eficiência da rede e a capacidade ideal do serviço.</span><span class="sxs-lookup"><span data-stu-id="c6608-108">Choosing the right size impacts the efficiency of the network and the optimal capacity of the service.</span></span> <span data-ttu-id="c6608-109">As seções a seguir detalham o que considerar ao escolher um valor para essa propriedade e o impacto do valor.</span><span class="sxs-lookup"><span data-stu-id="c6608-109">The following sections detail what to consider when choosing a value for this property and the impact of the value.</span></span>

<span data-ttu-id="c6608-110">O tamanho de janela de transferência padrão é de oito mensagens.</span><span class="sxs-lookup"><span data-stu-id="c6608-110">The default transfer window size is eight messages.</span></span>

### <a name="efficient-use-of-the-network"></a><span data-ttu-id="c6608-111">Uso eficiente da rede</span><span class="sxs-lookup"><span data-stu-id="c6608-111">Efficient use of the network</span></span>

<span data-ttu-id="c6608-112">Nesse contexto, o termo *rede* corresponde a todos os itens usados como a base de comunicação entre um cliente (remetente) e um serviço (destinatário).</span><span class="sxs-lookup"><span data-stu-id="c6608-112">In this context, the term *network* corresponds to everything used as the basis of communication between a client (sender) and a service (receiver).</span></span> <span data-ttu-id="c6608-113">Isso inclui as conexões de transporte e qualquer intermediário ou pontes entre, incluindo roteadores SOAP ou HTTP proxies/firewalls.</span><span class="sxs-lookup"><span data-stu-id="c6608-113">This includes the transport connections and any intermediary or bridges in between, including SOAP routers or HTTP proxies/firewalls.</span></span>

<span data-ttu-id="c6608-114">Uso eficiente da rede garante que a capacidade de rede totalmente é usada.</span><span class="sxs-lookup"><span data-stu-id="c6608-114">Efficient use of the network ensures that network capacity is fully used.</span></span> <span data-ttu-id="c6608-115">O volume de dados que podem ser transferidos pela rede por segundo (*taxa de dados*) e o tempo necessário para transferir dados do remetente para o receptor (*latência*) afetar como efetivamente a rede é utilizada.</span><span class="sxs-lookup"><span data-stu-id="c6608-115">Both the amount of data that can be transferred per second over the network (*data rate*) and the time it takes to transfer data from the sender to the receiver (*latency*) impact how effectively the network is utilized.</span></span>

<span data-ttu-id="c6608-116">No remetente, a propriedade <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indica a quantidade de mensagens pode conter sua janela de transferência durante a espera por confirmações.</span><span class="sxs-lookup"><span data-stu-id="c6608-116">On the sender, the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages its transfer window can hold while waiting for acknowledgements.</span></span> <span data-ttu-id="c6608-117">Se a latência de rede for alta e para garantir um remetente responsivo e utilização de rede eficaz, você deve aumentar o tamanho da janela de transferência.</span><span class="sxs-lookup"><span data-stu-id="c6608-117">If the network latency is high and in order to ensure a responsive sender and effective network utilization, you should increase the transfer window size.</span></span>

<span data-ttu-id="c6608-118">Por exemplo mesmo se o remetente mantém o ritmo com taxa de dados, latência pode ser alta se existirem vários intermediários entre o remetente e o destinatário ou os dados devem passar por meio de um intermediário com perdas ou rede.</span><span class="sxs-lookup"><span data-stu-id="c6608-118">For example even if the sender keeps up with data rate, latency could be high if several intermediaries exist between the sender and receiver or the data must pass through a lossy intermediary or network.</span></span> <span data-ttu-id="c6608-119">Portanto, o remetente tem espera por confirmações para mensagens em sua janela de transferência antes de aceitar novas mensagens para enviar o percurso.</span><span class="sxs-lookup"><span data-stu-id="c6608-119">Thus, the sender has to wait for acknowledgements for the messages in its transfer window before accepting new messages to send on the wire.</span></span> <span data-ttu-id="c6608-120">Quanto menor o buffer com alta latência, menos eficazes a utilização da rede.</span><span class="sxs-lookup"><span data-stu-id="c6608-120">The smaller the buffer with high latency, the less effective the network utilization.</span></span> <span data-ttu-id="c6608-121">Por outro lado, muito alta um tamanho de janela de transferência pode afetar o serviço porque o serviço talvez precise ficar em dia com alta taxa de dados enviados pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="c6608-121">On the other hand, too high a transfer window size may impact the service because the service may need to catch up to the high rate of data sent by the client.</span></span>

### <a name="running-the-service-to-capacity"></a><span data-ttu-id="c6608-122">Executando o serviço de capacidade</span><span class="sxs-lookup"><span data-stu-id="c6608-122">Running the service to capacity</span></span>

<span data-ttu-id="c6608-123">Quanto a rede é usada com eficiência, idealmente, você também deseja o serviço para ser executado na capacidade total ideal.</span><span class="sxs-lookup"><span data-stu-id="c6608-123">As much as the network is used efficiently, ideally you also want the service to run at optimal capacity.</span></span> <span data-ttu-id="c6608-124">A propriedade de tamanho de janela de transferência no receptor indica quantas mensagens que o receptor pode buffer.</span><span class="sxs-lookup"><span data-stu-id="c6608-124">The transfer window size property on the receiver indicates how many messages the receiver can buffer.</span></span> <span data-ttu-id="c6608-125">Esse buffer de mensagem ajuda não só o controle de fluxo de rede, mas também permite que o serviço seja executado com capacidade total.</span><span class="sxs-lookup"><span data-stu-id="c6608-125">This message buffering helps not only the network flow control but also enables the service to run to full capacity.</span></span> <span data-ttu-id="c6608-126">Por exemplo, se o buffer é uma mensagem e as mensagens chegam mais rápido do que o serviço pode processá-las, em seguida, a rede pode receber mensagens de e capacidade pode ser perdida ou subutilizada.</span><span class="sxs-lookup"><span data-stu-id="c6608-126">For example if the buffer is one message and messages arrive faster than the service can process them, then the network might drop messages and capacity might be wasted or underutilized.</span></span>

<span data-ttu-id="c6608-127">Usar um buffer aumenta a disponibilidade do serviço como simultaneamente recebe e armazena em buffer uma mensagem durante o processamento das mensagens recebidas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c6608-127">Using a buffer increases the availability of the service as it concurrently receives and buffers a message while processing the previously received messages.</span></span>

<span data-ttu-id="c6608-128">É recomendável que você use o mesmo `MaxTransferWindowSize` no remetente e receptor.</span><span class="sxs-lookup"><span data-stu-id="c6608-128">We recommended that you use the same `MaxTransferWindowSize` on both the sender and receiver.</span></span>

### <a name="enabling-flow-control"></a><span data-ttu-id="c6608-129">Habilitar o controle de fluxo</span><span class="sxs-lookup"><span data-stu-id="c6608-129">Enabling flow control</span></span>

<span data-ttu-id="c6608-130">*Controle de fluxo* é um mecanismo que garante que o remetente e o destinatário acompanhar entre si, ou seja, as mensagens são consumidas e tratadas tão rápido quanto eles são produzidos.</span><span class="sxs-lookup"><span data-stu-id="c6608-130">*Flow control* is a mechanism that ensures that the sender and receiver keep pace with each other, that is, the messages are consumed and acted upon as fast as they're produced.</span></span> <span data-ttu-id="c6608-131">O tamanho da janela de transferência no cliente e serviço garante que o remetente e o destinatário dentro de uma janela razoável de sincronização.</span><span class="sxs-lookup"><span data-stu-id="c6608-131">The transfer window size on the client and service ensures that the sender and receiver are within a reasonable window of synchronization.</span></span>

<span data-ttu-id="c6608-132">É altamente recomendável que você defina a propriedade <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> para `true` quando você estiver usando uma sessão confiável entre um [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] cliente e um [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] serviço.</span><span class="sxs-lookup"><span data-stu-id="c6608-132">We highly recommended that you set the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> to `true` when you're using a reliable session between a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service.</span></span>

## <a name="setting-maxpendingchannels"></a><span data-ttu-id="c6608-133">Configuração MaxPendingChannels</span><span class="sxs-lookup"><span data-stu-id="c6608-133">Setting MaxPendingChannels</span></span>

<span data-ttu-id="c6608-134">Ao escrever um serviço que permite a comunicação de sessão confiável de diferentes clientes, é possível ter vários clientes estabelecer uma sessão confiável para o serviço ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="c6608-134">When writing a service that enables reliable session communication from different clients, it's possible to have many clients establish a reliable session to the service at the same time.</span></span> <span data-ttu-id="c6608-135">A resposta do serviço nessas situações depende do `MaxPendingChannels` propriedade.</span><span class="sxs-lookup"><span data-stu-id="c6608-135">The response of the service in these situations depends on the `MaxPendingChannels` property.</span></span>

<span data-ttu-id="c6608-136">Quando o remetente cria um canal de sessão confiável a um destinatário, um handshake entre eles estabelece uma sessão confiável.</span><span class="sxs-lookup"><span data-stu-id="c6608-136">When the sender creates a reliable session channel to a receiver, a handshake between them establishes a reliable session.</span></span> <span data-ttu-id="c6608-137">Após o estabelecimento da sessão confiável, o canal é colocado em uma fila pendente de canal para aceitação pelo serviço.</span><span class="sxs-lookup"><span data-stu-id="c6608-137">After the reliable session is established, the channel is put in a pending channel queue for acceptance by the service.</span></span> <span data-ttu-id="c6608-138">O `MaxPendingChannels` propriedade indica quantos canais podem ser nesse estado.</span><span class="sxs-lookup"><span data-stu-id="c6608-138">The `MaxPendingChannels` property indicates how many channels can be in this state.</span></span>

<span data-ttu-id="c6608-139">É possível que o serviço esteja em um estado em que ele não pode aceitar mais canais.</span><span class="sxs-lookup"><span data-stu-id="c6608-139">It's possible for the service to be in a state where it can't accept more channels.</span></span> <span data-ttu-id="c6608-140">Se a fila está cheia, uma tentativa de estabelecer uma sessão confiável é rejeitada e o cliente deve repetir.</span><span class="sxs-lookup"><span data-stu-id="c6608-140">If the queue is full, an attempt to establish a reliable session is rejected, and the client must retry.</span></span>

<span data-ttu-id="c6608-141">Também é possível que os canais pendentes na fila de permanecem na fila por mais tempo.</span><span class="sxs-lookup"><span data-stu-id="c6608-141">It's also possible that the pending channels in the queue remain in the queue for a longer duration.</span></span> <span data-ttu-id="c6608-142">Enquanto isso, um tempo limite de inatividade na sessão confiável pode ocorrer, fazendo com que o canal a transição para um estado de falha.</span><span class="sxs-lookup"><span data-stu-id="c6608-142">In the meantime, an inactivity timeout on the reliable session may occur, causing the channel to transition to a faulted state.</span></span>

<span data-ttu-id="c6608-143">Ao escrever um serviço que atende a vários clientes simultaneamente, você deve definir um valor que é adequado para suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="c6608-143">When writing a service that services multiple clients simultaneously, you should set a value that's suitable for your needs.</span></span> <span data-ttu-id="c6608-144">Definindo um valor muito alto para o `MaxPendingChannels` propriedade afeta o conjunto de trabalho.</span><span class="sxs-lookup"><span data-stu-id="c6608-144">Setting too high a value for the `MaxPendingChannels` property impacts your working set.</span></span>

<span data-ttu-id="c6608-145">O valor padrão para <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> é quatro canais.</span><span class="sxs-lookup"><span data-stu-id="c6608-145">The default value for <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> is four channels.</span></span>

## <a name="reliable-sessions-and-hosting"></a><span data-ttu-id="c6608-146">Sessões confiáveis e hospedagem</span><span class="sxs-lookup"><span data-stu-id="c6608-146">Reliable sessions and hosting</span></span>

<span data-ttu-id="c6608-147">Quando web hospeda um serviço que usa sessões confiáveis, você deve ter as seguintes considerações importantes em mente:</span><span class="sxs-lookup"><span data-stu-id="c6608-147">When web hosting a service that uses reliable sessions, you should keep the following important considerations in mind:</span></span>

- <span data-ttu-id="c6608-148">Sessões confiáveis são com monitoração de estado e o estado é mantido no AppDomain.</span><span class="sxs-lookup"><span data-stu-id="c6608-148">Reliable sessions are stateful, and state is maintained in the AppDomain.</span></span> <span data-ttu-id="c6608-149">Isso significa que todas as mensagens que fazem parte de uma sessão confiável devem ser processadas no mesmo AppDomain.</span><span class="sxs-lookup"><span data-stu-id="c6608-149">This means that all messages that are part of a reliable session must be processed in the same AppDomain.</span></span> <span data-ttu-id="c6608-150">Web farms e ambientes web onde o tamanho do farm ou do ambiente é maior do que um nó não podem garantir essa restrição.</span><span class="sxs-lookup"><span data-stu-id="c6608-150">Web farms and web gardens where the size of the farm or garden is greater than one node can't guarantee this constraint.</span></span>

- <span data-ttu-id="c6608-151">Sessões confiáveis usando dois canais HTTP (por exemplo, usando `WsDualHttpBinding`) pode exigir mais do que o padrão de duas conexões por-cliente HTTP.</span><span class="sxs-lookup"><span data-stu-id="c6608-151">Reliable sessions using dual HTTP channels (for example, using `WsDualHttpBinding`) can require more than the default of two HTTP connections per-client.</span></span> <span data-ttu-id="c6608-152">Isso significa que uma sessão segura duplex pode exigir até duas conexões cada forma porque mensagens simultâneas do aplicativo e o protocolo podem transferir a cada forma em um determinado momento.</span><span class="sxs-lookup"><span data-stu-id="c6608-152">This means a duplex reliable session can require up to two connections each way because concurrent application and protocol messages may be transferring each way at any given time.</span></span> <span data-ttu-id="c6608-153">Em determinadas condições, dependendo do padrão de troca de mensagens do serviço, isso significa que é possível deadlock um serviço hospedado da web usando HTTP dupla e sessões confiáveis.</span><span class="sxs-lookup"><span data-stu-id="c6608-153">Under certain conditions depending on the message exchange pattern of the service, this means that it's possible to deadlock a web-hosted service using dual HTTP and reliable sessions.</span></span> <span data-ttu-id="c6608-154">Para aumentar o número de conexões HTTP permitidas por cliente, adicione o seguinte ao arquivo de configuração relevantes (por exemplo, *Web. config* do serviço em questão):</span><span class="sxs-lookup"><span data-stu-id="c6608-154">To increase the number of allowable HTTP connections per client, add the following to the relevant configuration file (for example, *web.config* of the service in question):</span></span>

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  <span data-ttu-id="c6608-155">O valor de `maxconnection` atributo é o número de conexões necessárias.</span><span class="sxs-lookup"><span data-stu-id="c6608-155">The value of the `maxconnection` attribute is the number of connections needed.</span></span> <span data-ttu-id="c6608-156">Nesse caso, o mínimo deve ser quatro conexões.</span><span class="sxs-lookup"><span data-stu-id="c6608-156">The minimum in this case should be four connections.</span></span>
