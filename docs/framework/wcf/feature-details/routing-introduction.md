---
title: Introdução ao roteamento
ms.date: 03/30/2017
ms.assetid: bf6ceb38-6622-433b-9ee7-f79bc93497a1
ms.openlocfilehash: d0f07d0dd171de428f7d556d84dfda04e35880b2
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59158672"
---
# <a name="routing-introduction"></a><span data-ttu-id="a34af-102">Introdução ao roteamento</span><span class="sxs-lookup"><span data-stu-id="a34af-102">Routing Introduction</span></span>
<span data-ttu-id="a34af-103">O serviço Routing fornece um SOAP conectável genérico que é capaz de roteamento de mensagens com base no conteúdo da mensagem intermediário.</span><span class="sxs-lookup"><span data-stu-id="a34af-103">The Routing Service provides a generic pluggable SOAP intermediary that is capable of routing messages based on message content.</span></span> <span data-ttu-id="a34af-104">Com o serviço de roteamento, você pode criar lógica de roteamento complexa que permite implementar cenários como a agregação de serviço, controle de versão do serviço, roteamento de prioridades e roteamento de multicast.</span><span class="sxs-lookup"><span data-stu-id="a34af-104">With the Routing Service, you can create complex routing logic that allows you to implement scenarios such as service aggregation, service versioning, priority routing, and multicast routing.</span></span> <span data-ttu-id="a34af-105">O serviço de roteamento também fornece a manipulação de erros permite que você configurar as listas de pontos de extremidade de backup, ao qual as mensagens são enviadas se ocorrer uma falha ao enviar para o ponto de extremidade de destino principal.</span><span class="sxs-lookup"><span data-stu-id="a34af-105">The Routing Service also provides error handling that allows you to set up lists of backup endpoints, to which messages are sent if a failure occurs when sending to the primary destination endpoint.</span></span>  
  
 <span data-ttu-id="a34af-106">Este tópico é destinado para os novos para o serviço de roteamento e aborda a configuração básica e que hospeda o serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="a34af-106">This topic is intended for those new to the Routing Service and covers basic configuration and hosting of the Routing Service.</span></span>  
  
## <a name="configuration"></a><span data-ttu-id="a34af-107">Configuração</span><span class="sxs-lookup"><span data-stu-id="a34af-107">Configuration</span></span>  
 <span data-ttu-id="a34af-108">O serviço de roteamento é implementado como um serviço WCF que expõe um ou mais pontos de extremidade que recebem mensagens de aplicativos cliente e rotear as mensagens para um ou mais pontos de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="a34af-108">The Routing Service is implemented as a WCF service that exposes one or more service endpoints that receive messages from client applications and route the messages to one or more destination endpoints.</span></span> <span data-ttu-id="a34af-109">O serviço fornece um <xref:System.ServiceModel.Routing.RoutingBehavior>, que é aplicado a pontos de extremidade de serviço expostos pelo serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-109">The service provides a <xref:System.ServiceModel.Routing.RoutingBehavior>, which is applied to the service endpoints exposed by the service.</span></span> <span data-ttu-id="a34af-110">Esse comportamento é usado para configurar vários aspectos de como funciona o serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-110">This behavior is used to configure various aspects of how the service operates.</span></span> <span data-ttu-id="a34af-111">Para facilitar a configuração ao usar um arquivo de configuração, os parâmetros são especificados na **RoutingBehavior**.</span><span class="sxs-lookup"><span data-stu-id="a34af-111">For ease of configuration when using a configuration file, the parameters are specified on the **RoutingBehavior**.</span></span> <span data-ttu-id="a34af-112">Em cenários com base no código, esses parâmetros seriam ser especificados como parte de um <xref:System.ServiceModel.Routing.RoutingConfiguration> objeto, que pode ser passado para um **RoutingBehavior**.</span><span class="sxs-lookup"><span data-stu-id="a34af-112">In code-based scenarios, these parameters would be specified as part of a <xref:System.ServiceModel.Routing.RoutingConfiguration> object, which can then be passed to a **RoutingBehavior**.</span></span>  
  
 <span data-ttu-id="a34af-113">Ao iniciar, esse comportamento adiciona o <xref:System.ServiceModel.Routing.SoapProcessingBehavior>, que é usado para executar o processamento SOAP das mensagens, para os pontos de extremidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="a34af-113">When starting, this behavior adds the <xref:System.ServiceModel.Routing.SoapProcessingBehavior>, which is used to perform SOAP processing of messages, to the client endpoints.</span></span> <span data-ttu-id="a34af-114">Isso permite que o serviço de roteamento transmitir mensagens para pontos de extremidade que requerem um diferentes **MessageVersion** que a mensagem foi recebida sobre o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a34af-114">This allows the Routing Service to transmit messages to endpoints that require a different **MessageVersion** than the endpoint the message was received over.</span></span> <span data-ttu-id="a34af-115">O **RoutingBehavior** também registra uma extensão de serviço, o <xref:System.ServiceModel.Routing.RoutingExtension>, que fornece um ponto de acessibilidade para modificar a configuração do serviço de roteamento em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="a34af-115">The **RoutingBehavior** also registers a service extension, the <xref:System.ServiceModel.Routing.RoutingExtension>, which provides an accessibility point for modifying the Routing Service configuration at run time.</span></span>  
  
 <span data-ttu-id="a34af-116">O **RoutingConfiguration** classe fornece um meio consistente de configurar e atualizar a configuração do serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="a34af-116">The **RoutingConfiguration** class provides a consistent means of configuring and updating the configuration of the Routing Service.</span></span>  <span data-ttu-id="a34af-117">Ele contém parâmetros que atuam como as configurações para o serviço de roteamento e são usados para configurar o **RoutingBehavior** quando o serviço é iniciado, ou é passado para o **RoutingExtension** para modificar o roteamento configuração de tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="a34af-117">It contains parameters that act as the settings for the Routing Service and is used to configure the **RoutingBehavior** when the service starts, or is passed to the **RoutingExtension** to modify routing configuration at run time.</span></span>  
  
 <span data-ttu-id="a34af-118">A lógica de roteamento usada para executar o roteamento baseado em conteúdo de mensagens é definida pelo agrupamento de vários <xref:System.ServiceModel.Dispatcher.MessageFilter> objetos juntos para filtram tabelas (<xref:System.ServiceModel.Dispatcher.MessageFilterTable%601> objetos).</span><span class="sxs-lookup"><span data-stu-id="a34af-118">The routing logic used to perform content-based routing of messages is defined by grouping multiple <xref:System.ServiceModel.Dispatcher.MessageFilter> objects together into filter tables (<xref:System.ServiceModel.Dispatcher.MessageFilterTable%601> objects).</span></span> <span data-ttu-id="a34af-119">Mensagens de entrada são avaliadas em relação os filtros de mensagem contidos na tabela de filtros e para cada **MessageFilter** que coincide com a mensagem encaminhada para um ponto de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="a34af-119">Incoming messages are evaluated against the message filters contained in the filter table, and for each **MessageFilter** that matches the message, forwarded to a destination endpoint.</span></span> <span data-ttu-id="a34af-120">A tabela de filtro que deve ser usado para rotear mensagens é especificada usando o **RoutingBehavior** na configuração ou por meio de código usando o **RoutingConfiguration** objeto.</span><span class="sxs-lookup"><span data-stu-id="a34af-120">The filter table that should be used to route messages is specified by using either the **RoutingBehavior** in configuration or through code by using the **RoutingConfiguration** object.</span></span>  
  
### <a name="defining-endpoints"></a><span data-ttu-id="a34af-121">Definir pontos de extremidade</span><span class="sxs-lookup"><span data-stu-id="a34af-121">Defining Endpoints</span></span>  
 <span data-ttu-id="a34af-122">Embora possa parecer que você deve iniciar a configuração definindo a lógica de roteamento que você usará, sua primeira etapa, na verdade, deve ser determinar a forma de você será o roteamento de mensagens para os pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a34af-122">While it may seem that you should start your configuration by defining the routing logic you will use, your first step should actually be to determine the shape of the endpoints you will be routing messages to.</span></span> <span data-ttu-id="a34af-123">O serviço de roteamento usa contratos que definem a forma dos canais usados para receber e enviar mensagens e, portanto, a forma do canal de entrada deve corresponder do canal de saída.</span><span class="sxs-lookup"><span data-stu-id="a34af-123">The Routing Service uses contracts that define the shape of the channels used to receive and send messages, and therefore the shape of the input channel must match that of the output channel.</span></span>  <span data-ttu-id="a34af-124">Por exemplo, se você está roteando para pontos de extremidade que usam a forma de canal de solicitação-resposta, em seguida, você deve usar um contrato compatível com os pontos de extremidade de entrada, como o <xref:System.ServiceModel.Routing.IRequestReplyRouter>.</span><span class="sxs-lookup"><span data-stu-id="a34af-124">For example, if you are routing to endpoints that use the request-reply channel shape, then you must use a compatible contract on the inbound endpoints, such as the <xref:System.ServiceModel.Routing.IRequestReplyRouter>.</span></span>  
  
 <span data-ttu-id="a34af-125">Isso significa que, se seus pontos de extremidade de destino usam contratos com vários padrões de comunicação (por exemplo, a combinação de operações unidirecionais e bidirecionais), não é possível criar um ponto de extremidade de serviço único que pode receber e rotear mensagens para todos eles.</span><span class="sxs-lookup"><span data-stu-id="a34af-125">This means that if your destination endpoints use contracts with multiple communication patterns (such as mixing one-way and two-way operations,) you cannot create a single service endpoint that can receive and route messages to all of them.</span></span> <span data-ttu-id="a34af-126">Você deve determinar quais pontos de extremidade têm formas compatíveis e definem um ou mais pontos de extremidade que serão usados para receber mensagens a serem roteadas para os pontos de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="a34af-126">You must determine which endpoints have compatible shapes and define one or more service endpoints that will be used to receive messages to be routed to the destination endpoints.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a34af-127">Ao trabalhar com contratos que especificam os vários padrões de comunicação (por exemplo, uma combinação de operações unidirecionais e bidirecionais), uma solução alternativa é usar um contrato duplex no serviço de roteamento, como <xref:System.ServiceModel.Routing.IDuplexSessionRouter>.</span><span class="sxs-lookup"><span data-stu-id="a34af-127">When working with contracts that specify multiple communication patterns (such as a mix of one-way and two-way operations,) a workaround is to use a duplex contract at the Routing Service such as <xref:System.ServiceModel.Routing.IDuplexSessionRouter>.</span></span> <span data-ttu-id="a34af-128">No entanto, isso significa que a associação deve ser capaz de comunicação duplex, o que pode não ser possível para todos os cenários.</span><span class="sxs-lookup"><span data-stu-id="a34af-128">However this means that the binding must be capable of duplex communication, which may not be possible for all scenarios.</span></span> <span data-ttu-id="a34af-129">Em cenários em que isso não for possível, fatorar a comunicação em vários pontos de extremidade ou modificar o aplicativo pode ser necessário.</span><span class="sxs-lookup"><span data-stu-id="a34af-129">In scenarios where this is not possible, factoring the communication into multiple endpoints or modifying the application may be necessary.</span></span>  
  
 <span data-ttu-id="a34af-130">Para obter mais informações sobre contratos de roteamento, consulte [roteando contratos](routing-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="a34af-130">For more information about routing contracts, see [Routing Contracts](routing-contracts.md).</span></span>  
  
 <span data-ttu-id="a34af-131">Depois que o ponto de extremidade de serviço é definido, você pode usar o **RoutingBehavior** para associar a um determinado **RoutingConfiguration** com o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a34af-131">After the service endpoint is defined, you can use the **RoutingBehavior** to associate a specific **RoutingConfiguration** with the endpoint.</span></span> <span data-ttu-id="a34af-132">Ao configurar o serviço de roteamento usando um arquivo de configuração, o **RoutingBehavior** é usado para especificar a tabela de filtro que contém a lógica de roteamento usada para processar as mensagens recebidas neste ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a34af-132">When configuring the Routing Service by using a configuration file, the **RoutingBehavior** is used to specify the filter table that contains the routing logic used to process messages received on this endpoint.</span></span> <span data-ttu-id="a34af-133">Se você estiver configurando o serviço de roteamento por meio de programação pode especificar a tabela de filtro usando o **RoutingConfiguration**.</span><span class="sxs-lookup"><span data-stu-id="a34af-133">If you are configuring the Routing Service programmatically you can specify the filter table by using the **RoutingConfiguration**.</span></span>  
  
 <span data-ttu-id="a34af-134">O exemplo a seguir define pontos de extremidade do serviço e cliente que são usados pelo serviço de roteamento de forma programática e usando um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="a34af-134">The following example defines the service and client endpoints that are used by the Routing Service both programmatically and by using a configuration file.</span></span>  
  
```xml  
    <services>  
      <!--ROUTING SERVICE -->  
      <service behaviorConfiguration="routingData"  
               name="System.ServiceModel.Routing.RoutingService">  
        <host>  
          <baseAddresses>  
            <add baseAddress="http://localhost:8000/routingservice/router"/>  
          </baseAddresses>  
        </host>  
        <!-- Define the service endpoints that are receive messages -->  
        <endpoint address=""  
                  binding="wsHttpBinding"  
                  name="reqReplyEndpoint"  
                  contract="System.ServiceModel.Routing.IRequestReplyRouter" />
      </service>  
    </services>  
    <behaviors>  
      <serviceBehaviors>  
        <behavior name="routingData">  
          <serviceMetadata httpGetEnabled="True"/>  
          <!-- Add the RoutingBehavior and specify the Routing Table to use -->  
          <routing filterTableName="routingTable1" />  
        </behavior>  
      </serviceBehaviors>  
    </behaviors>  
    <client>  
    <!-- Define the client endpoint(s) to route messages to -->  
      <endpoint name="CalculatorService"  
                address="http://localhost:8000/servicemodelsamples/service"  
                binding="wsHttpBinding" contract="*" />  
    </client>  
```  
  
```csharp  
//set up some communication defaults  
string clientAddress = "http://localhost:8000/servicemodelsamples/service";  
string routerAddress = "http://localhost:8000/routingservice/router";  
Binding routerBinding = new WSHttpBinding();  
Binding clientBinding = new WSHttpBinding();  
//add the endpoint the router uses to receive messages  
serviceHost.AddServiceEndpoint(  
     typeof(IRequestReplyRouter),   
     routerBinding,   
     routerAddress);  
//create the client endpoint the router routes messages to  
ContractDescription contract = ContractDescription.GetContract(  
     typeof(IRequestReplyRouter));  
ServiceEndpoint client = new ServiceEndpoint(  
     contract,   
     clientBinding,   
     new EndpointAddress(clientAddress));  
//create a new routing configuration object  
RoutingConfiguration rc = new RoutingConfiguration();  
….  
rc.FilterTable.Add(new MatchAllMessageFilter(), endpointList);  
//attach the behavior to the service host  
serviceHost.Description.Behaviors.Add(  
     new RoutingBehavior(rc));  
```  
  
 <span data-ttu-id="a34af-135">Este exemplo configura o serviço de roteamento para expor um ponto de extremidade com um endereço de `http://localhost:8000/routingservice/router`, que é usado para receber mensagens a serem roteadas.</span><span class="sxs-lookup"><span data-stu-id="a34af-135">This example configures the Routing Service to expose a single endpoint with an address of `http://localhost:8000/routingservice/router`, which is used to receive messages to be routed.</span></span> <span data-ttu-id="a34af-136">Porque as mensagens são roteadas para os pontos de extremidade de solicitação-resposta, o ponto de extremidade de serviço usa o <xref:System.ServiceModel.Routing.IRequestReplyRouter> contrato.</span><span class="sxs-lookup"><span data-stu-id="a34af-136">Because the messages are routed to request-reply endpoints, the service endpoint uses the <xref:System.ServiceModel.Routing.IRequestReplyRouter> contract.</span></span> <span data-ttu-id="a34af-137">Essa configuração também define um ponto de extremidade de cliente único `http://localhost:8000/servicemodelsample/service` que mensagens são roteadas.</span><span class="sxs-lookup"><span data-stu-id="a34af-137">This configuration also defines a single client endpoint of `http://localhost:8000/servicemodelsample/service` that messages are routed to.</span></span> <span data-ttu-id="a34af-138">A tabela de filtro (não mostrada) chamada "routingTable1" contém a lógica de roteamento usada para rotear mensagens e é associada com o ponto de extremidade de serviço usando o **RoutingBehavior** (para um arquivo de configuração) ou  **RoutingConfiguration** (para a configuração programática).</span><span class="sxs-lookup"><span data-stu-id="a34af-138">The filter table (not shown) named "routingTable1" contains the routing logic used to route messages, and is associated with the service endpoint by using the **RoutingBehavior** (for a configuration file) or **RoutingConfiguration** (for programmatic configuration).</span></span>  
  
### <a name="routing-logic"></a><span data-ttu-id="a34af-139">Lógica de roteamento</span><span class="sxs-lookup"><span data-stu-id="a34af-139">Routing Logic</span></span>  
 <span data-ttu-id="a34af-140">Para definir a lógica de roteamento usada para rotear mensagens, você deve determinar quais dados contidos em mensagens de entrada podem ser exclusivamente devidas ações sejam após.</span><span class="sxs-lookup"><span data-stu-id="a34af-140">To define the routing logic used to route messages, you must determine what data contained within the incoming messages can be uniquely acted upon.</span></span> <span data-ttu-id="a34af-141">Por exemplo, se todos os pontos de destino você está roteando para compartilhar as mesmas ações de SOAP, o valor da ação contido dentro da mensagem não é um bom indicador de qual ponto de extremidade específico a mensagem deve ser roteada para.</span><span class="sxs-lookup"><span data-stu-id="a34af-141">For example, if all the destination endpoints you are routing to share the same SOAP Actions, the value of the Action contained within the message is not a good indicator of which specific endpoint the message should be routed to.</span></span> <span data-ttu-id="a34af-142">Se você exclusivamente deve rotear mensagens para um ponto de extremidade específico, você deve filtrar nos dados que identifica exclusivamente o ponto de extremidade de destino que a mensagem é roteada para.</span><span class="sxs-lookup"><span data-stu-id="a34af-142">If you must uniquely route messages to one specific endpoint, you should filter upon data that uniquely identifies the destination endpoint that the message is routed to.</span></span>  
  
 <span data-ttu-id="a34af-143">O serviço Routing fornece várias **MessageFilter** implementações que inspecionam valores específicos dentro da mensagem, como o endereço, ação, nome do ponto de extremidade ou até mesmo uma consulta XPath.</span><span class="sxs-lookup"><span data-stu-id="a34af-143">The Routing Service provides several **MessageFilter** implementations that inspect specific values within the message, such as the address, action, endpoint name, or even an XPath query.</span></span> <span data-ttu-id="a34af-144">Se nenhuma dessas implementações atender às suas necessidades, você pode criar um personalizado **MessageFilter** implementação.</span><span class="sxs-lookup"><span data-stu-id="a34af-144">If none of these implementations meet your needs you can create a custom **MessageFilter** implementation.</span></span> <span data-ttu-id="a34af-145">Para obter mais informações sobre filtros de mensagem e uma comparação das implementações usada pelo serviço de roteamento, consulte [filtros de mensagem](message-filters.md) e [escolhendo um filtro](choosing-a-filter.md).</span><span class="sxs-lookup"><span data-stu-id="a34af-145">For more information about message filters and a comparison of the implementations used by the Routing Service, see [Message Filters](message-filters.md) and [Choosing a Filter](choosing-a-filter.md).</span></span>  
  
 <span data-ttu-id="a34af-146">Vários filtros de mensagem são organizados em tabelas de filtro, que associar cada **MessageFilter** com um ponto de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="a34af-146">Multiple message filters are organized together into filter tables, which associate each **MessageFilter** with a destination endpoint.</span></span> <span data-ttu-id="a34af-147">Opcionalmente, a tabela de filtro também pode ser usada para especificar uma lista de pontos de extremidade de backup que o serviço de roteamento tentará enviar a mensagem em caso de falha de transmissão.</span><span class="sxs-lookup"><span data-stu-id="a34af-147">Optionally, the filter table can also be used to specify a list of back-up endpoints that the Routing Service will attempt to send the message to in the event of a transmission failure.</span></span>  
  
 <span data-ttu-id="a34af-148">Por padrão todos os filtros de mensagem dentro de uma tabela de filtro são avaliados simultaneamente; No entanto, você pode especificar um <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.Priority%2A> que faz com que os filtros de mensagem a ser avaliada em uma ordem específica.</span><span class="sxs-lookup"><span data-stu-id="a34af-148">By default all message filters within a filter table are evaluated simultaneously; however, you can specify a <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.Priority%2A> that causes the message filters to be evaluated in a specific order.</span></span> <span data-ttu-id="a34af-149">Todas as entradas com a prioridade mais alta são avaliadas primeiro e filtros de mensagem de prioridades inferiores não são avaliados, se uma correspondência for encontrada em um nível de prioridade mais alta.</span><span class="sxs-lookup"><span data-stu-id="a34af-149">All entries with the highest priority are evaluated first, and message filters of lower priorities are not evaluated if a match is found at a higher priority level.</span></span> <span data-ttu-id="a34af-150">Para obter mais informações sobre tabelas de filtro, consulte [filtros de mensagem](message-filters.md).</span><span class="sxs-lookup"><span data-stu-id="a34af-150">For more information about filter tables, see [Message Filters](message-filters.md).</span></span>  
  
 <span data-ttu-id="a34af-151">Os exemplos a seguir usam o <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter>, que é avaliado como `true` para todas as mensagens.</span><span class="sxs-lookup"><span data-stu-id="a34af-151">The following examples use the <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter>, which evaluates to `true` for all messages.</span></span> <span data-ttu-id="a34af-152">Isso **MessageFilter** é adicionado à tabela de filtros "routingTable1", que associa a **MessageFilter** com o ponto de extremidade de cliente chamado "CalculatorService".</span><span class="sxs-lookup"><span data-stu-id="a34af-152">This **MessageFilter** is added to the "routingTable1" filter table, which associates the **MessageFilter** with the client endpoint named "CalculatorService".</span></span> <span data-ttu-id="a34af-153">O **RoutingBehavior** , em seguida, especifica que essa tabela deve ser usado para rotear mensagens processadas pelo ponto de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-153">The **RoutingBehavior** then specifies that this table should be used to route messages processed by the service endpoint.</span></span>  
  
```xml  
<behaviors>  
  <serviceBehaviors>  
    <behavior name="routingData">  
      <serviceMetadata httpGetEnabled="True"/>  
      <!-- Add the RoutingBehavior and specify the Routing Table to use -->  
      <routing filterTableName="routingTable1" />  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
<!--ROUTING SECTION -->  
<routing>  
  <filters>  
    <filter name="MatchAllFilter1" filterType="MatchAll" />  
  </filters>  
  <filterTables>  
    <table name="routingTable1">  
      <filters>  
        <add filterName="MatchAllFilter1" endpointName="CalculatorService" />  
      </filters>  
    </table>  
  </filterTables>  
</routing>  
```  
  
```csharp  
//create a new routing configuration object  
RoutingConfiguration rc = new RoutingConfiguration();  
//create the endpoint list that contains the endpoints to route to  
//in this case we have only one  
List<ServiceEndpoint> endpointList = new List<ServiceEndpoint>();  
endpointList.Add(client);  
//add a MatchAll filter to the Router's filter table  
//map it to the endpoint list defined earlier  
//when a message matches this filter, it is sent to the endpoint contained in the list  
rc.FilterTable.Add(new MatchAllMessageFilter(), endpointList);  
```  
  
> [!NOTE]
>  <span data-ttu-id="a34af-154">Por padrão, o serviço de roteamento de somente avalia os cabeçalhos da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-154">By default, the Routing Service only evaluates the headers of the message.</span></span> <span data-ttu-id="a34af-155">Para permitir que os filtros acessar o corpo da mensagem, você deve definir <xref:System.ServiceModel.Routing.RoutingConfiguration.RouteOnHeadersOnly%2A> para `false`.</span><span class="sxs-lookup"><span data-stu-id="a34af-155">To allow the filters to access the message body, you must set <xref:System.ServiceModel.Routing.RoutingConfiguration.RouteOnHeadersOnly%2A> to `false`.</span></span>  
  
 **<span data-ttu-id="a34af-156">Multicast</span><span class="sxs-lookup"><span data-stu-id="a34af-156">Multicast</span></span>**  
  
 <span data-ttu-id="a34af-157">Embora muitas configurações de serviço de roteamento usam lógica de filtro exclusivo que encaminha mensagens para apenas um ponto de extremidade específico, você precisa rotear uma mensagem específica para vários pontos de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="a34af-157">While many Routing Service configurations use exclusive filter logic that routes messages to only one specific endpoint, you may need to route a given message to multiple destination endpoints.</span></span> <span data-ttu-id="a34af-158">Como uma mensagem para vários destinos de difusão seletiva, as condições a seguir devem ser verdadeiras:</span><span class="sxs-lookup"><span data-stu-id="a34af-158">To multicast a message to multiple destinations, the following conditions must be true:</span></span>  
  
-   <span data-ttu-id="a34af-159">A forma de canal não deve ser de solicitação-resposta (embora podem ser unidirecionais ou bidirecionais,) porque apenas uma resposta pode ser recebida pelo aplicativo cliente em resposta à solicitação.</span><span class="sxs-lookup"><span data-stu-id="a34af-159">The channel shape must not be request-reply (though may be one-way or duplex,) because only one reply can be received by the client application in response to the request.</span></span>  
  
-   <span data-ttu-id="a34af-160">Vários filtros devem retornar `true` ao avaliar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-160">Multiple filters must return `true` when evaluating the message.</span></span>  
  
 <span data-ttu-id="a34af-161">Se essas condições forem atendidas, a mensagem é roteada para todos os pontos de extremidade de todos os filtros que são avaliadas como `true`.</span><span class="sxs-lookup"><span data-stu-id="a34af-161">If these conditions are met, the message is routed to all endpoints of all filters that evaluate to `true`.</span></span> <span data-ttu-id="a34af-162">O exemplo a seguir define uma configuração de roteamento que resulta em mensagens sendo roteadas para os pontos de extremidade, se o endereço do ponto de extremidade na mensagem for `http://localhost:8000/routingservice/router/rounding`.</span><span class="sxs-lookup"><span data-stu-id="a34af-162">The following example defines a routing configuration that results in messages being routed to both endpoints if the endpoint address in the message is `http://localhost:8000/routingservice/router/rounding`.</span></span>  
  
```xml  
<!--ROUTING SECTION -->  
<routing>  
  <filters>  
    <filter name="MatchAllFilter1" filterType="MatchAll" />  
    <filter name="RoundingFilter1" filterType="EndpointAddress"  
            filterData="http://localhost:8000/routingservice/router/rounding" />  
  </filters>  
  <filterTables>  
    <table name="routingTable1">  
      <filters>  
        <add filterName="MatchAllFilter1" endpointName="CalculatorService" />  
        <add filterName="RoundingFilter1" endpointName="RoundingCalcService" />  
      </filters>  
    </table>  
  </filterTables>  
</routing>  
```  
  
```csharp  
rc.FilterTable.Add(new MatchAllMessageFilter(), calculatorEndpointList);  
rc.FilterTable.Add(new EndpointAddressMessageFilter(new EndpointAddress(  
    "http://localhost:8000/routingservice/router/rounding")),  
    roundingCalcEndpointList);  
```  
  
### <a name="soap-processing"></a><span data-ttu-id="a34af-163">Processamento SOAP</span><span class="sxs-lookup"><span data-stu-id="a34af-163">SOAP Processing</span></span>  
 <span data-ttu-id="a34af-164">Para dar suporte a roteamento de mensagens entre os protocolos diferentes, o **RoutingBehavior** por padrão, adiciona o <xref:System.ServiceModel.Routing.SoapProcessingBehavior> para todos os pontos de extremidade do cliente que as mensagens são roteadas.</span><span class="sxs-lookup"><span data-stu-id="a34af-164">To support the routing of messages between dissimilar protocols, the **RoutingBehavior** by default adds the <xref:System.ServiceModel.Routing.SoapProcessingBehavior> to all client endpoint(s) that messages are routed to.</span></span> <span data-ttu-id="a34af-165">Esse comportamento cria automaticamente uma nova **MessageVersion** antes de encaminhar a mensagem ao ponto de extremidade, bem como criar um monitor compatível com **MessageVersion** para qualquer documento de resposta antes de retorná-lo para o aplicativo cliente solicitante.</span><span class="sxs-lookup"><span data-stu-id="a34af-165">This behavior automatically creates a new **MessageVersion** before routing the message to the endpoint, as well as creating a compatible **MessageVersion** for any response document before returning it to the requesting client application.</span></span>  
  
 <span data-ttu-id="a34af-166">As etapas executadas para criar um novo **MessageVersion** para a mensagem de saída são da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="a34af-166">The steps taken to create a new **MessageVersion** for the outbound message are as follows:</span></span>  
  
 **<span data-ttu-id="a34af-167">Processamento de solicitação</span><span class="sxs-lookup"><span data-stu-id="a34af-167">Request processing</span></span>**  
  
-   <span data-ttu-id="a34af-168">Obter o **MessageVersion** da associação/canal de saída.</span><span class="sxs-lookup"><span data-stu-id="a34af-168">Get the **MessageVersion** of the outbound binding/channel.</span></span>  
  
-   <span data-ttu-id="a34af-169">Obter o leitor de corpo da mensagem original.</span><span class="sxs-lookup"><span data-stu-id="a34af-169">Get the body reader for the original message.</span></span>  
  
-   <span data-ttu-id="a34af-170">Crie uma nova mensagem com a mesma ação, o leitor de corpo e um novo **MessageVersion**.</span><span class="sxs-lookup"><span data-stu-id="a34af-170">Create a new message with the same action, body reader, and a new **MessageVersion**.</span></span>  
  
-   <span data-ttu-id="a34af-171">Se <xref:System.ServiceModel.Channels.MessageVersion.Addressing%2A> ! = **Addressing.None**, copie o para, de FaultTo e os cabeçalhos RelatesTo para a nova mensagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-171">If <xref:System.ServiceModel.Channels.MessageVersion.Addressing%2A> != **Addressing.None**, copy the To, From, FaultTo, and RelatesTo headers to the new message.</span></span>  
  
-   <span data-ttu-id="a34af-172">Copie todas as propriedades de mensagem para a nova mensagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-172">Copy all message properties to the new message.</span></span>  
  
-   <span data-ttu-id="a34af-173">Store a mensagem de solicitação original a ser usado ao processar a resposta.</span><span class="sxs-lookup"><span data-stu-id="a34af-173">Store the original request message to use when processing the response.</span></span>  
  
-   <span data-ttu-id="a34af-174">Retorna a nova mensagem de solicitação.</span><span class="sxs-lookup"><span data-stu-id="a34af-174">Return the new request message.</span></span>  
  
 **<span data-ttu-id="a34af-175">Processamento da resposta</span><span class="sxs-lookup"><span data-stu-id="a34af-175">Response processing</span></span>**  
  
-   <span data-ttu-id="a34af-176">Obter o **MessageVersion** da mensagem de solicitação original.</span><span class="sxs-lookup"><span data-stu-id="a34af-176">Get the **MessageVersion** of the original request message.</span></span>  
  
-   <span data-ttu-id="a34af-177">Obter o leitor de corpo da mensagem de resposta recebida.</span><span class="sxs-lookup"><span data-stu-id="a34af-177">Get the body reader for the received response message.</span></span>  
  
-   <span data-ttu-id="a34af-178">Crie uma nova mensagem de resposta com a mesma ação, o leitor de corpo e o **MessageVersion** da mensagem de solicitação original.</span><span class="sxs-lookup"><span data-stu-id="a34af-178">Create a new response message with the same action, body reader, and the **MessageVersion** of the original request message.</span></span>  
  
-   <span data-ttu-id="a34af-179">Se <xref:System.ServiceModel.Channels.MessageVersion.Addressing%2A> ! = **Addressing.None**, copie o para, de FaultTo e os cabeçalhos RelatesTo para a nova mensagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-179">If <xref:System.ServiceModel.Channels.MessageVersion.Addressing%2A> != **Addressing.None**, copy the To, From, FaultTo, and RelatesTo headers to the new message.</span></span>  
  
-   <span data-ttu-id="a34af-180">Copie as propriedades de mensagem para a nova mensagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-180">Copy the message properties to the new message.</span></span>  
  
-   <span data-ttu-id="a34af-181">Retorna a nova mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="a34af-181">Return the new response message.</span></span>  
  
 <span data-ttu-id="a34af-182">Por padrão, o **SoapProcessingBehavior** é adicionado automaticamente para os pontos de extremidade do cliente pelo <xref:System.ServiceModel.Routing.RoutingBehavior> quando o serviço é iniciado; no entanto, você pode controlar se o processamento SOAP é adicionado a todos os pontos de extremidade do cliente usando o <xref:System.ServiceModel.Routing.RoutingConfiguration.SoapProcessingEnabled%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="a34af-182">By default, the **SoapProcessingBehavior** is automatically added to the client endpoints by the <xref:System.ServiceModel.Routing.RoutingBehavior> when the service starts; however, you can control whether SOAP processing is added to all client endpoints by using the <xref:System.ServiceModel.Routing.RoutingConfiguration.SoapProcessingEnabled%2A> property.</span></span> <span data-ttu-id="a34af-183">Você também pode adicionar o comportamento diretamente para um ponto de extremidade específico e habilitar ou desabilitar esse comportamento no nível do ponto de extremidade, se um controle mais granular do processamento SOAP é necessário.</span><span class="sxs-lookup"><span data-stu-id="a34af-183">You can also add the behavior directly to a specific endpoint and enable or disable this behavior at the endpoint level if a more granular control of SOAP processing is required.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a34af-184">Se o processamento SOAP está desabilitado para um ponto de extremidade requer uma MessageVersion diferente da mensagem de solicitação original, você deve fornecer um mecanismo personalizado para executar modificações de SOAP que são necessárias antes de enviar a mensagem para o ponto de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="a34af-184">If SOAP processing is disabled for an endpoint that requires a different MessageVersion than that of the original request message, you must provide a custom mechanism for performing any SOAP modifications that are required before sending the message to the destination endpoint.</span></span>  
  
 <span data-ttu-id="a34af-185">Nos exemplos a seguir, o **soapProcessingEnabled** propriedade é usada para impedir que o **SoapProcessingBehavior** sejam adicionados automaticamente a todos os pontos de extremidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="a34af-185">In the following examples, the **soapProcessingEnabled** property is used to prevent the **SoapProcessingBehavior** from being automatically added to all client endpoints.</span></span>  
  
```xml  
<behaviors>  
  <!--default routing service behavior definition-->  
  <serviceBehaviors>  
    <behavior name="routingConfiguration">  
      <routing filterTableName="filterTable1" soapProcessingEnabled="false"/>  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
```  
  
```csharp  
//create the default RoutingConfiguration  
RoutingConfiguration rc = new RoutingConfiguration();  
rc.SoapProcessingEnabled = false;  
```  
  
### <a name="dynamic-configuration"></a><span data-ttu-id="a34af-186">Configuração dinâmica</span><span class="sxs-lookup"><span data-stu-id="a34af-186">Dynamic Configuration</span></span>  
 <span data-ttu-id="a34af-187">Quando você adicionar pontos de extremidade de cliente adicionais ou precisa modificar os filtros que são usadas para rotear mensagens, você deve ter uma maneira de atualizar a configuração dinamicamente em tempo de execução para evitar interromper o serviço para os pontos de extremidade recebendo mensagens por meio de o serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="a34af-187">When you add additional client endpoints, or need to modify the filters that are used to route messages, you must have a way to update the configuration dynamically at run time to prevent interrupting the service to the endpoints currently receiving messages through the Routing Service.</span></span> <span data-ttu-id="a34af-188">Modificar um arquivo de configuração ou o código do aplicativo host nem sempre é suficiente, pois qualquer um dos métodos exige que o aplicativo, o que poderia levar a perda potencial de todas as mensagens atualmente em trânsito e o potencial para tempo de inatividade durante a reciclagem Aguardando o serviço seja reiniciado.</span><span class="sxs-lookup"><span data-stu-id="a34af-188">Modifying a configuration file or the code of the host application is not always sufficient, because either method requires recycling the application, which would lead to the potential loss of any messages currently in transit and the potential for downtime while waiting on the service to restart.</span></span>  
  
 <span data-ttu-id="a34af-189">Você pode modificar apenas o **RoutingConfiguration** programaticamente.</span><span class="sxs-lookup"><span data-stu-id="a34af-189">You can only modify the **RoutingConfiguration** programmatically.</span></span> <span data-ttu-id="a34af-190">Embora inicialmente, você pode configurar o serviço usando um arquivo de configuração, você só pode modificar a configuração de tempo de execução, criando um novo **RoutingConfigution** e passá-lo como um parâmetro para o <xref:System.ServiceModel.Routing.RoutingExtension.ApplyConfiguration%2A> método exposto pelo <xref:System.ServiceModel.Routing.RoutingExtension> extensão de serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-190">While you can initially configure the service by using a configuration file, you can only modify the configuration at run time by constructing a new **RoutingConfigution** and passing it as a parameter to the <xref:System.ServiceModel.Routing.RoutingExtension.ApplyConfiguration%2A> method exposed by the <xref:System.ServiceModel.Routing.RoutingExtension> service extension.</span></span> <span data-ttu-id="a34af-191">Todas as mensagens em trânsito no momento continuam a ser roteado usando a configuração anterior, enquanto as mensagens recebidas após a chamada para **ApplyConfiguration** usar a nova configuração.</span><span class="sxs-lookup"><span data-stu-id="a34af-191">Any messages currently in transit continue to be routed using the previous configuration, while messages received after the call to **ApplyConfiguration** use the new configuration.</span></span> <span data-ttu-id="a34af-192">O exemplo a seguir demonstra como criar uma instância do serviço Roteamento e, em seguida, posteriormente, modificando a configuração.</span><span class="sxs-lookup"><span data-stu-id="a34af-192">The following example demonstrates creating an instance of the Routing Service and then subsequently modifying the configuration.</span></span>  
  
```csharp  
RoutingConfiguration routingConfig = new RoutingConfiguration();  
routingConfig.RouteOnHeadersOnly = true;  
routingConfig.FilterTable.Add(new MatchAllMessageFilter(), endpointList);  
RoutingBehavior routing = new RoutingBehavior(routingConfig);  
routerHost.Description.Behaviors.Add(routing);  
routerHost.Open();  
// Construct a new RoutingConfiguration  
RoutingConfiguration rc2 = new RoutingConfiguration();  
ServiceEndpoint clientEndpoint = new ServiceEndpoint();  
ServiceEndpoint clientEndpoint2 = new ServiceEndpoint();  
// Add filters to the FilterTable in the new configuration  
rc2.FilterTable.add(new MatchAllMessageFilter(),  
       new List<ServiceEndpoint>() { clientEndpoint });  
rc2.FilterTable.add(new MatchAllMessageFilter(),  
       new List<ServiceEndpoint>() { clientEndpoint2 });  
rc2.RouteOnHeadersOnly = false;  
// Apply the new configuration to the Routing Service hosted in  
routerHost.routerHost.Extensions.Find<RoutingExtension>().ApplyConfiguration(rc2);  
```  
  
> [!NOTE]
>  <span data-ttu-id="a34af-193">Ao atualizar o serviço de roteamento dessa maneira só é possível passar uma nova configuração.</span><span class="sxs-lookup"><span data-stu-id="a34af-193">When updating the Routing Service in this manner it is only possible to pass a new configuration.</span></span> <span data-ttu-id="a34af-194">Não é possível modificar apenas selecionar elementos da configuração atual ou acrescentar novas entradas para a configuração atual. Você deve criar e passar uma nova configuração que substituirá o existente.</span><span class="sxs-lookup"><span data-stu-id="a34af-194">It is not possible to modify only select elements of the current configuration or append new entries to the current configuration; you must create and pass a new configuration that replaces the existing one.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a34af-195">Todas as sessões abertas usando a configuração anterior continuam usando a configuração anterior.</span><span class="sxs-lookup"><span data-stu-id="a34af-195">Any sessions opened using the previous configuration continue using the previous configuration.</span></span> <span data-ttu-id="a34af-196">A nova configuração só é usada por novas sessões.</span><span class="sxs-lookup"><span data-stu-id="a34af-196">The new configuration is only used by new sessions.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="a34af-197">Tratamento de erros</span><span class="sxs-lookup"><span data-stu-id="a34af-197">Error Handling</span></span>  
 <span data-ttu-id="a34af-198">Se houver <xref:System.ServiceModel.CommunicationException> é encontrado ao tentar enviar uma mensagem, é feita de tratamento de erros.</span><span class="sxs-lookup"><span data-stu-id="a34af-198">If any <xref:System.ServiceModel.CommunicationException> is encountered while attempting to send a message, error handling take place.</span></span> <span data-ttu-id="a34af-199">Normalmente, essas exceções indicam que um problema foi encontrado ao tentar se comunicar com o ponto de extremidade do cliente definido como um <xref:System.ServiceModel.EndpointNotFoundException>, <xref:System.ServiceModel.ServerTooBusyException>, ou <xref:System.ServiceModel.CommunicationObjectFaultedException>.</span><span class="sxs-lookup"><span data-stu-id="a34af-199">These exceptions typically indicate that a problem was encountered while attempting to communicate with the defined client endpoint, such as an <xref:System.ServiceModel.EndpointNotFoundException>, <xref:System.ServiceModel.ServerTooBusyException>, or <xref:System.ServiceModel.CommunicationObjectFaultedException>.</span></span> <span data-ttu-id="a34af-200">O código de tratamento de erro também irá capturar e tentar novamente enviar quando uma <xref:System.TimeoutException> ocorrer, que é outra exceção comuns que não é derivada de **CommunicationException**.</span><span class="sxs-lookup"><span data-stu-id="a34af-200">The error handling-code will also catch and attempt to retry sending when a <xref:System.TimeoutException> occurs, which is another common exception that is not derived from **CommunicationException**.</span></span>  
  
 <span data-ttu-id="a34af-201">Quando uma das exceções anteriores ocorre, o serviço de roteamento de failover para uma lista de pontos de extremidade de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-201">When one of the preceding exceptions occurs, the Routing Service fails over to a list of backup endpoints.</span></span> <span data-ttu-id="a34af-202">Se todos os pontos de extremidade de backup falharem com uma falha de comunicação, ou se um ponto de extremidade retornará uma exceção que indica uma falha no serviço de destino, o serviço de roteamento retornará uma falha para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="a34af-202">If all backup endpoints fail with a communications failure, or if an endpoint returns an exception that indicates a failure within the destination service, the Routing Service returns a fault to the client application.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a34af-203">A funcionalidade de tratamento de erros captura e manipula as exceções que ocorrem ao tentar enviar uma mensagem e ao tentar fechar um canal.</span><span class="sxs-lookup"><span data-stu-id="a34af-203">The error-handling functionality captures and handles exceptions that occur when attempting to send a message and when attempting to close a channel.</span></span> <span data-ttu-id="a34af-204">O código de tratamento de erros não se destina a detectar ou lidar com exceções criadas pelos pontos de extremidade de aplicativo está se comunicando com; uma <xref:System.ServiceModel.FaultException> gerada por um serviço é exibido no serviço de roteamento como um **FaultMessage** e flui para o cliente.</span><span class="sxs-lookup"><span data-stu-id="a34af-204">The error-handling code is not intended to detect or handle exceptions created by the application endpoints it is communicating with; a <xref:System.ServiceModel.FaultException> thrown by a service appears at the Routing Service as a **FaultMessage** and is flowed back to the client.</span></span>  
>   
>  <span data-ttu-id="a34af-205">Se ocorrer um erro quando o serviço de roteamento tenta retransmitir uma mensagem, você poderá receber um <xref:System.ServiceModel.FaultException> no lado do cliente, em vez de um <xref:System.ServiceModel.EndpointNotFoundException> normalmente obtidas na ausência do serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="a34af-205">If an error occurs when the routing service tries to relay a message, you may  get a <xref:System.ServiceModel.FaultException> on the client side, rather than a <xref:System.ServiceModel.EndpointNotFoundException> you would normally get in the absence of the routing service.</span></span> <span data-ttu-id="a34af-206">Um serviço de roteamento pode mascarar, portanto, exceções e não fornecer transparência total, a menos que você examinar as exceções aninhadas.</span><span class="sxs-lookup"><span data-stu-id="a34af-206">A routing service may thus mask exceptions and not provide full transparency unless you examine nested exceptions.</span></span>  
  
### <a name="tracing-exceptions"></a><span data-ttu-id="a34af-207">Exceções de rastreamento</span><span class="sxs-lookup"><span data-stu-id="a34af-207">Tracing Exceptions</span></span>  
 <span data-ttu-id="a34af-208">Ao enviar uma mensagem para um ponto de extremidade em uma lista falhar, o serviço de roteamento rastreia os dados de exceção resultante e anexa os detalhes da exceção como uma propriedade de mensagem chamada **exceções**.</span><span class="sxs-lookup"><span data-stu-id="a34af-208">When sending a message to an endpoint in a list fails, the Routing Service traces the resulting exception data and attaches the exception details as a message property named **Exceptions**.</span></span> <span data-ttu-id="a34af-209">Isso preserva os dados de exceção e permite acesso programático a um usuário por meio de um Inspetor de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a34af-209">This preserves the exception data and allows a user programmatic access through a message inspector.</span></span>  <span data-ttu-id="a34af-210">Os dados de exceção são armazenados por mensagem em um dicionário que mapeia o nome do ponto de extremidade para os detalhes da exceção encontrados ao tentar enviar uma mensagem a ele.</span><span class="sxs-lookup"><span data-stu-id="a34af-210">The exception data is stored per message in a dictionary that maps the endpoint name to the exception details encountered when trying to send a message to it.</span></span>  
  
### <a name="backup-endpoints"></a><span data-ttu-id="a34af-211">Pontos de extremidade de backup</span><span class="sxs-lookup"><span data-stu-id="a34af-211">Backup Endpoints</span></span>  
 <span data-ttu-id="a34af-212">Cada entrada de filtro dentro da tabela de filtro pode opcionalmente especificar uma lista de pontos de extremidade de backup, que são usados em caso de falha de transmissão ao enviar para o ponto de extremidade primário.</span><span class="sxs-lookup"><span data-stu-id="a34af-212">Each filter entry within the filter table can optionally specify a list of backup endpoints, which are used in the event of a transmission failure when sending to the primary endpoint.</span></span> <span data-ttu-id="a34af-213">Se essa falha ocorrer, o serviço de roteamento tenta transmitir a mensagem para a primeira entrada na lista de ponto de extremidade de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-213">If such a failure occurs, the Routing Service attempts to transmit the message to the first entry in the backup endpoint list.</span></span> <span data-ttu-id="a34af-214">Se essa tentativa de envio também encontra uma falha de transmissão, o próximo ponto de extremidade da lista de backups é tentado.</span><span class="sxs-lookup"><span data-stu-id="a34af-214">If this send attempt also encounters a transmission failure, the next endpoint in the backup list is tried.</span></span> <span data-ttu-id="a34af-215">O serviço de roteamento continua enviando a mensagem para cada ponto de extremidade na lista até que a mensagem é recebida com êxito, todos os pontos de extremidade de retornam uma falha de transmissão ou uma falha de transmissão não é retornada por um ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a34af-215">The Routing Service continues sending the message to each endpoint in the list until the message is successfully received, all endpoints return a transmission failure, or a non-transmission failure is returned by an endpoint.</span></span>  
  
 <span data-ttu-id="a34af-216">Os exemplos a seguir configuram o serviço de roteamento de mensagens para usar uma lista de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-216">The following examples configure the Routing Service to use a backup list.</span></span>  
  
```xml  
<routing>  
  <filters>  
    <!-- Create a MatchAll filter that catches all messages -->  
    <filter name="MatchAllFilter1" filterType="MatchAll" />  
  </filters>  
  <filterTables>  
    <!-- Set up the Routing Service's Message Filter Table -->  
    <filterTable name="filterTable1">  
        <!-- Add an entry that maps the MatchAllMessageFilter to the dead destination -->  
        <!-- If that endpoint is down, tell the Routing Service to try the endpoints -->  
        <!-- Listed in the backupEndpointList -->  
        <add filterName="MatchAllFilter1" endpointName="deadDestination" backupList="backupEndpointList"/>  
    </filterTable>  
  </filterTables>  
  <!-- Create the backup endpoint list -->  
  <backupLists>  
    <!-- Add an endpoint list that contains the backup destinations -->  
    <backupList name="backupEndpointList">  
      <add endpointName="realDestination" />  
      <add endpointName="backupDestination" />  
    </backupList>  
  </backupLists>  
</routing>  
```  
  
```csharp  
//create the endpoint list that contains the service endpoints we want to route to  
List<ServiceEndpoint> backupList = new List<ServiceEndpoint>();  
//add the endpoints in the order that the Routing Service should contact them  
//first add the endpoint that we know is down  
//clearly, normally you wouldn't know that this endpoint was down by default  
backupList.Add(fakeDestination);  
//then add the real Destination endpoint  
//the Routing Service attempts to send to this endpoint only if it   
//encounters a TimeOutException or CommunicationException when sending  
//to the previous endpoint in the list.  
backupList.Add(realDestination);  
//add the backupDestination endpoint  
//the Routing Service attempts to send to this endpoint only if it  
//encounters a TimeOutException or CommunicationsException when sending  
//to the previous endpoints in the list  
backupList.Add(backupDestination);  
//create the default RoutingConfiguration option              
RoutingConfiguration rc = new RoutingConfiguration();  
//add a MatchAll filter to the Routing Configuration's filter table  
//map it to the list of endpoints defined above  
//when a message matches this filter, it is sent to the endpoints in the list in order  
//if an endpoint is down or does not respond (which the first endpoint won't  
//since the client does not exist), the Routing Service automatically moves the message  
//to the next endpoint in the list and try again.  
rc.FilterTable.Add(new MatchAllMessageFilter(), backupList);  
```  
  
### <a name="supported-error-patterns"></a><span data-ttu-id="a34af-217">Padrões de erro com suporte</span><span class="sxs-lookup"><span data-stu-id="a34af-217">Supported Error Patterns</span></span>  
 <span data-ttu-id="a34af-218">A tabela a seguir descreve os padrões que são compatíveis com o uso de listas de ponto de extremidade de backup, junto com anotações que descrevem os detalhes de tratamento de erros para padrões específicos.</span><span class="sxs-lookup"><span data-stu-id="a34af-218">The following table describes the patterns that are compatible with the use of backup endpoint lists, along with notes describing the details of error handling for specific patterns.</span></span>  
  
|<span data-ttu-id="a34af-219">Padrão</span><span class="sxs-lookup"><span data-stu-id="a34af-219">Pattern</span></span>|<span data-ttu-id="a34af-220">Session</span><span class="sxs-lookup"><span data-stu-id="a34af-220">Session</span></span>|<span data-ttu-id="a34af-221">Transação</span><span class="sxs-lookup"><span data-stu-id="a34af-221">Transaction</span></span>|<span data-ttu-id="a34af-222">Contexto de recebimento</span><span class="sxs-lookup"><span data-stu-id="a34af-222">Receive Context</span></span>|<span data-ttu-id="a34af-223">Lista de backup com suporte</span><span class="sxs-lookup"><span data-stu-id="a34af-223">Backup List Supported</span></span>|<span data-ttu-id="a34af-224">Observações</span><span class="sxs-lookup"><span data-stu-id="a34af-224">Notes</span></span>|  
|-------------|-------------|-----------------|---------------------|---------------------------|-----------|  
|<span data-ttu-id="a34af-225">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-225">One-Way</span></span>||||<span data-ttu-id="a34af-226">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-226">Yes</span></span>|<span data-ttu-id="a34af-227">Tenta enviar a mensagem em um ponto de extremidade de backup novamente.</span><span class="sxs-lookup"><span data-stu-id="a34af-227">Attempts to resend the message on a backup endpoint.</span></span> <span data-ttu-id="a34af-228">Se esta mensagem está sendo multicast, somente a mensagem no canal com falha é movida para o seu destino de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-228">If this message is being multicast, only the message on the failed channel is moved to its backup destination.</span></span>|  
|<span data-ttu-id="a34af-229">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-229">One-Way</span></span>||<span data-ttu-id="a34af-230">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-230">✓</span></span>||<span data-ttu-id="a34af-231">Não</span><span class="sxs-lookup"><span data-stu-id="a34af-231">No</span></span>|<span data-ttu-id="a34af-232">Uma exceção é lançada e a transação será revertida.</span><span class="sxs-lookup"><span data-stu-id="a34af-232">An exception is thrown and the transaction is rolled back.</span></span>|  
|<span data-ttu-id="a34af-233">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-233">One-Way</span></span>|||<span data-ttu-id="a34af-234">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-234">✓</span></span>|<span data-ttu-id="a34af-235">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-235">Yes</span></span>|<span data-ttu-id="a34af-236">Tenta enviar a mensagem em um ponto de extremidade de backup novamente.</span><span class="sxs-lookup"><span data-stu-id="a34af-236">Attempts to resend the message on a backup endpoint.</span></span> <span data-ttu-id="a34af-237">Depois que a mensagem é recebida com êxito e completa todos recebem contextos.</span><span class="sxs-lookup"><span data-stu-id="a34af-237">After the message is successfully received, complete all receive contexts.</span></span> <span data-ttu-id="a34af-238">Se a mensagem não for recebida com êxito por qualquer ponto de extremidade, não conclua o contexto de recebimento.</span><span class="sxs-lookup"><span data-stu-id="a34af-238">If the message is not successfully received by any endpoint, do not complete the receive context.</span></span><br /><br /> <span data-ttu-id="a34af-239">Quando essa mensagem está sendo multicast, o contexto de recebimento é preenchido somente se a mensagem é recebida com êxito pelo menos um ponto de extremidade (primário ou backup).</span><span class="sxs-lookup"><span data-stu-id="a34af-239">When this message is being multicast, the receive context is only completed if the message is successfully received by at least one endpoint (primary or backup).</span></span> <span data-ttu-id="a34af-240">Se nenhum dos pontos de extremidade em qualquer um dos caminhos de multicast com êxito a mensagem, não conclua o contexto de recebimento.</span><span class="sxs-lookup"><span data-stu-id="a34af-240">If none of the endpoints in any of the multicast paths successfully receive the message, do not complete the receive context.</span></span>|  
|<span data-ttu-id="a34af-241">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-241">One-Way</span></span>||<span data-ttu-id="a34af-242">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-242">✓</span></span>|<span data-ttu-id="a34af-243">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-243">✓</span></span>|<span data-ttu-id="a34af-244">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-244">Yes</span></span>|<span data-ttu-id="a34af-245">Anular a transação anterior, crie uma nova transação e reenviar todas as mensagens.</span><span class="sxs-lookup"><span data-stu-id="a34af-245">Abort the previous transaction, create a new transaction, and resend all messages.</span></span> <span data-ttu-id="a34af-246">Mensagens de erro são transmitidas para um destino de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-246">Messages that encountered an error are transmitted to a backup destination.</span></span><br /><br /> <span data-ttu-id="a34af-247">Após uma transação ter sido criada no qual todas as transmissões de êxito, conclua os contextos de recebimento em confirmar a transação.</span><span class="sxs-lookup"><span data-stu-id="a34af-247">After a transaction has been created in which all transmissions succeed, complete the receive contexts and commit the transaction.</span></span>|  
|<span data-ttu-id="a34af-248">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-248">One-Way</span></span>|<span data-ttu-id="a34af-249">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-249">✓</span></span>|||<span data-ttu-id="a34af-250">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-250">Yes</span></span>|<span data-ttu-id="a34af-251">Tenta enviar a mensagem em um ponto de extremidade de backup novamente.</span><span class="sxs-lookup"><span data-stu-id="a34af-251">Attempts to resend the message on a backup endpoint.</span></span> <span data-ttu-id="a34af-252">Em um cenário de multicast somente as mensagens em uma sessão que encontrou um erro ou em uma sessão fechar cuja sessão falhado são reenviadas para destinos de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-252">In a multicast scenario only the messages in a session that encountered an error or in a session whose session close failed are resent to backup destinations.</span></span>|  
|<span data-ttu-id="a34af-253">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-253">One-Way</span></span>|<span data-ttu-id="a34af-254">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-254">✓</span></span>|<span data-ttu-id="a34af-255">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-255">✓</span></span>||<span data-ttu-id="a34af-256">Não</span><span class="sxs-lookup"><span data-stu-id="a34af-256">No</span></span>|<span data-ttu-id="a34af-257">Uma exceção é lançada e a transação será revertida.</span><span class="sxs-lookup"><span data-stu-id="a34af-257">An exception is thrown and the transaction is rolled back.</span></span>|  
|<span data-ttu-id="a34af-258">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-258">One-Way</span></span>|<span data-ttu-id="a34af-259">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-259">✓</span></span>||<span data-ttu-id="a34af-260">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-260">✓</span></span>|<span data-ttu-id="a34af-261">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-261">Yes</span></span>|<span data-ttu-id="a34af-262">Tenta enviar a mensagem em um ponto de extremidade de backup novamente.</span><span class="sxs-lookup"><span data-stu-id="a34af-262">Attempts to resend the message on a backup endpoint.</span></span> <span data-ttu-id="a34af-263">Depois que todos os envios concluída sem erros de mensagem, a sessão não indica mais nenhuma mensagem e o serviço de roteamento é fechada com êxito todos os canais de sessão de saída, receberiam por todos os contextos são concluídos, e o canal de sessão de entrada é fechado.</span><span class="sxs-lookup"><span data-stu-id="a34af-263">After all message sends complete without error, the session indicates no more messages and the Routing Service successfully closes all outbound session channel(s), all receive contexts are completed, and the inbound session channel is closed.</span></span>|  
|<span data-ttu-id="a34af-264">Unidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-264">One-Way</span></span>|<span data-ttu-id="a34af-265">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-265">✓</span></span>|<span data-ttu-id="a34af-266">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-266">✓</span></span>|<span data-ttu-id="a34af-267">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-267">✓</span></span>|<span data-ttu-id="a34af-268">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-268">Yes</span></span>|<span data-ttu-id="a34af-269">Anular a transação atual e crie um novo.</span><span class="sxs-lookup"><span data-stu-id="a34af-269">Abort the current transaction and create a new one.</span></span> <span data-ttu-id="a34af-270">Reenvie todas as mensagens anteriores na sessão.</span><span class="sxs-lookup"><span data-stu-id="a34af-270">Resend all previous messages in the session.</span></span> <span data-ttu-id="a34af-271">Depois de uma transação foi criada no qual todas as mensagens têm foi enviadas com êxito e a sessão indica que não há mais mensagens, todos os canais de sessão de saída são fechados, recebem contextos são concluídos com a transação, é o canal de sessão de entrada fechado, e a transação é confirmada.</span><span class="sxs-lookup"><span data-stu-id="a34af-271">After a transaction has been created in which all messages have been successfully sent and the session indicates no more messages, all the outbound session channels are closed, receive contexts are all completed with the transaction, the inbound session channel is closed, and the transaction is committed.</span></span><br /><br /> <span data-ttu-id="a34af-272">Quando as sessões estão sendo multicast as mensagens que não tiveram nenhum erro são reenviadas para o mesmo destino como antes e as mensagens que encontrou um erro é enviada para destinos de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-272">When the sessions are being multicast the messages that had no error are resent to the same destination as before, and messages that encountered an error are sent to backup destinations.</span></span>|  
|<span data-ttu-id="a34af-273">Bidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-273">Two-Way</span></span>||||<span data-ttu-id="a34af-274">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-274">Yes</span></span>|<span data-ttu-id="a34af-275">Envie para um destino de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-275">Send to a backup destination.</span></span>  <span data-ttu-id="a34af-276">Depois que um canal de retorna uma mensagem de resposta, retorne a resposta ao cliente original.</span><span class="sxs-lookup"><span data-stu-id="a34af-276">After a channel returns a response message, return the response to the original client.</span></span>|  
|<span data-ttu-id="a34af-277">Bidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-277">Two-Way</span></span>|<span data-ttu-id="a34af-278">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-278">✓</span></span>|||<span data-ttu-id="a34af-279">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-279">Yes</span></span>|<span data-ttu-id="a34af-280">Envie todas as mensagens no canal para um destino de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-280">Send all messages on the channel to a backup destination.</span></span>  <span data-ttu-id="a34af-281">Depois que um canal de retorna uma mensagem de resposta, retorne a resposta ao cliente original.</span><span class="sxs-lookup"><span data-stu-id="a34af-281">After a channel returns a response message, return the response to the original client.</span></span>|  
|<span data-ttu-id="a34af-282">Bidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-282">Two-Way</span></span>||<span data-ttu-id="a34af-283">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-283">✓</span></span>||<span data-ttu-id="a34af-284">Não</span><span class="sxs-lookup"><span data-stu-id="a34af-284">No</span></span>|<span data-ttu-id="a34af-285">Uma exceção é lançada e a transação será revertida.</span><span class="sxs-lookup"><span data-stu-id="a34af-285">An exception is thrown and the transaction is rolled back.</span></span>|  
|<span data-ttu-id="a34af-286">Bidirecional</span><span class="sxs-lookup"><span data-stu-id="a34af-286">Two-Way</span></span>|<span data-ttu-id="a34af-287">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-287">✓</span></span>|<span data-ttu-id="a34af-288">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-288">✓</span></span>||<span data-ttu-id="a34af-289">Não</span><span class="sxs-lookup"><span data-stu-id="a34af-289">No</span></span>|<span data-ttu-id="a34af-290">Uma exceção é lançada e a transação será revertida.</span><span class="sxs-lookup"><span data-stu-id="a34af-290">An exception is thrown and the transaction is rolled back.</span></span>|  
|<span data-ttu-id="a34af-291">Duplex</span><span class="sxs-lookup"><span data-stu-id="a34af-291">Duplex</span></span>||||<span data-ttu-id="a34af-292">Não</span><span class="sxs-lookup"><span data-stu-id="a34af-292">No</span></span>|<span data-ttu-id="a34af-293">No momento, não há suporte para a comunicação dúplex de sessão não.</span><span class="sxs-lookup"><span data-stu-id="a34af-293">Non-session duplex communication is not currently supported.</span></span>|  
|<span data-ttu-id="a34af-294">Duplex</span><span class="sxs-lookup"><span data-stu-id="a34af-294">Duplex</span></span>|<span data-ttu-id="a34af-295">✓</span><span class="sxs-lookup"><span data-stu-id="a34af-295">✓</span></span>|||<span data-ttu-id="a34af-296">Sim</span><span class="sxs-lookup"><span data-stu-id="a34af-296">Yes</span></span>|<span data-ttu-id="a34af-297">Envie para um destino de backup.</span><span class="sxs-lookup"><span data-stu-id="a34af-297">Send to a backup destination.</span></span>|  
  
## <a name="hosting"></a><span data-ttu-id="a34af-298">Hospedagem</span><span class="sxs-lookup"><span data-stu-id="a34af-298">Hosting</span></span>  
 <span data-ttu-id="a34af-299">Como o serviço de roteamento é implementado como um serviço WCF, ele deve ser auto-hospedado dentro de um aplicativo ou hospedado pelo IIS ou WAS.</span><span class="sxs-lookup"><span data-stu-id="a34af-299">Because the Routing Service is implemented as a WCF service, it must be either self-hosted within an application or hosted by IIS or WAS.</span></span> <span data-ttu-id="a34af-300">É recomendável que o serviço de roteamento ser hospedado em IIS, WAS ou um aplicativo de serviço do Windows para aproveitar a inicialização automática e disponível nestes ambientes de hospedagem de recursos de gerenciamento de ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="a34af-300">It is recommended that the Routing Service be hosted in either IIS, WAS, or a Windows Service application to take advantage of the automatic start and life-cycle management features available in these hosting environments.</span></span>  
  
 <span data-ttu-id="a34af-301">O exemplo a seguir demonstra que hospeda o serviço de roteamento em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a34af-301">The following example demonstrates hosting the Routing Service in an application.</span></span>  
  
```csharp  
using (ServiceHost serviceHost =  
                new ServiceHost(typeof(RoutingService)))  
```  
  
 <span data-ttu-id="a34af-302">Para hospedar o serviço de roteamento de mensagens dentro do IIS ou WAS, você deve criar um arquivo de serviço (. svc) ou usar a ativação baseada em configuração do serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-302">To host the Routing Service within IIS or WAS, you must either create a service file (.svc) or use configuration-based activation of the service.</span></span> <span data-ttu-id="a34af-303">Ao usar um arquivo de serviço, você deve especificar o <xref:System.ServiceModel.Routing.RoutingService> usando o parâmetro de serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-303">When using a service file, you must specify the <xref:System.ServiceModel.Routing.RoutingService> using the Service parameter.</span></span> <span data-ttu-id="a34af-304">O exemplo a seguir contém um arquivo de serviço de exemplo que pode ser usado para hospedar o serviço de roteamento com o IIS ou WAS.</span><span class="sxs-lookup"><span data-stu-id="a34af-304">The following example contains a sample service file that can be used to host the Routing Service with IIS or WAS.</span></span>  
  
```  
<%@ ServiceHost Language="C#" Debug="true" Service="System.ServiceModel.Routing.RoutingService,   
     System.ServiceModel.Routing, version=4.0.0.0, Culture=neutral,   
     PublicKeyToken=31bf3856ad364e35" %>  
```  
  
## <a name="routing-service-and-impersonation"></a><span data-ttu-id="a34af-305">Representação e serviço de roteamento</span><span class="sxs-lookup"><span data-stu-id="a34af-305">Routing Service and Impersonation</span></span>  
 <span data-ttu-id="a34af-306">O serviço de roteamento de WCF pode ser usado com a representação para envio e recebimento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a34af-306">The WCF Routing Service can be used with impersonation for both sending and receiving messages.</span></span> <span data-ttu-id="a34af-307">Todas as restrições de Windows usual de representação se aplicam.</span><span class="sxs-lookup"><span data-stu-id="a34af-307">All of the usual Windows constraints of impersonation apply.</span></span> <span data-ttu-id="a34af-308">Se seria necessário configurar as permissões de serviço ou a conta para usar a representação ao escrever seu próprio serviço, você terá de fazer essas mesmas etapas para usar a representação com o serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="a34af-308">If you would have needed to set up service or account permissions to use impersonation when writing your own service, then you’ll have to do those same steps to use impersonation with the routing service.</span></span> <span data-ttu-id="a34af-309">Para obter mais informações, consulte [delegação e representação](delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="a34af-309">For more information, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="a34af-310">A representação com o serviço de roteamento requer o uso de personificação do ASP.NET no modo de compatibilidade do ASP.NET ou o uso de credenciais do Windows que foram configurados para permitir a representação.</span><span class="sxs-lookup"><span data-stu-id="a34af-310">Impersonation with the routing service requires either the use of ASP.NET impersonation while in ASP.NET compatibility mode or the use of Windows credentials that have been configured to allow impersonation.</span></span> <span data-ttu-id="a34af-311">Para obter mais informações sobre o modo de compatibilidade do ASP.NET, consulte [serviços WCF e ASP.NET](wcf-services-and-aspnet.md).</span><span class="sxs-lookup"><span data-stu-id="a34af-311">For more information about ASP.NET compatibility mode, see [WCF Services and ASP.NET](wcf-services-and-aspnet.md).</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="a34af-312">O serviço de roteamento do WCF não dá suporte à representação com a autenticação básica.</span><span class="sxs-lookup"><span data-stu-id="a34af-312">The WCF Routing Service does not support impersonation with basic authentication.</span></span>  
  
 <span data-ttu-id="a34af-313">Para usar a representação do ASP.NET com o serviço de roteamento, habilite o modo de compatibilidade do ASP.NET no serviço do ambiente de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="a34af-313">To use ASP.NET impersonation with the routing service, enable ASP.NET compatibility mode on the service hosting environment.</span></span> <span data-ttu-id="a34af-314">O serviço de roteamento já foi marcado como permitir a representação e modo de compatibilidade do ASP.NET serão habilitados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a34af-314">The routing service has already been marked as allowing ASP.NET compatibility mode and impersonation will automatically be enabled.</span></span> <span data-ttu-id="a34af-315">A representação é o único uso com suporte de integração do ASP.NET com o serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="a34af-315">Impersonation is the only supported use of ASP.NET integration with the routing service.</span></span>  
  
 <span data-ttu-id="a34af-316">Usar a representação de credencial do Windows com o serviço de roteamento que você precisa configurar as credenciais e o serviço.</span><span class="sxs-lookup"><span data-stu-id="a34af-316">To use Windows credential impersonation with the routing service you need to configure both the credentials and the service.</span></span> <span data-ttu-id="a34af-317">O objeto de credenciais do cliente (<xref:System.ServiceModel.Security.WindowsClientCredential>, está acessível do <xref:System.ServiceModel.ChannelFactory>) define um <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> propriedade que deve ser definida para permitir a representação.</span><span class="sxs-lookup"><span data-stu-id="a34af-317">The client credentials object (<xref:System.ServiceModel.Security.WindowsClientCredential>, accessable from the <xref:System.ServiceModel.ChannelFactory>) defines an <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property that must be set to permit impersonation.</span></span> <span data-ttu-id="a34af-318">Por fim, no serviço que você precisa configurar o <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> comportamento para definir `ImpersonateCallerForAllOperations` para `true`.</span><span class="sxs-lookup"><span data-stu-id="a34af-318">Finally, on the service you need to configure the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> behavior to set `ImpersonateCallerForAllOperations` to `true`.</span></span> <span data-ttu-id="a34af-319">O serviço de roteamento usa esse sinalizador para decidir se deseja criar os clientes para encaminhamento de mensagens com a representação habilitada.</span><span class="sxs-lookup"><span data-stu-id="a34af-319">The routing service uses this flag to decide whether to create the clients for forwarding messages with impersonation enabled.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a34af-320">Consulte também</span><span class="sxs-lookup"><span data-stu-id="a34af-320">See also</span></span>

- [<span data-ttu-id="a34af-321">Filtros de mensagem</span><span class="sxs-lookup"><span data-stu-id="a34af-321">Message Filters</span></span>](message-filters.md)
- [<span data-ttu-id="a34af-322">Contratos de roteamento</span><span class="sxs-lookup"><span data-stu-id="a34af-322">Routing Contracts</span></span>](routing-contracts.md)
- [<span data-ttu-id="a34af-323">Escolhendo um filtro</span><span class="sxs-lookup"><span data-stu-id="a34af-323">Choosing a Filter</span></span>](choosing-a-filter.md)
