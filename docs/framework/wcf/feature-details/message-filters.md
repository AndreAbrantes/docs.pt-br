---
title: Filtros de mensagem
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- routing [WCF], message filters
ms.assetid: cb33ba49-8b1f-4099-8acb-240404a46d9a
caps.latest.revision: 8
author: wadepickett
ms.author: wpickett
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: bd5019668e865d2fea835b450d992d45b5273ed7
ms.sourcegitcommit: b750a8e3979749b214e7e10c82efb0a0524dfcb1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/10/2018
---
# <a name="message-filters"></a><span data-ttu-id="5a3ba-102">Filtros de mensagem</span><span class="sxs-lookup"><span data-stu-id="5a3ba-102">Message Filters</span></span>
<span data-ttu-id="5a3ba-103">Para implementar roteamento baseado em conteúdo, o serviço de roteamento usa <xref:System.ServiceModel.Dispatcher.MessageFilter> implementações que inspecionam seções específicas de uma mensagem, como o endereço, nome do ponto de extremidade ou uma instrução XPath específica.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-103">To implement content-based routing, the Routing Service uses <xref:System.ServiceModel.Dispatcher.MessageFilter> implementations that inspect specific sections of a message, such as the address, endpoint name, or a specific XPath statement.</span></span> <span data-ttu-id="5a3ba-104">Se nenhum dos filtros de mensagem fornecido com [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] atender às suas necessidades, você pode criar um filtro personalizado, criando uma nova implementação de base de <xref:System.ServiceModel.Dispatcher.MessageFilter> classe.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-104">If none of the message filters provided with [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] meet your needs, you can create a custom filter by creating a new implementation of the base <xref:System.ServiceModel.Dispatcher.MessageFilter> class.</span></span>  
  
 <span data-ttu-id="5a3ba-105">Ao configurar o serviço de roteamento, você deve definir os elementos de filtro (<xref:System.ServiceModel.Routing.Configuration.FilterElement> objetos) que descrevem o tipo de **MessageFilter** e quaisquer dados de suporte necessários para criar o filtro, como valores de cadeia de caracteres específica para pesquisa para dentro da mensagem.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-105">When configuring the Routing Service, you must define filter elements (<xref:System.ServiceModel.Routing.Configuration.FilterElement> objects) that describe the type of **MessageFilter** and any supporting data required to create the filter, such as specific string values to search for within the message.</span></span> <span data-ttu-id="5a3ba-106">Observe que apenas criar os elementos de filtro define os filtros de mensagens individuais; Para usar os filtros para avaliar e rotear mensagens, você também deve definir uma tabela de filtro (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span><span class="sxs-lookup"><span data-stu-id="5a3ba-106">Note that creating the filter elements only defines the individual message filters; to use the filters to evaluate and route messages you must also define a filter table (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span></span>  
  
 <span data-ttu-id="5a3ba-107">Cada entrada na tabela de filtro faz referência a um elemento de filtro e especifica o ponto de extremidade do cliente que uma mensagem será roteada para se a mensagem corresponde ao filtro.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-107">Each entry in the filter table references a filter element and specifies the client endpoint that a message will be routed to if the message matches the filter.</span></span> <span data-ttu-id="5a3ba-108">As entradas da tabela de filtro também permitem que você especifique uma coleção de pontos de extremidade de backup (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>), que define uma lista de pontos de extremidade que a mensagem será transmitida para em caso de falha de transmissão ao enviar para o ponto de extremidade primário.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-108">The filter table entries also allow you to specify a collection of backup endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>), which defines a list of endpoints that the message will be transmitted to in the event of a transmission failure when sending to the primary endpoint.</span></span> <span data-ttu-id="5a3ba-109">Esses pontos de extremidade serão tentados na ordem especificada até obter êxito.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-109">These endpoints will be tried in the order specified until one succeeds.</span></span>  
  
## <a name="message-filters"></a><span data-ttu-id="5a3ba-110">Filtros de mensagem</span><span class="sxs-lookup"><span data-stu-id="5a3ba-110">Message Filters</span></span>  
 <span data-ttu-id="5a3ba-111">Os filtros de mensagem usados pelo serviço de roteamento fornecem a funcionalidade comum de seleção de mensagem, como avaliar o nome de uma mensagem foi enviada para a ação de SOAP, ou o endereço ou prefixo de endereço que a mensagem foi enviada para o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-111">The message filters used by the Routing Service provide common message selection functionality, such as evaluating the name of the endpoint that a message was sent to, the SOAP action, or the address or address prefix that the message was sent to.</span></span> <span data-ttu-id="5a3ba-112">Filtros também podem ser Unidos com um `AND` condição, para que as mensagens só serão roteadas para um ponto de extremidade se a mensagem corresponde a ambos os filtros.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-112">Filters can also be joined with an `AND` condition, so that messages will only be routed to an endpoint if the message matches both filters.</span></span> <span data-ttu-id="5a3ba-113">Você também pode criar filtros personalizados ao criar sua própria implementação de <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-113">You can also create custom filters by creating your own implementation of <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span></span>  
  
 <span data-ttu-id="5a3ba-114">A seguinte tabela lista o <xref:System.ServiceModel.Routing.Configuration.FilterType> usada pelo serviço de roteamento, a classe que implementa o filtro de mensagem específica e obrigatório <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> parâmetros.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-114">The following table lists the <xref:System.ServiceModel.Routing.Configuration.FilterType> used by the Routing Service, the class that implements the specific message filter, and the required <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> parameters.</span></span>  
  
|<span data-ttu-id="5a3ba-115">Tipo de filtro</span><span class="sxs-lookup"><span data-stu-id="5a3ba-115">Filter  Type</span></span>|<span data-ttu-id="5a3ba-116">Descrição</span><span class="sxs-lookup"><span data-stu-id="5a3ba-116">Description</span></span>|<span data-ttu-id="5a3ba-117">Filtrar dados</span><span class="sxs-lookup"><span data-stu-id="5a3ba-117">Filter Data Meaning</span></span>|<span data-ttu-id="5a3ba-118">Filtro de exemplo</span><span class="sxs-lookup"><span data-stu-id="5a3ba-118">Example Filter</span></span>|  
|------------------|-----------------|-------------------------|--------------------|  
|<span data-ttu-id="5a3ba-119">Ação</span><span class="sxs-lookup"><span data-stu-id="5a3ba-119">Action</span></span>|<span data-ttu-id="5a3ba-120">Usa o <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> classe para corresponder as mensagens que contém uma ação específica.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-120">Uses the <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> class to match messages containing a specific action.</span></span>|<span data-ttu-id="5a3ba-121">A ação de filtro após.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-121">The action to filter upon.</span></span>|<span data-ttu-id="5a3ba-122">\<filter name="action1" filterType="Action" filterData="http://namespace/contract/operation" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-122">\<filter name="action1" filterType="Action" filterData="http://namespace/contract/operation" /></span></span>|  
|<span data-ttu-id="5a3ba-123">EndpointAddress</span><span class="sxs-lookup"><span data-stu-id="5a3ba-123">EndpointAddress</span></span>|<span data-ttu-id="5a3ba-124">Usa o <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> classe com <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` para corresponder as mensagens que contém um endereço específico.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-124">Uses the <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address.</span></span>|<span data-ttu-id="5a3ba-125">O endereço para filtrar após (no cabeçalho para).</span><span class="sxs-lookup"><span data-stu-id="5a3ba-125">The address to filter upon (in the To header).</span></span>|<span data-ttu-id="5a3ba-126">\<filter name="address1" filterType="EndpointAddress" filterData="http://host/vdir/s.svc/b"  /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-126">\<filter name="address1" filterType="EndpointAddress" filterData="http://host/vdir/s.svc/b"  /></span></span>|  
|<span data-ttu-id="5a3ba-127">EndpointAddressPrefix</span><span class="sxs-lookup"><span data-stu-id="5a3ba-127">EndpointAddressPrefix</span></span>|<span data-ttu-id="5a3ba-128">Usa o <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> classe com <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` para corresponder as mensagens que contêm um prefixo de endereço específico.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-128">Uses the <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address prefix.</span></span>|<span data-ttu-id="5a3ba-129">O endereço para filtrar usando a correspondência de prefixo mais longo.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-129">The address to filter upon using longest prefix matching.</span></span>|<span data-ttu-id="5a3ba-130">\<filter name="prefix1" filterType="EndpointAddressPrefix" filterData="http://host/" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-130">\<filter name="prefix1" filterType="EndpointAddressPrefix" filterData="http://host/" /></span></span>|  
|<span data-ttu-id="5a3ba-131">And</span><span class="sxs-lookup"><span data-stu-id="5a3ba-131">And</span></span>|<span data-ttu-id="5a3ba-132">Usa o <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> classe que sempre é avaliada duas condições antes de retornar.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-132">Uses the <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> class that always evaluates both conditions before returning.</span></span>|<span data-ttu-id="5a3ba-133">filterData não é usado; em vez disso, filter1 e filter2 têm os nomes dos filtros de mensagem correspondente (também na tabela), que deve ser **AND**ed juntos.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-133">filterData is not used; instead filter1 and filter2 have the names of the corresponding message filters (also in the table), which should be **AND**ed together.</span></span>|<span data-ttu-id="5a3ba-134">\<filter name="and1" filterType="And" filter1="address1" filter2="action1" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-134">\<filter name="and1" filterType="And" filter1="address1" filter2="action1" /></span></span>|  
|<span data-ttu-id="5a3ba-135">Personalizado</span><span class="sxs-lookup"><span data-stu-id="5a3ba-135">Custom</span></span>|<span data-ttu-id="5a3ba-136">Um tipo definido pelo usuário que estende o <xref:System.ServiceModel.Dispatcher.MessageFilter> classe e tem um construtor que recebe uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-136">A user-defined type that extends the <xref:System.ServiceModel.Dispatcher.MessageFilter> class and has a constructor taking a string.</span></span>|<span data-ttu-id="5a3ba-137">O atributo customType é o nome de tipo totalmente qualificado da classe para criar; filterData é a cadeia de caracteres passados para o construtor ao criar o filtro.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-137">The customType attribute is the fully qualified type name of the class to create; filterData is the string to pass to the constructor when creating the filter.</span></span>|<span data-ttu-id="5a3ba-138">\<filter name="custom1" filterType="Custom" customType="CustomAssembly.CustomMsgFilter, CustomAssembly" filterData="Custom Data" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-138">\<filter name="custom1" filterType="Custom" customType="CustomAssembly.CustomMsgFilter, CustomAssembly" filterData="Custom Data" /></span></span>|  
|<span data-ttu-id="5a3ba-139">EndpointName</span><span class="sxs-lookup"><span data-stu-id="5a3ba-139">EndpointName</span></span>|<span data-ttu-id="5a3ba-140">Usa o <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> classe para corresponder as mensagens com base no nome do ponto de extremidade de serviço que eles chegaram no.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-140">Uses the <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> class to match messages based on the name of the service endpoint they arrived on.</span></span>|<span data-ttu-id="5a3ba-141">O nome do ponto de extremidade de serviço, por exemplo: "serviceEndpoint1".</span><span class="sxs-lookup"><span data-stu-id="5a3ba-141">The name of the service endpoint, for example: "serviceEndpoint1".</span></span>  <span data-ttu-id="5a3ba-142">Isso deve ser um dos pontos de extremidade expostos no serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-142">This should be one of the endpoints exposed on the Routing Service.</span></span>|<span data-ttu-id="5a3ba-143">\<filter name="stock1" filterType="Endpoint" filterData="SvcEndpoint" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-143">\<filter name="stock1" filterType="Endpoint" filterData="SvcEndpoint" /></span></span>|  
|<span data-ttu-id="5a3ba-144">MatchAll</span><span class="sxs-lookup"><span data-stu-id="5a3ba-144">MatchAll</span></span>|<span data-ttu-id="5a3ba-145">Usa o <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter> classe.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-145">Uses the <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter> class.</span></span> <span data-ttu-id="5a3ba-146">Esse filtro corresponde a todas as mensagens que chegam.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-146">This filter matches all arriving messages.</span></span>|<span data-ttu-id="5a3ba-147">filterData não é usado.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-147">filterData is not used.</span></span> <span data-ttu-id="5a3ba-148">Esse filtro sempre coincidirão com todas as mensagens.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-148">This filter will always match all messages.</span></span>|<span data-ttu-id="5a3ba-149">\<filter name="matchAll1" filterType="MatchAll" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-149">\<filter name="matchAll1" filterType="MatchAll" /></span></span>|  
|<span data-ttu-id="5a3ba-150">XPath</span><span class="sxs-lookup"><span data-stu-id="5a3ba-150">XPath</span></span>|<span data-ttu-id="5a3ba-151">Usa o <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> classe para corresponder consultas XPath específicas dentro da mensagem.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-151">Uses the <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> class to match specific XPath queries within the message.</span></span>|<span data-ttu-id="5a3ba-152">A consulta XPath a ser usado durante a correspondência de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-152">The XPath query to use when matching messages.</span></span>|<span data-ttu-id="5a3ba-153">\<filter name="XPath1" filterType="XPath" filterData="//ns:element" /></span><span class="sxs-lookup"><span data-stu-id="5a3ba-153">\<filter name="XPath1" filterType="XPath" filterData="//ns:element" /></span></span>|  
  
 <span data-ttu-id="5a3ba-154">O exemplo a seguir define as entradas de filtro que usam os filtros de mensagem do XPath, EndpointName e PrefixEndpointAddress.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-154">The following example defines filter entries that use the XPath, EndpointName, and PrefixEndpointAddress message filters.</span></span> <span data-ttu-id="5a3ba-155">Este exemplo também demonstra como usar um filtro personalizado para as entradas RoundRobinFilter1 e RoundRobinFilter2.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-155">This example also demonstrates using a custom filter for the RoundRobinFilter1 and RoundRobinFilter2 entries.</span></span>  
  
```xml  
<filters>  
     <filter name="XPathFilter" filterType="XPath"   
             filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
     <filter name="EndpointNameFilter" filterType="EndpointName"   
             filterData="calculatorEndpoint"/>  
     <filter name="PrefixAddressFilter" filterType="PrefixEndpointAddress"   
             filterData="http://localhost/routingservice/router/rounding/"/>  
     <filter name="RoundRobinFilter1" filterType="Custom"   
             customType="RoutingServiceFilters.RoundRobinMessageFilter,   
             RoutingService" filterData="group1"/>  
     <filter name="RoundRobinFilter2" filterType="Custom"   
             customType="RoutingServiceFilters.RoundRobinMessageFilter,   
             RoutingService" filterData="group1"/>  
</filters>  
```  
  
> [!NOTE]
>  <span data-ttu-id="5a3ba-156">Basta definir um filtro não faz com que as mensagens a ser avaliada com base no filtro.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-156">Simply defining a filter does not cause messages to be evaluated against the filter.</span></span> <span data-ttu-id="5a3ba-157">O filtro deve ser adicionado a uma tabela de filtro, que é associado com o ponto de extremidade do serviço exposto pelo serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-157">The filter must be added to a filter table, which is then associated with the service endpoint exposed by the Routing Service.</span></span>  
  
### <a name="namespace-table"></a><span data-ttu-id="5a3ba-158">Tabela de Namespace</span><span class="sxs-lookup"><span data-stu-id="5a3ba-158">Namespace Table</span></span>  
 <span data-ttu-id="5a3ba-159">Ao usar um filtro XPath, os dados de filtro que contém a consulta XPath podem se tornar muito grandes devido ao uso de namespaces.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-159">When using an XPath filter, the filter data that contains the XPath query can become extremely large due to the use of namespaces.</span></span> <span data-ttu-id="5a3ba-160">Para aliviar esse problema, o serviço de roteamento fornece a capacidade de definir seus próprio prefixos de namespace usando a tabela de namespace.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-160">To alleviate this problem the Routing Service provides the ability to define your own namespace prefixes by using the namespace table.</span></span>  
  
 <span data-ttu-id="5a3ba-161">A tabela de namespace é uma coleção de <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> objetos que define os prefixos de namespace para namespaces comuns que podem ser usados em um XPath.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-161">The namespace table is a collection of <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> objects that defines the namespace prefixes for common namespaces that can be used in an XPath.</span></span> <span data-ttu-id="5a3ba-162">A seguir estão os prefixos de espaços para nome e namespace do padrão que estão contidos na tabela de namespace.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-162">The following are the default namespaces and namespace prefixes that are contained in the namespace table.</span></span>  
  
|<span data-ttu-id="5a3ba-163">Prefixo</span><span class="sxs-lookup"><span data-stu-id="5a3ba-163">Prefix</span></span>|<span data-ttu-id="5a3ba-164">Namespace</span><span class="sxs-lookup"><span data-stu-id="5a3ba-164">Namespace</span></span>|  
|------------|---------------|  
|<span data-ttu-id="5a3ba-165">s11</span><span class="sxs-lookup"><span data-stu-id="5a3ba-165">s11</span></span>|http://schemas.xmlsoap.org/soap/envelope|  
|<span data-ttu-id="5a3ba-166">s12</span><span class="sxs-lookup"><span data-stu-id="5a3ba-166">s12</span></span>|http://www.w3.org/2003/05/soap-envelope|  
|<span data-ttu-id="5a3ba-167">wsaAugust2004</span><span class="sxs-lookup"><span data-stu-id="5a3ba-167">wsaAugust2004</span></span>|http://schemas.xmlsoap.org/ws/2004/08/addressing|  
|<span data-ttu-id="5a3ba-168">wsa10</span><span class="sxs-lookup"><span data-stu-id="5a3ba-168">wsa10</span></span>|http://www.w3.org/2005/08/addressing|  
|<span data-ttu-id="5a3ba-169">sm</span><span class="sxs-lookup"><span data-stu-id="5a3ba-169">sm</span></span>|http://schemas.microsoft.com/serviceModel/2004/05/xpathfunctions|  
|<span data-ttu-id="5a3ba-170">tempuri</span><span class="sxs-lookup"><span data-stu-id="5a3ba-170">tempuri</span></span>|http://tempuri.org|  
|<span data-ttu-id="5a3ba-171">ser</span><span class="sxs-lookup"><span data-stu-id="5a3ba-171">ser</span></span>|http://schemas.microsoft.com/2003/10/Serialization|  
  
 <span data-ttu-id="5a3ba-172">Quando você souber que você usar um namespace específico em suas consultas XPath, você pode adicioná-lo para a tabela de namespace junto com um prefixo de namespace exclusivo e use o prefixo em qualquer consulta XPath em vez do namespace completo.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-172">When you know that you will be using a specific namespace in your XPath queries, you can add it to the namespace table along with a unique namespace prefix and use the prefix in any XPath query instead of the full namespace.</span></span> <span data-ttu-id="5a3ba-173">O exemplo a seguir define um prefixo de "custom" para o namespace "http://my.custom.namespace", que é usado na consulta XPath contida em filterData.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-173">The following example defines a prefix of "custom" for the namespace "http://my.custom.namespace", which is then used in the XPath query contained in filterData.</span></span>  
  
```xml  
<namespaceTable>  
     <add prefix="custom" namespace="http://my.custom.namespace/"/>  
</namespaceTable>  
<filters>  
     <filter name="XPathFilter" filterType="XPath" filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
</filters>  
```  
  
## <a name="filter-tables"></a><span data-ttu-id="5a3ba-174">Filtrar tabelas</span><span class="sxs-lookup"><span data-stu-id="5a3ba-174">Filter Tables</span></span>  
 <span data-ttu-id="5a3ba-175">Embora cada elemento de filtro define uma comparação lógica que pode ser aplicada a uma mensagem, a tabela de filtro fornece a associação entre o elemento de filtro e o ponto de extremidade do cliente de destino.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-175">While each filter element defines a logical comparison that can be applied to a message, the filter table provides the association between the filter element and the destination client endpoint.</span></span> <span data-ttu-id="5a3ba-176">Uma tabela de filtro é uma coleção nomeada de <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> objetos que definem a associação entre um filtro, um ponto de extremidade de destino principal e uma lista de pontos de extremidade alternativa de backup.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-176">A filter table is a named collection of <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> objects that define the association between a filter, a primary destination endpoint, and a list of alternative backup endpoints.</span></span> <span data-ttu-id="5a3ba-177">As entradas da tabela de filtro também permitem que você especifique uma prioridade opcional para cada condição de filtro.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-177">The filter table entries also allow you to specify an optional priority for each filter condition.</span></span> <span data-ttu-id="5a3ba-178">O exemplo a seguir define dois filtros e, em seguida, define uma tabela de filtro que associa cada filtro um ponto de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-178">The following example defines two filters and then defines a filter table that associates each filter with a destination endpoint.</span></span>  
  
```xml  
<routing>  
     <filters>  
       <filter name="AddAction" filterType="Action" filterData="Add" />  
       <filter name="SubtractAction" filterType="Action" filterData="Subtract" />  
     </filters>  
     <filterTables>  
       <table name="routingTable1">  
         <filters>  
           <add filterName="AddAction" endpointName="Addition" />  
           <add filterName="SubtractAction" endpointName="Subtraction" />  
         </filters>  
       </table>  
     </filterTables>      
</routing>  
```  
  
### <a name="filter-evaluation-priority"></a><span data-ttu-id="5a3ba-179">Prioridade de avaliação de filtro</span><span class="sxs-lookup"><span data-stu-id="5a3ba-179">Filter Evaluation Priority</span></span>  
 <span data-ttu-id="5a3ba-180">Por padrão, todas as entradas na tabela de filtro são avaliadas simultaneamente, e a mensagem que está sendo avaliada é roteada para a extremidade associadas a cada entrada de filtro correspondente.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-180">By default, all entries in the filter table are evaluated simultaneously, and the message being evaluated is routed to the endpoint(s) associated with each matching filter entry.</span></span> <span data-ttu-id="5a3ba-181">Se vários filtros forem avaliados como `true`e a mensagem é unidirecionais ou bidirecionais, a mensagem é difundida via multicast para os pontos de extremidade para todos os filtros de correspondência.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-181">If multiple filters evaluate to `true`, and the message is one-way or duplex, the message is multicast to the endpoints for all matching filters.</span></span> <span data-ttu-id="5a3ba-182">Mensagens de solicitação-resposta não podem ser multicast porque somente uma resposta pode ser retornada ao cliente.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-182">Request-reply messages cannot be multicast because only one reply can be returned to the client.</span></span>  
  
 <span data-ttu-id="5a3ba-183">Lógica mais complexa de roteamento pode ser implementada, especificando níveis de prioridade para cada filtro; o serviço de roteamento avalia todos os filtros no nível de prioridade mais alto primeiro.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-183">More complex routing logic can be implemented by specifying priority levels for each filter; the Routing Service evaluates all filters at the highest priority level first.</span></span> <span data-ttu-id="5a3ba-184">Se uma mensagem corresponde a um filtro desse nível, nenhum filtro de menor prioridade será processado.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-184">If a message matches a filter of this level, no filters of a lower priority are processed.</span></span> <span data-ttu-id="5a3ba-185">Por exemplo, uma mensagem de entrada unidirecional primeiro é avaliada em relação a todos os filtros com prioridade 2.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-185">For example, an incoming one-way message is first evaluated against all filters with a priority of 2.</span></span> <span data-ttu-id="5a3ba-186">A mensagem não corresponde qualquer filtro nesse nível de prioridade, próximo que a mensagem é comparada com filtros com uma prioridade de 1.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-186">The message does not match any filter at this priority level, so next the message is compared against filters with a priority of 1.</span></span> <span data-ttu-id="5a3ba-187">Dois filtros de prioridade 1 correspondem à mensagem e porque é uma mensagem unidirecional que ela é roteada para os pontos de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-187">Two priority 1 filters match the message, and because it is a one-way message it is routed to both destination endpoints.</span></span>  <span data-ttu-id="5a3ba-188">Porque foi encontrada uma correspondência entre os filtros de prioridade 1, nenhum filtro de prioridade 0 é avaliado.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-188">Because a match was found among the priority 1 filters, no filters of priority 0 are evaluated.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5a3ba-189">Se nenhuma prioridade for especificada, a prioridade padrão de 0 será usada.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-189">If no priority is specified, the default priority of 0 is used.</span></span>  
  
 <span data-ttu-id="5a3ba-190">O exemplo a seguir define uma tabela de filtro que especifica as prioridades de 2, 1 e 0 para os filtros referenciados na tabela.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-190">The following example defines a filter table that specifies priorities of 2, 1, and 0 for the filters referenced in the table.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="XPathFilter" endpointName="roundingCalcEndpoint"   
               priority="2"/>  
          <add filterName="EndpointNameFilter" endpointName="regularCalcEndpoint"   
               priority="1"/>  
          <add filterName="PrefixAddressFilter" endpointName="roundingCalcEndpoint"   
               priority="1"/>  
          <add filterName="MatchAllMessageFilter" endpointName="defaultCalcEndpoint"   
               priority="0"/>  
     </filterTable>  
</filterTables>  
```  
  
 <span data-ttu-id="5a3ba-191">No exemplo anterior, se uma mensagem corresponde XPathFilter, ela será roteada para o roundingCalcEndpoint e sem filtros adicionais na tabela serão avaliados porque todos os outros filtros de uma prioridade mais baixa.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-191">In the preceding example, if a message matches the XPathFilter, it will be routed to the roundingCalcEndpoint and no further filters in the table will be evaluated because all other filters are of a lower priority.</span></span> <span data-ttu-id="5a3ba-192">No entanto, se a mensagem não corresponder XPathFilter ele, em seguida, será avaliado em relação a todos os filtros de menor prioridade, EndpointNameFilter e PrefixAddressFilter.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-192">However, if the message does not match the XPathFilter it will then be evaluated against all filters of the next lower priority, EndpointNameFilter and PrefixAddressFilter.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5a3ba-193">Quando possível, use filtros exclusivos em vez de especificar uma prioridade, como avaliação de prioridade pode resultar em degradação do desempenho.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-193">When possible, use exclusive filters instead of specifying a priority because priority evaluation can result in performance degradation.</span></span>  
  
### <a name="backup-lists"></a><span data-ttu-id="5a3ba-194">Listas de backup</span><span class="sxs-lookup"><span data-stu-id="5a3ba-194">Backup Lists</span></span>  
 <span data-ttu-id="5a3ba-195">Cada filtro na tabela de filtros pode opcionalmente especificar uma lista de backup, que é uma coleção nomeada de pontos de extremidade (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span><span class="sxs-lookup"><span data-stu-id="5a3ba-195">Each filter in the filter table can optionally specify a backup list, which is a named collection of endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span></span> <span data-ttu-id="5a3ba-196">Esta coleção contém uma lista ordenada de pontos de extremidade que a mensagem será transmitida no caso de um <xref:System.ServiceModel.CommunicationException> ao enviar para o ponto de extremidade primário especificado em <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-196">This collection contains an ordered list of endpoints that the message will be transmitted to in the event of a <xref:System.ServiceModel.CommunicationException> when sending to the primary endpoint specified in <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span></span> <span data-ttu-id="5a3ba-197">O exemplo a seguir define uma lista de backup denominada "backupServiceEndpoints" que contém dois pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-197">The following example defines a backup list named "backupServiceEndpoints" that contains two endpoints.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="MatchAllFilter1" endpointName="Destination" backupList="backupEndpointList"/>  
     </filterTable>  
</filterTables>  
<backupLists>  
     <backupList name="backupEndpointList">  
          <add endpointName="backupServiceQueue" />  
          <add endpointName="alternateServiceQueue" />  
     </backupList>  
</backupLists>  
```  
  
 <span data-ttu-id="5a3ba-198">No exemplo anterior, se um envio para o ponto de extremidade "Destino" primário falhar, o serviço de roteamento tentará enviar para cada ponto de extremidade na sequência estão listados, enviar primeiro para backupServiceQueue e enviar posteriormente para alternateServiceQueue se a Enviar para backupServiceQueue falhará.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-198">In the preceding example, if a send to the primary endpoint "Destination" fails, the Routing Service will try sending to each endpoint in the sequence they are listed, first sending to backupServiceQueue and subsequently sending to alternateServiceQueue if the send to backupServiceQueue fails.</span></span> <span data-ttu-id="5a3ba-199">Se todos os pontos de extremidade de backup falharem, uma falha será retornada.</span><span class="sxs-lookup"><span data-stu-id="5a3ba-199">If all backup endpoints fail, a fault is returned.</span></span>
