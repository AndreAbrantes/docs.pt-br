---
title: Federação e confiabilidade
ms.date: 03/30/2017
helpviewer_keywords:
- federation [WCF], and trust
ms.assetid: 4bdec4f2-f8a2-4512-bdcf-14ef54b5877a
ms.openlocfilehash: fc6a14ed825fa447e80a8389684d10ed07a00815
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33492899"
---
# <a name="federation-and-trust"></a><span data-ttu-id="6f40a-102">Federação e confiabilidade</span><span class="sxs-lookup"><span data-stu-id="6f40a-102">Federation and Trust</span></span>
<span data-ttu-id="6f40a-103">Este tópico abrange vários aspectos relacionados a aplicativos federados, limites de confiança e configuração e uso de tokens emitidos no Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="6f40a-103">This topic covers various aspects related to federated applications, trust boundaries and configuration, and use of issued tokens in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="services-security-token-services-and-trust"></a><span data-ttu-id="6f40a-104">Serviços, serviços de Token de segurança e confiança</span><span class="sxs-lookup"><span data-stu-id="6f40a-104">Services, Security Token Services, and Trust</span></span>  
 <span data-ttu-id="6f40a-105">Serviços que expõem pontos de extremidade federados normalmente esperam que os clientes se autentiquem usando um token fornecido por um emissor específico.</span><span class="sxs-lookup"><span data-stu-id="6f40a-105">Services that expose federated endpoints typically expect clients to authenticate using a token provided by a specific issuer.</span></span> <span data-ttu-id="6f40a-106">É importante que o serviço está configurado com as credenciais corretas para o emissor; Caso contrário, não será capaz de verificar assinaturas em tokens emitidos, e o cliente será capaz de se comunicar com o serviço.</span><span class="sxs-lookup"><span data-stu-id="6f40a-106">It is important that the service is configured with the correct credentials for the issuer; otherwise, it will not be able to verify signatures over the issued tokens, and the client will be unable to communicate with the service.</span></span> <span data-ttu-id="6f40a-107">Para obter mais informações sobre como configurar credenciais de emissor do serviço, consulte [como: configurar credenciais em um serviço de Federação](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).</span><span class="sxs-lookup"><span data-stu-id="6f40a-107">For more information about configuring issuer credentials on the service, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).</span></span>  
  
 <span data-ttu-id="6f40a-108">Da mesma forma, ao usar chaves simétricas, as chaves são criptografadas para o serviço de destino, assim você deve configurar o serviço de token de segurança com as credenciais corretas para o serviço de destino; Caso contrário, ele será não é possível criptografar a chave para o serviço de destino, e novamente, o cliente será capaz de se comunicar com o serviço.</span><span class="sxs-lookup"><span data-stu-id="6f40a-108">Similarly, when using symmetric keys, the keys are encrypted for the target service, so you must configure the security token service with the correct credentials for the target service; otherwise, it will be unable to encrypt the key for the target service, and again, the client will be unable to communicate with the service.</span></span>  
  
 <span data-ttu-id="6f40a-109">Serviços WCF usam o valor da <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> propriedade o [SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md) para permitir o relógio defasagem horária entre o cliente e o serviço.</span><span class="sxs-lookup"><span data-stu-id="6f40a-109">WCF services use the value of the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the [SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md) to allow for clock skew between the client and service.</span></span> <span data-ttu-id="6f40a-110">Na federação, o `MaxClockSkew` configuração se aplica a inclina relógio entre o cliente e o serviço de token de segurança do qual o cliente obteve o token emitido.</span><span class="sxs-lookup"><span data-stu-id="6f40a-110">In federation, the `MaxClockSkew` setting applies to clock skews between both the client and the security token service from where the client obtained the issued token.</span></span> <span data-ttu-id="6f40a-111">Portanto, os serviços de token de segurança não precisam fazer concessões defasagem horária ao definir tempos de efetivação e expiração do token emitido.</span><span class="sxs-lookup"><span data-stu-id="6f40a-111">Therefore, security token services need not make clock-skew allowances when setting the issued token's effective and expiration times.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6f40a-112">A importância de distorção do relógio aumenta à medida que reduz o tempo de vida do token emitido.</span><span class="sxs-lookup"><span data-stu-id="6f40a-112">The importance of clock skew increases as the lifetime of the issued token shortens.</span></span> <span data-ttu-id="6f40a-113">Na maioria dos casos, defasagem horária não é um problema significativo se o tempo de vida do token é 30 minutos ou mais.</span><span class="sxs-lookup"><span data-stu-id="6f40a-113">In most cases, clock skew is not a significant issue if the token lifetime is 30 minutes or more.</span></span> <span data-ttu-id="6f40a-114">Cenários com tempos de vida mais curto ou em que o tempo de validade exato do token é importante devem ser projetados para levar o distorção do relógio em conta.</span><span class="sxs-lookup"><span data-stu-id="6f40a-114">Scenarios with shorter lifetimes or where the exact validity time of the token is important should be designed to take clock skew into account.</span></span>  
  
## <a name="federated-endpoints-and-time-outs"></a><span data-ttu-id="6f40a-115">Tempos limite e pontos de extremidade federados</span><span class="sxs-lookup"><span data-stu-id="6f40a-115">Federated Endpoints and Time-Outs</span></span>  
 <span data-ttu-id="6f40a-116">Quando um cliente se comunica com um ponto de extremidade federado, ele deve primeiro adquirir um token apropriado de um serviço de token de segurança.</span><span class="sxs-lookup"><span data-stu-id="6f40a-116">When a client communicates with a federated endpoint, it must first acquire an appropriate token from a security token service.</span></span> <span data-ttu-id="6f40a-117">Se o serviço de token de segurança expõe um ponto de extremidade federado, o cliente deve primeiro obter um token do emissor para esse ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="6f40a-117">If the security token service exposes a federated endpoint, the client must first obtain a token from the issuer for that endpoint.</span></span> <span data-ttu-id="6f40a-118">Cada aquisição de token leva tempo e tempo está sujeito ao tempo limite geral para enviar a mensagem real para o ponto de extremidade final.</span><span class="sxs-lookup"><span data-stu-id="6f40a-118">Each token acquisition takes time, and that time is subject to the overall time-out for sending the actual message to the final endpoint.</span></span>  
  
 <span data-ttu-id="6f40a-119">Por exemplo, o tempo limite no canal do lado do cliente é definido como 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="6f40a-119">For example, the time-out on the client-side channel is set to 30 seconds.</span></span> <span data-ttu-id="6f40a-120">Emissores de token dois precisam ser chamado para recuperar tokens antes de enviar a mensagem para o ponto de extremidade final e cada uma usa 15 segundos para emitir um token.</span><span class="sxs-lookup"><span data-stu-id="6f40a-120">Two token issuers need to be called to retrieve tokens before sending the message to the final endpoint, and each takes 15 seconds to issue a token.</span></span> <span data-ttu-id="6f40a-121">Nesse caso, a tentativa falhará e um <xref:System.TimeoutException> é gerada.</span><span class="sxs-lookup"><span data-stu-id="6f40a-121">In this case, the attempt will fail and a <xref:System.TimeoutException> is thrown.</span></span> <span data-ttu-id="6f40a-122">Portanto, você precisará definir o <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> valor o canal do cliente para um valor grande o suficiente para incluir o tempo necessário para recuperar todos os tokens emitidos.</span><span class="sxs-lookup"><span data-stu-id="6f40a-122">Thus, you need to set the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> value on the client channel to a value large enough to include the time taken to retrieve all issued tokens.</span></span> <span data-ttu-id="6f40a-123">No caso em que um valor não for especificado para o <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> propriedade, o <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> propriedade ou o <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> propriedade (ou ambos) precisam ser definidos para um valor grande o suficiente para incluir o tempo necessário para recuperar os tokens emitidos todos.</span><span class="sxs-lookup"><span data-stu-id="6f40a-123">In the case where a value is not specified for the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> property, the <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> property or the <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> property (or both) need to be set to a value large enough to include the time taken to retrieve all issued tokens.</span></span>  
  
## <a name="token-lifetime-and-renewal"></a><span data-ttu-id="6f40a-124">Vida útil do token e renovação</span><span class="sxs-lookup"><span data-stu-id="6f40a-124">Token Lifetime and Renewal</span></span>  
 <span data-ttu-id="6f40a-125">Clientes do WCF não verifica o token emitido ao fazer uma solicitação inicial para um serviço.</span><span class="sxs-lookup"><span data-stu-id="6f40a-125">WCF clients do not check the issued token when making an initial request to a service.</span></span>  <span data-ttu-id="6f40a-126">Em vez disso, o WCF confia o serviço de token de segurança para emitir um token com momentos apropriados de efetivação e expiração.</span><span class="sxs-lookup"><span data-stu-id="6f40a-126">Rather, WCF trusts the security token service to issue a token with appropriate effective and expiration times.</span></span> <span data-ttu-id="6f40a-127">Se o token é armazenado em cache pelo cliente e reutilizado, a vida útil do token é verificada em solicitações subsequentes e o cliente renova automaticamente o token se necessário.</span><span class="sxs-lookup"><span data-stu-id="6f40a-127">If the token is cached by the client and reused, the token lifetime is checked on subsequent requests and the client automatically renews the token if necessary.</span></span> <span data-ttu-id="6f40a-128">Para obter mais informações sobre o cache de token, consulte [como: criar um cliente federado](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md).</span><span class="sxs-lookup"><span data-stu-id="6f40a-128">For more information about token caching, see [How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md).</span></span>  
  
 <span data-ttu-id="6f40a-129">Especificar tempos de vida curtos, de 30 segundos ou menos para emitidos símbolos ou tokens de contexto de segurança, pode resultar em tempos limite de negociação ou outras exceções que está sendo geradas pelos clientes do WCF ao solicitar tokens emitidos ou quando a negociação ou renovação de segurança tokens de contexto.</span><span class="sxs-lookup"><span data-stu-id="6f40a-129">Specifying short lifetimes, on the order of 30 seconds or less for issued tokens or security context tokens, may result in negotiation time-outs or other exceptions being thrown by WCF clients when requesting issued tokens or when negotiating or renewing security context tokens.</span></span>  
  
## <a name="issued-tokens-and-inclusionmode"></a><span data-ttu-id="6f40a-130">Tokens emitidos e InclusionMode</span><span class="sxs-lookup"><span data-stu-id="6f40a-130">Issued Tokens and InclusionMode</span></span>  
 <span data-ttu-id="6f40a-131">Se um token emitido é serializado em uma mensagem enviada de um cliente para um ponto de extremidade federado ou não é controlado pela configuração de <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> propriedade o <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> classe.</span><span class="sxs-lookup"><span data-stu-id="6f40a-131">Whether an issued token is serialized in a message sent from a client to a federated endpoint or not is controlled by setting the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> property of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span> <span data-ttu-id="6f40a-132">Essa propriedade pode ser definida para uma da <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> valores de enumeração, mas não é útil em cenários mais federados.</span><span class="sxs-lookup"><span data-stu-id="6f40a-132">This property can be set to one of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> enumeration values, but it is not useful in most federated scenarios.</span></span> <span data-ttu-id="6f40a-133">O `SecurityTokenInclusionMode.Never` e `SecurityTokenInclusionMode.AlwaysToInitiator` valores fazem com que o cliente envie uma referência para o token emitido pelo serviço de token de segurança para a terceira parte confiável.</span><span class="sxs-lookup"><span data-stu-id="6f40a-133">The `SecurityTokenInclusionMode.Never` and `SecurityTokenInclusionMode.AlwaysToInitiator` values cause the client to send a reference to the token issued by the security token service to the relying party.</span></span> <span data-ttu-id="6f40a-134">A menos que a terceira parte confiável tiver uma cópia da autenticação do token emitida falhará porque a referência de token não for resolvida.</span><span class="sxs-lookup"><span data-stu-id="6f40a-134">Unless the relying party possesses a copy of the issued token, authentication will fail because the token reference is not resolvable.</span></span> <span data-ttu-id="6f40a-135">O WCF trata `SecurityTokenInclusionMode.Once` como equivalente à `SecurityTokenInclusionMode.AlwaysToRecipient`.</span><span class="sxs-lookup"><span data-stu-id="6f40a-135">WCF treats `SecurityTokenInclusionMode.Once` as equivalent to `SecurityTokenInclusionMode.AlwaysToRecipient`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6f40a-136">Consulte também</span><span class="sxs-lookup"><span data-stu-id="6f40a-136">See Also</span></span>  
 <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>  
 [<span data-ttu-id="6f40a-137">Como criar um cliente federado</span><span class="sxs-lookup"><span data-stu-id="6f40a-137">How to: Create a Federated Client</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)  
 [<span data-ttu-id="6f40a-138">Como configurar as credenciais em um Serviço de Federação</span><span class="sxs-lookup"><span data-stu-id="6f40a-138">How to: Configure Credentials on a Federation Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)  
 [<span data-ttu-id="6f40a-139">Como criar um WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="6f40a-139">How to: Create a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)
