---
title: Usando a classe de mensagens
description: Saiba mais sobre a classe de mensagem, que é fundamental para o WCF. Você precisa programar usando a classe de mensagem diretamente apenas em alguns cenários avançados.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d1d62bfb-2aa3-4170-b6f8-c93d3afdbbed
ms.openlocfilehash: f806e257cfd3ccc5118a5783e2eda48eef4ba0bf
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85246487"
---
# <a name="using-the-message-class"></a><span data-ttu-id="1babf-104">Usando a classe de mensagens</span><span class="sxs-lookup"><span data-stu-id="1babf-104">Using the Message Class</span></span>
<span data-ttu-id="1babf-105">A <xref:System.ServiceModel.Channels.Message> classe é fundamental para Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="1babf-105">The <xref:System.ServiceModel.Channels.Message> class is fundamental to Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="1babf-106">Toda a comunicação entre clientes e serviços finalmente resulta em <xref:System.ServiceModel.Channels.Message> instâncias sendo enviadas e recebidas.</span><span class="sxs-lookup"><span data-stu-id="1babf-106">All communication between clients and services ultimately results in <xref:System.ServiceModel.Channels.Message> instances being sent and received.</span></span>  
  
 <span data-ttu-id="1babf-107">Normalmente, você não interage com a <xref:System.ServiceModel.Channels.Message> classe diretamente.</span><span class="sxs-lookup"><span data-stu-id="1babf-107">You would not usually interact with the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="1babf-108">Em vez disso, as construções de modelo de serviço do WCF, como contratos de dados, contratos de mensagem e contratos de operação, são usadas para descrever mensagens de entrada e saída.</span><span class="sxs-lookup"><span data-stu-id="1babf-108">Instead, WCF service model constructs, such as data contracts, message contracts, and operation contracts, are used to describe incoming and outgoing messages.</span></span> <span data-ttu-id="1babf-109">No entanto, em alguns cenários avançados, você pode programar usando a <xref:System.ServiceModel.Channels.Message> classe diretamente.</span><span class="sxs-lookup"><span data-stu-id="1babf-109">However, in some advanced scenarios you can program using the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="1babf-110">Por exemplo, talvez você queira usar a <xref:System.ServiceModel.Channels.Message> classe:</span><span class="sxs-lookup"><span data-stu-id="1babf-110">For example, you might want to use the <xref:System.ServiceModel.Channels.Message> class:</span></span>  
  
- <span data-ttu-id="1babf-111">Quando você precisa de uma maneira alternativa de criar o conteúdo da mensagem de saída (por exemplo, criar uma mensagem diretamente de um arquivo em disco) em vez de serializar os objetos .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="1babf-111">When you need an alternative way of creating outgoing message contents (for example, creating a message directly from a file on disk) instead of serializing .NET Framework objects.</span></span>  
  
- <span data-ttu-id="1babf-112">Quando você precisa de uma maneira alternativa de usar o conteúdo da mensagem de entrada (por exemplo, quando você deseja aplicar uma transformação XSLT ao conteúdo XML bruto) em vez de desserializar em objetos .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="1babf-112">When you need an alternative way of using incoming message contents (for example, when you want to apply an XSLT transformation to the raw XML contents) instead of deserializing into .NET Framework objects.</span></span>  
  
- <span data-ttu-id="1babf-113">Quando você precisa lidar com mensagens de uma maneira geral, independentemente do conteúdo da mensagem (por exemplo, ao rotear ou encaminhar mensagens ao criar um roteador, balanceador de carga ou um sistema de publicação/assinatura).</span><span class="sxs-lookup"><span data-stu-id="1babf-113">When you need to deal with messages in a general way regardless of message contents (for example, when routing or forwarding messages when building a router, load-balancer, or a publish-subscribe system).</span></span>  
  
 <span data-ttu-id="1babf-114">Antes de usar a <xref:System.ServiceModel.Channels.Message> classe, familiarize-se com a arquitetura de transferência de dados do WCF em [transferência de dados visão geral da arquitetura](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1babf-114">Before using the <xref:System.ServiceModel.Channels.Message> class, familiarize yourself with the WCF data transfer architecture in [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
 <span data-ttu-id="1babf-115">Um <xref:System.ServiceModel.Channels.Message> é um contêiner de finalidade geral para dados, mas seu design segue o design de uma mensagem no protocolo SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-115">A <xref:System.ServiceModel.Channels.Message> is a general-purpose container for data, but its design closely follows the design of a message in the SOAP protocol.</span></span> <span data-ttu-id="1babf-116">Assim como no SOAP, uma mensagem tem um corpo de mensagem e cabeçalhos.</span><span class="sxs-lookup"><span data-stu-id="1babf-116">Just like in SOAP, a message has both a message body and headers.</span></span> <span data-ttu-id="1babf-117">O corpo da mensagem contém os dados de carga reais, enquanto os cabeçalhos contêm contêineres de dados nomeados adicionais.</span><span class="sxs-lookup"><span data-stu-id="1babf-117">The message body contains the actual payload data, while the headers contain additional named data containers.</span></span> <span data-ttu-id="1babf-118">As regras para ler e gravar o corpo e os cabeçalhos são diferentes, por exemplo, os cabeçalhos sempre são armazenados em buffer na memória e podem ser acessados em qualquer ordem várias vezes, enquanto o corpo pode ser lido apenas uma vez e pode ser transmitido.</span><span class="sxs-lookup"><span data-stu-id="1babf-118">The rules for reading and writing the body and the headers are different, for example, the headers are always buffered in memory and may be accessed in any order any number of times, while the body may be read only once and may be streamed.</span></span> <span data-ttu-id="1babf-119">Normalmente, ao usar SOAP, o corpo da mensagem é mapeado para o corpo SOAP e os cabeçalhos da mensagem são mapeados para os cabeçalhos SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-119">Normally, when using SOAP, the message body is mapped to the SOAP body and the message headers are mapped to the SOAP headers.</span></span>  
  
## <a name="using-the-message-class-in-operations"></a><span data-ttu-id="1babf-120">Usando a classe Message em operações</span><span class="sxs-lookup"><span data-stu-id="1babf-120">Using the Message Class in Operations</span></span>  
 <span data-ttu-id="1babf-121">Você pode usar a <xref:System.ServiceModel.Channels.Message> classe como um parâmetro de entrada de uma operação, o valor de retorno de uma operação ou ambos.</span><span class="sxs-lookup"><span data-stu-id="1babf-121">You can use the <xref:System.ServiceModel.Channels.Message> class as an input parameter of an operation, the return value of an operation, or both.</span></span> <span data-ttu-id="1babf-122">Se <xref:System.ServiceModel.Channels.Message> for usado em qualquer lugar em uma operação, as seguintes restrições serão aplicáveis:</span><span class="sxs-lookup"><span data-stu-id="1babf-122">If <xref:System.ServiceModel.Channels.Message> is used anywhere in an operation, the following restrictions apply:</span></span>  
  
- <span data-ttu-id="1babf-123">A operação não pode ter `out` nenhum `ref` parâmetro ou.</span><span class="sxs-lookup"><span data-stu-id="1babf-123">The operation cannot have any `out` or `ref` parameters.</span></span>  
  
- <span data-ttu-id="1babf-124">Não pode haver mais de um `input` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="1babf-124">There cannot be more than one `input` parameter.</span></span> <span data-ttu-id="1babf-125">Se o parâmetro estiver presente, ele deverá ser uma mensagem ou um tipo de contrato de mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-125">If the parameter is present, it must be either Message or a message contract type.</span></span>  
  
- <span data-ttu-id="1babf-126">O tipo de retorno deve ser `void` , `Message` ou um tipo de contrato de mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-126">The return type must be either `void`, `Message`, or a message contract type.</span></span>  
  
 <span data-ttu-id="1babf-127">O exemplo de código a seguir contém um contrato de operação válido.</span><span class="sxs-lookup"><span data-stu-id="1babf-127">The following code example contains a valid operation contract.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#1)]
 [!code-vb[C_UsingTheMessageClass#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#1)]  
  
## <a name="creating-basic-messages"></a><span data-ttu-id="1babf-128">Criando mensagens básicas</span><span class="sxs-lookup"><span data-stu-id="1babf-128">Creating Basic Messages</span></span>  
 <span data-ttu-id="1babf-129">A <xref:System.ServiceModel.Channels.Message> classe fornece métodos de fábrica estáticos `CreateMessage` que você pode usar para criar mensagens básicas.</span><span class="sxs-lookup"><span data-stu-id="1babf-129">The <xref:System.ServiceModel.Channels.Message> class provides static `CreateMessage` factory methods that you can use to create basic messages.</span></span>  
  
 <span data-ttu-id="1babf-130">Todas as `CreateMessage` sobrecargas usam um parâmetro de versão do tipo <xref:System.ServiceModel.Channels.MessageVersion> que indica as versões SOAP e WS-Addressing a serem usadas para a mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-130">All `CreateMessage` overloads take a version parameter of type <xref:System.ServiceModel.Channels.MessageVersion> that indicates the SOAP and WS-Addressing versions to use for the message.</span></span> <span data-ttu-id="1babf-131">Se você quiser usar as mesmas versões de protocolo que a mensagem de entrada, poderá usar a <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> Propriedade na <xref:System.ServiceModel.OperationContext> instância obtida da <xref:System.ServiceModel.OperationContext.Current%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="1babf-131">If you want to use the same protocol versions as the incoming message, you can use the <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> property on the <xref:System.ServiceModel.OperationContext> instance obtained from the <xref:System.ServiceModel.OperationContext.Current%2A> property.</span></span> <span data-ttu-id="1babf-132">A maioria das `CreateMessage` sobrecargas também tem um parâmetro de cadeia de caracteres que indica a ação SOAP a ser usada para a mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-132">Most `CreateMessage` overloads also have a string parameter that indicates the SOAP action to use for the message.</span></span> <span data-ttu-id="1babf-133">A versão pode ser definida como `None` para desabilitar a geração de envelope SOAP; a mensagem consiste apenas no corpo.</span><span class="sxs-lookup"><span data-stu-id="1babf-133">Version can be set to `None` to disable SOAP envelope generation; the message consists of only the body.</span></span>  
  
## <a name="creating-messages-from-objects"></a><span data-ttu-id="1babf-134">Criando mensagens de objetos</span><span class="sxs-lookup"><span data-stu-id="1babf-134">Creating Messages from Objects</span></span>  
 <span data-ttu-id="1babf-135">A sobrecarga mais básica `CreateMessage` que usa apenas uma versão e uma ação cria uma mensagem com um corpo vazio.</span><span class="sxs-lookup"><span data-stu-id="1babf-135">The most basic `CreateMessage` overload that takes only a version and an action creates a message with an empty body.</span></span> <span data-ttu-id="1babf-136">Outra sobrecarga usa um <xref:System.Object> parâmetro adicional; isso cria uma mensagem cujo corpo é a representação serializada do objeto fornecido.</span><span class="sxs-lookup"><span data-stu-id="1babf-136">Another overload takes an additional <xref:System.Object> parameter; this creates a message whose body is the serialized representation of the given object.</span></span> <span data-ttu-id="1babf-137">Use as <xref:System.Runtime.Serialization.DataContractSerializer> configurações padrão para serialização.</span><span class="sxs-lookup"><span data-stu-id="1babf-137">Use the <xref:System.Runtime.Serialization.DataContractSerializer> with default settings for serialization.</span></span> <span data-ttu-id="1babf-138">Se você quiser usar um serializador diferente ou desejar configurá-lo de `DataContractSerializer` forma diferente, use a `CreateMessage` sobrecarga que também usa um `XmlObjectSerializer` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="1babf-138">If you want to use a different serializer, or you want the `DataContractSerializer` configured differently, use the `CreateMessage` overload that also takes an `XmlObjectSerializer` parameter.</span></span>  
  
 <span data-ttu-id="1babf-139">Por exemplo, para retornar um objeto em uma mensagem, você pode usar o código a seguir.</span><span class="sxs-lookup"><span data-stu-id="1babf-139">For example, to return an object in a message, you can use the following code.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#2)]
 [!code-vb[C_UsingTheMessageClass#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#2)]  
  
## <a name="creating-messages-from-xml-readers"></a><span data-ttu-id="1babf-140">Criando mensagens de leitores XML</span><span class="sxs-lookup"><span data-stu-id="1babf-140">Creating Messages from XML Readers</span></span>  
 <span data-ttu-id="1babf-141">Há `CreateMessage` sobrecargas que usam um <xref:System.Xml.XmlReader> ou um <xref:System.Xml.XmlDictionaryReader> para o corpo em vez de um objeto.</span><span class="sxs-lookup"><span data-stu-id="1babf-141">There are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> for the body instead of an object.</span></span> <span data-ttu-id="1babf-142">Nesse caso, o corpo da mensagem contém o XML que resulta da leitura do leitor de XML passado.</span><span class="sxs-lookup"><span data-stu-id="1babf-142">In this case, the body of the message contains the XML that results from reading from the passed XML reader.</span></span> <span data-ttu-id="1babf-143">Por exemplo, o código a seguir retorna uma mensagem com conteúdo do corpo lido a partir de um arquivo XML.</span><span class="sxs-lookup"><span data-stu-id="1babf-143">For example, the following code returns a message with body contents read from an XML file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#3)]
 [!code-vb[C_UsingTheMessageClass#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#3)]  
  
 <span data-ttu-id="1babf-144">Além disso, há `CreateMessage` sobrecargas que usam um <xref:System.Xml.XmlReader> ou um <xref:System.Xml.XmlDictionaryReader> que representa a mensagem inteira e não apenas o corpo.</span><span class="sxs-lookup"><span data-stu-id="1babf-144">Additionally, there are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> that represents the entire message and not just the body.</span></span> <span data-ttu-id="1babf-145">Essas sobrecargas também usam um `maxSizeOfHeaders` parâmetro inteiro.</span><span class="sxs-lookup"><span data-stu-id="1babf-145">These overloads also take an integer `maxSizeOfHeaders` parameter.</span></span> <span data-ttu-id="1babf-146">Os cabeçalhos sempre são armazenados em buffer na memória assim que a mensagem é criada, e esse parâmetro limita a quantidade de buffers que ocorre.</span><span class="sxs-lookup"><span data-stu-id="1babf-146">Headers are always buffered into memory as soon as the message is created, and this parameter limits the amount of buffering that takes place.</span></span> <span data-ttu-id="1babf-147">É importante definir esse parâmetro como um valor seguro se o XML estiver vindo de uma fonte não confiável para atenuar a possibilidade de um ataque de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="1babf-147">It is important to set this parameter to a safe value if the XML is coming from an untrusted source to mitigate the possibility of a denial of service attack.</span></span> <span data-ttu-id="1babf-148">As versões SOAP e WS-Addressing da mensagem que o leitor de XML representa devem corresponder às versões indicadas usando o parâmetro version.</span><span class="sxs-lookup"><span data-stu-id="1babf-148">The SOAP and WS-Addressing versions of the message the XML reader represents must match the versions indicated using the version parameter.</span></span>  
  
## <a name="creating-messages-with-bodywriter"></a><span data-ttu-id="1babf-149">Criando mensagens com BodyWriter</span><span class="sxs-lookup"><span data-stu-id="1babf-149">Creating Messages with BodyWriter</span></span>  
 <span data-ttu-id="1babf-150">Uma `CreateMessage` sobrecarga usa uma `BodyWriter` instância para descrever o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-150">One `CreateMessage` overload takes a `BodyWriter` instance to describe the body of the message.</span></span> <span data-ttu-id="1babf-151">Uma `BodyWriter` é uma classe abstrata que pode ser derivada para personalizar como os corpos de mensagens são criados.</span><span class="sxs-lookup"><span data-stu-id="1babf-151">A `BodyWriter` is an abstract class that can be derived to customize how message bodies are created.</span></span> <span data-ttu-id="1babf-152">Você pode criar sua própria `BodyWriter` classe derivada para descrever os corpos de mensagens de uma maneira personalizada.</span><span class="sxs-lookup"><span data-stu-id="1babf-152">You can create your own `BodyWriter` derived class to describe message bodies in a custom way.</span></span> <span data-ttu-id="1babf-153">Você deve substituir o `BodyWriter.OnWriteBodyContents` método que recebe um <xref:System.Xml.XmlDictionaryWriter> ; esse método é responsável por gravar o corpo.</span><span class="sxs-lookup"><span data-stu-id="1babf-153">You must override the `BodyWriter.OnWriteBodyContents` method that takes an <xref:System.Xml.XmlDictionaryWriter>; this method is responsible for writing out the body.</span></span>  
  
 <span data-ttu-id="1babf-154">Gravadores de corpo podem ser armazenados em buffer ou não armazenados em buffer (transmitidos).</span><span class="sxs-lookup"><span data-stu-id="1babf-154">Body writers can be buffered or non-buffered (streamed).</span></span> <span data-ttu-id="1babf-155">Gravadores de corpo em buffer podem gravar seu conteúdo várias vezes, enquanto os transmitidos podem gravar seu conteúdo apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="1babf-155">Buffered body writers can write out their contents any number of times, while streamed ones can write out their contents only once.</span></span> <span data-ttu-id="1babf-156">A `IsBuffered` propriedade indica se um gravador de corpo está armazenado em buffer ou não.</span><span class="sxs-lookup"><span data-stu-id="1babf-156">The `IsBuffered` property indicates whether a body writer is buffered or not.</span></span> <span data-ttu-id="1babf-157">Você pode definir isso para o gravador de corpo chamando o `BodyWriter` construtor protegido que usa um `isBuffered` parâmetro booliano.</span><span class="sxs-lookup"><span data-stu-id="1babf-157">You can set this for your body writer by calling the protected `BodyWriter` constructor that takes an `isBuffered` boolean parameter.</span></span> <span data-ttu-id="1babf-158">Escritores de corpo dão suporte à criação de um gravador de corpo em buffer de um gravador de corpo sem buffer.</span><span class="sxs-lookup"><span data-stu-id="1babf-158">Body writers support creating a buffered body writer from a non-buffered body writer.</span></span> <span data-ttu-id="1babf-159">Você pode substituir o `OnCreateBufferedCopy` método para personalizar esse processo.</span><span class="sxs-lookup"><span data-stu-id="1babf-159">You can override the `OnCreateBufferedCopy` method to customize this process.</span></span> <span data-ttu-id="1babf-160">Por padrão, um buffer na memória que contém o XML retornado por `OnWriteBodyContents` é usado.</span><span class="sxs-lookup"><span data-stu-id="1babf-160">By default, an in-memory buffer that contains the XML returned by `OnWriteBodyContents` is used.</span></span> <span data-ttu-id="1babf-161">`OnCreateBufferedCopy`usa um `maxBufferSize` parâmetro inteiro; se você substituir esse método, não deverá criar buffers maiores que esse tamanho máximo.</span><span class="sxs-lookup"><span data-stu-id="1babf-161">`OnCreateBufferedCopy` takes a `maxBufferSize` integer parameter; if you override this method, you must not create buffers larger than this maximum size.</span></span>  
  
 <span data-ttu-id="1babf-162">A `BodyWriter` classe fornece os `WriteBodyContents` `CreateBufferedCopy` métodos e, que são essencialmente invólucros finos `OnWriteBodyContents` e `OnCreateBufferedCopy` métodos, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1babf-162">The `BodyWriter` class provides the `WriteBodyContents` and `CreateBufferedCopy` methods, which are essentially thin wrappers around `OnWriteBodyContents` and `OnCreateBufferedCopy` methods, respectively.</span></span> <span data-ttu-id="1babf-163">Esses métodos executam a verificação de estado para garantir que um gravador de corpo não armazenado em buffer não seja acessado mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="1babf-163">These methods perform state checking to ensure that a non-buffered body writer is not accessed more than once.</span></span> <span data-ttu-id="1babf-164">Esses métodos são chamados diretamente somente ao criar `Message` classes derivadas personalizadas com base em `BodyWriters` .</span><span class="sxs-lookup"><span data-stu-id="1babf-164">These methods are called directly only when creating custom `Message` derived classes based on `BodyWriters`.</span></span>  
  
## <a name="creating-fault-messages"></a><span data-ttu-id="1babf-165">Criando mensagens de falha</span><span class="sxs-lookup"><span data-stu-id="1babf-165">Creating Fault Messages</span></span>  
 <span data-ttu-id="1babf-166">Você pode usar determinadas `CreateMessage` sobrecargas para criar mensagens de falha de SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-166">You can use certain `CreateMessage` overloads to create SOAP fault messages.</span></span> <span data-ttu-id="1babf-167">O mais básico deles usa um <xref:System.ServiceModel.Channels.MessageFault> objeto que descreve a falha.</span><span class="sxs-lookup"><span data-stu-id="1babf-167">The most basic of these takes a <xref:System.ServiceModel.Channels.MessageFault> object that describes the fault.</span></span> <span data-ttu-id="1babf-168">Outras sobrecargas são fornecidas por conveniência.</span><span class="sxs-lookup"><span data-stu-id="1babf-168">Other overloads are provided for convenience.</span></span> <span data-ttu-id="1babf-169">A primeira sobrecarga usa uma `FaultCode` e uma cadeia de caracteres de motivo e cria um `MessageFault` usando `MessageFault.CreateFault` essas informações.</span><span class="sxs-lookup"><span data-stu-id="1babf-169">The first such overload takes a `FaultCode` and a reason string and creates a `MessageFault` using `MessageFault.CreateFault` using this information.</span></span> <span data-ttu-id="1babf-170">A outra sobrecarga usa um objeto de detalhe e também a passa para `CreateFault` junto com o código de falha e o motivo.</span><span class="sxs-lookup"><span data-stu-id="1babf-170">The other overload takes a detail object and also passes it to `CreateFault` together with the fault code and the reason.</span></span> <span data-ttu-id="1babf-171">Por exemplo, a operação a seguir retorna uma falha.</span><span class="sxs-lookup"><span data-stu-id="1babf-171">For example, the following operation returns a fault.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#4)]
 [!code-vb[C_UsingTheMessageClass#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#4)]  
  
## <a name="extracting-message-body-data"></a><span data-ttu-id="1babf-172">Extraindo dados do corpo da mensagem</span><span class="sxs-lookup"><span data-stu-id="1babf-172">Extracting Message Body Data</span></span>  
 <span data-ttu-id="1babf-173">A `Message` classe dá suporte a várias maneiras de extrair informações de seu corpo.</span><span class="sxs-lookup"><span data-stu-id="1babf-173">The `Message` class supports multiple ways of extracting information from its body.</span></span> <span data-ttu-id="1babf-174">Elas podem ser classificadas nas seguintes categorias:</span><span class="sxs-lookup"><span data-stu-id="1babf-174">These can be classified into the following categories:</span></span>  
  
- <span data-ttu-id="1babf-175">Obtendo todo o corpo da mensagem escrito de uma vez a um gravador de XML.</span><span class="sxs-lookup"><span data-stu-id="1babf-175">Getting the entire message body written out at once to an XML writer.</span></span> <span data-ttu-id="1babf-176">Isso é chamado de *gravação de uma mensagem*.</span><span class="sxs-lookup"><span data-stu-id="1babf-176">This is referred to as *writing a message*.</span></span>  
  
- <span data-ttu-id="1babf-177">Obtendo um leitor de XML no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-177">Getting an XML reader over the message body.</span></span> <span data-ttu-id="1babf-178">Isso permite que você acesse mais tarde o corpo da mensagem por parte, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="1babf-178">This enables you to later access the message body piece-by-piece as required.</span></span> <span data-ttu-id="1babf-179">Isso é conhecido como *leitura de uma mensagem*.</span><span class="sxs-lookup"><span data-stu-id="1babf-179">This is referred to as *reading a message*.</span></span>  
  
- <span data-ttu-id="1babf-180">A mensagem inteira, incluindo seu corpo, pode ser copiada para um buffer na memória do <xref:System.ServiceModel.Channels.MessageBuffer> tipo.</span><span class="sxs-lookup"><span data-stu-id="1babf-180">The entire message, including its body, can be copied to an in-memory buffer of the <xref:System.ServiceModel.Channels.MessageBuffer> type.</span></span> <span data-ttu-id="1babf-181">Isso é conhecido como *copiar uma mensagem*.</span><span class="sxs-lookup"><span data-stu-id="1babf-181">This is referred to as *copying a message*.</span></span>  
  
 <span data-ttu-id="1babf-182">Você pode acessar o corpo de uma `Message` só vez, independentemente de como ele é acessado.</span><span class="sxs-lookup"><span data-stu-id="1babf-182">You can access the body of a `Message` only once, regardless of how it is accessed.</span></span> <span data-ttu-id="1babf-183">Um objeto Message tem uma `State` propriedade, que é inicialmente definida como Created.</span><span class="sxs-lookup"><span data-stu-id="1babf-183">A message object has a `State` property, which is initially set to Created.</span></span> <span data-ttu-id="1babf-184">Os três métodos de acesso descritos na lista anterior definem o estado como gravado, lido e copiado, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1babf-184">The three access methods described in the preceding list set the state to Written, Read, and Copied, respectively.</span></span> <span data-ttu-id="1babf-185">Além disso, um `Close` método pode definir o estado como fechado quando o conteúdo do corpo da mensagem não é mais necessário.</span><span class="sxs-lookup"><span data-stu-id="1babf-185">Additionally, a `Close` method can set the state to Closed when the message body contents are no longer required.</span></span> <span data-ttu-id="1babf-186">O corpo da mensagem pode ser acessado somente no estado criado e não há como voltar para o estado criado depois que o estado for alterado.</span><span class="sxs-lookup"><span data-stu-id="1babf-186">The message body can be accessed only in the Created state, and there is no way to go back to the Created state after the state has changed.</span></span>  
  
## <a name="writing-messages"></a><span data-ttu-id="1babf-187">Gravando mensagens</span><span class="sxs-lookup"><span data-stu-id="1babf-187">Writing Messages</span></span>  
 <span data-ttu-id="1babf-188">O <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> método grava o conteúdo do corpo de uma determinada `Message` instância em um determinado gravador de XML.</span><span class="sxs-lookup"><span data-stu-id="1babf-188">The <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> method writes out the body contents of a given `Message` instance to a given XML writer.</span></span> <span data-ttu-id="1babf-189">O <xref:System.ServiceModel.Channels.Message.WriteBody%2A> método faz o mesmo, exceto pelo fato de que ele inclui o conteúdo do corpo no elemento wrapper apropriado (por exemplo, <`soap:body`>).</span><span class="sxs-lookup"><span data-stu-id="1babf-189">The <xref:System.ServiceModel.Channels.Message.WriteBody%2A> method does the same, except that it encloses the body contents in the appropriate wrapper element (for example, <`soap:body`>).</span></span> <span data-ttu-id="1babf-190">Por fim, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> o grava toda a mensagem, incluindo o envelope SOAP de quebra e os cabeçalhos.</span><span class="sxs-lookup"><span data-stu-id="1babf-190">Finally, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> writes out the entire message, including the wrapping SOAP envelope and the headers.</span></span> <span data-ttu-id="1babf-191">Se SOAP está desativado ( <xref:System.ServiceModel.Channels.Message.Version> is <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType> ), todos os três métodos fazem a mesma coisa: eles gravam o conteúdo do corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-191">If SOAP is turned off (<xref:System.ServiceModel.Channels.Message.Version> is <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType>), all three methods do the same thing: they write out the message body contents.</span></span>  
  
 <span data-ttu-id="1babf-192">Por exemplo, o código a seguir grava o corpo de uma mensagem de entrada em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="1babf-192">For example, the following code writes out the body of an incoming message to a file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#5)]
 [!code-vb[C_UsingTheMessageClass#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#5)]  
  
 <span data-ttu-id="1babf-193">Dois métodos auxiliares adicionais gravam determinadas marcas de elemento de início SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-193">Two additional helper methods write out certain SOAP start element tags.</span></span> <span data-ttu-id="1babf-194">Esses métodos não acessam o corpo da mensagem e, portanto, não alteram o estado da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-194">These methods do not access the message body and so they do not change the message state.</span></span> <span data-ttu-id="1babf-195">Eles incluem:</span><span class="sxs-lookup"><span data-stu-id="1babf-195">These include:</span></span>  
  
- <span data-ttu-id="1babf-196"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A>grava o elemento do corpo inicial, por exemplo, `<soap:Body>` .</span><span class="sxs-lookup"><span data-stu-id="1babf-196"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> writes the start body element, for example, `<soap:Body>`.</span></span>  
  
- <span data-ttu-id="1babf-197"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A>grava o elemento iniciar envelope, por exemplo, `<soap:Envelope>` .</span><span class="sxs-lookup"><span data-stu-id="1babf-197"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> writes the start envelope element, for example, `<soap:Envelope>`.</span></span>  
  
 <span data-ttu-id="1babf-198">Para gravar as marcas de elemento final correspondentes, chame `WriteEndElement` o gravador de XML correspondente.</span><span class="sxs-lookup"><span data-stu-id="1babf-198">To write the corresponding end element tags, call `WriteEndElement` on the corresponding XML writer.</span></span> <span data-ttu-id="1babf-199">Esses métodos raramente são chamados diretamente.</span><span class="sxs-lookup"><span data-stu-id="1babf-199">These methods are rarely called directly.</span></span>  
  
## <a name="reading-messages"></a><span data-ttu-id="1babf-200">Lendo mensagens</span><span class="sxs-lookup"><span data-stu-id="1babf-200">Reading Messages</span></span>  
 <span data-ttu-id="1babf-201">A principal maneira de ler um corpo de mensagem é chamar <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> .</span><span class="sxs-lookup"><span data-stu-id="1babf-201">The primary way to read a message body is to call <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span></span> <span data-ttu-id="1babf-202">Você Obtém um <xref:System.Xml.XmlDictionaryReader> que pode ser usado para ler o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-202">You get back an <xref:System.Xml.XmlDictionaryReader> that you can use to read the message body.</span></span> <span data-ttu-id="1babf-203">Observe que as <xref:System.ServiceModel.Channels.Message> transições para o estado de leitura assim que <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> são chamadas, e não quando você usa o leitor XML retornado.</span><span class="sxs-lookup"><span data-stu-id="1babf-203">Note that the <xref:System.ServiceModel.Channels.Message> transitions to the Read state as soon as <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> is called, and not when you use the returned XML reader.</span></span>  
  
 <span data-ttu-id="1babf-204">O <xref:System.ServiceModel.Channels.Message.GetBody%2A> método também permite que você acesse o corpo da mensagem como um objeto tipado.</span><span class="sxs-lookup"><span data-stu-id="1babf-204">The <xref:System.ServiceModel.Channels.Message.GetBody%2A> method also enables you to access the message body as a typed object.</span></span> <span data-ttu-id="1babf-205">Internamente, esse método usa `GetReaderAtBodyContents` e, portanto, também faz a transição do estado da mensagem para o <xref:System.ServiceModel.Channels.MessageState.Read> estado (consulte a <xref:System.ServiceModel.Channels.Message.State%2A> Propriedade).</span><span class="sxs-lookup"><span data-stu-id="1babf-205">Internally, this method uses `GetReaderAtBodyContents`, and so it also transitions the message state to the <xref:System.ServiceModel.Channels.MessageState.Read> state (see the <xref:System.ServiceModel.Channels.Message.State%2A> property).</span></span>  
  
 <span data-ttu-id="1babf-206">É uma boa prática verificar a <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> Propriedade; nesse caso, o corpo da mensagem está vazio e <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> gera um <xref:System.InvalidOperationException> .</span><span class="sxs-lookup"><span data-stu-id="1babf-206">It is good practice to check the <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property, in which case the message body is empty and <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> throws an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="1babf-207">Além disso, se for uma mensagem recebida (por exemplo, a resposta), talvez você também queira verificar <xref:System.ServiceModel.Channels.Message.IsFault%2A> , que indica se a mensagem contém uma falha.</span><span class="sxs-lookup"><span data-stu-id="1babf-207">Also, if it is a received message (for example, the reply), you may also want to check <xref:System.ServiceModel.Channels.Message.IsFault%2A>, which indicates whether the message contains a fault.</span></span>  
  
 <span data-ttu-id="1babf-208">A sobrecarga mais básica de <xref:System.ServiceModel.Channels.Message.GetBody%2A> desserializa o corpo da mensagem em uma instância de um tipo (indicado pelo parâmetro genérico) usando um <xref:System.Runtime.Serialization.DataContractSerializer> configurado com as configurações padrão e com a <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> cota desabilitada.</span><span class="sxs-lookup"><span data-stu-id="1babf-208">The most basic overload of <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserializes the message body into an instance of a type (indicated by the generic parameter) using a <xref:System.Runtime.Serialization.DataContractSerializer> configured with the default settings and with the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> quota disabled.</span></span> <span data-ttu-id="1babf-209">Se você quiser usar um mecanismo de serialização diferente ou configurar o `DataContractSerializer` de forma não padrão, use a <xref:System.ServiceModel.Channels.Message.GetBody%2A> sobrecarga que usa um <xref:System.Runtime.Serialization.XmlObjectSerializer> .</span><span class="sxs-lookup"><span data-stu-id="1babf-209">If you want to use a different serialization engine, or configure the `DataContractSerializer` in a non-default way, use the <xref:System.ServiceModel.Channels.Message.GetBody%2A> overload that takes an <xref:System.Runtime.Serialization.XmlObjectSerializer>.</span></span>  
  
 <span data-ttu-id="1babf-210">Por exemplo, o código a seguir extrai dados de um corpo de mensagem que contém um `Person` objeto serializado e imprime o nome da pessoa.</span><span class="sxs-lookup"><span data-stu-id="1babf-210">For example, the following code extracts data from a message body that contains a serialized `Person` object and prints out the person’s name.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#6)]
 [!code-vb[C_UsingTheMessageClass#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#6)]  
  
## <a name="copying-a-message-into-a-buffer"></a><span data-ttu-id="1babf-211">Copiando uma mensagem em um buffer</span><span class="sxs-lookup"><span data-stu-id="1babf-211">Copying a Message into a Buffer</span></span>  
 <span data-ttu-id="1babf-212">Às vezes, é necessário acessar o corpo da mensagem mais de uma vez, por exemplo, para encaminhar a mesma mensagem a vários destinos como parte de um sistema de assinante Publicador.</span><span class="sxs-lookup"><span data-stu-id="1babf-212">Sometimes it is necessary to access the message body more than once, for example, to forward the same message to multiple destinations as part of a publisher-subscriber system.</span></span> <span data-ttu-id="1babf-213">Nesse caso, é necessário armazenar em buffer a mensagem inteira (incluindo o corpo) na memória.</span><span class="sxs-lookup"><span data-stu-id="1babf-213">In this case, it is necessary to buffer the entire message (including the body) in memory.</span></span> <span data-ttu-id="1babf-214">Você pode fazer isso chamando <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29> .</span><span class="sxs-lookup"><span data-stu-id="1babf-214">You can do this by calling <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29>.</span></span> <span data-ttu-id="1babf-215">Esse método usa um parâmetro inteiro que representa o tamanho máximo do buffer e cria um buffer que não é maior que esse tamanho.</span><span class="sxs-lookup"><span data-stu-id="1babf-215">This method takes an integer parameter that represents the maximum buffer size, and creates a buffer not larger than this size.</span></span> <span data-ttu-id="1babf-216">É importante definir isso como um valor seguro se a mensagem for proveniente de uma fonte não confiável.</span><span class="sxs-lookup"><span data-stu-id="1babf-216">It is important to set this to a safe value if the message is coming from an untrusted source.</span></span>  
  
 <span data-ttu-id="1babf-217">O buffer é retornado como uma <xref:System.ServiceModel.Channels.MessageBuffer> instância.</span><span class="sxs-lookup"><span data-stu-id="1babf-217">The buffer is returned as a <xref:System.ServiceModel.Channels.MessageBuffer> instance.</span></span> <span data-ttu-id="1babf-218">Você pode acessar dados no buffer de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="1babf-218">You can access data in the buffer in several ways.</span></span> <span data-ttu-id="1babf-219">A principal maneira é chamar <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> para criar `Message` instâncias a partir do buffer.</span><span class="sxs-lookup"><span data-stu-id="1babf-219">The primary way is to call <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> to create `Message` instances from the buffer.</span></span>  
  
 <span data-ttu-id="1babf-220">Outra maneira de acessar os dados no buffer é implementar a <xref:System.Xml.XPath.IXPathNavigable> interface que a <xref:System.ServiceModel.Channels.MessageBuffer> classe implementa para acessar o XML subjacente diretamente.</span><span class="sxs-lookup"><span data-stu-id="1babf-220">Another way to access the data in the buffer is to implement the <xref:System.Xml.XPath.IXPathNavigable> interface that the <xref:System.ServiceModel.Channels.MessageBuffer> class implements to access the underlying XML directly.</span></span> <span data-ttu-id="1babf-221">Algumas <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> sobrecargas permitem que você crie <xref:System.Xml.XPath> navegadores protegidos por uma cota de nó, limitando o número de nós XML que podem ser visitados.</span><span class="sxs-lookup"><span data-stu-id="1babf-221">Some <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> overloads allow you to create <xref:System.Xml.XPath> navigators protected by a node quota, limiting the number of XML nodes that can be visited.</span></span> <span data-ttu-id="1babf-222">Isso ajuda a evitar ataques de negação de serviço com base no tempo de processamento demorado.</span><span class="sxs-lookup"><span data-stu-id="1babf-222">This helps prevent denial of service attacks based on lengthy processing time.</span></span> <span data-ttu-id="1babf-223">Essa cotação está desabilitada por padrão.</span><span class="sxs-lookup"><span data-stu-id="1babf-223">This quote is disabled by default.</span></span> <span data-ttu-id="1babf-224">Algumas `CreateNavigator` sobrecargas permitem que você especifique como o espaço em branco deve ser manipulado no XML usando a <xref:System.Xml.XmlSpace> enumeração, com o padrão sendo `XmlSpace.None` .</span><span class="sxs-lookup"><span data-stu-id="1babf-224">Some `CreateNavigator` overloads allow you to specify how white space should be handled in the XML using the <xref:System.Xml.XmlSpace> enumeration, with the default being `XmlSpace.None`.</span></span>  
  
 <span data-ttu-id="1babf-225">Uma maneira final de acessar o conteúdo de um buffer de mensagens é gravar seu conteúdo em um fluxo usando <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> .</span><span class="sxs-lookup"><span data-stu-id="1babf-225">A final way to access the contents of a message buffer is to write out its contents to a stream using <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span></span>  
  
 <span data-ttu-id="1babf-226">O exemplo a seguir demonstra o processo de trabalhar com um `MessageBuffer` : uma mensagem de entrada é encaminhada para vários destinatários e, em seguida, registrada em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="1babf-226">The following example demonstrates the process of working with a `MessageBuffer`: an incoming message is forwarded to multiple recipients, and then logged to a file.</span></span> <span data-ttu-id="1babf-227">Sem o armazenamento em buffer, isso não é possível, porque o corpo da mensagem pode ser acessado apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="1babf-227">Without buffering, this is not possible, because the message body can then be accessed only once.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#7)]
 [!code-vb[C_UsingTheMessageClass#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#7)]  
  
 <span data-ttu-id="1babf-228">A `MessageBuffer` classe tem outros membros que vale a pena observar.</span><span class="sxs-lookup"><span data-stu-id="1babf-228">The `MessageBuffer` class has other members worth noting.</span></span> <span data-ttu-id="1babf-229">O <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> método pode ser chamado para liberar recursos quando o conteúdo do buffer não for mais necessário.</span><span class="sxs-lookup"><span data-stu-id="1babf-229">The <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> method can be called to free resources when the buffer contents are no longer required.</span></span> <span data-ttu-id="1babf-230">A <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> propriedade retorna o tamanho do buffer alocado.</span><span class="sxs-lookup"><span data-stu-id="1babf-230">The <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> property returns the size of the allocated buffer.</span></span> <span data-ttu-id="1babf-231">A <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> propriedade retorna o tipo de conteúdo MIME da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-231">The <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> property returns the MIME content type of the message.</span></span>  
  
## <a name="accessing-the-message-body-for-debugging"></a><span data-ttu-id="1babf-232">Acessando o corpo da mensagem para depuração</span><span class="sxs-lookup"><span data-stu-id="1babf-232">Accessing the Message Body for Debugging</span></span>  
 <span data-ttu-id="1babf-233">Para fins de depuração, você pode chamar o <xref:System.ServiceModel.Channels.Message.ToString%2A> método para obter uma representação da mensagem como uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="1babf-233">For debugging purposes, you can call the <xref:System.ServiceModel.Channels.Message.ToString%2A> method to get a representation of the message as a string.</span></span> <span data-ttu-id="1babf-234">Essa representação geralmente corresponde à maneira como uma mensagem examinaria a transmissão se fosse codificada com o codificador de texto, exceto que o XML seria melhor formatado para facilitar a leitura humana.</span><span class="sxs-lookup"><span data-stu-id="1babf-234">This representation generally matches the way a message would look on the wire if it were encoded with the text encoder, except that the XML would be better formatted for human readability.</span></span> <span data-ttu-id="1babf-235">A única exceção é o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-235">The one exception to this is the message body.</span></span> <span data-ttu-id="1babf-236">O corpo pode ser lido apenas uma vez e `ToString` não altera o estado da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-236">The body can be read only once, and `ToString` does not change the message state.</span></span> <span data-ttu-id="1babf-237">Portanto, o `ToString` método pode não ser capaz de acessar o corpo e pode substituir um espaço reservado (por exemplo, "..." ou três pontos) em vez do corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-237">Therefore, the `ToString` method might not be able to access the body and might substitute a placeholder (for example, "…" or three dots) instead of the message body.</span></span> <span data-ttu-id="1babf-238">Portanto, não use `ToString` o para registrar mensagens se o conteúdo do corpo das mensagens for importante.</span><span class="sxs-lookup"><span data-stu-id="1babf-238">Therefore, do not use `ToString` to log messages if the body content of the messages is important.</span></span>  
  
## <a name="accessing-other-message-parts"></a><span data-ttu-id="1babf-239">Acessando outras partes da mensagem</span><span class="sxs-lookup"><span data-stu-id="1babf-239">Accessing Other Message Parts</span></span>  
 <span data-ttu-id="1babf-240">Várias propriedades são fornecidas para acessar informações sobre a mensagem, além do conteúdo do corpo.</span><span class="sxs-lookup"><span data-stu-id="1babf-240">Various properties are provided to access information about the message other than its body contents.</span></span> <span data-ttu-id="1babf-241">No entanto, eles não podem ser chamados depois que a mensagem for fechada:</span><span class="sxs-lookup"><span data-stu-id="1babf-241">However, these cannot be called once the message has been closed:</span></span>  
  
- <span data-ttu-id="1babf-242">A <xref:System.ServiceModel.Channels.Message.Headers%2A> propriedade representa os cabeçalhos da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-242">The <xref:System.ServiceModel.Channels.Message.Headers%2A> property represents the message headers.</span></span> <span data-ttu-id="1babf-243">Consulte a seção "trabalhando com cabeçalhos" mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="1babf-243">See the section on "Working with Headers" later in this topic.</span></span>  
  
- <span data-ttu-id="1babf-244">A <xref:System.ServiceModel.Channels.Message.Properties%2A> propriedade representa as propriedades de mensagem, que são partes de dados nomeados anexados à mensagem que geralmente não são emitidas quando a mensagem é enviada.</span><span class="sxs-lookup"><span data-stu-id="1babf-244">The <xref:System.ServiceModel.Channels.Message.Properties%2A> property represents the message properties, which are pieces of named data attached to the message that do not generally get emitted when the message is sent.</span></span> <span data-ttu-id="1babf-245">Consulte a seção "trabalhando com propriedades" mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="1babf-245">See the section on "Working with Properties" later in this topic.</span></span>  
  
- <span data-ttu-id="1babf-246">A <xref:System.ServiceModel.Channels.Message.Version%2A> propriedade indica a versão SOAP e WS-Addressing associada à mensagem, ou `None` se SOAP estiver desabilitado.</span><span class="sxs-lookup"><span data-stu-id="1babf-246">The <xref:System.ServiceModel.Channels.Message.Version%2A> property indicates the SOAP and WS-Addressing version associated with the message, or `None` if SOAP is disabled.</span></span>  
  
- <span data-ttu-id="1babf-247">A <xref:System.ServiceModel.Channels.Message.IsFault%2A> propriedade retornará `true` se a mensagem for uma mensagem de falha SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-247">The <xref:System.ServiceModel.Channels.Message.IsFault%2A> property returns `true` if the message is a SOAP fault message.</span></span>  
  
- <span data-ttu-id="1babf-248">A <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> propriedade retornará `true` se a mensagem estiver vazia.</span><span class="sxs-lookup"><span data-stu-id="1babf-248">The <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property returns `true` if the message is empty.</span></span>  
  
 <span data-ttu-id="1babf-249">Você pode usar o <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> método para acessar um atributo específico no elemento wrapper do corpo (por exemplo, `<soap:Body>` ) identificado por um nome e namespace específicos.</span><span class="sxs-lookup"><span data-stu-id="1babf-249">You can use the <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> method to access a particular attribute on the body wrapper element (for example, `<soap:Body>`) identified by a particular name and namespace.</span></span> <span data-ttu-id="1babf-250">Se esse atributo não for encontrado, `null` será retornado.</span><span class="sxs-lookup"><span data-stu-id="1babf-250">If such an attribute is not found, `null` is returned.</span></span> <span data-ttu-id="1babf-251">Esse método pode ser chamado somente quando o `Message` estiver no estado criado (quando o corpo da mensagem ainda não tiver sido acessado).</span><span class="sxs-lookup"><span data-stu-id="1babf-251">This method can be called only when the `Message` is in the Created state (when the message body has not yet been accessed).</span></span>  
  
## <a name="working-with-headers"></a><span data-ttu-id="1babf-252">Trabalhando com cabeçalhos</span><span class="sxs-lookup"><span data-stu-id="1babf-252">Working with Headers</span></span>  
 <span data-ttu-id="1babf-253">Um `Message` pode conter qualquer número de fragmentos de XML nomeados, chamados *cabeçalhos*.</span><span class="sxs-lookup"><span data-stu-id="1babf-253">A `Message` can contain any number of named XML fragments, called *headers*.</span></span> <span data-ttu-id="1babf-254">Cada fragmento normalmente é mapeado para um cabeçalho SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-254">Each fragment normally maps to a SOAP header.</span></span> <span data-ttu-id="1babf-255">Os cabeçalhos são acessados por meio da `Headers` Propriedade do tipo <xref:System.ServiceModel.Channels.MessageHeaders> .</span><span class="sxs-lookup"><span data-stu-id="1babf-255">Headers are accessed through the `Headers` property of type <xref:System.ServiceModel.Channels.MessageHeaders>.</span></span> <span data-ttu-id="1babf-256"><xref:System.ServiceModel.Channels.MessageHeaders>é uma coleção de <xref:System.ServiceModel.Channels.MessageHeaderInfo> objetos, e cabeçalhos individuais podem ser acessados por meio de sua <xref:System.Collections.IEnumerable> interface ou por meio de seu indexador.</span><span class="sxs-lookup"><span data-stu-id="1babf-256"><xref:System.ServiceModel.Channels.MessageHeaders> is a collection of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects, and individual headers can be accessed through its <xref:System.Collections.IEnumerable> interface or through its indexer.</span></span> <span data-ttu-id="1babf-257">Por exemplo, o código a seguir lista os nomes de todos os cabeçalhos em um `Message` .</span><span class="sxs-lookup"><span data-stu-id="1babf-257">For example, the following code lists the names of all the headers in a `Message`.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#8)]
 [!code-vb[C_UsingTheMessageClass#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#8)]  
  
#### <a name="adding-removing-finding-headers"></a><span data-ttu-id="1babf-258">Adicionando, removendo, localizando cabeçalhos</span><span class="sxs-lookup"><span data-stu-id="1babf-258">Adding, Removing, Finding Headers</span></span>  
 <span data-ttu-id="1babf-259">Você pode adicionar um novo cabeçalho ao final de todos os cabeçalhos existentes usando o <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A> método.</span><span class="sxs-lookup"><span data-stu-id="1babf-259">You can add a new header at the end of all existing headers using the <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A> method.</span></span> <span data-ttu-id="1babf-260">Você pode usar o <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> método para inserir um cabeçalho em um índice específico.</span><span class="sxs-lookup"><span data-stu-id="1babf-260">You can use the <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> method to insert a header at a particular index.</span></span> <span data-ttu-id="1babf-261">Os cabeçalhos existentes são deslocados para o item inserido.</span><span class="sxs-lookup"><span data-stu-id="1babf-261">Existing headers are shifted for the inserted item.</span></span> <span data-ttu-id="1babf-262">Os cabeçalhos são ordenados de acordo com seu índice e o primeiro índice disponível é 0.</span><span class="sxs-lookup"><span data-stu-id="1babf-262">Headers are ordered according to their index, and the first available index is 0.</span></span> <span data-ttu-id="1babf-263">Você pode usar as várias <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> sobrecargas de método para adicionar cabeçalhos de uma `Message` instância diferente ou `MessageHeaders` .</span><span class="sxs-lookup"><span data-stu-id="1babf-263">You can use the various <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> method overloads to add headers from a different `Message` or `MessageHeaders` instance.</span></span> <span data-ttu-id="1babf-264">Algumas sobrecargas copiam um cabeçalho individual, enquanto outros copiam todos eles.</span><span class="sxs-lookup"><span data-stu-id="1babf-264">Some overloads copy one individual header, while others copy all of them.</span></span> <span data-ttu-id="1babf-265">O <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> método remove todos os cabeçalhos.</span><span class="sxs-lookup"><span data-stu-id="1babf-265">The <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> method removes all headers.</span></span> <span data-ttu-id="1babf-266">O <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> método Remove um cabeçalho em um índice específico (deslocando todos os cabeçalhos depois dele).</span><span class="sxs-lookup"><span data-stu-id="1babf-266">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> method removes a header at a particular index (shifting all headers after it).</span></span> <span data-ttu-id="1babf-267">O <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> método remove todos os cabeçalhos com um nome e namespace específicos.</span><span class="sxs-lookup"><span data-stu-id="1babf-267">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> method removes all headers with a particular name and namespace.</span></span>  
  
 <span data-ttu-id="1babf-268">Recupere um cabeçalho específico usando o <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A> método.</span><span class="sxs-lookup"><span data-stu-id="1babf-268">Retrieve a particular header using the <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A> method.</span></span> <span data-ttu-id="1babf-269">Esse método usa o nome e o namespace do cabeçalho para localizar e retorna seu índice.</span><span class="sxs-lookup"><span data-stu-id="1babf-269">This method takes the name and namespace of the header to find, and returns its index.</span></span> <span data-ttu-id="1babf-270">Se o cabeçalho ocorrer mais de uma vez, uma exceção será lançada.</span><span class="sxs-lookup"><span data-stu-id="1babf-270">If the header occurs more than once, an exception is thrown.</span></span> <span data-ttu-id="1babf-271">Se o cabeçalho não for encontrado, ele retornará-1.</span><span class="sxs-lookup"><span data-stu-id="1babf-271">If the header is not found, it returns -1.</span></span>  
  
 <span data-ttu-id="1babf-272">No modelo de cabeçalho SOAP, os cabeçalhos podem ter um `Actor` valor que especifica o destinatário pretendido do cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="1babf-272">In the SOAP header model, headers can have an `Actor` value that specifies the intended recipient of the header.</span></span> <span data-ttu-id="1babf-273">A sobrecarga mais básica `FindHeader` procura somente os cabeçalhos destinados ao receptor final da mensagem.</span><span class="sxs-lookup"><span data-stu-id="1babf-273">The most basic `FindHeader` overload searches only headers intended for the ultimate receiver of the message.</span></span> <span data-ttu-id="1babf-274">No entanto, outra sobrecarga permite que você especifique quais `Actor` valores serão incluídos na pesquisa.</span><span class="sxs-lookup"><span data-stu-id="1babf-274">However, another overload enables you to specify which `Actor` values are included in the search.</span></span> <span data-ttu-id="1babf-275">Para obter mais informações, consulte a especificação SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-275">For more information, see the SOAP specification.</span></span>  
  
 <span data-ttu-id="1babf-276">Um <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> método é fornecido para copiar cabeçalhos de uma <xref:System.ServiceModel.Channels.MessageHeaders> coleção para uma matriz de <xref:System.ServiceModel.Channels.MessageHeaderInfo> objetos.</span><span class="sxs-lookup"><span data-stu-id="1babf-276">A <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> method is provided to copy headers from a <xref:System.ServiceModel.Channels.MessageHeaders> collection to an array of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects.</span></span>  
  
 <span data-ttu-id="1babf-277">Para acessar os dados XML em um cabeçalho, você pode chamar <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> e retornar um leitor de XML para o índice de cabeçalho específico.</span><span class="sxs-lookup"><span data-stu-id="1babf-277">To access the XML data in a header, you can call <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> and return an XML reader for the specific header index.</span></span> <span data-ttu-id="1babf-278">Se você quiser desserializar o conteúdo do cabeçalho em um objeto, use <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> ou uma das outras sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="1babf-278">If you want to deserialize the header contents into an object, use <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> or one of the other overloads.</span></span> <span data-ttu-id="1babf-279">As sobrecargas mais básicas desserializam cabeçalhos usando o <xref:System.Runtime.Serialization.DataContractSerializer> configurado da maneira padrão.</span><span class="sxs-lookup"><span data-stu-id="1babf-279">The most basic overloads deserialize headers using the <xref:System.Runtime.Serialization.DataContractSerializer> configured in the default way.</span></span> <span data-ttu-id="1babf-280">Se você quiser usar um serializador diferente ou uma configuração diferente do `DataContractSerializer` , use uma das sobrecargas que usam um `XmlObjectSerializer` .</span><span class="sxs-lookup"><span data-stu-id="1babf-280">If you want to use a different serializer or a different configuration of the `DataContractSerializer`, use one of the overloads that take an `XmlObjectSerializer`.</span></span> <span data-ttu-id="1babf-281">Também há sobrecargas que usam o nome do cabeçalho, o namespace e, opcionalmente, uma lista de `Actor` valores em vez de um índice; essa é uma combinação de `FindHeader` e `GetHeader` .</span><span class="sxs-lookup"><span data-stu-id="1babf-281">There are also overloads that take the header name, namespace, and optionally a list of `Actor` values instead of an index; this is a combination of `FindHeader` and `GetHeader`.</span></span>  
  
## <a name="working-with-properties"></a><span data-ttu-id="1babf-282">Trabalhando com propriedades</span><span class="sxs-lookup"><span data-stu-id="1babf-282">Working with Properties</span></span>  
 <span data-ttu-id="1babf-283">Uma `Message` instância pode conter um número arbitrário de objetos nomeados de tipos arbitrários.</span><span class="sxs-lookup"><span data-stu-id="1babf-283">A `Message` instance can contain an arbitrary number of named objects of arbitrary types.</span></span> <span data-ttu-id="1babf-284">Essa coleção é acessada por meio da `Properties` Propriedade do tipo `MessageProperties` .</span><span class="sxs-lookup"><span data-stu-id="1babf-284">This collection is accessed through the `Properties` property of type `MessageProperties`.</span></span> <span data-ttu-id="1babf-285">A coleção implementa a <xref:System.Collections.Generic.IDictionary%602> interface e atua como um mapeamento de <xref:System.String> para <xref:System.Object> .</span><span class="sxs-lookup"><span data-stu-id="1babf-285">The collection implements the <xref:System.Collections.Generic.IDictionary%602> interface and acts as a mapping from <xref:System.String> to <xref:System.Object>.</span></span> <span data-ttu-id="1babf-286">Normalmente, os valores de propriedade não são mapeados diretamente para qualquer parte da mensagem na conexão, mas fornecem várias dicas de processamento de mensagens para os vários canais na pilha de canais do WCF ou para a <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> estrutura de serviço.</span><span class="sxs-lookup"><span data-stu-id="1babf-286">Normally, property values do not map directly to any part of the message on the wire, but rather provide various message processing hints to the various channels in the WCF channel stack or to the <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> service framework.</span></span> <span data-ttu-id="1babf-287">Para obter um exemplo, consulte [visão geral da arquitetura de transferência de dados](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1babf-287">For an example, see [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
## <a name="inheriting-from-the-message-class"></a><span data-ttu-id="1babf-288">Herdando da classe Message</span><span class="sxs-lookup"><span data-stu-id="1babf-288">Inheriting from the Message Class</span></span>  
 <span data-ttu-id="1babf-289">Se os tipos de mensagem internos criados usando `CreateMessage` o não atenderem aos seus requisitos, crie uma classe derivada da `Message` classe.</span><span class="sxs-lookup"><span data-stu-id="1babf-289">If the built-in message types created using `CreateMessage` do not meet your requirements, create a class that derives from the `Message` class.</span></span>  
  
### <a name="defining-the-message-body-contents"></a><span data-ttu-id="1babf-290">Definindo o conteúdo do corpo da mensagem</span><span class="sxs-lookup"><span data-stu-id="1babf-290">Defining the Message Body Contents</span></span>  
 <span data-ttu-id="1babf-291">Existem três técnicas principais para acessar dados dentro de um corpo de mensagem: gravando, lendo e copiando-a em um buffer.</span><span class="sxs-lookup"><span data-stu-id="1babf-291">Three primary techniques exist for accessing data within a message body: writing, reading, and copying it to a buffer.</span></span> <span data-ttu-id="1babf-292">Em última análise, essas operações resultam nos <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A> métodos, e <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> que estão sendo chamados, respectivamente, na classe derivada de `Message` .</span><span class="sxs-lookup"><span data-stu-id="1babf-292">These operations ultimately result in the <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A>, and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods being called, respectively, on your derived class of `Message`.</span></span> <span data-ttu-id="1babf-293">A `Message` classe base garante que apenas um desses métodos seja chamado para cada `Message` instância e que não seja chamado mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="1babf-293">The base `Message` class guarantees that only one of these methods is called for each `Message` instance, and that it is not called more than once.</span></span> <span data-ttu-id="1babf-294">A classe base também garante que os métodos não sejam chamados em uma mensagem fechada.</span><span class="sxs-lookup"><span data-stu-id="1babf-294">The base class also ensures that the methods are not called on a closed message.</span></span> <span data-ttu-id="1babf-295">Não é necessário acompanhar o estado da mensagem em sua implementação.</span><span class="sxs-lookup"><span data-stu-id="1babf-295">There is no need to track the message state in your implementation.</span></span>  
  
 <span data-ttu-id="1babf-296"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>é um método abstrato e deve ser implementado.</span><span class="sxs-lookup"><span data-stu-id="1babf-296"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> is an abstract method and must be implemented.</span></span> <span data-ttu-id="1babf-297">A maneira mais básica de definir o conteúdo do corpo de sua mensagem é escrever usando esse método.</span><span class="sxs-lookup"><span data-stu-id="1babf-297">The most basic way to define the body contents of your message is to write using this method.</span></span> <span data-ttu-id="1babf-298">Por exemplo, a seguinte mensagem contém 100.000 números aleatórios de 1 a 20.</span><span class="sxs-lookup"><span data-stu-id="1babf-298">For example, the following message contains 100,000 random numbers from 1 to 20.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#9)]
 [!code-vb[C_UsingTheMessageClass#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#9)]  
  
 <span data-ttu-id="1babf-299">Os <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> métodos e têm implementações padrão que funcionam na maioria dos casos.</span><span class="sxs-lookup"><span data-stu-id="1babf-299">The <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods have default implementations that work for most cases.</span></span> <span data-ttu-id="1babf-300">As implementações padrão chamam <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> , armazenam em buffer os resultados e funcionam com o buffer resultante.</span><span class="sxs-lookup"><span data-stu-id="1babf-300">The default implementations call <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, buffer the results, and work with the resulting buffer.</span></span> <span data-ttu-id="1babf-301">No entanto, em alguns casos, isso pode não ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="1babf-301">However, in some cases this may not be enough.</span></span> <span data-ttu-id="1babf-302">No exemplo anterior, a leitura dos resultados da mensagem em 100.000 elementos XML estão sendo armazenados em buffer, o que pode não ser desejável.</span><span class="sxs-lookup"><span data-stu-id="1babf-302">In the preceding example, reading the message results in 100,000 XML elements being buffered, which might not be desirable.</span></span> <span data-ttu-id="1babf-303">Talvez você queira substituir <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> para retornar uma <xref:System.Xml.XmlDictionaryReader> classe derivada personalizada que atenda a números aleatórios.</span><span class="sxs-lookup"><span data-stu-id="1babf-303">You might want to override <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> to return a custom <xref:System.Xml.XmlDictionaryReader> derived class that serves up random numbers.</span></span> <span data-ttu-id="1babf-304">Em seguida, você pode substituir <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> para usar o leitor que o <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> método retorna, como mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="1babf-304">You can then override <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> to use the reader that the <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> method returns, as shown in the following example.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#10)]
 [!code-vb[C_UsingTheMessageClass#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#10)]  
  
 <span data-ttu-id="1babf-305">Da mesma forma, talvez você queira substituir `OnCreateBufferedCopy` para retornar sua própria `MessageBuffer` classe derivada.</span><span class="sxs-lookup"><span data-stu-id="1babf-305">Similarly, you might want to override `OnCreateBufferedCopy` to return your own `MessageBuffer` derived class.</span></span>  
  
 <span data-ttu-id="1babf-306">Além de fornecer o conteúdo do corpo da mensagem, sua classe derivada de mensagem também deve substituir as `Version` `Headers` Propriedades, e `Properties` .</span><span class="sxs-lookup"><span data-stu-id="1babf-306">In addition to providing message body contents, your message derived class must also override the `Version`, `Headers`, and `Properties` properties.</span></span>  
  
 <span data-ttu-id="1babf-307">Observe que, se você criar uma cópia de uma mensagem, a cópia usará os cabeçalhos de mensagem do original.</span><span class="sxs-lookup"><span data-stu-id="1babf-307">Note that if you create a copy of a message, the copy uses the message headers from the original.</span></span>  
  
### <a name="other-members-that-can-be-overridden"></a><span data-ttu-id="1babf-308">Outros membros que podem ser substituídos</span><span class="sxs-lookup"><span data-stu-id="1babf-308">Other Members that Can Be Overridden</span></span>  
 <span data-ttu-id="1babf-309">Você pode substituir os <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A> <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> métodos, e <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> para especificar como as marcas de início de envelope SOAP, cabeçalhos SOAP e elemento de corpo SOAP são gravadas. Normalmente, eles correspondem a `<soap:Envelope>` , `<soap:Header>` , e `<soap:Body>` .</span><span class="sxs-lookup"><span data-stu-id="1babf-309">You can override the <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> methods to specify how the SOAP envelope, SOAP headers, and SOAP body element start tags are written out. These normally correspond to `<soap:Envelope>`, `<soap:Header>`, and `<soap:Body>`.</span></span> <span data-ttu-id="1babf-310">Esses métodos normalmente não devem gravar nada se a <xref:System.ServiceModel.Channels.Message.Version> Propriedade retornar <xref:System.ServiceModel.Channels.MessageVersion.None> .</span><span class="sxs-lookup"><span data-stu-id="1babf-310">These methods should normally not write anything out if the <xref:System.ServiceModel.Channels.Message.Version> property returns <xref:System.ServiceModel.Channels.MessageVersion.None>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1babf-311">A implementação padrão de `OnGetReaderAtBodyContents` chamadas `OnWriteStartEnvelope` e `OnWriteStartBody` antes `OnWriteBodyContents` de chamar e armazenar em buffer os resultados.</span><span class="sxs-lookup"><span data-stu-id="1babf-311">The default implementation of `OnGetReaderAtBodyContents` calls `OnWriteStartEnvelope` and `OnWriteStartBody` before calling `OnWriteBodyContents` and buffering the results.</span></span> <span data-ttu-id="1babf-312">Os cabeçalhos não são gravados.</span><span class="sxs-lookup"><span data-stu-id="1babf-312">Headers are not written out.</span></span>  
  
 <span data-ttu-id="1babf-313">Substitua o <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> método para alterar a forma como a mensagem inteira é construída a partir de suas várias partes.</span><span class="sxs-lookup"><span data-stu-id="1babf-313">Override the <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> method to change the way the entire message is constructed from its various pieces.</span></span> <span data-ttu-id="1babf-314">O `OnWriteMessage` método é chamado de <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> e da implementação padrão <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> .</span><span class="sxs-lookup"><span data-stu-id="1babf-314">The `OnWriteMessage` method is called from <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> and from the default <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> implementation.</span></span> <span data-ttu-id="1babf-315">Observe que a substituição <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> não é uma prática recomendada.</span><span class="sxs-lookup"><span data-stu-id="1babf-315">Note that overriding <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> is not a best practice.</span></span> <span data-ttu-id="1babf-316">É melhor substituir os `On` métodos apropriados (por exemplo,, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A> <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> e <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A> .</span><span class="sxs-lookup"><span data-stu-id="1babf-316">It is better to override the appropriate `On` methods (for example, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span></span>  
  
 <span data-ttu-id="1babf-317">Substitua <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> para substituir como o corpo da mensagem é representado durante a depuração.</span><span class="sxs-lookup"><span data-stu-id="1babf-317">Override <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> to override how your message body is represented during debugging.</span></span> <span data-ttu-id="1babf-318">O padrão é representá-lo como três pontos ("...").</span><span class="sxs-lookup"><span data-stu-id="1babf-318">The default is to represent it as three dots ("…").</span></span> <span data-ttu-id="1babf-319">Observe que esse método pode ser chamado várias vezes quando o estado da mensagem é algo diferente de Closed.</span><span class="sxs-lookup"><span data-stu-id="1babf-319">Note that this method can be called multiple times when the message state is anything other than Closed.</span></span> <span data-ttu-id="1babf-320">Uma implementação desse método nunca deve causar nenhuma ação que deve ser executada apenas uma vez (como a leitura de um fluxo de somente encaminhamento).</span><span class="sxs-lookup"><span data-stu-id="1babf-320">An implementation of this method should never cause any action that must be performed only once (such as reading from a forward-only stream).</span></span>  
  
 <span data-ttu-id="1babf-321">Substitua o <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> método para permitir o acesso a atributos no elemento de corpo SOAP.</span><span class="sxs-lookup"><span data-stu-id="1babf-321">Override the <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> method to allow access to attributes on the SOAP body element.</span></span> <span data-ttu-id="1babf-322">Esse método pode ser chamado quantas vezes, mas o `Message` tipo base garante que ele seja chamado apenas quando a mensagem estiver no estado criado.</span><span class="sxs-lookup"><span data-stu-id="1babf-322">This method can be called any number of times, but the `Message` base type guarantees that it is only called when the message is in the Created state.</span></span> <span data-ttu-id="1babf-323">Não é necessário verificar o estado em uma implementação.</span><span class="sxs-lookup"><span data-stu-id="1babf-323">It is not required to check the state in an implementation.</span></span> <span data-ttu-id="1babf-324">A implementação padrão sempre retorna `null` , o que indica que não há atributos no elemento body.</span><span class="sxs-lookup"><span data-stu-id="1babf-324">The default implementation always returns `null`, which indicates that there are no attributes on the body element.</span></span>  
  
 <span data-ttu-id="1babf-325">Se o `Message` objeto precisar fazer qualquer limpeza especial quando o corpo da mensagem não for mais necessário, você poderá substituir <xref:System.ServiceModel.Channels.Message.OnClose%2A> .</span><span class="sxs-lookup"><span data-stu-id="1babf-325">If your `Message` object must do any special cleanup when the message body is no longer required, you can override <xref:System.ServiceModel.Channels.Message.OnClose%2A>.</span></span> <span data-ttu-id="1babf-326">A implementação padrão não faz nada.</span><span class="sxs-lookup"><span data-stu-id="1babf-326">The default implementation does nothing.</span></span>  
  
 <span data-ttu-id="1babf-327">As `IsEmpty` `IsFault` Propriedades e podem ser substituídas.</span><span class="sxs-lookup"><span data-stu-id="1babf-327">The `IsEmpty` and `IsFault` properties can be overridden.</span></span> <span data-ttu-id="1babf-328">Por padrão, ambos retornam `false` .</span><span class="sxs-lookup"><span data-stu-id="1babf-328">By default, both return `false`.</span></span>
