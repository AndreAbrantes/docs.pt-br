---
title: Considerações de segurança para dados
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a7eb98da-4a93-4692-8b59-9d670c79ffb2
ms.openlocfilehash: 13e596ea64fc62ed6280e74636243619178ce069
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61990880"
---
# <a name="security-considerations-for-data"></a><span data-ttu-id="6b95c-102">Considerações de segurança para dados</span><span class="sxs-lookup"><span data-stu-id="6b95c-102">Security Considerations for Data</span></span>

<span data-ttu-id="6b95c-103">Ao lidar com dados no Windows Communication Foundation (WCF), você deve considerar um número de categorias de ameaça.</span><span class="sxs-lookup"><span data-stu-id="6b95c-103">When dealing with data in Windows Communication Foundation (WCF), you must consider a number of threat categories.</span></span> <span data-ttu-id="6b95c-104">A tabela a seguir lista as classes de ameaças mais importantes relacionados ao processamento de dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-104">The following table lists the most important threat classes that relate to data processing.</span></span> <span data-ttu-id="6b95c-105">O WCF fornece ferramentas para atenuar essas ameaças.</span><span class="sxs-lookup"><span data-stu-id="6b95c-105">WCF provides tools to mitigate these threats.</span></span>

<span data-ttu-id="6b95c-106">Negação de serviço durante o recebimento de dados não confiáveis, os dados podem causar o lado de recebimento acessar uma quantidade desproporcional de vários recursos, como memória, threads, conexões disponíveis ou ciclos de processador, fazendo com que as computações longas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-106">Denial of service When receiving untrusted data, the data may cause the receiving side to access a disproportionate amount of various resources, such as memory, threads, available connections, or processor cycles by causing lengthy computations.</span></span> <span data-ttu-id="6b95c-107">Um ataque de negação de serviço contra um servidor pode causar a falhar e ser capaz de processar mensagens de clientes de outros e legítimos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-107">A denial-of-service attack against a server may cause it to crash and be unable to process messages from other, legitimate clients.</span></span>

<span data-ttu-id="6b95c-108">Execução de código mal-intencionado dados faz com que o lado de recebimento executar código não confiável para entrada ele não pretendia.</span><span class="sxs-lookup"><span data-stu-id="6b95c-108">Malicious code execution Incoming untrusted data causes the receiving side to run code it did not intend to.</span></span>

<span data-ttu-id="6b95c-109">O invasor remoto de divulgação de informações força a parte destinatária para responder a solicitações de maneira a divulgar informações mais do que pretende.</span><span class="sxs-lookup"><span data-stu-id="6b95c-109">Information disclosure The remote attacker forces the receiving party to respond to its requests in such a way as to disclose more information than it intends to.</span></span>

## <a name="user-provided-code-and-code-access-security"></a><span data-ttu-id="6b95c-110">Código fornecido pelo usuário e segurança de acesso do código</span><span class="sxs-lookup"><span data-stu-id="6b95c-110">User-Provided Code and Code Access Security</span></span>

<span data-ttu-id="6b95c-111">Um número de lugares na infraestrutura do Windows Communication Foundation (WCF), executar o código que é fornecido pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="6b95c-111">A number of places in the Windows Communication Foundation (WCF) infrastructure run code that is provided by the user.</span></span> <span data-ttu-id="6b95c-112">Por exemplo, o <xref:System.Runtime.Serialization.DataContractSerializer> mecanismo de serialização pode chamar a propriedade fornecida pelo usuário `set` acessadores e `get` acessadores.</span><span class="sxs-lookup"><span data-stu-id="6b95c-112">For example, the <xref:System.Runtime.Serialization.DataContractSerializer> serialization engine may call user-provided property `set` accessors and `get` accessors.</span></span> <span data-ttu-id="6b95c-113">A infra-estrutura de canal WCF também pode chamar em classes derivadas fornecido pelo usuário da <xref:System.ServiceModel.Channels.Message> classe.</span><span class="sxs-lookup"><span data-stu-id="6b95c-113">The WCF channel infrastructure may also call into user-provided derived classes of the <xref:System.ServiceModel.Channels.Message> class.</span></span>

<span data-ttu-id="6b95c-114">É responsabilidade do autor do código para garantir que nenhuma vulnerabilidade de segurança existe.</span><span class="sxs-lookup"><span data-stu-id="6b95c-114">It is the responsibility of the code author to ensure that no security vulnerabilities exist.</span></span> <span data-ttu-id="6b95c-115">Por exemplo, se você criar um contrato de dados tipo com uma propriedade de membro de dados do tipo inteiro e, no `set` implementação do acessador alocar uma matriz com base no valor da propriedade, você expõe a possibilidade de um ataque de negação de serviço, se um mal-intencionado mensagem contém um valor muito grande para este membro de dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-115">For example, if you create a data contract type with a data member property of type integer, and in the `set` accessor implementation allocate an array based on the property value, you expose the possibility of a denial-of-service attack if a malicious message contains an extremely large value for this data member.</span></span> <span data-ttu-id="6b95c-116">Em geral, evite qualquer alocação com base nos dados de entrada ou extenso de processamento no código fornecido pelo usuário (especialmente se o processamento mais extenso pode ser causado por uma pequena quantidade de dados de entrada).</span><span class="sxs-lookup"><span data-stu-id="6b95c-116">In general, avoid any allocations based on incoming data or lengthy processing in user-provided code (especially if lengthy processing can be caused by a small amount of incoming data).</span></span> <span data-ttu-id="6b95c-117">Ao executar a análise de segurança de código fornecido pelo usuário, certifique-se também considerar todos os casos de falha (ou seja, todas as ramificações do código em que as exceções são geradas).</span><span class="sxs-lookup"><span data-stu-id="6b95c-117">When performing security analysis of user-provided code, make sure to also consider all failure cases (that is, all code branches where exceptions are thrown).</span></span>

<span data-ttu-id="6b95c-118">O exemplo de código fornecido pelo usuário a ultimate é o código dentro de sua implementação de serviço para cada operação.</span><span class="sxs-lookup"><span data-stu-id="6b95c-118">The ultimate example of user-provided code is the code inside your service implementation for each operation.</span></span> <span data-ttu-id="6b95c-119">A segurança de sua implementação de serviço é sua responsabilidade.</span><span class="sxs-lookup"><span data-stu-id="6b95c-119">The security of your service implementation is your responsibility.</span></span> <span data-ttu-id="6b95c-120">É fácil criar inadvertidamente as implementações de operação não segura que podem resultar em vulnerabilidades de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-120">It is easy to inadvertently create insecure operation implementations that may result in denial-of-service vulnerabilities.</span></span> <span data-ttu-id="6b95c-121">Por exemplo, uma operação que usa uma cadeia de caracteres e retorna a lista de clientes de um banco de dados cujo nome começa com essa cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="6b95c-121">For example, an operation that takes a string and returns the list of customers from a database whose name starts with that string.</span></span> <span data-ttu-id="6b95c-122">Se você estiver trabalhando com um banco de dados grande e a cadeia de caracteres que está sendo passada é apenas uma única letra, seu código pode tentar criar uma mensagem maior que toda a memória disponível, fazendo com que todo o serviço falhe.</span><span class="sxs-lookup"><span data-stu-id="6b95c-122">If you are working with a large database and the string being passed is just a single letter, your code may attempt to create a message larger than all available memory, causing the entire service to fail.</span></span> <span data-ttu-id="6b95c-123">(Um <xref:System.OutOfMemoryException> não é recuperável no [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] e sempre resulta no encerramento do aplicativo.)</span><span class="sxs-lookup"><span data-stu-id="6b95c-123">(An <xref:System.OutOfMemoryException> is not recoverable in the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] and always results in the termination of your application.)</span></span>

<span data-ttu-id="6b95c-124">Você deve garantir que nenhum código mal-intencionado está conectado a vários pontos de extensibilidade.</span><span class="sxs-lookup"><span data-stu-id="6b95c-124">You should ensure that no malicious code is plugged in to the various extensibility points.</span></span> <span data-ttu-id="6b95c-125">Isso é especialmente relevante ao executar em confiança parcial, lidando com tipos de assemblies de confiança parcial, ou criando componentes utilizável por código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-125">This is especially relevant when running under partial trust, dealing with types from partially-trusted assemblies, or creating components usable by partially-trusted code.</span></span> <span data-ttu-id="6b95c-126">Para obter mais informações, consulte "Ameaças de confiança parcial" em uma seção posterior.</span><span class="sxs-lookup"><span data-stu-id="6b95c-126">For more information, see "Partial Trust Threats" in a later section.</span></span>

<span data-ttu-id="6b95c-127">Observe que, quando em execução em confiança parcial, a infraestrutura de serialização do contrato de dados oferece suporte a apenas um subconjunto limitado de dados contrato do modelo de programação – por exemplo, membros de dados particulares ou tipos usando o <xref:System.SerializableAttribute> não há suporte para o atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-127">Note that when running in partial trust, the data contract serialization infrastructure supports only a limited subset of the data contract programming model - for example, private data members or types using the <xref:System.SerializableAttribute> attribute are not supported.</span></span> <span data-ttu-id="6b95c-128">Para obter mais informações, consulte [confiança parcial](../../../../docs/framework/wcf/feature-details/partial-trust.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-128">For more information, see [Partial Trust](../../../../docs/framework/wcf/feature-details/partial-trust.md).</span></span>

## <a name="avoiding-unintentional-information-disclosure"></a><span data-ttu-id="6b95c-129">Evitar a divulgação não intencional de informações</span><span class="sxs-lookup"><span data-stu-id="6b95c-129">Avoiding Unintentional Information Disclosure</span></span>

<span data-ttu-id="6b95c-130">Ao projetar tipos serializáveis com segurança em mente, divulgação de informações é uma preocupação possíveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-130">When designing serializable types with security in mind, information disclosure is a possible concern.</span></span>

<span data-ttu-id="6b95c-131">Considere os seguintes pontos:</span><span class="sxs-lookup"><span data-stu-id="6b95c-131">Consider the following points:</span></span>

- <span data-ttu-id="6b95c-132">O <xref:System.Runtime.Serialization.DataContractSerializer> modelo de programação permite a exposição de dados privados e internos fora do tipo ou assembly durante a serialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-132">The <xref:System.Runtime.Serialization.DataContractSerializer> programming model allows the exposure of private and internal data outside of the type or assembly during serialization.</span></span> <span data-ttu-id="6b95c-133">Além disso, a forma de um tipo pode ser exposta durante a exportação de esquema.</span><span class="sxs-lookup"><span data-stu-id="6b95c-133">Additionally, the shape of a type can be exposed during schema export.</span></span> <span data-ttu-id="6b95c-134">Certifique-se de entender a projeção de serialização do tipo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-134">Be sure to understand your type's serialization projection.</span></span> <span data-ttu-id="6b95c-135">Se você não quiser que qualquer coisa exposta, desabilitar serializá-lo (por exemplo, por não aplicação de <xref:System.Runtime.Serialization.DataMemberAttribute> atributo no caso de um contrato de dados).</span><span class="sxs-lookup"><span data-stu-id="6b95c-135">If you do not want anything exposed, disable serializing it (for example, by not applying the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute in the case of a data contract).</span></span>

- <span data-ttu-id="6b95c-136">Lembre-se de que o mesmo tipo pode ter várias projeções de serialização, dependendo do serializador em uso.</span><span class="sxs-lookup"><span data-stu-id="6b95c-136">Be aware that the same type may have multiple serialization projections, depending on the serializer in use.</span></span> <span data-ttu-id="6b95c-137">O mesmo tipo pode expor um conjunto de dados quando usado com o <xref:System.Runtime.Serialization.DataContractSerializer> e outro conjunto de dados quando usado com o <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-137">The same type may expose one set of data when used with the <xref:System.Runtime.Serialization.DataContractSerializer> and another set of data when used with the <xref:System.Xml.Serialization.XmlSerializer>.</span></span> <span data-ttu-id="6b95c-138">Acidentalmente usar o serializador errado pode levar à divulgação de informações.</span><span class="sxs-lookup"><span data-stu-id="6b95c-138">Accidentally using the wrong serializer may lead to information disclosure.</span></span>

- <span data-ttu-id="6b95c-139">Usando o <xref:System.Xml.Serialization.XmlSerializer> herdados procedimento remoto (RPC) de chamar / modo codificado pode sem querer expor a forma do grafo do objeto no lado de envio para o lado de recebimento.</span><span class="sxs-lookup"><span data-stu-id="6b95c-139">Using the <xref:System.Xml.Serialization.XmlSerializer> in legacy remote procedure call (RPC)/encoded mode may unintentionally expose the shape of the object graph on the sending side to the receiving side.</span></span>

## <a name="preventing-denial-of-service-attacks"></a><span data-ttu-id="6b95c-140">Impedindo ataques de negação de serviço</span><span class="sxs-lookup"><span data-stu-id="6b95c-140">Preventing Denial-of-Service Attacks</span></span>

### <a name="quotas"></a><span data-ttu-id="6b95c-141">Cotas</span><span class="sxs-lookup"><span data-stu-id="6b95c-141">Quotas</span></span>

<span data-ttu-id="6b95c-142">Fazendo com que o lado de recebimento alocar uma quantidade significativa de memória é um potencial ataque de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-142">Causing the receiving side to allocate a significant amount of memory is a potential denial-of-service attack.</span></span> <span data-ttu-id="6b95c-143">Embora esta seção se concentra em problemas de consumo de memória resultantes de mensagens grandes, podem ocorrer outros ataques.</span><span class="sxs-lookup"><span data-stu-id="6b95c-143">While this section concentrates on memory consumption issues arising from large messages, other attacks may occur.</span></span> <span data-ttu-id="6b95c-144">Por exemplo, as mensagens podem usar uma quantidade desproporcional de tempo de processamento.</span><span class="sxs-lookup"><span data-stu-id="6b95c-144">For example, messages may use a disproportionate amount of processing time.</span></span>

<span data-ttu-id="6b95c-145">Ataques de negação de serviço geralmente são atenuados com o uso de cotas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-145">Denial-of-service attacks are usually mitigated using quotas.</span></span> <span data-ttu-id="6b95c-146">Quando uma cota for ultrapassada, um <xref:System.ServiceModel.QuotaExceededException> exceção normalmente é lançada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-146">When a quota is exceeded, a <xref:System.ServiceModel.QuotaExceededException> exception is normally thrown.</span></span> <span data-ttu-id="6b95c-147">Sem a cota, uma mensagem mal-intencionada pode fazer com que toda a memória disponível ser acessado, resultando em uma <xref:System.OutOfMemoryException> exceção ou todas as pilhas disponíveis para serem acessados, resultando em um <xref:System.StackOverflowException>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-147">Without the quota, a malicious message may cause all available memory to be accessed, resulting in an <xref:System.OutOfMemoryException> exception, or all available stacks to be accessed, resulting in a <xref:System.StackOverflowException>.</span></span>

<span data-ttu-id="6b95c-148">O cenário de cota excedida é recuperável; Se encontrado em um serviço em execução, a mensagem que está sendo processada no momento será descartada e o serviço continua em execução e processa mensagens adicionais.</span><span class="sxs-lookup"><span data-stu-id="6b95c-148">The quota exceeded scenario is recoverable; if encountered in a running service, the message currently being processed is discarded and the service keeps running and processes further messages.</span></span> <span data-ttu-id="6b95c-149">Os cenários de estouro de memória insuficiente e pilha, no entanto, não são recuperáveis em qualquer lugar do [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]; o serviço será encerrado se ele encontrar essas exceções.</span><span class="sxs-lookup"><span data-stu-id="6b95c-149">The out-of-memory and stack overflow scenarios, however, are not recoverable anywhere in the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]; the service terminates if it encounters such exceptions.</span></span>

<span data-ttu-id="6b95c-150">Cotas no WCF não envolvem qualquer pré-alocação.</span><span class="sxs-lookup"><span data-stu-id="6b95c-150">Quotas in WCF do not involve any pre-allocation.</span></span> <span data-ttu-id="6b95c-151">Por exemplo, se o <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> cota (encontrada em várias classes) é definida como 128 KB, isso não significa que 128 KB é alocado automaticamente para cada mensagem.</span><span class="sxs-lookup"><span data-stu-id="6b95c-151">For example, if the <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> quota (found on various classes) is set to 128 KB, it does not mean that 128 KB is automatically allocated for each message.</span></span> <span data-ttu-id="6b95c-152">O real valor alocado depende do tamanho de mensagem de entrada real.</span><span class="sxs-lookup"><span data-stu-id="6b95c-152">The actual amount allocated depends on the actual incoming message size.</span></span>

<span data-ttu-id="6b95c-153">Muitas cotas estão disponíveis na camada de transporte.</span><span class="sxs-lookup"><span data-stu-id="6b95c-153">Many quotas are available at the transport layer.</span></span> <span data-ttu-id="6b95c-154">Essas são as cotas impostas pelo canal de transporte específico em uso (HTTP, TCP e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="6b95c-154">These are quotas enforced by the specific transport channel in use (HTTP, TCP, and so on).</span></span> <span data-ttu-id="6b95c-155">Embora este tópico discute algumas dessas cotas, essas cotas são descritas detalhadamente na [cotas de transporte](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-155">While this topic discusses some of these quotas, these quotas are described in detail in [Transport Quotas](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span></span>

### <a name="hashtable-vulnerability"></a><span data-ttu-id="6b95c-156">Vulnerabilidade de tabela de hash</span><span class="sxs-lookup"><span data-stu-id="6b95c-156">Hashtable Vulnerability</span></span>

<span data-ttu-id="6b95c-157">Existe uma vulnerabilidade quando os contratos de dados contêm coleções ou tabelas de hash.</span><span class="sxs-lookup"><span data-stu-id="6b95c-157">A vulnerability exists when data contracts contain hashtables or collections.</span></span> <span data-ttu-id="6b95c-158">O problema ocorre se um grande número de valores é inserido em uma tabela de hash em que um grande número desses valores de gerar o mesmo valor de hash.</span><span class="sxs-lookup"><span data-stu-id="6b95c-158">The problem occurs if a large number of values are inserted into a hashtable where a large number of those values generate the same hash value.</span></span> <span data-ttu-id="6b95c-159">Isso pode ser usado como um ataque DOS.</span><span class="sxs-lookup"><span data-stu-id="6b95c-159">This can be used as a DOS attack.</span></span>  <span data-ttu-id="6b95c-160">Essa vulnerabilidade pode ser reduzida definindo a cota de associação MaxReceivedMessageSize.</span><span class="sxs-lookup"><span data-stu-id="6b95c-160">This vulnerability can be mitigated by setting the MaxReceivedMessageSize binding quota.</span></span> <span data-ttu-id="6b95c-161">Tome cuidado ao definir essa cota a fim de evitar esses ataques.</span><span class="sxs-lookup"><span data-stu-id="6b95c-161">Care must be taken while setting this quota in order to prevent such attacks.</span></span> <span data-ttu-id="6b95c-162">Essa cota coloca um limite superior no tamanho da mensagem do WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-162">This quota puts an upper limit on the size of WCF message.</span></span> <span data-ttu-id="6b95c-163">Além disso, evite usar coleções ou tabelas de hash em seus contratos de dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-163">Additionally, avoid using hashtables or collections in your data contracts.</span></span>

## <a name="limiting-memory-consumption-without-streaming"></a><span data-ttu-id="6b95c-164">Limitando o consumo de memória sem Streaming</span><span class="sxs-lookup"><span data-stu-id="6b95c-164">Limiting Memory Consumption Without Streaming</span></span>

<span data-ttu-id="6b95c-165">O modelo de segurança em torno de mensagens grandes depende se o streaming está em uso.</span><span class="sxs-lookup"><span data-stu-id="6b95c-165">The security model around large messages depends on whether streaming is in use.</span></span> <span data-ttu-id="6b95c-166">No caso do basic, não transmitidos por Streaming, as mensagens são armazenadas em buffer na memória.</span><span class="sxs-lookup"><span data-stu-id="6b95c-166">In the basic, non-streamed case, messages are buffered into memory.</span></span> <span data-ttu-id="6b95c-167">Nesse caso, use o <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> cota a <xref:System.ServiceModel.Channels.TransportBindingElement> ou em associações fornecidas pelo sistema para proteger contra mensagens grandes, limitando o tamanho máximo da mensagem para acessar.</span><span class="sxs-lookup"><span data-stu-id="6b95c-167">In this case, use the <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> quota on the <xref:System.ServiceModel.Channels.TransportBindingElement> or on the system-provided bindings to protect against large messages by limiting the maximum message size to access.</span></span> <span data-ttu-id="6b95c-168">Observe que um serviço pode processar várias mensagens ao mesmo tempo, caso em que eles estão todos em memória.</span><span class="sxs-lookup"><span data-stu-id="6b95c-168">Note that a service may be processing multiple messages at the same time, in which case they are all in memory.</span></span> <span data-ttu-id="6b95c-169">Use o recurso de limitação para reduzir essa ameaça.</span><span class="sxs-lookup"><span data-stu-id="6b95c-169">Use the throttling feature to mitigate this threat.</span></span>

<span data-ttu-id="6b95c-170">Observe também que `MaxReceivedMessageSize` não coloca um limite superior no consumo de memória por mensagem, mas limita-lo para dentro de um fator constante.</span><span class="sxs-lookup"><span data-stu-id="6b95c-170">Also note that `MaxReceivedMessageSize` does not place an upper bound on per-message memory consumption, but limits it to within a constant factor.</span></span> <span data-ttu-id="6b95c-171">Por exemplo, se o `MaxReceivedMessageSize` é 1 MB e é recebida uma mensagem de 1 MB e, em seguida, desserializada memória adicional é necessária para conter o grafo de objeto desserializado, resultando em bem de consumo de memória total acima de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="6b95c-171">For example, if the `MaxReceivedMessageSize` is 1 MB and a 1-MB message is received and then deserialized, additional memory is required to contain the deserialized object graph, resulting in total memory consumption well over 1 MB.</span></span> <span data-ttu-id="6b95c-172">Por esse motivo, evite criar tipos serializáveis que podem resultar em consumo de memória significativa sem muitos dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-172">For this reason, avoid creating serializable types that could result in significant memory consumption without much incoming data.</span></span> <span data-ttu-id="6b95c-173">Por exemplo, um contrato de dados "MyContract" com campos de membro de dados opcionais 50 e um adicional 100 campos privados pôde ser instanciado com a construção de XML "\<MyContract / >".</span><span class="sxs-lookup"><span data-stu-id="6b95c-173">For example, a data contract "MyContract" with 50 optional data member fields and an additional 100 private fields could be instantiated with the XML construction "\<MyContract/>".</span></span> <span data-ttu-id="6b95c-174">Esse XML resulta em memória que está sendo acessada para campos de 150.</span><span class="sxs-lookup"><span data-stu-id="6b95c-174">This XML results in memory being accessed for 150 fields.</span></span> <span data-ttu-id="6b95c-175">Observe que os membros de dados são opcionais por padrão.</span><span class="sxs-lookup"><span data-stu-id="6b95c-175">Note that data members are optional by default.</span></span> <span data-ttu-id="6b95c-176">O problema é complexo quando desse tipo é parte de uma matriz.</span><span class="sxs-lookup"><span data-stu-id="6b95c-176">The problem is compounded when such a type is part of an array.</span></span>

<span data-ttu-id="6b95c-177">`MaxReceivedMessageSize` sozinho não é suficiente para impedir que todos os ataques de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-177">`MaxReceivedMessageSize` alone is not enough to prevent all denial-of-service attacks.</span></span> <span data-ttu-id="6b95c-178">Por exemplo, o desserializador pode ser forçado para desserializar um grafo de objeto aninhado mais profundamente (um objeto que contém o outro objeto que contém uma outra e assim por diante) por uma mensagem de entrada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-178">For example, the deserializer may be forced to deserialize a deeply-nested object graph (an object that contains another object that contains yet another one, and so on) by an incoming message.</span></span> <span data-ttu-id="6b95c-179">Tanto a <xref:System.Runtime.Serialization.DataContractSerializer> e o <xref:System.Xml.Serialization.XmlSerializer> chamar métodos de forma aninhada para desserializar esses gráficos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-179">Both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Xml.Serialization.XmlSerializer> call methods in a nested way to deserialize such graphs.</span></span> <span data-ttu-id="6b95c-180">O aninhamento profundo de chamadas de método pode resultar em um irrecuperável <xref:System.StackOverflowException>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-180">Deep nesting of method calls may result in an unrecoverable <xref:System.StackOverflowException>.</span></span> <span data-ttu-id="6b95c-181">Essa ameaça é atenuada, definindo o <xref:System.ServiceModel.Configuration.XmlDictionaryReaderQuotasElement.MaxDepth%2A> cota para limitar o nível de aninhamento de XML, conforme discutido na seção "Usando XML com segurança" posteriormente neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6b95c-181">This threat is mitigated by setting the <xref:System.ServiceModel.Configuration.XmlDictionaryReaderQuotasElement.MaxDepth%2A> quota to limit the level of XML nesting, as discussed in the "Using XML Safely" section later in the topic.</span></span>

<span data-ttu-id="6b95c-182">Definir cotas adicionais como `MaxReceivedMessageSize` é especialmente importante ao usar a codificação binária de XML.</span><span class="sxs-lookup"><span data-stu-id="6b95c-182">Setting additional quotas to `MaxReceivedMessageSize` is especially important when using binary XML encoding.</span></span> <span data-ttu-id="6b95c-183">Usando a codificação binária é um pouco equivalente à compactação: um pequeno grupo de bytes na mensagem de entrada pode representar muitos dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-183">Using binary encoding is somewhat equivalent to compression: a small group of bytes in the incoming message may represent a lot of data.</span></span> <span data-ttu-id="6b95c-184">Assim, até mesmo uma mensagem ajustando-se para o `MaxReceivedMessageSize` limite pode levar muito mais memória no formulário totalmente expandido.</span><span class="sxs-lookup"><span data-stu-id="6b95c-184">Thus, even a message fitting into the `MaxReceivedMessageSize` limit may take up much more memory in fully expanded form.</span></span> <span data-ttu-id="6b95c-185">Para atenuar essas ameaças específicas de XML, todas as cotas do leitor XML devem ser definidas corretamente, conforme discutido na seção "Usando XML com segurança" neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6b95c-185">To mitigate such XML-specific threats, all of the XML reader quotas must be set correctly, as discussed in the "Using XML Safely" section later in this topic.</span></span>

## <a name="limiting-memory-consumption-with-streaming"></a><span data-ttu-id="6b95c-186">Limitando o consumo de memória com a transmissão</span><span class="sxs-lookup"><span data-stu-id="6b95c-186">Limiting Memory Consumption with Streaming</span></span>

<span data-ttu-id="6b95c-187">Quando o streaming, você pode usar um pequeno `MaxReceivedMessageSize` configuração para proteger contra ataques de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-187">When streaming, you may use a small `MaxReceivedMessageSize` setting to protect against denial-of-service attacks.</span></span> <span data-ttu-id="6b95c-188">No entanto, em cenários mais complexos são possíveis com a transmissão.</span><span class="sxs-lookup"><span data-stu-id="6b95c-188">However, more complicated scenarios are possible with streaming.</span></span> <span data-ttu-id="6b95c-189">Por exemplo, um serviço de upload de arquivo aceita arquivos maiores que toda a memória disponível.</span><span class="sxs-lookup"><span data-stu-id="6b95c-189">For example, a file upload service accepts files larger than all available memory.</span></span> <span data-ttu-id="6b95c-190">Nesse caso, defina o `MaxReceivedMessageSize` para um valor muito grande, esperar que quase nenhum dado é armazenado em buffer na memória e a mensagem transmite diretamente no disco.</span><span class="sxs-lookup"><span data-stu-id="6b95c-190">In this case, set the `MaxReceivedMessageSize` to an extremely large value, expecting that almost no data is buffered in memory and the message streams directly to disk.</span></span> <span data-ttu-id="6b95c-191">Se uma mensagem mal-intencionada pode forçar o WCF em buffer os dados em vez de transmitir-nesse caso, alguma forma `MaxReceivedMessageSize` não protege contra a mensagem de acesso a toda a memória disponível.</span><span class="sxs-lookup"><span data-stu-id="6b95c-191">If a malicious message can somehow force WCF to buffer data instead of streaming it in this case, `MaxReceivedMessageSize` no longer protects against the message accessing all available memory.</span></span>

<span data-ttu-id="6b95c-192">Para atenuar essa ameaça, as configurações de cota específico existem em vários componentes de processamento de dados WCF esse limite de buffer.</span><span class="sxs-lookup"><span data-stu-id="6b95c-192">To mitigate this threat, specific quota settings exist on various WCF data-processing components that limit buffering.</span></span> <span data-ttu-id="6b95c-193">O mais importante é o `MaxBufferSize` propriedade em vários elementos de associação de transporte e associações padrão.</span><span class="sxs-lookup"><span data-stu-id="6b95c-193">The most important of these is the `MaxBufferSize` property on various transport binding elements and standard bindings.</span></span> <span data-ttu-id="6b95c-194">Quando o streaming, essa cota deve ser definida levando em consideração a quantidade máxima de memória que você está disposto a alocar por mensagem.</span><span class="sxs-lookup"><span data-stu-id="6b95c-194">When streaming, this quota should be set taking into account the maximum amount of memory you are willing to allocate per message.</span></span> <span data-ttu-id="6b95c-195">Assim como acontece com `MaxReceivedMessageSize`, a configuração não coloca um máximo absoluto consumo de memória, mas apenas limita-lo para dentro de um fator constante.</span><span class="sxs-lookup"><span data-stu-id="6b95c-195">As with `MaxReceivedMessageSize`, the setting does not put an absolute maximum on memory consumption but only limits it to within a constant factor.</span></span> <span data-ttu-id="6b95c-196">Além disso, como com `MaxReceivedMessageSize`, lembre-se da possibilidade de várias mensagens que estão sendo processadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-196">Also, as with `MaxReceivedMessageSize`, be aware of the possibility of multiple messages being processed simultaneously.</span></span>

### <a name="maxbuffersize-details"></a><span data-ttu-id="6b95c-197">MaxBufferSize detalhes</span><span class="sxs-lookup"><span data-stu-id="6b95c-197">MaxBufferSize Details</span></span>

<span data-ttu-id="6b95c-198">O `MaxBufferSize` propriedade limita qualquer em massa WCF buffer faz.</span><span class="sxs-lookup"><span data-stu-id="6b95c-198">The `MaxBufferSize` property limits any bulk buffering WCF does.</span></span> <span data-ttu-id="6b95c-199">Por exemplo, o WCF sempre armazena cabeçalhos SOAP e falhas de SOAP, bem como quaisquer partes MIME não consideradas na ordem natural de leitura em uma mensagem MTOM Message Transmission Optimization Mechanism ().</span><span class="sxs-lookup"><span data-stu-id="6b95c-199">For example, WCF always buffers SOAP headers and SOAP faults, as well as any MIME parts found to be not in the natural reading order in an Message Transmission Optimization Mechanism (MTOM) message.</span></span> <span data-ttu-id="6b95c-200">Essa configuração limita a quantidade de armazenamento em buffer em todos esses casos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-200">This setting limits the amount of buffering in all these cases.</span></span>

<span data-ttu-id="6b95c-201">O WCF faz isso passando o `MaxBufferSize` valor para os vários componentes que podem armazenar em buffer.</span><span class="sxs-lookup"><span data-stu-id="6b95c-201">WCF accomplishes this by passing the `MaxBufferSize` value to the various components that may buffer.</span></span> <span data-ttu-id="6b95c-202">Por exemplo, algumas <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> sobrecargas do <xref:System.ServiceModel.Channels.Message> classe take um `maxSizeOfHeaders` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-202">For example, some <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> overloads of the <xref:System.ServiceModel.Channels.Message> class take a `maxSizeOfHeaders` parameter.</span></span> <span data-ttu-id="6b95c-203">O WCF passa o `MaxBufferSize` valor para esse parâmetro para limitar a quantidade de buffer de cabeçalho SOAP.</span><span class="sxs-lookup"><span data-stu-id="6b95c-203">WCF passes the `MaxBufferSize` value to this parameter to limit the amount of SOAP header buffering.</span></span> <span data-ttu-id="6b95c-204">É importante definir esse parâmetro ao usar o <xref:System.ServiceModel.Channels.Message> classe diretamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-204">It is important to set this parameter when using the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="6b95c-205">Em geral, ao usar um componente no WCF que usa os parâmetros de cota, é importante entender as implicações de segurança desses parâmetros e configurá-los corretamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-205">In general, when using a component in WCF that takes quota parameters, it is important to understand the security implications of these parameters and set them correctly.</span></span>

<span data-ttu-id="6b95c-206">O codificador de mensagem MTOM também tem um `MaxBufferSize` configuração.</span><span class="sxs-lookup"><span data-stu-id="6b95c-206">The MTOM message encoder also has a `MaxBufferSize` setting.</span></span> <span data-ttu-id="6b95c-207">Ao usar associações padrão, isso é definido automaticamente para o nível de transporte `MaxBufferSize` valor.</span><span class="sxs-lookup"><span data-stu-id="6b95c-207">When using standard bindings, this is set automatically to the transport-level `MaxBufferSize` value.</span></span> <span data-ttu-id="6b95c-208">No entanto, ao usar o elemento de associação do codificador de mensagem MTOM para construir uma ligação personalizada, é importante definir o `MaxBufferSize` propriedade como um valor seguro quando o streaming é usada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-208">However, when using the MTOM message encoder binding element to construct a custom binding, it is important to set the `MaxBufferSize` property to a safe value when streaming is used.</span></span>

## <a name="xml-based-streaming-attacks"></a><span data-ttu-id="6b95c-209">Streaming de ataques baseados em XML</span><span class="sxs-lookup"><span data-stu-id="6b95c-209">XML-Based Streaming Attacks</span></span>

<span data-ttu-id="6b95c-210">`MaxBufferSize` sozinho não é suficiente para garantir que o WCF não pode ser forçado para armazenamento em buffer ao streaming é esperado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-210">`MaxBufferSize` alone is not enough to ensure that WCF cannot be forced into buffering when streaming is expected.</span></span> <span data-ttu-id="6b95c-211">Por exemplo, os leitores XML WCF sempre buffer a marca de início de elemento XML inteira quando começar a ler um novo elemento.</span><span class="sxs-lookup"><span data-stu-id="6b95c-211">For example, the WCF XML readers always buffer the entire XML element start tag when starting to read a new element.</span></span> <span data-ttu-id="6b95c-212">Isso é feito para que namespaces e atributos sejam processados corretamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-212">This is done so that namespaces and attributes are properly processed.</span></span> <span data-ttu-id="6b95c-213">Se `MaxReceivedMessageSize` está configurado para ser grande (por exemplo, para permitir que um arquivo grande de direct-to-disk cenário de streaming), uma mensagem mal-intencionada pode ser construída em que o corpo da mensagem inteira é uma grande marca de início de elemento XML.</span><span class="sxs-lookup"><span data-stu-id="6b95c-213">If `MaxReceivedMessageSize` is configured to be large (for example, to enable a direct-to-disk large file streaming scenario), a malicious message may be constructed where the entire message body is a large XML element start tag.</span></span> <span data-ttu-id="6b95c-214">Uma tentativa de lê-lo resulta em um <xref:System.OutOfMemoryException>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-214">An attempt to read it results in an <xref:System.OutOfMemoryException>.</span></span> <span data-ttu-id="6b95c-215">Esse é um dos muitos ataques de negação de serviço de baseado em XML possíveis que podem todos ser atenuados com cotas do leitor XML, discutidas na seção "Usando XML com segurança" neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6b95c-215">This is one of many possible XML-based denial-of-service attacks that can all be mitigated using XML reader quotas, discussed in the "Using XML Safely" section later in this topic.</span></span> <span data-ttu-id="6b95c-216">Quando o streaming, é especialmente importante para definir todas essas cotas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-216">When streaming, it is especially important to set all of these quotas.</span></span>

### <a name="mixing-streaming-and-buffering-programming-models"></a><span data-ttu-id="6b95c-217">Combinação de Streaming e armazenamento em buffer os modelos de programação</span><span class="sxs-lookup"><span data-stu-id="6b95c-217">Mixing Streaming and Buffering Programming Models</span></span>

<span data-ttu-id="6b95c-218">Muitas possíveis ataques são provenientes de misturar modelos de programação streaming e não são de streaming no mesmo serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-218">Many possible attacks arise from mixing streaming and non-streaming programming models in the same service.</span></span> <span data-ttu-id="6b95c-219">Suponha que exista um contrato de serviço com duas operações: uma usa um <xref:System.IO.Stream> e o outro usa uma matriz de algum tipo personalizado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-219">Suppose there is a service contract with two operations: one takes a <xref:System.IO.Stream> and another takes an array of some custom type.</span></span> <span data-ttu-id="6b95c-220">Suponha também que `MaxReceivedMessageSize` é definida com um valor grande para habilitar a primeira operação processar grandes fluxos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-220">Suppose also that `MaxReceivedMessageSize` is set to a large value to enable the first operation to process large streams.</span></span> <span data-ttu-id="6b95c-221">Infelizmente, isso significa que mensagens grandes agora pode ser enviada para a segunda operação e os dados de buffers do desserializador na memória como uma matriz antes da operação é chamada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-221">Unfortunately, this means that large messages can now be sent to the second operation as well, and the deserializer buffers data in memory as an array before the operation is called.</span></span> <span data-ttu-id="6b95c-222">Este é um ataque de negação de serviço possíveis: o `MaxBufferSize` cota não limita o tamanho do corpo da mensagem, que é o que o desserializador funciona com.</span><span class="sxs-lookup"><span data-stu-id="6b95c-222">This is a potential denial-of-service attack: the `MaxBufferSize` quota does not limit the size of the message body, which is what the deserializer works with.</span></span>

<span data-ttu-id="6b95c-223">Por esse motivo, evite a mistura de operações com base em fluxo e não transmitidos por Streaming no mesmo contrato.</span><span class="sxs-lookup"><span data-stu-id="6b95c-223">For this reason, avoid mixing stream-based and non-streamed operations in the same contract.</span></span> <span data-ttu-id="6b95c-224">Se você com certeza deve combinar os dois modelos de programação, use as seguintes precauções:</span><span class="sxs-lookup"><span data-stu-id="6b95c-224">If you absolutely must mix the two programming models, use the following precautions:</span></span>

- <span data-ttu-id="6b95c-225">Desativar o <xref:System.Runtime.Serialization.IExtensibleDataObject> recurso definindo a <xref:System.ServiceModel.ServiceBehaviorAttribute.IgnoreExtensionDataObject%2A> propriedade da <xref:System.ServiceModel.ServiceBehaviorAttribute> para `true`.</span><span class="sxs-lookup"><span data-stu-id="6b95c-225">Turn off the <xref:System.Runtime.Serialization.IExtensibleDataObject> feature by setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.IgnoreExtensionDataObject%2A> property of the <xref:System.ServiceModel.ServiceBehaviorAttribute> to `true`.</span></span> <span data-ttu-id="6b95c-226">Isso garante que somente os membros que fazem parte do contrato são desserializados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-226">This ensures that only members that are a part of the contract are deserialized.</span></span>

- <span data-ttu-id="6b95c-227">Defina as <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> propriedade do <xref:System.Runtime.Serialization.DataContractSerializer> como um valor seguro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-227">Set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> property of the <xref:System.Runtime.Serialization.DataContractSerializer> to a safe value.</span></span> <span data-ttu-id="6b95c-228">Essa cota também está disponível no <xref:System.ServiceModel.ServiceBehaviorAttribute> atributo ou por meio da configuração.</span><span class="sxs-lookup"><span data-stu-id="6b95c-228">This quota is also available on the <xref:System.ServiceModel.ServiceBehaviorAttribute> attribute or through configuration.</span></span> <span data-ttu-id="6b95c-229">Essa cota limita o número de objetos que serão desserializados em um episódio de desserialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-229">This quota limits the number of objects that are deserialized in one deserialization episode.</span></span> <span data-ttu-id="6b95c-230">Normalmente, cada operação parâmetro ou mensagem de parte do corpo em um contrato de mensagem é desserializado em um episódio.</span><span class="sxs-lookup"><span data-stu-id="6b95c-230">Normally, each operation parameter or message body part in a message contract is deserialized in one episode.</span></span> <span data-ttu-id="6b95c-231">Ao desserializar matrizes, cada entrada da matriz é contada como um objeto separado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-231">When deserializing arrays, each array entry is counted as a separate object.</span></span>

- <span data-ttu-id="6b95c-232">Defina todas as cotas do leitor XML para valores seguros.</span><span class="sxs-lookup"><span data-stu-id="6b95c-232">Set all of the XML reader quotas to safe values.</span></span> <span data-ttu-id="6b95c-233">Preste atenção às <xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A>, <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, e <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A> e evitar cadeias de caracteres em operações de não streaming.</span><span class="sxs-lookup"><span data-stu-id="6b95c-233">Pay attention to <xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A>, <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, and <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A> and avoid strings in non-streaming operations.</span></span>

- <span data-ttu-id="6b95c-234">Examine a lista de tipos conhecidos, tendo em mente que qualquer um deles pode ser instanciado a qualquer momento (consulte a seção "Impedindo não intencionais tipos do que está sendo carregado" mais adiante neste tópico).</span><span class="sxs-lookup"><span data-stu-id="6b95c-234">Review the list of known types, keeping in mind that any one of them can be instantiated at any time (see the "Preventing Unintended Types from Being Loaded" section later in this topic).</span></span>

- <span data-ttu-id="6b95c-235">Não use todos os tipos que implementam o <xref:System.Xml.Serialization.IXmlSerializable> interface que muitos dados do buffer.</span><span class="sxs-lookup"><span data-stu-id="6b95c-235">Do not use any types that implement the <xref:System.Xml.Serialization.IXmlSerializable> interface that buffer a lot of data.</span></span> <span data-ttu-id="6b95c-236">Não adicione esses tipos à lista de tipos conhecidos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-236">Do not add such types to the list of known types.</span></span>

- <span data-ttu-id="6b95c-237">Não use o <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> matrizes <xref:System.Byte> matrizes ou tipos que implementam <xref:System.Runtime.Serialization.ISerializable> em um contrato.</span><span class="sxs-lookup"><span data-stu-id="6b95c-237">Do not use the <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> arrays, <xref:System.Byte> arrays, or types that implement <xref:System.Runtime.Serialization.ISerializable> in a contract.</span></span>

- <span data-ttu-id="6b95c-238">Não use o <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> matrizes <xref:System.Byte> matrizes ou tipos que implementam <xref:System.Runtime.Serialization.ISerializable> na lista de tipos conhecidos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-238">Do not use the <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> arrays, <xref:System.Byte> arrays, or types that implement <xref:System.Runtime.Serialization.ISerializable> in the list of known types.</span></span>

<span data-ttu-id="6b95c-239">As precauções anteriores se aplicam quando a operação de streaming não usa o <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-239">The preceding precautions apply when the non-streamed operation uses the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="6b95c-240">Nunca misture streaming e modelos de programação não são de streaming no mesmo serviço, se você estiver usando o <xref:System.Xml.Serialization.XmlSerializer>, porque ele não tem a proteção do <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.MaxItemsInObjectGraph%2A> cota.</span><span class="sxs-lookup"><span data-stu-id="6b95c-240">Never mix streaming and non-streaming programming models on the same service if you are using the <xref:System.Xml.Serialization.XmlSerializer>, because it does not have the protection of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.MaxItemsInObjectGraph%2A> quota.</span></span>

### <a name="slow-stream-attacks"></a><span data-ttu-id="6b95c-241">Ataques de Stream lento</span><span class="sxs-lookup"><span data-stu-id="6b95c-241">Slow Stream Attacks</span></span>

<span data-ttu-id="6b95c-242">Uma classe de ataques de negação de serviço de streaming não envolve o consumo de memória.</span><span class="sxs-lookup"><span data-stu-id="6b95c-242">A class of streaming denial-of-service attacks does not involve memory consumption.</span></span> <span data-ttu-id="6b95c-243">Em vez disso, o ataque envolve um lento remetente ou receptor de dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-243">Instead, the attack involves a slow sender or receiver of data.</span></span> <span data-ttu-id="6b95c-244">Enquanto aguarda os dados a ser enviado ou recebido, recursos como threads e conexões disponíveis são esgotados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-244">While waiting for the data to be sent or received, resources such as threads and available connections are exhausted.</span></span> <span data-ttu-id="6b95c-245">Essa situação poderá ocorrer como resultado de um ataque mal-intencionado ou de um remetente/destinatário legítimo em uma conexão de rede lenta.</span><span class="sxs-lookup"><span data-stu-id="6b95c-245">This situation could arise either as a result of a malicious attack or from a legitimate sender/receiver on a slow network connection.</span></span>

<span data-ttu-id="6b95c-246">Para atenuar esses ataques, defina os tempos limite de transporte corretamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-246">To mitigate these attacks, set the transport time-outs correctly.</span></span> <span data-ttu-id="6b95c-247">Para obter mais informações, consulte [cotas de transporte](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-247">For more information, see [Transport Quotas](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span></span> <span data-ttu-id="6b95c-248">Em segundo lugar, nunca use síncrono `Read` ou `Write` operações ao trabalhar com fluxos no WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-248">Secondly, never use synchronous `Read` or `Write` operations when working with streams in WCF.</span></span>

## <a name="using-xml-safely"></a><span data-ttu-id="6b95c-249">Usando XML com segurança</span><span class="sxs-lookup"><span data-stu-id="6b95c-249">Using XML Safely</span></span>

> [!NOTE]
> <span data-ttu-id="6b95c-250">Embora esta seção é sobre XML, as informações também se aplica a documentos de notação JSON (JavaScript Object).</span><span class="sxs-lookup"><span data-stu-id="6b95c-250">Although this section is about XML, the information also applies to JavaScript Object Notation (JSON) documents.</span></span> <span data-ttu-id="6b95c-251">As cotas funcionam da mesma forma, usando [mapeamento entre JSON e XML](../../../../docs/framework/wcf/feature-details/mapping-between-json-and-xml.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-251">The quotas work similarly, using [Mapping Between JSON and XML](../../../../docs/framework/wcf/feature-details/mapping-between-json-and-xml.md).</span></span>

### <a name="secure-xml-readers"></a><span data-ttu-id="6b95c-252">Proteger os leitores XML</span><span class="sxs-lookup"><span data-stu-id="6b95c-252">Secure XML Readers</span></span>

<span data-ttu-id="6b95c-253">O XML Infoset constitui a base de todo o processamento de mensagem no WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-253">The XML Infoset forms the basis of all message processing in WCF.</span></span> <span data-ttu-id="6b95c-254">Ao aceitar os dados XML de uma fonte não confiável, um número de ataque de negação de serviço existem possibilidades que deve ser reduzido.</span><span class="sxs-lookup"><span data-stu-id="6b95c-254">When accepting XML data from an untrusted source, a number of denial-of-service attack possibilities exist that must be mitigated.</span></span> <span data-ttu-id="6b95c-255">O WCF fornece os leitores XML especiais e seguros.</span><span class="sxs-lookup"><span data-stu-id="6b95c-255">WCF provides special, secure XML readers.</span></span> <span data-ttu-id="6b95c-256">Esses leitores são criados automaticamente ao usar uma das codificações padrão no WCF (texto, binária ou MTOM).</span><span class="sxs-lookup"><span data-stu-id="6b95c-256">These readers are created automatically when using one of the standard encodings in WCF (text, binary, or MTOM).</span></span>

<span data-ttu-id="6b95c-257">Alguns dos recursos de segurança desses leitores estão sempre ativas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-257">Some of the security features on these readers are always active.</span></span> <span data-ttu-id="6b95c-258">Por exemplo, os leitores nunca processam definições de tipo de documento (DTDs), que são uma fonte potencial de ataques de negação de serviço e nunca devem aparecer em mensagens legítimas de SOAP.</span><span class="sxs-lookup"><span data-stu-id="6b95c-258">For example, the readers never process document type definitions (DTDs), which are a potential source of denial-of-service attacks and should never appear in legitimate SOAP messages.</span></span> <span data-ttu-id="6b95c-259">Outros recursos de segurança incluem as cotas do leitor que devem ser configuradas, que são descritas na seção a seguir.</span><span class="sxs-lookup"><span data-stu-id="6b95c-259">Other security features include reader quotas that must be configured, which are described in the following section.</span></span>

<span data-ttu-id="6b95c-260">Ao trabalhar diretamente com os leitores XML (como ao escrever seu próprio codificador personalizado ou ao trabalhar diretamente com o <xref:System.ServiceModel.Channels.Message> classe), sempre use os leitores seguros do WCF, quando há uma chance de trabalhar com dados não confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-260">When working directly with XML readers (such as when writing your own custom encoder or when working directly with the <xref:System.ServiceModel.Channels.Message> class), always use the WCF secure readers when there is a chance of working with untrusted data.</span></span> <span data-ttu-id="6b95c-261">Criar os leitores de seguros chamando um dos estática de fábrica sobrecargas do método de <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>, ou <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> sobre o <xref:System.Xml.XmlDictionaryReader> classe.</span><span class="sxs-lookup"><span data-stu-id="6b95c-261">Create the secure readers by calling one of the static factory method overloads of <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>, or <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> on the <xref:System.Xml.XmlDictionaryReader> class.</span></span> <span data-ttu-id="6b95c-262">Ao criar um leitor, passe valores de cota de seguro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-262">When creating a reader, pass in secure quota values.</span></span> <span data-ttu-id="6b95c-263">Não chame o `Create` sobrecargas de método.</span><span class="sxs-lookup"><span data-stu-id="6b95c-263">Do not call the `Create` method overloads.</span></span> <span data-ttu-id="6b95c-264">Eles não criam um leitor do WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-264">These do not create a WCF reader.</span></span> <span data-ttu-id="6b95c-265">Em vez disso, é criado um leitor que não seja protegido pelos recursos de segurança descritos nesta seção.</span><span class="sxs-lookup"><span data-stu-id="6b95c-265">Instead, a reader is created that is not protected by the security features described in this section.</span></span>

### <a name="reader-quotas"></a><span data-ttu-id="6b95c-266">Cotas do leitor</span><span class="sxs-lookup"><span data-stu-id="6b95c-266">Reader Quotas</span></span>

<span data-ttu-id="6b95c-267">Os leitores XML seguros tem cinco cotas configuráveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-267">The secure XML readers have five configurable quotas.</span></span> <span data-ttu-id="6b95c-268">Eles normalmente são configurados usando o `ReaderQuotas` propriedade na codificação de elementos de associação ou associações padrão ou usando um <xref:System.Xml.XmlDictionaryReaderQuotas> objeto passado durante a criação de um leitor.</span><span class="sxs-lookup"><span data-stu-id="6b95c-268">These are normally configured using the `ReaderQuotas` property on the encoding binding elements or standard bindings, or by using an <xref:System.Xml.XmlDictionaryReaderQuotas> object passed when creating a reader.</span></span>

#### <a name="maxbytesperread"></a><span data-ttu-id="6b95c-269">MaxBytesPerRead</span><span class="sxs-lookup"><span data-stu-id="6b95c-269">MaxBytesPerRead</span></span>

<span data-ttu-id="6b95c-270">Essa cota limita o número de bytes que são lidos em uma única `Read` de início da operação ao ler o elemento de marca e seus atributos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-270">This quota limits the number of bytes that are read in a single `Read` operation when reading the element start tag and its attributes.</span></span> <span data-ttu-id="6b95c-271">(Em casos não transmitidos por Streaming, o nome do elemento em si não é contado em relação à cota.) <xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A> é importante pelos seguintes motivos:</span><span class="sxs-lookup"><span data-stu-id="6b95c-271">(In non-streamed cases, the element name itself is not counted against the quota.) <xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A> is important for the following reasons:</span></span>

- <span data-ttu-id="6b95c-272">O nome do elemento e seus atributos são sempre armazenados em buffer na memória quando elas são lidas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-272">The element name and its attributes are always buffered in memory when they are being read.</span></span> <span data-ttu-id="6b95c-273">Portanto, é importante definir essa cota corretamente no modo para impedir que o armazenamento em buffer excessivo quando o streaming é esperado de streaming.</span><span class="sxs-lookup"><span data-stu-id="6b95c-273">Therefore, it is important to set this quota correctly in streaming mode to prevent excessive buffering when streaming is expected.</span></span> <span data-ttu-id="6b95c-274">Consulte o `MaxDepth` seção de cota para obter informações sobre a quantidade real de buffer ocorre.</span><span class="sxs-lookup"><span data-stu-id="6b95c-274">See the `MaxDepth` quota section for information about the actual amount of buffering that takes place.</span></span>

- <span data-ttu-id="6b95c-275">Ter atributos XML demais pode consumir todo o tempo de processamento de maneira desproporcional porque a exclusividade dos nomes de atributo tem que ser verificada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-275">Having too many XML attributes may use up disproportionate processing time because attribute names have to be checked for uniqueness.</span></span> <span data-ttu-id="6b95c-276">O `MaxBytesPerRead` atenua essa ameaça.</span><span class="sxs-lookup"><span data-stu-id="6b95c-276">`MaxBytesPerRead` mitigates this threat.</span></span>

#### <a name="maxdepth"></a><span data-ttu-id="6b95c-277">MaxDepth</span><span class="sxs-lookup"><span data-stu-id="6b95c-277">MaxDepth</span></span>

<span data-ttu-id="6b95c-278">Essa cota limita a profundidade máxima de aninhamento dos elementos XML.</span><span class="sxs-lookup"><span data-stu-id="6b95c-278">This quota limits the maximum nesting depth of XML elements.</span></span> <span data-ttu-id="6b95c-279">Por exemplo, o documento "\<um >\<B >\<C / >\</b >\</A >" tem uma profundidade de aninhamento de três.</span><span class="sxs-lookup"><span data-stu-id="6b95c-279">For example, the document "\<A>\<B>\<C/>\</B>\</A>" has a nesting depth of three.</span></span> <span data-ttu-id="6b95c-280"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> é importante pelos seguintes motivos:</span><span class="sxs-lookup"><span data-stu-id="6b95c-280"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> is important for the following reasons:</span></span>

- <span data-ttu-id="6b95c-281">O `MaxDepth` interage com o `MaxBytesPerRead`: o leitor sempre mantém dados na memória para o elemento atual e todos os seus ancestrais, para que o consumo máximo de memória do leitor seja proporcional ao produto dessas duas configurações.</span><span class="sxs-lookup"><span data-stu-id="6b95c-281">`MaxDepth` interacts with `MaxBytesPerRead`: the reader always keeps data in memory for the current element and all of its ancestors, so the maximum memory consumption of the reader is proportional to the product of these two settings.</span></span>

- <span data-ttu-id="6b95c-282">Ao desserializar um grafo de objeto aninhado mais profundamente, o desserializador é forçado para acessar a pilha inteira e gerar um <xref:System.StackOverflowException> irrecuperável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-282">When deserializing a deeply-nested object graph, the deserializer is forced to access the entire stack and throw an unrecoverable <xref:System.StackOverflowException>.</span></span> <span data-ttu-id="6b95c-283">Uma correlação direta existe entre aninhamento de XML e aninhamento de objeto para <xref:System.Runtime.Serialization.DataContractSerializer> e <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-283">A direct correlation exists between XML nesting and object nesting for both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Xml.Serialization.XmlSerializer>.</span></span> <span data-ttu-id="6b95c-284">Use `MaxDepth` para atenuar essa ameaça.</span><span class="sxs-lookup"><span data-stu-id="6b95c-284">Use `MaxDepth` to mitigate this threat.</span></span>

#### <a name="maxnametablecharcount"></a><span data-ttu-id="6b95c-285">MaxNameTableCharCount</span><span class="sxs-lookup"><span data-stu-id="6b95c-285">MaxNameTableCharCount</span></span>

<span data-ttu-id="6b95c-286">Essa cota limita o tamanho do que o leitor *nametable*.</span><span class="sxs-lookup"><span data-stu-id="6b95c-286">This quota limits the size of the reader’s *nametable*.</span></span> <span data-ttu-id="6b95c-287">O nametable contém algumas cadeias de caracteres (como namespaces e prefixos) que são encontrados ao processar um documento XML.</span><span class="sxs-lookup"><span data-stu-id="6b95c-287">The nametable contains certain strings (such as namespaces and prefixes) that are encountered when processing an XML document.</span></span> <span data-ttu-id="6b95c-288">Como essas cadeias de caracteres são armazenados em buffer na memória, defina essa cota para evitar o armazenamento em buffer excessivo quando o streaming é esperado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-288">As these strings are buffered in memory, set this quota to prevent excessive buffering when streaming is expected.</span></span>

#### <a name="maxstringcontentlength"></a><span data-ttu-id="6b95c-289">MaxStringContentLength</span><span class="sxs-lookup"><span data-stu-id="6b95c-289">MaxStringContentLength</span></span>

<span data-ttu-id="6b95c-290">Essa cota limita o tamanho máximo da cadeia de caracteres que o leitor de XML retorna.</span><span class="sxs-lookup"><span data-stu-id="6b95c-290">This quota limits the maximum string size that the XML reader returns.</span></span> <span data-ttu-id="6b95c-291">Essa cota não limita o consumo de memória no próprio leitor de XML, mas no componente que esteja usando o leitor.</span><span class="sxs-lookup"><span data-stu-id="6b95c-291">This quota does not limit memory consumption in the XML reader itself, but in the component that is using the reader.</span></span> <span data-ttu-id="6b95c-292">Por exemplo, quando o <xref:System.Runtime.Serialization.DataContractSerializer> usa um leitor protegido com <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, ele não desserializa as cadeias de caracteres maiores do que essa cota.</span><span class="sxs-lookup"><span data-stu-id="6b95c-292">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> uses a reader secured with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, it does not deserialize strings larger than this quota.</span></span> <span data-ttu-id="6b95c-293">Ao usar o <xref:System.Xml.XmlDictionaryReader> classe diretamente, nem todos os aspectos de métodos essa cota, mas apenas os métodos que são projetados especificamente para ler cadeias de caracteres, como o <xref:System.Xml.XmlDictionaryReader.ReadContentAsString%2A> método.</span><span class="sxs-lookup"><span data-stu-id="6b95c-293">When using the <xref:System.Xml.XmlDictionaryReader> class directly, not all methods respect this quota, but only the methods that are specifically designed to read strings, such as the <xref:System.Xml.XmlDictionaryReader.ReadContentAsString%2A> method.</span></span> <span data-ttu-id="6b95c-294">O <xref:System.Xml.XmlReader.Value%2A> propriedade o leitor não é afetada por essa cota e, portanto, não deve ser usada quando a proteção fornece essa cota é necessária.</span><span class="sxs-lookup"><span data-stu-id="6b95c-294">The <xref:System.Xml.XmlReader.Value%2A> property on the reader is not affected by this quota, and thus should not be used when the protection this quota provides is necessary.</span></span>

#### <a name="maxarraylength"></a><span data-ttu-id="6b95c-295">MaxArrayLength</span><span class="sxs-lookup"><span data-stu-id="6b95c-295">MaxArrayLength</span></span>

<span data-ttu-id="6b95c-296">Essa cota limita o tamanho máximo de uma matriz de primitivas que o leitor de XML retorna, inclusive matrizes de bytes.</span><span class="sxs-lookup"><span data-stu-id="6b95c-296">This quota limits the maximum size of an array of primitives that the XML reader returns, including byte arrays.</span></span> <span data-ttu-id="6b95c-297">Essa cota não limita o consumo de memória no próprio leitor de XML, mas em qualquer componente que esteja usando o leitor.</span><span class="sxs-lookup"><span data-stu-id="6b95c-297">This quota does not limit memory consumption in the XML reader itself, but in whatever component that is using the reader.</span></span> <span data-ttu-id="6b95c-298">Por exemplo, quando o <xref:System.Runtime.Serialization.DataContractSerializer> usa um leitor protegido com <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>, ele não desserializa as matrizes de bytes maiores do que essa cota.</span><span class="sxs-lookup"><span data-stu-id="6b95c-298">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> uses a reader secured with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>, it does not deserialize byte arrays larger than this quota.</span></span> <span data-ttu-id="6b95c-299">É importante definir essa cota ao tentar combinar modelos de programação em buffer e transmissão em um único contrato.</span><span class="sxs-lookup"><span data-stu-id="6b95c-299">It is important to set this quota when attempting to mix streaming and buffered programming models in a single contract.</span></span> <span data-ttu-id="6b95c-300">Tenha em mente que, ao usar o <xref:System.Xml.XmlDictionaryReader> classe diretamente, apenas os métodos que são projetados especificamente para ler as matrizes de tamanho arbitrário de determinados tipos primitivos, como <xref:System.Xml.XmlDictionaryReader.ReadInt32Array%2A>, respeita essa cota.</span><span class="sxs-lookup"><span data-stu-id="6b95c-300">Keep in mind that when using the <xref:System.Xml.XmlDictionaryReader> class directly, only the methods that are specifically designed to read arrays of arbitrary size of certain primitive types, such as <xref:System.Xml.XmlDictionaryReader.ReadInt32Array%2A>, respect this quota.</span></span>

## <a name="threats-specific-to-the-binary-encoding"></a><span data-ttu-id="6b95c-301">Ameaças específicas para a codificação binária</span><span class="sxs-lookup"><span data-stu-id="6b95c-301">Threats Specific to the Binary Encoding</span></span>

<span data-ttu-id="6b95c-302">O XML binário codificação dá suporte a WCF inclui um *cadeias de caracteres de dicionário* recurso.</span><span class="sxs-lookup"><span data-stu-id="6b95c-302">The binary XML encoding WCF supports includes a *dictionary strings* feature.</span></span> <span data-ttu-id="6b95c-303">Uma cadeia de caracteres grande pode ser codificada usando somente alguns bytes.</span><span class="sxs-lookup"><span data-stu-id="6b95c-303">A large string may be encoded using only a few bytes.</span></span> <span data-ttu-id="6b95c-304">Isso permite que os ganhos significativos de desempenho, mas apresenta novas ameaças de negação de serviço que devem ser reduzidas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-304">This enables significant performance gains, but introduces new denial-of-service threats that must be mitigated.</span></span>

<span data-ttu-id="6b95c-305">Há dois tipos de dicionários: *estáticos* e *dinâmico*.</span><span class="sxs-lookup"><span data-stu-id="6b95c-305">There are two kinds of dictionaries: *static* and *dynamic*.</span></span> <span data-ttu-id="6b95c-306">O dicionário estático é uma lista interna de cadeias de caracteres longas que podem ser representados usando um código curto na codificação binária.</span><span class="sxs-lookup"><span data-stu-id="6b95c-306">The static dictionary is a built-in list of long strings that may be represented using a short code in the binary encoding.</span></span> <span data-ttu-id="6b95c-307">Esta lista de cadeias de caracteres é fixada quando o leitor é criado e não pode ser modificado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-307">This list of strings is fixed when the reader is created and cannot be modified.</span></span> <span data-ttu-id="6b95c-308">Nenhuma das cadeias de caracteres no dicionário estático que o WCF usa por padrão é grande o suficiente para oferecer uma ameaça grave de negação de serviço, embora ainda possa ser usados em um ataque de expansão do dicionário.</span><span class="sxs-lookup"><span data-stu-id="6b95c-308">None of the strings in the static dictionary that WCF uses by default are sufficiently large to pose a serious denial-of-service threat, although they may still be used in a dictionary expansion attack.</span></span> <span data-ttu-id="6b95c-309">Em cenários avançados em que você fornecer seu próprio dicionário estático, tenha cuidado ao introduzir cadeias de caracteres de dicionário grandes.</span><span class="sxs-lookup"><span data-stu-id="6b95c-309">In advanced scenarios where you supply your own static dictionary, be careful when introducing large dictionary strings.</span></span>

<span data-ttu-id="6b95c-310">O recurso de dicionários dinâmico permite que as mensagens definir suas próprias cadeias de caracteres e associá-los a códigos curtos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-310">The dynamic dictionaries feature allows messages to define their own strings and associate them with short codes.</span></span> <span data-ttu-id="6b95c-311">Esses mapeamentos de código a cadeia de caracteres são mantidos na memória durante a sessão de comunicação inteira, de modo que as mensagens subsequentes não precisará reenviar as cadeias de caracteres e podem utilizar códigos que já estão definidos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-311">These string-to-code mappings are kept in memory during the entire communication session, such that subsequent messages do not have to resend the strings and can utilize codes that are already defined.</span></span> <span data-ttu-id="6b95c-312">Essas cadeias de caracteres podem ser de comprimento arbitrário e, portanto, representem uma ameaça mais grave que aquelas no dicionário estático.</span><span class="sxs-lookup"><span data-stu-id="6b95c-312">These strings may be of arbitrary length and thus pose a more serious threat than those in the static dictionary.</span></span>

<span data-ttu-id="6b95c-313">O primeiro risco deve ser reduzido é a possibilidade do dicionário dinâmico se tornar muito grande (tabela de mapeamento de código a cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="6b95c-313">The first threat that must be mitigated is the possibility of the dynamic dictionary (the string-to-code mapping table) becoming too large.</span></span> <span data-ttu-id="6b95c-314">Esse dicionário pode ser expandido ao longo de várias mensagens e então o `MaxReceivedMessageSize` cota não oferece nenhuma proteção porque ele se aplica somente a cada mensagem separadamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-314">This dictionary may be expanded over the course of several messages, and so the `MaxReceivedMessageSize` quota offers no protection because it applies only to each message separately.</span></span> <span data-ttu-id="6b95c-315">Portanto, um separado <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> propriedade existir no <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement> que limita o tamanho do dicionário.</span><span class="sxs-lookup"><span data-stu-id="6b95c-315">Therefore, a separate <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> property exists on the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement> that limits the size of the dictionary.</span></span>

<span data-ttu-id="6b95c-316">Ao contrário da maioria das outras cotas, essa cota se aplica também ao escrever mensagens.</span><span class="sxs-lookup"><span data-stu-id="6b95c-316">Unlike most other quotas, this quota also applies when writing messages.</span></span> <span data-ttu-id="6b95c-317">Se ele for excedido durante a leitura de uma mensagem, o `QuotaExceededException` é lançada como de costume.</span><span class="sxs-lookup"><span data-stu-id="6b95c-317">If it is exceeded when reading a message, the `QuotaExceededException` is thrown as usual.</span></span> <span data-ttu-id="6b95c-318">Se ele for excedido durante a gravação de uma mensagem, qualquer cadeia de caracteres que fazem com que a cota seja excedido é gravadas como-está, sem usar o recurso dinâmico dicionários.</span><span class="sxs-lookup"><span data-stu-id="6b95c-318">If it is exceeded when writing a message, any strings that cause the quota to be exceeded are written as-is, without using the dynamic dictionaries feature.</span></span>

### <a name="dictionary-expansion-threats"></a><span data-ttu-id="6b95c-319">Ameaças de expansão de dicionário</span><span class="sxs-lookup"><span data-stu-id="6b95c-319">Dictionary Expansion Threats</span></span>

<span data-ttu-id="6b95c-320">Uma classe significativa de ataques de binário específico provém da expansão do dicionário.</span><span class="sxs-lookup"><span data-stu-id="6b95c-320">A significant class of binary-specific attacks arises from dictionary expansion.</span></span> <span data-ttu-id="6b95c-321">Uma pequena mensagem em formato binário pode transformar em uma mensagem muito grande em formulário textual totalmente expandido se ele faz uso extensivo do recurso de dicionários de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="6b95c-321">A small message in binary form may turn into a very large message in fully expanded textual form if it makes extensive use of the string dictionaries feature.</span></span> <span data-ttu-id="6b95c-322">O fator de expansão para cadeias de caracteres de dicionário dinâmico é limitado pelo <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> cota, porque nenhuma cadeia de caracteres de dicionário dinâmico excede o tamanho máximo do dicionário inteiro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-322">The expansion factor for dynamic dictionary strings is limited by the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> quota, because no dynamic dictionary string exceeds the maximum size of the entire dictionary.</span></span>

<span data-ttu-id="6b95c-323">O <xref:System.Xml.XmlDictionaryReaderQuotas.MaxNameTableCharCount%2A>, `MaxStringContentLength`, e `MaxArrayLength` propriedades apenas limitam o consumo de memória.</span><span class="sxs-lookup"><span data-stu-id="6b95c-323">The <xref:System.Xml.XmlDictionaryReaderQuotas.MaxNameTableCharCount%2A>, `MaxStringContentLength`, and `MaxArrayLength` properties only limit memory consumption.</span></span> <span data-ttu-id="6b95c-324">Eles normalmente não são necessários para minimizar essas ameaças no uso de não transmitidos por Streaming, porque o uso de memória já é limitado pelo `MaxReceivedMessageSize`.</span><span class="sxs-lookup"><span data-stu-id="6b95c-324">They are normally not required to mitigate any threats in the non-streamed usage because memory usage is already limited by `MaxReceivedMessageSize`.</span></span> <span data-ttu-id="6b95c-325">No entanto, `MaxReceivedMessageSize` contagens de bytes de expansão de pré-lançamento.</span><span class="sxs-lookup"><span data-stu-id="6b95c-325">However, `MaxReceivedMessageSize` counts pre-expansion bytes.</span></span> <span data-ttu-id="6b95c-326">Quando a codificação binária está em uso, consumo de memória potencialmente pode ir além `MaxReceivedMessageSize`limitada apenas por um fator de <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-326">When binary encoding is in use, memory consumption could potentially go beyond `MaxReceivedMessageSize`, limited only by a factor of <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A>.</span></span> <span data-ttu-id="6b95c-327">Por esse motivo, é importante sempre definir todas as cotas do leitor (especialmente <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>) ao usar a codificação binária.</span><span class="sxs-lookup"><span data-stu-id="6b95c-327">For this reason, it is important to always set all of the reader quotas (especially <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>) when using the binary encoding.</span></span>

<span data-ttu-id="6b95c-328">Ao usar a codificação binária junto com o <xref:System.Runtime.Serialization.DataContractSerializer>, o `IExtensibleDataObject` interface pode ser usado indevidamente para montar um ataque de expansão do dicionário.</span><span class="sxs-lookup"><span data-stu-id="6b95c-328">When using binary encoding together with the <xref:System.Runtime.Serialization.DataContractSerializer>, the `IExtensibleDataObject` interface can be misused to mount a dictionary expansion attack.</span></span> <span data-ttu-id="6b95c-329">Essencialmente, essa interface fornece armazenamento ilimitado para dados arbitrários que não não uma parte do contrato.</span><span class="sxs-lookup"><span data-stu-id="6b95c-329">This interface essentially provides unlimited storage for arbitrary data that is not a part of the contract.</span></span> <span data-ttu-id="6b95c-330">Se as cotas não podem ser definidas como baixas o suficiente, de modo que `MaxSessionSize` multiplicado por `MaxReceivedMessageSize` não representar um problema, desabilite o `IExtensibleDataObject` ao usar a codificação binária de recursos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-330">If quotas cannot be set low enough such that `MaxSessionSize` multiplied by `MaxReceivedMessageSize` does not pose a problem, disable the `IExtensibleDataObject` feature when using the binary encoding.</span></span> <span data-ttu-id="6b95c-331">Defina a `IgnoreExtensionDataObject` propriedade para `true` no `ServiceBehaviorAttribute` atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-331">Set the `IgnoreExtensionDataObject` property to `true` on the `ServiceBehaviorAttribute` attribute.</span></span> <span data-ttu-id="6b95c-332">Como alternativa, não implemente o `IExtensibleDataObject` interface.</span><span class="sxs-lookup"><span data-stu-id="6b95c-332">Alternatively, do not implement the `IExtensibleDataObject` interface.</span></span> <span data-ttu-id="6b95c-333">Para obter mais informações, consulte [Contratos de dados compatíveis por encaminhamento](../../../../docs/framework/wcf/feature-details/forward-compatible-data-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-333">For more information, see [Forward-Compatible Data Contracts](../../../../docs/framework/wcf/feature-details/forward-compatible-data-contracts.md).</span></span>

### <a name="quotas-summary"></a><span data-ttu-id="6b95c-334">Resumo de cotas</span><span class="sxs-lookup"><span data-stu-id="6b95c-334">Quotas Summary</span></span>

<span data-ttu-id="6b95c-335">A tabela a seguir resume as orientações sobre as cotas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-335">The following table summarizes the guidance about quotas.</span></span>

|<span data-ttu-id="6b95c-336">Condição</span><span class="sxs-lookup"><span data-stu-id="6b95c-336">Condition</span></span>|<span data-ttu-id="6b95c-337">Cotas importantes para definir</span><span class="sxs-lookup"><span data-stu-id="6b95c-337">Important quotas to set</span></span>|
|---------------|-----------------------------|
|<span data-ttu-id="6b95c-338">Sem streaming ou transmissão de mensagens pequenas, texto ou codificação de MTOM</span><span class="sxs-lookup"><span data-stu-id="6b95c-338">No streaming or streaming small messages, text, or MTOM encoding</span></span>|<span data-ttu-id="6b95c-339">`MaxReceivedMessageSize`, `MaxBytesPerRead` e `MaxDepth`</span><span class="sxs-lookup"><span data-stu-id="6b95c-339">`MaxReceivedMessageSize`, `MaxBytesPerRead`, and `MaxDepth`</span></span>|
|<span data-ttu-id="6b95c-340">Sem streaming ou transmissão de mensagens pequenas, binárias de codificação</span><span class="sxs-lookup"><span data-stu-id="6b95c-340">No streaming or streaming small messages, binary encoding</span></span>|<span data-ttu-id="6b95c-341">`MaxReceivedMessageSize`, `MaxSessionSize`e todos os `ReaderQuotas`</span><span class="sxs-lookup"><span data-stu-id="6b95c-341">`MaxReceivedMessageSize`, `MaxSessionSize`, and all `ReaderQuotas`</span></span>|
|<span data-ttu-id="6b95c-342">Transmissão de mensagens grandes, texto ou codificação de MTOM</span><span class="sxs-lookup"><span data-stu-id="6b95c-342">Streaming large messages, text, or MTOM encoding</span></span>|<span data-ttu-id="6b95c-343">`MaxBufferSize` e tudo `ReaderQuotas`</span><span class="sxs-lookup"><span data-stu-id="6b95c-343">`MaxBufferSize` and all `ReaderQuotas`</span></span>|
|<span data-ttu-id="6b95c-344">Streaming mensagens grandes, binárias de codificação</span><span class="sxs-lookup"><span data-stu-id="6b95c-344">Streaming large messages, binary encoding</span></span>|<span data-ttu-id="6b95c-345">`MaxBufferSize`, `MaxSessionSize`e todos os `ReaderQuotas`</span><span class="sxs-lookup"><span data-stu-id="6b95c-345">`MaxBufferSize`, `MaxSessionSize`, and all `ReaderQuotas`</span></span>|

- <span data-ttu-id="6b95c-346">Tempos limite no nível de transporte devem sempre ser definidos e nunca usem leituras/gravações síncronas quando streaming estiver em uso, independentemente se você estiver transmitindo mensagens grandes ou pequenas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-346">Transport-level time-outs must always be set and never use synchronous reads/writes when streaming is in use, regardless of whether you are streaming large or small messages.</span></span>

- <span data-ttu-id="6b95c-347">Em caso de dúvida sobre uma cota, defina-o como um valor seguro em vez de deixá-la aberta.</span><span class="sxs-lookup"><span data-stu-id="6b95c-347">When in doubt about a quota, set it to a safe value rather than leaving it open.</span></span>

## <a name="preventing-malicious-code-execution"></a><span data-ttu-id="6b95c-348">Impedindo a execução de código mal-intencionado</span><span class="sxs-lookup"><span data-stu-id="6b95c-348">Preventing Malicious Code Execution</span></span>

<span data-ttu-id="6b95c-349">As seguintes classes gerais de ameaças podem executar o código e ter efeitos indesejados:</span><span class="sxs-lookup"><span data-stu-id="6b95c-349">The following general classes of threats can execute code and have unintended effects:</span></span>

- <span data-ttu-id="6b95c-350">O desserializador carrega um tipo não seguro, mal-intencionado ou sensível à segurança.</span><span class="sxs-lookup"><span data-stu-id="6b95c-350">The deserializer loads a malicious, unsafe, or security-sensitive type.</span></span>

- <span data-ttu-id="6b95c-351">Uma mensagem de entrada faz com que o desserializador construir uma instância de um tipo normalmente segura de tal forma que ele tem consequências não intencionais.</span><span class="sxs-lookup"><span data-stu-id="6b95c-351">An incoming message causes the deserializer to construct an instance of a normally safe type in such a way that it has unintended consequences.</span></span>

<span data-ttu-id="6b95c-352">As seções a seguir discutem essas classes de ameaças ainda mais.</span><span class="sxs-lookup"><span data-stu-id="6b95c-352">The following sections discuss these classes of threats further.</span></span>

## <a name="datacontractserializer"></a><span data-ttu-id="6b95c-353">DataContractSerializer</span><span class="sxs-lookup"><span data-stu-id="6b95c-353">DataContractSerializer</span></span>

<span data-ttu-id="6b95c-354">(Para obter informações de segurança sobre o <xref:System.Xml.Serialization.XmlSerializer>, consulte a documentação relevante.) O modelo de segurança para o <xref:System.Xml.Serialization.XmlSerializer> é semelhante do <xref:System.Runtime.Serialization.DataContractSerializer>e diferem principalmente em detalhes.</span><span class="sxs-lookup"><span data-stu-id="6b95c-354">(For security information on the <xref:System.Xml.Serialization.XmlSerializer>, see the relevant documentation.) The security model for the <xref:System.Xml.Serialization.XmlSerializer> is similar to that of the <xref:System.Runtime.Serialization.DataContractSerializer>, and differs mostly in details.</span></span> <span data-ttu-id="6b95c-355">Por exemplo, o <xref:System.Xml.Serialization.XmlIncludeAttribute> atributo é usado para inclusão de tipo em vez do <xref:System.Runtime.Serialization.KnownTypeAttribute> atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-355">For example, the <xref:System.Xml.Serialization.XmlIncludeAttribute> attribute is used for type inclusion instead of the <xref:System.Runtime.Serialization.KnownTypeAttribute> attribute.</span></span> <span data-ttu-id="6b95c-356">No entanto, algumas ameaças exclusivas para o <xref:System.Xml.Serialization.XmlSerializer> discutidos posteriormente neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6b95c-356">However, some threats unique to the <xref:System.Xml.Serialization.XmlSerializer> are discussed later in this topic.</span></span>

### <a name="preventing-unintended-types-from-being-loaded"></a><span data-ttu-id="6b95c-357">Impedir que os tipos não intencionais que está sendo carregado</span><span class="sxs-lookup"><span data-stu-id="6b95c-357">Preventing Unintended Types from Being Loaded</span></span>

<span data-ttu-id="6b95c-358">Carregamento de tipos não intencionais pode ter consequências importantes, se o tipo é mal-intencionado ou apenas tem efeitos colaterais de sensível à segurança.</span><span class="sxs-lookup"><span data-stu-id="6b95c-358">Loading unintended types may have significant consequences, whether the type is malicious or just has security-sensitive side effects.</span></span> <span data-ttu-id="6b95c-359">Um tipo pode conter vulnerabilidades de segurança explorável, realizar ações confidenciais de segurança em seu construtor ou o construtor de classe, têm um grande volume de memória que facilita os ataques de negação de serviço, ou pode lançar exceções não recuperável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-359">A type may contain exploitable security vulnerability, perform security-sensitive actions in its constructor or class constructor, have a large memory footprint that facilitates denial-of-service attacks, or may throw non-recoverable exceptions.</span></span> <span data-ttu-id="6b95c-360">Tipos podem ter construtores de classe que são executados assim que o tipo é carregado e antes de todas as instâncias são criadas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-360">Types may have class constructors that run as soon as the type is loaded and before any instances are created.</span></span> <span data-ttu-id="6b95c-361">Por esses motivos, é importante controlar o conjunto de tipos que o desserializador pode ser carregado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-361">For these reasons, it is important to control the set of types that the deserializer may load.</span></span>

<span data-ttu-id="6b95c-362">O <xref:System.Runtime.Serialization.DataContractSerializer> desserializa em uma forma acoplada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-362">The <xref:System.Runtime.Serialization.DataContractSerializer> deserializes in a loosely coupled way.</span></span> <span data-ttu-id="6b95c-363">Ele nunca lê common language runtime (CLR) nomes de tipo e assembly dos dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-363">It never reads common language runtime (CLR) type and assembly names from the incoming data.</span></span> <span data-ttu-id="6b95c-364">Isso é semelhante ao comportamento do <xref:System.Xml.Serialization.XmlSerializer>, mas é diferente do comportamento do <xref:System.Runtime.Serialization.NetDataContractSerializer>, <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>e o <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-364">This is similar to the behavior of the <xref:System.Xml.Serialization.XmlSerializer>, but differs from the behavior of the <xref:System.Runtime.Serialization.NetDataContractSerializer>, <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>, and the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span></span> <span data-ttu-id="6b95c-365">Um acoplamento apresenta um grau de segurança, pois o invasor remoto não pode indicar um tipo arbitrário para carregar apenas por esse tipo na mensagem de nomenclatura.</span><span class="sxs-lookup"><span data-stu-id="6b95c-365">Loose coupling introduces a degree of safety, because the remote attacker cannot indicate an arbitrary type to load just by naming that type in the message.</span></span>

<span data-ttu-id="6b95c-366">O <xref:System.Runtime.Serialization.DataContractSerializer> sempre tem permissão para carregar um tipo que está atualmente previsto acordo com o contrato.</span><span class="sxs-lookup"><span data-stu-id="6b95c-366">The <xref:System.Runtime.Serialization.DataContractSerializer> is always allowed to load a type that is currently expected according to the contract.</span></span> <span data-ttu-id="6b95c-367">Por exemplo, se um contrato de dados tem um membro de dados do tipo `Customer`, o <xref:System.Runtime.Serialization.DataContractSerializer> tem permissão para carregar o `Customer` tipo quando ele desserializa este membro de dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-367">For example, if a data contract has a data member of type `Customer`, the <xref:System.Runtime.Serialization.DataContractSerializer> is allowed to load the `Customer` type when it deserializes this data member.</span></span>

<span data-ttu-id="6b95c-368">Além disso, o <xref:System.Runtime.Serialization.DataContractSerializer> oferece suporte a polimorfismo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-368">Additionally, the <xref:System.Runtime.Serialization.DataContractSerializer> supports polymorphism.</span></span> <span data-ttu-id="6b95c-369">Um membro de dados pode ser declarado como <xref:System.Object>, mas os dados de entrada podem conter um `Customer` instância.</span><span class="sxs-lookup"><span data-stu-id="6b95c-369">A data member may be declared as <xref:System.Object>, but the incoming data may contain a `Customer` instance.</span></span> <span data-ttu-id="6b95c-370">Isso é possível somente se o `Customer` tipo foi feito "conhecido" para o desserializador por meio de um desses mecanismos:</span><span class="sxs-lookup"><span data-stu-id="6b95c-370">This is possible only if the `Customer` type has been made "known" to the deserializer through one of these mechanisms:</span></span>

- <span data-ttu-id="6b95c-371"><xref:System.Runtime.Serialization.KnownTypeAttribute> atributo aplicado a um tipo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-371"><xref:System.Runtime.Serialization.KnownTypeAttribute> attribute applied to a type.</span></span>

- <span data-ttu-id="6b95c-372">`KnownTypeAttribute` especificando um método que retorna uma lista de tipos de atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-372">`KnownTypeAttribute` attribute specifying a method that returns a list of types.</span></span>

- <span data-ttu-id="6b95c-373">`ServiceKnownTypeAttribute` atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-373">`ServiceKnownTypeAttribute` attribute.</span></span>

- <span data-ttu-id="6b95c-374">O `KnownTypes` seção de configuração.</span><span class="sxs-lookup"><span data-stu-id="6b95c-374">The `KnownTypes` configuration section.</span></span>

- <span data-ttu-id="6b95c-375">Uma lista de tipos conhecidos passados explicitamente para o <xref:System.Runtime.Serialization.DataContractSerializer> durante a construção, se usar o serializador diretamente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-375">A list of known types explicitly passed to the <xref:System.Runtime.Serialization.DataContractSerializer> during construction, if using the serializer directly.</span></span>

<span data-ttu-id="6b95c-376">Cada um desses mecanismos aumenta a área de superfície com a introdução de mais tipos que o desserializador pode carregar.</span><span class="sxs-lookup"><span data-stu-id="6b95c-376">Each of these mechanisms increases the surface area by introducing more types that the deserializer can load.</span></span> <span data-ttu-id="6b95c-377">Controle cada um desses mecanismos para garantir que nenhum tipo mal-intencionado ou não intencional é adicionado à lista de tipos conhecidos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-377">Control each of these mechanisms to ensure no malicious or unintended types are added to the known types list.</span></span>

<span data-ttu-id="6b95c-378">Depois que um tipo conhecido está no escopo, ele pode ser carregado a qualquer momento e instâncias do tipo podem ser criadas, mesmo se o contrato proíbe o uso efetivo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-378">Once a known type is in scope, it can be loaded at any time, and instances of the type can be created, even if the contract forbids actually using it.</span></span> <span data-ttu-id="6b95c-379">Por exemplo, suponha que o tipo "MyDangerousType" é adicionado à lista de tipos conhecidos usando um dos mecanismos acima.</span><span class="sxs-lookup"><span data-stu-id="6b95c-379">For example, suppose the type "MyDangerousType" is added to the known types list using one of the mechanisms above.</span></span> <span data-ttu-id="6b95c-380">Isso significa que:</span><span class="sxs-lookup"><span data-stu-id="6b95c-380">This means that:</span></span>

- <span data-ttu-id="6b95c-381">`MyDangerousType` é carregado e seu construtor de classe seja executado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-381">`MyDangerousType` is loaded and its class constructor runs.</span></span>

- <span data-ttu-id="6b95c-382">Mesmo quando a desserialização de um contrato de dados com um membro de dados de cadeia de caracteres, uma mensagem mal-intencionada ainda pode causar uma instância de `MyDangerousType` para criar.</span><span class="sxs-lookup"><span data-stu-id="6b95c-382">Even when deserializing a data contract with a string data member, a malicious message may still cause an instance of `MyDangerousType` to create.</span></span> <span data-ttu-id="6b95c-383">O código no `MyDangerousType`, como setters de propriedade podem ser executadas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-383">Code in `MyDangerousType`, such as property setters, may run.</span></span> <span data-ttu-id="6b95c-384">Depois que isso for feito, o desserializador tenta atribuir essa instância para o membro de dados de cadeia de caracteres e falhar com uma exceção.</span><span class="sxs-lookup"><span data-stu-id="6b95c-384">After this is done, the deserializer tries to assign this instance to the string data member and fail with an exception.</span></span>

<span data-ttu-id="6b95c-385">Ao escrever um método que retorna uma lista de tipos conhecidos, ou ao passar uma lista diretamente para o <xref:System.Runtime.Serialization.DataContractSerializer> construtor, certifique-se de que o código que prepara a lista é seguro e funciona apenas em dados confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-385">When writing a method that returns a list of known types, or when passing a list directly to the <xref:System.Runtime.Serialization.DataContractSerializer> constructor, ensure that the code that prepares the list is secure and operates only on trusted data.</span></span>

<span data-ttu-id="6b95c-386">Se especificar os tipos conhecidos na configuração, certifique-se de que o arquivo de configuração é seguro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-386">If specifying known types in configuration, ensure that the configuration file is secure.</span></span> <span data-ttu-id="6b95c-387">Sempre use nomes fortes na configuração (especificando a chave pública do assembly assinado em que reside o tipo), mas não especificar a versão do tipo a ser carregado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-387">Always use strong names in configuration (by specifying the public key of the signed assembly where the type resides), but do not specify the version of the type to load.</span></span> <span data-ttu-id="6b95c-388">O carregador do tipo escolhe automaticamente a versão mais recente, se possível.</span><span class="sxs-lookup"><span data-stu-id="6b95c-388">The type loader automatically picks the latest version, if possible.</span></span> <span data-ttu-id="6b95c-389">Se você especificar uma versão específica na configuração, você corre o risco a seguir: Um tipo pode ter uma vulnerabilidade de segurança que pode ser corrigida em uma versão futura, mas ainda é a versão vulnerável carregado porque ela é explicitamente especificada na configuração.</span><span class="sxs-lookup"><span data-stu-id="6b95c-389">If you specify a particular version in configuration, you run the following risk: A type may have a security vulnerability that may be fixed in a future version, but the vulnerable version still loads because it is explicitly specified in configuration.</span></span>

<span data-ttu-id="6b95c-390">Número excessivo de tipos conhecidos tem outra consequência: O <xref:System.Runtime.Serialization.DataContractSerializer> cria um cache de código de serialização/desserialização no domínio do aplicativo, com uma entrada para cada tipo, ele deve serializar e desserializar.</span><span class="sxs-lookup"><span data-stu-id="6b95c-390">Having too many known types has another consequence: The <xref:System.Runtime.Serialization.DataContractSerializer> creates a cache of serialization/deserialization code in the application domain, with an entry for each type it must serialize and deserialize.</span></span> <span data-ttu-id="6b95c-391">Esse cache nunca é limpo, desde que o domínio do aplicativo está em execução.</span><span class="sxs-lookup"><span data-stu-id="6b95c-391">This cache is never cleared as long as the application domain is running.</span></span> <span data-ttu-id="6b95c-392">Portanto, um invasor que está ciente de que um aplicativo usa muitos tipos conhecidos pode fazer com que a desserialização de todos esses tipos, fazendo com que o cache consumir uma desproporcionalmente grande quantidade de memória.</span><span class="sxs-lookup"><span data-stu-id="6b95c-392">Therefore, an attacker who is aware that an application uses many known types can cause the deserialization of all these types, causing the cache to consume a disproportionately large amount of memory.</span></span>

### <a name="preventing-types-from-being-in-an-unintended-state"></a><span data-ttu-id="6b95c-393">Impedir que os tipos de estar em um estado não pretendido</span><span class="sxs-lookup"><span data-stu-id="6b95c-393">Preventing Types from Being in an Unintended State</span></span>

<span data-ttu-id="6b95c-394">Um tipo pode ter restrições de consistência interno que devem ser impostas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-394">A type may have internal consistency constraints that must be enforced.</span></span> <span data-ttu-id="6b95c-395">Deve-se ter cuidado para evitar a interrupção essas restrições durante a desserialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-395">Care must be taken to avoid breaking these constraints during deserialization.</span></span>

<span data-ttu-id="6b95c-396">O exemplo a seguir de um tipo representa o estado de uma câmara de vácuo de uma nave espacial e impõe a restrição que interna e as portas externas não podem ser abertas ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-396">The following example of a type represents the state of an airlock on a spacecraft, and enforces the constraint that both the inner and the outer doors cannot be open at the same time.</span></span>

[!code-csharp[DataContractAttribute#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/datacontractattribute/cs/overview.cs#3)]
[!code-vb[DataContractAttribute#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/datacontractattribute/vb/overview.vb#3)]

<span data-ttu-id="6b95c-397">Um invasor pode enviar uma mensagem mal-intencionada, como este, contornar as restrições e Obtendo o objeto em um estado inválido, que pode ter consequências não intencionais e imprevisíveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-397">An attacker may send a malicious message like this, getting around the constraints and getting the object into an invalid state, which may have unintended and unpredictable consequences.</span></span>

```xml
<SpaceStationAirlock>
    <innerDoorOpen>true</innerDoorOpen>
    <outerDoorOpen>true</outerDoorOpen>
</SpaceStationAirlock>
```

<span data-ttu-id="6b95c-398">Essa situação pode ser evitada com esteja ciente de que os seguintes pontos:</span><span class="sxs-lookup"><span data-stu-id="6b95c-398">This situation can be avoided by being aware of the following points:</span></span>

- <span data-ttu-id="6b95c-399">Quando o <xref:System.Runtime.Serialization.DataContractSerializer> desserializa a maioria das classes, construtores não são executados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-399">When the <xref:System.Runtime.Serialization.DataContractSerializer> deserializes most classes, constructors do not run.</span></span> <span data-ttu-id="6b95c-400">Portanto, não confie em qualquer gerenciamento de estado feito no construtor.</span><span class="sxs-lookup"><span data-stu-id="6b95c-400">Therefore, do not rely on any state management done in the constructor.</span></span>

- <span data-ttu-id="6b95c-401">Use retornos de chamada para garantir que o objeto está em um estado válido.</span><span class="sxs-lookup"><span data-stu-id="6b95c-401">Use callbacks to ensure that the object is in a valid state.</span></span> <span data-ttu-id="6b95c-402">O retorno de chamada é marcado com o <xref:System.Runtime.Serialization.OnDeserializedAttribute> atributo é especialmente útil porque ele é executado após a desserialização é concluída e tem a oportunidade de examinar e corrigir o estado geral.</span><span class="sxs-lookup"><span data-stu-id="6b95c-402">The callback marked with the <xref:System.Runtime.Serialization.OnDeserializedAttribute> attribute is especially useful because it runs after deserialization is complete and has a chance to examine and correct the overall state.</span></span> <span data-ttu-id="6b95c-403">Para obter mais informações, consulte [retornos de chamada de serialização tolerantes à versão](../../../../docs/framework/wcf/feature-details/version-tolerant-serialization-callbacks.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-403">For more information, see [Version-Tolerant Serialization Callbacks](../../../../docs/framework/wcf/feature-details/version-tolerant-serialization-callbacks.md).</span></span>

- <span data-ttu-id="6b95c-404">Não crie tipos de contrato de dados para contar com uma ordem específica na qual propriedade setters devem ser chamados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-404">Do not design data contract types to rely on any particular order in which property setters must be called.</span></span>

- <span data-ttu-id="6b95c-405">Tenha cuidado ao usar tipos herdados marcados com o <xref:System.SerializableAttribute> atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-405">Take care using legacy types marked with the <xref:System.SerializableAttribute> attribute.</span></span> <span data-ttu-id="6b95c-406">Muitos deles foram projetados para funcionar com [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] comunicação remota para uso com dados confiáveis apenas.</span><span class="sxs-lookup"><span data-stu-id="6b95c-406">Many of them were designed to work with [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] remoting for use with trusted data only.</span></span> <span data-ttu-id="6b95c-407">Os tipos existentes marcados com esse atributo não podem ter sido projetados com segurança de estado em mente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-407">Existing types marked with this attribute may not have been designed with state safety in mind.</span></span>

- <span data-ttu-id="6b95c-408">Não confie na <xref:System.Runtime.Serialization.DataMemberAttribute.IsRequired%2A> propriedade do <xref:System.Runtime.Serialization.DataMemberAttribute> atributo para garantir a presença de dados que diz respeito a segurança de estado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-408">Do not rely on the <xref:System.Runtime.Serialization.DataMemberAttribute.IsRequired%2A> property of the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute to guarantee presence of data as far as state safety is concerned.</span></span> <span data-ttu-id="6b95c-409">Dados podem ser sempre `null`, `zero`, ou `invalid`.</span><span class="sxs-lookup"><span data-stu-id="6b95c-409">Data could always be `null`, `zero`, or `invalid`.</span></span>

- <span data-ttu-id="6b95c-410">Nunca confiança um grafo de objeto desserializado de uma fonte de dados não confiáveis sem validá-lo primeiro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-410">Never trust an object graph deserialized from an untrusted data source without validating it first.</span></span> <span data-ttu-id="6b95c-411">Cada objeto individual pode estar em um estado consistente, mas o grafo de objeto que não pode ser um inteiro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-411">Each individual object may be in a consistent state, but the object graph as a whole may not be.</span></span> <span data-ttu-id="6b95c-412">Além disso, mesmo se o modo de preservação do gráfico de objeto for desabilitado, o grafo desserializado pode ter várias referências ao mesmo objeto ou ter referências circulares.</span><span class="sxs-lookup"><span data-stu-id="6b95c-412">Furthermore, even if the object graph preservation mode is disabled, the deserialized graph may have multiple references to the same object or have circular references.</span></span> <span data-ttu-id="6b95c-413">Para obter mais informações, consulte [serialização e desserialização](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-413">For more information, see [Serialization and Deserialization](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).</span></span>

### <a name="using-the-netdatacontractserializer-securely"></a><span data-ttu-id="6b95c-414">Usando o NetDataContractSerializer com segurança</span><span class="sxs-lookup"><span data-stu-id="6b95c-414">Using the NetDataContractSerializer Securely</span></span>

<span data-ttu-id="6b95c-415">O <xref:System.Runtime.Serialization.NetDataContractSerializer> é um mecanismo de serialização que usa tipos de acoplamento rígido.</span><span class="sxs-lookup"><span data-stu-id="6b95c-415">The <xref:System.Runtime.Serialization.NetDataContractSerializer> is a serialization engine that uses tight coupling to types.</span></span> <span data-ttu-id="6b95c-416">Isso é semelhante a <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> e o <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-416">This is similar to the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> and the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span></span> <span data-ttu-id="6b95c-417">Ou seja, ele determina que tipo de instanciar lendo o [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] nome do assembly e tipo de dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="6b95c-417">That is, it determines which type to instantiate by reading the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] assembly and type name from the incoming data.</span></span> <span data-ttu-id="6b95c-418">Embora seja uma parte do WCF, não há nenhuma maneira fornecida de conectar esse mecanismo de serialização; código personalizado deve ser escrito.</span><span class="sxs-lookup"><span data-stu-id="6b95c-418">Although it is a part of WCF, there is no supplied way of plugging in this serialization engine; custom code must be written.</span></span> <span data-ttu-id="6b95c-419">O `NetDataContractSerializer` é fornecido principalmente para facilitar a migração do [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] comunicação remota para o WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-419">The `NetDataContractSerializer` is provided primarily to ease migration from [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] remoting to WCF.</span></span> <span data-ttu-id="6b95c-420">Para obter mais informações, consulte a seção relevante [serialização e desserialização](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).</span><span class="sxs-lookup"><span data-stu-id="6b95c-420">For more information, see the relevant section in [Serialization and Deserialization](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).</span></span>

<span data-ttu-id="6b95c-421">Porque a mensagem em si pode indicar qualquer tipo pode ser carregado, o <xref:System.Runtime.Serialization.NetDataContractSerializer> mecanismo é inerentemente inseguro e deve ser usado somente com dados confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-421">Because the message itself may indicate any type can be loaded, the <xref:System.Runtime.Serialization.NetDataContractSerializer> mechanism is inherently insecure and should be used only with trusted data.</span></span> <span data-ttu-id="6b95c-422">É possível torná-lo seguro, escrevendo um associador de tipo seguro, limitando o tipo que permite que apenas tipos seguros de carga (usando o <xref:System.Runtime.Serialization.NetDataContractSerializer.Binder%2A> propriedade).</span><span class="sxs-lookup"><span data-stu-id="6b95c-422">It is possible to make it secure by writing a secure, type-limiting type binder that allows only safe types to load (using the <xref:System.Runtime.Serialization.NetDataContractSerializer.Binder%2A> property).</span></span>

<span data-ttu-id="6b95c-423">Mesmo quando usados com dados confiáveis, os dados de entrada podem especificar o tipo para carregar, especialmente se o <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> estiver definida como <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle.Simple>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-423">Even when used with trusted data, the incoming data may insufficiently specify the type to load, especially if the <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> property is set to <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle.Simple>.</span></span> <span data-ttu-id="6b95c-424">Qualquer pessoa com acesso ao diretório do aplicativo ou ao cache de assembly global pode substituir um tipo mal-intencionados no lugar do que deveria ser carregado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-424">Anyone with access to the application’s directory or to the global assembly cache can substitute a malicious type in place of the one that is supposed to load.</span></span> <span data-ttu-id="6b95c-425">Sempre verifique se a segurança do diretório do aplicativo e do cache de assembly global, corretamente definindo permissões.</span><span class="sxs-lookup"><span data-stu-id="6b95c-425">Always ensure the security of your application’s directory and of the global assembly cache by correctly setting permissions.</span></span>

<span data-ttu-id="6b95c-426">Em geral, se você permitir o acesso do código parcialmente confiável para seus `NetDataContractSerializer` da instância ou outra forma controla o seletor substituto (<xref:System.Runtime.Serialization.ISurrogateSelector>) ou o associador de serialização (<xref:System.Runtime.Serialization.SerializationBinder>), o código pode exercer um grande controle sobre o processo de serialização/desserialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-426">In general, if you allow partially trusted code access to your `NetDataContractSerializer` instance or otherwise control the surrogate selector (<xref:System.Runtime.Serialization.ISurrogateSelector>) or the serialization binder (<xref:System.Runtime.Serialization.SerializationBinder>), the code may exercise a great deal of control over the serialization/deserialization process.</span></span> <span data-ttu-id="6b95c-427">Por exemplo, ele pode injetar tipos arbitrários, levar à divulgação de informações, violar o grafo de objeto resultante ou os dados serializados ou estouro resultante fluxo serializado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-427">For example, it may inject arbitrary types, lead to information disclosure, tamper with the resulting object graph or serialized data, or overflow the resultant serialized stream.</span></span>

<span data-ttu-id="6b95c-428">Outra preocupação de segurança com o `NetDataContractSerializer` é uma negação de serviço, não uma ameaça de execução de código mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-428">Another security concern with the `NetDataContractSerializer` is a denial of service, not a malicious code execution threat.</span></span> <span data-ttu-id="6b95c-429">Ao usar o `NetDataContractSerializer`, sempre defina o <xref:System.Runtime.Serialization.NetDataContractSerializer.MaxItemsInObjectGraph%2A> cota como um valor seguro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-429">When using the `NetDataContractSerializer`, always set the <xref:System.Runtime.Serialization.NetDataContractSerializer.MaxItemsInObjectGraph%2A> quota to a safe value.</span></span> <span data-ttu-id="6b95c-430">É fácil construir uma pequena mensagem mal-intencionada que aloca uma matriz de objetos cujo tamanho é limitado apenas por essa cota.</span><span class="sxs-lookup"><span data-stu-id="6b95c-430">It is easy to construct a small malicious message that allocates an array of objects whose size is limited only by this quota.</span></span>

### <a name="xmlserializer-specific-threats"></a><span data-ttu-id="6b95c-431">Ameaças específicas de XmlSerializer</span><span class="sxs-lookup"><span data-stu-id="6b95c-431">XmlSerializer-Specific Threats</span></span>

<span data-ttu-id="6b95c-432">O <xref:System.Xml.Serialization.XmlSerializer> modelo de segurança é semelhante do <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-432">The <xref:System.Xml.Serialization.XmlSerializer> security model is similar to that of the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="6b95c-433">Algumas ameaças, no entanto, são exclusivas para o <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="6b95c-433">A few threats, however, are unique to the <xref:System.Xml.Serialization.XmlSerializer>.</span></span>

<span data-ttu-id="6b95c-434">O <xref:System.Xml.Serialization.XmlSerializer> gera *assemblies de serialização* em tempo de execução que contêm código que realmente serializa e desserializa; esses assemblies são criados em um diretório de arquivos temporários.</span><span class="sxs-lookup"><span data-stu-id="6b95c-434">The <xref:System.Xml.Serialization.XmlSerializer> generates *serialization assemblies* at runtime that contain code that actually serializes and deserializes; these assemblies are created in a temporary files directory.</span></span> <span data-ttu-id="6b95c-435">Se algum outro processo ou usuário tem direitos de acesso a esse diretório, elas podem substituir o código de serialização/desserialização com um código arbitrário.</span><span class="sxs-lookup"><span data-stu-id="6b95c-435">If some other process or user has access rights to that directory, they may overwrite the serialization/deserialization code with arbitrary code.</span></span> <span data-ttu-id="6b95c-436">O <xref:System.Xml.Serialization.XmlSerializer> executa esse código usando seu contexto de segurança, em vez do código de serialização/desserialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-436">The <xref:System.Xml.Serialization.XmlSerializer> then runs this code using its security context, instead of the serialization/deserialization code.</span></span> <span data-ttu-id="6b95c-437">Verifique se que as permissões estão definidas corretamente no diretório de arquivos temporários para evitar que isso aconteça.</span><span class="sxs-lookup"><span data-stu-id="6b95c-437">Make sure the permissions are set correctly on the temporary files directory to prevent this from happening.</span></span>

<span data-ttu-id="6b95c-438">O <xref:System.Xml.Serialization.XmlSerializer> também tem um modo em que ele usa os assemblies de serialização pré-gerado em vez de gerá-las em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="6b95c-438">The <xref:System.Xml.Serialization.XmlSerializer> also has a mode in which it uses pre-generated serialization assemblies instead of generating them at runtime.</span></span> <span data-ttu-id="6b95c-439">Esse modo é disparado sempre que o <xref:System.Xml.Serialization.XmlSerializer> pode encontrar um assembly de serialização adequado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-439">This mode is triggered whenever the <xref:System.Xml.Serialization.XmlSerializer> can find a suitable serialization assembly.</span></span> <span data-ttu-id="6b95c-440">O <xref:System.Xml.Serialization.XmlSerializer> verificações ou não o assembly de serialização foi assinado pela mesma chave que foi usado para assinar o assembly que contém os tipos que está sendo serializados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-440">The <xref:System.Xml.Serialization.XmlSerializer> checks whether or not the serialization assembly was signed by the same key that was used to sign the assembly that contains the types being serialized.</span></span> <span data-ttu-id="6b95c-441">Isso oferece proteção contra assemblies maliciosos sendo disfarçados como assemblies de serialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-441">This offers protection from malicious assemblies being disguised as serialization assemblies.</span></span> <span data-ttu-id="6b95c-442">No entanto, se o assembly que contém seus tipos serializáveis não estiver assinado, o <xref:System.Xml.Serialization.XmlSerializer> não é possível executar essa verificação e usa qualquer assembly com o nome correto.</span><span class="sxs-lookup"><span data-stu-id="6b95c-442">However, if the assembly that contains your serializable types is not signed, the <xref:System.Xml.Serialization.XmlSerializer> cannot perform this check and uses any assembly with the correct name.</span></span> <span data-ttu-id="6b95c-443">Isso possibilita executar código mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-443">This makes running malicious code possible.</span></span> <span data-ttu-id="6b95c-444">Sempre assinar os assemblies que contêm seus tipos serializáveis ou controlar rigorosamente o acesso ao diretório do seu aplicativo e o cache de assembly global para evitar a introdução de assemblies maliciosos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-444">Always sign the assemblies that contain your serializable types, or tightly control access to your application’s directory and the global assembly cache to prevent the introduction of malicious assemblies.</span></span>

<span data-ttu-id="6b95c-445">O <xref:System.Xml.Serialization.XmlSerializer> podem estar sujeitos a um ataque de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-445">The <xref:System.Xml.Serialization.XmlSerializer> can be subject to a denial of service attack.</span></span> <span data-ttu-id="6b95c-446">O <xref:System.Xml.Serialization.XmlSerializer> não tem um `MaxItemsInObjectGraph` cota (como estão disponível no <xref:System.Runtime.Serialization.DataContractSerializer>).</span><span class="sxs-lookup"><span data-stu-id="6b95c-446">The <xref:System.Xml.Serialization.XmlSerializer> does not have a `MaxItemsInObjectGraph` quota (as is available on the <xref:System.Runtime.Serialization.DataContractSerializer>).</span></span> <span data-ttu-id="6b95c-447">Portanto, ela desserializa uma quantidade arbitrária de objetos, limitada somente pelo tamanho da mensagem.</span><span class="sxs-lookup"><span data-stu-id="6b95c-447">Thus, it deserializes an arbitrary amount of objects, limited only by the message size.</span></span>

### <a name="partial-trust-threats"></a><span data-ttu-id="6b95c-448">Ameaças de confiança parcial</span><span class="sxs-lookup"><span data-stu-id="6b95c-448">Partial Trust Threats</span></span>

<span data-ttu-id="6b95c-449">Observe as seguintes preocupações sobre ameaças relacionadas ao código em execução com confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="6b95c-449">Note the following concerns regarding threats related to code running with partial trust.</span></span> <span data-ttu-id="6b95c-450">Essas ameaças incluem código mal-intencionado parcialmente confiável, bem como código mal-intencionado parcialmente confiável em combinação com outros cenários de ataque (por exemplo, código parcialmente confiável que constrói uma cadeia de caracteres específica e, em seguida, desserializá-los).</span><span class="sxs-lookup"><span data-stu-id="6b95c-450">These threats include malicious partially-trusted code as well as malicious partially-trusted code in combination with other attack scenarios (for example, partially-trusted code that constructs a specific string and then deserializing it).</span></span>

- <span data-ttu-id="6b95c-451">Ao usar quaisquer componentes de serialização, nunca Declare qualquer permissões antes de tal uso, mesmo que o cenário de serialização toda está dentro do escopo de sua declaração, e você não está lidando com os dados não confiáveis ou objetos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-451">When using any serialization components, never assert any permissions before such usage, even if the entire serialization scenario is within the scope of your assert, and you are not dealing with any untrusted data or objects.</span></span> <span data-ttu-id="6b95c-452">Tal uso pode levar a vulnerabilidades de segurança.</span><span class="sxs-lookup"><span data-stu-id="6b95c-452">Such usage may lead to security vulnerabilities.</span></span>

- <span data-ttu-id="6b95c-453">Em casos em que o código parcialmente confiável tem controle sobre o processo de serialização, por meio de pontos de extensibilidade (substitutos), os tipos que está sendo serializados, ou por outros meios, o código parcialmente confiável pode fazer com que o serializador a ser uma grande quantidade de saída dados em fluxo serializado, o que pode causar negação de serviço (DoS) para o destinatário do fluxo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-453">In cases where partially-trusted code has control over the serialization process, either through extensibility points (surrogates), types being serialized, or through other means, the partially-trusted code may cause the serializer to output a large amount of data into the serialized stream, which may cause Denial of Service (DoS) to the receiver of this stream.</span></span> <span data-ttu-id="6b95c-454">Se você estiver serializando destinados a um destino que é sensível a ameaças de dados, não serializar os tipos de confiança parcial ou caso contrário, permita a serialização de controle do código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-454">If you are serializing data intended for a target that is sensitive to DoS threats, do not serialize partially-trusted types or otherwise let partially-trusted code control serialization.</span></span>

- <span data-ttu-id="6b95c-455">Se você permitir acesso a código parcialmente confiável para seus <xref:System.Runtime.Serialization.DataContractSerializer> da instância ou outra forma controla a [substitutos de contrato de dados](../../../../docs/framework/wcf/extending/data-contract-surrogates.md), ele pode exercer uma grande quantidade de controle sobre o processo de serialização/desserialização.</span><span class="sxs-lookup"><span data-stu-id="6b95c-455">If you allow partially-trusted code access to your <xref:System.Runtime.Serialization.DataContractSerializer> instance or otherwise control the [Data Contract Surrogates](../../../../docs/framework/wcf/extending/data-contract-surrogates.md), it may exercise a great deal of control over the serialization/deserialization process.</span></span> <span data-ttu-id="6b95c-456">Por exemplo, ele pode injetar tipos arbitrários, levar à divulgação de informações, violar o grafo de objeto resultante ou os dados serializados ou estouro resultante fluxo serializado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-456">For example, it may inject arbitrary types, lead to information disclosure, tamper with the resulting object graph or serialized data, or overflow the resultant serialized stream.</span></span> <span data-ttu-id="6b95c-457">Equivalente a <xref:System.Runtime.Serialization.NetDataContractSerializer> ameaça é descrita na seção "Usando o NetDataContractSerializer com segurança".</span><span class="sxs-lookup"><span data-stu-id="6b95c-457">An equivalent <xref:System.Runtime.Serialization.NetDataContractSerializer> threat is described in the "Using the NetDataContractSerializer Securely" section.</span></span>

- <span data-ttu-id="6b95c-458">Se o <xref:System.Runtime.Serialization.DataContractAttribute> atributo é aplicado a um tipo (ou o tipo é marcado como <xref:System.SerializableAttribute> , mas não é <xref:System.Runtime.Serialization.ISerializable>), o desserializador pode criar uma instância desse tipo, mesmo que todos os construtores não públicos ou protegidos por demanda.</span><span class="sxs-lookup"><span data-stu-id="6b95c-458">If the <xref:System.Runtime.Serialization.DataContractAttribute> attribute is applied to a type (or the type marked as <xref:System.SerializableAttribute> but is not <xref:System.Runtime.Serialization.ISerializable>), the deserializer can create an instance of such a type even if all constructors are non-public or protected by demands.</span></span>

- <span data-ttu-id="6b95c-459">Nunca confie o resultado da desserialização, a menos que os dados a ser desserializado são confiáveis e você tiver certeza de que todos os tipos conhecidos são tipos que você confia.</span><span class="sxs-lookup"><span data-stu-id="6b95c-459">Never trust the result of deserialization unless the data to be deserialized is trusted and you are certain that all known types are types that you trust.</span></span> <span data-ttu-id="6b95c-460">Observe que tipos conhecidos não são carregados do arquivo de configuração de aplicativo, (mas são carregados do arquivo de configuração do computador) quando em execução em confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="6b95c-460">Note that known types are not loaded from the application configuration file, (but are loaded from the computer configuration file) when running in partial trust.</span></span>

- <span data-ttu-id="6b95c-461">Se você passar um <xref:System.Runtime.Serialization.DataContractSerializer> instância com um substituto adicionado ao código parcialmente confiável, o código pode alterar quaisquer configurações modificáveis que substituto.</span><span class="sxs-lookup"><span data-stu-id="6b95c-461">If you pass a <xref:System.Runtime.Serialization.DataContractSerializer> instance with a surrogate added to partially-trusted code, the code can change any modifiable settings on that surrogate.</span></span>

- <span data-ttu-id="6b95c-462">Para um objeto desserializado, se o leitor de XML (ou os dados nele) vem do código parcialmente confiável, tratar o objeto desserializado resultante como dados não confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6b95c-462">For a deserialized object, if the XML reader (or the data therein) comes from partially-trusted code, treat the resulting deserialized object as untrusted data.</span></span>

- <span data-ttu-id="6b95c-463">O fato de que o <xref:System.Runtime.Serialization.ExtensionDataObject> não público do tipo tem membros não significa que os dados dentro dele são seguros.</span><span class="sxs-lookup"><span data-stu-id="6b95c-463">The fact that the <xref:System.Runtime.Serialization.ExtensionDataObject> type has no public members does not mean that data within it is secure.</span></span> <span data-ttu-id="6b95c-464">Por exemplo, se você desserializar a partir de uma fonte de dados com privilégios em um objeto no qual residem o alguns dados, mão, em seguida, esse objeto para código parcialmente confiável, o código parcialmente confiável pode ler os dados no `ExtensionDataObject` ao serializar o objeto.</span><span class="sxs-lookup"><span data-stu-id="6b95c-464">For example, if you deserialize from a privileged data source into an object in which some data resides, then hand that object to partially-trusted code, the partially-trusted code can read the data in the `ExtensionDataObject` by serializing the object.</span></span> <span data-ttu-id="6b95c-465">Considere a configuração <xref:System.Runtime.Serialization.DataContractSerializer.IgnoreExtensionDataObject%2A> para `true` quando a desserialização de uma fonte de dados com privilégios em um objeto que é posterior passado para código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-465">Consider setting <xref:System.Runtime.Serialization.DataContractSerializer.IgnoreExtensionDataObject%2A> to `true` when deserializing from a privileged data source into an object that is later passed to partially-trusted code.</span></span>

- <span data-ttu-id="6b95c-466"><xref:System.Runtime.Serialization.DataContractSerializer> e <xref:System.Runtime.Serialization.Json.DataContractJsonSerializer> dão suporte à serialização de membros particulares, protegidos, internos e públicos em confiança total.</span><span class="sxs-lookup"><span data-stu-id="6b95c-466"><xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.Json.DataContractJsonSerializer> support the serialization of private, protected, internal, and public members in full trust.</span></span> <span data-ttu-id="6b95c-467">No entanto, em confiança parcial, somente os membros públicos podem ser serializados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-467">However, in partial trust, only public members can be serialized.</span></span> <span data-ttu-id="6b95c-468">Um <xref:System.Security.SecurityException> será lançada se um aplicativo tenta serializar um membro não público.</span><span class="sxs-lookup"><span data-stu-id="6b95c-468">A <xref:System.Security.SecurityException> is thrown if an application attempts to serialize a non-public member.</span></span>

    <span data-ttu-id="6b95c-469">Para permitir que internos ou membros internos protegidos a ser serializado em confiança parcial, use o <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> atributo do assembly.</span><span class="sxs-lookup"><span data-stu-id="6b95c-469">To allow internal or protected internal members to be serialized in partial trust, use the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> assembly attribute.</span></span> <span data-ttu-id="6b95c-470">Esse atributo permite que um assembly declarar que seus membros internos são visíveis para algum outro assembly.</span><span class="sxs-lookup"><span data-stu-id="6b95c-470">This attribute allows an assembly to declare that its internal members are visible to some other assembly.</span></span> <span data-ttu-id="6b95c-471">Nesse caso, um assembly que quer que seus membros internos serializados declara que seus membros internos são visíveis para Serialization.</span><span class="sxs-lookup"><span data-stu-id="6b95c-471">In this case, an assembly that wants to have its internal members serialized declares that its internal members are visible to System.Runtime.Serialization.dll.</span></span>

    <span data-ttu-id="6b95c-472">A vantagem dessa abordagem é que ele não requer um caminho de geração de código com privilégios elevados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-472">The advantage of this approach is that it does not require an elevated code generation path.</span></span>

    <span data-ttu-id="6b95c-473">Ao mesmo tempo, há duas grandes desvantagens.</span><span class="sxs-lookup"><span data-stu-id="6b95c-473">At the same time, there are two major disadvantages.</span></span>

    <span data-ttu-id="6b95c-474">A primeira desvantagem é que a propriedade de aceitação do <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> atributo é todo o assembly.</span><span class="sxs-lookup"><span data-stu-id="6b95c-474">The first disadvantage is that the opt-in property of the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute is assembly-wide.</span></span> <span data-ttu-id="6b95c-475">Ou seja, você não pode especificar que somente uma determinada classe pode ter seus membros internos serializados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-475">That is, you cannot specify that only a certain class can have its internal members serialized.</span></span> <span data-ttu-id="6b95c-476">É claro, você ainda pode optar para não serializar um membro interno específico, simplesmente não adicionando um <xref:System.Runtime.Serialization.DataMemberAttribute> a esse membro de atributo.</span><span class="sxs-lookup"><span data-stu-id="6b95c-476">Of course, you can still choose not to serialize a specific internal member, by simply not adding a <xref:System.Runtime.Serialization.DataMemberAttribute> attribute to that member.</span></span> <span data-ttu-id="6b95c-477">Da mesma forma, um desenvolvedor também pode optar por tornar um membro interno em vez de particular ou protegido com preocupações de visibilidade pequena.</span><span class="sxs-lookup"><span data-stu-id="6b95c-477">Similarly, a developer can also choose to make a member internal rather than private or protected, with slight visibility concerns.</span></span>

    <span data-ttu-id="6b95c-478">A segunda desvantagem é que ele ainda não suporta a membros particulares ou protegidos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-478">The second disadvantage is that it still does not support private or protected members.</span></span>

    <span data-ttu-id="6b95c-479">Para ilustrar o uso do <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> de atributo em confiança parcial, considere o seguinte programa:</span><span class="sxs-lookup"><span data-stu-id="6b95c-479">To illustrate the use of the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute in partial trust, consider the following program:</span></span>

    [!code-csharp[CDF_WCF_SecurityConsiderationsForData#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cdf_wcf_securityconsiderationsfordata/cs/program.cs#1)]

    <span data-ttu-id="6b95c-480">No exemplo acima, `PermissionsHelper.InternetZone` corresponde à <xref:System.Security.PermissionSet> para confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="6b95c-480">In the example above, `PermissionsHelper.InternetZone` corresponds to the <xref:System.Security.PermissionSet> for partial trust.</span></span> <span data-ttu-id="6b95c-481">Agora, sem a <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> atributo, o aplicativo falhará, gerando um <xref:System.Security.SecurityException> indicando que os membros não públicos não podem ser serializados em confiança parcial.</span><span class="sxs-lookup"><span data-stu-id="6b95c-481">Now, without the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute, the application will fail, throwing a <xref:System.Security.SecurityException> indicating that non-public members cannot be serialized in partial trust.</span></span>

    <span data-ttu-id="6b95c-482">No entanto, se adicionarmos a seguinte linha ao arquivo de origem, o programa é executado com êxito.</span><span class="sxs-lookup"><span data-stu-id="6b95c-482">However, if we add the following line to the source file, the program runs successfully.</span></span>

    [!code-csharp[CDF_WCF_SecurityConsiderationsForData#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cdf_wcf_securityconsiderationsfordata/cs/program.cs#2)]

## <a name="other-state-management-concerns"></a><span data-ttu-id="6b95c-483">Outras questões de gerenciamento de estado</span><span class="sxs-lookup"><span data-stu-id="6b95c-483">Other State Management Concerns</span></span>

<span data-ttu-id="6b95c-484">Algumas outras preocupações sobre o gerenciamento de estado do objeto valem a pena mencionar:</span><span class="sxs-lookup"><span data-stu-id="6b95c-484">A few other concerns regarding object state management are worth mentioning:</span></span>

- <span data-ttu-id="6b95c-485">Ao usar o modelo de programação baseado em fluxo com um transporte de streaming, o processamento da mensagem ocorre conforme a mensagem chega.</span><span class="sxs-lookup"><span data-stu-id="6b95c-485">When using the stream-based programming model with a streaming transport, processing of the message occurs as the message arrives.</span></span> <span data-ttu-id="6b95c-486">O remetente da mensagem pode anular a operação de envio no meio do fluxo, deixando seu código em um estado imprevisível se mais conteúdo era esperado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-486">The sender of the message may abort the send operation in the middle of the stream, leaving your code in an unpredictable state if more content was expected.</span></span> <span data-ttu-id="6b95c-487">Em geral, não confie no fluxo que está sendo concluída e não executam qualquer trabalho em uma operação baseada em fluxo que não pode ser revertida, novamente, caso o fluxo será anulado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-487">In general, do not rely on the stream being complete, and do not perform any work in a stream-based operation that cannot be rolled back in case the stream is aborted.</span></span> <span data-ttu-id="6b95c-488">Isso também se aplica à situação em que uma mensagem pode estar malformada após o corpo de streaming (por exemplo, ela pode estar faltando uma marca de fim para o envelope SOAP ou ter um corpo de mensagem segundo).</span><span class="sxs-lookup"><span data-stu-id="6b95c-488">This also applies to the situation where a message may be malformed after the streaming body (for example, it may be missing an end tag for the SOAP envelope or may have a second message body).</span></span>

- <span data-ttu-id="6b95c-489">Usando o `IExtensibleDataObject` recurso pode fazer com que dados confidenciais a ser emitido.</span><span class="sxs-lookup"><span data-stu-id="6b95c-489">Using the `IExtensibleDataObject` feature may cause sensitive data to be emitted.</span></span> <span data-ttu-id="6b95c-490">Se você está aceitando dados de uma fonte não confiável em contratos de dados com `IExtensibleObjectData` e posteriormente emitir novamente-lo em um canal seguro no qual as mensagens são assinadas, é potencialmente atestar dados que você não sabe nada sobre.</span><span class="sxs-lookup"><span data-stu-id="6b95c-490">If you are accepting data from an untrusted source into data contracts with `IExtensibleObjectData` and later re-emitting it on a secure channel where messages are signed, you are potentially vouching for data you know nothing about.</span></span> <span data-ttu-id="6b95c-491">Além disso, o estado geral que você está enviando pode ser inválido, se você considera as partes conhecidas e desconhecidas de dados.</span><span class="sxs-lookup"><span data-stu-id="6b95c-491">Moreover, the overall state you are sending may be invalid if you take both the known and unknown pieces of data into account.</span></span> <span data-ttu-id="6b95c-492">Evitar essa situação, qualquer um dos seletivamente definindo a propriedade de extensão de dados como `null` ou ao desabilitar seletivamente a `IExtensibleObjectData` recurso.</span><span class="sxs-lookup"><span data-stu-id="6b95c-492">Avoid this situation by either selectively setting the extension data property to `null` or by selectively disabling the `IExtensibleObjectData` feature.</span></span>

## <a name="schema-import"></a><span data-ttu-id="6b95c-493">Importação de esquema</span><span class="sxs-lookup"><span data-stu-id="6b95c-493">Schema Import</span></span>

<span data-ttu-id="6b95c-494">Normalmente, o processo de importação de esquema para gerar tipos ocorre somente em tempo de design, por exemplo, ao usar o [ferramenta de utilitário de metadados ServiceModel (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) em um serviço Web para gerar uma classe de cliente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-494">Normally, the process of importing schema to generate types happens only at design time, for example, when using the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) on a Web service to generate a client class.</span></span> <span data-ttu-id="6b95c-495">No entanto, em cenários mais avançados, você pode processar um esquema em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="6b95c-495">However, in more advanced scenarios, you may process schema at runtime.</span></span> <span data-ttu-id="6b95c-496">Lembre-se de que isso pode expor você quanto a riscos de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="6b95c-496">Be aware that doing so can expose you to denial-of-service risks.</span></span> <span data-ttu-id="6b95c-497">Algum esquema pode levar muito tempo para ser importado.</span><span class="sxs-lookup"><span data-stu-id="6b95c-497">Some schema may take a long time to be imported.</span></span> <span data-ttu-id="6b95c-498">Nunca use o <xref:System.Xml.Serialization.XmlSerializer> componente de importação de esquema em tais cenários, se os esquemas, possivelmente, são provenientes de uma fonte não confiável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-498">Never use the <xref:System.Xml.Serialization.XmlSerializer> schema import component in such scenarios if schemas are possibly coming from an untrusted source.</span></span>

## <a name="threats-specific-to-aspnet-ajax-integration"></a><span data-ttu-id="6b95c-499">Ameaças específicas para a integração do AJAX ASP.NET</span><span class="sxs-lookup"><span data-stu-id="6b95c-499">Threats Specific to ASP.NET AJAX Integration</span></span>

<span data-ttu-id="6b95c-500">Quando o usuário implementa <xref:System.ServiceModel.Description.WebScriptEnablingBehavior> ou <xref:System.ServiceModel.Description.WebHttpBehavior>, WCF expõe um ponto de extremidade que pode aceitar mensagens XML e JSON.</span><span class="sxs-lookup"><span data-stu-id="6b95c-500">When the user implements <xref:System.ServiceModel.Description.WebScriptEnablingBehavior> or <xref:System.ServiceModel.Description.WebHttpBehavior>, WCF exposes an endpoint that can accept both XML and JSON messages.</span></span> <span data-ttu-id="6b95c-501">No entanto, há apenas um conjunto de cotas do leitor, usado pelo leitor de XML e o leitor JSON.</span><span class="sxs-lookup"><span data-stu-id="6b95c-501">However, there is only one set of reader quotas, used both by the XML reader and the JSON reader.</span></span> <span data-ttu-id="6b95c-502">Algumas configurações de cota podem ser apropriadas para um leitor, mas muito grande para o outro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-502">Some quota settings may be appropriate for one reader but too large for the other.</span></span>

<span data-ttu-id="6b95c-503">Ao implementar `WebScriptEnablingBehavior`, o usuário tem a opção de expor um proxy JavaScript no ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="6b95c-503">When implementing `WebScriptEnablingBehavior`, the user has the option to expose a JavaScript proxy at the endpoint.</span></span> <span data-ttu-id="6b95c-504">Os seguintes problemas de segurança devem ser considerados:</span><span class="sxs-lookup"><span data-stu-id="6b95c-504">The following security issues must be considered:</span></span>

- <span data-ttu-id="6b95c-505">Informações sobre o serviço (nomes de operação, nomes de parâmetro e assim por diante) podem ser obtidas por meio do exame proxy JavaScript.</span><span class="sxs-lookup"><span data-stu-id="6b95c-505">Information about the service (operation names, parameter names, and so on) can be obtained by examining the JavaScript proxy.</span></span>

- <span data-ttu-id="6b95c-506">Ao usar o ponto de extremidade do JavaScript, informações confidenciais e privadas podem ser retidas no cliente de cache do navegador da Web.</span><span class="sxs-lookup"><span data-stu-id="6b95c-506">When using the JavaScript endpoint, sensitive and private information might be retained in the client Web browser cache.</span></span>

## <a name="a-note-on-components"></a><span data-ttu-id="6b95c-507">Uma observação sobre componentes</span><span class="sxs-lookup"><span data-stu-id="6b95c-507">A Note on Components</span></span>

<span data-ttu-id="6b95c-508">O WCF é um sistema flexível e personalizável.</span><span class="sxs-lookup"><span data-stu-id="6b95c-508">WCF is a flexible and customizable system.</span></span> <span data-ttu-id="6b95c-509">A maioria do conteúdo deste tópico se concentrar em cenários mais comuns de uso do WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-509">Most of the contents of this topic focus on the most common WCF usage scenarios.</span></span> <span data-ttu-id="6b95c-510">No entanto, é possível compor o WCF fornece de muitas maneiras diferentes de componentes.</span><span class="sxs-lookup"><span data-stu-id="6b95c-510">However, it is possible to compose components WCF provides in many different ways.</span></span> <span data-ttu-id="6b95c-511">É importante entender as implicações de segurança do uso de cada componente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-511">It is important to understand the security implications of using each component.</span></span> <span data-ttu-id="6b95c-512">Em particular:</span><span class="sxs-lookup"><span data-stu-id="6b95c-512">In particular:</span></span>

- <span data-ttu-id="6b95c-513">Quando você deve usar leitores XML, use os leitores a <xref:System.Xml.XmlDictionaryReader> classe fornece em vez de quaisquer outros leitores.</span><span class="sxs-lookup"><span data-stu-id="6b95c-513">When you must use XML readers, use the readers the <xref:System.Xml.XmlDictionaryReader> class provides as opposed to any other readers.</span></span> <span data-ttu-id="6b95c-514">Leitores de seguros são criados usando <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>, ou <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> métodos.</span><span class="sxs-lookup"><span data-stu-id="6b95c-514">Safe readers are created using <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>, or <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> methods.</span></span> <span data-ttu-id="6b95c-515">Não use o <xref:System.Xml.XmlReader.Create%2A> método.</span><span class="sxs-lookup"><span data-stu-id="6b95c-515">Do not use the <xref:System.Xml.XmlReader.Create%2A> method.</span></span> <span data-ttu-id="6b95c-516">Sempre configure os leitores com cotas seguras.</span><span class="sxs-lookup"><span data-stu-id="6b95c-516">Always configure the readers with safe quotas.</span></span> <span data-ttu-id="6b95c-517">Os mecanismos de serialização no WCF são seguros somente quando usada com leitores XML seguros do WCF.</span><span class="sxs-lookup"><span data-stu-id="6b95c-517">The serialization engines in WCF are secure only when used with secure XML readers from WCF.</span></span>

- <span data-ttu-id="6b95c-518">Ao usar o <xref:System.Runtime.Serialization.DataContractSerializer> para desserializar dados potencialmente não confiáveis, sempre defina o <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="6b95c-518">When using the <xref:System.Runtime.Serialization.DataContractSerializer> to deserialize potentially untrusted data, always set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> property.</span></span>

- <span data-ttu-id="6b95c-519">Ao criar uma mensagem, defina as `maxSizeOfHeaders` parâmetro se `MaxReceivedMessageSize` não oferece proteção suficiente.</span><span class="sxs-lookup"><span data-stu-id="6b95c-519">When creating a message, set the `maxSizeOfHeaders` parameter if `MaxReceivedMessageSize` does not offer enough protection.</span></span>

- <span data-ttu-id="6b95c-520">Durante a criação de um codificador, sempre configurar as cotas relevantes, como `MaxSessionSize` e `MaxBufferSize`.</span><span class="sxs-lookup"><span data-stu-id="6b95c-520">When creating an encoder, always configure the relevant quotas, such as `MaxSessionSize` and `MaxBufferSize`.</span></span>

- <span data-ttu-id="6b95c-521">Ao usar um filtro de mensagem de XPath, defina o <xref:System.ServiceModel.Dispatcher.XPathMessageFilter.NodeQuota%2A> para limitar a quantidade de nós XML que visita o filtro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-521">When using an XPath message filter, set the <xref:System.ServiceModel.Dispatcher.XPathMessageFilter.NodeQuota%2A> to limit the amount of XML nodes the filter visits.</span></span> <span data-ttu-id="6b95c-522">Não use expressões XPath que pode levar muito tempo para ser sem visitar o número de nós de computação.</span><span class="sxs-lookup"><span data-stu-id="6b95c-522">Do not use XPath expressions that could take a long time to compute without visiting many nodes.</span></span>

- <span data-ttu-id="6b95c-523">Em geral, ao usar qualquer componente que aceita uma cota, compreender suas implicações de segurança e defini-lo como um valor seguro.</span><span class="sxs-lookup"><span data-stu-id="6b95c-523">In general, when using any component that accepts a quota, understand its security implications and set it to a safe value.</span></span>

## <a name="see-also"></a><span data-ttu-id="6b95c-524">Consulte também</span><span class="sxs-lookup"><span data-stu-id="6b95c-524">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Xml.XmlDictionaryReader>
- <xref:System.Xml.Serialization.XmlSerializer>
- [<span data-ttu-id="6b95c-525">Tipos conhecidos de contrato de dados</span><span class="sxs-lookup"><span data-stu-id="6b95c-525">Data Contract Known Types</span></span>](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md)
