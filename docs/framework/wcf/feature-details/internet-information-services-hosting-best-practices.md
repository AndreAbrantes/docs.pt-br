---
title: Práticas recomendadas de hospedagem dos Serviços de Informações da Internet
ms.date: 03/30/2017
ms.assetid: 0834768e-9665-46bf-86eb-d4b09ab91af5
ms.openlocfilehash: a4312a9affc1103f613f3f8ffd9a14696f9d4bcc
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61972608"
---
# <a name="internet-information-services-hosting-best-practices"></a><span data-ttu-id="6159e-102">Práticas recomendadas de hospedagem dos Serviços de Informações da Internet</span><span class="sxs-lookup"><span data-stu-id="6159e-102">Internet Information Services Hosting Best Practices</span></span>
<span data-ttu-id="6159e-103">Este tópico descreve algumas práticas recomendadas para a hospedagem de serviços Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="6159e-103">This topic outlines some best practices for hosting Windows Communication Foundation (WCF) services.</span></span>  
  
## <a name="implementing-wcf-services-as-dlls"></a><span data-ttu-id="6159e-104">A implementação de serviços do WCF como DLLs</span><span class="sxs-lookup"><span data-stu-id="6159e-104">Implementing WCF Services as DLLs</span></span>  
 <span data-ttu-id="6159e-105">Implementando um WCF serviço como uma DLL que é implantado para o diretório \bin de um aplicativo Web que permite que reutilizar o serviço de fora do modelo de aplicativo Web, por exemplo, em um ambiente de teste que pode não ter o Internet Information Services (IIS) implantado.</span><span class="sxs-lookup"><span data-stu-id="6159e-105">Implementing a WCF service as a DLL that is deployed to the \bin directory of a Web application allows you reuse the service outside of the Web application model, for example, in a test environment that may not have Internet Information Services (IIS) deployed.</span></span>  
  
## <a name="service-hosts-in-iis-hosted-applications"></a><span data-ttu-id="6159e-106">Hosts de serviço em aplicativos hospedados no IIS</span><span class="sxs-lookup"><span data-stu-id="6159e-106">Service Hosts in IIS-Hosted Applications</span></span>  
 <span data-ttu-id="6159e-107">Não use as APIs de hospedagem interna fundamentais para criar novos hosts de serviço que escutam em transportes de rede não compatível nativamente com o ambiente de hospedagem do IIS (por exemplo, [!INCLUDE[iis601](../../../../includes/iis601-md.md)] para TCP de hospedar serviços, porque a comunicação TCP não tem suporte nativo no [!INCLUDE[iis601](../../../../includes/iis601-md.md)]).</span><span class="sxs-lookup"><span data-stu-id="6159e-107">Do not use the imperative self-host APIs to create new service hosts that listen on network transports not natively supported by the IIS hosting environment (For example, [!INCLUDE[iis601](../../../../includes/iis601-md.md)] to host TCP services, because TCP communication is not natively supported on [!INCLUDE[iis601](../../../../includes/iis601-md.md)]).</span></span> <span data-ttu-id="6159e-108">Essa abordagem não é recomendada.</span><span class="sxs-lookup"><span data-stu-id="6159e-108">This approach is not recommended.</span></span> <span data-ttu-id="6159e-109">Hosts de serviço criadas imperativamente não são conhecidos no ambiente de hospedagem do IIS.</span><span class="sxs-lookup"><span data-stu-id="6159e-109">Service hosts created imperatively are not known within the IIS hosting environment.</span></span> <span data-ttu-id="6159e-110">O ponto crítico é que processamento feito pelo serviços imperativamente criado não é considerado pelo IIS quando ele determina se o pool de aplicativos de hospedagem está ocioso.</span><span class="sxs-lookup"><span data-stu-id="6159e-110">The critical point is that processing done by imperatively created services is not accounted for by IIS when it determines whether the hosting application pool is idle.</span></span> <span data-ttu-id="6159e-111">O resultado é que os aplicativos que têm esses hosts de serviço imperativamente criado tem um ambiente de hospedagem IIS agressivamente descarta os processos de host do IIS.</span><span class="sxs-lookup"><span data-stu-id="6159e-111">The result is that applications that have such imperatively created service hosts have an IIS hosting environment that aggressively disposes of IIS host processes.</span></span>  
  
## <a name="uris-and-iis-hosted-endpoints"></a><span data-ttu-id="6159e-112">URIs e pontos de extremidade hospedado no IIS</span><span class="sxs-lookup"><span data-stu-id="6159e-112">URIs and IIS-Hosted Endpoints</span></span>  
 <span data-ttu-id="6159e-113">Pontos de extremidade para um serviço hospedado no IIS devem ser configurados usando relativo recurso uniformes (URIs), endereços absolutos não.</span><span class="sxs-lookup"><span data-stu-id="6159e-113">Endpoints for an IIS-hosted service should be configured using relative Uniform Resource Identifiers (URIs), not absolute addresses.</span></span> <span data-ttu-id="6159e-114">Isso garante que o endereço do ponto de extremidade fica dentro do conjunto de endereços de URI que pertencem ao aplicativo de hospedagem e garante que a ativação baseada em mensagem ocorra conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="6159e-114">This guarantees that the endpoint address falls within the set of URI addresses that belong to the hosting application and ensures that message-based activation happens as expected.</span></span>  
  
## <a name="state-management-and-process-recycling"></a><span data-ttu-id="6159e-115">Gerenciamento de estado e a reciclagem de processo</span><span class="sxs-lookup"><span data-stu-id="6159e-115">State Management and Process Recycling</span></span>  
 <span data-ttu-id="6159e-116">O ambiente de hospedagem do IIS é otimizado para serviços que não mantêm o estado local na memória.</span><span class="sxs-lookup"><span data-stu-id="6159e-116">The IIS hosting environment is optimized for services that do not maintain local state in memory.</span></span> <span data-ttu-id="6159e-117">O IIS recicla o processo de host em resposta a uma variedade de eventos internos e externos, fazendo com que qualquer estado volátil armazenado exclusivamente na memória serão perdidos.</span><span class="sxs-lookup"><span data-stu-id="6159e-117">IIS recycles the host process in response to a variety of external and internal events, causing any volatile state stored exclusively in memory to be lost.</span></span> <span data-ttu-id="6159e-118">Serviços hospedados no IIS deve armazenar seu estado externo ao processo (por exemplo, em um banco de dados) ou em um cache na memória que pode ser facilmente recriado se um aplicativo reciclar o evento ocorre.</span><span class="sxs-lookup"><span data-stu-id="6159e-118">Services hosted in IIS should store their state external to the process (for example, in a database) or in an in-memory cache that can easily be re-created if an application recycle event occurs.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6159e-119">Os protocolos que usam o WCF para segurança e confiabilidade de camada de mensagem fizer usam do estado na memória volátil.</span><span class="sxs-lookup"><span data-stu-id="6159e-119">The protocols WCF uses for message-layer reliability and security make use of the volatile in-memory state.</span></span> <span data-ttu-id="6159e-120">Sessões confiáveis do WCF e sessões de segurança podem encerrar inesperadamente devido a reciclagens do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6159e-120">WCF reliable sessions and security sessions may terminate unexpectedly due to application recycles.</span></span> <span data-ttu-id="6159e-121">Aplicativos hospedados no IIS que usam um desses protocolos qualquer uma depende de algo que não seja a chave de sessão fornecido pelo WCF para correlacionar o estado da camada de aplicativo (por exemplo, uma construção de camada de aplicativo ou um cabeçalho de correlação personalizada) ou desabilitar Processo do IIS de reciclagem para o aplicativo hospedado.</span><span class="sxs-lookup"><span data-stu-id="6159e-121">IIS-hosted applications that make use of these protocols should either depend on something other than the WCF-provided session key for correlating application-layer state (for example, an application-layer construct or custom correlation header) or disable IIS process recycling for the hosted application.</span></span>  
  
## <a name="optimizing-performance-in-middle-tier-scenarios"></a><span data-ttu-id="6159e-122">Otimizando o desempenho em cenários de camada intermediária</span><span class="sxs-lookup"><span data-stu-id="6159e-122">Optimizing Performance in Middle-Tier Scenarios</span></span>  
 <span data-ttu-id="6159e-123">Para otimizar o desempenho em um *cenário de camada intermediária*— um serviço que chama outros serviços em resposta às mensagens de entrada — instanciar o cliente do serviço WCF ao serviço remoto uma vez e reutilizá-lo em vários entrada solicitações.</span><span class="sxs-lookup"><span data-stu-id="6159e-123">For optimal performance in a *middle-tier scenario*—a service that calls out to other services in response to incoming messages—instantiate the WCF service client to the remote service once and reuse it across multiple incoming requests.</span></span> <span data-ttu-id="6159e-124">Criando uma instância de clientes de serviço do WCF é uma operação cara em relação ao que fazer com que um serviço de chamada em uma instância do cliente já existente e cenários de camada intermediária produzem ganhos de desempenho distintos armazenando em cache a clientes remotos em todas as solicitações.</span><span class="sxs-lookup"><span data-stu-id="6159e-124">Instantiating WCF service clients is an expensive operation relative to making a service call on a pre-existing client instance, and middle-tier scenarios produce distinct performance gains by caching remote clients across requests.</span></span> <span data-ttu-id="6159e-125">Clientes de serviço do WCF são thread-safe, portanto, não é necessário sincronizar o acesso a um cliente entre vários threads.</span><span class="sxs-lookup"><span data-stu-id="6159e-125">WCF service clients are thread-safe, so it is not necessary to synchronize access to a client across multiple threads.</span></span>  
  
 <span data-ttu-id="6159e-126">Cenários de camada intermediária também produzem ganhos de desempenho usando as APIs assíncronas geradas pelo `svcutil /a` opção.</span><span class="sxs-lookup"><span data-stu-id="6159e-126">Middle-tier scenarios also produce performance gains by using the asynchronous APIs generated by the `svcutil /a` option.</span></span> <span data-ttu-id="6159e-127">O `/a` opção faz com que o [ferramenta Utilitário de metadados ServiceModel (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) para gerar `BeginXXX/EndXXX` métodos para cada operação de serviço, que permite chamadas de execução potencialmente longa para serviços remotos a ser feita no threads em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="6159e-127">The `/a` option causes the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate `BeginXXX/EndXXX` methods for each service operation, which allows potentially long-running calls to remote services to be made on background threads.</span></span>  
  
## <a name="wcf-in-multi-homed-or-multi-named-scenarios"></a><span data-ttu-id="6159e-128">WCF em cenários de hospedagem múltipla ou múltipla nomeados</span><span class="sxs-lookup"><span data-stu-id="6159e-128">WCF in Multi-Homed or Multi-named scenarios</span></span>  
 <span data-ttu-id="6159e-129">Você pode implantar os serviços WCF dentro de um farm da Web do IIS, onde um conjunto de computadores compartilham o nome comum externo (como `http://www.contoso.com`), mas são abordadas individualmente por nomes de host diferentes (por exemplo, `http://www.contoso.com` pode direcionar o tráfego para dois computadores diferentes chamado `http://machine1.internal.contoso.com` e `http://machine2.internal.contoso.com`).</span><span class="sxs-lookup"><span data-stu-id="6159e-129">You can deploy WCF services inside of an IIS Web farm, where a set of computers share a common external name (such as `http://www.contoso.com`) but are individually addressed by different hostnames (for example, `http://www.contoso.com` might direct traffic to two different machines named `http://machine1.internal.contoso.com` and `http://machine2.internal.contoso.com`).</span></span> <span data-ttu-id="6159e-130">Neste cenário de implantação é totalmente suportado pelo WCF, mas requer configuração especial do site da Web do IIS que hospeda serviços WCF para exibir o nome de host correto (externo) nos metadados do serviço (Web Services Description Language).</span><span class="sxs-lookup"><span data-stu-id="6159e-130">This deployment scenario is fully supported by WCF, but requires special configuration of the IIS Web site hosting WCF services to display the correct (external) hostname in the service's metadata (Web Services Description Language).</span></span>  
  
 <span data-ttu-id="6159e-131">Para garantir que o nome de host correto apareça nos metadados de serviço WCF gera, configurar a identidade padrão para o site da Web do IIS que hospeda os serviços do WCF para usar um nome de host explícito.</span><span class="sxs-lookup"><span data-stu-id="6159e-131">To ensure that the correct hostname appears in the service metadata WCF generates, configure the default identity for the IIS Web site that hosts WCF services to use an explicit hostname.</span></span> <span data-ttu-id="6159e-132">Por exemplo, os computadores que residem dentro do `www.contoso.com` farm deve usar uma associação de site do IIS de \*:80:www.contoso.com para HTTP e \*: 443:www.contoso.com para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6159e-132">For example, computers that reside inside of the `www.contoso.com` farm should use an IIS site binding of \*:80:www.contoso.com for HTTP and \*:443:www.contoso.com for HTTPS.</span></span>  
  
 <span data-ttu-id="6159e-133">Você pode configurar as ligações do site da Web do IIS usando o snap-in do Console de gerenciamento Microsoft (MMC) do IIS.</span><span class="sxs-lookup"><span data-stu-id="6159e-133">You can configure IIS Web site bindings by using the IIS Microsoft Management Console (MMC) snap-in.</span></span>  
  
## <a name="application-pools-running-in-different-user-contexts-overwrite-assemblies-from-other-accounts-in-the-temporary-folder"></a><span data-ttu-id="6159e-134">Assemblies de outras contas na pasta temporária de substituir os Pools de aplicativos em execução em contextos de usuário diferente</span><span class="sxs-lookup"><span data-stu-id="6159e-134">Application Pools Running in Different User Contexts Overwrite Assemblies from Other Accounts in the Temporary Folder</span></span>  
 <span data-ttu-id="6159e-135">Para garantir que os pools de aplicativos em execução em contextos de usuário diferente não é possível substituir os assemblies de outras contas em temporárias [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] arquivos de pasta, use diferentes identidades e as pastas temporárias para diferentes aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6159e-135">To ensure that application pools running in different user contexts cannot overwrite assemblies from other accounts in the temporary [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] files folder, use different identities and temporary folders for different applications.</span></span> <span data-ttu-id="6159e-136">Por exemplo, se você tiver dois /Application1 de aplicativos virtuais e / Application2, você pode criar dois pools de aplicativos, A e B, com duas identidades diferentes.</span><span class="sxs-lookup"><span data-stu-id="6159e-136">For example, if you have two virtual applications /Application1 and / Application2, you can create two Application pools, A and B, with two different identities.</span></span> <span data-ttu-id="6159e-137">Um pool de aplicativos pode executar a identidade de usuário em uma (user1) enquanto o pool de aplicativos B pode ser executado em outra identidade de usuário (user2) e configurar /Application1 para uso A e /Application2 usar B.</span><span class="sxs-lookup"><span data-stu-id="6159e-137">Application pool A can run under one user identity (user1) while application pool B can run under another user identity (user2), and configure /Application1 to use A and /Application2 to use B.</span></span>  
  
 <span data-ttu-id="6159e-138">No Web. config, você pode configurar a pasta temporária usando \< system.web/compilation/@tempFolder>.</span><span class="sxs-lookup"><span data-stu-id="6159e-138">In Web.config, you can configure the temporary folder using \<system.web/compilation/@tempFolder>.</span></span> <span data-ttu-id="6159e-139">Para /Application1, pode ser "c:\tempForUser1" e "c:\tempForUser2" pode ser para application2.</span><span class="sxs-lookup"><span data-stu-id="6159e-139">For /Application1, it can be "c:\tempForUser1" and for application2 it can be "c:\tempForUser2".</span></span> <span data-ttu-id="6159e-140">Conceda permissão de gravação correspondente a essas pastas para as duas identidades.</span><span class="sxs-lookup"><span data-stu-id="6159e-140">Grant corresponding write permission to these folders for the two identities.</span></span>  
  
 <span data-ttu-id="6159e-141">Em seguida, Usuário2 não é possível alterar a pasta de geração de código para /application2 (em c:\tempForUser1).</span><span class="sxs-lookup"><span data-stu-id="6159e-141">Then user2 cannot change the code-generation folder for /application2 (under c:\tempForUser1).</span></span>  
  
## <a name="enabling-asynchronous-processing"></a><span data-ttu-id="6159e-142">Habilitando o processamento assíncrono</span><span class="sxs-lookup"><span data-stu-id="6159e-142">Enabling asynchronous processing</span></span>  
 <span data-ttu-id="6159e-143">Por padrão, as mensagens enviadas para um serviço WCF hospedado no IIS 6.0 e versões anteriores são processadas de forma síncrona.</span><span class="sxs-lookup"><span data-stu-id="6159e-143">By default messages sent to a WCF service hosted under IIS 6.0 and earlier are processed in a synchronous manner.</span></span> <span data-ttu-id="6159e-144">O ASP.NET chama ao WCF em seu próprio thread (o thread de trabalho do ASP.NET) e o WCF usa outro thread para processar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="6159e-144">ASP.NET calls into WCF on its own thread (the ASP.NET worker thread) and WCF uses another thread to process the request.</span></span> <span data-ttu-id="6159e-145">WCF mantiver o thread de trabalho do ASP.NET até concluir seu processamento.</span><span class="sxs-lookup"><span data-stu-id="6159e-145">WCF holds onto the ASP.NET worker thread until it completes its processing.</span></span> <span data-ttu-id="6159e-146">Isso leva ao processamento assíncrono de solicitações.</span><span class="sxs-lookup"><span data-stu-id="6159e-146">This leads to synchronous processing of requests.</span></span> <span data-ttu-id="6159e-147">Processamento de solicitações de forma assíncrona permite maior escalabilidade porque reduz o número de threads necessários para processar uma solicitação – WCF não mantém para o thread do ASP.NET ao processar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="6159e-147">Processing requests asynchronously enables greater scalability because it reduces the number of threads required to process a request –WCF does not hold on to the ASP.NET thread while processing the request.</span></span> <span data-ttu-id="6159e-148">Uso do comportamento assíncrono não é recomendado para computadores executando o IIS 6.0 porque não há nenhuma maneira de limitar as solicitações de entrada que abra o servidor *negação de serviço* ataques (DOS).</span><span class="sxs-lookup"><span data-stu-id="6159e-148">Use of asynchronous behavior is not recommended for machines running IIS 6.0 because there is no way to throttle incoming requests that open up the server to *Denial Of Service* (DOS) attacks.</span></span> <span data-ttu-id="6159e-149">Começando com o IIS 7.0, uma limitação de solicitações simultâneas foi introduzida: `[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0]"MaxConcurrentRequestsPerCpu`.</span><span class="sxs-lookup"><span data-stu-id="6159e-149">Starting with IIS 7.0, a concurrent request throttle has been introduced: `[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0]"MaxConcurrentRequestsPerCpu`.</span></span> <span data-ttu-id="6159e-150">Com essa nova limitação é seguro usar o processamento assíncrono.</span><span class="sxs-lookup"><span data-stu-id="6159e-150">With this new throttle it is safe to use the asynchronous processing.</span></span>  <span data-ttu-id="6159e-151">Por padrão no IIS 7.0, o manipulador assíncrono e o módulo são registrados.</span><span class="sxs-lookup"><span data-stu-id="6159e-151">By default in IIS 7.0, the asynchronous handler and module are registered.</span></span> <span data-ttu-id="6159e-152">Se isso tiver sido desativado, você pode habilitar manualmente o processamento assíncrono de solicitações no arquivo de Web. config do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6159e-152">If this has been turned off, you can manually enable asynchronous processing of requests in your application's Web.config file.</span></span> <span data-ttu-id="6159e-153">As configurações que você usa dependem sua `aspNetCompatibilityEnabled` configuração.</span><span class="sxs-lookup"><span data-stu-id="6159e-153">The settings you use depend on your `aspNetCompatibilityEnabled` setting.</span></span> <span data-ttu-id="6159e-154">Se você tiver `aspNetCompatibilityEnabled` definido como `false`, configure o `System.ServiceModel.Activation.ServiceHttpModule` conforme mostrado no seguinte trecho de configuração.</span><span class="sxs-lookup"><span data-stu-id="6159e-154">If you have `aspNetCompatibilityEnabled` set to `false`, configure the `System.ServiceModel.Activation.ServiceHttpModule` as shown in the following configuration snippet.</span></span>  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="false" />      
  </system.serviceModel>  
  <system.webServer>  
    <modules>  
      <remove name="ServiceModel"/>  
      <add name="ServiceModel"   
           preCondition="integratedMode,runtimeVersionv2.0"   
           type="System.ServiceModel.Activation.ServiceHttpModule, System.ServiceModel,Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>  
    </modules>  
    </system.webServer>  
```  
  
 <span data-ttu-id="6159e-155">Se você tiver `aspNetCompatibilityEnabled` definido como `true`, configure o `System.ServiceModel.Activation.ServiceHttpHandlerFactory` conforme mostrado no seguinte trecho de config.</span><span class="sxs-lookup"><span data-stu-id="6159e-155">If you have `aspNetCompatibilityEnabled` set to `true`, configure the `System.ServiceModel.Activation.ServiceHttpHandlerFactory` as shown in the following config snippet.</span></span>  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true" />      
  </system.serviceModel>  
  <system.webServer>  
    <handlers>  
          <clear/>  
          <add name="TestAsyncHttpHandler"   
               path="*.svc"   
               verb="*"   
               type="System.ServiceModel.Activation.ServiceHttpHandlerFactory, System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"           
               />  
    </handlers>      
  </system.webServer>  
```  
  
## <a name="see-also"></a><span data-ttu-id="6159e-156">Consulte também</span><span class="sxs-lookup"><span data-stu-id="6159e-156">See also</span></span>

- [<span data-ttu-id="6159e-157">Exemplos do serviço de hospedagem</span><span class="sxs-lookup"><span data-stu-id="6159e-157">Service Hosting Samples</span></span>](../samples/hosting.md)
- [<span data-ttu-id="6159e-158">Recursos de hospedagem do Windows Server App Fabric</span><span class="sxs-lookup"><span data-stu-id="6159e-158">Windows Server App Fabric Hosting Features</span></span>](https://go.microsoft.com/fwlink/?LinkId=201276)
