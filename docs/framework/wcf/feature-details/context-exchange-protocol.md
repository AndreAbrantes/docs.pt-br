---
title: Protocolo de intercâmbio de contexto
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: a682b94b1ab659515e618e79230d94f57f140717
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33493173"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="c96e6-102">Protocolo de intercâmbio de contexto</span><span class="sxs-lookup"><span data-stu-id="c96e6-102">Context Exchange Protocol</span></span>
<span data-ttu-id="c96e6-103">Esta seção descreve o protocolo de intercâmbio de contexto introduzido na versão do Windows Communication Foundation (WCF) do .NET Framework versão 3.5.</span><span class="sxs-lookup"><span data-stu-id="c96e6-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="c96e6-104">Este protocolo permite que o canal do cliente aceitar um contexto fornecido por um serviço e aplicá-lo a todas as solicitações subsequentes para esse serviço enviados pela mesma instância de canal do cliente.</span><span class="sxs-lookup"><span data-stu-id="c96e6-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="c96e6-105">A implementação do protocolo de troca de contexto pode usar um dos seguintes dois mecanismos para propagar contexto entre o servidor e o cliente: cookies HTTP ou um cabeçalho SOAP.</span><span class="sxs-lookup"><span data-stu-id="c96e6-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="c96e6-106">O protocolo de intercâmbio de contexto é implementado em uma camada de canal personalizado.</span><span class="sxs-lookup"><span data-stu-id="c96e6-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="c96e6-107">O canal comunica-se o contexto de e para a camada de aplicativo usando um <xref:System.ServiceModel.Channels.ContextMessageProperty> propriedade.</span><span class="sxs-lookup"><span data-stu-id="c96e6-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="c96e6-108">Para transmissão entre pontos de extremidade, o valor do contexto é serializado como um cabeçalho SOAP na camada do canal, tanto convertido de ou para as propriedades de mensagem que representam uma solicitação e resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="c96e6-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="c96e6-109">No último caso, espera-se que uma das camadas de canal subjacente converte as propriedades de mensagem de solicitação e resposta HTTP para e de cookies HTTP, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="c96e6-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="c96e6-110">A escolha do mecanismo usado para trocar o contexto é feita usando o <xref:System.ServiceModel.Channels.ContextExchangeMechanism> propriedade o <xref:System.ServiceModel.Channels.ContextBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="c96e6-111">Os valores válidos são `HttpCookie` ou `SoapHeader`.</span><span class="sxs-lookup"><span data-stu-id="c96e6-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="c96e6-112">No cliente, uma instância de um canal pode operar em dois modos com base nas configurações de propriedade do canal, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="c96e6-113">Modo 1: Gerenciamento de contexto do canal</span><span class="sxs-lookup"><span data-stu-id="c96e6-113">Mode 1: Channel Context Management</span></span>  
 <span data-ttu-id="c96e6-114">Este é o modo padrão onde <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> é definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="c96e6-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="c96e6-115">Nesse modo, o canal de contexto gerencia o contexto e armazena em cache o contexto durante seu ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="c96e6-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="c96e6-116">Contexto pode ser recuperado do canal por meio da propriedade de canal `IContextManager` chamando o `GetContext` método.</span><span class="sxs-lookup"><span data-stu-id="c96e6-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="c96e6-117">O canal também pode ser inicializado previamente com contexto específico antes de serem abertas ao chamar o `SetContext` método na propriedade de canal.</span><span class="sxs-lookup"><span data-stu-id="c96e6-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="c96e6-118">Depois que o canal é inicializado com o contexto não pode ser redefinido.</span><span class="sxs-lookup"><span data-stu-id="c96e6-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="c96e6-119">A seguir está uma lista de constantes nesse modo:</span><span class="sxs-lookup"><span data-stu-id="c96e6-119">The following is a list of invariants in this mode:</span></span>  
  
-   <span data-ttu-id="c96e6-120">Qualquer tentativa de redefinir o contexto usando `SetContext` depois que o canal foi aberta gera uma <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
-   <span data-ttu-id="c96e6-121">Qualquer tentativa de enviar o contexto usando o <xref:System.ServiceModel.Channels.ContextMessageProperty> em uma mensagem de saída gera um <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
-   <span data-ttu-id="c96e6-122">Se uma mensagem é recebida do servidor com um contexto específico, quando o canal já foi inicializado com um contexto específico, isso resulta em um <xref:System.ServiceModel.ProtocolException>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="c96e6-123">É apropriado receber um contexto inicial do servidor somente se o canal é aberto sem qualquer contexto definido explicitamente.</span><span class="sxs-lookup"><span data-stu-id="c96e6-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
-   <span data-ttu-id="c96e6-124">O <xref:System.ServiceModel.Channels.ContextMessageProperty> na mensagem de entrada é sempre null.</span><span class="sxs-lookup"><span data-stu-id="c96e6-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="c96e6-125">Modo 2: Gerenciamento de contexto de aplicativo</span><span class="sxs-lookup"><span data-stu-id="c96e6-125">Mode 2: Application Context Management</span></span>  
 <span data-ttu-id="c96e6-126">Este é o modo quando <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> é definido como `false`.</span><span class="sxs-lookup"><span data-stu-id="c96e6-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="c96e6-127">Nesse modo o canal de contexto não gerencia o contexto.</span><span class="sxs-lookup"><span data-stu-id="c96e6-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="c96e6-128">É responsabilidade do aplicativo para recuperar, gerenciar e aplicar o contexto usando o <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="c96e6-129">Qualquer tentativa de chamar `GetContext` ou `SetContext` resulta em um <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="c96e6-130">Não importa qual modo é escolhida a fábrica de canais do cliente oferece suporte a <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, e <xref:System.ServiceModel.Channels.IDuplexSessionChannel> padrões de troca de mensagens.</span><span class="sxs-lookup"><span data-stu-id="c96e6-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="c96e6-131">Sobre o serviço, uma instância do canal é responsável por converter o contexto fornecido pelo cliente em mensagens de entrada para o <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="c96e6-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="c96e6-132">A propriedade de mensagem, em seguida, pode ser acessada pela camada de aplicativo ou outros canais mais acima na pilha de chamadas.</span><span class="sxs-lookup"><span data-stu-id="c96e6-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="c96e6-133">Os canais de serviço também permitem que a camada de aplicativo especificar um novo valor de contexto para ser propagadas de volta para o cliente, anexando um <xref:System.ServiceModel.Channels.ContextMessageProperty> à mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="c96e6-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="c96e6-134">Essa propriedade é convertida para o cabeçalho SOAP ou um cookie HTTP que contém o contexto, que depende da configuração da associação.</span><span class="sxs-lookup"><span data-stu-id="c96e6-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="c96e6-135">O ouvinte de canal de serviço oferece suporte <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, e <xref:System.ServiceModel.Channels.IReplySessionChannel> padrões de troca de mensagens.</span><span class="sxs-lookup"><span data-stu-id="c96e6-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="c96e6-136">O protocolo de intercâmbio de contexto apresenta um novo `wsc:Context` cabeçalho SOAP para representar as informações de contexto quando cookies HTTP não são usados para propagar o contexto.</span><span class="sxs-lookup"><span data-stu-id="c96e6-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="c96e6-137">O esquema de cabeçalho de contexto permite que qualquer número de elementos filho, cada um com uma chave de cadeia de caracteres e conteúdo de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="c96e6-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="c96e6-138">Este é um exemplo de um cabeçalho de contexto.</span><span class="sxs-lookup"><span data-stu-id="c96e6-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="c96e6-139">Quando estiver no `HttpCookie` modo, os cookies são definidos usando o `SetCookie` cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="c96e6-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="c96e6-140">O nome do cookie é `WscContext`.</span><span class="sxs-lookup"><span data-stu-id="c96e6-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="c96e6-141">O valor do cookie é Base64 codificação do `wsc:Context` cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="c96e6-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="c96e6-142">Esse valor está entre aspas.</span><span class="sxs-lookup"><span data-stu-id="c96e6-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="c96e6-143">O valor de contexto deve ser protegido contra modificações enquanto protegidos em trânsito pela mesma razão cabeçalhos WS-Addressing – o cabeçalho é usado para determinar onde expedir a solicitação no serviço.</span><span class="sxs-lookup"><span data-stu-id="c96e6-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="c96e6-144">O `wsc:Context` cabeçalho, portanto, é necessário ser digitalmente assinados ou assinado e criptografado no nível de transporte ou SOAP quando a associação oferece o recurso de proteção de mensagem.</span><span class="sxs-lookup"><span data-stu-id="c96e6-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="c96e6-145">Quando HTTP cookies são usados para propagar o contexto, eles devem ser protegidos usando a segurança de transporte.</span><span class="sxs-lookup"><span data-stu-id="c96e6-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="c96e6-146">Pontos de extremidade de serviço que requer suporte para o protocolo de intercâmbio de contexto podem tornar explícita na política publicada.</span><span class="sxs-lookup"><span data-stu-id="c96e6-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="c96e6-147">Duas novas declarações de política foram introduzidas para representar o requisito para o cliente para suportar o protocolo de intercâmbio de contexto no nível de SOAP ou para habilitar o suporte de cookie HTTP.</span><span class="sxs-lookup"><span data-stu-id="c96e6-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="c96e6-148">Geração dessas declarações para a diretiva do serviço é controlada pelo valor da <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> propriedade da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="c96e6-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
-   <span data-ttu-id="c96e6-149">Para <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, a declaração a seguir é gerada:</span><span class="sxs-lookup"><span data-stu-id="c96e6-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext   
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
-   <span data-ttu-id="c96e6-150">Para <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, a declaração a seguir é gerada:</span><span class="sxs-lookup"><span data-stu-id="c96e6-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="c96e6-151">Consulte também</span><span class="sxs-lookup"><span data-stu-id="c96e6-151">See Also</span></span>  
 [<span data-ttu-id="c96e6-152">Guia de interoperabilidade de protocolos de serviços Web</span><span class="sxs-lookup"><span data-stu-id="c96e6-152">Web Services Protocols Interoperability Guide</span></span>](../../../../docs/framework/wcf/feature-details/web-services-protocols-interoperability-guide.md)
