---
title: Atributos de transação de ServiceModel
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], ServiceModel attributes
ms.assetid: 1e0d2436-6ae5-439b-9765-a448d6f60000
ms.openlocfilehash: d4b7482431404241577111d8dd3841319b65696e
ms.sourcegitcommit: d6e27023aeaffc4b5a3cb4b88685018d6284ada4
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/09/2019
ms.locfileid: "67663691"
---
# <a name="servicemodel-transaction-attributes"></a><span data-ttu-id="cfc8a-102">Atributos de transação de ServiceModel</span><span class="sxs-lookup"><span data-stu-id="cfc8a-102">ServiceModel Transaction Attributes</span></span>

<span data-ttu-id="cfc8a-103">Windows Communication Foundation (WCF) fornece as propriedades no padrão de três <xref:System.ServiceModel> atributos que permitem que você configure o comportamento de transações para um serviço WCF:</span><span class="sxs-lookup"><span data-stu-id="cfc8a-103">Windows Communication Foundation (WCF) provides properties on three standard <xref:System.ServiceModel> attributes that enable you to configure the behavior of transactions for a WCF service:</span></span>

- <xref:System.ServiceModel.TransactionFlowAttribute>

- <xref:System.ServiceModel.ServiceBehaviorAttribute>

- <xref:System.ServiceModel.OperationBehaviorAttribute>

## <a name="transactionflowattribute"></a><span data-ttu-id="cfc8a-104">TransactionFlowAttribute</span><span class="sxs-lookup"><span data-stu-id="cfc8a-104">TransactionFlowAttribute</span></span>

<span data-ttu-id="cfc8a-105">O <xref:System.ServiceModel.TransactionFlowAttribute> atributo especifica a disposição de uma operação em um contrato de serviço para aceitar as transações de entrada de um cliente.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-105">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specifies the willingness of an operation in a service contract to accept incoming transactions from a client.</span></span> <span data-ttu-id="cfc8a-106">O atributo fornece esse controle com a seguinte propriedade: As transações que usam o <xref:System.ServiceModel.TransactionFlowOption> enumeração para especificar se uma transação de entrada <xref:System.ServiceModel.TransactionFlowOption.Mandatory>, <xref:System.ServiceModel.TransactionFlowOption.Allowed>, ou <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-106">The attribute provides this control with the following property: Transactions use the <xref:System.ServiceModel.TransactionFlowOption> enumeration to specify whether an incoming transaction is <xref:System.ServiceModel.TransactionFlowOption.Mandatory>, <xref:System.ServiceModel.TransactionFlowOption.Allowed>, or <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span>

<span data-ttu-id="cfc8a-107">Isso é o único atributo que relaciona as operações de serviço para interações externas com um cliente.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-107">This is the only attribute that relates service operations to external interactions with a client.</span></span> <span data-ttu-id="cfc8a-108">Os atributos descritos nas seções a seguir estão relacionadas ao uso de transações da execução da operação.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-108">The attributes described in the following sections relate to the use of transactions within the execution of the operation.</span></span>

## <a name="servicebehaviorattribute"></a><span data-ttu-id="cfc8a-109">ServiceBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="cfc8a-109">ServiceBehaviorAttribute</span></span>

<span data-ttu-id="cfc8a-110">O <xref:System.ServiceModel.ServiceBehaviorAttribute> atributo especifica o comportamento de execução interna de uma implementação de contrato de serviço.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-110">The <xref:System.ServiceModel.ServiceBehaviorAttribute> attribute specifies the internal execution behavior of a service contract implementation.</span></span> <span data-ttu-id="cfc8a-111">Propriedades de transação específica desse atributo incluem:</span><span class="sxs-lookup"><span data-stu-id="cfc8a-111">Transaction-specific properties of this attribute include:</span></span>

- <span data-ttu-id="cfc8a-112"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> Especifica se deve concluir uma transação incompleta quando a sessão é fechada.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-112"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> specifies whether to complete an uncompleted transaction when the session closes.</span></span> <span data-ttu-id="cfc8a-113">O valor padrão desta propriedade é `false`.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-113">The default value for this property is `false`.</span></span> <span data-ttu-id="cfc8a-114">Se essa propriedade for `true`e a sessão de entrada foi desligar normalmente em vez de falhas de fechamento devido à rede ou cliente, qualquer transação incompleta é concluída com êxito.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-114">If this property is `true`, and the incoming session was gracefully shut down instead of closing due to network or client faults, any uncompleted transaction is successfully completed.</span></span> <span data-ttu-id="cfc8a-115">Caso contrário, se essa propriedade é `false` ou se a sessão não foi fechada normalmente, qualquer transação incompleta é revertida quando a sessão é fechada.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-115">Otherwise, if this property is `false` or if the session was not gracefully closed, any uncompleted transaction is rolled back when the session closes.</span></span> <span data-ttu-id="cfc8a-116">Se essa propriedade for `true`, o canal de entrada deve ser baseada em sessão.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-116">If this property is `true`, the incoming channel must be session-based.</span></span>

- <span data-ttu-id="cfc8a-117"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> Especifica se a instância do serviço subjacente é liberada quando uma transação é concluída.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-117"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> specifies whether the underlying service instance is released when a transaction completes.</span></span> <span data-ttu-id="cfc8a-118">O valor padrão desta propriedade é `true`.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-118">The default value for this property is `true`.</span></span> <span data-ttu-id="cfc8a-119">A próxima mensagem de entrada faz com que uma nova instância subjacente deve ser criada, descartando qualquer estado por transação que a instância anterior pode ter mantido.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-119">The next inbound message causes a new underlying instance to be created, discarding any per-transaction state that the previous instance might have held.</span></span> <span data-ttu-id="cfc8a-120">Liberação de uma instância de serviço é uma ação interna, o serviço usa e não tem impacto sobre quaisquer conexões existentes ou sessões que os clientes podem ter estabelecido.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-120">Releasing a service instance is an internal action the service takes and has no impact on any existing connections or sessions that clients might have established.</span></span> <span data-ttu-id="cfc8a-121">Essa funcionalidade é equivalente a COM+ fornece o recurso de ativação just-in-time.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-121">This functionality is equivalent to the just-in-time activation feature COM+ provides.</span></span> <span data-ttu-id="cfc8a-122">Se a propriedade estiver `true`, <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> deve ser igual a <xref:System.ServiceModel.ConcurrencyMode.Single>.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-122">If the property is `true`, <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> must be equal to <xref:System.ServiceModel.ConcurrencyMode.Single>.</span></span> <span data-ttu-id="cfc8a-123">Caso contrário, o serviço gera uma exceção de validação de uma configuração inválida durante a inicialização.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-123">Otherwise, the service throws an invalid configuration validation exception during startup.</span></span>

- <span data-ttu-id="cfc8a-124"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> Especifica o nível de isolamento a ser usado para transações dentro do serviço; Esta propriedade usa um do <xref:System.Transactions.IsolationLevel> valores.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-124"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> specifies the isolation level to use for transactions within the service; this property takes one of the <xref:System.Transactions.IsolationLevel> values.</span></span> <span data-ttu-id="cfc8a-125">Se a propriedade de nível de isolamento local for algo diferente de <xref:System.Transactions.IsolationLevel.Unspecified>, o nível de isolamento de uma transação de entrada deve corresponder à configuração dessa propriedade local.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-125">If the local isolation level property is anything other than <xref:System.Transactions.IsolationLevel.Unspecified>, the isolation level of an incoming transaction must match the setting of this local property.</span></span> <span data-ttu-id="cfc8a-126">Caso contrário, a transação de entrada é rejeitada e uma falha é enviada de volta ao cliente.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-126">Otherwise, the incoming transaction is rejected, and a fault is sent back to the client.</span></span> <span data-ttu-id="cfc8a-127">Se <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> está `true`, e nenhuma transação é colocada em fluxo, essa propriedade determina o <xref:System.Transactions.IsolationLevel> valor a ser usado para a transação criada localmente.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-127">If <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> is `true`, and no transaction is flowed, this property determines the <xref:System.Transactions.IsolationLevel> value to use for the locally created transaction.</span></span> <span data-ttu-id="cfc8a-128">Se <xref:System.Transactions.IsolationLevel> é definido como <xref:System.Transactions.IsolationLevel.Unspecified>, <xref:System.Transactions.IsolationLevel> <xref:System.Transactions.IsolationLevel.Serializable> é usado.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-128">If <xref:System.Transactions.IsolationLevel> is set to <xref:System.Transactions.IsolationLevel.Unspecified>, <xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable> is used.</span></span>

- <span data-ttu-id="cfc8a-129"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> Especifica o período de tempo dentro do qual uma nova transação criada no serviço deve ser concluída.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-129"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> specifies the time period within which a new transaction created at the service must complete.</span></span> <span data-ttu-id="cfc8a-130">Se esse tempo for atingido e a transação não foi concluída, ela será anulada.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-130">If this time is reached and the transaction has not been completed, it will abort.</span></span> <span data-ttu-id="cfc8a-131">O <xref:System.TimeSpan> é usado como o <xref:System.Transactions.TransactionScope> tempo limite para todas as operações que têm <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> definido como `true` e para o qual foi criada uma nova transação.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-131">The <xref:System.TimeSpan> is used as the <xref:System.Transactions.TransactionScope> time-out for any operations that have <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> set to `true` and for which a new transaction was created.</span></span> <span data-ttu-id="cfc8a-132">O tempo limite é a duração máxima permitida da criação da transação para a conclusão da fase 1 no protocolo 2PC.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-132">The time-out is the maximum allowed duration from the creation of the transaction to the completion of phase 1 in the two-phase commit protocol.</span></span> <span data-ttu-id="cfc8a-133">O valor de tempo limite usado é sempre o menor valor entre o <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> propriedade e o `transactionTimeout` definição de configuração.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-133">The time-out value used is always the lower value between the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> property and the `transactionTimeout` configuration setting.</span></span>

## <a name="operationbehaviorattribute"></a><span data-ttu-id="cfc8a-134">OperationBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="cfc8a-134">OperationBehaviorAttribute</span></span>

<span data-ttu-id="cfc8a-135">O <xref:System.ServiceModel.OperationBehaviorAttribute> atributo especifica os comportamentos dos métodos na implementação do serviço.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-135">The <xref:System.ServiceModel.OperationBehaviorAttribute> attribute specifies the behaviors of the methods in the service implementation.</span></span> <span data-ttu-id="cfc8a-136">Você pode usá-lo para indicar o comportamento de execução específica da operação.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-136">You can use it to indicate the operation's specific execution behavior.</span></span> <span data-ttu-id="cfc8a-137">As propriedades desse atributo não afetam a descrição de descrição linguagem WSDL (Web Service) do contrato de serviço e são puramente os elementos do modelo de programação WCF que habilitam recursos comuns que os desenvolvedores caso contrário, precisam implementar em si.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-137">Properties of this attribute do not affect the Web Service Description Language (WSDL) description of the service contract, and are purely elements of the WCF programming model that enable common features that developers otherwise have to implement themselves.</span></span>

<span data-ttu-id="cfc8a-138">Este atributo tem as seguintes propriedades de transação específica:</span><span class="sxs-lookup"><span data-stu-id="cfc8a-138">This attribute has the following transaction-specific properties:</span></span>

- <span data-ttu-id="cfc8a-139"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> Especifica se um método deve ser executado dentro de um escopo de transação ativa.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-139"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> specifies whether a method must execute within an active transaction scope.</span></span> <span data-ttu-id="cfc8a-140">O padrão é `false`.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-140">The default is `false`.</span></span> <span data-ttu-id="cfc8a-141">Se o <xref:System.ServiceModel.OperationBehaviorAttribute> atributo não for definido para um método, ele também implica que o método não será executado em uma transação.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-141">If the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute is not set for a method, it also implies that the method will not execute in a transaction.</span></span> <span data-ttu-id="cfc8a-142">Se um escopo de transação não é necessário para uma operação, qualquer transação que está presente no cabeçalho da mensagem não está ativada e permanece como um elemento do <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> do <xref:System.ServiceModel.OperationContext>.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-142">If a transaction scope is not required for an operation, any transaction that is present within the message header is not activated and remains as an element of the <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> of the <xref:System.ServiceModel.OperationContext>.</span></span> <span data-ttu-id="cfc8a-143">Se um escopo de transação é necessário para uma operação, o código-fonte para a transação é derivado de um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="cfc8a-143">If a transaction scope is required for an operation, the source for the transaction is derived from one of the following:</span></span>

  - <span data-ttu-id="cfc8a-144">Se uma transação flui do cliente, o método é executado em um escopo de transação criado usando essa transação distribuída.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-144">If a transaction is flowed from the client, the method is executed under a transaction scope created using that distributed transaction.</span></span>

  - <span data-ttu-id="cfc8a-145">Com um transporte em fila, a transação usada para remover a mensagem da fila é usada.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-145">With a queued transport, the transaction used to dequeue the message is used.</span></span> <span data-ttu-id="cfc8a-146">Observe que a transação usada não é uma transação fluída, em que ele não foi fornecido pelo remetente da mensagem original.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-146">Note that the transaction used is not a flowed transaction, in that it was not provided by the original sender of the message.</span></span>

  - <span data-ttu-id="cfc8a-147">Um transporte personalizado pode fornecer uma transação com o uso da `TransportTransactionProperty`.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-147">A custom transport can provide a transaction through the use of the `TransportTransactionProperty`.</span></span>

  - <span data-ttu-id="cfc8a-148">Se nenhum deles fornece uma fonte externa para uma transação, um novo <xref:System.Transactions.Transaction> instância é criada imediatamente antes de chamar o método.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-148">If none of the above provides an external source for a transaction, a new <xref:System.Transactions.Transaction> instance is created immediately prior to calling the method.</span></span>

- <span data-ttu-id="cfc8a-149"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> Especifica se a transação na qual o método é executado é preenchida automaticamente se nenhuma exceção sem tratamento é geradas.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-149"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> specifies whether the transaction in which the method executes is automatically completed if no unhandled exceptions are thrown.</span></span> <span data-ttu-id="cfc8a-150">Se essa propriedade for `true`, a infraestrutura de chamada marca automaticamente a transação como "concluído", se o método de usuário retornar sem gerar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-150">If this property is `true`, the calling infrastructure automatically marks the transaction as "completed" if the user method returns without throwing an exception.</span></span> <span data-ttu-id="cfc8a-151">Se essa propriedade estiver `false`, a transação é anexada à instância e só é marcada como "concluído" se o cliente chama um método subsequente que é marcado com essa propriedade igual a `true`, ou se um explicitamente as chamadas método subsequentes <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A>.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-151">If this property is `false`, the transaction is attached to the instance, and is only marked as "completed" if the client calls a subsequent method that is marked with this property equal to `true`, or if a subsequent method explicitly calls <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A>.</span></span> <span data-ttu-id="cfc8a-152">Falha ao executar qualquer uma delas resulta na transação nunca sendo "concluída", e o trabalho independente não for confirmado, a menos que o <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> estiver definida como `true`.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-152">Failure to perform either of these results in the transaction never being "completed," and the contained work is not committed, unless the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> property is set to `true`.</span></span> <span data-ttu-id="cfc8a-153">Se essa propriedade é definida como `true`, você deve usar um canal com uma sessão e o <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> deve ser definida como <xref:System.ServiceModel.InstanceContextMode.PerSession>.</span><span class="sxs-lookup"><span data-stu-id="cfc8a-153">If this property is set to `true`, you must use a channel with a session, and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> must be set to <xref:System.ServiceModel.InstanceContextMode.PerSession>.</span></span>
