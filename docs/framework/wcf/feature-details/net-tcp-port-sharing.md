---
title: Compartilhamento de porta Net.TCP
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- port activation [WCF]
- port sharing [WCF]
ms.assetid: f13692ee-a179-4439-ae72-50db9534eded
caps.latest.revision: "14"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: cc0736b0c13f286b999fc0e098a45364141945da
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="nettcp-port-sharing"></a><span data-ttu-id="ce91f-102">Compartilhamento de porta Net.TCP</span><span class="sxs-lookup"><span data-stu-id="ce91f-102">Net.TCP Port Sharing</span></span>
[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]<span data-ttu-id="ce91f-103">Fornece um novo protocolo de rede baseada em TCP (net.tcp://) para comunicação de alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="ce91f-103"> provides a new TCP-based network protocol (net.tcp://) for high-performance communication.</span></span> [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="ce91f-104">também apresenta um novo componente do sistema, o serviço de compartilhamento de porta NET. TCP que permite que portas NET. TCP ser compartilhado entre vários processos de usuário.</span><span class="sxs-lookup"><span data-stu-id="ce91f-104"> also introduces a new system component, the Net.TCP Port Sharing Service that enables net.tcp ports to be shared across multiple user processes.</span></span>  
  
## <a name="background-and-motivation"></a><span data-ttu-id="ce91f-105">Plano de fundo e motivação</span><span class="sxs-lookup"><span data-stu-id="ce91f-105">Background and Motivation</span></span>  
 <span data-ttu-id="ce91f-106">Quando o protocolo TCP/IP foi apresentado pela primeira vez, somente um pequeno número de protocolos de aplicativo feita usá-lo.</span><span class="sxs-lookup"><span data-stu-id="ce91f-106">When the TCP/IP protocol was first introduced, only a small number of application protocols made use of it.</span></span> <span data-ttu-id="ce91f-107">TCP/IP usada números de porta para diferenciar entre os aplicativos, atribuindo um número de porta exclusivo de 16 bits para cada protocolo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ce91f-107">TCP/IP used port numbers to differentiate between applications by assigning a unique 16-bit port number to each application protocol.</span></span> <span data-ttu-id="ce91f-108">Por exemplo, o tráfego HTTP hoje é padronizado para usar a porta TCP 80, SMTP usa a porta TCP 25 e FTP usa as portas TCP 20 e 21.</span><span class="sxs-lookup"><span data-stu-id="ce91f-108">For example, HTTP traffic today is standardized to use TCP port 80, SMTP uses TCP port 25, and FTP uses TCP ports 20 and 21.</span></span> <span data-ttu-id="ce91f-109">Outros aplicativos usando TCP como um transporte podem escolher outro número de porta disponível, por convenção, ou por meio de padronização formal.</span><span class="sxs-lookup"><span data-stu-id="ce91f-109">Other applications using TCP as a transport can choose another available port number, either by convention or through formal standardization.</span></span>  
  
 <span data-ttu-id="ce91f-110">Usar números de porta para diferenciar entre aplicativos teve problemas de segurança.</span><span class="sxs-lookup"><span data-stu-id="ce91f-110">Using port numbers to distinguish between applications had security problems.</span></span> <span data-ttu-id="ce91f-111">Em geral, os firewalls estão configurados para bloquear o tráfego TCP em todas as portas, exceto para alguns pontos de entrada conhecido para que implantar um aplicativo que usa uma porta não padrão geralmente é complicado ou até mesmo impossível devido à presença de firewalls corporativos e pessoais.</span><span class="sxs-lookup"><span data-stu-id="ce91f-111">Firewalls are generally configured to block TCP traffic on all ports except for a few well-known entry points, so deploying an application that uses a non-standard port is often complicated or even impossible due to the presence of corporate and personal firewalls.</span></span> <span data-ttu-id="ce91f-112">Aplicativos que podem se comunicar através das portas padrão, bem conhecidas que já são permitidas, reduzir a superfície de ataque externo.</span><span class="sxs-lookup"><span data-stu-id="ce91f-112">Applications that can communicate over standard, well-known ports that are already permitted, reduce the external attack surface.</span></span> <span data-ttu-id="ce91f-113">Muitos aplicativos de rede fazem uso do HTTP do protocolo porque a maioria dos firewalls são configurados por padrão para permitir o tráfego na porta TCP 80.</span><span class="sxs-lookup"><span data-stu-id="ce91f-113">Many network applications make use of the HTTP protocol because most firewalls are configured by default to allow traffic on TCP port 80.</span></span>  
  
 <span data-ttu-id="ce91f-114">O HTTP. Modelo de sistema no qual o tráfego de vários aplicativos diferentes de HTTP é multiplexado em uma única porta TCP se tornou padrão na plataforma Windows.</span><span class="sxs-lookup"><span data-stu-id="ce91f-114">The HTTP.SYS model in which traffic for many different HTTP applications is multiplexed onto a single TCP port has become standard on the Windows platform.</span></span> <span data-ttu-id="ce91f-115">Isso fornece um ponto de controle comum para firewall administradores enquanto permite que os desenvolvedores de aplicativos minimizar o custo de implantação de criação de novos aplicativos que podem tornar usem a rede.</span><span class="sxs-lookup"><span data-stu-id="ce91f-115">This provides a common point of control for firewall administrators while allowing application developers to minimize the deployment cost of building new applications that can make use of the network.</span></span>  
  
 <span data-ttu-id="ce91f-116">A capacidade de compartilhar portas em vários aplicativos de HTTP foi um recurso de serviços de informações da Internet (IIS).</span><span class="sxs-lookup"><span data-stu-id="ce91f-116">The ability to share ports across multiple HTTP applications has long been a feature of Internet Information Services (IIS).</span></span> <span data-ttu-id="ce91f-117">No entanto, é somente com a introdução do HTTP. SYS (o modo de kernel protocolo ouvinte HTTP) com [!INCLUDE[iis601](../../../../includes/iis601-md.md)] que essa infraestrutura totalmente foi generalizada.</span><span class="sxs-lookup"><span data-stu-id="ce91f-117">However, it was only with the introduction of HTTP.SYS (the kernel-mode HTTP protocol listener) with [!INCLUDE[iis601](../../../../includes/iis601-md.md)] that this infrastructure was fully generalized.</span></span> <span data-ttu-id="ce91f-118">Na realidade, o HTTP. SYS permite que os processos de usuário arbitrários de compartilhar portas TCP dedicadas ao tráfego HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce91f-118">In effect, HTTP.SYS allows arbitrary user processes to share the TCP ports dedicated to HTTP traffic.</span></span> <span data-ttu-id="ce91f-119">Esse recurso permite que vários aplicativos HTTP coexistam no mesmo computador físico em processos separados, isolados ao compartilhamento da infraestrutura de rede necessária para enviar e receber o tráfego pela porta TCP 80.</span><span class="sxs-lookup"><span data-stu-id="ce91f-119">This capability allows many HTTP applications to coexist on the same physical machine in separate, isolated processes while sharing the network infrastructure required to send and receive traffic over TCP port 80.</span></span> <span data-ttu-id="ce91f-120">O serviço de compartilhamento de porta NET. TCP permite que o mesmo tipo de porta NET. TCP aplicativos de compartilhamento.</span><span class="sxs-lookup"><span data-stu-id="ce91f-120">The Net.TCP Port Sharing Service enables the same type of port sharing for net.tcp applications.</span></span>  
  
## <a name="port-sharing-architecture"></a><span data-ttu-id="ce91f-121">Arquitetura de compartilhamento de porta</span><span class="sxs-lookup"><span data-stu-id="ce91f-121">Port Sharing Architecture</span></span>  
 <span data-ttu-id="ce91f-122">A arquitetura de compartilhamento de porta no [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] tem três componentes principais:</span><span class="sxs-lookup"><span data-stu-id="ce91f-122">The Port Sharing architecture in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] has three main components:</span></span>  
  
-   <span data-ttu-id="ce91f-123">Um processo de trabalho: Qualquer processo se comunicar por net.tcp:// usando portas compartilhadas.</span><span class="sxs-lookup"><span data-stu-id="ce91f-123">A Worker Process: Any process communicating over net.tcp:// using shared ports.</span></span>  
  
-   <span data-ttu-id="ce91f-124">O [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] transporte TCP: implementa o protocolo net.tcp://.</span><span class="sxs-lookup"><span data-stu-id="ce91f-124">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] TCP transport: Implements the net.tcp:// protocol.</span></span>  
  
-   <span data-ttu-id="ce91f-125">O serviço de compartilhamento de porta NET. TCP: Permite que vários processos de trabalho compartilhem a mesma porta TCP.</span><span class="sxs-lookup"><span data-stu-id="ce91f-125">The Net.TCP Port Sharing Service: Allows many worker processes to share the same TCP port.</span></span>  
  
 <span data-ttu-id="ce91f-126">O serviço de compartilhamento de porta NET. TCP é um serviço do Windows de modo de usuário que aceita conexões de net.tcp:// em nome dos processos de trabalho que se conectam por meio dele.</span><span class="sxs-lookup"><span data-stu-id="ce91f-126">The Net.TCP Port Sharing Service is a user-mode Windows service that accepts net.tcp:// connections on behalf of the worker processes that connect through it.</span></span> <span data-ttu-id="ce91f-127">Quando chega uma conexão de soquete, a serviço de compartilhamento de porta inspeciona o fluxo de mensagem de entrada para obter o endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="ce91f-127">When a socket connection arrives, the port sharing service inspects the incoming message stream to obtain its destination address.</span></span> <span data-ttu-id="ce91f-128">Com base nesse endereço, a serviço de compartilhamento de porta pode rotear o fluxo de dados para o aplicativo que, por fim, a processa.</span><span class="sxs-lookup"><span data-stu-id="ce91f-128">Based on this address, the port sharing service can route the data stream to the application that ultimately processes it.</span></span>  
  
 <span data-ttu-id="ce91f-129">Quando um [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] serviço que usa a porta net.tcp:// é aberto, o [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infraestrutura de transporte TCP não abre diretamente um soquete TCP no processo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ce91f-129">When a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service that uses net.tcp:// port sharing opens, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] TCP transport infrastructure does not directly open a TCP socket in the application process.</span></span> <span data-ttu-id="ce91f-130">Em vez disso, a infraestrutura de transporte registra o endereço de base do serviço identificador de recurso uniforme (URI) com o serviço de compartilhamento de porta NET. TCP e aguarda a serviço para escutar mensagens em seu nome de compartilhamento de porta.</span><span class="sxs-lookup"><span data-stu-id="ce91f-130">Instead, the transport infrastructure registers the service’s base address Uniform Resource Identifier (URI) with the Net.TCP Port Sharing Service and waits for the port sharing service to listen for messages on its behalf.</span></span>  <span data-ttu-id="ce91f-131">A serviço de compartilhamento de porta envia as mensagens destinadas para o serviço de aplicativo assim que elas chegam.</span><span class="sxs-lookup"><span data-stu-id="ce91f-131">The port sharing service dispatches messages addressed to the application service as they arrive.</span></span>  
  
## <a name="installing-port-sharing"></a><span data-ttu-id="ce91f-132">Instalando o compartilhamento de porta</span><span class="sxs-lookup"><span data-stu-id="ce91f-132">Installing Port Sharing</span></span>  
 <span data-ttu-id="ce91f-133">O serviço de compartilhamento de porta NET. TCP está disponível em todos os sistemas operacionais que oferecem suporte a [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)], mas o serviço não está habilitado por padrão.</span><span class="sxs-lookup"><span data-stu-id="ce91f-133">The Net.TCP Port Sharing Service is available on all operating systems that support [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)], but the service is not enabled by default.</span></span> <span data-ttu-id="ce91f-134">Como uma precaução de segurança, um administrador deve habilitar manualmente o serviço de compartilhamento de porta NET. TCP antes do primeiro uso.</span><span class="sxs-lookup"><span data-stu-id="ce91f-134">As a security precaution, an administrator must manually enable the Net.TCP Port Sharing Service prior to first use.</span></span> <span data-ttu-id="ce91f-135">O serviço de compartilhamento de porta NET. TCP expõe as opções de configuração que permitem que você manipule várias características de soquetes de rede pela porta do serviço de compartilhamento de propriedade.</span><span class="sxs-lookup"><span data-stu-id="ce91f-135">The Net.TCP Port Sharing Service exposes configuration options that allow you to manipulate several characteristics of the network sockets owned by the port sharing service.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="ce91f-136">[Como: habilitar o serviço de compartilhamento de porta NET. TCP](../../../../docs/framework/wcf/feature-details/how-to-enable-the-net-tcp-port-sharing-service.md).</span><span class="sxs-lookup"><span data-stu-id="ce91f-136"> [How to: Enable the Net.TCP Port Sharing Service](../../../../docs/framework/wcf/feature-details/how-to-enable-the-net-tcp-port-sharing-service.md).</span></span>  
  
## <a name="using-nettcp-port-sharing-in-an-application"></a><span data-ttu-id="ce91f-137">Usando em um aplicativo de compartilhamento de porta NET. TCP</span><span class="sxs-lookup"><span data-stu-id="ce91f-137">Using Net.tcp Port Sharing in an Application</span></span>  
 <span data-ttu-id="ce91f-138">A maneira mais fácil de usar a porta net.tcp:// compartilhamento em sua [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] aplicativo é expor um serviço usando o <xref:System.ServiceModel.NetTcpBinding> e, em seguida, habilitar o serviço de compartilhamento de porta NET. TCP usando o <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="ce91f-138">The easiest way to use net.tcp:// port sharing in your [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] application is to expose a service using the <xref:System.ServiceModel.NetTcpBinding> and then to enable Net.TCP Port Sharing Service using the <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> property.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="ce91f-139">como fazer isso, consulte [como: configurar um serviço WCF para usar o compartilhamento de porta](../../../../docs/framework/wcf/feature-details/how-to-configure-a-wcf-service-to-use-port-sharing.md).</span><span class="sxs-lookup"><span data-stu-id="ce91f-139"> how to do this, see [How to: Configure a WCF Service to Use Port Sharing](../../../../docs/framework/wcf/feature-details/how-to-configure-a-wcf-service-to-use-port-sharing.md).</span></span>  
  
## <a name="security-implications-of-port-sharing"></a><span data-ttu-id="ce91f-140">Implicações de segurança de compartilhamento de porta</span><span class="sxs-lookup"><span data-stu-id="ce91f-140">Security Implications of Port Sharing</span></span>  
 <span data-ttu-id="ce91f-141">Embora o serviço de compartilhamento de porta NET. TCP fornece uma camada de processamento entre aplicativos e rede, os aplicativos que usam o compartilhamento de porta ainda devem ser protegidos como se eles foram escuta diretamente na rede.</span><span class="sxs-lookup"><span data-stu-id="ce91f-141">Although the Net.TCP Port Sharing Service provides a layer of processing between applications and the network, applications that use port sharing should still be secured as if they were directly listening on the network.</span></span> <span data-ttu-id="ce91f-142">Especificamente, os aplicativos que usam o compartilhamento de porta devem avaliar os privilégios do processo em que executarem.</span><span class="sxs-lookup"><span data-stu-id="ce91f-142">Specifically, applications that use port sharing should evaluate the process privileges under which they run.</span></span> <span data-ttu-id="ce91f-143">Considere a execução de seu aplicativo usando a conta de serviço de rede interna, que é executado com um conjunto mínimo de privilégios de processo necessário para a comunicação de rede.</span><span class="sxs-lookup"><span data-stu-id="ce91f-143">Consider running your application using the built-in Network Service account, which runs with the minimal set of process privileges required for network communication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ce91f-144">Consulte também</span><span class="sxs-lookup"><span data-stu-id="ce91f-144">See Also</span></span>  
 [<span data-ttu-id="ce91f-145">Configurando o serviço de compartilhamento de porta NET. TCP</span><span class="sxs-lookup"><span data-stu-id="ce91f-145">Configuring the Net.TCP Port Sharing Service</span></span>](../../../../docs/framework/wcf/feature-details/configuring-the-net-tcp-port-sharing-service.md)  
 [<span data-ttu-id="ce91f-146">Hospedagem</span><span class="sxs-lookup"><span data-stu-id="ce91f-146">Hosting</span></span>](../../../../docs/framework/wcf/feature-details/hosting.md)  
 [<span data-ttu-id="ce91f-147">Como: configurar um serviço WCF para compartilhamento de porta de uso</span><span class="sxs-lookup"><span data-stu-id="ce91f-147">How to: Configure a WCF Service to Use Port Sharing</span></span>](../../../../docs/framework/wcf/feature-details/how-to-configure-a-wcf-service-to-use-port-sharing.md)  
 [<span data-ttu-id="ce91f-148">Como: habilitar o serviço de compartilhamento de porta NET. TCP</span><span class="sxs-lookup"><span data-stu-id="ce91f-148">How to: Enable the Net.TCP Port Sharing Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-enable-the-net-tcp-port-sharing-service.md)
