---
title: "Cache e fábrica de canal"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 954f030e-091c-4c0e-a7a2-10f9a6b1f529
caps.latest.revision: "3"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 1b06d290760afa9a52274c30899e25f00bc18af2
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/02/2017
---
# <a name="channel-factory-and-caching"></a>Cache e fábrica de canal
Os aplicativos cliente do WCF usam a classe <xref:System.ServiceModel.ChannelFactory%601> para criar um canal de comunicação com um serviço WCF.  Criar instâncias de <xref:System.ServiceModel.ChannelFactory%601> resulta em alguma sobrecarga porque envolve as seguintes operações:  
  
-   Construir a árvore de <xref:System.ServiceModel.Description.ContractDescription>  
  
-   Refletir todos os tipos CLR necessários  
  
-   Construir a pilha de canal  
  
-   Descarte de recursos  
  
 Para ajudar a minimizar a sobrecarga, o WCF pode armazenar em cache fábricas de canal quando você está usando um proxy de cliente WCF.  
  
> [!TIP]
>  Você tem controle direto sobre a criação da fábrica de canal, quando você usa o <xref:System.ServiceModel.ChannelFactory%601> classe diretamente.  
  
 Os proxies de cliente WCF gerados com [Ferramenta Utilitária de metadados ServiceModel (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) são derivados de <xref:System.ServiceModel.ClientBase%601>. <xref:System.ServiceModel.ClientBase%601>define um estático <xref:System.ServiceModel.ClientBase%601.CacheSetting%2A> propriedade que define o comportamento de cache de fábrica de canal. Configurações de cache são feitas para um tipo específico. Por exemplo, definindo `ClientBase<ITest>.CacheSettings` para um dos valores definidos abaixo afetará apenas esses proxy/ClientBase do tipo `ITest`. A configuração de cache para um determinado <xref:System.ServiceModel.ClientBase%601> é imutável, assim que a primeira instância de proxy/ClientBase é criada.  
  
## <a name="specifying-caching-behavior"></a>Especificar o comportamento do cache  
 Comportamento do cache é especificado pela configuração de <xref:System.ServiceModel.ClientBase%601.CacheSetting> propriedade para um dos valores a seguir.  
  
|Definir o valor de cache|Descrição|  
|-------------------------|-----------------|  
|<xref:System.ServiceModel.CacheSetting.AlwaysOn>|Todas as instâncias de <xref:System.ServiceModel.ClientBase%601> dentro do domínio de aplicativo podem participar em cache. O desenvolvedor determinou que não há nenhum implicações de segurança adversas para armazenamento em cache. O cache será não desativado propriedades mesmo que "segurança" <xref:System.ServiceModel.ClientBase%601> são acessados. As propriedades de "segurança" de <xref:System.ServiceModel.ClientBase%601> são <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A>, <xref:System.ServiceModel.ClientBase%601.Endpoint%2A> e <xref:System.ServiceModel.ClientBase%601.ChannelFactory%2A>.|  
|<xref:System.ServiceModel.CacheSetting.Default>|Apenas instâncias do <xref:System.ServiceModel.ClientBase%601> criado a partir de pontos de extremidade definidos na configuração de participarem de arquivos no cache de dentro do domínio de aplicativo. Todas as instâncias de <xref:System.ServiceModel.ClientBase%601> criado por meio de programação dentro desse domínio de aplicativo não participará no cache. Além disso, o cache será desabilitado para uma instância de <xref:System.ServiceModel.ClientBase%601> quando qualquer uma de suas propriedades de "segurança" é acessada.|  
|<xref:System.ServiceModel.CacheSetting.AlwaysOff>|O cache é desativado para todas as instâncias de <xref:System.ServiceModel.ClientBase%601> de um tipo específico dentro do aplicativo-domínio em questão.|  
  
 Os trechos de código a seguir ilustram como usar o <xref:System.ServiceModel.ClientBase%601.CacheSetting%2A> propriedade.  
  
```  
class Program   
{   
   static void Main(string[] args)   
   {   
      ClientBase<ITest>.CacheSettings = CacheSettings.AlwaysOn;   
      foreach (string msg in messages)   
      {   
         using (TestClient proxy = new TestClient (new BasicHttpBinding(), new EndpointAddress(address)))   
         {   
            // ...  
            proxy.Test(msg);   
            // ...  
         }   
      }   
   }   
}  
// Generated by SvcUtil.exe     
public partial class TestClient : System.ServiceModel.ClientBase, ITest { }  
```  
  
 No código acima, todas as instâncias de `TestClient` usará a mesma fábrica de canais.  
  
```  
class Program   
{   
   static void Main(string[] args)   
   {   
      ClientBase.CacheSettings = CacheSettings.Default;   
      int i = 1;   
      foreach (string msg in messages)   
      {   
         using (TestClient proxy = new TestClient ("MyEndpoint", new EndpointAddress(address)))   
         {   
            if (i == 4)   
            {   
               ServiceEndpoint endpoint = proxy.Endpoint;   
               ... // use endpoint in some way   
            }   
            proxy.Test(msg);   
         }   
         i++;   
   }   
}   
  
// Generated by SvcUtil.exe     
public partial class TestClient : System.ServiceModel.ClientBase, ITest {}  
```  
  
 No exemplo acima, todas as instâncias de `TestClient` seria usar a mesma fábrica de canais exceto instância #4. Instância #4 usaria uma fábrica de canais que é criada especificamente para seu uso. Essa configuração funciona para cenários em que um determinado ponto de extremidade precisa de configurações de segurança diferente de outros pontos de extremidade do mesmo tipo de fábrica de canal (neste caso `ITest`).  
  
```  
class Program   
{   
   static void Main(string[] args)   
   {   
      ClientBase.CacheSettings = CacheSettings.AlwaysOff;   
      foreach (string msg in messages)   
      {   
         using (TestClient proxy = new TestClient ("MyEndpoint", new EndpointAddress(address)))   
         {   
            proxy.Test(msg);   
         }           
      }   
   }  
}  
  
// Generated by SvcUtil.exe   
public partial class TestClient : System.ServiceModel.ClientBase, ITest {}  
```  
  
 No exemplo acima, todas as instâncias de `TestClient` usaria fábricas de canais diferentes. Isso é útil quando cada ponto de extremidade tem diferentes requisitos de segurança e não faz sentido para o cache.  
  
## <a name="see-also"></a>Consulte também  
 <xref:System.ServiceModel.ClientBase%601>  
 [Building Clients](../../../../docs/framework/wcf/building-clients.md) (Compilando clientes)  
 [Clientes](../../../../docs/framework/wcf/feature-details/clients.md)  
 [Accessing Services Using a WCF Client](../../../../docs/framework/wcf/accessing-services-using-a-wcf-client.md) (Usando um cliente do WCF para acessar serviços)  
 [Como: usar o ChannelFactory](../../../../docs/framework/wcf/feature-details/how-to-use-the-channelfactory.md)
