---
title: Usando o canal cliente Discovery
ms.date: 03/30/2017
ms.assetid: 1494242a-1d64-4035-8ecd-eb4f06c8d2ba
ms.openlocfilehash: 05ca54d62179d024e619bc5c9c70a4e08b9dd62f
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/12/2019
ms.locfileid: "73975947"
---
# <a name="using-the-discovery-client-channel"></a><span data-ttu-id="48a05-102">Usando o canal cliente Discovery</span><span class="sxs-lookup"><span data-stu-id="48a05-102">Using the Discovery Client Channel</span></span>
<span data-ttu-id="48a05-103">Ao gravar um aplicativo cliente WCF, você precisa saber o endereço do ponto de extremidade do serviço que está chamando.</span><span class="sxs-lookup"><span data-stu-id="48a05-103">When writing a WCF client application you need to know the endpoint address of the service you are calling.</span></span> <span data-ttu-id="48a05-104">Em muitas situações, o endereço do ponto de extremidade de um serviço não é conhecido com antecedência ou o endereço do serviço muda ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="48a05-104">In many situations the endpoint address of a service is not known in advance or the address of the service changes over time.</span></span> <span data-ttu-id="48a05-105">O canal cliente de descoberta permite que você grave um aplicativo cliente do WCF, descreva o serviço que você deseja chamar e o canal do cliente envia automaticamente uma solicitação de investigação.</span><span class="sxs-lookup"><span data-stu-id="48a05-105">The Discovery Client Channel allows you to write a WCF client application, describe the service you want to call, and the client channel automatically sends a probe request.</span></span> <span data-ttu-id="48a05-106">Quando um serviço responde, o canal cliente de descoberta recupera o endereço do ponto de extremidade para o serviço da resposta de investigação e o utiliza para chamar o serviço.</span><span class="sxs-lookup"><span data-stu-id="48a05-106">When a service responds, the discovery client channel retrieves the endpoint address for the service from the probe response and uses it to call the service.</span></span>  
  
## <a name="using-the-discovery-client-channel"></a><span data-ttu-id="48a05-107">Usando o canal cliente Discovery</span><span class="sxs-lookup"><span data-stu-id="48a05-107">Using the Discovery Client Channel</span></span>  
 <span data-ttu-id="48a05-108">Para usar o canal do cliente de descoberta, adicione uma instância do <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> à pilha de canais do cliente.</span><span class="sxs-lookup"><span data-stu-id="48a05-108">To use the Discovery Client Channel, add an instance of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your client channel stack.</span></span> <span data-ttu-id="48a05-109">Como alternativa, você pode usar o <xref:System.ServiceModel.Discovery.DynamicEndpoint> e um <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> será adicionado automaticamente à sua associação, se ainda não estiver presente.</span><span class="sxs-lookup"><span data-stu-id="48a05-109">Alternatively you can use the <xref:System.ServiceModel.Discovery.DynamicEndpoint> and a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is automatically added to your binding if not already present.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="48a05-110">É recomendável que a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> seja o elemento mais alto na pilha de canais do cliente.</span><span class="sxs-lookup"><span data-stu-id="48a05-110">It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack.</span></span> <span data-ttu-id="48a05-111">Qualquer elemento de associação que é adicionado sobre o <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> deve garantir que o <xref:System.ServiceModel.ChannelFactory> ou canal que ele cria não use o endereço do ponto de extremidade ou o endereço de `Via` (passado para o método `CreateChannel`) porque eles não podem conter o endereço correto.</span><span class="sxs-lookup"><span data-stu-id="48a05-111">Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address.</span></span>  
  
 <span data-ttu-id="48a05-112">A classe <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> contém duas propriedades públicas:</span><span class="sxs-lookup"><span data-stu-id="48a05-112">The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> class contains two public properties:</span></span>  
  
1. <span data-ttu-id="48a05-113"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, que é usado para descrever o serviço que você deseja chamar.</span><span class="sxs-lookup"><span data-stu-id="48a05-113"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, which is used to describe the service you want to call.</span></span>  
  
2. <span data-ttu-id="48a05-114"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> que especifica o ponto de extremidade de descoberta para o qual enviar mensagens de descoberta.</span><span class="sxs-lookup"><span data-stu-id="48a05-114"><xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> which specifies the discovery endpoint to send discovery messages to.</span></span>  
  
 <span data-ttu-id="48a05-115">A propriedade <xref:System.ServiceModel.Discovery.FindCriteria.%23ctor%2A> permite especificar o contrato de serviço que você está pesquisando, todos os URIs de escopo necessários e o número máximo de tempo para tentar abrir o canal.</span><span class="sxs-lookup"><span data-stu-id="48a05-115">The <xref:System.ServiceModel.Discovery.FindCriteria.%23ctor%2A> property allows you to specify the service contract you are searching for, any required scope URIs, and the maximum number of time to attempt to open the channel.</span></span> <span data-ttu-id="48a05-116">O tipo de contrato é especificado chamando o <xref:System.ServiceModel.Discovery.FindCriteria>do construtor.</span><span class="sxs-lookup"><span data-stu-id="48a05-116">The contract type is specified by calling the constructor  <xref:System.ServiceModel.Discovery.FindCriteria>.</span></span> <span data-ttu-id="48a05-117">URIs de escopo podem ser adicionados à propriedade <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A>.</span><span class="sxs-lookup"><span data-stu-id="48a05-117">Scope URIs can be added to the <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A> property.</span></span> <span data-ttu-id="48a05-118">A propriedade <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> permite que você especifique o número máximo de resultados aos quais o cliente tenta se conectar.</span><span class="sxs-lookup"><span data-stu-id="48a05-118">The <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property allows you to specify the maximum number of results to which the client tries to connect to.</span></span> <span data-ttu-id="48a05-119">Quando uma resposta de investigação é recebida, o cliente tenta abrir o canal usando o endereço do ponto de extremidade da resposta de investigação.</span><span class="sxs-lookup"><span data-stu-id="48a05-119">When a probe response is received the client attempts to open the channel using the endpoint address from the probe response.</span></span> <span data-ttu-id="48a05-120">Se ocorrer uma exceção, o cliente passará para a próxima resposta de investigação, aguardando que mais respostas sejam recebidas, se necessário.</span><span class="sxs-lookup"><span data-stu-id="48a05-120">If an exception occurs the client moves on to the next probe response, waiting for more responses to be received if necessary.</span></span> <span data-ttu-id="48a05-121">Ele continua a fazer isso até que o canal seja aberto com êxito ou o número máximo de resultados seja atingido.</span><span class="sxs-lookup"><span data-stu-id="48a05-121">It continues to do this until the channel is successfully opened or the maximum number of results is reached.</span></span> <span data-ttu-id="48a05-122">Para obter mais informações sobre essas configurações, consulte <xref:System.ServiceModel.Discovery.FindCriteria>.</span><span class="sxs-lookup"><span data-stu-id="48a05-122">For more information about these settings, see <xref:System.ServiceModel.Discovery.FindCriteria>.</span></span>  
  
 <span data-ttu-id="48a05-123">A propriedade <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> permite que você especifique o ponto de extremidade de descoberta a ser usado.</span><span class="sxs-lookup"><span data-stu-id="48a05-123">The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpointProvider%2A> property allows you to specify the discovery endpoint to use.</span></span> <span data-ttu-id="48a05-124">Normalmente, isso é um <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, mas pode ser qualquer ponto de extremidade válido.</span><span class="sxs-lookup"><span data-stu-id="48a05-124">Normally this is a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, but it can be any valid endpoint.</span></span>  
  
 <span data-ttu-id="48a05-125">Ao criar a associação a ser usada para se comunicar com o serviço, você deve ter cuidado para usar exatamente a mesma ligação que o serviço.</span><span class="sxs-lookup"><span data-stu-id="48a05-125">When you are creating the binding to use to communicate with the service, you must be careful to use the exact same binding as the service.</span></span> <span data-ttu-id="48a05-126">A única diferença é que a associação de cliente tem um <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> na parte superior da pilha.</span><span class="sxs-lookup"><span data-stu-id="48a05-126">The only difference is the client binding has a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> on the top of the stack.</span></span> <span data-ttu-id="48a05-127">Se o serviço estiver usando uma das associações fornecidas pelo sistema, crie um novo <xref:System.ServiceModel.Channels.CustomBinding> e passe a associação fornecida pelo sistema para o construtor de <xref:System.ServiceModel.Channels.CustomBinding.%23ctor%2A>.</span><span class="sxs-lookup"><span data-stu-id="48a05-127">If service is using one of the system-provided bindings, create a new <xref:System.ServiceModel.Channels.CustomBinding> and pass in the system-provided binding to the <xref:System.ServiceModel.Channels.CustomBinding.%23ctor%2A> constructor.</span></span> <span data-ttu-id="48a05-128">Em seguida, você pode adicionar o <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> chamando `Insert` na propriedade <xref:System.ServiceModel.Channels.CustomBinding.Elements%2A>.</span><span class="sxs-lookup"><span data-stu-id="48a05-128">Then you can add the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> by calling `Insert` on the <xref:System.ServiceModel.Channels.CustomBinding.Elements%2A> property.</span></span>  
  
 <span data-ttu-id="48a05-129">Depois de adicionar o <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> à sua associação e configurá-lo, você pode criar uma instância da classe de cliente WCF, abri-la e chamar seus métodos.</span><span class="sxs-lookup"><span data-stu-id="48a05-129">Once you have added the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your binding and configured it, you can create an instance of the WCF client class, open it, and call its methods.</span></span> <span data-ttu-id="48a05-130">O exemplo a seguir usa o canal do cliente de descoberta para descobrir um serviço WCF que implementa a classe `ICalculator` (usada no tutorial do Introdução WCF) e chama seu método `Add`.</span><span class="sxs-lookup"><span data-stu-id="48a05-130">The following example uses the Discovery Client Channel to discover a WCF service that implements the `ICalculator` class (used in the Getting Started WCF tutorial) and calls its `Add` method.</span></span>  
  
```csharp
// Create the DiscoveryClientBindingElement  
DiscoveryClientBindingElement bindingElement = new DiscoveryClientBindingElement();  
// Search for a service that implements the ICalculator interface, attempting to open  
// the channel a maximum of 2 times  
bindingElement.FindCriteria = new FindCriteria(typeof(ICalculator)) { MaxResults = 2 };  
// Use the UdpDiscoveryEndpoint  
bindingElement.DiscoveryEndpoint = new UdpDiscoveryEndpoint();  
  
// The service uses the BasicHttpBinding, so use that and insert the DiscoveryClientBindingElement at the   
// top of the stack  
CustomBinding binding = new CustomBinding(new BasicHttpBinding());  
binding.Elements.Insert(0,bindingElement);  
  
try  
{  
    // Create the WCF client and call a method  
    CalculatorClient client = new CalculatorClient(binding, new EndpointAddress("http://schemas.microsoft.com/dynamic"));  
    client.Open();  
    client.Add(1, 1);  
}  
catch (EndpointNotFoundException ex)  
{  
    Console.WriteLine("An exception occurred: " + ex.Message);  
}  
```  
  
## <a name="security-and-the-discovery-client-channel"></a><span data-ttu-id="48a05-131">Segurança e o canal do cliente de descoberta</span><span class="sxs-lookup"><span data-stu-id="48a05-131">Security and the Discovery Client Channel</span></span>  
 <span data-ttu-id="48a05-132">Ao usar o canal do cliente de descoberta, dois pontos de extremidade estão sendo especificados.</span><span class="sxs-lookup"><span data-stu-id="48a05-132">When using the discovery client channel, two endpoints are being specified.</span></span> <span data-ttu-id="48a05-133">Uma é usada para mensagens de descoberta, geralmente <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>e a outra é o ponto de extremidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="48a05-133">One is used for discovery messages, usually <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, and the other is the application endpoint.</span></span> <span data-ttu-id="48a05-134">Ao implementar um serviço seguro, é necessário tomar cuidado para proteger os dois pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="48a05-134">When implementing a secure service, care must be taken to secure both endpoints.</span></span> <span data-ttu-id="48a05-135">Para obter mais informações sobre segurança, consulte [protegendo serviços e clientes](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).</span><span class="sxs-lookup"><span data-stu-id="48a05-135">For more information about security, see [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).</span></span>
