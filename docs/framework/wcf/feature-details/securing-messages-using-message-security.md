---
title: Protegendo as mensagens com a segurança de mensagens
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: d895524d36895ad087f7394fcc3380573355eaad
ms.sourcegitcommit: 6eac9a01ff5d70c6d18460324c016a3612c5e268
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2018
ms.locfileid: "45674735"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="a0d22-102">Protegendo as mensagens com a segurança de mensagens</span><span class="sxs-lookup"><span data-stu-id="a0d22-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="a0d22-103">Esta seção aborda a segurança de mensagem do WCF ao usar <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="a0d22-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a0d22-104">Antes de ler este tópico, é recomendável que você leia [conceitos de segurança](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="a0d22-104">Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span></span>  
  
 <span data-ttu-id="a0d22-105">A ilustração a seguir fornece um modelo conceitual de comunicação em fila usando o WCF.</span><span class="sxs-lookup"><span data-stu-id="a0d22-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="a0d22-106">Esta ilustração e a terminologia são usados para explicar</span><span class="sxs-lookup"><span data-stu-id="a0d22-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="a0d22-107">conceitos de segurança de transporte.</span><span class="sxs-lookup"><span data-stu-id="a0d22-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="a0d22-108">![Na fila de diagrama de aplicativo](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Figura distribuídas de fila")</span><span class="sxs-lookup"><span data-stu-id="a0d22-108">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="a0d22-109">Quando o envio de mensagens usando o WCF em fila, a mensagem do WCF é anexada como um corpo da mensagem de enfileiramento de mensagens (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="a0d22-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="a0d22-110">Embora a segurança de transporte protege a todo MSMQ mensagem, mensagem (ou SOAP) segurança protege apenas o corpo da mensagem do MSMQ.</span><span class="sxs-lookup"><span data-stu-id="a0d22-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="a0d22-111">O conceito fundamental de segurança de mensagem é que o cliente protege a mensagem para o aplicativo de recebimento (serviço), ao contrário de segurança de transporte em que o cliente protege a mensagem para a fila de destino.</span><span class="sxs-lookup"><span data-stu-id="a0d22-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="a0d22-112">Como tal, o MSMQ não desempenha nenhuma parte ao proteger a mensagem do WCF usando a segurança de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a0d22-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="a0d22-113">Segurança de mensagem do WCF adiciona cabeçalhos de segurança para a mensagem do WCF que se integram com infra-estruturas existentes de segurança, como um certificado ou o protocolo Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a0d22-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="a0d22-114">Tipo de credencial de mensagem</span><span class="sxs-lookup"><span data-stu-id="a0d22-114">Message Credential Type</span></span>  
 <span data-ttu-id="a0d22-115">Usando a segurança de mensagem, o serviço e o cliente podem apresentar credenciais para autenticar da outra.</span><span class="sxs-lookup"><span data-stu-id="a0d22-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="a0d22-116">Você pode selecionar a segurança de mensagem, definindo o <xref:System.ServiceModel.NetMsmqBinding.Security%2A> modo para `Message` ou `Both` (ou seja, usar a segurança de transporte e segurança de mensagem).</span><span class="sxs-lookup"><span data-stu-id="a0d22-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="a0d22-117">O serviço pode usar o <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> propriedade inspecionar a credencial usada para autenticar o cliente.</span><span class="sxs-lookup"><span data-stu-id="a0d22-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="a0d22-118">Isso também pode ser usado para outras verificações de autorização que o serviço opta por implementar.</span><span class="sxs-lookup"><span data-stu-id="a0d22-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="a0d22-119">Esta seção explica os diferentes tipos de credenciais e como usá-los com as filas.</span><span class="sxs-lookup"><span data-stu-id="a0d22-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="a0d22-120">Certificado</span><span class="sxs-lookup"><span data-stu-id="a0d22-120">Certificate</span></span>  
 <span data-ttu-id="a0d22-121">O tipo de credencial de certificado usa um certificado x. 509 para identificar o serviço e o cliente.</span><span class="sxs-lookup"><span data-stu-id="a0d22-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="a0d22-122">Em um cenário típico, o cliente e o serviço são emitidos um certificado válido por uma autoridade de certificação confiável.</span><span class="sxs-lookup"><span data-stu-id="a0d22-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="a0d22-123">Em seguida, a conexão é estabelecida, o cliente autentica a validade do serviço usando o certificado do serviço para decidir se ele pode confiar que o serviço.</span><span class="sxs-lookup"><span data-stu-id="a0d22-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="a0d22-124">Da mesma forma, o serviço usa o certificado do cliente para validar a relação de confiança do cliente.</span><span class="sxs-lookup"><span data-stu-id="a0d22-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="a0d22-125">Devido à natureza desconectada de filas, o cliente e o serviço podem não estar online ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="a0d22-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="a0d22-126">Como tal, o cliente e o serviço precisam trocar certificados fora da banda.</span><span class="sxs-lookup"><span data-stu-id="a0d22-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="a0d22-127">Em particular, o cliente, em virtude de que contém o certificado do serviço (que pode ser encadeado para uma autoridade de certificação) em seu repositório confiável, deve confiar que ele está se comunicando com o serviço correto.</span><span class="sxs-lookup"><span data-stu-id="a0d22-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="a0d22-128">Para autenticar o cliente, o serviço usa o certificado x. 509 anexado com uma mensagem que faz a correspondência com o certificado em seu repositório para verificar a autenticidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="a0d22-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="a0d22-129">Novamente, o certificado deve ser encadeado a uma autoridade de certificação.</span><span class="sxs-lookup"><span data-stu-id="a0d22-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="a0d22-130">Em um computador executando o Windows, os certificados são mantidos em vários tipos de armazenamentos.</span><span class="sxs-lookup"><span data-stu-id="a0d22-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="a0d22-131">Para obter mais informações sobre os diferentes armazenamentos, consulte [repositórios de certificado](https://go.microsoft.com/fwlink/?LinkId=87787).</span><span class="sxs-lookup"><span data-stu-id="a0d22-131">For more information about the different stores, see [Certificate stores](https://go.microsoft.com/fwlink/?LinkId=87787).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="a0d22-132">Windows</span><span class="sxs-lookup"><span data-stu-id="a0d22-132">Windows</span></span>  
 <span data-ttu-id="a0d22-133">Tipo de credencial de mensagem do Windows usa o protocolo Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a0d22-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="a0d22-134">O protocolo Kerberos é um mecanismo de segurança que autentica os usuários em um domínio e permite que os usuários autenticados estabelecer contextos seguros com outras entidades em um domínio.</span><span class="sxs-lookup"><span data-stu-id="a0d22-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="a0d22-135">O problema com o uso do protocolo Kerberos para comunicação em fila é que os tíquetes que contêm a identidade do cliente que distribui o Centro de distribuição de chaves (KDC) têm vida relativamente curta.</span><span class="sxs-lookup"><span data-stu-id="a0d22-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="a0d22-136">Um *tempo de vida* está associado com o tíquete Kerberos que indica a validade do tíquete.</span><span class="sxs-lookup"><span data-stu-id="a0d22-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="a0d22-137">Como tal, dada a alta latência, você não pode ser-se de que o token ainda é válido para o serviço que autentica o cliente.</span><span class="sxs-lookup"><span data-stu-id="a0d22-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="a0d22-138">Observe que, ao usar esse tipo de credencial, o serviço deve ser executado sob a conta de serviço.</span><span class="sxs-lookup"><span data-stu-id="a0d22-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="a0d22-139">O protocolo Kerberos é usado por padrão ao escolher a credencial da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a0d22-139">The Kerberos protocol is used by default when choosing message credential.</span></span> <span data-ttu-id="a0d22-140">Para obter mais informações, consulte [Explorando o Kerberos, o protocolo de segurança distribuída no Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span><span class="sxs-lookup"><span data-stu-id="a0d22-140">For more information, see [Exploring Kerberos, the Protocol for Distributed Security in Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span></span>  
  
### <a name="username-password"></a><span data-ttu-id="a0d22-141">Senha do nome de usuário</span><span class="sxs-lookup"><span data-stu-id="a0d22-141">Username Password</span></span>  
 <span data-ttu-id="a0d22-142">Usando essa propriedade, o cliente pode autenticar para o servidor usando uma senha de nome de usuário no cabeçalho de segurança da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a0d22-142">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="a0d22-143">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="a0d22-143">IssuedToken</span></span>  
 <span data-ttu-id="a0d22-144">O cliente pode usar o serviço de token de segurança para emitir um token que, em seguida, pode ser anexado à mensagem para o serviço autenticar o cliente.</span><span class="sxs-lookup"><span data-stu-id="a0d22-144">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="a0d22-145">Usando o transporte e segurança de mensagem</span><span class="sxs-lookup"><span data-stu-id="a0d22-145">Using Transport and Message Security</span></span>  
 <span data-ttu-id="a0d22-146">Ao usar a segurança de transporte e segurança de mensagem, o certificado usado para proteger a mensagem no transporte e o nível de mensagem SOAP deve ser o mesmo.</span><span class="sxs-lookup"><span data-stu-id="a0d22-146">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a0d22-147">Consulte também</span><span class="sxs-lookup"><span data-stu-id="a0d22-147">See Also</span></span>  
 [<span data-ttu-id="a0d22-148">Protegendo mensagens usando a segurança do transporte</span><span class="sxs-lookup"><span data-stu-id="a0d22-148">Securing Messages Using Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)  
 [<span data-ttu-id="a0d22-149">Segurança de mensagem através do enfileiramento de mensagem</span><span class="sxs-lookup"><span data-stu-id="a0d22-149">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
 [<span data-ttu-id="a0d22-150">Conceitos de segurança</span><span class="sxs-lookup"><span data-stu-id="a0d22-150">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)  
 [<span data-ttu-id="a0d22-151">Protegendo serviços e clientes</span><span class="sxs-lookup"><span data-stu-id="a0d22-151">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
