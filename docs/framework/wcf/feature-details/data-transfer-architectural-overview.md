---
title: Visão geral da arquitetura de transferência de dados
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- data transfer [WCF], architectural overview
ms.assetid: 343c2ca2-af53-4936-a28c-c186b3524ee9
caps.latest.revision: 14
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: cb64b871b8e4ba3036d70f3b84e2fde1667f4529
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2018
---
# <a name="data-transfer-architectural-overview"></a><span data-ttu-id="a6bcc-102">Visão geral da arquitetura de transferência de dados</span><span class="sxs-lookup"><span data-stu-id="a6bcc-102">Data Transfer Architectural Overview</span></span>
[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]<span data-ttu-id="a6bcc-103"> pode ser pensada como uma infraestrutura de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-103"> can be thought of as a messaging infrastructure.</span></span> <span data-ttu-id="a6bcc-104">Pode receber mensagens, processá-los e distribuição para o código de usuário para uma ação adicional, ou pode criar mensagens de dados fornecidos pelo código do usuário e enviá-las para um destino.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-104">It can receive messages, process them, and dispatch them to user code for further action, or it can construct messages from data given by user code and deliver them to a destination.</span></span> <span data-ttu-id="a6bcc-105">Neste tópico, que é direcionado para desenvolvedores avançados, descreve a arquitetura de processamento de mensagens e os dados contidos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-105">This topic, which is intended for advanced developers, describes the architecture for handling messages and the contained data.</span></span> <span data-ttu-id="a6bcc-106">Para uma exibição mais simples e orientada a tarefas de como enviar e receber dados, consulte [especificando a transferência de dados em contratos de serviço](../../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-106">For a simpler, task-oriented view of how to send and receive data, see [Specifying Data Transfer in Service Contracts](../../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a6bcc-107">Este tópico discute [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] detalhes de implementação que não são visíveis por meio do exame de [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] modelo de objeto.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-107">This topic discusses [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] implementation details that are not visible by examining the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] object model.</span></span> <span data-ttu-id="a6bcc-108">Duas palavras de cuidado estão na ordem em relação ao detalhes de implementação documentadas.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-108">Two words of caution are in order with regard to documented implementation details.</span></span> <span data-ttu-id="a6bcc-109">Primeiro, as descrições são simplificadas; implementação real pode ser mais complexa devido a otimizações ou outros motivos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-109">First, the descriptions are simplified; actual implementation may be more complex due to optimizations or other reasons.</span></span> <span data-ttu-id="a6bcc-110">Em segundo lugar, você nunca deve confiar em detalhes específicos de implementação, até mesmo documentado importantes, porque eles podem ser alterados sem aviso prévio de versão para a versão ou até mesmo em uma versão de serviço.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-110">Second, you should never rely on specific implementation details, even documented ones, because these may change without notice from version to version or even in a servicing release.</span></span>  
  
## <a name="basic-architecture"></a><span data-ttu-id="a6bcc-111">Arquitetura básica</span><span class="sxs-lookup"><span data-stu-id="a6bcc-111">Basic Architecture</span></span>  
 <span data-ttu-id="a6bcc-112">No núcleo do [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] recursos de manipulação de mensagens é a <xref:System.ServiceModel.Channels.Message> classe, que é descrita detalhadamente no [usando a classe de mensagem](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-112">At the core of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message-handling capabilities is the <xref:System.ServiceModel.Channels.Message> class, which is described in detail in [Using the Message Class](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span></span> <span data-ttu-id="a6bcc-113">Os componentes de tempo de execução do [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] pode ser dividido em duas partes principais: a pilha de canais e a estrutura do serviço, com o <xref:System.ServiceModel.Channels.Message> classe sendo o ponto de conexão.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-113">The run-time components of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] can be divided into two major parts: the channel stack and the service framework, with the <xref:System.ServiceModel.Channels.Message> class being the connection point.</span></span>  
  
 <span data-ttu-id="a6bcc-114">A pilha de canais é responsável pela conversão entre um válida <xref:System.ServiceModel.Channels.Message> instância e alguma ação que corresponde ao envio ou recebimento de dados da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-114">The channel stack is responsible for converting between a valid <xref:System.ServiceModel.Channels.Message> instance and some action that corresponds to the sending or receiving of message data.</span></span> <span data-ttu-id="a6bcc-115">No lado de envio, a pilha de canais usa válido <xref:System.ServiceModel.Channels.Message> instância e, depois de algum processamento, executa alguma ação que logicamente corresponde ao enviar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-115">On the sending side, the channel stack takes a valid <xref:System.ServiceModel.Channels.Message> instance and, after some processing, performs some action that logically corresponds to sending the message.</span></span> <span data-ttu-id="a6bcc-116">A ação pode estar enviando pacotes TCP ou HTTP, enfileiramento de mensagens no enfileiramento de mensagens, a mensagem de gravação para um banco de dados, salvando-o em um compartilhamento de arquivos, ou qualquer outra ação, dependendo da implementação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-116">The action may be sending TCP or HTTP packets, queuing the message in Message Queuing, writing the message to a database, saving it to a file share, or any other action, depending on the implementation.</span></span> <span data-ttu-id="a6bcc-117">A ação mais comum está enviando a mensagem por meio de um protocolo de rede.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-117">The most common action is sending the message over a network protocol.</span></span> <span data-ttu-id="a6bcc-118">No lado de recebimento, o oposto acontece — uma ação for detectada (que pode ser HTTP ou TCP pacotes que chegam ou qualquer outra ação) e, após o processamento, a pilha de canais converte essa ação em uma opção válida <xref:System.ServiceModel.Channels.Message> instância.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-118">On the receive side, the opposite happens—an action is detected (which may be TCP or HTTP packets arriving or any other action), and, after processing, the channel stack converts this action into a valid <xref:System.ServiceModel.Channels.Message> instance.</span></span>  
  
 <span data-ttu-id="a6bcc-119">Você pode usar [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] usando o <xref:System.ServiceModel.Channels.Message> classe e o canal de pilha diretamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-119">You can use [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] by using the <xref:System.ServiceModel.Channels.Message> class and the channel stack directly.</span></span> <span data-ttu-id="a6bcc-120">No entanto, fazer isso é difícil e demorado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-120">However, doing so is difficult and time-consuming.</span></span> <span data-ttu-id="a6bcc-121">Além disso, o <xref:System.ServiceModel.Channels.Message> objeto não fornece metadados suporte, portanto, não é possível gerar fortemente tipada [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] clientes se você usar [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] dessa maneira.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-121">Additionally, the <xref:System.ServiceModel.Channels.Message> object provides no metadata support, so you cannot generate strongly typed [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] clients if you use [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] in this manner.</span></span>  
  
 <span data-ttu-id="a6bcc-122">Portanto, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] contém uma estrutura de serviço que fornece um modelo de programação de fácil de usar que você pode usar para construir e receber `Message` objetos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-122">Therefore, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] includes a service framework that provides an easy-to-use programming model that you can use to construct and receive `Message` objects.</span></span> <span data-ttu-id="a6bcc-123">Estrutura do serviço de mapas de serviços para [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] tipos por meio da noção de contratos de serviço e distribui as mensagens para operações de usuário que são simplesmente [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] métodos marcados com o <xref:System.ServiceModel.OperationContractAttribute> atributo (para obter mais detalhes, consulte [Criando contratos de serviço](../../../../docs/framework/wcf/designing-service-contracts.md)).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-123">The service framework maps services to [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] types through the notion of service contracts, and dispatches messages to user operations that are simply [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] methods marked with the <xref:System.ServiceModel.OperationContractAttribute> attribute (for more details, see [Designing Service Contracts](../../../../docs/framework/wcf/designing-service-contracts.md)).</span></span> <span data-ttu-id="a6bcc-124">Esses métodos podem ter parâmetros e retornar valores.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-124">These methods may have parameters and return values.</span></span> <span data-ttu-id="a6bcc-125">No lado do serviço, a estrutura do serviço converte entrada <xref:System.ServiceModel.Channels.Message> valores de retorno de instâncias em parâmetros e o converte em saída <xref:System.ServiceModel.Channels.Message> instâncias.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-125">On the service side, the service framework converts incoming <xref:System.ServiceModel.Channels.Message> instances into parameters and converts return values into outgoing <xref:System.ServiceModel.Channels.Message> instances.</span></span> <span data-ttu-id="a6bcc-126">No lado do cliente, ele faz o oposto.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-126">On the client side, it does the opposite.</span></span> <span data-ttu-id="a6bcc-127">Por exemplo, considere o `FindAirfare` operação abaixo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-127">For example, consider the `FindAirfare` operation below.</span></span>  
  
 [!code-csharp[c_DataArchitecture#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#1)]
 [!code-vb[c_DataArchitecture#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#1)]  
  
 <span data-ttu-id="a6bcc-128">Suponha que `FindAirfare` é chamado no cliente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-128">Suppose `FindAirfare` is called on the client.</span></span> <span data-ttu-id="a6bcc-129">A estrutura do serviço no cliente converte o `FromCity` e `ToCity` parâmetros em uma saída <xref:System.ServiceModel.Channels.Message> instância e passá-lo para a pilha de canais para serem enviadas.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-129">The service framework on the client converts the `FromCity` and `ToCity` parameters into an outgoing <xref:System.ServiceModel.Channels.Message> instance and passes it to the channel stack to be sent.</span></span>  
  
 <span data-ttu-id="a6bcc-130">No lado do serviço, quando um <xref:System.ServiceModel.Channels.Message> instância chega da pilha de canais, a estrutura do serviço de extrai os dados relevantes de mensagem para preencher o `FromCity` e `ToCity` parâmetros e, em seguida, chama o lado do serviço `FindAirfare` método.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-130">On the service side, when a <xref:System.ServiceModel.Channels.Message> instance arrives from the channel stack, the service framework extracts the relevant data from the message to populate the `FromCity` and `ToCity` parameters and then calls the service-side `FindAirfare` method.</span></span> <span data-ttu-id="a6bcc-131">Quando o método retorna, a estrutura de serviço usa o valor inteiro retornado e o `IsDirectFlight` parâmetro de saída e cria um <xref:System.ServiceModel.Channels.Message> instância do objeto que contém essas informações.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-131">When the method returns, the service framework takes the returned integer value and the `IsDirectFlight` output parameter and creates a <xref:System.ServiceModel.Channels.Message> object instance that contains this information.</span></span> <span data-ttu-id="a6bcc-132">Ele passa a `Message` instância para a pilha de canais para ser enviada de volta ao cliente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-132">It then passes the `Message` instance to the channel stack to be sent back to the client.</span></span>  
  
 <span data-ttu-id="a6bcc-133">No lado do cliente, um <xref:System.ServiceModel.Channels.Message> surge de instância que contém a mensagem de resposta da pilha de canais.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-133">On the client side, a <xref:System.ServiceModel.Channels.Message> instance that contains the response message emerges from the channel stack.</span></span> <span data-ttu-id="a6bcc-134">Estrutura do serviço de extrai o valor de retorno e o `IsDirectFlight` de valor e retorna-os para o chamador do cliente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-134">The service framework extracts the return value and the `IsDirectFlight` value and returns these to the caller of the client.</span></span>  
  
## <a name="message-class"></a><span data-ttu-id="a6bcc-135">Classe de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-135">Message Class</span></span>  
 <span data-ttu-id="a6bcc-136">O <xref:System.ServiceModel.Channels.Message> classe deve ser uma representação abstrata de uma mensagem, mas seu design fortemente é vinculado à mensagem SOAP.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-136">The <xref:System.ServiceModel.Channels.Message> class is intended to be an abstract representation of a message, but its design is strongly tied to the SOAP message.</span></span> <span data-ttu-id="a6bcc-137">Um <xref:System.ServiceModel.Channels.Message> contém três partes principais de informações: um corpo de mensagem, cabeçalhos de mensagem e propriedades da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-137">A <xref:System.ServiceModel.Channels.Message> contains three major pieces of information: a message body, message headers, and message properties.</span></span>  
  
## <a name="message-body"></a><span data-ttu-id="a6bcc-138">Corpo da mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-138">Message Body</span></span>  
 <span data-ttu-id="a6bcc-139">O corpo da mensagem é serve para representar a carga de dados real da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-139">The message body is intended to represent the actual data payload of the message.</span></span> <span data-ttu-id="a6bcc-140">O corpo da mensagem sempre é representado como um XML Infoset.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-140">The message body is always represented as an XML Infoset.</span></span> <span data-ttu-id="a6bcc-141">Isso não significa que todas as mensagens criadas ou recebidas em [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] deve estar no formato XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-141">This does not mean that all messages created or received in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] must be in XML format.</span></span> <span data-ttu-id="a6bcc-142">Cabe a pilha de canais para decidir como interpretar o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-142">It is up to the channel stack to decide how to interpret the message body.</span></span> <span data-ttu-id="a6bcc-143">Ele pode emiti-lo como XML, convertê-la em outro formato ou mesmo omiti-lo inteiramente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-143">It may emit it as XML, convert it to some other format, or even omit it entirely.</span></span> <span data-ttu-id="a6bcc-144">É claro que, com a maioria das associações [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] fontes, o corpo da mensagem é representado como conteúdo XML na seção de corpo de um envelope SOAP.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-144">Of course, with most of the bindings [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] supplies, the message body is represented as XML content in the body section of a SOAP envelope.</span></span>  
  
 <span data-ttu-id="a6bcc-145">É importante observar que o `Message` classe não contém necessariamente um buffer de dados XML que representa o corpo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-145">It is important to realize that the `Message` class does not necessarily contain a buffer with XML data representing the body.</span></span> <span data-ttu-id="a6bcc-146">Logicamente, `Message` contém um XML Infoset, mas esse Infoset pode ser construída dinamicamente e nunca fisicamente pode existir na memória.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-146">Logically, `Message` contains an XML Infoset, but this Infoset may be dynamically constructed and may never physically exist in memory.</span></span>  
  
### <a name="putting-data-into-the-message-body"></a><span data-ttu-id="a6bcc-147">Colocar dados no corpo da mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-147">Putting Data into the Message Body</span></span>  
 <span data-ttu-id="a6bcc-148">Não há nenhum mecanismo uniforme para colocar dados em um corpo de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-148">There is no uniform mechanism to put data into a message body.</span></span> <span data-ttu-id="a6bcc-149">O <xref:System.ServiceModel.Channels.Message> classe tem um método abstrato, <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29>, que usa um <xref:System.Xml.XmlDictionaryWriter>.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-149">The <xref:System.ServiceModel.Channels.Message> class has an abstract method, <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29>, which takes an <xref:System.Xml.XmlDictionaryWriter>.</span></span> <span data-ttu-id="a6bcc-150">Cada subclasse do <xref:System.ServiceModel.Channels.Message> classe é responsável por substituir esse método e gravar seu próprio conteúdo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-150">Each subclass of the <xref:System.ServiceModel.Channels.Message> class is responsible for overriding this method and writing out its own contents.</span></span> <span data-ttu-id="a6bcc-151">O corpo da mensagem contém logicamente Infoset XML que `OnWriteBodyContent` produz.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-151">The message body logically contains the XML Infoset that `OnWriteBodyContent` produces.</span></span> <span data-ttu-id="a6bcc-152">Por exemplo, considere o seguinte `Message` subclasse.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-152">For example, consider the following `Message` subclass.</span></span>  
  
 [!code-csharp[c_DataArchitecture#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#2)]
 [!code-vb[c_DataArchitecture#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#2)]  
  
 <span data-ttu-id="a6bcc-153">Fisicamente, um `AirfareRequestMessage` instância contém apenas duas cadeias de caracteres ("fromCity" e "toCity").</span><span class="sxs-lookup"><span data-stu-id="a6bcc-153">Physically, an `AirfareRequestMessage` instance contains only two strings ("fromCity" and "toCity").</span></span> <span data-ttu-id="a6bcc-154">No entanto, logicamente a mensagem contém o infoset XML a seguir:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-154">However, logically the message contains the following XML infoset:</span></span>  
  
```xml  
<airfareRequest>  
    <from>Tokyo</from>  
    <to>London</to>  
</airfareRequest>  
```  
  
 <span data-ttu-id="a6bcc-155">Naturalmente, você normalmente não criaria mensagens dessa maneira, como você pode usar a estrutura de serviço para criar uma mensagem semelhante à anterior da operação de parâmetros de contrato.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-155">Of course, you would normally not create messages in this manner, because you can use the service framework to create a message like the preceding one from operation contract parameters.</span></span> <span data-ttu-id="a6bcc-156">Além disso, o <xref:System.ServiceModel.Channels.Message> classe tem estático `CreateMessage` métodos que você pode usar para criar as mensagens com tipos comuns de conteúdo: uma mensagem vazia, uma mensagem que contém um objeto serializado como XML com o <xref:System.Runtime.Serialization.DataContractSerializer>, uma mensagem que contém um SOAP Falha, uma mensagem que contém XML representado por um <xref:System.Xml.XmlReader>, e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-156">Additionally, the <xref:System.ServiceModel.Channels.Message> class has static `CreateMessage` methods that you can use to create messages with common types of content: an empty message, a message that contains an object serialized to XML with the <xref:System.Runtime.Serialization.DataContractSerializer>, a message that contains a SOAP fault, a message that contains XML represented by an <xref:System.Xml.XmlReader>, and so on.</span></span>  
  
### <a name="getting-data-from-a-message-body"></a><span data-ttu-id="a6bcc-157">Obtendo dados de um corpo de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-157">Getting Data from a Message Body</span></span>  
 <span data-ttu-id="a6bcc-158">Você pode extrair os dados armazenados no corpo da mensagem de duas maneiras principais:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-158">You can extract the data stored in a message body in two main ways:</span></span>  
  
-   <span data-ttu-id="a6bcc-159">Você pode obter o corpo da mensagem inteira de uma só vez chamando o <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> método e passando um gravador de XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-159">You can get the entire message body at one time by calling the <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> method and passing in an XML writer.</span></span> <span data-ttu-id="a6bcc-160">O corpo da mensagem completa é gravado para este gravador.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-160">The complete message body is written out to this writer.</span></span> <span data-ttu-id="a6bcc-161">Obter o corpo da mensagem inteira de uma só vez também é chamado *escrever uma mensagem*.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-161">Getting the entire message body at one time is also called *writing a message*.</span></span> <span data-ttu-id="a6bcc-162">Gravação é feita principalmente através da pilha de canais ao enviar mensagens — alguma parte da pilha de canais geralmente obterá acesso ao corpo da mensagem inteira, codificá-lo e enviá-lo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-162">Writing is done primarily by the channel stack when sending messages—some part of the channel stack will usually get access to the entire message body, encode it, and send it.</span></span>  
  
-   <span data-ttu-id="a6bcc-163">Outra maneira de obter informações fora do corpo da mensagem é chamar <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents> e obter um leitor de XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-163">Another way to get information out of the message body is to call <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents> and get an XML reader.</span></span> <span data-ttu-id="a6bcc-164">O corpo da mensagem, em seguida, pode ser acessado em sequência, conforme necessário, chamando métodos do leitor.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-164">The message body can then be accessed sequentially as needed by calling methods on the reader.</span></span> <span data-ttu-id="a6bcc-165">Obtendo a mensagem corpo parte-por-parte também é chamado *ler uma mensagem*.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-165">Getting the message body piece-by-piece is also called *reading a message*.</span></span> <span data-ttu-id="a6bcc-166">Ler a mensagem é usado basicamente pela estrutura do serviço de durante o recebimento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-166">Reading the message is primarily used by the service framework when receiving messages.</span></span> <span data-ttu-id="a6bcc-167">Por exemplo, quando o <xref:System.Runtime.Serialization.DataContractSerializer> está em uso, a estrutura do serviço de obter um leitor de XML sobre o corpo e passá-lo para o mecanismo de desserialização, o que iniciará o mensagem elemento por elemento de leitura e construir o gráfico de objeto correspondente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-167">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> is in use, the service framework will get an XML reader over the body and pass it to the deserialization engine, which will then start reading the message element-by-element and constructing the corresponding object graph.</span></span>  
  
 <span data-ttu-id="a6bcc-168">Um corpo de mensagem pode ser recuperado de uma só vez.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-168">A message body can be retrieved only once.</span></span> <span data-ttu-id="a6bcc-169">Isso torna possível trabalhar com fluxos de somente avanço.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-169">This makes it possible to work with forward-only streams.</span></span> <span data-ttu-id="a6bcc-170">Por exemplo, você pode escrever um <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29> substituição que lê um <xref:System.IO.FileStream> e retorna os resultados como um XML Infoset.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-170">For example, you can write an <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29> override that reads from a <xref:System.IO.FileStream> and returns the results as an XML Infoset.</span></span> <span data-ttu-id="a6bcc-171">Nunca será necessário "retroceder" para o início do arquivo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-171">You will never need to "rewind" to the beginning of the file.</span></span>  
  
 <span data-ttu-id="a6bcc-172">O `WriteBodyContents` e `GetReaderAtBodyContents` métodos simplesmente Verifique se o corpo da mensagem nunca tiver sido recuperado antes e, em seguida, chamar `OnWriteBodyContents` ou `OnGetReaderAtBodyContents`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-172">The `WriteBodyContents` and `GetReaderAtBodyContents` methods simply check that the message body has never been retrieved before, and then call `OnWriteBodyContents` or `OnGetReaderAtBodyContents`, respectively.</span></span>  
  
## <a name="message-usage-in-wcf"></a><span data-ttu-id="a6bcc-173">Uso de mensagem no WCF</span><span class="sxs-lookup"><span data-stu-id="a6bcc-173">Message Usage in WCF</span></span>  
 <span data-ttu-id="a6bcc-174">A maioria das mensagens podem ser classificadas como *saída* (aquelas que são criados pela estrutura do serviço a ser enviado pela pilha de canal) ou *entrada* (aquelas que chegam no canal de pilha e são interpretado pela estrutura do serviço).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-174">Most messages can be classified as either *outgoing* (those that are created by the service framework to be sent by the channel stack) or *incoming* (those that arrive from the channel stack and are interpreted by the service framework).</span></span> <span data-ttu-id="a6bcc-175">Além disso, a pilha de canais pode operar em modo de buffer ou de streaming.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-175">Furthermore, the channel stack can operate in either buffered or streaming mode.</span></span> <span data-ttu-id="a6bcc-176">A estrutura de serviço também pode expor um modelo de programação transmitido ou nonstreamed.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-176">The service framework may also expose a streamed or nonstreamed programming model.</span></span> <span data-ttu-id="a6bcc-177">Isso leva a casos listados na tabela a seguir, juntamente com detalhes simplificadas de sua implementação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-177">This leads to the cases listed in the following table, along with simplified details of their implementation.</span></span>  
  
|<span data-ttu-id="a6bcc-178">Tipo de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-178">Message type</span></span>|<span data-ttu-id="a6bcc-179">Dados do corpo de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-179">Body data in message</span></span>|<span data-ttu-id="a6bcc-180">Implementação de gravação (OnWriteBodyContents)</span><span class="sxs-lookup"><span data-stu-id="a6bcc-180">Write (OnWriteBodyContents) implementation</span></span>|<span data-ttu-id="a6bcc-181">Implementação de leitura (OnGetReaderAtBodyContents)</span><span class="sxs-lookup"><span data-stu-id="a6bcc-181">Read (OnGetReaderAtBodyContents) Implementation</span></span>|  
|------------------|--------------------------|--------------------------------------------------|-------------------------------------------------------|  
|<span data-ttu-id="a6bcc-182">Saída, criado a partir de modelo de programação nonstreamed</span><span class="sxs-lookup"><span data-stu-id="a6bcc-182">Outgoing, created from nonstreamed programming model</span></span>|<span data-ttu-id="a6bcc-183">Os dados necessários para a mensagem de gravação (por exemplo, um objeto e o <xref:System.Runtime.Serialization.DataContractSerializer> instância necessária para serializá-lo) \*</span><span class="sxs-lookup"><span data-stu-id="a6bcc-183">The data needed to write the message (for example, an object and the <xref:System.Runtime.Serialization.DataContractSerializer> instance needed to serialize it)\*</span></span>|<span data-ttu-id="a6bcc-184">A lógica personalizada para gravar a mensagem com base em dados armazenados (por exemplo, chamar `WriteObject` no `DataContractSerializer` se esse for o serializador em uso) \*</span><span class="sxs-lookup"><span data-stu-id="a6bcc-184">Custom logic to write out the message based on the stored data (for example, call `WriteObject` on the `DataContractSerializer` if that is the serializer in use)\*</span></span>|<span data-ttu-id="a6bcc-185">Chamar `OnWriteBodyContents`, os resultados de buffer, retornar um leitor de XML no buffer</span><span class="sxs-lookup"><span data-stu-id="a6bcc-185">Call `OnWriteBodyContents`, buffer the results, return an XML reader over the buffer</span></span>|  
|<span data-ttu-id="a6bcc-186">Saída, criado a partir de modelo de programação em fluxo</span><span class="sxs-lookup"><span data-stu-id="a6bcc-186">Outgoing, created from streamed programming model</span></span>|<span data-ttu-id="a6bcc-187">O `Stream` com os dados a serem gravados \*</span><span class="sxs-lookup"><span data-stu-id="a6bcc-187">The `Stream` with the data to be written\*</span></span>|<span data-ttu-id="a6bcc-188">Gravar dados do fluxo armazenado usando o <xref:System.Xml.IStreamProvider> mecanismo \*</span><span class="sxs-lookup"><span data-stu-id="a6bcc-188">Write out data from the stored stream using the <xref:System.Xml.IStreamProvider> mechanism\*</span></span>|<span data-ttu-id="a6bcc-189">Chamar `OnWriteBodyContents`, os resultados de buffer, retornar um leitor de XML no buffer</span><span class="sxs-lookup"><span data-stu-id="a6bcc-189">Call `OnWriteBodyContents`, buffer the results, return an XML reader over the buffer</span></span>|  
|<span data-ttu-id="a6bcc-190">Entrada da pilha de canais de streaming</span><span class="sxs-lookup"><span data-stu-id="a6bcc-190">Incoming from streaming channel stack</span></span>|<span data-ttu-id="a6bcc-191">Um `Stream` objeto que representa os dados sobre a rede com um <xref:System.Xml.XmlReader> sobre ele</span><span class="sxs-lookup"><span data-stu-id="a6bcc-191">A `Stream` object that represents the data coming in over the network with an <xref:System.Xml.XmlReader> over it</span></span>|<span data-ttu-id="a6bcc-192">Gravar o conteúdo de armazenado `XmlReader` usando `WriteNode`</span><span class="sxs-lookup"><span data-stu-id="a6bcc-192">Write out the contents from the stored `XmlReader` using `WriteNode`</span></span>|<span data-ttu-id="a6bcc-193">Retorna o armazenado `XmlReader`</span><span class="sxs-lookup"><span data-stu-id="a6bcc-193">Returns the stored `XmlReader`</span></span>|  
|<span data-ttu-id="a6bcc-194">Entrada da pilha de canais nonstreaming</span><span class="sxs-lookup"><span data-stu-id="a6bcc-194">Incoming from nonstreaming channel stack</span></span>|<span data-ttu-id="a6bcc-195">Um buffer que contém o corpo de dados com um `XmlReader` sobre ele</span><span class="sxs-lookup"><span data-stu-id="a6bcc-195">A buffer that contains body data with an `XmlReader` over it</span></span>|<span data-ttu-id="a6bcc-196">Grava o conteúdo de armazenado `XmlReader` usando `WriteNode`</span><span class="sxs-lookup"><span data-stu-id="a6bcc-196">Writes out the contents from the stored `XmlReader` using `WriteNode`</span></span>|<span data-ttu-id="a6bcc-197">Retorna o lang armazenado</span><span class="sxs-lookup"><span data-stu-id="a6bcc-197">Returns the stored lang</span></span>|  
  
 <span data-ttu-id="a6bcc-198">\* Esses itens não são implementados diretamente no `Message` subclasses, mas em subclasses de <xref:System.ServiceModel.Channels.BodyWriter> classe.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-198">\* These items are not implemented directly in `Message` subclasses, but in subclasses of the <xref:System.ServiceModel.Channels.BodyWriter> class.</span></span> <span data-ttu-id="a6bcc-199">Para obter mais informações sobre o <xref:System.ServiceModel.Channels.BodyWriter>, consulte [usando a classe de mensagem](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-199">For more information about the <xref:System.ServiceModel.Channels.BodyWriter>, see [Using the Message Class](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span></span>  
  
## <a name="message-headers"></a><span data-ttu-id="a6bcc-200">Cabeçalhos de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-200">Message Headers</span></span>  
 <span data-ttu-id="a6bcc-201">Uma mensagem pode conter cabeçalhos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-201">A message may contain headers.</span></span> <span data-ttu-id="a6bcc-202">Logicamente, um cabeçalho consiste em um Infoset XML que está associado com um nome, um namespace e algumas outras propriedades.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-202">A header logically consists of an XML Infoset that is associated with a name, a namespace, and a few other properties.</span></span> <span data-ttu-id="a6bcc-203">Cabeçalhos de mensagem são acessados usando o `Headers` propriedade <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-203">Message headers are accessed using the `Headers` property on <xref:System.ServiceModel.Channels.Message>.</span></span> <span data-ttu-id="a6bcc-204">Cada cabeçalho é representado por um <xref:System.ServiceModel.Channels.MessageHeader> classe.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-204">Each header is represented by a <xref:System.ServiceModel.Channels.MessageHeader> class.</span></span> <span data-ttu-id="a6bcc-205">Normalmente, os cabeçalhos de mensagem são mapeados para cabeçalhos de mensagem SOAP ao usar uma pilha de canais configurada para trabalhar com mensagens SOAP.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-205">Normally, message headers are mapped to SOAP message headers when using a channel stack configured to work with SOAP messages.</span></span>  
  
 <span data-ttu-id="a6bcc-206">Colocar as informações em um cabeçalho de mensagem e extrair informações dele são semelhante a usar o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-206">Putting information into a message header and extracting information from it is similar to using the message body.</span></span> <span data-ttu-id="a6bcc-207">O processo é um pouco simplificado porque não há suporte para streaming.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-207">The process is somewhat simplified because streaming is not supported.</span></span> <span data-ttu-id="a6bcc-208">É possível acessar o conteúdo do cabeçalho do mesmo mais de uma vez e cabeçalhos podem ser acessados na ordem arbitrária, forçando cabeçalhos sempre serem armazenados em buffer.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-208">It is possible to access the contents of the same header more than once, and headers can be accessed in arbitrary order, forcing headers to always be buffered.</span></span> <span data-ttu-id="a6bcc-209">Há nenhum mecanismo de uso geral disponível para obter um leitor de XML em um cabeçalho, mas não há um `MessageHeader` subclasse interno [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] que representa um cabeçalho legível com esse recurso.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-209">There is no general-purpose mechanism available to get an XML reader over a header, but there is a `MessageHeader` subclass internal to [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] that represents a readable header with such a capability.</span></span> <span data-ttu-id="a6bcc-210">Esse tipo de `MessageHeader` é criado pela pilha de canais quando chega uma mensagem com cabeçalhos de aplicativo personalizado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-210">This type of `MessageHeader` is created by the channel stack when a message with custom application headers comes in.</span></span> <span data-ttu-id="a6bcc-211">Isso permite que a estrutura do serviço usar um mecanismo de desserialização, como o <xref:System.Runtime.Serialization.DataContractSerializer>, interpretar esses cabeçalhos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-211">This enables the service framework to use a deserialization engine, such as the <xref:System.Runtime.Serialization.DataContractSerializer>, to interpret these headers.</span></span>  
  
 <span data-ttu-id="a6bcc-212">Para obter mais informações, consulte [usando a classe de mensagem](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-212">For more information, see [Using the Message Class](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span></span>  
  
## <a name="message-properties"></a><span data-ttu-id="a6bcc-213">Propriedades de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-213">Message Properties</span></span>  
 <span data-ttu-id="a6bcc-214">Uma mensagem pode conter propriedades.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-214">A message may contain properties.</span></span> <span data-ttu-id="a6bcc-215">Um *propriedade* é qualquer [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objeto que está associado com um nome de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-215">A *property* is any [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] object that is associated with a string name.</span></span> <span data-ttu-id="a6bcc-216">Propriedades são acessadas por meio de `Properties` propriedade `Message`.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-216">Properties are accessed through the `Properties` property on `Message`.</span></span>  
  
 <span data-ttu-id="a6bcc-217">Ao contrário do corpo da mensagem e os cabeçalhos de mensagem (que normalmente mapeiam para o corpo SOAP e os cabeçalhos SOAP, respectivamente), é possível que as propriedades de mensagem normalmente não são enviadas ou recebidas junto com as mensagens.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-217">Unlike the message body and message headers (which normally map to the SOAP body and SOAP headers, respectively), message properties are normally not sent or received along with the messages.</span></span> <span data-ttu-id="a6bcc-218">Propriedades de mensagem existem principalmente como um mecanismo de comunicação para passar dados sobre a mensagem entre os diversos canais na pilha de canais e entre a pilha de canais e o modelo de serviço.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-218">Message properties exist primarily as a communication mechanism to pass data about the message between the various channels in the channel stack, and between the channel stack and the service model.</span></span>  
  
 <span data-ttu-id="a6bcc-219">Por exemplo, HTTP transporte canal incluído como parte do [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] é capaz de gerar vários códigos de status HTTP, como "404 (não encontrado)" e "500 (erro interno do servidor)," quando ele envia respostas a clientes.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-219">For example, the HTTP transport channel included as part of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is capable of producing various HTTP status codes, such as "404 (Not Found)" and "500 (Internal Server Error)," when it sends replies to clients.</span></span> <span data-ttu-id="a6bcc-220">Antes de enviar uma mensagem de resposta, ele verifica se o `Properties` do `Message` contém uma propriedade chamada "httpResponse" que contém um objeto do tipo <xref:System.ServiceModel.Channels.HttpResponseMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-220">Before sending a reply message, it checks to see whether the `Properties` of the `Message` contain a property called "httpResponse" that contains an object of type <xref:System.ServiceModel.Channels.HttpResponseMessageProperty>.</span></span> <span data-ttu-id="a6bcc-221">Se essa propriedade for encontrada, ele examinará os <xref:System.ServiceModel.Channels.HttpResponseMessageProperty.StatusCode%2A> propriedade e usar esse código de status.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-221">If such a property is found, it will look at the <xref:System.ServiceModel.Channels.HttpResponseMessageProperty.StatusCode%2A> property and use that status code.</span></span> <span data-ttu-id="a6bcc-222">Se ele não for encontrado, o padrão "200 (Okey)" código é usado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-222">If it is not found, the default "200 (OK)" code is used.</span></span>  
  
 <span data-ttu-id="a6bcc-223">Para obter mais informações, consulte [usando a classe de mensagem](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-223">For more information, see [Using the Message Class](../../../../docs/framework/wcf/feature-details/using-the-message-class.md).</span></span>  
  
### <a name="the-message-as-a-whole"></a><span data-ttu-id="a6bcc-224">A mensagem como um todo</span><span class="sxs-lookup"><span data-stu-id="a6bcc-224">The Message as a Whole</span></span>  
 <span data-ttu-id="a6bcc-225">Até agora, discutimos métodos para acessar as diversas partes da mensagem em isolamento.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-225">So far, we have discussed methods for accessing the various parts of the message in isolation.</span></span> <span data-ttu-id="a6bcc-226">No entanto, a <xref:System.ServiceModel.Channels.Message> classe também fornece métodos para trabalhar com a mensagem inteira como um todo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-226">However, the <xref:System.ServiceModel.Channels.Message> class also provides methods to work with the entire message as a whole.</span></span> <span data-ttu-id="a6bcc-227">Por exemplo, o `WriteMessage` método grava a mensagem inteira para um gravador XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-227">For example, the `WriteMessage` method writes out the entire message to an XML writer.</span></span>  
  
 <span data-ttu-id="a6bcc-228">Para que isso seja possível, um mapeamento deve ser definido entre todo o `Message` instância e um XML Infoset.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-228">For this to be possible, a mapping must be defined between the entire `Message` instance and an XML Infoset.</span></span> <span data-ttu-id="a6bcc-229">Na verdade, existe um mapeamento,: [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] usa o padrão SOAP para definir esse mapeamento.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-229">Such a mapping, in fact, exists: [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] uses the SOAP standard to define this mapping.</span></span> <span data-ttu-id="a6bcc-230">Quando um `Message` instância é gravado como um XML Infoset Infoset resultante é o envelope SOAP válido que contém a mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-230">When a `Message` instance is written out as an XML Infoset, the resulting Infoset is the valid SOAP envelope that contains the message.</span></span> <span data-ttu-id="a6bcc-231">Portanto, `WriteMessage` normalmente deve executar as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-231">Thus, `WriteMessage` would normally perform the following steps:</span></span>  
  
1.  <span data-ttu-id="a6bcc-232">Grave o elemento de envelope SOAP marca de abertura.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-232">Write the SOAP envelope element opening tag.</span></span>  
  
2.  <span data-ttu-id="a6bcc-233">Gravar o elemento de cabeçalho SOAP marca de abertura, gravar todos os cabeçalhos e fechar o elemento de cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-233">Write the SOAP header element opening tag, write out all of the headers, and close the header element.</span></span>  
  
3.  <span data-ttu-id="a6bcc-234">Grave o elemento de corpo SOAP marca de abertura.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-234">Write the SOAP body element opening tag.</span></span>  
  
4.  <span data-ttu-id="a6bcc-235">Chamar `WriteBodyContents` ou um método equivalente para gravar o corpo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-235">Call `WriteBodyContents` or an equivalent method to write out the body.</span></span>  
  
5.  <span data-ttu-id="a6bcc-236">Feche os elementos do corpo e envelope.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-236">Close the body and envelope elements.</span></span>  
  
 <span data-ttu-id="a6bcc-237">As etapas anteriores são rigorosamente associadas com o padrão de SOAP.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-237">The preceding steps are closely tied to the SOAP standard.</span></span> <span data-ttu-id="a6bcc-238">Isso é complicado pelo fato de que várias versões de SOAP existem, por exemplo, não é possível gravar o elemento de envelope SOAP corretamente sem saber a versão SOAP em uso.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-238">This is complicated by the fact that multiple versions of SOAP exist, for example, it is impossible to write out the SOAP envelope element correctly without knowing the SOAP version in use.</span></span> <span data-ttu-id="a6bcc-239">Além disso, em alguns casos, pode ser desejável para desativar este específicas de SOAP complexa mapeamento completamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-239">Also, in some cases, it may be desirable to turn off this complex SOAP-specific mapping completely.</span></span>  
  
 <span data-ttu-id="a6bcc-240">Para esses fins, um `Version` é fornecida em `Message`.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-240">For these purposes, a `Version` property is provided on `Message`.</span></span> <span data-ttu-id="a6bcc-241">Pode ser definido para a versão SOAP a ser usado ao gravar a mensagem, ou ele pode ser definido como `None` para evitar qualquer mapeamento específicas de SOAP.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-241">It can be set to the SOAP version to use when writing out the message, or it can be set to `None` to prevent any SOAP-specific mappings.</span></span> <span data-ttu-id="a6bcc-242">Se o `Version` está definida como `None`, métodos que funcionam com o ato de mensagem inteira como se a mensagem consistiu em seu corpo, por exemplo, `WriteMessage` simplesmente chamar `WriteBodyContents` em vez de executar várias etapas listadas acima.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-242">If the `Version` property is set to `None`, methods that work with the entire message act as if the message consisted of its body only, for example, `WriteMessage` would simply call `WriteBodyContents` instead of performing the multiple steps listed above.</span></span> <span data-ttu-id="a6bcc-243">Espera-se que em mensagens de entrada, `Version` será detectado automaticamente e configurado corretamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-243">It is expected that on incoming messages, `Version` will be auto-detected and set correctly.</span></span>  
  
## <a name="the-channel-stack"></a><span data-ttu-id="a6bcc-244">A pilha de canais</span><span class="sxs-lookup"><span data-stu-id="a6bcc-244">The Channel Stack</span></span>  
  
### <a name="channels"></a><span data-ttu-id="a6bcc-245">Canais</span><span class="sxs-lookup"><span data-stu-id="a6bcc-245">Channels</span></span>  
 <span data-ttu-id="a6bcc-246">Conforme mencionado anteriormente, a pilha de canais é responsável por converter a saída <xref:System.ServiceModel.Channels.Message> instâncias em alguma ação (como o envio de pacotes de rede) ou conversão de alguma ação (como receber pacotes de rede) em entrada `Message` instâncias.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-246">As stated before, the channel stack is responsible for converting outgoing <xref:System.ServiceModel.Channels.Message> instances into some action (such as sending packets over the network), or converting some action (such as receiving network packets) into incoming `Message` instances.</span></span>  
  
 <span data-ttu-id="a6bcc-247">A pilha de canais é composta de um ou mais canais ordenados em uma sequência.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-247">The channel stack is composed of one or more channels ordered in a sequence.</span></span> <span data-ttu-id="a6bcc-248">Uma saída `Message` instância é passada para o primeiro canal na pilha (também chamado de *canal mais alto*), que passa para o próximo canal para baixo na pilha e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-248">An outgoing `Message` instance is passed to the first channel in the stack (also called the *topmost channel*), which passes it to the next channel down in stack, and so on.</span></span> <span data-ttu-id="a6bcc-249">A mensagem termina no último canal, que é chamado de *canal de transporte*.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-249">The message terminates in the last channel, which is called the *transport channel*.</span></span> <span data-ttu-id="a6bcc-250">Mensagens de entrada são originadas no canal de transporte e são passadas de canal na pilha.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-250">Incoming messages originate in the transport channel and are passed from channel to channel up the stack.</span></span> <span data-ttu-id="a6bcc-251">Do canal mais alto, a mensagem geralmente é passada na estrutura de serviço.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-251">From the topmost channel, the message is usually passed into the service framework.</span></span> <span data-ttu-id="a6bcc-252">Embora esse seja o padrão comum para as mensagens de aplicativo, alguns canais podem funcionar de forma ligeiramente diferente, por exemplo, eles podem enviar suas próprias mensagens de infraestrutura sem serem passados a uma mensagem de um canal acima.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-252">While this is the usual pattern for application messages, some channels may work slightly differently, for example, they may send their own infrastructure messages without being passed a message from a channel above.</span></span>  
  
 <span data-ttu-id="a6bcc-253">Canais podem operar na mensagem de várias maneiras, conforme ele passa por meio da pilha.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-253">Channels may operate on the message in various ways as it passes through the stack.</span></span> <span data-ttu-id="a6bcc-254">A operação mais comum é a adição de um cabeçalho de uma mensagem de saída e ler os cabeçalhos em uma mensagem de entrada.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-254">The most common operation is adding a header to an outgoing message and reading headers on an incoming message.</span></span> <span data-ttu-id="a6bcc-255">Por exemplo, um canal pode calcular a assinatura digital de uma mensagem e adicioná-lo como um cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-255">For example, a channel may compute the digital signature of a message and add it as a header.</span></span> <span data-ttu-id="a6bcc-256">Um canal também pode inspecionar esse cabeçalho de assinatura digital em mensagens de entrada e bloquear mensagens que não têm uma assinatura válida de fazer sua forma a pilha de canais.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-256">A channel may also inspect this digital signature header on incoming messages and block messages that do not have a valid signature from making their way up the channel stack.</span></span> <span data-ttu-id="a6bcc-257">Canais também costuma ser definido ou Inspecione as propriedades de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-257">Channels also often set or inspect message properties.</span></span> <span data-ttu-id="a6bcc-258">O corpo da mensagem geralmente não é modificado, embora isso é permitido, por exemplo, o [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] canal de segurança pode criptografar o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-258">The message body is usually not modified, although this is allowed, for example, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security channel can encrypt the message body.</span></span>  
  
### <a name="transport-channels-and-message-encoders"></a><span data-ttu-id="a6bcc-259">Canais de transporte e codificadores de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-259">Transport Channels and Message Encoders</span></span>  
 <span data-ttu-id="a6bcc-260">O canal mais baixo na pilha é responsável por transformar, na verdade, uma saída <xref:System.ServiceModel.Channels.Message>, conforme modificado por outros canais em alguma ação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-260">The bottommost channel in the stack is responsible for actually transforming an outgoing <xref:System.ServiceModel.Channels.Message>, as modified by other channels, into some action.</span></span> <span data-ttu-id="a6bcc-261">No lado de recebimento, esse é o canal que converte alguma ação em um `Message` que outros canais de processo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-261">On the receive side, this is the channel that converts some action into a `Message` that other channels process.</span></span>  
  
 <span data-ttu-id="a6bcc-262">Como mencionado anteriormente, as ações podem ser variadas: enviar ou receber pacotes de rede em vários protocolos, ler ou gravar a mensagem em um banco de dados ou enfileiramento de mensagens ou removê-la fila a mensagem na fila de enfileiramento de mensagens, para fornecer, mas alguns exemplos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-262">As stated previously, the actions may be varied: sending or receiving network packets over various protocols, reading or writing the message in a database, or queuing or dequeuing the message in a Message Queuing queue, to provide but a few examples.</span></span> <span data-ttu-id="a6bcc-263">Todas essas ações têm algo em comum: eles requerem uma transformação entre o [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] `Message` instância e um grupo real de bytes que pode ser enviada, recebida, ler, escrito, na fila ou removida da fila.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-263">All these actions have one thing in common: they require a transformation between the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]`Message` instance and an actual group of bytes that can be sent, received, read, written, queued, or dequeued.</span></span> <span data-ttu-id="a6bcc-264">O processo de converter um `Message` em um grupo de bytes é chamado *codificação*e o processo inverso da criação de um `Message` de um grupo de bytes é chamado *decodificação*.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-264">The process of converting a `Message` into a group of bytes is called *encoding*, and the reverse process of creating a `Message` from a group of bytes is called *decoding*.</span></span>  
  
 <span data-ttu-id="a6bcc-265">A maioria dos canais de transporte usam componentes chamados *codificadores de mensagem* para realizar a codificação e decodificação de trabalho.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-265">Most transport channels use components called *message encoders* to accomplish the encoding and decoding work.</span></span> <span data-ttu-id="a6bcc-266">Um codificador de mensagem é uma subclasse do <xref:System.ServiceModel.Channels.MessageEncoder> classe.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-266">A message encoder is a subclass of the <xref:System.ServiceModel.Channels.MessageEncoder> class.</span></span> <span data-ttu-id="a6bcc-267">`MessageEncoder` inclui vários `ReadMessage` e `WriteMessage` sobrecargas do método para converter entre `Message` e grupos de bytes.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-267">`MessageEncoder` includes various `ReadMessage` and `WriteMessage` method overloads to convert between `Message` and groups of bytes.</span></span>  
  
 <span data-ttu-id="a6bcc-268">No lado de envio, um canal de transporte buffer passa o `Message` objeto recebida de um canal acima para `WriteMessage`.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-268">On the sending side, a buffering transport channel passes the `Message` object that it received from a channel above it to `WriteMessage`.</span></span> <span data-ttu-id="a6bcc-269">Ele obtém de volta uma matriz de bytes, que ele usa para executar a ação (como empacotar esses bytes como pacotes TCP válidos e enviá-los para o destino correto).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-269">It gets back an array of bytes, which it then uses to perform its action (such as packaging these bytes as valid TCP packets and sending them to the correct destination).</span></span> <span data-ttu-id="a6bcc-270">Primeiro cria um canal de transporte streaming um `Stream` (por exemplo, mais a saída TCP conexão) e, em seguida, passa o `Stream` e o `Message` que precisa para enviar ao apropriado `WriteMessage` sobrecarga, que grava a mensagem .</span><span class="sxs-lookup"><span data-stu-id="a6bcc-270">A streaming transport channel first creates a `Stream` (for example, over the outgoing TCP connection), and then passes both the `Stream` and the `Message` it needs to send to the appropriate `WriteMessage` overload, which writes out the message.</span></span>  
  
 <span data-ttu-id="a6bcc-271">No lado de recepção, um canal de transporte buffer extrai bytes de entrada (por exemplo, de pacotes de entrada TCP) em uma matriz e chamadas `ReadMessage` para obter um `Message` que pode passar mais acima na pilha de canal do objeto.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-271">On the receiving side, a buffering transport channel extracts incoming bytes (for example, from incoming TCP packets) into an array and calls `ReadMessage` to get a `Message` object that it can pass further up the channel stack.</span></span> <span data-ttu-id="a6bcc-272">Cria um canal de transporte streaming um `Stream` objeto (por exemplo, um fluxo de rede sobre a conexão de TCP de entrada) e passa para `ReadMessage` para retornar um `Message` objeto.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-272">A streaming transport channel creates a `Stream` object (for example, a network stream over the incoming TCP connection) and passes that to `ReadMessage` to get back a `Message` object.</span></span>  
  
 <span data-ttu-id="a6bcc-273">A separação entre os canais de transporte e o codificador de mensagem não é obrigatória. é possível gravar um canal de transporte que não usa um codificador de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-273">The separation between the transport channels and the message encoder is not mandatory; it is possible to write a transport channel that does not use a message encoder.</span></span> <span data-ttu-id="a6bcc-274">No entanto, a vantagem dessa separação é a facilidade de composição.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-274">However, the advantage of this separation is ease of composition.</span></span> <span data-ttu-id="a6bcc-275">Como um canal de transporte usa apenas a base de <xref:System.ServiceModel.Channels.MessageEncoder>, ele pode funcionar com qualquer [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ou codificador de mensagem de terceiros.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-275">As long as a transport channel uses only the base <xref:System.ServiceModel.Channels.MessageEncoder>, it can work with any [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] or third-party message encoder.</span></span> <span data-ttu-id="a6bcc-276">Da mesma forma, o mesmo codificador normalmente pode ser usado em qualquer canal de transporte.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-276">Likewise, the same encoder can normally be used in any transport channel.</span></span>  
  
### <a name="message-encoder-operation"></a><span data-ttu-id="a6bcc-277">Operação de codificador de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-277">Message Encoder Operation</span></span>  
 <span data-ttu-id="a6bcc-278">Para descrever a uma operação típica de um codificador, é útil considerar quatro casos a seguir.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-278">To describe the typical operation of an encoder, it is useful to consider the following four cases.</span></span>  
  
|<span data-ttu-id="a6bcc-279">Operação</span><span class="sxs-lookup"><span data-stu-id="a6bcc-279">Operation</span></span>|<span data-ttu-id="a6bcc-280">Comentário</span><span class="sxs-lookup"><span data-stu-id="a6bcc-280">Comment</span></span>|  
|---------------|-------------|  
|<span data-ttu-id="a6bcc-281">Codificação, armazenada em buffer</span><span class="sxs-lookup"><span data-stu-id="a6bcc-281">Encoding, Buffered</span></span>|<span data-ttu-id="a6bcc-282">No modo de buffer, o codificador normalmente cria um buffer de tamanho variável e, em seguida, cria um gravador de XML sobre ele.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-282">In buffered mode, the encoder normally creates a variable-size buffer and then creates an XML writer over it.</span></span> <span data-ttu-id="a6bcc-283">Depois, ele chama <xref:System.ServiceModel.Channels.Message.WriteMessage%28System.Xml.XmlWriter%29> na mensagem que está sendo codificada, que grava os cabeçalhos e, em seguida, o corpo, usando <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29>, conforme explicado na seção anterior sobre `Message` neste tópico.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-283">It then calls <xref:System.ServiceModel.Channels.Message.WriteMessage%28System.Xml.XmlWriter%29> on the message being encoded, which writes out the headers and then the body using <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29>, as explained in the preceding section about `Message` in this topic.</span></span> <span data-ttu-id="a6bcc-284">O conteúdo do buffer (representado como uma matriz de bytes), em seguida, é retornado para o canal de transporte a ser usado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-284">The contents of the buffer (represented as an array of bytes) are then returned for the transport channel to use.</span></span>|  
|<span data-ttu-id="a6bcc-285">Streaming de codificação,</span><span class="sxs-lookup"><span data-stu-id="a6bcc-285">Encoding, Streamed</span></span>|<span data-ttu-id="a6bcc-286">No modo de fluxo, a operação é semelhante a acima, mas mais simples.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-286">In streamed mode, the operation is similar to the above, but simpler.</span></span> <span data-ttu-id="a6bcc-287">Não é necessário para um buffer.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-287">There is no need for a buffer.</span></span> <span data-ttu-id="a6bcc-288">Um gravador de XML é normalmente criado no fluxo e <xref:System.ServiceModel.Channels.Message.WriteMessage%28System.Xml.XmlWriter%29> é chamado no `Message` para gravar este gravador.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-288">An XML writer is normally created over the stream and <xref:System.ServiceModel.Channels.Message.WriteMessage%28System.Xml.XmlWriter%29> is called on the `Message` to write it out to this writer.</span></span>|  
|<span data-ttu-id="a6bcc-289">Decodificação de buffer</span><span class="sxs-lookup"><span data-stu-id="a6bcc-289">Decoding, Buffered</span></span>|<span data-ttu-id="a6bcc-290">Quando no modo de buffer, um especial de decodificação `Message` subclasse que contém os dados armazenados em buffer normalmente é criado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-290">When decoding in buffered mode, a special `Message` subclass that contains the buffered data is normally created.</span></span> <span data-ttu-id="a6bcc-291">Os cabeçalhos da mensagem são lidas e um leitor de XML posicionado no corpo da mensagem é criado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-291">The headers of the message are read, and an XML reader positioned on the message body is created.</span></span> <span data-ttu-id="a6bcc-292">Este é o leitor será retornado com <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents>.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-292">This is the reader that will be returned with <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents>.</span></span>|  
|<span data-ttu-id="a6bcc-293">Decodificação de streaming</span><span class="sxs-lookup"><span data-stu-id="a6bcc-293">Decoding, Streamed</span></span>|<span data-ttu-id="a6bcc-294">Ao decodificar no modo de fluxo, uma subclasse de mensagem especial normalmente é criada.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-294">When decoding in streamed mode, a special Message subclass is normally created.</span></span> <span data-ttu-id="a6bcc-295">O fluxo é avançado apenas o suficiente para ler todos os cabeçalhos e posicione-o no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-295">The stream is advanced just enough to read all the headers and position it on the message body.</span></span> <span data-ttu-id="a6bcc-296">Um leitor de XML é criado no fluxo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-296">An XML reader is then created over the stream.</span></span> <span data-ttu-id="a6bcc-297">Este é o leitor será retornado com <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents>.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-297">This is the reader that will be returned with <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents>.</span></span>|  
  
 <span data-ttu-id="a6bcc-298">Os codificadores podem executar outras funções.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-298">Encoders can perform other functions as well.</span></span> <span data-ttu-id="a6bcc-299">Por exemplo, os codificadores podem reunir os gravadores e leitores XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-299">For example, the encoders can pool XML readers and writers.</span></span> <span data-ttu-id="a6bcc-300">É caro criar um novo leitor XML ou gravador sempre que necessário.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-300">It is expensive to create a new XML reader or writer every time one is needed.</span></span> <span data-ttu-id="a6bcc-301">Portanto, os codificadores normalmente mantêm um pool de leitores e um pool de gravadores de tamanho configurável.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-301">Therefore, encoders normally maintain a pool of readers and a pool of writers of configurable size.</span></span> <span data-ttu-id="a6bcc-302">Nas descrições de operação de codificador descrita anteriormente, sempre que a frase "criar um leitor/gravador de XML" é usado, normalmente significa "execute um do pool, ou criar um se um não estiver disponível."</span><span class="sxs-lookup"><span data-stu-id="a6bcc-302">In the descriptions of encoder operation described previously, whenever the phrase "create an XML reader/writer" is used, it normally means "take one from the pool, or create one if one is not available."</span></span> <span data-ttu-id="a6bcc-303">O codificador (e o `Message` subclasses cria durante a decodificação) contêm a lógica para retornar os leitores e gravadores para os pools quando eles não são mais necessários (por exemplo, quando o `Message` está fechado).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-303">The encoder (and the `Message` subclasses it creates while decoding) contain logic to return readers and writers to the pools once they are no longer needed (for example, when the `Message` is closed).</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="a6bcc-304"> fornece três codificadores de mensagem, embora seja possível criar tipos personalizados adicionais.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-304"> provides three message encoders, although it is possible to create additional custom types.</span></span> <span data-ttu-id="a6bcc-305">Os tipos fornecidos são texto, binária e mecanismo de otimização de transmissão mensagem (MTOM).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-305">The supplied types are Text, Binary, and Message Transmission Optimization Mechanism (MTOM).</span></span> <span data-ttu-id="a6bcc-306">Elas são descritas em detalhes em [escolhendo um codificador de mensagem](../../../../docs/framework/wcf/feature-details/choosing-a-message-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-306">These are described in detail in [Choosing a Message Encoder](../../../../docs/framework/wcf/feature-details/choosing-a-message-encoder.md).</span></span>  
  
### <a name="the-istreamprovider-interface"></a><span data-ttu-id="a6bcc-307">A Interface IStreamProvider</span><span class="sxs-lookup"><span data-stu-id="a6bcc-307">The IStreamProvider Interface</span></span>  
 <span data-ttu-id="a6bcc-308">Ao escrever uma mensagem de saída que contém um corpo transmitido para um gravador XML, o <xref:System.ServiceModel.Channels.Message> usa uma sequência de chamadas semelhantes à seguinte na sua <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29> implementação:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-308">When writing an outgoing message that contains a streamed body to an XML writer, the <xref:System.ServiceModel.Channels.Message> uses a sequence of calls similar to the following in its <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29> implementation:</span></span>  
  
-   <span data-ttu-id="a6bcc-309">Grave todas as informações necessárias antes do fluxo (por exemplo, a marca de abertura XML).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-309">Write any necessary information preceding the stream (for example, the opening XML tag).</span></span>  
  
-   <span data-ttu-id="a6bcc-310">O fluxo de gravação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-310">Write the stream.</span></span>  
  
-   <span data-ttu-id="a6bcc-311">Grave todas as informações a seguir o fluxo (por exemplo, o marca XML de fechamento).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-311">Write any information following the stream (for example, the closing XML tag).</span></span>  
  
 <span data-ttu-id="a6bcc-312">Isso funciona bem com codificações que são semelhantes a codificação XML textual.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-312">This works well with encodings that are similar to the textual XML encoding.</span></span> <span data-ttu-id="a6bcc-313">No entanto, algumas codificações não coloque informações Infoset XML (por exemplo, marcas de início e término elementos XML) junto com os dados contidos em elementos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-313">However, some encodings do not place XML Infoset information (for example, tags for starting and ending XML elements) together with the data contained within elements.</span></span> <span data-ttu-id="a6bcc-314">Por exemplo, a codificação de MTOM, a mensagem é dividida em várias partes.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-314">For example, in the MTOM encoding, the message is split into multiple parts.</span></span> <span data-ttu-id="a6bcc-315">Uma parte contém Infoset XML, que podem conter referências a outras partes do conteúdo de elemento real.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-315">One part contains the XML Infoset, which may contain references to other parts for actual element contents.</span></span> <span data-ttu-id="a6bcc-316">O Infoset XML é normalmente pequeno em comparação com o conteúdo em fluxo, faz sentido Infoset de buffer, grave-o e, em seguida, gravar o conteúdo de uma maneira em fluxo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-316">The XML Infoset is normally small compared to the streamed contents, so it makes sense to buffer the Infoset, write it out, and then write the contents in a streamed way.</span></span> <span data-ttu-id="a6bcc-317">Isso significa que, no momento o fechamento marca do elemento é gravada, o fluxo deve não tenha sido escrito ainda.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-317">This means that by the time the closing element tag is written, the stream should not have been written out yet.</span></span>  
  
 <span data-ttu-id="a6bcc-318">Para essa finalidade, o <xref:System.Xml.IStreamProvider> interface é usada.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-318">For this purpose, the <xref:System.Xml.IStreamProvider> interface is used.</span></span> <span data-ttu-id="a6bcc-319">A interface tiver um <xref:System.Xml.IStreamProvider.GetStream> método que retorna o fluxo a ser gravado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-319">The interface has a <xref:System.Xml.IStreamProvider.GetStream> method that returns the stream to be written.</span></span> <span data-ttu-id="a6bcc-320">A maneira correta de gravar um corpo de mensagem transmitida em <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29> é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-320">The correct way to write out a streamed message body in <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%28System.Xml.XmlDictionaryWriter%29> is as follows:</span></span>  
  
1.  <span data-ttu-id="a6bcc-321">Grave todas as informações necessárias antes do fluxo (por exemplo, a marca de abertura XML).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-321">Write any necessary information preceding the stream (for example, the opening XML tag).</span></span>  
  
2.  <span data-ttu-id="a6bcc-322">Chamar o `WriteValue` de sobrecarga no <xref:System.Xml.XmlDictionaryWriter> que leva um <xref:System.Xml.IStreamProvider>, com um `IStreamProvider` implementação que retorna o fluxo a ser gravado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-322">Call the `WriteValue` overload on the <xref:System.Xml.XmlDictionaryWriter> that takes an <xref:System.Xml.IStreamProvider>, with an `IStreamProvider` implementation that returns the stream to be written.</span></span>  
  
3.  <span data-ttu-id="a6bcc-323">Grave todas as informações a seguir o fluxo (por exemplo, o marca XML de fechamento).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-323">Write any information following the stream (for example, the closing XML tag).</span></span>  
  
 <span data-ttu-id="a6bcc-324">Com essa abordagem, o gravador de XML tem uma opção de quando chamar <xref:System.Xml.IStreamProvider.GetStream> e gravar os dados transmitidos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-324">With this approach, the XML writer has a choice of when to call <xref:System.Xml.IStreamProvider.GetStream> and write out the streamed data.</span></span> <span data-ttu-id="a6bcc-325">Por exemplo, os gravadores XML binários e textuais irá chamá-lo imediatamente e gravar o conteúdo em fluxo entre as marcas de início e término.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-325">For example, the textual and binary XML writers will call it immediately and write out the streamed contents in-between the start and end tags.</span></span> <span data-ttu-id="a6bcc-326">O gravador MTOM pode optar por chamar <xref:System.Xml.IStreamProvider.GetStream> posteriormente, quando estiver pronto para gravar a parte apropriada da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-326">The MTOM writer may decide to call <xref:System.Xml.IStreamProvider.GetStream> later, when it is ready to write the appropriate part of the message.</span></span>  
  
## <a name="representing-data-in-the-service-framework"></a><span data-ttu-id="a6bcc-327">Que representa os dados na estrutura de serviço</span><span class="sxs-lookup"><span data-stu-id="a6bcc-327">Representing Data in the Service Framework</span></span>  
 <span data-ttu-id="a6bcc-328">Conforme mencionado na seção "Arquitetura básica" deste tópico, a estrutura de serviço é a parte do [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] , entre outras coisas, é responsável pela conversão entre um modelo de programação simples para os dados de mensagem e real `Message` instâncias.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-328">As stated in the "Basic Architecture" section of this topic, the service framework is the part of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] that, among other things, is responsible for converting between a user-friendly programming model for message data and actual `Message` instances.</span></span> <span data-ttu-id="a6bcc-329">Normalmente, uma troca de mensagens é representada na estrutura de serviço como um [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] método marcado com o <xref:System.ServiceModel.OperationContractAttribute> atributo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-329">Normally, a message exchange is represented in the service framework as a [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] method marked with the <xref:System.ServiceModel.OperationContractAttribute> attribute.</span></span> <span data-ttu-id="a6bcc-330">O método pode levar de alguns parâmetros e pode retornar um valor de retorno ou parâmetros (ou ambos).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-330">The method can take in some parameters and can return a return value or out parameters (or both).</span></span> <span data-ttu-id="a6bcc-331">No lado do serviço, os parâmetros de entrada representam a mensagem de entrada e o valor de retorno em parâmetros de saída representam a mensagem de saída.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-331">On the service side, the input parameters represent the incoming message, and the return value and out parameters represent the outgoing message.</span></span> <span data-ttu-id="a6bcc-332">No lado do cliente, o inverso é verdadeiro.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-332">On the client side, the reverse is true.</span></span> <span data-ttu-id="a6bcc-333">O modelo de programação para descrever as mensagens usando parâmetros e o valor de retorno é descrito detalhadamente no [especificando a transferência de dados em contratos de serviço](../../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-333">The programming model for describing messages using parameters and the return value is described in detail in [Specifying Data Transfer in Service Contracts](../../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md).</span></span> <span data-ttu-id="a6bcc-334">No entanto, esta seção fornece uma visão geral breve.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-334">However, this section will provide a brief overview.</span></span>  
  
## <a name="programming-models"></a><span data-ttu-id="a6bcc-335">Modelos de programação</span><span class="sxs-lookup"><span data-stu-id="a6bcc-335">Programming Models</span></span>  
 <span data-ttu-id="a6bcc-336">O [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] estrutura oferece suporte a cinco modelos de programação diferentes para descrever as mensagens:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-336">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service framework supports five different programming models for describing messages:</span></span>  
  
### <a name="1-the-empty-message"></a><span data-ttu-id="a6bcc-337">1. A mensagem vazia</span><span class="sxs-lookup"><span data-stu-id="a6bcc-337">1. The Empty Message</span></span>  
 <span data-ttu-id="a6bcc-338">Esse é o caso mais simples.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-338">This is the simplest case.</span></span> <span data-ttu-id="a6bcc-339">Para descrever uma mensagem de entrada vazia, não use os parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-339">To describe an empty incoming message, do not use any input parameters.</span></span>  
  
 [!code-csharp[C_DataArchitecture#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#3)]
 [!code-vb[C_DataArchitecture#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#3)]  
  
 <span data-ttu-id="a6bcc-340">Para descrever uma mensagem de saída vazia, use um valor de retorno void e não use nenhum parâmetros de saída:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-340">To describe an empty outgoing message, use a void return value and do not use any out parameters:</span></span>  
  
 [!code-csharp[C_DataArchitecture#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#4)]
 [!code-vb[C_DataArchitecture#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#4)]  
  
 <span data-ttu-id="a6bcc-341">Observe que isso é diferente de um contrato de operação unidirecional:</span><span class="sxs-lookup"><span data-stu-id="a6bcc-341">Note that this is different from a one-way operation contract:</span></span>  
  
 [!code-csharp[C_DataArchitecture#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#5)]
 [!code-vb[C_DataArchitecture#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#5)]  
  
 <span data-ttu-id="a6bcc-342">No `SetDesiredTemperature` exemplo, um padrão de troca de mensagem bidirecional é descrito.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-342">In the `SetDesiredTemperature` example, a two-way message exchange pattern is described.</span></span> <span data-ttu-id="a6bcc-343">Uma mensagem é retornada da operação, mas ele está vazio.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-343">A message is returned from the operation, but it is empty.</span></span> <span data-ttu-id="a6bcc-344">É possível retornar uma falha da operação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-344">It is possible to return a fault from the operation.</span></span> <span data-ttu-id="a6bcc-345">No exemplo "Lâmpada definida", o padrão de troca de mensagem é unidirecional, portanto, não há nenhuma mensagem de saída para descrever.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-345">In the "Set Lightbulb" example, the message exchange pattern is one-way, so there is no outgoing message to describe.</span></span> <span data-ttu-id="a6bcc-346">O serviço não pode se comunicar a qualquer status de volta para o cliente nesse caso.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-346">The service cannot communicate any status back to the client in this case.</span></span>  
  
### <a name="2-using-the-message-class-directly"></a><span data-ttu-id="a6bcc-347">2. Usando a classe de mensagem diretamente</span><span class="sxs-lookup"><span data-stu-id="a6bcc-347">2. Using the Message Class Directly</span></span>  
 <span data-ttu-id="a6bcc-348">É possível usar o <xref:System.ServiceModel.Channels.Message> classe (ou uma de suas subclasses) diretamente em um contrato de operação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-348">It is possible to use the <xref:System.ServiceModel.Channels.Message> class (or one of its subclasses) directly in an operation contract.</span></span> <span data-ttu-id="a6bcc-349">Nesse caso, a estrutura do serviço apenas transmite o `Message` da operação para a pilha de canais e vice-versa, com nenhum processamento adicional.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-349">In this case, the service framework just passes the `Message` from the operation to the channel stack and vice versa, with no further processing.</span></span>  
  
 <span data-ttu-id="a6bcc-350">Há dois casos de uso principal para o uso de `Message` diretamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-350">There are two main use cases for using `Message` directly.</span></span> <span data-ttu-id="a6bcc-351">Você pode usar isso para cenários avançados, quando nenhum dos outros modelos de programação fornece flexibilidade suficiente para descrever a mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-351">You can use this for advanced scenarios, when none of the other programming models gives you enough flexibility to describe your message.</span></span> <span data-ttu-id="a6bcc-352">Por exemplo, você talvez queira usar arquivos no disco para descrever uma mensagem com as propriedades do arquivo se torne cabeçalhos de mensagem e o conteúdo do arquivo se torne o corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-352">For example, you might want to use files on disk to describe a message, with the file’s properties becoming message headers and the file’s contents becoming the message body.</span></span> <span data-ttu-id="a6bcc-353">Você pode criar algo semelhante ao seguinte.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-353">You can then create something similar to the following.</span></span>  
  
 [!code-csharp[C_DataArchitecture#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#6)]
 [!code-vb[C_DataArchitecture#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#6)]  
  
 <span data-ttu-id="a6bcc-354">A segunda comum usado para `Message` em um contrato de operação é quando um serviço não importantes para a mensagem em particular de conteúdo e atua na mensagem em uma caixa preta.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-354">The second common use for `Message` in an operation contract is when a service does not care about the particular message contents and acts on the message as on a black box.</span></span> <span data-ttu-id="a6bcc-355">Por exemplo, você pode ter um serviço que encaminha mensagens a vários outros destinatários.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-355">For example, you might have a service that forwards messages to multiple other recipients.</span></span> <span data-ttu-id="a6bcc-356">O contrato pode ser gravado da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-356">The contract can be written as follows.</span></span>  
  
 [!code-csharp[C_DataArchitecture#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#7)]
 [!code-vb[C_DataArchitecture#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#7)]  
  
 <span data-ttu-id="a6bcc-357">A ação = "\*" linha efetivamente desativa a distribuição de mensagem e garante que todas as mensagens enviadas para o `IForwardingService` contrato passarão para o `ForwardMessage` operação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-357">The Action="\*" line effectively turns off message dispatching and ensures that all messages sent to the `IForwardingService` contract make their way to the `ForwardMessage` operation.</span></span> <span data-ttu-id="a6bcc-358">(Normalmente, o dispatcher seria examinar cabeçalho de "Ação" da mensagem para determinar qual operação é destinado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-358">(Normally, the dispatcher would examine the message’s "Action" header to determine which operation it is intended for.</span></span> <span data-ttu-id="a6bcc-359">Ação = "\*" significa "todos os valores possíveis do cabeçalho de ação de".) A combinação de ação = "\*" e usando a mensagem como um parâmetro é conhecido como "contrato universal" porque ele é capaz de receber todas as mensagens possíveis.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-359">Action="\*" means "all possible values of the Action header".) The combination of Action="\*" and using Message as a parameter is known as the "universal contract" because it is able to receive all possible messages.</span></span> <span data-ttu-id="a6bcc-360">Para poder enviar todas as mensagens possíveis, use a mensagem como o valor de retorno e defina `ReplyAction` para "\*".</span><span class="sxs-lookup"><span data-stu-id="a6bcc-360">To be able to send all possible messages, use Message as the return value and set `ReplyAction` to "\*".</span></span> <span data-ttu-id="a6bcc-361">Isso impedirá a estrutura do serviço de adicionar seu próprio cabeçalho de ação, permitindo que você controle esse cabeçalho usando o `Message` retornar do objeto.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-361">This will prevent the service framework from adding its own Action header, enabling you to control this header using the `Message` object you return.</span></span>  
  
### <a name="3-message-contracts"></a><span data-ttu-id="a6bcc-362">3. Contratos de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-362">3. Message Contracts</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="a6bcc-363"> Fornece um modelo de programação declarativo para descrever as mensagens, chamadas *contratos de mensagem*.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-363"> provides a declarative programming model for describing messages, called *message contracts*.</span></span> <span data-ttu-id="a6bcc-364">Esse modelo é descrito detalhadamente no [usando contratos de mensagem](../../../../docs/framework/wcf/feature-details/using-message-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-364">This model is described in detail in [Using Message Contracts](../../../../docs/framework/wcf/feature-details/using-message-contracts.md).</span></span> <span data-ttu-id="a6bcc-365">Essencialmente, a mensagem inteira é representada por um único [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] tipo que usa atributos, como o <xref:System.ServiceModel.MessageBodyMemberAttribute> e <xref:System.ServiceModel.MessageHeaderAttribute> para descrever quais partes da classe de contrato de mensagem devem ser mapeado para o qual parte da mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-365">Essentially, the entire message is represented by a single [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type that uses attributes like the <xref:System.ServiceModel.MessageBodyMemberAttribute> and <xref:System.ServiceModel.MessageHeaderAttribute> to describe which parts of the message contract class should map to which part of the message.</span></span>  
  
 <span data-ttu-id="a6bcc-366">Contratos de mensagem fornecem muito controle sobre resultante `Message` instâncias (embora, obviamente, não muito controle como usando o `Message` classe diretamente).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-366">Message contracts provide a lot of control over the resulting `Message` instances (although obviously not as much control as using the `Message` class directly).</span></span> <span data-ttu-id="a6bcc-367">Por exemplo, corpos de mensagens geralmente são compostos de várias partes da informação, cada um representado por seu próprio elemento XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-367">For example, message bodies are often composed of multiple pieces of information, each represented by its own XML element.</span></span> <span data-ttu-id="a6bcc-368">Esses elementos podem ocorrer ou diretamente no corpo (*sem* modo) ou pode ser *encapsulado* em um elemento XML abrangente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-368">These elements can either occur directly in the body (*bare* mode) or can be *wrapped* in an encompassing XML element.</span></span> <span data-ttu-id="a6bcc-369">Usar o modelo de programação de contrato de mensagem permite que você tomar a decisão de bare versus encapsulado e controlar o nome do namespace e nome do wrapper.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-369">Using the message contract programming model enables you to make the bare-versus-wrapped decision and control the name of the wrapper name and namespace.</span></span>  
  
 <span data-ttu-id="a6bcc-370">O exemplo a seguir de um contrato de mensagem demonstra esses recursos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-370">The following code example of a message contract demonstrates these features.</span></span>  
  
 [!code-csharp[C_DataArchitecture#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#9)]
 [!code-vb[C_DataArchitecture#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#9)]  
  
 <span data-ttu-id="a6bcc-371">Itens marcados para ser serializado (com o <xref:System.ServiceModel.MessageBodyMemberAttribute>, <xref:System.ServiceModel.MessageHeaderAttribute>, ou outros atributos relacionados) deve ser serializável para participar de um contrato de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-371">Items marked to be serialized (with the <xref:System.ServiceModel.MessageBodyMemberAttribute>, <xref:System.ServiceModel.MessageHeaderAttribute>, or other related attributes) must be serializable to participate in a message contract.</span></span> <span data-ttu-id="a6bcc-372">Para obter mais informações, consulte a seção "Serialização" mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-372">For more information, see the "Serialization" section later in this topic.</span></span>  
  
### <a name="4-parameters"></a><span data-ttu-id="a6bcc-373">4. Parâmetros</span><span class="sxs-lookup"><span data-stu-id="a6bcc-373">4. Parameters</span></span>  
 <span data-ttu-id="a6bcc-374">Geralmente, um desenvolvedor que deseja descrever uma operação que atua em várias partes de dados não é necessário o grau de controle que fornecem contratos de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-374">Often, a developer who wants to describe an operation that acts on multiple pieces of data does not need the degree of control that message contracts provide.</span></span> <span data-ttu-id="a6bcc-375">Por exemplo, ao criar novos serviços, um não geralmente deseja tomar a decisão de bare versus encapsulado e decidir sobre o nome do elemento wrapper.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-375">For example, when creating new services, one does not usually want to make the bare-versus-wrapped decision and decide on the wrapper element name.</span></span> <span data-ttu-id="a6bcc-376">Essas decisões geralmente requer conhecimento profundo de serviços Web e SOAP.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-376">Making these decisions often requires deep knowledge of Web services and SOAP.</span></span>  
  
 <span data-ttu-id="a6bcc-377">O [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] estrutura do serviço pode selecionar automaticamente a representação de SOAP melhor e mais interoperável para enviar ou receber várias partes relacionadas de informação, sem fazer com que essas opções no usuário.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-377">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service framework can automatically pick the best and most interoperable SOAP representation for sending or receiving multiple related pieces of information, without forcing these choices on the user.</span></span> <span data-ttu-id="a6bcc-378">Isso é feito simplesmente descrevendo essas duas informações como parâmetros ou retornar valores de um contrato de operação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-378">This is accomplished by simply describing these pieces of information as parameters or return values of an operation contract.</span></span> <span data-ttu-id="a6bcc-379">Por exemplo, considere o seguinte contrato de operação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-379">For example, consider the following operation contract.</span></span>  
  
 [!code-csharp[C_DataArchitecture#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_dataarchitecture/cs/source.cs#11)]
 [!code-vb[C_DataArchitecture#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_dataarchitecture/vb/source.vb#11)]  
  
 <span data-ttu-id="a6bcc-380">Estrutura do serviço de automaticamente decide colocar todos os três partes de informações (`customerID`, `item`, e `quantity`) no corpo da mensagem e ajuste-los em um elemento wrapper denominado `SubmitOrderRequest`.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-380">The service framework automatically decides to put all three pieces of information (`customerID`, `item`, and `quantity`) into the message body and wrap them in a wrapper element named `SubmitOrderRequest`.</span></span>  
  
 <span data-ttu-id="a6bcc-381">Descrevendo as informações para ser enviado ou recebido como uma lista simple de parâmetros de contrato de operação é a abordagem recomendada, a menos que existem especiais motivos para mover para o contrato de mensagem mais complexa ou `Message`-com base em modelos de programação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-381">Describing the information to be sent or received as a simple list of operation contract parameters is the recommended approach, unless special reasons exist to move to the more-complex message contract or `Message`-based programming models.</span></span>  
  
### <a name="5-stream"></a><span data-ttu-id="a6bcc-382">5. Fluxo</span><span class="sxs-lookup"><span data-stu-id="a6bcc-382">5. Stream</span></span>  
 <span data-ttu-id="a6bcc-383">Usando `Stream` ou uma de suas subclasses em um contrato de operação ou como uma parte de corpo de mensagem exclusiva em um contrato de mensagem pode ser considerada um modelo de programação separado dos descritos acima.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-383">Using `Stream` or one of its subclasses in an operation contract or as a sole message body part in a message contract can be considered a separate programming model from the ones described above.</span></span> <span data-ttu-id="a6bcc-384">Usando `Stream` dessa maneira é a única maneira de garantir que seu contrato poderá ser usado de maneira em fluxo, com pouca escrevendo seu próprio compatível streaming `Message` subclasse.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-384">Using `Stream` in this way is the only way to guarantee that your contract will be usable in a streamed fashion, short of writing your own streaming-compatible `Message` subclass.</span></span> <span data-ttu-id="a6bcc-385">Para obter mais informações, consulte [dados grandes e Streaming](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-385">For more information, see [Large Data and Streaming](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md).</span></span>  
  
 <span data-ttu-id="a6bcc-386">Quando `Stream` ou uma de suas subclasses é usada dessa maneira, o serializador não é invocado.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-386">When `Stream` or one of its subclasses is used in this way, the serializer is not invoked.</span></span> <span data-ttu-id="a6bcc-387">Mensagens de saída, um streaming especial `Message` subclasse é criada e o fluxo é gravado como descrito na seção sobre o <xref:System.Xml.IStreamProvider> interface.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-387">For outgoing messages, a special streaming `Message` subclass is created and the stream is written out as described in the section on the <xref:System.Xml.IStreamProvider> interface.</span></span> <span data-ttu-id="a6bcc-388">Mensagens de entrada, a estrutura de serviço cria um `Stream` subclasse sobre a mensagem de entrada e fornece para a operação.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-388">For incoming messages, the service framework creates a `Stream` subclass over the incoming message and provides it to the operation.</span></span>  
  
## <a name="programming-model-restrictions"></a><span data-ttu-id="a6bcc-389">Restrições do Modelo de Programação</span><span class="sxs-lookup"><span data-stu-id="a6bcc-389">Programming Model Restrictions</span></span>  
 <span data-ttu-id="a6bcc-390">Os modelos de programação descritos acima não podem ser combinados arbitrariamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-390">The programming models described above cannot be arbitrarily combined.</span></span> <span data-ttu-id="a6bcc-391">Por exemplo, se uma operação aceita um tipo de contrato de mensagem, o contrato de mensagem deve ser o único parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-391">For example, if an operation accepts a message contract type, the message contract must be its only input parameter.</span></span> <span data-ttu-id="a6bcc-392">Além disso, a operação deve, em seguida, retornar uma mensagem vazia (tipo de retorno de void) ou em outro contrato de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-392">Furthermore, the operation must then either return an empty message (return type of void) or another message contract.</span></span> <span data-ttu-id="a6bcc-393">Essas restrições do modelo de programação são descritas nos tópicos para cada modelo de programação específico: [usando contratos de mensagem](../../../../docs/framework/wcf/feature-details/using-message-contracts.md), [usando a classe de mensagem](../../../../docs/framework/wcf/feature-details/using-the-message-class.md), e [dados grandes e Streaming ](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-393">These programming model restrictions are described in the topics for each specific programming model: [Using Message Contracts](../../../../docs/framework/wcf/feature-details/using-message-contracts.md), [Using the Message Class](../../../../docs/framework/wcf/feature-details/using-the-message-class.md), and [Large Data and Streaming](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md).</span></span>  
  
## <a name="message-formatters"></a><span data-ttu-id="a6bcc-394">Formatadores de mensagem</span><span class="sxs-lookup"><span data-stu-id="a6bcc-394">Message Formatters</span></span>  
 <span data-ttu-id="a6bcc-395">Os modelos de programação descritos acima são suportados Conectando componentes chamados *mensagem formatadores* na estrutura de serviço.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-395">The programming models described above are supported by plugging in components called *message formatters* into the service framework.</span></span> <span data-ttu-id="a6bcc-396">Formatadores de mensagem são tipos que implementam o <xref:System.ServiceModel.Dispatcher.IClientMessageFormatter> ou <xref:System.ServiceModel.Dispatcher.IDispatchMessageFormatter> interface, ou ambos, para uso em clientes e serviço [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] clientes, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-396">Message formatters are types that implement the <xref:System.ServiceModel.Dispatcher.IClientMessageFormatter> or <xref:System.ServiceModel.Dispatcher.IDispatchMessageFormatter> interface, or both, for use in clients and service [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] clients, respectively.</span></span>  
  
 <span data-ttu-id="a6bcc-397">Formatadores de mensagem normalmente são conectados por comportamentos.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-397">Message formatters are normally plugged in by behaviors.</span></span> <span data-ttu-id="a6bcc-398">Por exemplo, o <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> conecta-se o formatador de mensagem do contrato de dados.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-398">For example, the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> plugs in the data contract message formatter.</span></span> <span data-ttu-id="a6bcc-399">Isso é feito no lado do serviço, definindo <xref:System.ServiceModel.Dispatcher.DispatchOperation.Formatter%2A> para o formatador correto no <xref:System.ServiceModel.Description.IOperationBehavior.ApplyDispatchBehavior%28System.ServiceModel.Description.OperationDescription%2CSystem.ServiceModel.Dispatcher.DispatchOperation%29> método, ou no lado do cliente, definindo <xref:System.ServiceModel.Dispatcher.ClientOperation.Formatter%2A> para o formatador correto no <xref:System.ServiceModel.Description.IOperationBehavior.ApplyClientBehavior%28System.ServiceModel.Description.OperationDescription%2CSystem.ServiceModel.Dispatcher.ClientOperation%29> método.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-399">This is done on the service side by setting <xref:System.ServiceModel.Dispatcher.DispatchOperation.Formatter%2A> to the correct formatter in the <xref:System.ServiceModel.Description.IOperationBehavior.ApplyDispatchBehavior%28System.ServiceModel.Description.OperationDescription%2CSystem.ServiceModel.Dispatcher.DispatchOperation%29> method, or on the client side by setting <xref:System.ServiceModel.Dispatcher.ClientOperation.Formatter%2A> to the correct formatter in the <xref:System.ServiceModel.Description.IOperationBehavior.ApplyClientBehavior%28System.ServiceModel.Description.OperationDescription%2CSystem.ServiceModel.Dispatcher.ClientOperation%29> method.</span></span>  
  
 <span data-ttu-id="a6bcc-400">As tabelas a seguir lista os métodos que pode implementar um formatador de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-400">The following tables lists the methods that a message formatter may implement.</span></span>  
  
|<span data-ttu-id="a6bcc-401">Interface</span><span class="sxs-lookup"><span data-stu-id="a6bcc-401">Interface</span></span>|<span data-ttu-id="a6bcc-402">Método</span><span class="sxs-lookup"><span data-stu-id="a6bcc-402">Method</span></span>|<span data-ttu-id="a6bcc-403">Ação</span><span class="sxs-lookup"><span data-stu-id="a6bcc-403">Action</span></span>|  
|---------------|------------|------------|  
|<xref:System.ServiceModel.Dispatcher.IDispatchMessageFormatter>|<xref:System.ServiceModel.Dispatcher.IDispatchMessageFormatter.DeserializeRequest%28System.ServiceModel.Channels.Message%2CSystem.Object%5B%5D%29>|<span data-ttu-id="a6bcc-404">Converte uma entrada `Message` para parâmetros de operação</span><span class="sxs-lookup"><span data-stu-id="a6bcc-404">Converts an incoming `Message` to operation parameters</span></span>|  
|<xref:System.ServiceModel.Dispatcher.IDispatchMessageFormatter>|<xref:System.ServiceModel.Dispatcher.IDispatchMessageFormatter.SerializeReply%28System.ServiceModel.Channels.MessageVersion%2CSystem.Object%5B%5D%2CSystem.Object%29>|<span data-ttu-id="a6bcc-405">Cria uma saída `Message` valor de retorno da operação/parâmetros de saída</span><span class="sxs-lookup"><span data-stu-id="a6bcc-405">Creates an outgoing `Message` from operation return value/out parameters</span></span>|  
|<xref:System.ServiceModel.Dispatcher.IClientMessageFormatter>|<xref:System.ServiceModel.Dispatcher.IClientMessageFormatter.SerializeRequest%28System.ServiceModel.Channels.MessageVersion%2CSystem.Object%5B%5D%29>|<span data-ttu-id="a6bcc-406">Cria uma saída `Message` de parâmetros de operação</span><span class="sxs-lookup"><span data-stu-id="a6bcc-406">Creates an outgoing `Message` from operation parameters</span></span>|  
|<xref:System.ServiceModel.Dispatcher.IClientMessageFormatter>|<xref:System.ServiceModel.Dispatcher.IClientMessageFormatter.DeserializeReply%28System.ServiceModel.Channels.Message%2CSystem.Object%5B%5D%29>|<span data-ttu-id="a6bcc-407">Converte uma entrada `Message` para um valor de retorno/parâmetros out</span><span class="sxs-lookup"><span data-stu-id="a6bcc-407">Converts an incoming `Message` to a return value/out parameters</span></span>|  
  
## <a name="serialization"></a><span data-ttu-id="a6bcc-408">Serialização</span><span class="sxs-lookup"><span data-stu-id="a6bcc-408">Serialization</span></span>  
 <span data-ttu-id="a6bcc-409">Sempre que usar parâmetros ou contratos de mensagem para descrever o conteúdo da mensagem, você deve usar a serialização para converter entre [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] tipos e representação Infoset XML.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-409">Whenever you use message contracts or parameters to describe message contents, you must use serialization to convert between [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] types and XML Infoset representation.</span></span> <span data-ttu-id="a6bcc-410">A serialização é usada em outros lugares no [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], por exemplo, <xref:System.ServiceModel.Channels.Message> tem um genérico <xref:System.ServiceModel.Channels.Message.GetBody%2A> método que você pode usar para ler todo o corpo da mensagem desserializado em um objeto.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-410">Serialization is used in other places in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], for example, <xref:System.ServiceModel.Channels.Message> has a Generic <xref:System.ServiceModel.Channels.Message.GetBody%2A> method that you can use to read the entire body of the message deserialized into an object.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="a6bcc-411"> oferece suporte a duas tecnologias de serialização "pronta" para serialização e desserialização de parâmetros e partes da mensagem: o <xref:System.Runtime.Serialization.DataContractSerializer> e `XmlSerializer`.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-411"> supports two serialization technologies "out of the box" for serializing and deserializing parameters and message parts: the <xref:System.Runtime.Serialization.DataContractSerializer> and the `XmlSerializer`.</span></span> <span data-ttu-id="a6bcc-412">Além disso, você pode escrever serializadores personalizados.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-412">Additionally, you can write custom serializers.</span></span> <span data-ttu-id="a6bcc-413">No entanto, outras partes do [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] (como genérica `GetBody` serialização de falhas de SOAP ou método) pode ser restrita para usar somente o <xref:System.Runtime.Serialization.XmlObjectSerializer> subclasses (<xref:System.Runtime.Serialization.DataContractSerializer> e <xref:System.Runtime.Serialization.NetDataContractSerializer>, mas não o <xref:System.Xml.Serialization.XmlSerializer>), ou até mesmo ser codificado para usar somente o <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-413">However, other parts of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] (such as the Generic `GetBody` method or SOAP fault serialization) may be restricted to use only the <xref:System.Runtime.Serialization.XmlObjectSerializer> subclasses (<xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.NetDataContractSerializer>, but not the <xref:System.Xml.Serialization.XmlSerializer>), or may even be hard-coded to use only the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span>  
  
 <span data-ttu-id="a6bcc-414">O `XmlSerializer` é o mecanismo de serialização usado em [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] serviços Web.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-414">The `XmlSerializer` is the serialization engine used in [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web services.</span></span> <span data-ttu-id="a6bcc-415">O `DataContractSerializer` é o novo mecanismo de serialização que compreende o modelo de programação de contrato de dados de novo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-415">The `DataContractSerializer` is the new serialization engine that understands the new data contract programming model.</span></span> <span data-ttu-id="a6bcc-416">`DataContractSerializer` é a opção padrão e a opção de usar o `XmlSerializer` podem ser feitas em uma base de cada operação usando o <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractFormatAttribute%2A> atributo.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-416">`DataContractSerializer` is the default choice, and the choice to use the `XmlSerializer` can be made on a per-operation basis using the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractFormatAttribute%2A> attribute.</span></span>  
  
 <span data-ttu-id="a6bcc-417"><xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> e <xref:System.ServiceModel.Description.XmlSerializerOperationBehavior> responsáveis os comportamentos de operação para conectar os formatadores de mensagem para o `DataContractSerializer` e `XmlSerializer`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-417"><xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> and <xref:System.ServiceModel.Description.XmlSerializerOperationBehavior> are the operation behaviors responsible for plugging in the message formatters for the `DataContractSerializer` and the `XmlSerializer`, respectively.</span></span> <span data-ttu-id="a6bcc-418">O <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> comportamento pode operar com qualquer serializador que deriva de <xref:System.Runtime.Serialization.XmlObjectSerializer>, incluindo o <xref:System.Runtime.Serialization.NetDataContractSerializer> (descritos detalhadamente na serialização de autônomo usando).</span><span class="sxs-lookup"><span data-stu-id="a6bcc-418">The <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> behavior can actually operate with any serializer that derives from <xref:System.Runtime.Serialization.XmlObjectSerializer>, including the <xref:System.Runtime.Serialization.NetDataContractSerializer> (described in detail in Using Stand-Alone Serialization).</span></span> <span data-ttu-id="a6bcc-419">O comportamento chama uma da `CreateSerializer` sobrecargas de método virtual para obter o serializador.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-419">The behavior calls one of the `CreateSerializer` virtual method overloads to obtain the serializer.</span></span> <span data-ttu-id="a6bcc-420">Para conectar um serializador diferente, crie um novo <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> subclasse e substituição `CreateSerializer` sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="a6bcc-420">To plug in a different serializer, create a new <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> subclass and override both `CreateSerializer` overloads.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a6bcc-421">Consulte também</span><span class="sxs-lookup"><span data-stu-id="a6bcc-421">See Also</span></span>  
 [<span data-ttu-id="a6bcc-422">Especificando transferência de dados em contratos de serviço</span><span class="sxs-lookup"><span data-stu-id="a6bcc-422">Specifying Data Transfer in Service Contracts</span></span>](../../../../docs/framework/wcf/feature-details/specifying-data-transfer-in-service-contracts.md)
