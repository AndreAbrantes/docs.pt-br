---
title: "Como configurar credenciais em um serviço de federação"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: 149ab165-0ef3-490a-83a9-4322a07bd98a
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 243dbd73d60577cbda2d8cf4fad1fd2e510d87ba
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="how-to-configure-credentials-on-a-federation-service"></a><span data-ttu-id="4903e-102">Como configurar credenciais em um serviço de federação</span><span class="sxs-lookup"><span data-stu-id="4903e-102">How to: Configure Credentials on a Federation Service</span></span>
<span data-ttu-id="4903e-103">Em [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], criar um serviço federado consiste nos seguintes procedimentos principais:</span><span class="sxs-lookup"><span data-stu-id="4903e-103">In [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], creating a federated service consists of the following main procedures:</span></span>  
  
1.  <span data-ttu-id="4903e-104">Configurando um <xref:System.ServiceModel.WSFederationHttpBinding> ou associação personalizada semelhante.</span><span class="sxs-lookup"><span data-stu-id="4903e-104">Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="4903e-105">criar uma associação apropriado, consulte [como: criar uma WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md).</span><span class="sxs-lookup"><span data-stu-id="4903e-105"> creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md).</span></span>  
  
2.  <span data-ttu-id="4903e-106">Configurando o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> que controla os tokens emitidos como apresentados para o serviço são autenticados.</span><span class="sxs-lookup"><span data-stu-id="4903e-106">Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated.</span></span>  
  
 <span data-ttu-id="4903e-107">Este tópico fornece detalhes sobre a segunda etapa.</span><span class="sxs-lookup"><span data-stu-id="4903e-107">This topic provides details about the second step.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="4903e-108">como funciona um serviço federado, consulte [federação](../../../../docs/framework/wcf/feature-details/federation.md).</span><span class="sxs-lookup"><span data-stu-id="4903e-108"> how a federated service works, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-code"></a><span data-ttu-id="4903e-109">Para definir as propriedades de IssuedTokenServiceCredential no código</span><span class="sxs-lookup"><span data-stu-id="4903e-109">To set the properties of IssuedTokenServiceCredential in code</span></span>  
  
1.  <span data-ttu-id="4903e-110">Use o <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> propriedade o <xref:System.ServiceModel.Description.ServiceCredentials> classe para retornar uma referência a um <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instância.</span><span class="sxs-lookup"><span data-stu-id="4903e-110">Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance.</span></span> <span data-ttu-id="4903e-111">A propriedade for acessada do <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> propriedade o <xref:System.ServiceModel.ServiceHostBase> classe.</span><span class="sxs-lookup"><span data-stu-id="4903e-111">The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span>  
  
2.  <span data-ttu-id="4903e-112">Definir o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> propriedade `true` se emitido por conta própria tokens como [!INCLUDE[infocard](../../../../includes/infocard-md.md)] cartões devem ser autenticadas.</span><span class="sxs-lookup"><span data-stu-id="4903e-112">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as [!INCLUDE[infocard](../../../../includes/infocard-md.md)] cards are to be authenticated.</span></span> <span data-ttu-id="4903e-113">O padrão é `false`.</span><span class="sxs-lookup"><span data-stu-id="4903e-113">The default is `false`.</span></span>  
  
3.  <span data-ttu-id="4903e-114">Preencher a coleção retornada pelo <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> propriedade com instâncias da <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> classe.</span><span class="sxs-lookup"><span data-stu-id="4903e-114">Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class.</span></span> <span data-ttu-id="4903e-115">Cada instância representa um emissor do qual o serviço autenticará tokens.</span><span class="sxs-lookup"><span data-stu-id="4903e-115">Each instance represents an issuer from which the service will authenticate tokens.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4903e-116">Ao contrário do lado do cliente coleção retornada pelo <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> propriedade, a coleção de certificados conhecidos não é uma coleção com chave.</span><span class="sxs-lookup"><span data-stu-id="4903e-116">Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection.</span></span> <span data-ttu-id="4903e-117">O serviço aceita os tokens que emitem certificados especificados, independentemente do endereço do cliente que enviou a mensagem que contém o token emitido (sujeito às restrições adicionais, que são descritos posteriormente neste tópico).</span><span class="sxs-lookup"><span data-stu-id="4903e-117">The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).</span></span>  
  
4.  <span data-ttu-id="4903e-118">Definir o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> propriedade para um do <xref:System.ServiceModel.Security.X509CertificateValidationMode> valores de enumeração.</span><span class="sxs-lookup"><span data-stu-id="4903e-118">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values.</span></span> <span data-ttu-id="4903e-119">Isso pode ser feito somente no código.</span><span class="sxs-lookup"><span data-stu-id="4903e-119">This can be done only in code.</span></span> <span data-ttu-id="4903e-120">O padrão é <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span><span class="sxs-lookup"><span data-stu-id="4903e-120">The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span></span>  
  
5.  <span data-ttu-id="4903e-121">Se o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> está definida como <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, atribua uma instância personalizado <xref:System.IdentityModel.Selectors.X509CertificateValidator> de classe para o <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="4903e-121">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property.</span></span>  
  
6.  <span data-ttu-id="4903e-122">Se o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> é definido como `ChainTrust` ou `PeerOrChainTrust`, defina o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> propriedade para um valor apropriado do <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeração.</span><span class="sxs-lookup"><span data-stu-id="4903e-122">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration.</span></span> <span data-ttu-id="4903e-123">Observe que o modo de revogação não é usado em `PeerTrust` ou `Custom` modos de validação.</span><span class="sxs-lookup"><span data-stu-id="4903e-123">Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes.</span></span>  
  
7.  <span data-ttu-id="4903e-124">Se necessário, atribuir uma instância de um personalizado <xref:System.IdentityModel.Tokens.SamlSerializer> de classe para o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="4903e-124">If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property.</span></span> <span data-ttu-id="4903e-125">Um serializador personalizado de segurança asserções Markup Language (SAML) é necessário, por exemplo, para analisar as asserções SAML personalizadas.</span><span class="sxs-lookup"><span data-stu-id="4903e-125">A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-configuration"></a><span data-ttu-id="4903e-126">Para definir as propriedades de IssuedTokenServiceCredential na configuração</span><span class="sxs-lookup"><span data-stu-id="4903e-126">To set the properties of IssuedTokenServiceCredential in configuration</span></span>  
  
1.  <span data-ttu-id="4903e-127">Criar um `<issuedTokenAuthentication>` elemento como um filho de um <`serviceCredentials`> elemento.</span><span class="sxs-lookup"><span data-stu-id="4903e-127">Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element.</span></span>  
  
2.  <span data-ttu-id="4903e-128">Definir o `allowUntrustedRsaIssuers` atributo do `<issuedTokenAuthentication>` elemento `true` se autenticando um token emitido por conta própria, como um [!INCLUDE[infocard](../../../../includes/infocard-md.md)] cartão.</span><span class="sxs-lookup"><span data-stu-id="4903e-128">Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as an [!INCLUDE[infocard](../../../../includes/infocard-md.md)] card.</span></span>  
  
3.  <span data-ttu-id="4903e-129">Criar um `<knownCertificates>` elemento como um filho de `<issuedTokenAuthentication>` elemento.</span><span class="sxs-lookup"><span data-stu-id="4903e-129">Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element.</span></span>  
  
4.  <span data-ttu-id="4903e-130">Criar do zero ou mais `<add>` elementos como filhos do `<knownCertificates>` elemento e especifique como localizar o certificado usando o `storeLocation`, `storeName`, `x509FindType`, e `findValue` atributos.</span><span class="sxs-lookup"><span data-stu-id="4903e-130">Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes.</span></span>  
  
5.  <span data-ttu-id="4903e-131">Se necessário, defina o `samlSerializer` atributo do <`issuedTokenAuthentication`> elemento para o nome do tipo personalizado <xref:System.IdentityModel.Tokens.SamlSerializer> classe.</span><span class="sxs-lookup"><span data-stu-id="4903e-131">If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class.</span></span>  
  
## <a name="example"></a><span data-ttu-id="4903e-132">Exemplo</span><span class="sxs-lookup"><span data-stu-id="4903e-132">Example</span></span>  
 <span data-ttu-id="4903e-133">O exemplo a seguir define as propriedades de um <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> no código.</span><span class="sxs-lookup"><span data-stu-id="4903e-133">The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code.</span></span>  
  
 [!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]
 [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]  
  
 <span data-ttu-id="4903e-134">Para um serviço federado autenticar um cliente, o seguinte deve ser verdadeiro sobre o token emitido:</span><span class="sxs-lookup"><span data-stu-id="4903e-134">In order for a federated service to authenticate a client, the following must be true about the issued token:</span></span>  
  
-   <span data-ttu-id="4903e-135">Quando a assinatura digital do token emitido usa um identificador de chave de segurança RSA, a <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> propriedade deve ser `true`.</span><span class="sxs-lookup"><span data-stu-id="4903e-135">When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`.</span></span>  
  
-   <span data-ttu-id="4903e-136">Quando a assinatura do token emitido usa um identificador de segurança de impressão digital de x. 509, número de série do emissor de x. 509 ou identificador de chave de assunto x. 509, o token emitido deve ser assinado por um certificado na coleção retornada pelo <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> propriedade o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>classe.</span><span class="sxs-lookup"><span data-stu-id="4903e-136">When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class.</span></span>  
  
-   <span data-ttu-id="4903e-137">Quando o token emitido é assinado usando um certificado x. 509, valide o certificado pela semântica especificada pelo valor da <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> propriedade, independentemente se o certificado foi enviado para a terceira parte confiável como um <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> ou foi obtido do <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="4903e-137">When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="4903e-138">Validação de certificado x. 509, consulte [trabalhar com certificados](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="4903e-138"> X.509 certificate validation, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="4903e-139">Por exemplo, se você definir o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> para <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> autenticados qualquer token emitido cujo certificado de assinatura está no `TrustedPeople` repositório de certificados.</span><span class="sxs-lookup"><span data-stu-id="4903e-139">For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store.</span></span> <span data-ttu-id="4903e-140">Nesse caso, defina o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> propriedade como <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> ou <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span><span class="sxs-lookup"><span data-stu-id="4903e-140">In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span></span> <span data-ttu-id="4903e-141">Você pode selecionar outros modos, incluindo <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span><span class="sxs-lookup"><span data-stu-id="4903e-141">You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span></span> <span data-ttu-id="4903e-142">Quando `Custom` é selecionada, você deve atribuir a uma instância do <xref:System.IdentityModel.Selectors.X509CertificateValidator> de classe para o <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> propriedade.</span><span class="sxs-lookup"><span data-stu-id="4903e-142">When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property.</span></span> <span data-ttu-id="4903e-143">O validador personalizado pode validar certificados usando qualquer critério que desejar.</span><span class="sxs-lookup"><span data-stu-id="4903e-143">The custom validator can validate certificates using any criteria it likes.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="4903e-144">[Como: criar um serviço que utiliza um validador de certificado personalizado](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span><span class="sxs-lookup"><span data-stu-id="4903e-144"> [How to: Create a Service that Employs a Custom Certificate Validator](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4903e-145">Consulte também</span><span class="sxs-lookup"><span data-stu-id="4903e-145">See Also</span></span>  
 [<span data-ttu-id="4903e-146">Federação</span><span class="sxs-lookup"><span data-stu-id="4903e-146">Federation</span></span>](../../../../docs/framework/wcf/feature-details/federation.md)  
 [<span data-ttu-id="4903e-147">Federação e confiabilidade</span><span class="sxs-lookup"><span data-stu-id="4903e-147">Federation and Trust</span></span>](../../../../docs/framework/wcf/feature-details/federation-and-trust.md)  
 [<span data-ttu-id="4903e-148">Exemplo de federação</span><span class="sxs-lookup"><span data-stu-id="4903e-148">Federation Sample</span></span>](../../../../docs/framework/wcf/samples/federation-sample.md)  
 [<span data-ttu-id="4903e-149">Como: desabilitar sessões seguras em um WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="4903e-149">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)  
 [<span data-ttu-id="4903e-150">Como criar um WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="4903e-150">How to: Create a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)  
 [<span data-ttu-id="4903e-151">Como criar um cliente federado</span><span class="sxs-lookup"><span data-stu-id="4903e-151">How to: Create a Federated Client</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)  
 [<span data-ttu-id="4903e-152">Trabalhando com certificados</span><span class="sxs-lookup"><span data-stu-id="4903e-152">Working with Certificates</span></span>](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)  
 [<span data-ttu-id="4903e-153">Modos de autenticação de SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="4903e-153">SecurityBindingElement Authentication Modes</span></span>](../../../../docs/framework/wcf/feature-details/securitybindingelement-authentication-modes.md)
