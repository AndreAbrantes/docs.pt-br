---
title: "Utilizando sessões"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
caps.latest.revision: 
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: f5f6df22918dedf32738a8cb9d73af2e625923a4
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/19/2018
---
# <a name="using-sessions"></a><span data-ttu-id="15efb-102">Utilizando sessões</span><span class="sxs-lookup"><span data-stu-id="15efb-102">Using Sessions</span></span>
<span data-ttu-id="15efb-103">Em [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] aplicativos, um *sessão* correlaciona a um grupo de mensagens em uma conversa.</span><span class="sxs-lookup"><span data-stu-id="15efb-103">In [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] applications, a *session* correlates a group of messages into a conversation.</span></span> [!INCLUDE[indigo2](../../../includes/indigo2-md.md)]<span data-ttu-id="15efb-104">as sessões são diferentes do objeto de sessão disponível no [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplicativos, suporte a comportamentos diferentes e são controlados de maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="15efb-104"> sessions are different than the session object available in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="15efb-105">Este tópico descreve os recursos que permitem que as sessões no [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] aplicativos e como usá-los.</span><span class="sxs-lookup"><span data-stu-id="15efb-105">This topic describes the features that sessions enable in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="15efb-106">Sessões em aplicativos do Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="15efb-106">Sessions in Windows Communication Foundation Applications</span></span>  
 <span data-ttu-id="15efb-107">Quando um contrato de serviço Especifica que ele requer uma sessão, esse contrato é Especifica que todas as chamadas (ou seja, as subjacente trocas de mensagens que oferecem suporte as chamadas) devem ser parte da mesma conversa.</span><span class="sxs-lookup"><span data-stu-id="15efb-107">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="15efb-108">Se um contrato especifica que permite que as sessões, mas não requer um, os clientes podem se conectar e a estabelecer uma sessão ou não estabelecer uma sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-108">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="15efb-109">Se a sessão é encerrada e uma mensagem é enviada por meio do canal mesmo que uma exceção será lançada.</span><span class="sxs-lookup"><span data-stu-id="15efb-109">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 [!INCLUDE[indigo2](../../../includes/indigo2-md.md)]<span data-ttu-id="15efb-110">as sessões têm os seguintes recursos conceituais principais:</span><span class="sxs-lookup"><span data-stu-id="15efb-110"> sessions have the following main conceptual features:</span></span>  
  
-   <span data-ttu-id="15efb-111">Eles são explicitamente iniciados e finalizados pelo aplicativo de chamada (o cliente do WCF).</span><span class="sxs-lookup"><span data-stu-id="15efb-111">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
-   <span data-ttu-id="15efb-112">Mensagens entregues durante uma sessão são processadas na ordem em que são recebidos.</span><span class="sxs-lookup"><span data-stu-id="15efb-112">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
-   <span data-ttu-id="15efb-113">Sessões de correlação um grupo de mensagens em uma conversa.</span><span class="sxs-lookup"><span data-stu-id="15efb-113">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="15efb-114">Tipos diferentes de correlação são possíveis.</span><span class="sxs-lookup"><span data-stu-id="15efb-114">Different types of correlation are possible.</span></span> <span data-ttu-id="15efb-115">Por exemplo, um canal de sessão pode correlacionar as mensagens com base em uma conexão de rede compartilhada enquanto outro canal baseadas em sessão pode correlacionar as mensagens com base em uma marca compartilhada no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="15efb-115">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="15efb-116">Os recursos que podem ser derivados da sessão dependem da natureza da correlação.</span><span class="sxs-lookup"><span data-stu-id="15efb-116">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
-   <span data-ttu-id="15efb-117">Há um repositório de dados gerais associado com um [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-117">There is no general data store associated with a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] session.</span></span>  
  
 <span data-ttu-id="15efb-118">Se você estiver familiarizado com o <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> classe em [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplicativos e a funcionalidade que ela fornece, você observará as seguintes diferenças entre esse tipo de sessão e [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sessões:</span><span class="sxs-lookup"><span data-stu-id="15efb-118">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] sessions:</span></span>  
  
-   [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]<span data-ttu-id="15efb-119">as sessões são sempre iniciadas pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="15efb-119"> sessions are always server-initiated.</span></span>  
  
-   [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]<span data-ttu-id="15efb-120">as sessões são implicitamente não ordenadas.</span><span class="sxs-lookup"><span data-stu-id="15efb-120"> sessions are implicitly unordered.</span></span>  
  
-   [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]<span data-ttu-id="15efb-121">sessões fornecem um mecanismo de armazenamento de dados gerais em solicitações.</span><span class="sxs-lookup"><span data-stu-id="15efb-121"> sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="15efb-122">Este tópico descreve:</span><span class="sxs-lookup"><span data-stu-id="15efb-122">This topic describes:</span></span>  
  
-   <span data-ttu-id="15efb-123">O comportamento de execução padrão ao usar associações baseadas em sessão na camada de modelo de serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-123">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
-   <span data-ttu-id="15efb-124">Os tipos de recursos que o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] fornecem associações baseadas em sessão, fornecido pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="15efb-124">The types of features that the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] session-based, system-provided bindings provide.</span></span>  
  
-   <span data-ttu-id="15efb-125">Como criar um contrato que declara um requisito de sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-125">How to create a contract that declares a session requirement.</span></span>  
  
-   <span data-ttu-id="15efb-126">Como entender e controlar a criação e o encerramento da sessão e a relação da sessão para a instância do serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-126">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="15efb-127">Usando sessões de comportamento de execução padrão</span><span class="sxs-lookup"><span data-stu-id="15efb-127">Default Execution Behavior Using Sessions</span></span>  
 <span data-ttu-id="15efb-128">Uma associação que tenta iniciar uma sessão é chamada um *baseadas em sessão* associação.</span><span class="sxs-lookup"><span data-stu-id="15efb-128">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="15efb-129">Contratos de serviço especificar que eles exigem, permitirem ou recusam associações baseadas em sessão, definindo o <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> propriedade na interface de contrato de serviço (ou classe) para um do <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> valores de enumeração.</span><span class="sxs-lookup"><span data-stu-id="15efb-129">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="15efb-130">Por padrão, o valor dessa propriedade é <xref:System.ServiceModel.SessionMode.Allowed>, que significa que, se um cliente usa uma associação com base em sessão com um [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] implementação de serviço, o serviço estabelece e usa a sessão fornecida.</span><span class="sxs-lookup"><span data-stu-id="15efb-130">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="15efb-131">Quando um [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] serviço aceita uma sessão de cliente, os seguintes recursos são habilitados por padrão:</span><span class="sxs-lookup"><span data-stu-id="15efb-131">When a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service accepts a client session, the following features are enabled by default:</span></span>  
  
1.  <span data-ttu-id="15efb-132">Todas as chamadas entre um [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto de cliente são tratadas pela mesma instância de serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-132">All calls between a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object are handled by the same service instance.</span></span>  
  
2.  <span data-ttu-id="15efb-133">Ligações diferentes com base em sessão fornecem funcionalidades adicionais.</span><span class="sxs-lookup"><span data-stu-id="15efb-133">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="15efb-134">Tipos de sessão fornecido pelo sistema</span><span class="sxs-lookup"><span data-stu-id="15efb-134">System-Provided Session Types</span></span>  
 <span data-ttu-id="15efb-135">Uma associação baseada em sessão oferece suporte a associação de padrão de uma instância de serviço com uma determinada sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-135">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="15efb-136">No entanto, diferentes associações baseadas em sessão oferecem suporte a diferentes recursos, além de habilitar o controle de instanciamento baseadas em sessão descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="15efb-136">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 [!INCLUDE[indigo2](../../../includes/indigo2-md.md)]<span data-ttu-id="15efb-137">fornece os seguintes tipos de comportamento do aplicativo com base em sessão:</span><span class="sxs-lookup"><span data-stu-id="15efb-137"> provides the following types of session-based application behavior:</span></span>  
  
-   <span data-ttu-id="15efb-138">O <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> oferece suporte a sessões com base em segurança, em que ambas as extremidades de comunicação concordaram em uma conversa segura específica.</span><span class="sxs-lookup"><span data-stu-id="15efb-138">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="15efb-139">[Protegendo serviços](../../../docs/framework/wcf/securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="15efb-139"> [Securing Services](../../../docs/framework/wcf/securing-services.md).</span></span> <span data-ttu-id="15efb-140">Por exemplo, o <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> de associação, que contém suporte para sessões de segurança e sessões confiáveis, por padrão, usa somente uma sessão segura que criptografa e assina digitalmente as mensagens.</span><span class="sxs-lookup"><span data-stu-id="15efb-140">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
-   <span data-ttu-id="15efb-141">O <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> associação oferece suporte a sessões baseada em TCP/IP para garantir que todas as mensagens são correlacionadas por conexão no nível de soquete.</span><span class="sxs-lookup"><span data-stu-id="15efb-141">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
-   <span data-ttu-id="15efb-142">O <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> elemento, que implementa a especificação WS-ReliableMessaging, fornece suporte para sessões confiáveis em que as mensagens podem ser configuradas para ser entregues em ordem e exatamente uma vez, garantindo que as mensagens são recebidas, mesmo quando as mensagens passam em vários nós durante a conversa.</span><span class="sxs-lookup"><span data-stu-id="15efb-142">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="15efb-143">[Sessões confiáveis](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="15efb-143"> [Reliable Sessions](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span></span>  
  
-   <span data-ttu-id="15efb-144">O <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> associação fornece sessões de datagrama MSMQ.</span><span class="sxs-lookup"><span data-stu-id="15efb-144">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="15efb-145">[Filas no WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="15efb-145"> [Queues in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="15efb-146">Definindo o <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> propriedade não especifica o tipo de sessão, o contrato requer, somente que ele requer que um.</span><span class="sxs-lookup"><span data-stu-id="15efb-146">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="15efb-147">Criando um contrato que requer uma sessão</span><span class="sxs-lookup"><span data-stu-id="15efb-147">Creating a Contract That Requires a Session</span></span>  
 <span data-ttu-id="15efb-148">Criando um contrato que requer que uma sessão de estados que o grupo de operações que declara o contrato de serviço deve todos ser executado na mesma sessão e que as mensagens devem ser entregues em ordem.</span><span class="sxs-lookup"><span data-stu-id="15efb-148">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="15efb-149">Para declarar o nível de suporte de sessão que requer um contrato de serviço, defina o <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> sua interface de contrato de serviço ou uma classe para o valor da propriedade de <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeração para especificar se o contrato:</span><span class="sxs-lookup"><span data-stu-id="15efb-149">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
-   <span data-ttu-id="15efb-150">Requer uma sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-150">Requires a session.</span></span>  
  
-   <span data-ttu-id="15efb-151">Permite que um cliente estabelecer uma sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-151">Allows a client to establish a session.</span></span>  
  
-   <span data-ttu-id="15efb-152">Impede a uma sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-152">Prohibits a session.</span></span>  
  
 <span data-ttu-id="15efb-153">Definindo o <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> propriedade, no entanto, especifica o tipo de comportamento baseada em sessão, o contrato requer.</span><span class="sxs-lookup"><span data-stu-id="15efb-153">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="15efb-154">Ele instrui o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] para confirmar em tempo de execução que o configurado associação (que cria o canal de comunicação) para o serviço, não ou pode estabelecer uma sessão ao implementar um serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-154">It instructs [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="15efb-155">Novamente, a associação pode atender a esse requisito com qualquer tipo de comportamento baseado em sessão, ele escolhe, de segurança, transporte, confiável ou uma combinação.</span><span class="sxs-lookup"><span data-stu-id="15efb-155">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="15efb-156">O comportamento exato depende do <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> valor selecionado.</span><span class="sxs-lookup"><span data-stu-id="15efb-156">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="15efb-157">Se a associação configurada do serviço não está de acordo com o valor de <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, uma exceção será lançada.</span><span class="sxs-lookup"><span data-stu-id="15efb-157">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="15efb-158">Associações e os canais criarem que suporte a sessões são consideradas baseadas em sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-158">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="15efb-159">O contrato de serviço a seguir especifica que todas as operações no `ICalculatorSession` devem ser trocadas dentro de uma sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-159">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="15efb-160">Nenhuma das operações de retorna um valor para o chamador exceto o `Equals` método.</span><span class="sxs-lookup"><span data-stu-id="15efb-160">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="15efb-161">No entanto, o `Equals` método não usa nenhum parâmetro e, portanto, só pode retornar um valor diferente de zero dentro de uma sessão em que dados já foi passados para outras operações.</span><span class="sxs-lookup"><span data-stu-id="15efb-161">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="15efb-162">Este contrato requer uma sessão para funcionar corretamente.</span><span class="sxs-lookup"><span data-stu-id="15efb-162">This contract requires a session to function properly.</span></span> <span data-ttu-id="15efb-163">Sem uma sessão associada a um cliente específico, a instância do serviço não tem como saber quais dados anteriores, esse cliente enviou.</span><span class="sxs-lookup"><span data-stu-id="15efb-163">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="15efb-164">Se um serviço permite que uma sessão, em seguida, uma sessão é estabelecida e usada se o cliente inicia um; Caso contrário, nenhuma sessão é estabelecida.</span><span class="sxs-lookup"><span data-stu-id="15efb-164">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="15efb-165">Sessões e instâncias de serviço</span><span class="sxs-lookup"><span data-stu-id="15efb-165">Sessions and Service Instances</span></span>  
 <span data-ttu-id="15efb-166">Se você usar o padrão de comportamento de instanciação [!INCLUDE[indigo2](../../../includes/indigo2-md.md)], todas as chamadas entre um [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto de cliente são tratadas pela mesma instância de serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-166">If you use the default instancing behavior in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)], all calls between a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object are handled by the same service instance.</span></span> <span data-ttu-id="15efb-167">Portanto, no nível do aplicativo, você pode pensar uma sessão como habilitar o comportamento do aplicativo semelhante ao comportamento de chamada local.</span><span class="sxs-lookup"><span data-stu-id="15efb-167">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="15efb-168">Por exemplo, quando você cria um objeto local:</span><span class="sxs-lookup"><span data-stu-id="15efb-168">For example, when you create a local object:</span></span>  
  
-   <span data-ttu-id="15efb-169">Um construtor é chamado.</span><span class="sxs-lookup"><span data-stu-id="15efb-169">A constructor is called.</span></span>  
  
-   <span data-ttu-id="15efb-170">Todas as chamadas subsequentes feitas a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] referência de objeto de cliente são processados pela mesma instância de objeto.</span><span class="sxs-lookup"><span data-stu-id="15efb-170">All subsequent calls made to the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object reference are processed by the same object instance.</span></span>  
  
-   <span data-ttu-id="15efb-171">Um destruidor é chamado quando a referência de objeto é destruída.</span><span class="sxs-lookup"><span data-stu-id="15efb-171">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="15efb-172">Sessões de habilitar um comportamento semelhante entre clientes e serviços como o comportamento padrão da instância de serviço é usado.</span><span class="sxs-lookup"><span data-stu-id="15efb-172">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="15efb-173">Se um contrato de serviço requer ou oferece suporte a sessões, uma ou mais operações do contrato podem ser marcadas como iniciar ou encerrar uma sessão, definindo o <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> e <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> propriedades.</span><span class="sxs-lookup"><span data-stu-id="15efb-173">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="15efb-174">*Iniciando operações* são aqueles que deve ser chamado como a primeira operação de uma nova sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-174">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="15efb-175">Iniciar operações não pode ser chamado somente após pelo menos uma operação iniciando foi chamada.</span><span class="sxs-lookup"><span data-stu-id="15efb-175">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="15efb-176">Portanto, para criar um tipo do construtor de sessão para o serviço declarando iniciante operações projetadas para tirar a entrada de clientes apropriados para o início da instância de serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-176">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="15efb-177">(O estado é associado com a sessão, no entanto e não o objeto de serviço).</span><span class="sxs-lookup"><span data-stu-id="15efb-177">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="15efb-178">*Finalizando operações*, por outro lado, são aqueles que deve ser chamado em uma sessão existente como a última mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="15efb-178">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="15efb-179">No caso padrão, [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] recicla o objeto de serviço e o contexto, depois que a sessão com a qual o serviço estava associado é fechada.</span><span class="sxs-lookup"><span data-stu-id="15efb-179">In the default case, [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="15efb-180">Portanto, você pode criar um tipo de destruidor declarando finalizando operações projetadas para executar uma função apropriada ao final da instância do serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-180">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="15efb-181">Embora o comportamento padrão possui uma semelhança locais construtores e destruidores, é somente uma semelhança.</span><span class="sxs-lookup"><span data-stu-id="15efb-181">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="15efb-182">Qualquer [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] operação de serviço pode ser um iniciando operação de encerramento ou ambos ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="15efb-182">Any [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="15efb-183">Além disso, no caso padrão, iniciando operações pode ser chamado várias vezes em qualquer ordem. Não há sessões adicionais são criadas quando a sessão é estabelecida e associada a uma instância, a menos que você explicitamente controlar o tempo de vida da instância de serviço (manipulando o <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> objeto).</span><span class="sxs-lookup"><span data-stu-id="15efb-183">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="15efb-184">Por fim, o estado é associado com a sessão e não o objeto de serviço.</span><span class="sxs-lookup"><span data-stu-id="15efb-184">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="15efb-185">Por exemplo, o `ICalculatorSession` contrato usado no exemplo anterior requer que o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] primeira chamada de objeto de cliente a `Clear` operação antes de qualquer outra operação e que a sessão com isso [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto cliente deve encerrar quando ele chama o `Equals` operação.</span><span class="sxs-lookup"><span data-stu-id="15efb-185">For example, the `ICalculatorSession` contract used in the preceding example requires that the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object first call the `Clear` operation prior to any other operation and that the session with this [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="15efb-186">O exemplo de código a seguir mostra um contrato que impõe esses requisitos.</span><span class="sxs-lookup"><span data-stu-id="15efb-186">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="15efb-187">`Clear`deve ser chamado primeiro para iniciar uma sessão, e que a sessão termina quando `Equals` é chamado.</span><span class="sxs-lookup"><span data-stu-id="15efb-187">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="15efb-188">Os serviços não iniciar sessões com clientes.</span><span class="sxs-lookup"><span data-stu-id="15efb-188">Services do not start sessions with clients.</span></span> <span data-ttu-id="15efb-189">Em [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] aplicativos cliente, uma relação direta existe entre o tempo de vida do canal baseadas em sessão e o tempo de vida da sessão em si.</span><span class="sxs-lookup"><span data-stu-id="15efb-189">In [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="15efb-190">Dessa forma, os clientes criar novas sessões, criando novos canais de sessão e subdividir sessões existentes, fechando os canais de sessão normalmente.</span><span class="sxs-lookup"><span data-stu-id="15efb-190">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="15efb-191">Um cliente inicia uma sessão com um ponto de extremidade do serviço chamando um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="15efb-191">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
-   <span data-ttu-id="15efb-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType>o canal retornado por uma chamada para <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="15efb-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
-   <span data-ttu-id="15efb-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType>sobre o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] gerado pelo objeto do cliente a [Ferramenta Utilitária de metadados ServiceModel (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="15efb-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
-   <span data-ttu-id="15efb-194">Uma operação inicial em ambos os tipos de [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto cliente (por padrão, todas as operações estão iniciando).</span><span class="sxs-lookup"><span data-stu-id="15efb-194">An initiating operation on either type of [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object (by default, all operations are initiating).</span></span> <span data-ttu-id="15efb-195">Quando a primeira operação é chamada, o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto cliente abre o canal e inicia uma sessão automaticamente.</span><span class="sxs-lookup"><span data-stu-id="15efb-195">When the first operation is called, the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="15efb-196">Geralmente, um cliente termina uma sessão com um ponto de extremidade do serviço chamando um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="15efb-196">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
-   <span data-ttu-id="15efb-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>o canal retornado por uma chamada para <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="15efb-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
-   <span data-ttu-id="15efb-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>sobre o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] gerado pelo Svcutil.exe de objeto de cliente.</span><span class="sxs-lookup"><span data-stu-id="15efb-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object generated by Svcutil.exe.</span></span>  
  
-   <span data-ttu-id="15efb-199">Uma operação de encerramento em ambos os tipos de [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto cliente (por padrão, nenhuma operação está encerrando; o contrato deve especificar explicitamente uma operação de encerramento).</span><span class="sxs-lookup"><span data-stu-id="15efb-199">A terminating operation on either type of [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="15efb-200">Quando a primeira operação é chamada, o [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] objeto cliente abre o canal e inicia uma sessão automaticamente.</span><span class="sxs-lookup"><span data-stu-id="15efb-200">When the first operation is called, the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="15efb-201">Para obter exemplos, consulte [como: criar um serviço que requer sessões](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) , bem como a [comportamento de serviço padrão](../../../docs/framework/wcf/samples/default-service-behavior.md) e [Instancing](../../../docs/framework/wcf/samples/instancing.md) exemplos.</span><span class="sxs-lookup"><span data-stu-id="15efb-201">For examples, see [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) and [Instancing](../../../docs/framework/wcf/samples/instancing.md) samples.</span></span>  
  
 [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="15efb-202">os clientes e sessões, consulte [Acessando serviços usando um cliente WCF](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="15efb-202"> clients and sessions, see [Accessing Services Using a WCF Client](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="15efb-203">Sessões de interagem com as configurações do InstanceContext</span><span class="sxs-lookup"><span data-stu-id="15efb-203">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="15efb-204">Há uma interação entre o <xref:System.ServiceModel.SessionMode> enumeração em um contrato e o <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> propriedade, que controla a associação entre canais e objetos de serviço específico.</span><span class="sxs-lookup"><span data-stu-id="15efb-204">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> [!INCLUDE[crdefault](../../../includes/crdefault-md.md)]<span data-ttu-id="15efb-205">[Sessões, instanciação e simultaneidade](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="15efb-205"> [Sessions, Instancing, and Concurrency](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="15efb-206">Compartilhamento InstanceContext objetos</span><span class="sxs-lookup"><span data-stu-id="15efb-206">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="15efb-207">Você também pode controlar qual canal baseadas em sessão ou chamada está associada com a qual <xref:System.ServiceModel.InstanceContext> objeto executando essa associação por conta própria.</span><span class="sxs-lookup"><span data-stu-id="15efb-207">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span> <span data-ttu-id="15efb-208">Para obter um exemplo completo, consulte [InstanceContextSharing](http://msdn.microsoft.com/library/4a6a46d7-b7d7-4bb5-a0dd-03ffa3cbc230).</span><span class="sxs-lookup"><span data-stu-id="15efb-208">For a complete example, see [InstanceContextSharing](http://msdn.microsoft.com/library/4a6a46d7-b7d7-4bb5-a0dd-03ffa3cbc230).</span></span>  
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="15efb-209">Sessões e Streaming</span><span class="sxs-lookup"><span data-stu-id="15efb-209">Sessions and Streaming</span></span>  
 <span data-ttu-id="15efb-210">Quando você tiver uma grande quantidade de dados para transferência, o modo de transferência de streaming do [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] será uma alternativa viável para o comportamento padrão de buffer e processamento de mensagens na memória em sua totalidade.</span><span class="sxs-lookup"><span data-stu-id="15efb-210">When you have a large amount of data to transfer, the streaming transfer mode in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="15efb-211">Você pode obter um comportamento inesperado durante o streaming de chamadas com uma associação baseada em sessão.</span><span class="sxs-lookup"><span data-stu-id="15efb-211">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="15efb-212">Todas as chamadas de streaming são feitas por um único canal (o canal de datagrama) que não oferece suporte a sessões mesmo que a associação que está sendo usada esteja configurada para usar sessões.</span><span class="sxs-lookup"><span data-stu-id="15efb-212">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="15efb-213">Se vários clientes fazem chamadas para o mesmo objeto de serviço de streaming via uma associação com base em sessão e modo de simultaneidade do objeto de serviço é definido como único e o modo de contexto da instância é definido como `PerSession`, todas as chamadas devem passar pelo canal de datagrama e, portanto apenas uma chamada é processada por vez.</span><span class="sxs-lookup"><span data-stu-id="15efb-213">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="15efb-214">Portanto, um ou mais clientes podem atingir o tempo limite. Você pode contornar esse problema definindo o objeto de serviço `InstanceContextMode` para `PerCall` ou simultaneidade a vários.</span><span class="sxs-lookup"><span data-stu-id="15efb-214">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="15efb-215">MaxConcurrentSessions não tem efeito nesse caso porque há apenas uma "sessão".</span><span class="sxs-lookup"><span data-stu-id="15efb-215">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="15efb-216">Consulte também</span><span class="sxs-lookup"><span data-stu-id="15efb-216">See Also</span></span>  
 <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>  
 <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
