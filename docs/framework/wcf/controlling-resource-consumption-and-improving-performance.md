---
title: Controlando o consumo de recursos e a melhoria de desempenho
ms.date: 03/30/2017
ms.assetid: 9a829669-5f76-4c88-80ec-92d0c62c0660
ms.openlocfilehash: ee94ae7c570156d870b93311365ad52b815f12d5
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/07/2018
ms.locfileid: "33805519"
---
# <a name="controlling-resource-consumption-and-improving-performance"></a><span data-ttu-id="17cb1-102">Controlando o consumo de recursos e a melhoria de desempenho</span><span class="sxs-lookup"><span data-stu-id="17cb1-102">Controlling Resource Consumption and Improving Performance</span></span>
<span data-ttu-id="17cb1-103">Este tópico descreve várias propriedades em diferentes áreas da arquitetura do Windows Communication Foundation (WCF) que funcionam no consumo de recursos de controle e afetam o desempenho.</span><span class="sxs-lookup"><span data-stu-id="17cb1-103">This topic describes various properties in different areas of the Windows Communication Foundation (WCF) architecture that work to control resource consumption and affect performance metrics.</span></span>  
  
## <a name="properties-that-constrain-resource-consumption-in-wcf"></a><span data-ttu-id="17cb1-104">Propriedades que restringem o consumo de recursos no WCF</span><span class="sxs-lookup"><span data-stu-id="17cb1-104">Properties that Constrain Resource Consumption in WCF</span></span>  
 <span data-ttu-id="17cb1-105">Windows Communication Foundation (WCF) aplica restrições em determinados tipos de processos para fins de segurança ou desempenho.</span><span class="sxs-lookup"><span data-stu-id="17cb1-105">Windows Communication Foundation (WCF) applies constraints on certain types of processes for either security or performance purposes.</span></span> <span data-ttu-id="17cb1-106">Essas restrições têm duas formas principais, cotas e limitações.</span><span class="sxs-lookup"><span data-stu-id="17cb1-106">These constraints come in two main forms, either quotas and throttles.</span></span> <span data-ttu-id="17cb1-107">*Cotas* são os limites que quando atingido ou excedido disparam uma exceção imediata em algum momento no sistema.</span><span class="sxs-lookup"><span data-stu-id="17cb1-107">*Quotas* are limits that when reached or exceeded trigger an immediate exception at some point in the system.</span></span> <span data-ttu-id="17cb1-108">*Limita* são os limites que não causam imediatamente uma exceção seja lançada.</span><span class="sxs-lookup"><span data-stu-id="17cb1-108">*Throttles* are limits that do not immediately cause an exception to be thrown.</span></span> <span data-ttu-id="17cb1-109">Em vez disso, quando um limite for atingido, o processamento continuará, mas dentro dos limites definida por esse valor do acelerador.</span><span class="sxs-lookup"><span data-stu-id="17cb1-109">Instead, when a throttle limit is reached, processing continues but within the limits set by that throttle value.</span></span> <span data-ttu-id="17cb1-110">Esse processamento limitado pode disparar uma exceção em outro lugar, mas isso depende do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="17cb1-110">This limited processing might trigger an exception elsewhere, but this depends upon the application.</span></span>  
  
 <span data-ttu-id="17cb1-111">A diferença entre as cotas e limitações, além de algumas propriedades de restrições estão localizadas no nível de serialização, alguns no nível do transporte e alguns no nível do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="17cb1-111">In addition to the distinction between quotas and throttles, some constraining properties are located at the serialization level, some at the transport level, and some at the application level.</span></span> <span data-ttu-id="17cb1-112">Por exemplo, a cota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, que é implementado por todos os elementos de associação de transporte fornecida pelo sistema, é definido como 65.536 bytes por padrão para impedir clientes mal-intencionado de envolvidos em ataques de negação de serviço em relação a um serviço fazendo excessivo de memória consumo.</span><span class="sxs-lookup"><span data-stu-id="17cb1-112">For example, the quota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, which is implemented by all system-supplied transport binding elements, is set to 65,536 bytes by default to hinder malicious clients from engaging in denial-of-service attacks against a service by causing excessive memory consumption.</span></span> <span data-ttu-id="17cb1-113">(Normalmente, você pode aumentar o desempenho ao diminuir esse valor.)</span><span class="sxs-lookup"><span data-stu-id="17cb1-113">(Typically, you can increase performance by lowering this value.)</span></span>  
  
 <span data-ttu-id="17cb1-114">Um exemplo de uma cota de serialização é o <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> propriedade, que especifica o número máximo de objetos que o serializador serializa ou desserializa em uma única <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A> chamada de método.</span><span class="sxs-lookup"><span data-stu-id="17cb1-114">An example of a serialization quota is the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property, which specifies the maximum number of objects that the serializer serializes or deserializes in a single <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A> method call.</span></span> <span data-ttu-id="17cb1-115">Um exemplo de uma restrição de nível de aplicativo é o <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType> propriedade, que restringe o número de conexões simultâneas de canal de sessão para 10 por padrão.</span><span class="sxs-lookup"><span data-stu-id="17cb1-115">An example of an application-level throttle is the <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType> property, which by default restricts the number of concurrent sessionful channel connections to 10.</span></span> <span data-ttu-id="17cb1-116">(Ao contrário de cotas, se esse valor de limite é atingido, o aplicativo continua o processamento mas não aceita nenhum canal de sessão nova, que significa que os novos clientes não podem se conectar até que um dos outros canais de sessão é encerrado.)</span><span class="sxs-lookup"><span data-stu-id="17cb1-116">(Unlike the quotas, if this throttle value is reached, the application continues processing but accepts no new sessionful channels, which means that new clients cannot connect until one of the other sessionful channels is ended.)</span></span>  
  
 <span data-ttu-id="17cb1-117">Esses controles são projetados para fornecer uma redução de fora da caixa contra determinados tipos de ataques ou para melhorar o desempenho, como espaço de memória, tempo de inicialização e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="17cb1-117">These controls are designed to provide an out-of-the-box mitigation against certain types of attacks or to improve performance metrics such as memory footprint, start-up time, and so on.</span></span> <span data-ttu-id="17cb1-118">No entanto, dependendo do aplicativo, esses controles podem impedir o desempenho do aplicativo de serviço ou impedir que o aplicativo funcione em todos os.</span><span class="sxs-lookup"><span data-stu-id="17cb1-118">However, depending on the application, these controls can impede service application performance or prevent the application from working at all.</span></span> <span data-ttu-id="17cb1-119">Por exemplo, um aplicativo projetado para o fluxo de vídeo pode facilmente ultrapassam o padrão de <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="17cb1-119">For example, an application designed to stream video can easily exceed the default <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="17cb1-120">Este tópico fornece uma visão geral dos vários controles aplicada a aplicativos em todos os níveis de WCF, descreve várias formas de obter mais informações sobre se uma configuração é obstruindo o seu aplicativo e descreve maneiras de corrigir vários problemas.</span><span class="sxs-lookup"><span data-stu-id="17cb1-120">This topic provides an overview of the various controls applied to applications at all levels of WCF, describes various ways to obtain more information about whether a setting is hindering your application, and describes ways to correct various problems.</span></span> <span data-ttu-id="17cb1-121">A maioria das limitações e algumas cotas estão disponíveis no nível do aplicativo, mesmo quando a propriedade base é uma restrição de serialização ou de transporte.</span><span class="sxs-lookup"><span data-stu-id="17cb1-121">Most throttles and some quotas are available at the application level, even when the base property is a serialization or transport constraint.</span></span> <span data-ttu-id="17cb1-122">Por exemplo, você pode definir o <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> propriedade usando o <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> propriedade na classe de serviço.</span><span class="sxs-lookup"><span data-stu-id="17cb1-122">For example, you can set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property using the <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property on the service class.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="17cb1-123">Se você tiver um problema específico, você deve primeiro ler o [início rápido de solução de problemas do WCF](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md) para ver se o problema (e uma solução) estão listadas.</span><span class="sxs-lookup"><span data-stu-id="17cb1-123">If you have a particular problem, you should first read the [WCF Troubleshooting Quickstart](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md) to see whether your problem (and a solution) is listed there.</span></span>  
  
 <span data-ttu-id="17cb1-124">Propriedades que restringem os processos de serialização são listadas em [considerações de segurança para dados](../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="17cb1-124">Properties that restrict serialization processes are listed in [Security Considerations for Data](../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span></span> <span data-ttu-id="17cb1-125">Propriedades que restringem o consumo de recursos relacionados a todos os transportes são listadas em [cotas de transporte](../../../docs/framework/wcf/feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="17cb1-125">Properties that restrict the consumption of resources related to transports are listed in [Transport Quotas](../../../docs/framework/wcf/feature-details/transport-quotas.md).</span></span> <span data-ttu-id="17cb1-126">Propriedades que restringem o consumo de recursos na camada de aplicativo são os membros de <xref:System.ServiceModel.Dispatcher.ServiceThrottle> classe.</span><span class="sxs-lookup"><span data-stu-id="17cb1-126">Properties that restrict the consumption of resources at the application layer are the members of the <xref:System.ServiceModel.Dispatcher.ServiceThrottle> class.</span></span>  
  
## <a name="detecting-application-and-performance-issues-related-to-quota-settings"></a><span data-ttu-id="17cb1-127">Detecção de aplicativos e problemas de desempenho relacionados às configurações de cota</span><span class="sxs-lookup"><span data-stu-id="17cb1-127">Detecting Application and Performance Issues Related to Quota Settings</span></span>  
 <span data-ttu-id="17cb1-128">Os padrões dos valores anteriores foram escolhidos para habilitar a funcionalidade básica de aplicativo em uma grande variedade de tipos de aplicativos, proporcionando proteção básica em relação a problemas de segurança comuns.</span><span class="sxs-lookup"><span data-stu-id="17cb1-128">The defaults of the preceding values have been chosen to enable basic application functionality across a wide range of application types while providing basic protection against common security issues.</span></span> <span data-ttu-id="17cb1-129">No entanto, designs de aplicativo diferente poderá exceder uma ou mais configurações de limitação, embora o aplicativo é seguro e pode funcionar como planejado.</span><span class="sxs-lookup"><span data-stu-id="17cb1-129">However, different application designs might exceed one or more throttle settings although the application otherwise is secure and would work as designed.</span></span> <span data-ttu-id="17cb1-130">Nesses casos, você deve identificar quais valores de limitação estiver sendo excedidos e, em que nível e decidir sobre o curso de ação apropriado para aumentar a taxa de transferência do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="17cb1-130">In these cases, you must identify which throttle values are being exceeded and at what level, and decide on the appropriate course of action to increase application throughput.</span></span>  
  
 <span data-ttu-id="17cb1-131">Normalmente, ao escrever o aplicativo e depurá-lo, definir o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> propriedade `true` no arquivo de configuração ou programaticamente.</span><span class="sxs-lookup"><span data-stu-id="17cb1-131">Typically, when writing the application and debugging it, you set the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` in the configuration file or programmatically.</span></span> <span data-ttu-id="17cb1-132">Isso instrui o WCF para retornar os rastreamentos de pilha de exceção do serviço para o aplicativo cliente para exibição.</span><span class="sxs-lookup"><span data-stu-id="17cb1-132">This instructs WCF to return service exception stack traces to the client application for viewing.</span></span> <span data-ttu-id="17cb1-133">Esse recurso relata a maioria das exceções de nível de aplicativo de forma a exibir as configurações de cota podem estar envolvidas, se esse é o problema.</span><span class="sxs-lookup"><span data-stu-id="17cb1-133">This feature reports most application-level exceptions in such a way as to display which quota settings might be involved, if that is the problem.</span></span>  
  
 <span data-ttu-id="17cb1-134">Algumas exceções ocorrem em tempo de execução abaixo a visibilidade da camada de aplicativo e não são retornadas usando esse mecanismo, e não pode ser manipuladas por um personalizado <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> implementação.</span><span class="sxs-lookup"><span data-stu-id="17cb1-134">Some exceptions happen at run time below the visibility of the application layer and are not returned using this mechanism, and they might not be handled by a custom <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> implementation.</span></span> <span data-ttu-id="17cb1-135">Se você estiver em um ambiente de desenvolvimento, como o Microsoft Visual Studio, a maioria dessas exceções é exibida automaticamente.</span><span class="sxs-lookup"><span data-stu-id="17cb1-135">If you are in a development environment like Microsoft Visual Studio, most of these exceptions are displayed automatically.</span></span> <span data-ttu-id="17cb1-136">No entanto, algumas exceções podem ser mascaradas pelas configurações de ambiente de desenvolvimento, como o [Just My Code](http://go.microsoft.com/fwlink/?LinkId=82174) configurações no Visual Studio 2005.</span><span class="sxs-lookup"><span data-stu-id="17cb1-136">However, some exceptions can be masked by development environment settings such as the [Just My Code](http://go.microsoft.com/fwlink/?LinkId=82174) settings in Visual Studio 2005.</span></span>  
  
 <span data-ttu-id="17cb1-137">Independentemente dos recursos do ambiente de desenvolvimento, você pode usar recursos de rastreamento do WCF e o registro de mensagem para todas as exceções de depurar e ajustar o desempenho de seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="17cb1-137">Regardless of the capabilities of your development environment, you can use capabilities of WCF tracing and message logging to debug all exceptions and tune the performance of your applications.</span></span> <span data-ttu-id="17cb1-138">Para obter mais informações, consulte [usando rastreamento para solucionar problemas de seu aplicativo](../../../docs/framework/wcf/diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md).</span><span class="sxs-lookup"><span data-stu-id="17cb1-138">For more information, see [Using Tracing to Troubleshoot Your Application](../../../docs/framework/wcf/diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md).</span></span>  
  
## <a name="performance-issues-and-xmlserializer"></a><span data-ttu-id="17cb1-139">Problemas de desempenho e de XmlSerializer</span><span class="sxs-lookup"><span data-stu-id="17cb1-139">Performance Issues and XmlSerializer</span></span>  
 <span data-ttu-id="17cb1-140">Serviços e aplicativos cliente que usam tipos de dados pode ser serializado usando o <xref:System.Xml.Serialization.XmlSerializer> gerar e compilar o código de serialização para esses tipos de dados em tempo de execução, o que pode resultar em desempenho de inicialização lenta.</span><span class="sxs-lookup"><span data-stu-id="17cb1-140">Services and client applications that use data types that are serializable using the <xref:System.Xml.Serialization.XmlSerializer> generate and compile serialization code for those data types at run time, which can result in slow start-up performance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="17cb1-141">Código de serialização gerado pode ser usado apenas em aplicativos cliente e não em serviços.</span><span class="sxs-lookup"><span data-stu-id="17cb1-141">Pre-generated serialization code can be used only in client applications and not in services.</span></span>  
  
 <span data-ttu-id="17cb1-142">O [Ferramenta Utilitária de metadados ServiceModel (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) pode melhorar o desempenho de inicialização para esses aplicativos por meio da geração de código de serialização necessários dos assemblies compilados para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="17cb1-142">The [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) can improve start-up performance for these applications by generating the necessary serialization code from the compiled assemblies for the application.</span></span> <span data-ttu-id="17cb1-143">Para obter mais informações, consulte [como: melhorar a inicialização do tempo de WCF aplicativos cliente que usam o XmlSerializer](../../../docs/framework/wcf/feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md).</span><span class="sxs-lookup"><span data-stu-id="17cb1-143">For more information, see [How to: Improve the Startup Time of WCF Client Applications using the XmlSerializer](../../../docs/framework/wcf/feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md).</span></span>  
  
## <a name="performance-issues-when-hosting-wcf-services-under-aspnet"></a><span data-ttu-id="17cb1-144">Problemas de desempenho ao hospedar serviços WCF no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="17cb1-144">Performance Issues When Hosting WCF Services Under ASP.NET</span></span>  
 <span data-ttu-id="17cb1-145">Quando um serviço WCF é hospedado em IIS e ASP.NET, as definições de configuração do IIS e ASP.NET podem afetar o taxa de transferência e volume de memória do serviço WCF.</span><span class="sxs-lookup"><span data-stu-id="17cb1-145">When a WCF service is hosted under IIS and ASP.NET, the configuration settings of IIS and ASP.NET can affect the throughput and memory footprint of the WCF service.</span></span>  <span data-ttu-id="17cb1-146">Para obter mais informações sobre o desempenho do ASP.NET, consulte [melhorando o desempenho do ASP.NET](http://go.microsoft.com/fwlink/?LinkId=186462).</span><span class="sxs-lookup"><span data-stu-id="17cb1-146">For more information about ASP.NET performance, see [Improving ASP.NET Performance](http://go.microsoft.com/fwlink/?LinkId=186462).</span></span>  <span data-ttu-id="17cb1-147">Uma configuração que pode ter consequências não intencionais é <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, que é uma propriedade do <xref:System.Web.Configuration.ProcessModelSection>.</span><span class="sxs-lookup"><span data-stu-id="17cb1-147">One setting that might have unintended consequences is <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, which is a property of the <xref:System.Web.Configuration.ProcessModelSection>.</span></span> <span data-ttu-id="17cb1-148">Se seu aplicativo tiver um número fixo ou pequeno de clientes, a configuração <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> 2 pode fornecer um aumento da taxa de transferência em um computador multiprocessador que tem uma utilização da CPU próximo a 100%.</span><span class="sxs-lookup"><span data-stu-id="17cb1-148">If your application has a fixed or small number of clients, setting <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> to 2 might provide a throughput boost on a multiprocessor machine that has a CPU utilization close to 100%.</span></span> <span data-ttu-id="17cb1-149">Esse aumento no desempenho vem com um custo: também causará um aumento no uso de memória, que pode reduzir escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="17cb1-149">This increase in performance comes with a cost: it will also cause an increase in memory usage, which could reduce scalability.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="17cb1-150">Consulte também</span><span class="sxs-lookup"><span data-stu-id="17cb1-150">See Also</span></span>  
 [<span data-ttu-id="17cb1-151">Administração e diagnósticos</span><span class="sxs-lookup"><span data-stu-id="17cb1-151">Administration and Diagnostics</span></span>](../../../docs/framework/wcf/diagnostics/index.md)  
 [<span data-ttu-id="17cb1-152">Dados grandes e streaming</span><span class="sxs-lookup"><span data-stu-id="17cb1-152">Large Data and Streaming</span></span>](../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)
