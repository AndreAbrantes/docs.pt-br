---
title: 'Como: criar um autenticador de token de segurança personalizadas'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: 096cfc0f19189ba3173a8c5decd483542a18dbb0
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61767176"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="a3ac3-102">Como: criar um autenticador de token de segurança personalizadas</span><span class="sxs-lookup"><span data-stu-id="a3ac3-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="a3ac3-103">Este tópico mostra como criar um autenticador de token de segurança personalizada e como integrá-lo com um Gerenciador de token de segurança personalizada.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="a3ac3-104">Um autenticador de token de segurança valida o conteúdo de um token de segurança fornecido com uma mensagem de entrada.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="a3ac3-105">Se a validação for bem-sucedida, o autenticador retorna uma coleção de <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instâncias que, quando avaliado, retorna um conjunto de declarações.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="a3ac3-106">Para usar um autenticador de token de segurança personalizadas no Windows Communication Foundation (WCF), você deve primeiro criar segurança e credenciais personalizadas do Gerenciador de token implementações.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="a3ac3-107">Para obter mais informações sobre a criação de credenciais personalizadas e uma segurança Gerenciador de token, consulte [passo a passo: Criação de credenciais de serviço e personalizadas do cliente](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="a3ac3-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="a3ac3-108">Procedimentos</span><span class="sxs-lookup"><span data-stu-id="a3ac3-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="a3ac3-109">Para criar um autenticador de token de segurança personalizadas</span><span class="sxs-lookup"><span data-stu-id="a3ac3-109">To create a custom security token authenticator</span></span>  
  
1. <span data-ttu-id="a3ac3-110">Definir uma nova classe que deriva de <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> classe.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2. <span data-ttu-id="a3ac3-111">Substituir o método <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="a3ac3-112">O método retornará `true` ou `false` dependendo se o autenticador personalizado pode validar o tipo de token de entrada ou não.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3. <span data-ttu-id="a3ac3-113">Substituir o método <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="a3ac3-114">Esse método precisa validar o conteúdo do token adequadamente.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="a3ac3-115">Se o token passa a etapa de validação, ele retorna uma coleção de <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instâncias.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="a3ac3-116">O exemplo a seguir usa uma implementação de política de autorização personalizada que será criada no próximo procedimento.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="a3ac3-117">O código anterior retorna uma coleção de políticas de autorização no <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> método.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="a3ac3-118">O WCF não fornece uma implementação dessa interface pública.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="a3ac3-119">O procedimento a seguir mostra como fazer isso para seus próprios requisitos.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="a3ac3-120">Para criar uma política de autorização personalizada</span><span class="sxs-lookup"><span data-stu-id="a3ac3-120">To create a custom authorization policy</span></span>  
  
1. <span data-ttu-id="a3ac3-121">Definir uma nova classe implementando o <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2. <span data-ttu-id="a3ac3-122">Implementar o <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> propriedade somente leitura.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="a3ac3-123">Uma maneira de implementar essa propriedade é gerar um identificador global exclusivo (GUID) no construtor da classe e retorná-lo toda vez que o valor dessa propriedade é solicitado.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3. <span data-ttu-id="a3ac3-124">Implementar o <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> propriedade somente leitura.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="a3ac3-125">Esta propriedade precisa retornar um emissor dos conjuntos de declarações que são obtidos do token.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="a3ac3-126">Esse emissor deve corresponder ao emissor do token ou uma autoridade que é responsável por validar o conteúdo do token.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="a3ac3-127">O exemplo a seguir usa a declaração do emissor que passados para essa classe do autenticador de token de segurança personalizada criado no procedimento anterior.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="a3ac3-128">O autenticador de token de segurança personalizada usa o conjunto de declarações fornecidas pelo sistema (retornado pela <xref:System.IdentityModel.Claims.ClaimSet.System%2A> propriedade) para representar o emissor do token de nome de usuário.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4. <span data-ttu-id="a3ac3-129">Implementar o método de <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> .</span><span class="sxs-lookup"><span data-stu-id="a3ac3-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="a3ac3-130">Esse método popula uma instância da <xref:System.IdentityModel.Policy.EvaluationContext> (transmitida como um argumento) da classe com declarações que se baseiam no conteúdo do token de segurança entrada.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="a3ac3-131">O método retorna `true` quando ele é feito com a avaliação.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="a3ac3-132">Em casos quando a implementação se baseia na presença de outras políticas de autorização que fornecem informações adicionais para o contexto de avaliação, esse método pode retornar `false` se não houver as informações necessárias ainda no contexto de avaliação.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="a3ac3-133">Nesse caso, o WCF chamará o método novamente depois de avaliar todas as demais diretivas de autorização geradas para a mensagem de entrada se pelo menos uma dessas políticas de autorização tiver modificado o contexto de avaliação.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="a3ac3-134">[Passo a passo: Criação de credenciais de serviço e personalizadas do cliente](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) descreve como criar uma segurança personalizada e credenciais personalizadas do Gerenciador de token.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-134">[Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="a3ac3-135">Para usar o autenticador de token de segurança personalizada criado aqui, uma implementação do Gerenciador de token de segurança é modificada para retornar o autenticador personalizado do <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> método.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="a3ac3-136">O método retorna um autenticador quando um requisito de token de segurança apropriado é passado.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="a3ac3-137">Integrar um autenticador de token de segurança personalizada com um Gerenciador de token de segurança personalizadas</span><span class="sxs-lookup"><span data-stu-id="a3ac3-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1. <span data-ttu-id="a3ac3-138">Substituir o <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> método em sua implementação do Gerenciador de token de segurança personalizada.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2. <span data-ttu-id="a3ac3-139">Adicionar lógica para o método para habilitá-lo retornar o autenticador de token de segurança personalizada com base no <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parâmetro.</span><span class="sxs-lookup"><span data-stu-id="a3ac3-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="a3ac3-140">O exemplo a seguir retorna um autenticador de token de segurança personalizada, se o tipo de token de requisitos de token é um nome de usuário (representado pelo <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> propriedade) e a direção da mensagem para os quais o autenticador de token de segurança está sendo solicitado é de entrada ( representado pelo <xref:System.ServiceModel.Description.MessageDirection.Input> campo).</span><span class="sxs-lookup"><span data-stu-id="a3ac3-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
 
## <a name="see-also"></a><span data-ttu-id="a3ac3-141">Consulte também</span><span class="sxs-lookup"><span data-stu-id="a3ac3-141">See also</span></span>

- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="a3ac3-142">Passo a passo: Criação de credenciais de serviço e personalizadas do cliente</span><span class="sxs-lookup"><span data-stu-id="a3ac3-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="a3ac3-143">Como: Criar um provedor de Token de segurança personalizadas</span><span class="sxs-lookup"><span data-stu-id="a3ac3-143">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)
