---
title: Como utilizar certificados X.509 separados para assinatura e criptografia
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, extensibility
- ClientCredentials class
- ClientCredentialsSecurityTokenManager class
ms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49
ms.openlocfilehash: d4c2e34b3e123e6fa9d8dc8e544f621b39861592
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/07/2018
---
# <a name="how-to-use-separate-x509-certificates-for-signing-and-encryption"></a><span data-ttu-id="52a90-102">Como utilizar certificados X.509 separados para assinatura e criptografia</span><span class="sxs-lookup"><span data-stu-id="52a90-102">How to: Use Separate X.509 Certificates for Signing and Encryption</span></span>
<span data-ttu-id="52a90-103">Este tópico mostra como configurar o Windows Communication Foundation (WCF) para usar certificados diferentes para assinatura e criptografia no cliente e no serviço.</span><span class="sxs-lookup"><span data-stu-id="52a90-103">This topic shows how to configure Windows Communication Foundation (WCF) to use different certificates for message signing and encryption on both the client and service.</span></span>  
  
 <span data-ttu-id="52a90-104">Para habilitar certificados separados a ser usado para assinatura e criptografia, um cliente personalizado ou serviço credenciais (ou ambos) devem ser criados porque o WCF não fornece uma API para definir vários certificados de cliente ou serviço.</span><span class="sxs-lookup"><span data-stu-id="52a90-104">To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because WCF does not provide an API to set multiple client or service certificates.</span></span> <span data-ttu-id="52a90-105">Além disso, um segurança do Gerenciador de token deve ser fornecido para utilizar as informações de vários certificados e criar um provedor de token de segurança apropriado para especificado direção de mensagem e de uso de chave.</span><span class="sxs-lookup"><span data-stu-id="52a90-105">Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.</span></span>  
  
 <span data-ttu-id="52a90-106">O diagrama a seguir mostra as classes principais usadas, as classes herdam (mostrada por uma seta apontando para cima) e os tipos de retorno de certos métodos e propriedades.</span><span class="sxs-lookup"><span data-stu-id="52a90-106">The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.</span></span>  
  
-   <span data-ttu-id="52a90-107">`MyClientCredentials` é uma implementação personalizada de <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="52a90-107">`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.</span></span>  
  
    -   <span data-ttu-id="52a90-108">Suas propriedades mostradas no diagrama de retorno de todas as instâncias do <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="52a90-108">Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span></span>  
  
    -   <span data-ttu-id="52a90-109">O método <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> retorna uma instância de `MyClientCredentialsSecurityTokenManager`.</span><span class="sxs-lookup"><span data-stu-id="52a90-109">Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.</span></span>  
  
-   <span data-ttu-id="52a90-110">`MyClientCredentialsSecurityTokenManager` é uma implementação personalizada de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="52a90-110">`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>  
  
    -   <span data-ttu-id="52a90-111">O método <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> retorna uma instância de <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span><span class="sxs-lookup"><span data-stu-id="52a90-111">Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span></span>  
  
 <span data-ttu-id="52a90-112">![Gráfico mostrando como as credenciais do cliente são usadas](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span><span class="sxs-lookup"><span data-stu-id="52a90-112">![Chart showing how client credentials are used](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span></span>  
  
 <span data-ttu-id="52a90-113">Para obter mais informações sobre credenciais personalizadas, consulte [passo a passo: criação de cliente personalizadas e as credenciais de serviço](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="52a90-113">For more information about custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
 <span data-ttu-id="52a90-114">Além disso, você deve criar um verificador de identidade personalizada e vinculá-lo a um elemento de associação de segurança em uma associação personalizada.</span><span class="sxs-lookup"><span data-stu-id="52a90-114">In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.</span></span> <span data-ttu-id="52a90-115">Você também deve usar as credenciais personalizadas em vez de credenciais padrão.</span><span class="sxs-lookup"><span data-stu-id="52a90-115">You must also use the custom credentials instead of the default credentials.</span></span>  
  
 <span data-ttu-id="52a90-116">O diagrama a seguir mostra as classes envolvidas na associação personalizada, e como o verificador de identidade personalizado é vinculado.</span><span class="sxs-lookup"><span data-stu-id="52a90-116">The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.</span></span> <span data-ttu-id="52a90-117">Há vários elementos de associação envolvidos, que herda de <xref:System.ServiceModel.Channels.BindingElement>.</span><span class="sxs-lookup"><span data-stu-id="52a90-117">There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>.</span></span> <span data-ttu-id="52a90-118">O <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> tem o <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> propriedade, que retorna uma instância de <xref:System.ServiceModel.Security.IdentityVerifier>, do qual `MyIdentityVerifier` personalizada.</span><span class="sxs-lookup"><span data-stu-id="52a90-118">The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.</span></span>  
  
 <span data-ttu-id="52a90-119">![Gráfico mostrando um elemento de associação personalizada](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span><span class="sxs-lookup"><span data-stu-id="52a90-119">![Chart showing a custom binding element](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span></span>  
  
 <span data-ttu-id="52a90-120">Para obter mais informações sobre como criar um verificador de identidade personalizada, consulte como: [como: criar um verificador de identidade do cliente personalizado](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).</span><span class="sxs-lookup"><span data-stu-id="52a90-120">For more information about creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).</span></span>  
  
### <a name="to-use-separate-certificates-for-signing-and-encryption"></a><span data-ttu-id="52a90-121">Para usar certificados separados para assinatura e criptografia</span><span class="sxs-lookup"><span data-stu-id="52a90-121">To use separate certificates for signing and encryption</span></span>  
  
1.  <span data-ttu-id="52a90-122">Definir uma nova classe de credenciais de cliente que herde o <xref:System.ServiceModel.Description.ClientCredentials> classe.</span><span class="sxs-lookup"><span data-stu-id="52a90-122">Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span> <span data-ttu-id="52a90-123">Implementar quatro novas propriedades para permitir a especificação de vários certificados: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, e `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="52a90-123">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="52a90-124">Também substituir o <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> método para retornar uma instância do personalizado <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> classe definida na próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="52a90-124">Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>  
  
     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]
     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]  
  
2.  <span data-ttu-id="52a90-125">Definir um novo cliente segurança Gerenciador de token que herda de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> classe.</span><span class="sxs-lookup"><span data-stu-id="52a90-125">Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="52a90-126">Substituir o <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> método para criar um provedor de token de segurança apropriado.</span><span class="sxs-lookup"><span data-stu-id="52a90-126">Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider.</span></span> <span data-ttu-id="52a90-127">O `requirement` parâmetro (um <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) fornece o uso de chave e de direção de mensagem.</span><span class="sxs-lookup"><span data-stu-id="52a90-127">The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.</span></span>  
  
     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]
     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]  
  
3.  <span data-ttu-id="52a90-128">Definir uma nova classe de credenciais de serviço que herda de <xref:System.ServiceModel.Description.ServiceCredentials> classe.</span><span class="sxs-lookup"><span data-stu-id="52a90-128">Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class.</span></span> <span data-ttu-id="52a90-129">Implementar quatro novas propriedades para permitir a especificação de vários certificados: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, e `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="52a90-129">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="52a90-130">Também substituir o <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> método para retornar uma instância do personalizado <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> classe definida na próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="52a90-130">Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>  
  
     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]
     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]  
  
4.  <span data-ttu-id="52a90-131">Definir um novo serviço segurança Gerenciador de token que herda de <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> classe.</span><span class="sxs-lookup"><span data-stu-id="52a90-131">Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="52a90-132">Substituir o <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> método para criar um provedor de token de segurança apropriadas dado o uso de chave e de direção de mensagem passada.</span><span class="sxs-lookup"><span data-stu-id="52a90-132">Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.</span></span>  
  
     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]
     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]  
  
### <a name="to-use-multiple-certificates-on-the-client"></a><span data-ttu-id="52a90-133">Para usar vários certificados no cliente</span><span class="sxs-lookup"><span data-stu-id="52a90-133">To use multiple certificates on the client</span></span>  
  
1.  <span data-ttu-id="52a90-134">Crie uma associação personalizada.</span><span class="sxs-lookup"><span data-stu-id="52a90-134">Create a custom binding.</span></span> <span data-ttu-id="52a90-135">O elemento de associação de segurança deve funcionar no modo duplex para permitir a segurança de diferente provedores de token estar presente para solicitações e respostas.</span><span class="sxs-lookup"><span data-stu-id="52a90-135">The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="52a90-136">Uma forma de fazer isso é usar um transporte duplex capaz ou usar o <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="52a90-136">One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="52a90-137">Vincular a personalizada <xref:System.ServiceModel.Security.IdentityVerifier> que é definida na próxima etapa para o elemento de associação de segurança.</span><span class="sxs-lookup"><span data-stu-id="52a90-137">Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element.</span></span> <span data-ttu-id="52a90-138">Substitua as credenciais do cliente padrão com as credenciais do cliente personalizado criadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="52a90-138">Replace the default client credentials with the customized client credentials previously created.</span></span>  
  
     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]
     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]  
  
2.  <span data-ttu-id="52a90-139">Definir um personalizado <xref:System.ServiceModel.Security.IdentityVerifier>.</span><span class="sxs-lookup"><span data-stu-id="52a90-139">Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>.</span></span> <span data-ttu-id="52a90-140">O serviço tem várias identidades, como certificados diferentes são usados para criptografar a solicitação e para assinar a resposta.</span><span class="sxs-lookup"><span data-stu-id="52a90-140">The service has multiple identities because different certificates are used to encrypt the request and to sign the response.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="52a90-141">No exemplo a seguir, o verificador de identidade personalizado fornecido não executa nenhuma identidade de ponto de extremidade verificando para fins de demonstração.</span><span class="sxs-lookup"><span data-stu-id="52a90-141">In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.</span></span> <span data-ttu-id="52a90-142">Isso não é recomendável prática para código de produção.</span><span class="sxs-lookup"><span data-stu-id="52a90-142">This is not recommended practice for production code.</span></span>  
  
     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]
     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]  
  
### <a name="to-use-multiple-certificates-on-the-service"></a><span data-ttu-id="52a90-143">Para usar vários certificados no serviço</span><span class="sxs-lookup"><span data-stu-id="52a90-143">To use multiple certificates on the service</span></span>  
  
1.  <span data-ttu-id="52a90-144">Crie uma associação personalizada.</span><span class="sxs-lookup"><span data-stu-id="52a90-144">Create a custom binding.</span></span> <span data-ttu-id="52a90-145">O elemento de associação de segurança deve operar em modo duplex para permitir a segurança de diferente provedores de token estar presente para solicitações e respostas.</span><span class="sxs-lookup"><span data-stu-id="52a90-145">The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="52a90-146">Como com o cliente, use um transporte duplex capaz ou <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="52a90-146">As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="52a90-147">Substitua as credenciais de serviço padrão com as credenciais de serviço personalizado criadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="52a90-147">Replace the default service credentials with the customized service credentials previously created.</span></span>  
  
     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]
     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="52a90-148">Consulte também</span><span class="sxs-lookup"><span data-stu-id="52a90-148">See Also</span></span>  
 <xref:System.ServiceModel.Description.ClientCredentials>  
 <xref:System.ServiceModel.Description.ServiceCredentials>  
 <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>  
 <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>  
 <xref:System.ServiceModel.Security.IdentityVerifier>  
 [<span data-ttu-id="52a90-149">Passo a passo: criando credenciais de serviço e de cliente personalizados</span><span class="sxs-lookup"><span data-stu-id="52a90-149">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
