---
title: Decodificadores personalizados
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: fa0e1d7f-af36-4bf4-aac9-cd4eab95bc4f
caps.latest.revision: "15"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: d9a6c9705fbcf4dd3b9aeb6f07a7973081ea66c3
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="custom-encoders"></a><span data-ttu-id="e20be-102">Decodificadores personalizados</span><span class="sxs-lookup"><span data-stu-id="e20be-102">Custom Encoders</span></span>
<span data-ttu-id="e20be-103">Este tópico discute como criar decodificadores personalizados.</span><span class="sxs-lookup"><span data-stu-id="e20be-103">This topic discusses how to create custom encoders.</span></span>  
  
 <span data-ttu-id="e20be-104">Em [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], você usa um *associação* para especificar como transferir dados através de uma rede entre os pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="e20be-104">In [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], you use a *binding* to specify how to transfer data across a network between endpoints.</span></span> <span data-ttu-id="e20be-105">Uma associação é composta de uma sequência de *elementos de associação*.</span><span class="sxs-lookup"><span data-stu-id="e20be-105">A binding is made up of a sequence of *binding elements*.</span></span> <span data-ttu-id="e20be-106">Uma associação inclui elementos de associação de protocolo opcional, como segurança, necessário *codificador de mensagem* elemento de associação e um elemento de associação de transporte necessário.</span><span class="sxs-lookup"><span data-stu-id="e20be-106">A binding includes optional protocol binding elements such as security, a required *Message Encoder* binding element, and a required transport binding element.</span></span> <span data-ttu-id="e20be-107">Um codificador de mensagem é representado por uma elemento de associação de codificação de mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-107">A message encoder is represented by a message encoding binding element.</span></span> <span data-ttu-id="e20be-108">Três codificadores de mensagem estão incluídos no [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]: binário, o mecanismo de otimização de transmissão mensagem (MTOM) e o texto.</span><span class="sxs-lookup"><span data-stu-id="e20be-108">Three message encoders are included in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]: Binary, Message Transmission Optimization Mechanism (MTOM), and Text.</span></span>  
  
 <span data-ttu-id="e20be-109">Uma elemento de associação de codificação serializa uma saída de mensagem <xref:System.ServiceModel.Channels.Message> e passa para o transporte ou recebe o formato serializado de uma mensagem do transporte e passa para a camada de protocolo, se presente, ou para o aplicativo, caso ainda não presentes.</span><span class="sxs-lookup"><span data-stu-id="e20be-109">A message encoding binding element serializes an outgoing <xref:System.ServiceModel.Channels.Message> and passes it to the transport, or receives the serialized form of a message from the transport and passes it to the protocol layer if present, or to the application, if not present.</span></span>  
  
 <span data-ttu-id="e20be-110">Codificadores de mensagem transform <xref:System.ServiceModel.Channels.Message> instâncias para e de uma representação de transmissão.</span><span class="sxs-lookup"><span data-stu-id="e20be-110">Message encoders transform <xref:System.ServiceModel.Channels.Message> instances to and from a wire representation.</span></span> <span data-ttu-id="e20be-111">Embora os codificadores são descritos como sentar-se acima da camada de transporte na pilha de canais, eles residem dentro da camada de transporte.</span><span class="sxs-lookup"><span data-stu-id="e20be-111">Although encoders are described as sitting above the transport layer in the channel stack, they reside inside the transport layer.</span></span> <span data-ttu-id="e20be-112">Transportes (por exemplo, HTTP) formatar a mensagem de acordo com os requisitos do padrão de transporte.</span><span class="sxs-lookup"><span data-stu-id="e20be-112">Transports (for example HTTP) format the message according to the requirements of the transport standard.</span></span> <span data-ttu-id="e20be-113">Codificadores (por exemplo Xml de texto) apenas codificam a mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-113">Encoders (for example Text Xml) just encode the message.</span></span>  
  
 <span data-ttu-id="e20be-114">Ao se conectar a um servidor ou cliente preexistente, talvez você não tenha a opção de usar uma codificação de mensagem específica.</span><span class="sxs-lookup"><span data-stu-id="e20be-114">When connecting to a preexisting client or server, you may not have a choice about using a particular message encoding.</span></span> <span data-ttu-id="e20be-115">No entanto, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] serviços podem se tornar acessíveis através de vários pontos de extremidade, cada um com um codificador de mensagem diferentes.</span><span class="sxs-lookup"><span data-stu-id="e20be-115">However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services can be made accessible through multiple endpoints, each with a different message encoder.</span></span> <span data-ttu-id="e20be-116">Quando um codificador único não abrange todo o público para o serviço, considere a possibilidade de expor seu serviço em vários pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="e20be-116">When a single encoder does not cover the entire audience for your service, consider exposing your service over multiple endpoints.</span></span> <span data-ttu-id="e20be-117">Aplicativos cliente podem escolher o ponto de extremidade que é melhor para eles.</span><span class="sxs-lookup"><span data-stu-id="e20be-117">Client applications can then choose the endpoint that is best for them.</span></span> <span data-ttu-id="e20be-118">Usar vários pontos de extremidade permite que você combine as vantagens de codificadores de mensagem diferente com outros elementos de associação.</span><span class="sxs-lookup"><span data-stu-id="e20be-118">Using multiple endpoints allows you to combine the advantages of different message encoders with other binding elements.</span></span>  
  
## <a name="system-provided-encoders"></a><span data-ttu-id="e20be-119">Codificadores fornecido pelo sistema</span><span class="sxs-lookup"><span data-stu-id="e20be-119">System-Provided Encoders</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="e20be-120">fornece várias associações fornecidas pelo sistema que são projetadas para cobrir os cenários mais comuns do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e20be-120"> provides several system-provided bindings that are designed to cover the most common application scenarios.</span></span> <span data-ttu-id="e20be-121">Cada uma dessas vinculações combinar um transporte, o codificador de mensagem e outras opções (security, por exemplo).</span><span class="sxs-lookup"><span data-stu-id="e20be-121">Each of these bindings combine a transport, message encoder, and other options (security, for example).</span></span> <span data-ttu-id="e20be-122">Este tópico descreve como estender o `Text`, `Binary`, e `MTOM` mensagem codificadores são incluídos no [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], ou criar seu próprio codificador personalizado.</span><span class="sxs-lookup"><span data-stu-id="e20be-122">This topic describes how to extend the `Text`, `Binary`, and `MTOM` message encoders that are included in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], or create your own custom encoder.</span></span> <span data-ttu-id="e20be-123">O codificador de mensagem de texto oferece suporte tanto uma codificação de XML simples como codificações SOAP.</span><span class="sxs-lookup"><span data-stu-id="e20be-123">The text message encoder supports both a plain XML encoding as well as SOAP encodings.</span></span> <span data-ttu-id="e20be-124">O modo de codificação XML simples do codificador de mensagem de texto é chamado o codificador POX ("Plain Old XML") para distingui-lo de que a codificação de SOAP com base em texto.</span><span class="sxs-lookup"><span data-stu-id="e20be-124">The plain XML encoding mode of the text message encoder is called the POX ("Plain Old XML") encoder to distinguish it from the text-based SOAP encoding.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="e20be-125">as combinações de elementos de associação fornecidos pelo associações fornecidas pelo sistema, consulte a seção correspondente em [selecionando um transporte](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="e20be-125"> the combinations of binding elements provided by the system-provided bindings, see the corresponding section in [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="how-to-work-with-system-provided-encoders"></a><span data-ttu-id="e20be-126">Como trabalhar com codificadores fornecido pelo sistema</span><span class="sxs-lookup"><span data-stu-id="e20be-126">How to Work with System-Provided Encoders</span></span>  
 <span data-ttu-id="e20be-127">Uma codificação é adicionada a uma associação usando uma classe derivada de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="e20be-127">An encoding is added to a binding using a class derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="e20be-128">fornece os seguintes tipos de elementos de associação derivados de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> classe que pode fornecer para texto, binária e codificação de mecanismo de otimização de transmissão da mensagem (MTOM):</span><span class="sxs-lookup"><span data-stu-id="e20be-128"> provides the following types of binding elements derived from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class that can provide for text, binary and Message Transmission Optimization Mechanism (MTOM) encoding:</span></span>  
  
-   <span data-ttu-id="e20be-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: Mais interoperável, mas o codificador menos eficiente para mensagens XML.</span><span class="sxs-lookup"><span data-stu-id="e20be-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: The most interoperable, but the least efficient encoder for XML messages.</span></span> <span data-ttu-id="e20be-130">Um cliente de serviço Web ou serviço Web geralmente pode entender XML textual.</span><span class="sxs-lookup"><span data-stu-id="e20be-130">A Web service or Web service client can generally understand textual XML.</span></span> <span data-ttu-id="e20be-131">No entanto, não é eficiente transmitir grandes blocos de dados binários como texto.</span><span class="sxs-lookup"><span data-stu-id="e20be-131">However, transmitting large blocks of binary data as text is not efficient.</span></span>  
  
-   <span data-ttu-id="e20be-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>Representa o elemento de associação que especifica a codificação de caracteres e versionamento de mensagens utilizados para mensagens XML baseadas em binário.</span><span class="sxs-lookup"><span data-stu-id="e20be-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for binary-based XML messages.</span></span> <span data-ttu-id="e20be-133">Isso é mais eficiente das opções de codificação, mas menos interoperável, porque ele é suportado somente pelo [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="e20be-133">This is most efficient of the encoding options, but the least interoperable, because it is only supported by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoints.</span></span>  
  
-   <span data-ttu-id="e20be-134"><<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement -->`System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`>: representa o elemento de associação que especifica a codificação de caracteres e versionamento de mensagem usado para uma mensagem usando uma codificação de mecanismo de otimização de transmissão da mensagem (MTOM).</span><span class="sxs-lookup"><span data-stu-id="e20be-134"><<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`>: Represents the binding element that specifies the character encoding and message versioning used for a message using a Message Transmission Optimization Mechanism (MTOM) encoding.</span></span> <span data-ttu-id="e20be-135">MTOM é uma tecnologia eficiente para transmitir dados binários em [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] mensagens.</span><span class="sxs-lookup"><span data-stu-id="e20be-135">MTOM is an efficient technology for transmitting binary data in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] messages.</span></span> <span data-ttu-id="e20be-136">O codificador MTOM tenta equilíbrio entre eficiência e interoperabilidade.</span><span class="sxs-lookup"><span data-stu-id="e20be-136">The MTOM encoder attempts to balance between efficiency and interoperability.</span></span> <span data-ttu-id="e20be-137">A codificação de MTOM transmite a maioria dos XML no formato textual, mas otimiza o transmiti-los como blocos grandes de dados binários-é, sem conversão de texto.</span><span class="sxs-lookup"><span data-stu-id="e20be-137">The MTOM encoding transmits most XML in textual form, but optimizes large blocks of binary data by transmitting them as-is, without conversion to text.</span></span>  
  
 <span data-ttu-id="e20be-138">O elemento de associação cria um binário, MTOM ou texto <xref:System.ServiceModel.Channels.MessageEncoderFactory>.</span><span class="sxs-lookup"><span data-stu-id="e20be-138">The binding element creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory>.</span></span> <span data-ttu-id="e20be-139">A fábrica cria um binário, MTOM ou texto <xref:System.ServiceModel.Channels.MessageEncoderFactory> instância.</span><span class="sxs-lookup"><span data-stu-id="e20be-139">The factory creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory> instance.</span></span> <span data-ttu-id="e20be-140">Normalmente, há apenas uma única instância.</span><span class="sxs-lookup"><span data-stu-id="e20be-140">Typically, there is only a single instance.</span></span> <span data-ttu-id="e20be-141">No entanto se sessões forem usadas, um codificador diferente pode ser fornecido para cada sessão.</span><span class="sxs-lookup"><span data-stu-id="e20be-141">However if sessions are used, a different encoder may be provided to each session.</span></span> <span data-ttu-id="e20be-142">O codificador binário usa isso para coordenar dicionários dinâmicos (consulte a infraestrutura de XML).</span><span class="sxs-lookup"><span data-stu-id="e20be-142">The Binary encoder makes use of this to coordinate dynamic dictionaries (see XML Infrastructure).</span></span>  
  
 <span data-ttu-id="e20be-143">O <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> e <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> métodos são o núcleo dos codificadores.</span><span class="sxs-lookup"><span data-stu-id="e20be-143">The <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> and <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> methods are the core of the encoders.</span></span> <span data-ttu-id="e20be-144">Fornecem os métodos para ler uma mensagem de um fluxo ou de um <xref:System.Byte> matriz.</span><span class="sxs-lookup"><span data-stu-id="e20be-144">The methods provide for reading a message from a stream or from a <xref:System.Byte> array.</span></span> <span data-ttu-id="e20be-145">Matrizes de bytes são usados quando o transporte está operando no modo de buffer.</span><span class="sxs-lookup"><span data-stu-id="e20be-145">Byte arrays are used when the transport is operating in buffered mode.</span></span> <span data-ttu-id="e20be-146">Mensagens sempre são gravadas em fluxos.</span><span class="sxs-lookup"><span data-stu-id="e20be-146">Messages are always written to streams.</span></span> <span data-ttu-id="e20be-147">Se o transporte deve buffer de mensagem, ele fornece um fluxo que realiza o buffer.</span><span class="sxs-lookup"><span data-stu-id="e20be-147">If the transport must buffer the message, it provides a stream that does the buffering.</span></span>  
  
 <span data-ttu-id="e20be-148">O restante dos membros a trabalhar com o suporte ao conteúdo, tipos de mídia, e <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span><span class="sxs-lookup"><span data-stu-id="e20be-148">The rest of the members work with support content, media types, and <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span></span> <span data-ttu-id="e20be-149">O transporte chama esses métodos de codificador para testar se a mensagem de entrada pode ser decodificada por ele, ou para determinar se a mensagem de saída é válida para este codificador.</span><span class="sxs-lookup"><span data-stu-id="e20be-149">The transport calls these encoder methods to test whether the incoming message can be decoded by it, or to determine if the outgoing message is valid for this encoder.</span></span>  
  
 <span data-ttu-id="e20be-150">Cada um dos três implementações de codificador adiciona propriedades que são relevantes para as codificações específicas e é completamente configurável.</span><span class="sxs-lookup"><span data-stu-id="e20be-150">Each of the three encoder implementations adds properties that are relevant to the specific encodings and is fully configurable.</span></span> <span data-ttu-id="e20be-151">Os codificadores também expõem cotas leitor que têm padrões seguros.</span><span class="sxs-lookup"><span data-stu-id="e20be-151">The encoders also expose reader quotas that have secure defaults.</span></span> <span data-ttu-id="e20be-152">Consulte infraestrutura XML para uma discussão sobre as cotas.</span><span class="sxs-lookup"><span data-stu-id="e20be-152">See XML Infrastructure for a discussion of the quotas.</span></span>  
  
## <a name="features-of-system-provided-encoders"></a><span data-ttu-id="e20be-153">Recursos de codificadores fornecido pelo sistema</span><span class="sxs-lookup"><span data-stu-id="e20be-153">Features of System-Provided Encoders</span></span>  
 <span data-ttu-id="e20be-154">Há um número de recursos fornecidos pelos codificadores fornecido pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="e20be-154">There are a number of features provided by the system-provided encoders.</span></span>  
  
### <a name="pooling"></a><span data-ttu-id="e20be-155">Agrupamento</span><span class="sxs-lookup"><span data-stu-id="e20be-155">Pooling</span></span>  
 <span data-ttu-id="e20be-156">Cada uma das implementações do codificador tenta pool tanto quanto possível.</span><span class="sxs-lookup"><span data-stu-id="e20be-156">Each of the encoder implementations tries to pool as much as possible.</span></span> <span data-ttu-id="e20be-157">Reduzir as alocações é uma maneira de chave para melhorar o desempenho do código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="e20be-157">Reducing allocations is a key way to improve the performance of managed code.</span></span> <span data-ttu-id="e20be-158">Para executar este pool, usam as implementações de `SynchronizedPool` classe.</span><span class="sxs-lookup"><span data-stu-id="e20be-158">To accomplish this pooling, the implementations use the `SynchronizedPool` class.</span></span> <span data-ttu-id="e20be-159">O arquivo c# contém uma descrição das otimizações adicionais usados por esta classe.</span><span class="sxs-lookup"><span data-stu-id="e20be-159">The C# file contains a description of the additional optimizations used by this class.</span></span>  
  
 <span data-ttu-id="e20be-160">`XmlDictionaryReader`e `XmlDictionaryWriter` instâncias são agrupadas e reinicializadas para evitar a alocar novos para cada mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-160">`XmlDictionaryReader` and `XmlDictionaryWriter` instances are pooled and reinitialized to prevent allocating new ones for each message.</span></span> <span data-ttu-id="e20be-161">Para os leitores, um `OnClose` o leitor recupera o retorno de chamada quando `Close()` é chamado.</span><span class="sxs-lookup"><span data-stu-id="e20be-161">For the readers, an `OnClose` callback reclaims the reader when `Close()` is called.</span></span> <span data-ttu-id="e20be-162">O codificador recicla também alguns objetos de estado de mensagem usados durante a construção de mensagens.</span><span class="sxs-lookup"><span data-stu-id="e20be-162">The encoder also recycles some message state objects used when constructing messages.</span></span> <span data-ttu-id="e20be-163">Os tamanhos desses pools são configuráveis pelo `MaxReadPoolSize` e `MaxWritePoolSize` propriedades em cada uma das três classes derivadas de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="e20be-163">The sizes of these pools are configurable by the `MaxReadPoolSize` and `MaxWritePoolSize` properties on each of the three classes derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
### <a name="binary-encoding"></a><span data-ttu-id="e20be-164">Codificação binária</span><span class="sxs-lookup"><span data-stu-id="e20be-164">Binary Encoding</span></span>  
 <span data-ttu-id="e20be-165">Quando usa sessões de codificação binária, a cadeia de caracteres de dicionário dinâmico deve ser comunicada ao destinatário da mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-165">When binary encoding uses sessions, the dynamic dictionary string must be communicated to the receiver of the message.</span></span> <span data-ttu-id="e20be-166">Isso é feito, prefixando a mensagem com as cadeias de caracteres de dicionário dinâmico.</span><span class="sxs-lookup"><span data-stu-id="e20be-166">This is done by prefixing the message with the dynamic dictionary strings.</span></span> <span data-ttu-id="e20be-167">O receptor ignora as cadeias de caracteres, adiciona à sessão e processa a mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-167">The receiver strips off the strings, adds them to the session, and processes the message.</span></span> <span data-ttu-id="e20be-168">Corretamente passar cadeias de caracteres de dicionário requer que o transporte de buffer.</span><span class="sxs-lookup"><span data-stu-id="e20be-168">Correctly passing dictionary strings requires that the transport be buffered.</span></span>  
  
 <span data-ttu-id="e20be-169">As cadeias de caracteres são anexadas à mensagem pelo interno `AddSessionInformationToMessage` método.</span><span class="sxs-lookup"><span data-stu-id="e20be-169">The strings are appended to the message by an internal `AddSessionInformationToMessage` method.</span></span> <span data-ttu-id="e20be-170">Ele adiciona as cadeias de caracteres UTF-8 para a frente da mensagem prefixada com seu comprimento.</span><span class="sxs-lookup"><span data-stu-id="e20be-170">It adds the strings as UTF-8 to the front of the message prefixed with their length.</span></span> <span data-ttu-id="e20be-171">O cabeçalho do dicionário inteiro, em seguida, é prefixado com o tamanho de seus dados.</span><span class="sxs-lookup"><span data-stu-id="e20be-171">The entire dictionary header is then prefixed with the length of its data.</span></span> <span data-ttu-id="e20be-172">A operação inversa é executada por interno `ExtractSessionInformationFromMessage` método.</span><span class="sxs-lookup"><span data-stu-id="e20be-172">The reverse operation is performed by an internal `ExtractSessionInformationFromMessage` method.</span></span>  
  
 <span data-ttu-id="e20be-173">Além de chaves do dicionário dinâmico de processamento, mensagens em buffer de sessão são recebidas de uma maneira exclusiva.</span><span class="sxs-lookup"><span data-stu-id="e20be-173">In addition to processing dynamic dictionary keys, buffered sessionful messages are received in a unique way.</span></span> <span data-ttu-id="e20be-174">Em vez de criar um leitor sobre o documento e processá-la, o codificador binário usa interno `MessagePatterns` classe para decompor o fluxo binário.</span><span class="sxs-lookup"><span data-stu-id="e20be-174">Instead of creating a reader over the document and processing it, the binary encoder uses the internal `MessagePatterns` class to deconstruct the binary stream.</span></span> <span data-ttu-id="e20be-175">A ideia é que a maioria das mensagens têm um determinado conjunto de cabeçalhos que aparecem em uma determinada ordem quando gerados pelo [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e20be-175">The idea is that most messages have a certain set of headers that show up in a certain order when generated by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span> <span data-ttu-id="e20be-176">O sistema padrão quebra a mensagem separadas com base no qual ele espera.</span><span class="sxs-lookup"><span data-stu-id="e20be-176">The pattern system breaks the message apart based on what it expects.</span></span> <span data-ttu-id="e20be-177">Se for bem-sucedido, ele inicializa um <xref:System.ServiceModel.Channels.MessageHeaders> objeto sem analisar o XML.</span><span class="sxs-lookup"><span data-stu-id="e20be-177">If it is successful, it initializes a <xref:System.ServiceModel.Channels.MessageHeaders> object without parsing the XML.</span></span> <span data-ttu-id="e20be-178">Caso contrário, ele reverterá para o método padrão.</span><span class="sxs-lookup"><span data-stu-id="e20be-178">If not, it falls back to the standard method.</span></span>  
  
### <a name="mtom-encoding"></a><span data-ttu-id="e20be-179">Codificação de MTOM</span><span class="sxs-lookup"><span data-stu-id="e20be-179">MTOM Encoding</span></span>  
 <span data-ttu-id="e20be-180">O <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`> classe tem uma propriedade de configuração adicional chamada <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`. MaxBufferSize % 2A >.</span><span class="sxs-lookup"><span data-stu-id="e20be-180">The <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`> class has an additional configuration property called <<!--zz xref:System.ServiceModel.Channels.MTOMMessageEncodingBindingElement --> `System.ServiceModel.Channels.MTOMMessageEncodingBindingElement`.MaxBufferSize%2A>.</span></span> <span data-ttu-id="e20be-181">Isso coloca um limite superior no quanto dados é permitido para armazenar em buffer durante o processo de leitura de uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-181">This places an upper bound on how much data it is allowed to buffer during the process of reading a message.</span></span> <span data-ttu-id="e20be-182">O XML informações definidas (Infoset) ou outras partes MIME, talvez precise ser armazenado em buffer para remontar todas as partes MIME em uma única mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-182">The XML Information Set (Infoset), or other MIME parts, may need to be buffered to reassemble all the MIME parts into a single message.</span></span>  
  
 <span data-ttu-id="e20be-183">Para funcionar corretamente com HTTP, a classe de codificador de mensagem MTOM interna fornece algumas APIs interno de `GetContentType` (que também é interno) e `WriteMessage`, que é pública e pode ser substituído.</span><span class="sxs-lookup"><span data-stu-id="e20be-183">To work correctly with HTTP, the internal MTOM message encoder class provides some internal APIs for `GetContentType` (which is also internal) and `WriteMessage`, which is public and can be overridden.</span></span> <span data-ttu-id="e20be-184">Mais de comunicação deve ocorrer para garantir que os valores nos cabeçalhos HTTP concordam com os valores de cabeçalhos MIME.</span><span class="sxs-lookup"><span data-stu-id="e20be-184">More communication must occur to ensure values in the HTTP headers agree with values in the MIME headers.</span></span>  
  
 <span data-ttu-id="e20be-185">Internamente, o codificador de mensagem MTOM usa [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]do leitores de texto e é semelhante para o codificador de texto.</span><span class="sxs-lookup"><span data-stu-id="e20be-185">Internally, the MTOM message encoder uses [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]'s text readers, and is similar to the Text encoder.</span></span> <span data-ttu-id="e20be-186">A principal diferença é que ele otimiza a grandes blocos de binário ou "binário" BLOBs (objetos grandes), por não convertê-las para codificação de Base 64 antes de ser incorporada em bytes de mensagem.</span><span class="sxs-lookup"><span data-stu-id="e20be-186">The main difference is that it optimizes large chunks of binary, or "Binary Large Objects" (BLOBs), by not converting them to Base-64 encoding prior to being embedded into the message bytes.</span></span> <span data-ttu-id="e20be-187">Em vez disso, esses BLOBs são mantidas extraídos e referenciado como os anexos de MIME.</span><span class="sxs-lookup"><span data-stu-id="e20be-187">Instead, these BLOBs are kept extracted, and referenced as the MIME attachments.</span></span>  
  
## <a name="writing-your-own-encoder"></a><span data-ttu-id="e20be-188">Escrevendo seu próprio codificador</span><span class="sxs-lookup"><span data-stu-id="e20be-188">Writing your own Encoder</span></span>  
 <span data-ttu-id="e20be-189">Para implementar seu próprio codificador de mensagem personalizada, você deve fornecer implementações personalizadas das seguintes classes de base abstratas:</span><span class="sxs-lookup"><span data-stu-id="e20be-189">To implement your own custom message encoder, you must provide custom implementations of the following abstract base classes:</span></span>  
  
-   <xref:System.ServiceModel.Channels.MessageEncoder>  
  
-   <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
  
-   <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
  
 <span data-ttu-id="e20be-190">Conversão da representação na memória de uma mensagem em uma representação que pode ser gravada em um fluxo é encapsulado dentro de <xref:System.ServiceModel.Channels.MessageEncoder> classe, que serve como uma fábrica para leitores XML e os gravadores XML que oferecem suporte a tipos específicos de codificações XML.</span><span class="sxs-lookup"><span data-stu-id="e20be-190">Converting from the in-memory representation of a message to a representation that can be written to a stream is encapsulated within the <xref:System.ServiceModel.Channels.MessageEncoder> class, which serves as a factory for XML readers and XML writers that support specific types of XML encodings.</span></span>  
  
-   <span data-ttu-id="e20be-191">Os principais métodos dessa classe que você deve substituir são:</span><span class="sxs-lookup"><span data-stu-id="e20be-191">The key methods of this class that you must override are:</span></span>  
  
-   <span data-ttu-id="e20be-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A>qual toma uma <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> do objeto e grava-o em um <xref:System.IO.Stream> objeto.</span><span class="sxs-lookup"><span data-stu-id="e20be-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> which takes a <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> object and writes it into a <xref:System.IO.Stream> object.</span></span>  
  
-   <span data-ttu-id="e20be-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A>qual toma uma <xref:System.IO.Stream> objeto e um tamanho máximo do cabeçalho e retorna um <xref:System.ServiceModel.Channels.Message> objeto.</span><span class="sxs-lookup"><span data-stu-id="e20be-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> which takes a <xref:System.IO.Stream> object and a maximum header size and returns a <xref:System.ServiceModel.Channels.Message> object.</span></span>  
  
 <span data-ttu-id="e20be-194">É o código escrito em métodos que manipula a conversão entre o protocolo de transporte padrão e a codificação personalizada.</span><span class="sxs-lookup"><span data-stu-id="e20be-194">It is the code you write in these methods that handles conversion between the standard transport protocol, and your customized encoding.</span></span>  
  
 <span data-ttu-id="e20be-195">Em seguida, você precisa codificar uma classe de fábrica que cria seu codificador personalizado.</span><span class="sxs-lookup"><span data-stu-id="e20be-195">Next you need to code a factory class that creates your custom encoder.</span></span> <span data-ttu-id="e20be-196">Substituir o <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> para retornar uma instância de personalizados <xref:System.ServiceModel.Channels.MessageEncoder>.</span><span class="sxs-lookup"><span data-stu-id="e20be-196">Override the <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> to return an instance of your custom <xref:System.ServiceModel.Channels.MessageEncoder>.</span></span>  
  
 <span data-ttu-id="e20be-197">Conecte-se e personalizados <xref:System.ServiceModel.Channels.MessageEncoderFactory> para a pilha do elemento de associação usada para configurar o serviço ou cliente, substituindo o <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> método para retornar uma instância dessa fábrica.</span><span class="sxs-lookup"><span data-stu-id="e20be-197">Then connect your custom <xref:System.ServiceModel.Channels.MessageEncoderFactory> to the binding element stack used to configure the service or client by overriding the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> method to return an instance of this factory.</span></span>  
  
 <span data-ttu-id="e20be-198">Há dois exemplos fornecidos com [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] que ilustram o processo com o código de exemplo: [codificador de mensagem personalizado: codificador de texto personalizado](../../../../docs/framework/wcf/samples/custom-message-encoder-custom-text-encoder.md) e [codificador de mensagem personalizado: codificador de compactação](../../../../docs/framework/wcf/samples/custom-message-encoder-compression-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="e20be-198">There are two samples provided with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] that illustrate this process with sample code: [Custom Message Encoder: Custom Text Encoder](../../../../docs/framework/wcf/samples/custom-message-encoder-custom-text-encoder.md) and [Custom Message Encoder: Compression Encoder](../../../../docs/framework/wcf/samples/custom-message-encoder-compression-encoder.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e20be-199">Consulte também</span><span class="sxs-lookup"><span data-stu-id="e20be-199">See Also</span></span>  
 <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
 <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
 <xref:System.ServiceModel.Channels.MessageEncoder>  
 [<span data-ttu-id="e20be-200">Visão geral da arquitetura de transferência de dados</span><span class="sxs-lookup"><span data-stu-id="e20be-200">Data Transfer Architectural Overview</span></span>](../../../../docs/framework/wcf/feature-details/data-transfer-architectural-overview.md)  
 [<span data-ttu-id="e20be-201">Escolhendo um codificador de mensagem</span><span class="sxs-lookup"><span data-stu-id="e20be-201">Choosing a Message Encoder</span></span>](../../../../docs/framework/wcf/feature-details/choosing-a-message-encoder.md)  
 [<span data-ttu-id="e20be-202">Selecionando um transporte</span><span class="sxs-lookup"><span data-stu-id="e20be-202">Choosing a Transport</span></span>](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)
