---
title: 'Como: Alterar o provedor criptográfico para a chave privada de um certificado X.509'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
ms.openlocfilehash: 4e11dd90d1cc57f3f2f559c22e1548b8fbcedaea
ms.sourcegitcommit: af0a22a4eb11bbcd33baec49150d551955b50a16
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/14/2019
ms.locfileid: "56261906"
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificates-private-key"></a><span data-ttu-id="e363b-102">Como: Alterar o provedor criptográfico para a chave privada de um certificado X.509</span><span class="sxs-lookup"><span data-stu-id="e363b-102">How to: Change the Cryptographic Provider for an X.509 Certificate's Private Key</span></span>
<span data-ttu-id="e363b-103">Este tópico mostra como alterar o provedor criptográfico usado para fornecer a chave privada de um certificado X.509 e como integrar o provedor a estrutura de segurança do Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="e363b-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the Windows Communication Foundation (WCF) security framework.</span></span> <span data-ttu-id="e363b-104">Para obter mais informações sobre como usar certificados, consulte [trabalhando com certificados](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="e363b-104">For more information about using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="e363b-105">A estrutura de segurança do WCF fornece uma maneira de introduzir novos tipos de token de segurança, conforme descrito em [como: Criar um Token personalizado](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="e363b-105">The WCF security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="e363b-106">Também é possível usar um token personalizado para substituir tipos de token fornecido pelo sistema existentes.</span><span class="sxs-lookup"><span data-stu-id="e363b-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="e363b-107">Neste tópico, o token de segurança X.509 fornecido pelo sistema é substituído por um token X.509 personalizado que fornece uma implementação diferente da chave privada do certificado.</span><span class="sxs-lookup"><span data-stu-id="e363b-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="e363b-108">Isso é útil em cenários onde a chave privada real é fornecida por um provedor criptográfico diferente que o provedor de criptografia do Windows padrão.</span><span class="sxs-lookup"><span data-stu-id="e363b-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="e363b-109">Um exemplo de um provedor criptográfico alternativo é um módulo de segurança de hardware que executa todas as privada chave relacionadas operações criptográficas e não armazena as chaves privadas na memória, o que melhora a segurança do sistema.</span><span class="sxs-lookup"><span data-stu-id="e363b-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="e363b-110">O exemplo a seguir é para fins de demonstração.</span><span class="sxs-lookup"><span data-stu-id="e363b-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="e363b-111">Ele não substitui o provedor criptográfico do Windows padrão, mas mostra onde esse provedor pode ser integrado.</span><span class="sxs-lookup"><span data-stu-id="e363b-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="e363b-112">Procedimentos</span><span class="sxs-lookup"><span data-stu-id="e363b-112">Procedures</span></span>  
 <span data-ttu-id="e363b-113">Cada token de segurança que tem uma chave de segurança associada ou chaves deve implementar o <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> propriedade, que retorna uma coleção de chaves da instância de token de segurança.</span><span class="sxs-lookup"><span data-stu-id="e363b-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="e363b-114">Se o token é um token de segurança X.509, a coleção contém uma única instância da <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> classe que representa as chaves públicas e privadas associadas ao certificado.</span><span class="sxs-lookup"><span data-stu-id="e363b-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="e363b-115">Para substituir o provedor de criptografia padrão usado para fornecer chaves do certificado, crie uma nova implementação dessa classe.</span><span class="sxs-lookup"><span data-stu-id="e363b-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="e363b-116">Para criar uma chave assimétrica de x. 509 personalizada</span><span class="sxs-lookup"><span data-stu-id="e363b-116">To create a custom X.509 asymmetric key</span></span>  
  
1.  <span data-ttu-id="e363b-117">Definir uma nova classe que deriva de <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> classe.</span><span class="sxs-lookup"><span data-stu-id="e363b-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2.  <span data-ttu-id="e363b-118">Substituir o <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> propriedade somente leitura.</span><span class="sxs-lookup"><span data-stu-id="e363b-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="e363b-119">Essa propriedade retorna o tamanho real da chave pública/privada do certificado par de chaves.</span><span class="sxs-lookup"><span data-stu-id="e363b-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3.  <span data-ttu-id="e363b-120">Substituir o método <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A>.</span><span class="sxs-lookup"><span data-stu-id="e363b-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="e363b-121">Esse método é chamado pela estrutura de segurança do WCF para descriptografar uma chave simétrica com a chave privada do certificado.</span><span class="sxs-lookup"><span data-stu-id="e363b-121">This method is called by the WCF security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="e363b-122">(A chave foi anteriormente criptografada com a chave pública do certificado.)</span><span class="sxs-lookup"><span data-stu-id="e363b-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4.  <span data-ttu-id="e363b-123">Substituir o método <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A>.</span><span class="sxs-lookup"><span data-stu-id="e363b-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="e363b-124">Esse método é chamado pela estrutura de segurança do WCF para obter uma instância da <xref:System.Security.Cryptography.AsymmetricAlgorithm> classe que representa o provedor criptográfico para as chaves do certificado público ou privado, dependendo dos parâmetros passados para o método.</span><span class="sxs-lookup"><span data-stu-id="e363b-124">This method is called by the WCF security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5.  <span data-ttu-id="e363b-125">Opcional.</span><span class="sxs-lookup"><span data-stu-id="e363b-125">Optional.</span></span> <span data-ttu-id="e363b-126">Substituir o método <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A>.</span><span class="sxs-lookup"><span data-stu-id="e363b-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="e363b-127">Substitua este método se uma implementação diferente de <xref:System.Security.Cryptography.HashAlgorithm> classe é necessária.</span><span class="sxs-lookup"><span data-stu-id="e363b-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6.  <span data-ttu-id="e363b-128">Substituir o método <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A>.</span><span class="sxs-lookup"><span data-stu-id="e363b-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="e363b-129">Esse método retorna uma instância do <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> classe que está associado com a chave privada do certificado.</span><span class="sxs-lookup"><span data-stu-id="e363b-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7.  <span data-ttu-id="e363b-130">Substituir o método <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A>.</span><span class="sxs-lookup"><span data-stu-id="e363b-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="e363b-131">Esse método é usado para indicar se um determinado algoritmo criptográfico é compatível com a implementação de chave de segurança.</span><span class="sxs-lookup"><span data-stu-id="e363b-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="e363b-132">O procedimento a seguir mostra como integrar o a x. 509 assimétrica de segurança chave implementação personalizada criada no procedimento anterior com a estrutura de segurança do WCF para substituir a segurança X.509 fornecido pelo sistema token.</span><span class="sxs-lookup"><span data-stu-id="e363b-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the WCF security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="e363b-133">Para substituir o token de segurança X.509 fornecido pelo sistema com um token de chave de segurança assimétricas de x. 509</span><span class="sxs-lookup"><span data-stu-id="e363b-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1.  <span data-ttu-id="e363b-134">Crie um token de segurança X.509 personalizado que retorna a chave assimétrica de segurança de x. 509 personalizada em vez da chave de segurança fornecida pelo sistema, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e363b-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="e363b-135">Para obter mais informações sobre tokens de segurança personalizada, consulte [como: Criar um Token personalizado](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="e363b-135">For more information about custom security tokens, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2.  <span data-ttu-id="e363b-136">Crie um provedor de token de segurança personalizada que retorna um token de segurança X.509 personalizado, conforme mostrado no exemplo.</span><span class="sxs-lookup"><span data-stu-id="e363b-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="e363b-137">Para obter mais informações sobre provedores de token de segurança personalizada, consulte [como: Criar um provedor de Token de segurança personalizada](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="e363b-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3.  <span data-ttu-id="e363b-138">Se a chave de segurança personalizada precisa ser usado no lado do iniciador, crie um cliente personalizado Gerenciador de token de segurança e as classes de credenciais de cliente personalizado, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e363b-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="e363b-139">Para obter mais informações sobre credenciais personalizadas do cliente e os gerentes de token de segurança de cliente, consulte [passo a passo: Criação de credenciais de serviço e personalizadas do cliente](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="e363b-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4.  <span data-ttu-id="e363b-140">Se a chave de segurança personalizada precisa ser usado no lado do destinatário, crie um Gerenciador de token de segurança do serviço personalizado e credenciais de serviço personalizado, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e363b-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="e363b-141">Para obter mais informações sobre credenciais de serviço personalizado e gerentes de token de segurança do serviço, consulte [passo a passo: Criação de credenciais de serviço e personalizadas do cliente](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="e363b-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="e363b-142">Consulte também</span><span class="sxs-lookup"><span data-stu-id="e363b-142">See also</span></span>
- <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.SecurityKey>
- <xref:System.Security.Cryptography.AsymmetricAlgorithm>
- <xref:System.Security.Cryptography.HashAlgorithm>
- <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>
- [<span data-ttu-id="e363b-143">Passo a passo: Criação de credenciais de serviço e personalizadas do cliente</span><span class="sxs-lookup"><span data-stu-id="e363b-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="e363b-144">Como: Criar um autenticador de Token de segurança personalizadas</span><span class="sxs-lookup"><span data-stu-id="e363b-144">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="e363b-145">Como: Criar um provedor de Token de segurança personalizadas</span><span class="sxs-lookup"><span data-stu-id="e363b-145">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="e363b-146">Como: Criar um Token personalizado</span><span class="sxs-lookup"><span data-stu-id="e363b-146">How to: Create a Custom Token</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)
