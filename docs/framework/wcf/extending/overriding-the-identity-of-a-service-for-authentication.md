---
title: Substituindo a identidade de um serviço pela autenticação
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: 29529115847950dcaba255b0740bc5014557244f
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64635715"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="d03d1-102">Substituindo a identidade de um serviço pela autenticação</span><span class="sxs-lookup"><span data-stu-id="d03d1-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="d03d1-103">Normalmente, você não precisa definir a identidade em um serviço, pois a seleção de um tipo de credencial de cliente determina o tipo de identidade exposto nos metadados de serviço.</span><span class="sxs-lookup"><span data-stu-id="d03d1-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="d03d1-104">Por exemplo, o código de configuração a seguir usa o [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) elemento e define o `clientCredentialType` de atributo para Windows.</span><span class="sxs-lookup"><span data-stu-id="d03d1-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  

 <span data-ttu-id="d03d1-105">O fragmento de descrição linguagem WSDL (Web Services) a seguir mostra a identidade para o ponto de extremidade definido anteriormente.</span><span class="sxs-lookup"><span data-stu-id="d03d1-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="d03d1-106">Neste exemplo, o serviço é executado como um serviço auto-hospedado em uma conta de usuário específico (username@contoso.com) e, portanto, a identidade de nome principal (UPN) do usuário contém o nome da conta.</span><span class="sxs-lookup"><span data-stu-id="d03d1-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="d03d1-107">O UPN é também conhecido como o nome de logon do usuário em um domínio do Windows.</span><span class="sxs-lookup"><span data-stu-id="d03d1-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  

 <span data-ttu-id="d03d1-108">Para um aplicativo de exemplo que demonstra a configuração de identidade, consulte [exemplo de identidade de serviço](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="d03d1-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="d03d1-109">Para obter mais informações sobre a identidade de serviço, consulte [identidade de serviço e autenticação](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="d03d1-109">For more information about service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="d03d1-110">Identidade e autenticação Kerberos</span><span class="sxs-lookup"><span data-stu-id="d03d1-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="d03d1-111">Por padrão, quando um serviço é configurado para usar uma credencial do Windows, uma [ \<identidade >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) elemento que contém um [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) ou [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) elemento é gerado no WSDL.</span><span class="sxs-lookup"><span data-stu-id="d03d1-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="d03d1-112">Se o serviço está sendo executado o `LocalSystem`, `LocalService`, ou `NetworkService` conta, um serviço (SPN) nome da entidade é gerado por padrão na forma de `host/` \< *hostname*> porque Essas contas tenham acesso aos dados SPN do computador.</span><span class="sxs-lookup"><span data-stu-id="d03d1-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="d03d1-113">Se o serviço está em execução em uma conta diferente, o Windows Communication Foundation (WCF) gera um UPN no formato \< *nome de usuário*>@<*domainName* `>` .</span><span class="sxs-lookup"><span data-stu-id="d03d1-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="d03d1-114">Isso ocorre porque a autenticação Kerberos requer que um nome UPN ou um SPN fornecido ao cliente para autenticar o serviço.</span><span class="sxs-lookup"><span data-stu-id="d03d1-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="d03d1-115">Você também pode usar a ferramenta Setspn.exe para registrar um SPN adicional com uma conta de serviço em um domínio.</span><span class="sxs-lookup"><span data-stu-id="d03d1-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="d03d1-116">Em seguida, você pode usar o SPN como a identidade do serviço.</span><span class="sxs-lookup"><span data-stu-id="d03d1-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="d03d1-117">Para baixar a ferramenta, consulte [ferramenta do Windows 2000 Resource Kit: Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="d03d1-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="d03d1-118">Para obter mais informações sobre a ferramenta, consulte [visão geral do Setspn](https://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="d03d1-118">For more information about the tool, see [Setspn Overview](https://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d03d1-119">Para usar o tipo de credencial do Windows sem negociação, a conta de usuário do serviço deve ter acesso para o SPN está registrado com o domínio do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d03d1-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="d03d1-120">Você pode fazer isso das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="d03d1-120">You can do this in the following ways:</span></span>  
  
- <span data-ttu-id="d03d1-121">Use a conta NetworkService ou LocalSystem para executar seu serviço.</span><span class="sxs-lookup"><span data-stu-id="d03d1-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="d03d1-122">Como essas contas têm acesso ao computador do SPN é estabelecido quando o computador ingressa no domínio do Active Directory, o WCF gera automaticamente o elemento SPN apropriado dentro do ponto de extremidade de serviço nos metadados do serviço (WSDL).</span><span class="sxs-lookup"><span data-stu-id="d03d1-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
- <span data-ttu-id="d03d1-123">Use uma conta de domínio do Active Directory arbitrária para executar seu serviço.</span><span class="sxs-lookup"><span data-stu-id="d03d1-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="d03d1-124">Nesse caso, estabelece um SPN para essa conta de domínio, que pode ser feito usando a ferramenta de utilitário Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="d03d1-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="d03d1-125">Depois de criar o SPN para a conta de serviço, configure o WCF para publicar esse SPN aos clientes do serviço por meio de seus metadados (WSDL).</span><span class="sxs-lookup"><span data-stu-id="d03d1-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="d03d1-126">Isso é feito definindo a identidade do ponto de extremidade para o ponto de extremidade exposto, por meio de um arquivo de configuração de aplicativo ou código.</span><span class="sxs-lookup"><span data-stu-id="d03d1-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="d03d1-127">Para obter mais informações sobre SPNs, o protocolo Kerberos e do Active Directory, consulte [Kerberos técnica suplementar para Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="d03d1-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="d03d1-128">Quando SPN ou UPN é igual a cadeia de caracteres vazia</span><span class="sxs-lookup"><span data-stu-id="d03d1-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="d03d1-129">Se você definir o SPN ou UPN igual a uma cadeia de caracteres vazia, uma série de coisas diferentes acontece, dependendo do modo de autenticação e nível de segurança que está sendo usado:</span><span class="sxs-lookup"><span data-stu-id="d03d1-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
- <span data-ttu-id="d03d1-130">Se você estiver usando a segurança em nível de transporte, autenticação NT LanMan (NTLM) será escolhida.</span><span class="sxs-lookup"><span data-stu-id="d03d1-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
- <span data-ttu-id="d03d1-131">Se você estiver usando a segurança em nível de mensagem, a autenticação pode falhar, dependendo do modo de autenticação:</span><span class="sxs-lookup"><span data-stu-id="d03d1-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
- <span data-ttu-id="d03d1-132">Se você estiver usando `spnego` modo e o `AllowNtlm` atributo é definido como `false`, falha de autenticação.</span><span class="sxs-lookup"><span data-stu-id="d03d1-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
- <span data-ttu-id="d03d1-133">Se você estiver usando `spnego` modo e o `AllowNtlm` atributo é definido como `true`, a autenticação falhará se o UPN está vazio, mas terá êxito se o SPN está vazio.</span><span class="sxs-lookup"><span data-stu-id="d03d1-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
- <span data-ttu-id="d03d1-134">Se você estiver usando o Kerberos direto (também conhecido como "monoestável"), a autenticação falhará.</span><span class="sxs-lookup"><span data-stu-id="d03d1-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="d03d1-135">Usando o \<identidade > elemento na configuração</span><span class="sxs-lookup"><span data-stu-id="d03d1-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="d03d1-136">Se você alterar o tipo de credencial de cliente na associação mostrada anteriormente ao certificado`,` WSDL gerado contém uma Base64 serializada certificado x. 509 para o valor de identidade, conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="d03d1-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="d03d1-137">Esse é o padrão para todos os tipos de credencial de cliente que não sejam Windows.</span><span class="sxs-lookup"><span data-stu-id="d03d1-137">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="d03d1-138">Você pode alterar o valor de identidade do serviço padrão ou alterar o tipo de identidade usando o <`identity`> elemento na configuração ou definindo a identidade no código.</span><span class="sxs-lookup"><span data-stu-id="d03d1-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="d03d1-139">O código de configuração a seguir define uma identidade do DNS (sistema) do nome de domínio com o valor `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="d03d1-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

### <a name="setting-identity-programmatically"></a><span data-ttu-id="d03d1-140">Definindo a identidade do forma programática</span><span class="sxs-lookup"><span data-stu-id="d03d1-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="d03d1-141">Seu serviço não precisa especificar explicitamente uma identidade, porque o WCF determina automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d03d1-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="d03d1-142">No entanto, o WCF permite que você especifique uma identidade de um ponto de extremidade, se necessário.</span><span class="sxs-lookup"><span data-stu-id="d03d1-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="d03d1-143">O código a seguir adiciona um novo ponto de extremidade de serviço com uma identidade específica do DNS.</span><span class="sxs-lookup"><span data-stu-id="d03d1-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="d03d1-144">Consulte também</span><span class="sxs-lookup"><span data-stu-id="d03d1-144">See also</span></span>

- [<span data-ttu-id="d03d1-145">Como: Criar um verificador de identidade do cliente personalizado</span><span class="sxs-lookup"><span data-stu-id="d03d1-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="d03d1-146">Autenticação e identidade de serviço</span><span class="sxs-lookup"><span data-stu-id="d03d1-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
