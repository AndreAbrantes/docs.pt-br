---
title: "Substituindo a identidade de um serviço pela autenticação"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: e1f8f6bd4d8661393bc849405a8668341f65f8d5
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="4acee-102">Substituindo a identidade de um serviço pela autenticação</span><span class="sxs-lookup"><span data-stu-id="4acee-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="4acee-103">Normalmente, você não precisa definir a identidade de um serviço porque a seleção de um tipo de credencial de cliente determina o tipo de identidade exposto nos metadados do serviço.</span><span class="sxs-lookup"><span data-stu-id="4acee-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="4acee-104">Por exemplo, o código de configuração a seguir usa o [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) elemento e define o `clientCredentialType` de atributo para o Windows.</span><span class="sxs-lookup"><span data-stu-id="4acee-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="4acee-105">O fragmento de WSDL Web Services Description Language () a seguir mostra a identidade do ponto de extremidade definida anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4acee-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="4acee-106">Neste exemplo, o serviço está em execução como um serviço auto-hospedado sob uma conta de usuário específica (username@contoso.com) e, portanto, a identidade do usuário principal (UPN) do nome contém o nome da conta.</span><span class="sxs-lookup"><span data-stu-id="4acee-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="4acee-107">O UPN é também conhecido como o nome de logon do usuário em um domínio do Windows.</span><span class="sxs-lookup"><span data-stu-id="4acee-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="4acee-108">Para um aplicativo de exemplo que mostra a configuração de identidade, consulte [exemplo de identidade de serviço](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="4acee-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="4acee-109">identidade de serviço, consulte [autenticação e identidade de serviço](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="4acee-109"> service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="4acee-110">Identidade e autenticação Kerberos</span><span class="sxs-lookup"><span data-stu-id="4acee-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="4acee-111">Por padrão, quando um serviço é configurado para usar uma credencial do Windows, um [ \<identidade >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) elemento que contém um [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) ou [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) elemento é gerado no WSDL.</span><span class="sxs-lookup"><span data-stu-id="4acee-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="4acee-112">Se o serviço está em execução sob o `LocalSystem`, `LocalService`, ou `NetworkService` conta, um serviço (SPN) nome da entidade é gerado por padrão na forma de `host/` \< *hostname*> porque Essas contas têm acesso aos dados SPN do computador.</span><span class="sxs-lookup"><span data-stu-id="4acee-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="4acee-113">Se o serviço está em execução em uma conta diferente, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] gera um UPN no formato \< *username*>@<*domainName*`>`.</span><span class="sxs-lookup"><span data-stu-id="4acee-113">If the service is running under a different account, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="4acee-114">Isso ocorre porque a autenticação Kerberos requer que um UPN ou um SPN fornecido ao cliente para autenticar o serviço.</span><span class="sxs-lookup"><span data-stu-id="4acee-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="4acee-115">Você também pode usar a ferramenta Setspn.exe para registrar um SPN adicional com uma conta de serviço em um domínio.</span><span class="sxs-lookup"><span data-stu-id="4acee-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="4acee-116">Você pode usar o SPN como a identidade do serviço.</span><span class="sxs-lookup"><span data-stu-id="4acee-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="4acee-117">Para baixar a ferramenta, consulte [Windows 2000 Resource Kit Tool: Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="4acee-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="4acee-118">a ferramenta, consulte [visão geral do Setspn](http://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="4acee-118"> the tool, see [Setspn Overview](http://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4acee-119">Para usar o tipo de credencial do Windows sem negociação, a conta de usuário do serviço deve ter acesso para o SPN está registrado com o domínio do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4acee-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="4acee-120">Você pode fazer isso das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="4acee-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="4acee-121">Use a conta NetworkService ou LocalSystem para executar o serviço.</span><span class="sxs-lookup"><span data-stu-id="4acee-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="4acee-122">Como essas contas têm acesso à máquina SPN é estabelecida quando o computador ingressa no domínio do Active Directory, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] gera automaticamente o elemento SPN apropriado dentro do ponto de extremidade do serviço nos metadados do serviço (WSDL).</span><span class="sxs-lookup"><span data-stu-id="4acee-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="4acee-123">Use uma conta de domínio do Active Directory arbitrária para executar o serviço.</span><span class="sxs-lookup"><span data-stu-id="4acee-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="4acee-124">Nesse caso, estabeleça um SPN para essa conta de domínio, que pode ser feito usando a ferramenta Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="4acee-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="4acee-125">Depois de criar o SPN para a conta de serviço, configurar [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] para publicar esse SPN para clientes do serviço por meio de seus metadados (WSDL).</span><span class="sxs-lookup"><span data-stu-id="4acee-125">Once you create the SPN for the service's account, configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="4acee-126">Isso é feito definindo-se a identidade do ponto de extremidade para o ponto de extremidade exposto, por meio de um arquivo de configuração do aplicativo ou código.</span><span class="sxs-lookup"><span data-stu-id="4acee-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="4acee-127">Os SPNs, o protocolo Kerberos e o Active Directory, consulte [Kerberos suplemento técnico para Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="4acee-127"> SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="4acee-128">Quando SPN ou UPN é igual a cadeia de caracteres vazia</span><span class="sxs-lookup"><span data-stu-id="4acee-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="4acee-129">Se você definir o SPN ou UPN igual a uma cadeia de caracteres vazia, várias coisas diferentes acontecem, dependendo do modo de autenticação e nível de segurança que está sendo usado:</span><span class="sxs-lookup"><span data-stu-id="4acee-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="4acee-130">Se você estiver usando a segurança em nível de transporte, autenticação NT LanMan (NTLM) é escolhida.</span><span class="sxs-lookup"><span data-stu-id="4acee-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="4acee-131">Se você estiver usando a segurança em nível de mensagem, a autenticação pode falhar, dependendo do modo de autenticação:</span><span class="sxs-lookup"><span data-stu-id="4acee-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="4acee-132">Se você estiver usando `spnego` modo e o `AllowNtlm` atributo é definido como `false`, falha de autenticação.</span><span class="sxs-lookup"><span data-stu-id="4acee-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="4acee-133">Se você estiver usando `spnego` modo e o `AllowNtlm` atributo é definido como `true`, a autenticação falhará se o UPN está vazio, mas terá êxito se o SPN está vazio.</span><span class="sxs-lookup"><span data-stu-id="4acee-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="4acee-134">Se você estiver usando o Kerberos diretamente (também conhecido como "todos"), a autenticação falhará.</span><span class="sxs-lookup"><span data-stu-id="4acee-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="4acee-135">Usando o \<identidade > elemento na configuração</span><span class="sxs-lookup"><span data-stu-id="4acee-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="4acee-136">Se você alterar o tipo de credencial de cliente na associação mostrada anteriormente ao certificado`,` , em seguida, o WSDL gerado contém uma Base64 serializado certificado x. 509 para o valor de identidade, conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="4acee-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="4acee-137">Esse é o padrão para todos os tipos de credencial de cliente diferentes do Windows.</span><span class="sxs-lookup"><span data-stu-id="4acee-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="4acee-138">Você pode alterar o valor da identidade do serviço padrão ou alterar o tipo de identidade usando o <`identity`> elemento na configuração ou definindo a identidade no código.</span><span class="sxs-lookup"><span data-stu-id="4acee-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="4acee-139">O código de configuração a seguir define uma identidade do DNS (sistema) do nome de domínio com o valor `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="4acee-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="4acee-140">Definir a identidade por meio de programação</span><span class="sxs-lookup"><span data-stu-id="4acee-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="4acee-141">O serviço não precisa especificar explicitamente uma identidade, porque [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] determina automaticamente.</span><span class="sxs-lookup"><span data-stu-id="4acee-141">Your service does not have to explicitly specify an identity, because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically determines it.</span></span> <span data-ttu-id="4acee-142">No entanto, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] permite que você especifique uma identidade em um ponto de extremidade, se necessário.</span><span class="sxs-lookup"><span data-stu-id="4acee-142">However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="4acee-143">O código a seguir adiciona um novo ponto de extremidade de serviço com uma identidade específica de DNS.</span><span class="sxs-lookup"><span data-stu-id="4acee-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="4acee-144">Consulte também</span><span class="sxs-lookup"><span data-stu-id="4acee-144">See Also</span></span>  
 [<span data-ttu-id="4acee-145">Como criar um verificador de identidade de cliente personalizado</span><span class="sxs-lookup"><span data-stu-id="4acee-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)  
 [<span data-ttu-id="4acee-146">Autenticação e identidade de serviço</span><span class="sxs-lookup"><span data-stu-id="4acee-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
