---
title: Como importar asserções de políticas personalizadas
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: ed8aae30875e3b17f65be5857c7d93af98db9b3e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185561"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="c34ad-102">Como importar asserções de políticas personalizadas</span><span class="sxs-lookup"><span data-stu-id="c34ad-102">How to: Import Custom Policy Assertions</span></span>
<span data-ttu-id="c34ad-103">As afirmações de políticas descrevem os recursos e requisitos de um ponto final de serviço.</span><span class="sxs-lookup"><span data-stu-id="c34ad-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="c34ad-104">Os aplicativos clientes podem usar afirmações de políticas em metadados de serviço para configurar a vinculação do cliente ou personalizar o contrato de serviço para um ponto final de serviço.</span><span class="sxs-lookup"><span data-stu-id="c34ad-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="c34ad-105">As afirmações de diretiva personalizadas <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> são importadas implementando a interface e passando esse objeto para o sistema de metadados ou registrando o tipo de implementação no arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c34ad-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="c34ad-106">As implementações <xref:System.ServiceModel.Description.IPolicyImportExtension> da interface devem fornecer um construtor sem parâmetros.</span><span class="sxs-lookup"><span data-stu-id="c34ad-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="c34ad-107">Para importar afirmações de políticas personalizadas</span><span class="sxs-lookup"><span data-stu-id="c34ad-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="c34ad-108">Implemente <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> a interface em uma classe.</span><span class="sxs-lookup"><span data-stu-id="c34ad-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="c34ad-109">Veja os seguintes procedimentos.</span><span class="sxs-lookup"><span data-stu-id="c34ad-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="c34ad-110">Insira o importador de políticas personalizadas por:</span><span class="sxs-lookup"><span data-stu-id="c34ad-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="c34ad-111">Usando um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="c34ad-111">Using a configuration file.</span></span> <span data-ttu-id="c34ad-112">Veja os seguintes procedimentos.</span><span class="sxs-lookup"><span data-stu-id="c34ad-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="c34ad-113">Usando um arquivo de configuração com [serviceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="c34ad-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="c34ad-114">Veja os seguintes procedimentos.</span><span class="sxs-lookup"><span data-stu-id="c34ad-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="c34ad-115">Inserindo programáticamente o importador de políticas.</span><span class="sxs-lookup"><span data-stu-id="c34ad-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="c34ad-116">Veja os seguintes procedimentos.</span><span class="sxs-lookup"><span data-stu-id="c34ad-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="c34ad-117">Para implementar a interface System.ServiceModel.Description.IPolicyImportExtension em qualquer classe</span><span class="sxs-lookup"><span data-stu-id="c34ad-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="c34ad-118">No <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> método, para cada assunto de política que você está interessado, encontre as afirmações de política que você deseja importar <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> chamando o método apropriado (dependendo do escopo da afirmação que você deseja) sobre o objeto passado para o método.</span><span class="sxs-lookup"><span data-stu-id="c34ad-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="c34ad-119">O exemplo de código a <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> seguir mostra como usar o método para localizar a afirmação da política personalizada e removê-la da coleção em uma etapa.</span><span class="sxs-lookup"><span data-stu-id="c34ad-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="c34ad-120">Se você usar o método remover para localizar e remover a afirmação, você não precisa executar a etapa 4.</span><span class="sxs-lookup"><span data-stu-id="c34ad-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="c34ad-121">Processe as afirmações políticas.</span><span class="sxs-lookup"><span data-stu-id="c34ad-121">Process the policy assertions.</span></span> <span data-ttu-id="c34ad-122">Observe que o sistema de políticas não `wsp:optional`normaliza políticas aninhadas e .</span><span class="sxs-lookup"><span data-stu-id="c34ad-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="c34ad-123">Você deve processar essas construções em sua implementação de extensão de importação de políticas.</span><span class="sxs-lookup"><span data-stu-id="c34ad-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="c34ad-124">Realize a personalização da vinculação ou contrato que suporte o recurso ou requisito especificado pela afirmação da diretiva.</span><span class="sxs-lookup"><span data-stu-id="c34ad-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="c34ad-125">Normalmente, as afirmações indicam que uma vinculação requer uma configuração específica ou um elemento de vinculação específico.</span><span class="sxs-lookup"><span data-stu-id="c34ad-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="c34ad-126">Faça essas modificações acessando a <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="c34ad-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="c34ad-127">Outras afirmações exigem que você modifique o contrato.</span><span class="sxs-lookup"><span data-stu-id="c34ad-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="c34ad-128">Você pode acessar e modificar <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> o contrato usando o imóvel.</span><span class="sxs-lookup"><span data-stu-id="c34ad-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="c34ad-129">Observe que o seu importador de apólices pode ser chamado várias vezes para o mesmo contrato e vinculação, mas alternativas de política diferentes se a importação de uma alternativa de política falhar.</span><span class="sxs-lookup"><span data-stu-id="c34ad-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="c34ad-130">Seu código deve ser resistente a esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="c34ad-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="c34ad-131">Remova a afirmação da política personalizada da coleção de afirmações.</span><span class="sxs-lookup"><span data-stu-id="c34ad-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="c34ad-132">Se você não remover a afirmação, a Windows Communication Foundation (WCF) assumirá que a importação de políticas não foi bem sucedida e não importa a vinculação associada.</span><span class="sxs-lookup"><span data-stu-id="c34ad-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="c34ad-133">Se você <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> usou o método para localizar a afirmação da política personalizada e removê-la da coleção em uma etapa, você não precisa executar essa etapa.</span><span class="sxs-lookup"><span data-stu-id="c34ad-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="c34ad-134">Para inserir o importador de políticas personalizadas no sistema de metadados usando um arquivo de configuração</span><span class="sxs-lookup"><span data-stu-id="c34ad-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="c34ad-135">Adicione o tipo `<extensions>` de importador ao elemento dentro da [ \<políticaImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) elemento no arquivo de configuração do cliente.</span><span class="sxs-lookup"><span data-stu-id="c34ad-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]
  
2. <span data-ttu-id="c34ad-136">Na aplicação do cliente, use o <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> para resolver os metadados e o importador é invocado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c34ad-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="c34ad-137">Para inserir o importador de políticas personalizadas no sistema de metadados usando Svcutil.exe</span><span class="sxs-lookup"><span data-stu-id="c34ad-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="c34ad-138">Adicione o tipo `<extensions>` de importador ao elemento dentro da [ \<políticaImportadores>](../../configure-apps/file-schema/wcf/policyimporters.md) elemento no arquivo de configuração Svcutil.exe.config.</span><span class="sxs-lookup"><span data-stu-id="c34ad-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="c34ad-139">Você também pode apontar Svcutil.exe para carregar tipos de importador `/svcutilConfig` de políticas registrados em um arquivo de configuração diferente usando a opção.</span><span class="sxs-lookup"><span data-stu-id="c34ad-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="c34ad-140">Use [serviceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) para importar os metadados e o importador é invocado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c34ad-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="c34ad-141">Para inserir o importador de políticas personalizadas no sistema de metadados de forma programática</span><span class="sxs-lookup"><span data-stu-id="c34ad-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="c34ad-142">Adicione o importador <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> à propriedade (por exemplo, <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>se você estiver usando o ) antes de importar os metadados.</span><span class="sxs-lookup"><span data-stu-id="c34ad-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c34ad-143">Confira também</span><span class="sxs-lookup"><span data-stu-id="c34ad-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="c34ad-144">Estendendo o sistema de metadados</span><span class="sxs-lookup"><span data-stu-id="c34ad-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)
