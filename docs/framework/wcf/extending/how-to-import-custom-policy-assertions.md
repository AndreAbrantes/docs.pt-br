---
title: 'Como: importar declarações de política personalizadas'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: fb5e3ba5faca1b32eef63ac174bcd7731ee50771
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96249144"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="6fd36-102">Como: importar declarações de política personalizadas</span><span class="sxs-lookup"><span data-stu-id="6fd36-102">How to: Import Custom Policy Assertions</span></span>

<span data-ttu-id="6fd36-103">As declarações de política descrevem os recursos e os requisitos de um ponto de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="6fd36-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="6fd36-104">Os aplicativos cliente podem usar declarações de política em metadados de serviço para configurar a associação de cliente ou para personalizar o contrato de serviço para um ponto de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="6fd36-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="6fd36-105">As declarações de política personalizada são importadas implementando a <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface e passando esse objeto para o sistema de metadados ou registrando o tipo de implementação em seu arquivo de configuração de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6fd36-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="6fd36-106">As implementações da <xref:System.ServiceModel.Description.IPolicyImportExtension> interface devem fornecer um construtor sem parâmetros.</span><span class="sxs-lookup"><span data-stu-id="6fd36-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="6fd36-107">Para importar declarações de política personalizada</span><span class="sxs-lookup"><span data-stu-id="6fd36-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="6fd36-108">Implemente a <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface em uma classe.</span><span class="sxs-lookup"><span data-stu-id="6fd36-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="6fd36-109">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="6fd36-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="6fd36-110">Insira o importador de política personalizada por:</span><span class="sxs-lookup"><span data-stu-id="6fd36-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="6fd36-111">Usando um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="6fd36-111">Using a configuration file.</span></span> <span data-ttu-id="6fd36-112">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="6fd36-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="6fd36-113">Usando um arquivo de configuração com a [ferramenta de utilitário de metadados ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="6fd36-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="6fd36-114">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="6fd36-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="6fd36-115">Inserindo programaticamente o importador de política.</span><span class="sxs-lookup"><span data-stu-id="6fd36-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="6fd36-116">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="6fd36-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="6fd36-117">Para implementar a interface System. ServiceModel. Description. IPolicyImportExtension em qualquer classe</span><span class="sxs-lookup"><span data-stu-id="6fd36-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="6fd36-118">No <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> método, para cada assunto da política sobre a qual você está interessado, localize as declarações de política que deseja importar chamando o método apropriado (dependendo do escopo da declaração que você deseja) no <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> objeto passado para o método.</span><span class="sxs-lookup"><span data-stu-id="6fd36-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="6fd36-119">O exemplo de código a seguir mostra como usar o <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> método para localizar a declaração de política personalizada e removê-la da coleção em uma única etapa.</span><span class="sxs-lookup"><span data-stu-id="6fd36-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="6fd36-120">Se você usar o método remove para localizar e remover a asserção, não será necessário executar a etapa 4.</span><span class="sxs-lookup"><span data-stu-id="6fd36-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="6fd36-121">Processar as declarações de política.</span><span class="sxs-lookup"><span data-stu-id="6fd36-121">Process the policy assertions.</span></span> <span data-ttu-id="6fd36-122">Observe que o sistema de política não normaliza políticas aninhadas e `wsp:optional` .</span><span class="sxs-lookup"><span data-stu-id="6fd36-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="6fd36-123">Você deve processar essas construções em sua implementação de extensão de importação de política.</span><span class="sxs-lookup"><span data-stu-id="6fd36-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="6fd36-124">Execute a personalização para a associação ou contrato que dá suporte à capacidade ou ao requisito especificado pela declaração de política.</span><span class="sxs-lookup"><span data-stu-id="6fd36-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="6fd36-125">Normalmente, as declarações indicam que uma associação requer uma configuração específica ou um elemento de ligação específico.</span><span class="sxs-lookup"><span data-stu-id="6fd36-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="6fd36-126">Faça essas modificações acessando a <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="6fd36-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="6fd36-127">Outras asserções exigem que você modifique o contrato.</span><span class="sxs-lookup"><span data-stu-id="6fd36-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="6fd36-128">Você pode acessar e modificar o contrato usando a <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="6fd36-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="6fd36-129">Observe que o importador de política pode ser chamado várias vezes para a mesma associação e contrato, mas alternativas de política diferentes se a importação de uma alternativa de política falhar.</span><span class="sxs-lookup"><span data-stu-id="6fd36-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="6fd36-130">Seu código deve ser resiliente a esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="6fd36-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="6fd36-131">Remova a declaração de política personalizada da coleção de asserção.</span><span class="sxs-lookup"><span data-stu-id="6fd36-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="6fd36-132">Se você não remover o Windows Communication Foundation de asserção (WCF) supõe que a importação de política não foi bem-sucedida e não importará a associação associada.</span><span class="sxs-lookup"><span data-stu-id="6fd36-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="6fd36-133">Se você usou o <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> método para localizar a declaração de política personalizada e removê-la da coleção em uma única etapa, não será necessário executar essa etapa.</span><span class="sxs-lookup"><span data-stu-id="6fd36-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="6fd36-134">Para inserir o importador de política personalizada no sistema de metadados usando um arquivo de configuração</span><span class="sxs-lookup"><span data-stu-id="6fd36-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="6fd36-135">Adicione o tipo de importador ao `<extensions>` elemento dentro do [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) elemento no arquivo de configuração do cliente.</span><span class="sxs-lookup"><span data-stu-id="6fd36-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]
  
2. <span data-ttu-id="6fd36-136">No aplicativo cliente, use o <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> ou o <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> para resolver os metadados e o importador é invocado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="6fd36-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="6fd36-137">Para inserir o importador de política personalizada no sistema de metadados usando Svcutil.exe</span><span class="sxs-lookup"><span data-stu-id="6fd36-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="6fd36-138">Adicione o tipo de importador ao `<extensions>` elemento dentro do [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) elemento no arquivo de configuração Svcutil.exe.config.</span><span class="sxs-lookup"><span data-stu-id="6fd36-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="6fd36-139">Você também pode apontar Svcutil.exe para carregar os tipos de importador de política registrados em um arquivo de configuração diferente usando a `/svcutilConfig` opção.</span><span class="sxs-lookup"><span data-stu-id="6fd36-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="6fd36-140">Use a [ferramenta de utilitário de metadados ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) para importar os metadados e o importador é invocado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="6fd36-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="6fd36-141">Para inserir o importador de política personalizada no sistema de metadados de forma programática</span><span class="sxs-lookup"><span data-stu-id="6fd36-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="6fd36-142">Adicione o importador à <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> Propriedade (por exemplo, se você estiver usando o <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> ) antes de importar os metadados.</span><span class="sxs-lookup"><span data-stu-id="6fd36-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6fd36-143">Veja também</span><span class="sxs-lookup"><span data-stu-id="6fd36-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="6fd36-144">Estendendo o sistema de metadados</span><span class="sxs-lookup"><span data-stu-id="6fd36-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)
