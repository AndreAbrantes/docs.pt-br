---
title: "Como importar asserções de políticas personalizadas"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
caps.latest.revision: "8"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 4d78f4c15aeeb03981ebe5fd72e8607a240d1931
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="56621-102">Como importar asserções de políticas personalizadas</span><span class="sxs-lookup"><span data-stu-id="56621-102">How to: Import Custom Policy Assertions</span></span>
<span data-ttu-id="56621-103">Declarações de política descrevem os recursos e requisitos de um ponto de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="56621-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="56621-104">Aplicativos cliente podem usar declarações de política nos metadados de serviço para configurar a ligação do cliente ou para personalizar o contrato de serviço para um ponto de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="56621-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="56621-105">Declarações de política personalizadas são importadas com a implementação de <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface e passar esse objeto para o sistema de metadados ou Registrando a implementação do tipo em seu arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="56621-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="56621-106">Implementações do <xref:System.ServiceModel.Description.IPolicyImportExtension> interface deve fornecer um construtor padrão.</span><span class="sxs-lookup"><span data-stu-id="56621-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a default constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="56621-107">Para importar asserções de políticas personalizadas</span><span class="sxs-lookup"><span data-stu-id="56621-107">To import custom policy assertions</span></span>  
  
1.  <span data-ttu-id="56621-108">Implementar o <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface em uma classe.</span><span class="sxs-lookup"><span data-stu-id="56621-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="56621-109">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="56621-109">See the following procedures.</span></span>  
  
2.  <span data-ttu-id="56621-110">Inserir o importador de política personalizada ou por:</span><span class="sxs-lookup"><span data-stu-id="56621-110">Insert the custom policy importer either by:</span></span>  
  
3.  <span data-ttu-id="56621-111">Usando um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="56621-111">Using a configuration file.</span></span> <span data-ttu-id="56621-112">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="56621-112">See the following procedures.</span></span>  
  
4.  <span data-ttu-id="56621-113">Usando um arquivo de configuração com [Ferramenta Utilitária de metadados ServiceModel (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="56621-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="56621-114">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="56621-114">See the following procedures.</span></span>  
  
5.  <span data-ttu-id="56621-115">Programaticamente, inserindo o importador de política.</span><span class="sxs-lookup"><span data-stu-id="56621-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="56621-116">Consulte os procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="56621-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="56621-117">Para implementar a interface System.ServiceModel.Description.IPolicyImportExtension em qualquer classe</span><span class="sxs-lookup"><span data-stu-id="56621-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1.  <span data-ttu-id="56621-118">No <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> método, para cada entidade de política que você está interessado, localize as declarações de política que você deseja importar chamando o método apropriado (dependendo do escopo da asserção que você deseja) no <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> objeto passado para o método.</span><span class="sxs-lookup"><span data-stu-id="56621-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="56621-119">O exemplo de código a seguir mostra como usar o <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> método para localizar a declaração de política personalizada e removê-lo da coleção em uma única etapa.</span><span class="sxs-lookup"><span data-stu-id="56621-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="56621-120">Se você usar o método remove para localizar e remover a declaração, você não precisa executar a etapa 4.</span><span class="sxs-lookup"><span data-stu-id="56621-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2.  <span data-ttu-id="56621-121">Processe as declarações de política.</span><span class="sxs-lookup"><span data-stu-id="56621-121">Process the policy assertions.</span></span> <span data-ttu-id="56621-122">Observe que o sistema de política não normalizar aninhados políticas e `wsp:optional`.</span><span class="sxs-lookup"><span data-stu-id="56621-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="56621-123">Você deve processar essas construções em sua implementação de extensão de importação de política.</span><span class="sxs-lookup"><span data-stu-id="56621-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3.  <span data-ttu-id="56621-124">Execute a personalização para a associação ou o contrato que suporta o recurso ou requisito especificado pela declaração de política.</span><span class="sxs-lookup"><span data-stu-id="56621-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="56621-125">Asserções indicam que uma associação requer uma configuração específica ou um elemento de associação específica.</span><span class="sxs-lookup"><span data-stu-id="56621-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="56621-126">Fazer essas modificações, acessando o <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="56621-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="56621-127">Outras declarações exigem que você modifique o contrato.</span><span class="sxs-lookup"><span data-stu-id="56621-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="56621-128">Você pode acessar e modificar o contrato usando o <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="56621-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="56621-129">Observe que o importador de política pode obter chamado várias vezes para a mesma associação e contrato, mas falhar alternativas de políticas diferentes se estiver importando uma alternativa de política.</span><span class="sxs-lookup"><span data-stu-id="56621-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="56621-130">Seu código deve ser resiliente em relação a esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="56621-130">Your code should be resilient to this behavior.</span></span>  
  
4.  <span data-ttu-id="56621-131">Remova a declaração de política personalizada da coleção de asserção.</span><span class="sxs-lookup"><span data-stu-id="56621-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="56621-132">Se você não remover a declaração [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] pressupõe que a importação da política não foi bem-sucedida e não importa a associação associada.</span><span class="sxs-lookup"><span data-stu-id="56621-132">If you do not remove the assertion [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="56621-133">Se você usou o <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> método para localizar a declaração de política personalizada e removê-lo da coleção em uma única etapa, você não precisa executar essa etapa.</span><span class="sxs-lookup"><span data-stu-id="56621-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="56621-134">Para inserir o importador de política personalizada para os metadados do sistema usando um arquivo de configuração</span><span class="sxs-lookup"><span data-stu-id="56621-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1.  <span data-ttu-id="56621-135">Adicione o tipo do importador para o `<extensions>` elemento dentro do [ \<policyImporters >](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) elemento no arquivo de configuração do cliente.</span><span class="sxs-lookup"><span data-stu-id="56621-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]   
  
2.  <span data-ttu-id="56621-136">No aplicativo cliente, use o <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> para resolver os metadados e o importador é invocado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="56621-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="56621-137">Para inserir o importador de política personalizada para o sistema de metadados usando Svcutil.exe</span><span class="sxs-lookup"><span data-stu-id="56621-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1.  <span data-ttu-id="56621-138">Adicione o tipo do importador para o `<extensions>` elemento dentro do [ \<policyImporters >](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) elemento no arquivo de configuração Svcutil.exe.config.</span><span class="sxs-lookup"><span data-stu-id="56621-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="56621-139">Você também pode Svcutil.exe ponto para carregar os tipos de Importador de política registrados em um arquivo de configuração diferente usando o `/svcutilConfig` opção.</span><span class="sxs-lookup"><span data-stu-id="56621-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2.  <span data-ttu-id="56621-140">Use [Ferramenta Utilitária de metadados ServiceModel (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) importar os metadados e o importador é invocado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="56621-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="56621-141">Para inserir o importador de política personalizada do sistema de metadados por meio de programação</span><span class="sxs-lookup"><span data-stu-id="56621-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1.  <span data-ttu-id="56621-142">Adicionar o importador para o <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> propriedade (por exemplo, se você estiver usando o <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) antes de importar os metadados.</span><span class="sxs-lookup"><span data-stu-id="56621-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="56621-143">Consulte também</span><span class="sxs-lookup"><span data-stu-id="56621-143">See Also</span></span>  
 <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>  
 <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>  
 <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>  
 [<span data-ttu-id="56621-144">Estendendo o sistema de metadados</span><span class="sxs-lookup"><span data-stu-id="56621-144">Extending the Metadata System</span></span>](../../../../docs/framework/wcf/extending/extending-the-metadata-system.md)
