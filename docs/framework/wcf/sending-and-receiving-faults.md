---
title: Enviando e recebendo falhas
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], sending
ms.assetid: 7be6fb96-ce2a-450b-aebe-f932c6a4bc5d
ms.openlocfilehash: dc9dcb5d8e36984d1e5a2e5c5124e74509de7f3d
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/15/2019
ms.locfileid: "72320223"
---
# <a name="sending-and-receiving-faults"></a><span data-ttu-id="bb556-102">Enviando e recebendo falhas</span><span class="sxs-lookup"><span data-stu-id="bb556-102">Sending and Receiving Faults</span></span>

<span data-ttu-id="bb556-103">Falhas de SOAP transmitem informações de condição de erro de um serviço para um cliente e no caso duplex de um cliente para um serviço de forma interoperável.</span><span class="sxs-lookup"><span data-stu-id="bb556-103">SOAP faults convey error condition information from a service to a client and in the duplex case from a client to a service in an interoperable way.</span></span> <span data-ttu-id="bb556-104">Normalmente, um serviço define o conteúdo de falha personalizado e especifica quais operações podem retorná-los.</span><span class="sxs-lookup"><span data-stu-id="bb556-104">Typically a service defines custom fault content and specifies which operations can return them.</span></span> <span data-ttu-id="bb556-105">(Para obter mais informações, consulte [definindo e especificando falhas](defining-and-specifying-faults.md).) Este tópico discute como um serviço ou cliente duplex pode enviar essas falhas quando a condição de erro correspondente tiver ocorrido e como um aplicativo cliente ou de serviço lida com essas falhas.</span><span class="sxs-lookup"><span data-stu-id="bb556-105">(For more information, see [Defining and Specifying Faults](defining-and-specifying-faults.md).) This topic discusses how a service or duplex client can send those faults when the corresponding error condition has occurred and how a client or service application handles these faults.</span></span> <span data-ttu-id="bb556-106">Para obter uma visão geral do tratamento de erros em aplicativos Windows Communication Foundation (WCF), consulte [especificando e manipulando falhas em contratos e serviços](specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="bb556-106">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](specifying-and-handling-faults-in-contracts-and-services.md).</span></span>

## <a name="sending-soap-faults"></a><span data-ttu-id="bb556-107">Enviando falhas de SOAP</span><span class="sxs-lookup"><span data-stu-id="bb556-107">Sending SOAP Faults</span></span>

<span data-ttu-id="bb556-108">As falhas de SOAP declaradas são aquelas em que uma operação tem um <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> que especifica um tipo de falha SOAP personalizado.</span><span class="sxs-lookup"><span data-stu-id="bb556-108">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="bb556-109">As falhas de SOAP não declaradas são aquelas que não são especificadas no contrato para uma operação.</span><span class="sxs-lookup"><span data-stu-id="bb556-109">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span>

### <a name="sending-declared-faults"></a><span data-ttu-id="bb556-110">Enviando falhas declaradas</span><span class="sxs-lookup"><span data-stu-id="bb556-110">Sending Declared Faults</span></span>

<span data-ttu-id="bb556-111">Para enviar uma falha SOAP declarada, detecte a condição de erro para a qual a falha SOAP é apropriada e lance um novo <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> em que o parâmetro de tipo é um novo objeto do tipo especificado no <xref:System.ServiceModel.FaultContractAttribute> para essa operação.</span><span class="sxs-lookup"><span data-stu-id="bb556-111">To send a declared SOAP fault, detect the error condition for which the SOAP fault is appropriate and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> where the type parameter is a new object of the type specified in the <xref:System.ServiceModel.FaultContractAttribute> for that operation.</span></span> <span data-ttu-id="bb556-112">O exemplo de código a seguir mostra o uso de <xref:System.ServiceModel.FaultContractAttribute> para especificar que a operação `SampleMethod` pode retornar uma falha de SOAP com o tipo de detalhe de `GreetingFault`.</span><span class="sxs-lookup"><span data-stu-id="bb556-112">The following code example shows the use of <xref:System.ServiceModel.FaultContractAttribute> to specify that the `SampleMethod` operation can return a SOAP fault with the detail type of `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#4](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#4)]
[!code-vb[FaultContractAttribute#4](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#4)]

<span data-ttu-id="bb556-113">Para transmitir as informações de erro `GreetingFault` para o cliente, pegue a condição de erro apropriada e acione um novo <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> do tipo `GreetingFault` com um novo objeto `GreetingFault` como o argumento, como no exemplo de código a seguir.</span><span class="sxs-lookup"><span data-stu-id="bb556-113">To convey the `GreetingFault` error information to the client, catch the appropriate error condition and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault` with a new `GreetingFault` object as the argument, as in the following code example.</span></span> <span data-ttu-id="bb556-114">Se o cliente for um aplicativo cliente do WCF, ele o experimentará como uma exceção gerenciada em que o tipo é <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> do tipo `GreetingFault`.</span><span class="sxs-lookup"><span data-stu-id="bb556-114">If the client is an WCF client application, it experiences this as a managed exception where the type is <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#5](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#5)]
[!code-vb[FaultContractAttribute#5](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#5)]

### <a name="sending-undeclared-faults"></a><span data-ttu-id="bb556-115">Enviando falhas não declaradas</span><span class="sxs-lookup"><span data-stu-id="bb556-115">Sending Undeclared Faults</span></span>

<span data-ttu-id="bb556-116">O envio de falhas não declaradas pode ser muito útil para diagnosticar e depurar problemas rapidamente em aplicativos WCF, mas sua utilidade como ferramenta de depuração é limitada.</span><span class="sxs-lookup"><span data-stu-id="bb556-116">Sending undeclared faults can be very useful to quickly diagnose and debug problems in WCF applications, but its usefulness as a debugging tool is limited.</span></span> <span data-ttu-id="bb556-117">Em geral, ao depurar, é recomendável que você use a propriedade <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="bb556-117">More generally, when debugging it is recommended that you use the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="bb556-118">Quando você define esse valor como true, os clientes experimentam essas falhas como exceções <xref:System.ServiceModel.FaultException%601> do tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="bb556-118">When you set this value to true, clients experience such faults as <xref:System.ServiceModel.FaultException%601> exceptions of type <xref:System.ServiceModel.ExceptionDetail>.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bb556-119">Como as exceções gerenciadas podem expor informações internas do aplicativo, definir <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> como `true` pode permitir que os clientes WCF obtenham informações sobre exceções de operação de serviço interno, incluindo identificação pessoal ou outras confidenciais divulgação.</span><span class="sxs-lookup"><span data-stu-id="bb556-119">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="bb556-120">Portanto, definir <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> como `true` é recomendado apenas como uma maneira de depurar temporariamente um aplicativo de serviço.</span><span class="sxs-lookup"><span data-stu-id="bb556-120">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is only recommended as a way of temporarily debugging a service application.</span></span> <span data-ttu-id="bb556-121">Além disso, o WSDL para um método que retorna exceções gerenciadas sem tratamento dessa maneira não contém o contrato para o <xref:System.ServiceModel.FaultException%601> do tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="bb556-121">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="bb556-122">Os clientes devem esperar a possibilidade de uma falha SOAP desconhecida (retornada aos clientes WCF como objetos <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>) para obter as informações de depuração corretamente.</span><span class="sxs-lookup"><span data-stu-id="bb556-122">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

<span data-ttu-id="bb556-123">Para enviar uma falha de SOAP não declarada, lance um objeto <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> (ou seja, não o tipo genérico <xref:System.ServiceModel.FaultException%601>) e passe a cadeia de caracteres para o construtor.</span><span class="sxs-lookup"><span data-stu-id="bb556-123">To send an undeclared SOAP fault, throw a <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> object (that is, not the generic type <xref:System.ServiceModel.FaultException%601>) and pass the string to the constructor.</span></span> <span data-ttu-id="bb556-124">Isso é exposto aos aplicativos cliente do WCF como uma exceção gerada <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>, em que a cadeia de caracteres está disponível chamando o método <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="bb556-124">This is exposed to the WCF client applications as a thrown <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> exception where the string is available by calling the <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> method.</span></span>

> [!NOTE]
> <span data-ttu-id="bb556-125">Se você declarar uma falha de SOAP do tipo cadeia de caracteres e, em seguida, lançar isso em seu serviço como um <xref:System.ServiceModel.FaultException%601>, em que o parâmetro de tipo é um <xref:System.String?displayProperty=nameWithType>, o valor da cadeia de caracteres será atribuído à propriedade <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> e não estará disponível em <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="bb556-125">If you declare a SOAP fault of type string, and then throw this in your service as a <xref:System.ServiceModel.FaultException%601> where the type parameter is a <xref:System.String?displayProperty=nameWithType> the string value is assigned to the <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> property, and is not available from <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span></span>

## <a name="handling-faults"></a><span data-ttu-id="bb556-126">Tratamento de falhas</span><span class="sxs-lookup"><span data-stu-id="bb556-126">Handling Faults</span></span>

<span data-ttu-id="bb556-127">Em clientes WCF, as falhas de SOAP que ocorrem durante a comunicação que são de interesse para aplicativos cliente são geradas como exceções gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="bb556-127">In WCF clients, SOAP faults that occur during communication that are of interest to client applications are raised as managed exceptions.</span></span> <span data-ttu-id="bb556-128">Embora existam muitas exceções que podem ocorrer durante a execução de qualquer programa, os aplicativos que usam o modelo de programação de cliente do WCF podem esperar manipular exceções dos dois tipos a seguir como resultado da comunicação.</span><span class="sxs-lookup"><span data-stu-id="bb556-128">While there are many exceptions that can occur during the execution of any program, applications using the WCF client programming model can expect to handle exceptions of the following two types as a result of communication.</span></span>

- <xref:System.TimeoutException>

- <xref:System.ServiceModel.CommunicationException>

<span data-ttu-id="bb556-129">os objetos <xref:System.TimeoutException> são lançados quando uma operação excede o período de tempo limite especificado.</span><span class="sxs-lookup"><span data-stu-id="bb556-129"><xref:System.TimeoutException> objects are thrown when an operation exceeds the specified timeout period.</span></span>

<span data-ttu-id="bb556-130">os objetos <xref:System.ServiceModel.CommunicationException> são lançados quando há alguma condição de erro de comunicação recuperável no serviço ou no cliente.</span><span class="sxs-lookup"><span data-stu-id="bb556-130"><xref:System.ServiceModel.CommunicationException> objects are thrown when there is some recoverable communication error condition on either the service or the client.</span></span>

<span data-ttu-id="bb556-131">A classe <xref:System.ServiceModel.CommunicationException> tem dois tipos derivados importantes, <xref:System.ServiceModel.FaultException> e o tipo genérico <xref:System.ServiceModel.FaultException%601>.</span><span class="sxs-lookup"><span data-stu-id="bb556-131">The <xref:System.ServiceModel.CommunicationException> class has two important derived types, <xref:System.ServiceModel.FaultException> and the generic <xref:System.ServiceModel.FaultException%601> type.</span></span>

<span data-ttu-id="bb556-132">as exceções <xref:System.ServiceModel.FaultException> são geradas quando um ouvinte recebe uma falha que não é esperada ou especificada no contrato de operação; Geralmente isso ocorre quando o aplicativo está sendo depurado e o serviço tem a propriedade <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> definida como `true`.</span><span class="sxs-lookup"><span data-stu-id="bb556-132"><xref:System.ServiceModel.FaultException> exceptions are thrown when a listener receives a fault that is not expected or specified in the operation contract; usually this occurs when the application is being debugged and the service has the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true`.</span></span>

<span data-ttu-id="bb556-133">as exceções <xref:System.ServiceModel.FaultException%601> são geradas no cliente quando uma falha especificada no contrato de operação é recebida em resposta a uma operação bidirecional (ou seja, um método com um atributo <xref:System.ServiceModel.OperationContractAttribute> com <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> definido como `false`).</span><span class="sxs-lookup"><span data-stu-id="bb556-133"><xref:System.ServiceModel.FaultException%601> exceptions are thrown on the client when a fault that is specified in the operation contract is received in response to a two-way operation (that is, a method with an <xref:System.ServiceModel.OperationContractAttribute> attribute with <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> set to `false`).</span></span>

> [!NOTE]
> <span data-ttu-id="bb556-134">Quando um serviço WCF tem a propriedade <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> definida como `true`, o cliente experimenta isso como um <xref:System.ServiceModel.FaultException%601> não declarado do tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="bb556-134">When an WCF service has the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true` the client experiences this as an undeclared <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="bb556-135">Os clientes podem capturar essa falha específica ou lidar com a falha em um bloco catch para <xref:System.ServiceModel.FaultException>.</span><span class="sxs-lookup"><span data-stu-id="bb556-135">Clients can either catch this specific fault or handle the fault in a catch block for <xref:System.ServiceModel.FaultException>.</span></span>

<span data-ttu-id="bb556-136">Normalmente, somente as exceções <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException> e <xref:System.ServiceModel.CommunicationException> são de interesse para clientes e serviços.</span><span class="sxs-lookup"><span data-stu-id="bb556-136">Typically, only <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException>, and <xref:System.ServiceModel.CommunicationException> exceptions are of interest to clients and services.</span></span>

> [!NOTE]
> <span data-ttu-id="bb556-137">Outras exceções, é claro, ocorrem.</span><span class="sxs-lookup"><span data-stu-id="bb556-137">Other exceptions, of course, do occur.</span></span> <span data-ttu-id="bb556-138">Exceções inesperadas incluem falhas catastróficas como <xref:System.OutOfMemoryException?displayProperty=nameWithType>; Normalmente, os aplicativos não devem detectar esses métodos.</span><span class="sxs-lookup"><span data-stu-id="bb556-138">Unexpected exceptions include catastrophic failures like <xref:System.OutOfMemoryException?displayProperty=nameWithType>; typically applications should not catch such methods.</span></span>

### <a name="catch-fault-exceptions-in-the-correct-order"></a><span data-ttu-id="bb556-139">Capturar exceções de falha na ordem correta</span><span class="sxs-lookup"><span data-stu-id="bb556-139">Catch Fault Exceptions in the Correct Order</span></span>

<span data-ttu-id="bb556-140">Como <xref:System.ServiceModel.FaultException%601> deriva de <xref:System.ServiceModel.FaultException> e <xref:System.ServiceModel.FaultException> deriva de <xref:System.ServiceModel.CommunicationException>, é importante capturar essas exceções na ordem correta.</span><span class="sxs-lookup"><span data-stu-id="bb556-140">Because <xref:System.ServiceModel.FaultException%601> derives from <xref:System.ServiceModel.FaultException>, and <xref:System.ServiceModel.FaultException> derives from <xref:System.ServiceModel.CommunicationException>, it is important to catch these exceptions in the proper order.</span></span> <span data-ttu-id="bb556-141">Se, por exemplo, você tiver um bloco try/catch no qual você primeiro capturou <xref:System.ServiceModel.CommunicationException>, todas as falhas de SOAP especificadas e não especificadas serão manipuladas lá; todos os blocos de captura subsequentes para lidar com uma exceção <xref:System.ServiceModel.FaultException%601> personalizada nunca são invocados.</span><span class="sxs-lookup"><span data-stu-id="bb556-141">If, for example, you have a try/catch block in which you first catch <xref:System.ServiceModel.CommunicationException>, all specified and unspecified SOAP faults are handled there; any subsequent catch blocks to handle a custom <xref:System.ServiceModel.FaultException%601> exception are never invoked.</span></span>

<span data-ttu-id="bb556-142">Lembre-se de que uma operação pode retornar qualquer número de falhas especificadas.</span><span class="sxs-lookup"><span data-stu-id="bb556-142">Remember that one operation can return any number of specified faults.</span></span> <span data-ttu-id="bb556-143">Cada falha é um tipo exclusivo e deve ser manipulada separadamente.</span><span class="sxs-lookup"><span data-stu-id="bb556-143">Each fault is a unique type and must be handled separately.</span></span>

### <a name="handle-exceptions-when-closing-the-channel"></a><span data-ttu-id="bb556-144">Tratar exceções ao fechar o canal</span><span class="sxs-lookup"><span data-stu-id="bb556-144">Handle Exceptions When Closing the Channel</span></span>

<span data-ttu-id="bb556-145">A maior parte da discussão anterior tem a ver com falhas enviadas no decorrer do processamento de mensagens de aplicativo, ou seja, mensagens explicitamente enviadas pelo cliente quando o aplicativo cliente chama operações no objeto cliente do WCF.</span><span class="sxs-lookup"><span data-stu-id="bb556-145">Most of the preceding discussion has to do with faults sent in the course of processing application messages, that is, messages explicitly sent by the client when the client application calls operations on the WCF client object.</span></span>

<span data-ttu-id="bb556-146">Mesmo com objetos locais descartando o objeto, é possível aumentar ou mascarar as exceções que ocorrem durante o processo de reciclagem.</span><span class="sxs-lookup"><span data-stu-id="bb556-146">Even with local objects disposing the object can either raise or mask exceptions that occur during the recycling process.</span></span> <span data-ttu-id="bb556-147">Algo semelhante pode ocorrer quando você usa objetos de cliente WCF.</span><span class="sxs-lookup"><span data-stu-id="bb556-147">Something similar can occur when you use WCF client objects.</span></span> <span data-ttu-id="bb556-148">Ao chamar operações, você está enviando mensagens por uma conexão estabelecida.</span><span class="sxs-lookup"><span data-stu-id="bb556-148">When you call operations you are sending messages over an established connection.</span></span> <span data-ttu-id="bb556-149">Fechar o canal pode gerar exceções se a conexão não puder ser fechada corretamente ou já estiver fechada, mesmo que todas as operações retornassem adequadamente.</span><span class="sxs-lookup"><span data-stu-id="bb556-149">Closing the channel can throw exceptions if the connection cannot be cleanly closed or is already closed, even if all the operations returned properly.</span></span>

<span data-ttu-id="bb556-150">Normalmente, os canais de objeto de cliente são fechados de uma das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="bb556-150">Typically, client object channels are closed in one of the following ways:</span></span>

- <span data-ttu-id="bb556-151">Quando o objeto do cliente WCF é reciclado.</span><span class="sxs-lookup"><span data-stu-id="bb556-151">When the WCF client object is recycled.</span></span>

- <span data-ttu-id="bb556-152">Quando o aplicativo cliente chama <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="bb556-152">When the client application calls <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="bb556-153">Quando o aplicativo cliente chama <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="bb556-153">When the client application calls <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="bb556-154">Quando o aplicativo cliente chama uma operação que é uma operação de encerramento para uma sessão.</span><span class="sxs-lookup"><span data-stu-id="bb556-154">When the client application calls an operation that is a terminating operation for a session.</span></span>

<span data-ttu-id="bb556-155">Em todos os casos, o fechamento do canal instrui o canal a começar a fechar todos os canais subjacentes que podem estar enviando mensagens para oferecer suporte à funcionalidade complexa no nível do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb556-155">In all cases, closing the channel instructs the channel to begin closing any underlying channels that may be sending messages to support complex functionality at the application level.</span></span> <span data-ttu-id="bb556-156">Por exemplo, quando um contrato requer sessões, uma associação tenta estabelecer uma sessão trocando mensagens com o canal de serviço até que uma sessão seja estabelecida.</span><span class="sxs-lookup"><span data-stu-id="bb556-156">For example, when a contract requires sessions a binding attempts to establish a session by exchanging messages with the service channel until a session is established.</span></span> <span data-ttu-id="bb556-157">Quando o canal é fechado, o canal de sessão subjacente notifica o serviço de que a sessão foi encerrada.</span><span class="sxs-lookup"><span data-stu-id="bb556-157">When the channel is closed, the underlying session channel notifies the service that the session is terminated.</span></span> <span data-ttu-id="bb556-158">Nesse caso, se o canal já tiver sido anulado, fechado ou, de outra forma, inutilizável (por exemplo, quando um cabo de rede estiver desconectado), o canal do cliente não poderá informar ao canal de serviço que a sessão foi encerrada e uma exceção poderá resultar.</span><span class="sxs-lookup"><span data-stu-id="bb556-158">In this case, if the channel has already aborted, closed, or is otherwise unusable (for example, when a network cable is unplugged), the client channel cannot inform the service channel that the session is terminated and an exception can result.</span></span>

### <a name="abort-the-channel-if-necessary"></a><span data-ttu-id="bb556-159">Anular o canal, se necessário</span><span class="sxs-lookup"><span data-stu-id="bb556-159">Abort the Channel If Necessary</span></span>

<span data-ttu-id="bb556-160">Como o fechamento do canal também pode gerar exceções, é recomendável que, além de capturar as exceções de falha na ordem correta, seja importante anular o canal que foi usado para fazer a chamada no bloco catch.</span><span class="sxs-lookup"><span data-stu-id="bb556-160">Because closing the channel can also throw exceptions, then, it is recommended that in addition to catching fault exceptions in the correct order, it is important to abort the channel that was used in making the call in the catch block.</span></span>

<span data-ttu-id="bb556-161">Se a falha transmitir informações de erro específicas a uma operação e se ainda for possível que outras pessoas possam usá-las, não haverá necessidade de anular o canal (embora esses casos sejam raros).</span><span class="sxs-lookup"><span data-stu-id="bb556-161">If the fault conveys error information specific to an operation and it remains possible that others can use it, there is no need to abort the channel (although these cases are rare).</span></span> <span data-ttu-id="bb556-162">Em todos os outros casos, é recomendável anular o canal.</span><span class="sxs-lookup"><span data-stu-id="bb556-162">In all other cases, it is recommended that you abort the channel.</span></span> <span data-ttu-id="bb556-163">Para obter um exemplo que demonstra todos esses pontos, consulte [exceções esperadas](./samples/expected-exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="bb556-163">For a sample that demonstrates all of these points, see [Expected Exceptions](./samples/expected-exceptions.md).</span></span>

<span data-ttu-id="bb556-164">O exemplo de código a seguir mostra como lidar com exceções de falha de SOAP em um aplicativo cliente básico, incluindo uma falha declarada e uma falha não declarada.</span><span class="sxs-lookup"><span data-stu-id="bb556-164">The following code example shows how to handle SOAP fault exceptions in a basic client application, including a declared fault and an undeclared fault.</span></span>

> [!NOTE]
> <span data-ttu-id="bb556-165">Este código de exemplo não usa a construção `using`.</span><span class="sxs-lookup"><span data-stu-id="bb556-165">This sample code does not use the `using` construct.</span></span> <span data-ttu-id="bb556-166">Como os canais de fechamento podem gerar exceções, é recomendável que os aplicativos criem primeiro um cliente WCF e, em seguida, abram, utilizem e fechem o cliente WCF no mesmo bloco try.</span><span class="sxs-lookup"><span data-stu-id="bb556-166">Because closing channels can throw exceptions, it is recommended that applications create a WCF client first, and then open, use, and close the WCF client in the same try block.</span></span> <span data-ttu-id="bb556-167">Para obter detalhes, consulte [visão geral do cliente WCF](wcf-client-overview.md) e [use fechar e anular para liberar os recursos do cliente WCF](./samples/use-close-abort-release-wcf-client-resources.md).</span><span class="sxs-lookup"><span data-stu-id="bb556-167">For details, see [WCF Client Overview](wcf-client-overview.md) and [Use Close and Abort to release WCF client resources](./samples/use-close-abort-release-wcf-client-resources.md).</span></span>

[!code-csharp[FaultContractAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/client.cs#3)]
[!code-vb[FaultContractAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/client.vb#3)]

## <a name="see-also"></a><span data-ttu-id="bb556-168">Consulte também</span><span class="sxs-lookup"><span data-stu-id="bb556-168">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultException%601>
- <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>
- [<span data-ttu-id="bb556-169">Exceções esperadas</span><span class="sxs-lookup"><span data-stu-id="bb556-169">Expected Exceptions</span></span>](./samples/expected-exceptions.md)
- [<span data-ttu-id="bb556-170">Usar fechar e anular para liberar os recursos do cliente do WCF</span><span class="sxs-lookup"><span data-stu-id="bb556-170">Use Close and Abort to release WCF client resources</span></span>](./samples/use-close-abort-release-wcf-client-resources.md)
