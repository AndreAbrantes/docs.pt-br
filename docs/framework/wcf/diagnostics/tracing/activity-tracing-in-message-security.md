---
title: Rastreamento de atividades em segurança de mensagens
ms.date: 03/30/2017
ms.assetid: 68862534-3b2e-4270-b097-8121b12a2c97
ms.openlocfilehash: bb8a4c6782cc52de393eacc2458e216d0f069866
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69933522"
---
# <a name="activity-tracing-in-message-security"></a><span data-ttu-id="992ea-102">Rastreamento de atividades em segurança de mensagens</span><span class="sxs-lookup"><span data-stu-id="992ea-102">Activity Tracing in Message Security</span></span>
<span data-ttu-id="992ea-103">Este tópico descreve o rastreamento de atividades para o processamento de segurança, que ocorre nas três fases a seguir.</span><span class="sxs-lookup"><span data-stu-id="992ea-103">This topic describes activity tracing for security processing, which happens in the following three phases.</span></span>  
  
- <span data-ttu-id="992ea-104">Negociação/SCT do Exchange.</span><span class="sxs-lookup"><span data-stu-id="992ea-104">Negotiation/SCT exchange.</span></span> <span data-ttu-id="992ea-105">Isso pode acontecer no transporte posteriormente (por meio de troca de dados binária) ou camada de mensagem (por meio de trocas de mensagens SOAP).</span><span class="sxs-lookup"><span data-stu-id="992ea-105">This can happen at the transport later (through binary data exchange) or message layer (through SOAP message exchanges).</span></span>  
  
- <span data-ttu-id="992ea-106">Criptografia/descriptografia de mensagens, com verificação de assinatura e autenticação.</span><span class="sxs-lookup"><span data-stu-id="992ea-106">Message encryption/decryption, with signature verification and authentication.</span></span> <span data-ttu-id="992ea-107">Os rastreamentos aparecem na atividade ambiente, normalmente "ação do processo".</span><span class="sxs-lookup"><span data-stu-id="992ea-107">Traces appear in the ambient activity, typically "Process Action."</span></span>  
  
- <span data-ttu-id="992ea-108">Autorização e verificação.</span><span class="sxs-lookup"><span data-stu-id="992ea-108">Authorization and verification.</span></span> <span data-ttu-id="992ea-109">Isso pode acontecer localmente ou durante a comunicação entre pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="992ea-109">This can happen locally or when communicating between endpoints.</span></span>  
  
## <a name="negotiationsct-exchange"></a><span data-ttu-id="992ea-110">Negociação/SCT de intercâmbio</span><span class="sxs-lookup"><span data-stu-id="992ea-110">Negotiation/SCT exchange</span></span>  
 <span data-ttu-id="992ea-111">Na fase de negociação/SCT Exchange, dois tipos de atividade são criados no cliente: "Configurar sessão segura" e "fechar sessão segura".</span><span class="sxs-lookup"><span data-stu-id="992ea-111">In the negotiation/SCT exchange phase, two activity types are created on the client: "Set up Secure Session" and "Close Secure Session."</span></span> <span data-ttu-id="992ea-112">"Configurar sessão segura" abrange rastreamentos para as trocas de mensagens RST/RSTR/SCT, enquanto "fechar sessão segura" inclui rastreamentos para a mensagem de cancelamento.</span><span class="sxs-lookup"><span data-stu-id="992ea-112">"Set up Secure Session" encompasses traces for the RST/RSTR/SCT message exchanges, while "Close Secure Session" includes traces for the Cancel message.</span></span>  
  
 <span data-ttu-id="992ea-113">No servidor, cada solicitação/resposta para o RST/RSTR/SCT aparece em sua própria atividade.</span><span class="sxs-lookup"><span data-stu-id="992ea-113">On the server, each request/reply for the RST/RSTR/SCT appears in its own activity.</span></span> <span data-ttu-id="992ea-114">Se `propagateActivity` estiver noservidor= e no cliente, as atividades no servidor terão a mesma ID e aparecerão juntas na "sessão segura de instalação" quando visualizadas por meio do Visualizador de rastreamento de serviço. `true`</span><span class="sxs-lookup"><span data-stu-id="992ea-114">If `propagateActivity`=`true` on both the server and client, activities on the server have the same ID, and appear together in the "Setup Secure Session" when viewed through Service Trace Viewer.</span></span>  
  
 <span data-ttu-id="992ea-115">Esse modelo de rastreamento de atividade é válido para autenticação de nome de usuário/senha, autenticação de certificado e autenticação NTLM.</span><span class="sxs-lookup"><span data-stu-id="992ea-115">This activity tracing model is valid for user name/password authentication, certificate authentication, and NTLM authentication.</span></span>  
  
 <span data-ttu-id="992ea-116">A tabela a seguir lista as atividades e os rastreamentos para negociação e SCT do Exchange.</span><span class="sxs-lookup"><span data-stu-id="992ea-116">The following table lists the activities and traces for negotiation and SCT exchange.</span></span>  
  
||<span data-ttu-id="992ea-117">Tempo em que a negociação/SCT ocorre no Exchange</span><span class="sxs-lookup"><span data-stu-id="992ea-117">Time when Negotiation/SCT exchange happens</span></span>|<span data-ttu-id="992ea-118">Atividades</span><span class="sxs-lookup"><span data-stu-id="992ea-118">Activities</span></span>|<span data-ttu-id="992ea-119">Rastreamentos</span><span class="sxs-lookup"><span data-stu-id="992ea-119">Traces</span></span>|  
|-|-------------------------------------------------|----------------|------------|  
|<span data-ttu-id="992ea-120">Transporte seguro</span><span class="sxs-lookup"><span data-stu-id="992ea-120">Secure Transport</span></span><br /><br /> <span data-ttu-id="992ea-121">(HTTPS, SSL)</span><span class="sxs-lookup"><span data-stu-id="992ea-121">(HTTPS, SSL)</span></span>|<span data-ttu-id="992ea-122">Na primeira mensagem recebida.</span><span class="sxs-lookup"><span data-stu-id="992ea-122">On first message received.</span></span>|<span data-ttu-id="992ea-123">Os rastreamentos são emitidos na atividade ambiente.</span><span class="sxs-lookup"><span data-stu-id="992ea-123">Traces are emitted in the ambient activity.</span></span>|<span data-ttu-id="992ea-124">-Rastreamentos do Exchange</span><span class="sxs-lookup"><span data-stu-id="992ea-124">-   Exchange traces</span></span><br /><span data-ttu-id="992ea-125">-Canal seguro estabelecido</span><span class="sxs-lookup"><span data-stu-id="992ea-125">-   Secure channel established</span></span><br /><span data-ttu-id="992ea-126">-Compartilhe segredos obtidos.</span><span class="sxs-lookup"><span data-stu-id="992ea-126">-   Share secrets obtained.</span></span>|  
|<span data-ttu-id="992ea-127">Camada de mensagem segura</span><span class="sxs-lookup"><span data-stu-id="992ea-127">Secure Message Layer</span></span><br /><br /> <span data-ttu-id="992ea-128">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="992ea-128">(WSHTTP)</span></span>|<span data-ttu-id="992ea-129">Na primeira mensagem recebida.</span><span class="sxs-lookup"><span data-stu-id="992ea-129">On first message received.</span></span>|<span data-ttu-id="992ea-130">No cliente:</span><span class="sxs-lookup"><span data-stu-id="992ea-130">On the client:</span></span><br /><br /> <span data-ttu-id="992ea-131">-"Configurar sessão segura" fora da "ação do processo" da primeira mensagem, para cada solicitação/resposta para RST/RSTR/SCT.</span><span class="sxs-lookup"><span data-stu-id="992ea-131">-   "Setup Secure Session" out of "Process Action" of that first message, for each request/reply for RST/RSTR/SCT.</span></span><br /><span data-ttu-id="992ea-132">-"Fechar sessão segura" para o cancelamento do Exchange, fora da "atividade fechar proxy".</span><span class="sxs-lookup"><span data-stu-id="992ea-132">-   "Close Secure Session" for the CANCEL exchange, out of the "Close Proxy activity."</span></span> <span data-ttu-id="992ea-133">Essa atividade pode ocorrer fora de alguma outra atividade de ambiente, dependendo de quando a sessão segura é fechada.</span><span class="sxs-lookup"><span data-stu-id="992ea-133">This activity may happen out of some other ambient activity, depending on when the secure session is closed.</span></span><br /><br /> <span data-ttu-id="992ea-134">No servidor:</span><span class="sxs-lookup"><span data-stu-id="992ea-134">On the server:</span></span><br /><br /> <span data-ttu-id="992ea-135">-Uma atividade de "processar ação" para cada solicitação/resposta para RST/SCT/Cancel no servidor.</span><span class="sxs-lookup"><span data-stu-id="992ea-135">-   One "Process Action" activity for each request/reply for RST/SCT/Cancel on the server.</span></span> <span data-ttu-id="992ea-136">As `propagateActivity`atividades se =, RST/RSTR/SCT são mescladas com "configurar a sessão de segurança" e o cancelamento é mesclado com a atividade de "fechamento" do cliente. `true`</span><span class="sxs-lookup"><span data-stu-id="992ea-136">If `propagateActivity`=`true`, RST/RSTR/SCT activities are merged with "Set up Security Session", and Cancel is merged with the "Close" activity from the client.</span></span><br /><br /> <span data-ttu-id="992ea-137">Há dois estágios para "configurar sessão segura":</span><span class="sxs-lookup"><span data-stu-id="992ea-137">There are two stages for "Set up Secure Session":</span></span><br /><br /> <span data-ttu-id="992ea-138">1.  Negociação de autenticação.</span><span class="sxs-lookup"><span data-stu-id="992ea-138">1.  Authentication negotiation.</span></span> <span data-ttu-id="992ea-139">Isso é opcional se o cliente já tiver as credenciais apropriadas.</span><span class="sxs-lookup"><span data-stu-id="992ea-139">This is optional if the client already has the proper credentials.</span></span> <span data-ttu-id="992ea-140">Essa fase pode ser feita por meio de transporte seguro ou por trocas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="992ea-140">This phase can be done through secure transport, or through message exchanges.</span></span> <span data-ttu-id="992ea-141">No último caso, podem ocorrer trocas de 1 ou 2 RST/RSTR.</span><span class="sxs-lookup"><span data-stu-id="992ea-141">In the latter case, 1 or 2 RST/RSTR exchanges can happen.</span></span> <span data-ttu-id="992ea-142">Para essas trocas, os rastreamentos são emitidos em novas atividades de solicitação/resposta, conforme projetado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="992ea-142">For these exchanges, traces are emitted in new request/reply activities as previously designed.</span></span><br /><span data-ttu-id="992ea-143">2.  O SCT (estabelecimento de sessão segura), no qual uma troca de RST/RSTR acontece aqui.</span><span class="sxs-lookup"><span data-stu-id="992ea-143">2.  Secure session establishment (SCT), in which one RST/RSTR exchange happens here.</span></span> <span data-ttu-id="992ea-144">Isso tem as mesmas atividades de ambiente descritas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="992ea-144">This has the same ambient activities as described previously.</span></span>|<span data-ttu-id="992ea-145">-Rastreamentos do Exchange</span><span class="sxs-lookup"><span data-stu-id="992ea-145">-   Exchange traces</span></span><br /><span data-ttu-id="992ea-146">-Canal seguro estabelecido</span><span class="sxs-lookup"><span data-stu-id="992ea-146">-   Secure channel established</span></span><br /><span data-ttu-id="992ea-147">-Compartilhe segredos obtidos.</span><span class="sxs-lookup"><span data-stu-id="992ea-147">-   Share secrets obtained.</span></span>|  
  
> [!NOTE]
> <span data-ttu-id="992ea-148">No modo de segurança mista, a autenticação de negociação ocorre em intercâmbios binários, mas o SCT acontece na troca de mensagens.</span><span class="sxs-lookup"><span data-stu-id="992ea-148">In mixed security mode, negotiation authentication happens in binary exchanges, but SCT happens in message exchange.</span></span> <span data-ttu-id="992ea-149">No modo de transporte puro, a negociação ocorre apenas no transporte sem atividades adicionais.</span><span class="sxs-lookup"><span data-stu-id="992ea-149">In pure transport mode, negotiation happens only in transport with no additional activities.</span></span>  
  
## <a name="message-encryption-and-decryption"></a><span data-ttu-id="992ea-150">Criptografia e descriptografia de mensagens</span><span class="sxs-lookup"><span data-stu-id="992ea-150">Message Encryption and Decryption</span></span>  
 <span data-ttu-id="992ea-151">A tabela a seguir lista as atividades e os rastreamentos para criptografia/descriptografia de mensagens, bem como autenticação de assinatura.</span><span class="sxs-lookup"><span data-stu-id="992ea-151">The following table lists the activities and traces for message encryption/decryption, as well as signature authentication.</span></span>  
  
||<span data-ttu-id="992ea-152">Transporte seguro</span><span class="sxs-lookup"><span data-stu-id="992ea-152">Secure Transport</span></span><br /><br /> <span data-ttu-id="992ea-153">(HTTPS, SSL) e camada de mensagem segura</span><span class="sxs-lookup"><span data-stu-id="992ea-153">(HTTPS, SSL) and Secure Message Layer</span></span><br /><br /> <span data-ttu-id="992ea-154">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="992ea-154">(WSHTTP)</span></span>|  
|-|---------------------------------------------------------------------------------|  
|<span data-ttu-id="992ea-155">Tempo em que a criptografia/descriptografia de mensagens, bem como a autenticação de assinatura ocorre</span><span class="sxs-lookup"><span data-stu-id="992ea-155">Time when message encryption/decryption, as well as signature authentication happens</span></span>|<span data-ttu-id="992ea-156">Na mensagem recebida</span><span class="sxs-lookup"><span data-stu-id="992ea-156">On message received</span></span>|  
|<span data-ttu-id="992ea-157">Atividades</span><span class="sxs-lookup"><span data-stu-id="992ea-157">Activities</span></span>|<span data-ttu-id="992ea-158">Os rastreamentos são emitidos na atividade processAction no cliente e no servidor.</span><span class="sxs-lookup"><span data-stu-id="992ea-158">Traces are emitted in the ProcessAction activity on the client and server.</span></span>|  
|<span data-ttu-id="992ea-159">Rastreamentos</span><span class="sxs-lookup"><span data-stu-id="992ea-159">Traces</span></span>|<span data-ttu-id="992ea-160">-sendSecurityHeader (remetente):</span><span class="sxs-lookup"><span data-stu-id="992ea-160">-   sendSecurityHeader (sender):</span></span><br /><span data-ttu-id="992ea-161">-Assinar mensagem</span><span class="sxs-lookup"><span data-stu-id="992ea-161">-   Sign message</span></span><br /><span data-ttu-id="992ea-162">-Criptografar dados de solicitação</span><span class="sxs-lookup"><span data-stu-id="992ea-162">-   Encrypt request data</span></span><br /><span data-ttu-id="992ea-163">-receiveSecurityHeader (destinatário):</span><span class="sxs-lookup"><span data-stu-id="992ea-163">-   receiveSecurityHeader (receiver):</span></span><br /><span data-ttu-id="992ea-164">-Verificar assinatura</span><span class="sxs-lookup"><span data-stu-id="992ea-164">-   Verify signature</span></span><br /><span data-ttu-id="992ea-165">-Descriptografar dados de resposta</span><span class="sxs-lookup"><span data-stu-id="992ea-165">-   Decrypt response data</span></span><br /><span data-ttu-id="992ea-166">-Autenticação</span><span class="sxs-lookup"><span data-stu-id="992ea-166">-   Authentication</span></span>|  
  
> [!NOTE]
> <span data-ttu-id="992ea-167">No modo de transporte puro, a criptografia/descriptografia de mensagens ocorre apenas no transporte sem atividades adicionais.</span><span class="sxs-lookup"><span data-stu-id="992ea-167">In pure transport mode, message encryption/decryption happens only in transport with no additional activities.</span></span>  
  
## <a name="authorization-and-verification"></a><span data-ttu-id="992ea-168">Autorização e verificação</span><span class="sxs-lookup"><span data-stu-id="992ea-168">Authorization and Verification</span></span>  
 <span data-ttu-id="992ea-169">A tabela a seguir lista as atividades e os rastreamentos para autorização.</span><span class="sxs-lookup"><span data-stu-id="992ea-169">The following table lists the activities and traces for authorization.</span></span>  
  
||<span data-ttu-id="992ea-170">Hora em que a autorização ocorre</span><span class="sxs-lookup"><span data-stu-id="992ea-170">Time when authorization happens</span></span>|<span data-ttu-id="992ea-171">Atividades</span><span class="sxs-lookup"><span data-stu-id="992ea-171">Activities</span></span>|<span data-ttu-id="992ea-172">Rastreamentos</span><span class="sxs-lookup"><span data-stu-id="992ea-172">Traces</span></span>|  
|-|-------------------------------------|----------------|------------|  
|<span data-ttu-id="992ea-173">Local (padrão)</span><span class="sxs-lookup"><span data-stu-id="992ea-173">Local (default)</span></span>|<span data-ttu-id="992ea-174">Depois que a mensagem é descriptografada no servidor</span><span class="sxs-lookup"><span data-stu-id="992ea-174">After the message is decrypted on the server</span></span>|<span data-ttu-id="992ea-175">Os rastreamentos são emitidos na atividade processAction no servidor.</span><span class="sxs-lookup"><span data-stu-id="992ea-175">Traces are emitted in the ProcessAction activity at the server.</span></span>|<span data-ttu-id="992ea-176">Autorizado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="992ea-176">User authorized.</span></span>|  
|<span data-ttu-id="992ea-177">Remoto</span><span class="sxs-lookup"><span data-stu-id="992ea-177">Remote</span></span>|<span data-ttu-id="992ea-178">Depois que a mensagem é descriptografada no servidor</span><span class="sxs-lookup"><span data-stu-id="992ea-178">After the message is decrypted on the server</span></span>|<span data-ttu-id="992ea-179">Os rastreamentos são emitidos em uma nova atividade chamada pela atividade processAction.</span><span class="sxs-lookup"><span data-stu-id="992ea-179">Traces are emitted in a new activity invoked by the ProcessAction activity.</span></span>|<span data-ttu-id="992ea-180">Autorizado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="992ea-180">User authorized.</span></span>|
