---
title: "Propagação de ID de atividade"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: cd1c1ae5-cc8a-4f51-90c9-f7b476bcfe70
caps.latest.revision: "6"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 7bb8ae9388a9f56ad35697a391137c06ed3ae80b
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/02/2017
---
# <a name="activity-id-propagation"></a><span data-ttu-id="8494a-102">Propagação de ID de atividade</span><span class="sxs-lookup"><span data-stu-id="8494a-102">Activity ID Propagation</span></span>
<span data-ttu-id="8494a-103">Propagação acontece quando o rastreamento de atividades de ServiceModel está habilitado (ServiceModel propagação) ou desabilitado (propagação de atividade de usuário para usuário).</span><span class="sxs-lookup"><span data-stu-id="8494a-103">Propagation happens when ServiceModel activity tracing is enabled (ServiceModel propagation) or disabled (User-to-User activity propagation).</span></span>  
  
## <a name="servicemodel-activity-tracing-is-enabled"></a><span data-ttu-id="8494a-104">Rastreamento de atividade de ServiceModel está habilitado</span><span class="sxs-lookup"><span data-stu-id="8494a-104">ServiceModel Activity Tracing is Enabled</span></span>  
 <span data-ttu-id="8494a-105">Se ServiceModel ActivityTracing estiver habilitado, a propagação ocorre entre ProcessAction atividades.</span><span class="sxs-lookup"><span data-stu-id="8494a-105">If ServiceModel ActivityTracing is enabled, propagation happens between ProcessAction activities.</span></span>  
  
### <a name="server"></a><span data-ttu-id="8494a-106">Servidor</span><span class="sxs-lookup"><span data-stu-id="8494a-106">Server</span></span>  
 <span data-ttu-id="8494a-107">Quando o `propagateActivity` atributo é definido como `true` no cliente e servidor, a ID do `ProcessAction` atividade no servidor é idêntica ao ID no propagadas `ActivityId` cabeçalho da mensagem.</span><span class="sxs-lookup"><span data-stu-id="8494a-107">When the `propagateActivity` attribute is set to `true` on both the client and server, the ID of the `ProcessAction` activity in the server is identical to the ID in the propagated `ActivityId` message header.</span></span>  
  
 <span data-ttu-id="8494a-108">Quando nenhum `ActivityId` cabeçalho está presente na mensagem (ou seja, `propagateActivity` = `false` no cliente), ou quando `propagateActivity` = `false` no servidor, o servidor gera uma nova ID de atividade.</span><span class="sxs-lookup"><span data-stu-id="8494a-108">When no `ActivityId` header is present in the message (that is, `propagateActivity`=`false` on the client), or when `propagateActivity`=`false` on the server, the server generates a new activity ID.</span></span>  
  
### <a name="client"></a><span data-ttu-id="8494a-109">Cliente</span><span class="sxs-lookup"><span data-stu-id="8494a-109">Client</span></span>  
 <span data-ttu-id="8494a-110">Se o cliente tem thread único de forma síncrona, o cliente ignora as configurações de `propagateActivity` no cliente ou servidor.</span><span class="sxs-lookup"><span data-stu-id="8494a-110">If the client is synchronously single threaded, the client disregards any settings of `propagateActivity` at the client or server.</span></span> <span data-ttu-id="8494a-111">Em vez disso, a resposta é tratada na atividade de solicitação.</span><span class="sxs-lookup"><span data-stu-id="8494a-111">Instead, the response is handled in the request activity.</span></span> <span data-ttu-id="8494a-112">Se o cliente é assíncrono ou síncrono multithread, `propagateActivity` = `true` no cliente e há um cabeçalho de identificação de atividade na mensagem enviada pelo servidor, o cliente recupera a ID de atividade da mensagem e transfere para o Atividade de ação do processo que contém a ID de atividade propagadas.</span><span class="sxs-lookup"><span data-stu-id="8494a-112">If the client is asynchronous or synchronous multithreaded, `propagateActivity`=`true` in the client, and there is an activity ID header in the message sent by the server, the client retrieves the activity ID from the message, and transfers to the Process Action activity that contains the propagated activity ID.</span></span> <span data-ttu-id="8494a-113">Caso contrário, o cliente transfere de atividade de mensagens do processo para uma nova atividade de ação de processo.</span><span class="sxs-lookup"><span data-stu-id="8494a-113">Otherwise, the client transfers from Process Message activity to a new Process Action activity.</span></span> <span data-ttu-id="8494a-114">Essa transferência extra para uma nova atividade de ação de processo é feita para manter a consistência.</span><span class="sxs-lookup"><span data-stu-id="8494a-114">This extra transfer to a new Process Action activity is done for consistency.</span></span> <span data-ttu-id="8494a-115">Dentro dessa atividade, o cliente recupera a ID de atividade da atividade BeginCall do contexto de thread local, quando o thread está alocado para o processamento de mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="8494a-115">Inside this activity, the client retrieves the activity ID of the BeginCall activity from the local thread context, when the thread is allocated for response message processing.</span></span> <span data-ttu-id="8494a-116">Em seguida, transfere para a atividade de ação do processo inicial.</span><span class="sxs-lookup"><span data-stu-id="8494a-116">It then transfers to the initial Process Action activity.</span></span>  
  
 <span data-ttu-id="8494a-117">Se o cliente é duplex, o cliente atua como servidor ao receber a mensagem.</span><span class="sxs-lookup"><span data-stu-id="8494a-117">If the client is duplex, the client acts as server on receiving the message.</span></span>  
  
### <a name="propagation-in-fault-messages"></a><span data-ttu-id="8494a-118">Propagação em mensagens de falha</span><span class="sxs-lookup"><span data-stu-id="8494a-118">Propagation in Fault Messages</span></span>  
 <span data-ttu-id="8494a-119">Não há nenhuma diferença na manipulação válido e mensagens de falha.</span><span class="sxs-lookup"><span data-stu-id="8494a-119">There is no difference in handling valid and fault messages.</span></span> <span data-ttu-id="8494a-120">Se `propagateActivity` = `true`, a ID de atividade adicionada para os cabeçalhos de mensagem de falha SOAP é idêntica à atividade de ambiente.</span><span class="sxs-lookup"><span data-stu-id="8494a-120">If `propagateActivity`=`true`, the activity ID added to the SOAP fault message headers is identical to the ambient activity.</span></span>  
  
## <a name="servicemodel-activity-tracing-is-disabled"></a><span data-ttu-id="8494a-121">Rastreamento de atividade de ServiceModel está desabilitado</span><span class="sxs-lookup"><span data-stu-id="8494a-121">ServiceModel Activity Tracing is Disabled</span></span>  
 <span data-ttu-id="8494a-122">Se ServiceModel ActivityTracing estiver desabilitada, a propagação ocorre entre as atividades de código do usuário diretamente, sem passar por meio de atividades de ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8494a-122">If ServiceModel ActivityTracing is disabled, propagation occurs between user code activities directly without going through ServiceModel activities.</span></span> <span data-ttu-id="8494a-123">Uma ID de atividade definida pelo usuário também é propagada por meio do cabeçalho de identificação de atividade da mensagem.</span><span class="sxs-lookup"><span data-stu-id="8494a-123">A user-defined activity ID is also propagated through the message activity ID header.</span></span>  
  
 <span data-ttu-id="8494a-124">Se `propagateActivity` = `true` e `ActivityTracing` = `off` para um ouvinte de rastreamento de ServiceModel (independentemente se o rastreamento está habilitado no ServiceModel), o seguinte acontece no cliente ou servidor:</span><span class="sxs-lookup"><span data-stu-id="8494a-124">If `propagateActivity`=`true` and `ActivityTracing`=`off` for a ServiceModel trace listener (regardless of whether tracing is enabled on ServiceModel), the following happen on either the client or server:</span></span>  
  
-   <span data-ttu-id="8494a-125">Enviar resposta ou solicitação de operação, a ID de atividade no TLS é propagada fora do código do usuário até que uma mensagem é formada.</span><span class="sxs-lookup"><span data-stu-id="8494a-125">On operation request or sending response, the activity ID in TLS is propagated out of user code until a message is formed.</span></span> <span data-ttu-id="8494a-126">Um cabeçalho de identificação de atividade também será inserido na mensagem antes de serem enviado.</span><span class="sxs-lookup"><span data-stu-id="8494a-126">An activity ID header is also inserted into the message before it is sent.</span></span>  
  
-   <span data-ttu-id="8494a-127">No recebimento de solicitação ou resposta de recebimento, a ID da atividade é recuperada do cabeçalho da mensagem assim que o objeto de mensagem recebida é criado.</span><span class="sxs-lookup"><span data-stu-id="8494a-127">On receiving request or receiving response, the activity ID is retrieved from the message header as soon as the received message object is created.</span></span> <span data-ttu-id="8494a-128">A ID de atividade no TLS é propagada assim que a mensagem desaparecerá do escopo até que o código do usuário for atingido.</span><span class="sxs-lookup"><span data-stu-id="8494a-128">The activity ID in TLS is propagated as soon as the message disappears from scope until user code is reached.</span></span>  
  
 <span data-ttu-id="8494a-129">Essas ações garantem que o usuário rastreamentos aparecerão na mesma atividade se a propagação está ativa.</span><span class="sxs-lookup"><span data-stu-id="8494a-129">These actions guarantee that user traces will appear in the same activity if propagation is on.</span></span> <span data-ttu-id="8494a-130">No entanto, ele não dá nenhuma garantia em rastreamentos de ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8494a-130">However, it makes no guarantee on ServiceModel traces.</span></span> <span data-ttu-id="8494a-131">Rastreamentos de ServiceModel ocorrem em uma atividade de código do usuário apenas se o processamento desses rastreamentos for executado no mesmo thread em que a atividade de código do usuário foi definida.</span><span class="sxs-lookup"><span data-stu-id="8494a-131">ServiceModel traces occur in a user code activity only if the processing of those traces is executed on the same thread where the user code activity was set.</span></span>  
  
 <span data-ttu-id="8494a-132">Em geral, os rastreamentos de ServiceModel podem ser observados nos seguintes locais:</span><span class="sxs-lookup"><span data-stu-id="8494a-132">In general, ServiceModel traces can be observed in the following places:</span></span>  
  
-   <span data-ttu-id="8494a-133">Se o rastreamento de ServiceModel está desabilitado, todos os rastreamentos emitidos aparecem nas atividades do usuário.</span><span class="sxs-lookup"><span data-stu-id="8494a-133">If ServiceModel tracing is disabled, all emitted traces appear in user activities.</span></span> <span data-ttu-id="8494a-134">Se a propagação está habilitada no cliente e servidor, os rastreamentos serão na mesma atividade.</span><span class="sxs-lookup"><span data-stu-id="8494a-134">If propagation is enabled at both the server and client, these traces will be in the same activity.</span></span>  
  
-   <span data-ttu-id="8494a-135">Se o rastreamento de ServiceModel está habilitado, mas ActivityTracing está desabilitado, rastreamentos de usuário aparecem na mesma atividade se propagação estiver habilitada em ambas as extremidades.</span><span class="sxs-lookup"><span data-stu-id="8494a-135">If ServiceModel tracing is enabled, but ActivityTracing is disabled, user traces appear in the same activity if propagation is enabled on both ends.</span></span> <span data-ttu-id="8494a-136">Rastreamentos de ServiceModel aparecem na atividade 0000 padrão, a menos que eles ocorrerem no mesmo thread que o processamento de código do usuário em que a atividade é definida inicialmente.</span><span class="sxs-lookup"><span data-stu-id="8494a-136">ServiceModel traces appear in the default 0000 activity, unless they occur in the same thread as the user code processing where the activity is initially set.</span></span>  
  
-   <span data-ttu-id="8494a-137">Se o rastreamento de ServiceModel e ActivityTracing estiverem habilitados, rastreamentos de usuário aparecem nas atividades definidas pelo usuário e rastreamentos de ServiceModel aparecem nas atividades definidas ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8494a-137">If both ServiceModel tracing and ActivityTracing are enabled, user traces appear in user-defined activities, and ServiceModel traces appear in ServiceModel-defined activities.</span></span> <span data-ttu-id="8494a-138">Propagação ocorre no nível de ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8494a-138">Propagation happens at ServiceModel level.</span></span>
