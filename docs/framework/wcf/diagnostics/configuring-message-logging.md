---
title: Configurando registros de mensagens em log
ms.date: 03/30/2017
helpviewer_keywords:
- message logging [WCF]
ms.assetid: 0ff4c857-8f09-4b85-9dc0-89084706e4c9
ms.openlocfilehash: 5b4da744151d8b667c0f944b1a0d51d1251bfae5
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64652006"
---
# <a name="configuring-message-logging"></a><span data-ttu-id="9ea7f-102">Configurando registros de mensagens em log</span><span class="sxs-lookup"><span data-stu-id="9ea7f-102">Configuring Message Logging</span></span>
<span data-ttu-id="9ea7f-103">Este tópico descreve como você pode configurar o log de mensagens para diferentes cenários.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-103">This topic describes how you can configure message logging for different scenarios.</span></span>  
  
## <a name="enabling-message-logging"></a><span data-ttu-id="9ea7f-104">Habilitando o log de mensagem</span><span class="sxs-lookup"><span data-stu-id="9ea7f-104">Enabling Message Logging</span></span>  
 <span data-ttu-id="9ea7f-105">Por padrão, o Windows Communication Foundation (WCF) não registra mensagens.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-105">Windows Communication Foundation (WCF) does not log messages by default.</span></span> <span data-ttu-id="9ea7f-106">Para ativar o log de mensagens, você deve adicionar um ouvinte de rastreamento para o `System.ServiceModel.MessageLogging` fonte de rastreamento e definir atributos para o `<messagelogging>` elemento no arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-106">To activate message logging, you must add a trace listener to the `System.ServiceModel.MessageLogging` trace source and set attributes for the `<messagelogging>` element in the configuration file.</span></span>  
  
 <span data-ttu-id="9ea7f-107">O exemplo a seguir mostra como habilitar o registro em log e especificar opções adicionais.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-107">The following example shows how to enable logging and specify additional options.</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
    <source name="System.ServiceModel.MessageLogging">  
      <listeners>  
         <add name="messages"  
              type="System.Diagnostics.XmlWriterTraceListener"  
              initializeData="c:\logs\messages.svclog" />  
        </listeners>  
    </source>  
  </sources>  
</system.diagnostics>  
  
<system.serviceModel>  
  <diagnostics>  
    <messageLogging   
         logEntireMessage="true"   
         logMalformedMessages="false"  
         logMessagesAtServiceLevel="true"   
         logMessagesAtTransportLevel="false"  
         maxMessagesToLog="3000"  
         maxSizeOfMessageToLog="2000"/>  
  </diagnostics>  
</system.serviceModel>  
```  
  
 <span data-ttu-id="9ea7f-108">Para obter mais informações sobre as configurações de registro em log de mensagem, consulte [as configurações recomendadas para rastreamento e registro em log de mensagem](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md).</span><span class="sxs-lookup"><span data-stu-id="9ea7f-108">For more information about message logging settings, see [Recommended Settings for Tracing and Message Logging](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md).</span></span>  
  
 <span data-ttu-id="9ea7f-109">Você pode usar `add` para especificar o nome e tipo do ouvinte que você deseja usar.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-109">You can use `add` to specify the name and type of the listener you want to use.</span></span> <span data-ttu-id="9ea7f-110">Na configuração de exemplo, o ouvinte é denominado "messages" e adiciona o ouvinte de rastreamento padrão do .NET Framework (`System.Diagnostics.XmlWriterTraceListener`) como o tipo a ser usado.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-110">In the example configuration, the Listener is named "messages" and adds the standard .NET Framework trace listener (`System.Diagnostics.XmlWriterTraceListener`) as the type to use.</span></span> <span data-ttu-id="9ea7f-111">Se você usar `System.Diagnostics.XmlWriterTraceListener`, você deve especificar o local do arquivo de saída e o nome no arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-111">If you use `System.Diagnostics.XmlWriterTraceListener`, you must specify the output file location and name in the configuration file.</span></span> <span data-ttu-id="9ea7f-112">Isso é feito definindo `initializeData` para o nome do arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-112">This is done by setting `initializeData` to the name of the log file.</span></span> <span data-ttu-id="9ea7f-113">Caso contrário, o sistema gerará uma exceção.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-113">Otherwise, the system throws an exception.</span></span> <span data-ttu-id="9ea7f-114">Você também pode implementar um ouvinte personalizado que emite os logs para um arquivo padrão.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-114">You can also implement a custom listener that emits logs to a default file.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9ea7f-115">Como registro em log de mensagem acessa o espaço em disco, você deve limitar o número de mensagens que são gravados em disco para um serviço específico.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-115">Because message logging accesses disk space, you should limit the number of messages that are written to disk for a particular service.</span></span> <span data-ttu-id="9ea7f-116">Quando o limite da mensagem é atingido, um rastreamento no nível de informações é produzido e parar todas as atividades de registro em log de mensagem.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-116">When the message limit is reached, a trace at the Information level is produced and all message logging activities stop.</span></span>  
  
 <span data-ttu-id="9ea7f-117">O nível de log, bem como as opções adicionais, são discutidas na seção de nível de registro em log e as opções.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-117">The logging level, as well as the additional options, are discussed in the Logging Level and Options section.</span></span>  
  
 <span data-ttu-id="9ea7f-118">O `switchValue` atributo de um `source` só é válido para o rastreamento.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-118">The `switchValue` attribute of a `source` is only valid for tracing.</span></span> <span data-ttu-id="9ea7f-119">Se você especificar uma `switchValue` de atributo para o `System.ServiceModel.MessageLogging` origem de rastreamento como segue, ele não tem nenhum efeito.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-119">If you specify a `switchValue` attribute for the `System.ServiceModel.MessageLogging` trace source as follows, it has no effect.</span></span>  
  
```xml  
<source name="System.ServiceModel.MessageLogging" switchValue="Verbose">  
```  
  
 <span data-ttu-id="9ea7f-120">Se você quiser desabilitar a origem de rastreamento, você deve usar o `logMessagesAtServiceLevel`, `logMalformedMessages`, e `logMessagesAtTransportLevel` atributos do `messageLogging` elemento em vez disso.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-120">If you want to disable the trace source, you should use the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element instead.</span></span> <span data-ttu-id="9ea7f-121">Você deve definir todos esses atributos para `false`.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-121">You should set all these attributes to `false`.</span></span> <span data-ttu-id="9ea7f-122">Isso pode ser feito usando o arquivo de configuração no exemplo de código anterior, por meio da interface do Editor de configuração de UI, ou usando o WMI.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-122">This can be done by using the configuration file in the previous code example, through the Configuration Editor UI interface, or using WMI.</span></span> <span data-ttu-id="9ea7f-123">Para obter mais informações sobre a ferramenta Editor de configuração, consulte [ferramenta de Editor de configuração (SvcConfigEditor.exe)](../../../../docs/framework/wcf/configuration-editor-tool-svcconfigeditor-exe.md).</span><span class="sxs-lookup"><span data-stu-id="9ea7f-123">For more information about the Configuration Editor tool, see [Configuration Editor Tool (SvcConfigEditor.exe)](../../../../docs/framework/wcf/configuration-editor-tool-svcconfigeditor-exe.md).</span></span> <span data-ttu-id="9ea7f-124">Para obter mais informações sobre WMI, consulte [usando o Windows Management Instrumentation para diagnóstico](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="9ea7f-124">For more information about WMI, see [Using Windows Management Instrumentation for Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span></span>  
  
## <a name="logging-levels-and-options"></a><span data-ttu-id="9ea7f-125">Níveis de log e opções</span><span class="sxs-lookup"><span data-stu-id="9ea7f-125">Logging Levels and Options</span></span>  
 <span data-ttu-id="9ea7f-126">Mensagens de entrada, registro em log ocorre imediatamente depois que a mensagem é formada, imediatamente antes da mensagem obtém ao código do usuário no nível de serviço, e quando mensagens malformadas são detectadas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-126">For incoming messages, logging happens immediately after the message is formed, immediately before the message gets to user code in the service level, and when malformed messages are detected.</span></span>  
  
 <span data-ttu-id="9ea7f-127">Para mensagens de saída, o registro em log ocorre imediatamente depois que a mensagem sair do código do usuário e imediatamente antes da mensagem é enviada durante a transmissão.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-127">For outgoing messages, logging happens immediately after the message leaves user code and immediately before the message goes on the wire.</span></span>  
  
 <span data-ttu-id="9ea7f-128">O WCF registra mensagens em dois níveis diferentes, serviço e transporte.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-128">WCF logs messages at two different levels, service and transport.</span></span> <span data-ttu-id="9ea7f-129">Mensagens malformadas também são registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-129">Malformed messages are also logged.</span></span> <span data-ttu-id="9ea7f-130">As três categorias são independentes uns dos outros e podem ser ativadas separadamente na configuração.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-130">The three categories are independent from each other and can be activated separately in configuration.</span></span>  
  
 <span data-ttu-id="9ea7f-131">Você pode controlar o nível de log definindo o `logMessagesAtServiceLevel`, `logMalformedMessages`, e `logMessagesAtTransportLevel` atributos do `messageLogging` elemento.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-131">You can control the logging level by setting the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element.</span></span>  
  
### <a name="service-level"></a><span data-ttu-id="9ea7f-132">Nível de serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-132">Service Level</span></span>  
 <span data-ttu-id="9ea7f-133">As mensagens registradas nesta camada estão prestes a insira (no recebimento) ou deixe (envio) código do usuário.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-133">Messages logged at this layer are about to enter (on receiving) or leave (on sending) user code.</span></span> <span data-ttu-id="9ea7f-134">Se os filtros tiverem sido definidos, apenas as mensagens que correspondem aos filtros são registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-134">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="9ea7f-135">Caso contrário, todas as mensagens no nível de serviço estão registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-135">Otherwise, all messages at the service level are logged.</span></span> <span data-ttu-id="9ea7f-136">Mensagens de infraestrutura (transações, canal de mesmo nível e segurança) também são registradas nesse nível, com exceção de mensagens do sistema de mensagens confiável.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-136">Infrastructure messages (transactions, peer channel, and security) are also logged at this level, except for Reliable Messaging messages.</span></span> <span data-ttu-id="9ea7f-137">Em mensagens transmitidas, somente os cabeçalhos são registrados.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-137">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="9ea7f-138">Além disso, mensagens seguras são registradas descriptografados nesse nível.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-138">In addition, secure messages are logged decrypted at this level.</span></span>  
  
### <a name="transport-level"></a><span data-ttu-id="9ea7f-139">Nível de transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-139">Transport Level</span></span>  
 <span data-ttu-id="9ea7f-140">As mensagens registradas nesta camada estão prontas para serem codificados ou decodificados de ou depois de transporte durante a transmissão.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-140">Messages logged at this layer are ready to be encoded or decoded for or after transportation on the wire.</span></span> <span data-ttu-id="9ea7f-141">Se os filtros tiverem sido definidos, apenas as mensagens que correspondem aos filtros são registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-141">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="9ea7f-142">Caso contrário, todas as mensagens na camada de transporte são registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-142">Otherwise, all messages at the transport layer are logged.</span></span> <span data-ttu-id="9ea7f-143">Todas as mensagens de infraestrutura são registradas nessa camada, incluindo mensagens de reliable messaging.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-143">All infrastructure messages are logged at this layer, including reliable messaging messages.</span></span> <span data-ttu-id="9ea7f-144">Em mensagens transmitidas, somente os cabeçalhos são registrados.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-144">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="9ea7f-145">Além disso, mensagens seguras são registradas como criptografado nesse nível, exceto se um transporte seguro, como o HTTPS é usado.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-145">In addition, secure messages are logged as encrypted at this level, except if a secure transport such as HTTPS is used.</span></span>  
  
### <a name="malformed-level"></a><span data-ttu-id="9ea7f-146">Nível malformado</span><span class="sxs-lookup"><span data-stu-id="9ea7f-146">Malformed Level</span></span>  
 <span data-ttu-id="9ea7f-147">Mensagens malformadas são mensagens que são rejeitadas pela pilha do WCF em qualquer estágio do processamento.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-147">Malformed messages are messages that are rejected by the WCF stack at any stage of processing.</span></span> <span data-ttu-id="9ea7f-148">Mensagens malformadas são registradas como-está: criptografados se estiverem, com XML não adequada e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-148">Malformed messages are logged as-is: encrypted if they are so, with non-proper XML, and so on.</span></span> <span data-ttu-id="9ea7f-149">`maxSizeOfMessageToLog` definido o tamanho da mensagem a ser registrada como CDATA.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-149">`maxSizeOfMessageToLog` defined the size of the message to be logged as CDATA.</span></span> <span data-ttu-id="9ea7f-150">Por padrão, `maxSizeOfMessageToLog` é igual a 256 K.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-150">By default, `maxSizeOfMessageToLog` is equal to 256K.</span></span> <span data-ttu-id="9ea7f-151">Para obter mais informações sobre esse atributo, consulte a seção de outras opções.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-151">For more information about this attribute, see the Other Options section.</span></span>  
  
### <a name="other-options"></a><span data-ttu-id="9ea7f-152">Outras opções</span><span class="sxs-lookup"><span data-stu-id="9ea7f-152">Other Options</span></span>  
 <span data-ttu-id="9ea7f-153">Além dos níveis de registro em log, o usuário pode especificar as seguintes opções:</span><span class="sxs-lookup"><span data-stu-id="9ea7f-153">In addition to the logging levels, the user can specify the following options:</span></span>  
  
- <span data-ttu-id="9ea7f-154">Toda mensagem de log (`logEntireMessage` atributo): Esse valor Especifica se a mensagem inteira (cabeçalho de mensagem e corpo) é registrada.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-154">Log Entire Message (`logEntireMessage` attribute): This value specifies whether the entire message (message header and body) is logged.</span></span> <span data-ttu-id="9ea7f-155">O valor padrão é `false`, que significa que apenas o cabeçalho está registrado.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-155">The default value is `false`, meaning that only the header is logged.</span></span> <span data-ttu-id="9ea7f-156">Essa configuração afeta os níveis de log de mensagem de transporte e de serviço...</span><span class="sxs-lookup"><span data-stu-id="9ea7f-156">This setting affects service and transport message logging levels..</span></span>  
  
- <span data-ttu-id="9ea7f-157">Máximo de mensagens para fazer logon (`maxMessagesToLog` atributo): Esse valor Especifica o número máximo de mensagens para fazer logon.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-157">Max messages to log (`maxMessagesToLog` attribute): This value specifies the maximum number of messages to log.</span></span> <span data-ttu-id="9ea7f-158">Todas as mensagens (serviço de transporte e mensagens malformadas) são contadas para essa cota.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-158">All messages (service, transport, and malformed messages) are counted towards this quota.</span></span> <span data-ttu-id="9ea7f-159">Quando a cota for atingida, um rastreamento é emitido e nenhuma mensagem adicional será registrada.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-159">When the quota is reached, a trace is emitted and no additional message is logged.</span></span> <span data-ttu-id="9ea7f-160">O valor padrão é 10000.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-160">The default value is 10000.</span></span>  
  
- <span data-ttu-id="9ea7f-161">Tamanho máximo de mensagem a ser registrada (`maxSizeOfMessageToLog` atributo): Esse valor Especifica o tamanho máximo de mensagens para fazer logon em bytes.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-161">Max size of message to log (`maxSizeOfMessageToLog` attribute): This value specifies the maximum size of messages to log in bytes.</span></span> <span data-ttu-id="9ea7f-162">As mensagens que excedem o limite de tamanho não são registradas e nenhuma outra atividade é executada para a mensagem.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-162">Messages that exceed the size limit are not logged, and no other activity is performed for that message.</span></span> <span data-ttu-id="9ea7f-163">Essa configuração afeta todos os níveis de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-163">This setting affects all trace levels.</span></span> <span data-ttu-id="9ea7f-164">Se o rastreamento de ServiceModel estiver ativada, um rastreamento de nível de aviso é emitido no primeiro ponto de registro em log (ServiceModelSend \* ou TransportReceive) para notificar o usuário.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-164">If ServiceModel tracing is on, a Warning level trace is emitted at the first logging point (ServiceModelSend\* or TransportReceive) to notify the user.</span></span> <span data-ttu-id="9ea7f-165">O valor padrão para mensagens de nível transporte e de nível de serviço é de 256K, enquanto o valor padrão para mensagens malformadas for 4K.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-165">The default value for service level and transport level messages is 256K, while the default value for malformed messages is 4K.</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="9ea7f-166">O tamanho da mensagem que é calculado a ser comparada com `maxSizeOfMessageToLog` é o tamanho da mensagem na memória antes da serialização.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-166">The message size that is computed to compare against `maxSizeOfMessageToLog` is the message size in memory before serialization.</span></span> <span data-ttu-id="9ea7f-167">Esse tamanho pode ser diferente do que o comprimento real da cadeia de caracteres de mensagem que está sendo registrada e, em muitas ocasiões em que é maior do que o tamanho real.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-167">This size can differ from the actual length of the message string that is being logged, and in many occasions is bigger than the actual size.</span></span> <span data-ttu-id="9ea7f-168">Como resultado, as mensagens não podem ser registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-168">As a result, messages may not be logged.</span></span> <span data-ttu-id="9ea7f-169">Você pode considerar esse fato, especificando o `maxSizeOfMessageToLog` atributo a ser 10% maior que o tamanho da mensagem esperada.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-169">You can account for this fact by specifying the `maxSizeOfMessageToLog` attribute to be 10% larger than the expected message size.</span></span> <span data-ttu-id="9ea7f-170">Além disso, se mensagens malformadas são registradas, o espaço em disco utilizado pelos logs de mensagem pode ser até 5 vezes o tamanho do valor especificado por `maxSizeOfMessageToLog`.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-170">In addition, if malformed messages are logged, the actual disk space utilized by the message logs can be up to 5 times the size of the value specified by `maxSizeOfMessageToLog`.</span></span>  
  
 <span data-ttu-id="9ea7f-171">Se nenhum ouvinte de rastreamento é definido no arquivo de configuração, nenhuma saída de log é gerada, independentemente do nível de log especificado.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-171">If no trace listener is defined in the configuration file, no logging output is generated regardless of the specified logging level.</span></span>  
  
 <span data-ttu-id="9ea7f-172">Opções de registro em log de mensagem, como os atributos descritos nesta seção, podem ser alteradas em tempo de execução usando o Windows Management Instrumentation (WMI).</span><span class="sxs-lookup"><span data-stu-id="9ea7f-172">Message logging options, such as the attributes described in this section, can be changed at runtime using Windows Management Instrumentation (WMI).</span></span> <span data-ttu-id="9ea7f-173">Isso pode ser feito, acessando o [AppDomainInfo](../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instância, que expõe essas propriedades Boolianas: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, e `LogMalformedMessages`.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-173">This can be done by accessing the [AppDomainInfo](../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, and `LogMalformedMessages`.</span></span> <span data-ttu-id="9ea7f-174">Portanto, se você configura um ouvinte de rastreamento para o log de mensagens, mas definir essas opções para `false` na configuração, você pode alterar a `true` quando o aplicativo está em execução.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-174">Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running.</span></span> <span data-ttu-id="9ea7f-175">Isso permite que o log de mensagens em tempo de execução com eficiência.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-175">This effectively enables message logging at runtime.</span></span> <span data-ttu-id="9ea7f-176">Da mesma forma, se você habilitar o registro em log no arquivo de configuração de mensagem, você pode desabilitá-lo em tempo de execução usando o WMI.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-176">Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.</span></span> <span data-ttu-id="9ea7f-177">Para obter mais informações, consulte [usando o Windows Management Instrumentation para diagnóstico](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="9ea7f-177">For more information, see [Using Windows Management Instrumentation for Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span></span>  
  
 <span data-ttu-id="9ea7f-178">O `source` campo em um log de mensagem especifica no contexto em que a mensagem é registrada: no envio/recebimento de uma mensagem de solicitação para uma solicitação-resposta ou solicitação de maneira 1, na camada de transporte ou de modelo de serviço ou, no caso de uma mensagem malformada.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-178">The `source` field in a message log specifies in which context the message is logged: when sending/receiving a request message, for a request-reply or 1-way request, at service model or transport layer, or in the case of a malformed message.</span></span>  
  
 <span data-ttu-id="9ea7f-179">Para mensagens malformadas, `source` é igual a `Malformed`.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-179">For malformed messages, `source`  is equal to `Malformed`.</span></span> <span data-ttu-id="9ea7f-180">Caso contrário, a fonte tem os seguintes valores com base no contexto.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-180">Otherwise, source has the following values based on the context.</span></span>  
  
 <span data-ttu-id="9ea7f-181">Solicitação/resposta</span><span class="sxs-lookup"><span data-stu-id="9ea7f-181">For Request/Reply</span></span>  
  
||<span data-ttu-id="9ea7f-182">Enviar solicitação</span><span class="sxs-lookup"><span data-stu-id="9ea7f-182">Send Request</span></span>|<span data-ttu-id="9ea7f-183">Receber a solicitação</span><span class="sxs-lookup"><span data-stu-id="9ea7f-183">Receive Request</span></span>|<span data-ttu-id="9ea7f-184">Enviar resposta</span><span class="sxs-lookup"><span data-stu-id="9ea7f-184">Send Reply</span></span>|<span data-ttu-id="9ea7f-185">Receber resposta</span><span class="sxs-lookup"><span data-stu-id="9ea7f-185">Receive Reply</span></span>|  
|-|------------------|---------------------|----------------|-------------------|  
|<span data-ttu-id="9ea7f-186">Camada de modelo de serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-186">Service Model layer</span></span>|<span data-ttu-id="9ea7f-187">Serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-187">Service</span></span><br /><br /> <span data-ttu-id="9ea7f-188">Nível</span><span class="sxs-lookup"><span data-stu-id="9ea7f-188">Level</span></span><br /><br /> <span data-ttu-id="9ea7f-189">Enviar</span><span class="sxs-lookup"><span data-stu-id="9ea7f-189">Send</span></span><br /><br /> <span data-ttu-id="9ea7f-190">Solicitação</span><span class="sxs-lookup"><span data-stu-id="9ea7f-190">Request</span></span>|<span data-ttu-id="9ea7f-191">Serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-191">Service</span></span><br /><br /> <span data-ttu-id="9ea7f-192">Nível</span><span class="sxs-lookup"><span data-stu-id="9ea7f-192">Level</span></span><br /><br /> <span data-ttu-id="9ea7f-193">Receber</span><span class="sxs-lookup"><span data-stu-id="9ea7f-193">Receive</span></span><br /><br /> <span data-ttu-id="9ea7f-194">Solicitação</span><span class="sxs-lookup"><span data-stu-id="9ea7f-194">Request</span></span>|<span data-ttu-id="9ea7f-195">Serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-195">Service</span></span><br /><br /> <span data-ttu-id="9ea7f-196">Nível</span><span class="sxs-lookup"><span data-stu-id="9ea7f-196">Level</span></span><br /><br /> <span data-ttu-id="9ea7f-197">Enviar</span><span class="sxs-lookup"><span data-stu-id="9ea7f-197">Send</span></span><br /><br /> <span data-ttu-id="9ea7f-198">Resposta</span><span class="sxs-lookup"><span data-stu-id="9ea7f-198">Reply</span></span>|<span data-ttu-id="9ea7f-199">Serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-199">Service</span></span><br /><br /> <span data-ttu-id="9ea7f-200">Nível</span><span class="sxs-lookup"><span data-stu-id="9ea7f-200">Level</span></span><br /><br /> <span data-ttu-id="9ea7f-201">Receber</span><span class="sxs-lookup"><span data-stu-id="9ea7f-201">Receive</span></span><br /><br /> <span data-ttu-id="9ea7f-202">Resposta</span><span class="sxs-lookup"><span data-stu-id="9ea7f-202">Reply</span></span>|  
|<span data-ttu-id="9ea7f-203">camada de transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-203">Transport layer</span></span>|<span data-ttu-id="9ea7f-204">Transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-204">Transport</span></span><br /><br /> <span data-ttu-id="9ea7f-205">Enviar</span><span class="sxs-lookup"><span data-stu-id="9ea7f-205">Send</span></span>|<span data-ttu-id="9ea7f-206">Transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-206">Transport</span></span><br /><br /> <span data-ttu-id="9ea7f-207">Receber</span><span class="sxs-lookup"><span data-stu-id="9ea7f-207">Receive</span></span>|<span data-ttu-id="9ea7f-208">Transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-208">Transport</span></span><br /><br /> <span data-ttu-id="9ea7f-209">Enviar</span><span class="sxs-lookup"><span data-stu-id="9ea7f-209">Send</span></span>|<span data-ttu-id="9ea7f-210">Transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-210">Transport</span></span><br /><br /> <span data-ttu-id="9ea7f-211">Receber</span><span class="sxs-lookup"><span data-stu-id="9ea7f-211">Receive</span></span>|  
  
 <span data-ttu-id="9ea7f-212">Para a solicitação unidirecional</span><span class="sxs-lookup"><span data-stu-id="9ea7f-212">For One-way Request</span></span>  
  
||<span data-ttu-id="9ea7f-213">Enviar solicitação</span><span class="sxs-lookup"><span data-stu-id="9ea7f-213">Send Request</span></span>|<span data-ttu-id="9ea7f-214">Receber a solicitação</span><span class="sxs-lookup"><span data-stu-id="9ea7f-214">Receive Request</span></span>|  
|-|------------------|---------------------|  
|<span data-ttu-id="9ea7f-215">Camada de modelo de serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-215">Service Model layer</span></span>|<span data-ttu-id="9ea7f-216">Serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-216">Service</span></span><br /><br /> <span data-ttu-id="9ea7f-217">Nível</span><span class="sxs-lookup"><span data-stu-id="9ea7f-217">Level</span></span><br /><br /> <span data-ttu-id="9ea7f-218">Enviar</span><span class="sxs-lookup"><span data-stu-id="9ea7f-218">Send</span></span><br /><br /> <span data-ttu-id="9ea7f-219">Datagrama</span><span class="sxs-lookup"><span data-stu-id="9ea7f-219">Datagram</span></span>|<span data-ttu-id="9ea7f-220">Serviço</span><span class="sxs-lookup"><span data-stu-id="9ea7f-220">Service</span></span><br /><br /> <span data-ttu-id="9ea7f-221">Nível</span><span class="sxs-lookup"><span data-stu-id="9ea7f-221">Level</span></span><br /><br /> <span data-ttu-id="9ea7f-222">Receber</span><span class="sxs-lookup"><span data-stu-id="9ea7f-222">Receive</span></span><br /><br /> <span data-ttu-id="9ea7f-223">Datagrama</span><span class="sxs-lookup"><span data-stu-id="9ea7f-223">Datagram</span></span>|  
|<span data-ttu-id="9ea7f-224">camada de transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-224">Transport layer</span></span>|<span data-ttu-id="9ea7f-225">Transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-225">Transport</span></span><br /><br /> <span data-ttu-id="9ea7f-226">Enviar</span><span class="sxs-lookup"><span data-stu-id="9ea7f-226">Send</span></span>|<span data-ttu-id="9ea7f-227">Transporte</span><span class="sxs-lookup"><span data-stu-id="9ea7f-227">Transport</span></span><br /><br /> <span data-ttu-id="9ea7f-228">Receber</span><span class="sxs-lookup"><span data-stu-id="9ea7f-228">Receive</span></span>|  
  
## <a name="message-filters"></a><span data-ttu-id="9ea7f-229">Filtros de mensagem</span><span class="sxs-lookup"><span data-stu-id="9ea7f-229">Message Filters</span></span>  
 <span data-ttu-id="9ea7f-230">Filtros de mensagem são definidos os `messageLogging` elemento de configuração a `diagnostics` seção de configuração.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-230">Message filters are defined in the `messageLogging` configuration element of the `diagnostics` configuration section.</span></span> <span data-ttu-id="9ea7f-231">Elas são aplicadas no nível de serviço e transporte.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-231">They are applied at the service and transport level.</span></span> <span data-ttu-id="9ea7f-232">Quando um ou mais filtros são definidos, apenas as mensagens que correspondem a pelo menos um dos filtros são registradas.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-232">When one or more filters are defined, only messages that match at least one of the filters are logged.</span></span> <span data-ttu-id="9ea7f-233">Se nenhum filtro for definido, todas as mensagens passam.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-233">If no filter is defined, all messages pass through.</span></span>  
  
 <span data-ttu-id="9ea7f-234">Filtros dão suporte a sintaxe completa do XPath e são aplicados na ordem em que aparecem no arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-234">Filters support the full XPath syntax and are applied in the order they appear in the configuration file.</span></span> <span data-ttu-id="9ea7f-235">Um filtro sintaticamente incorreto resulta em uma exceção de configuração.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-235">A syntactically incorrect filter results in a configuration exception.</span></span>  
  
 <span data-ttu-id="9ea7f-236">Filtros também fornecem um recurso de segurança usando o `nodeQuota` atributo, que limita o número máximo de nós no DOM, XPath que podem ser examinadas para corresponderem ao filtro.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-236">Filters also provide a safety feature using the `nodeQuota` attribute, which limits the maximum number of nodes in the XPath DOM that can be examined to match the filter.</span></span>  
  
 <span data-ttu-id="9ea7f-237">O exemplo a seguir mostra como configurar um filtro que registra apenas as mensagens que têm uma seção de cabeçalho SOAP.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-237">The following example shows how to configure a filter that records only messages that have a SOAP header section.</span></span>  
  
```xml  
<messageLogging logEntireMessage="true"  
    logMalformedMessages="true"   
    logMessagesAtServiceLevel="true"  
    logMessagesAtTransportLevel="true"  
    maxMessagesToLog="420">  
    <filters>  
        <add nodeQuota="10" xmlns:soap="http://www.w3.org/2003/05/soap-envelope">  
                 /soap:Envelope/soap:Header  
        </add>  
     </filters>  
</messageLogging>  
```  
  
 <span data-ttu-id="9ea7f-238">Filtros não podem ser aplicados ao corpo de uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-238">Filters cannot be applied to the body of a message.</span></span> <span data-ttu-id="9ea7f-239">Os filtros que tentam manipular o corpo de uma mensagem são removidos da lista de filtros.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-239">Filters that attempt to manipulate the body of a message are removed from the list of filters.</span></span> <span data-ttu-id="9ea7f-240">Um evento é emitido que indica que essa também.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-240">An event is also emitted that indicates this.</span></span> <span data-ttu-id="9ea7f-241">Por exemplo, o filtro a seguir seria removido da tabela de filtros.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-241">For example, the following filter would be removed from the filter table.</span></span>  
  
```xml  
<add xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">/s:Envelope/s:Body[contains(text(), "Hello")]</add>  
```  
  
## <a name="configuring-a-custom-listener"></a><span data-ttu-id="9ea7f-242">Configurar um ouvinte personalizado</span><span class="sxs-lookup"><span data-stu-id="9ea7f-242">Configuring a Custom Listener</span></span>  
 <span data-ttu-id="9ea7f-243">Você também pode configurar um ouvinte personalizado com opções adicionais.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-243">You can also configure a custom listener with additional options.</span></span> <span data-ttu-id="9ea7f-244">Um ouvinte personalizado pode ser útil na filtragem de elementos PII específicos do aplicativo de mensagens antes de fazer logon.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-244">A custom listener can be useful in filtering application-specific PII elements from messages before logging.</span></span> <span data-ttu-id="9ea7f-245">O exemplo a seguir demonstra uma configuração de ouvinte personalizado.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-245">The following example demonstrates a custom listener configuration.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
     <source name="System.ServiceModel.MessageLogging">  
           <listeners>  
             <add name="MyListener"   
                    type="YourCustomListener"  
                    initializeData="c:\logs\messages.svclog"  
                    maxDiskSpace="1000"/>  
           </listeners>  
     </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="9ea7f-246">Você deve estar ciente que o `type` atributo deve ser definido como um nome qualificado do assembly do tipo.</span><span class="sxs-lookup"><span data-stu-id="9ea7f-246">You should be aware that the `type` attribute should be set to a qualified assembly name of the type.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9ea7f-247">Consulte também</span><span class="sxs-lookup"><span data-stu-id="9ea7f-247">See also</span></span>

- [<span data-ttu-id="9ea7f-248">\<messageLogging></span><span class="sxs-lookup"><span data-stu-id="9ea7f-248">\<messageLogging></span></span>](../../../../docs/framework/configure-apps/file-schema/wcf/messagelogging.md)
- [<span data-ttu-id="9ea7f-249">Registro de mensagens em log</span><span class="sxs-lookup"><span data-stu-id="9ea7f-249">Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/message-logging.md)
- [<span data-ttu-id="9ea7f-250">Configurações recomendadas para rastreamento e registro de mensagem</span><span class="sxs-lookup"><span data-stu-id="9ea7f-250">Recommended Settings for Tracing and Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md)
