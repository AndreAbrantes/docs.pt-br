---
title: Configurando registros de mensagens em log
description: Saiba como configurar o log de mensagens, incluindo como habilitar o registro em log, níveis de log, filtros de mensagem e como configurar um ouvinte personalizado no WCF.
ms.date: 03/30/2017
helpviewer_keywords:
- message logging [WCF]
ms.assetid: 0ff4c857-8f09-4b85-9dc0-89084706e4c9
ms.openlocfilehash: 5203f19a18e5fa6b0ed7f68e1d1de0447da41abd
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85247656"
---
# <a name="configuring-message-logging"></a><span data-ttu-id="04e69-103">Configurando registros de mensagens em log</span><span class="sxs-lookup"><span data-stu-id="04e69-103">Configuring Message Logging</span></span>

<span data-ttu-id="04e69-104">Este tópico descreve como você pode configurar o log de mensagens para diferentes cenários.</span><span class="sxs-lookup"><span data-stu-id="04e69-104">This topic describes how you can configure message logging for different scenarios.</span></span>

## <a name="enabling-message-logging"></a><span data-ttu-id="04e69-105">Habilitando o log de mensagens</span><span class="sxs-lookup"><span data-stu-id="04e69-105">Enabling Message Logging</span></span>

<span data-ttu-id="04e69-106">O Windows Communication Foundation (WCF) não registra mensagens por padrão.</span><span class="sxs-lookup"><span data-stu-id="04e69-106">Windows Communication Foundation (WCF) does not log messages by default.</span></span> <span data-ttu-id="04e69-107">Para ativar o log de mensagens, você deve adicionar um ouvinte de rastreamento à `System.ServiceModel.MessageLogging` fonte de rastreamento e definir atributos para o `<messagelogging>` elemento no arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="04e69-107">To activate message logging, you must add a trace listener to the `System.ServiceModel.MessageLogging` trace source and set attributes for the `<messagelogging>` element in the configuration file.</span></span>

<span data-ttu-id="04e69-108">O exemplo a seguir mostra como habilitar o registro em log e especificar opções adicionais.</span><span class="sxs-lookup"><span data-stu-id="04e69-108">The following example shows how to enable logging and specify additional options.</span></span>

```xml
<system.diagnostics>
  <sources>
    <source name="System.ServiceModel.MessageLogging">
      <listeners>
         <add name="messages"
              type="System.Diagnostics.XmlWriterTraceListener"
              initializeData="c:\logs\messages.svclog" />
        </listeners>
    </source>
  </sources>
</system.diagnostics>

<system.serviceModel>
  <diagnostics>
    <messageLogging
         logEntireMessage="true"
         logMalformedMessages="false"
         logMessagesAtServiceLevel="true"
         logMessagesAtTransportLevel="false"
         maxMessagesToLog="3000"
         maxSizeOfMessageToLog="2000"/>
  </diagnostics>
</system.serviceModel>
```

<span data-ttu-id="04e69-109">Para obter mais informações sobre configurações de log de mensagens, consulte [configurações recomendadas para rastreamento e log de mensagens](./tracing/recommended-settings-for-tracing-and-message-logging.md).</span><span class="sxs-lookup"><span data-stu-id="04e69-109">For more information about message logging settings, see [Recommended Settings for Tracing and Message Logging](./tracing/recommended-settings-for-tracing-and-message-logging.md).</span></span>

<span data-ttu-id="04e69-110">Você pode usar `add` para especificar o nome e o tipo do ouvinte que deseja usar.</span><span class="sxs-lookup"><span data-stu-id="04e69-110">You can use `add` to specify the name and type of the listener you want to use.</span></span> <span data-ttu-id="04e69-111">Na configuração de exemplo, o ouvinte é chamado de "mensagens" e adiciona o ouvinte de rastreamento de .NET Framework padrão ( `System.Diagnostics.XmlWriterTraceListener` ) como o tipo a ser usado.</span><span class="sxs-lookup"><span data-stu-id="04e69-111">In the example configuration, the Listener is named "messages" and adds the standard .NET Framework trace listener (`System.Diagnostics.XmlWriterTraceListener`) as the type to use.</span></span> <span data-ttu-id="04e69-112">Se você usar `System.Diagnostics.XmlWriterTraceListener` o, deverá especificar o local e o nome do arquivo de saída no arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="04e69-112">If you use `System.Diagnostics.XmlWriterTraceListener`, you must specify the output file location and name in the configuration file.</span></span> <span data-ttu-id="04e69-113">Isso é feito definindo `initializeData` o nome do arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="04e69-113">This is done by setting `initializeData` to the name of the log file.</span></span> <span data-ttu-id="04e69-114">Caso contrário, o sistema gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="04e69-114">Otherwise, the system throws an exception.</span></span> <span data-ttu-id="04e69-115">Você também pode implementar um ouvinte personalizado que emite logs para um arquivo padrão.</span><span class="sxs-lookup"><span data-stu-id="04e69-115">You can also implement a custom listener that emits logs to a default file.</span></span>

> [!NOTE]
> <span data-ttu-id="04e69-116">Como o log de mensagens acessa o espaço em disco, você deve limitar o número de mensagens gravadas no disco para um serviço específico.</span><span class="sxs-lookup"><span data-stu-id="04e69-116">Because message logging accesses disk space, you should limit the number of messages that are written to disk for a particular service.</span></span> <span data-ttu-id="04e69-117">Quando o limite de mensagens é atingido, um rastreamento no nível de informação é produzido e todas as atividades de log de mensagem são interrompidas.</span><span class="sxs-lookup"><span data-stu-id="04e69-117">When the message limit is reached, a trace at the Information level is produced and all message logging activities stop.</span></span>

<span data-ttu-id="04e69-118">O nível de log, bem como as opções adicionais, são discutidos na seção nível de log e opções.</span><span class="sxs-lookup"><span data-stu-id="04e69-118">The logging level, as well as the additional options, are discussed in the Logging Level and Options section.</span></span>

<span data-ttu-id="04e69-119">O `switchValue` atributo de a `source` é válido somente para rastreamento.</span><span class="sxs-lookup"><span data-stu-id="04e69-119">The `switchValue` attribute of a `source` is only valid for tracing.</span></span> <span data-ttu-id="04e69-120">Se você especificar um `switchValue` atributo para a `System.ServiceModel.MessageLogging` origem de rastreamento da seguinte maneira, ele não terá nenhum efeito.</span><span class="sxs-lookup"><span data-stu-id="04e69-120">If you specify a `switchValue` attribute for the `System.ServiceModel.MessageLogging` trace source as follows, it has no effect.</span></span>

```xml
<source name="System.ServiceModel.MessageLogging" switchValue="Verbose">
</source>
```

<span data-ttu-id="04e69-121">Se você quiser desabilitar a origem do rastreamento, use os `logMessagesAtServiceLevel` `logMalformedMessages` atributos,, e `logMessagesAtTransportLevel` do `messageLogging` elemento.</span><span class="sxs-lookup"><span data-stu-id="04e69-121">If you want to disable the trace source, you should use the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element instead.</span></span> <span data-ttu-id="04e69-122">Você deve definir todos esses atributos como `false` .</span><span class="sxs-lookup"><span data-stu-id="04e69-122">You should set all these attributes to `false`.</span></span> <span data-ttu-id="04e69-123">Isso pode ser feito usando o arquivo de configuração no exemplo de código anterior, por meio da interface de interface do usuário do editor de configuração ou usando o WMI.</span><span class="sxs-lookup"><span data-stu-id="04e69-123">This can be done by using the configuration file in the previous code example, through the Configuration Editor UI interface, or using WMI.</span></span> <span data-ttu-id="04e69-124">Para obter mais informações sobre a ferramenta do editor de configuração, consulte [ferramenta do editor de configuração (SvcConfigEditor.exe)](../configuration-editor-tool-svcconfigeditor-exe.md).</span><span class="sxs-lookup"><span data-stu-id="04e69-124">For more information about the Configuration Editor tool, see [Configuration Editor Tool (SvcConfigEditor.exe)](../configuration-editor-tool-svcconfigeditor-exe.md).</span></span> <span data-ttu-id="04e69-125">Para obter mais informações sobre o WMI, consulte [usando instrumentação de gerenciamento do Windows para diagnóstico](./wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="04e69-125">For more information about WMI, see [Using Windows Management Instrumentation for Diagnostics](./wmi/index.md).</span></span>

## <a name="logging-levels-and-options"></a><span data-ttu-id="04e69-126">Níveis e opções de log</span><span class="sxs-lookup"><span data-stu-id="04e69-126">Logging Levels and Options</span></span>

<span data-ttu-id="04e69-127">Para mensagens de entrada, o log ocorre imediatamente depois que a mensagem é formada, imediatamente antes de a mensagem chegar ao código do usuário no nível de serviço e quando as mensagens malformadas são detectadas.</span><span class="sxs-lookup"><span data-stu-id="04e69-127">For incoming messages, logging happens immediately after the message is formed, immediately before the message gets to user code in the service level, and when malformed messages are detected.</span></span>

<span data-ttu-id="04e69-128">Para mensagens de saída, o registro em log ocorre imediatamente após a mensagem sair do código do usuário e imediatamente antes de a mensagem entrar na conexão.</span><span class="sxs-lookup"><span data-stu-id="04e69-128">For outgoing messages, logging happens immediately after the message leaves user code and immediately before the message goes on the wire.</span></span>

<span data-ttu-id="04e69-129">O WCF Registra mensagens em dois níveis diferentes, serviço e transporte.</span><span class="sxs-lookup"><span data-stu-id="04e69-129">WCF logs messages at two different levels, service and transport.</span></span> <span data-ttu-id="04e69-130">As mensagens malformadas também são registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-130">Malformed messages are also logged.</span></span> <span data-ttu-id="04e69-131">As três categorias são independentes umas das outras e podem ser ativadas separadamente na configuração.</span><span class="sxs-lookup"><span data-stu-id="04e69-131">The three categories are independent from each other and can be activated separately in configuration.</span></span>

<span data-ttu-id="04e69-132">Você pode controlar o nível de log definindo os `logMessagesAtServiceLevel` `logMalformedMessages` atributos, e `logMessagesAtTransportLevel` do `messageLogging` elemento.</span><span class="sxs-lookup"><span data-stu-id="04e69-132">You can control the logging level by setting the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element.</span></span>

### <a name="service-level"></a><span data-ttu-id="04e69-133">Nível de serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-133">Service Level</span></span>

<span data-ttu-id="04e69-134">As mensagens registradas nessa camada estão prestes a entrar (no recebimento) ou saem (no envio) do código de usuário.</span><span class="sxs-lookup"><span data-stu-id="04e69-134">Messages logged at this layer are about to enter (on receiving) or leave (on sending) user code.</span></span> <span data-ttu-id="04e69-135">Se os filtros tiverem sido definidos, somente as mensagens que corresponderem aos filtros serão registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-135">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="04e69-136">Caso contrário, todas as mensagens no nível de serviço serão registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-136">Otherwise, all messages at the service level are logged.</span></span> <span data-ttu-id="04e69-137">As mensagens de infraestrutura (transações, canal par e segurança) também são registradas nesse nível, exceto para mensagens de mensagens confiáveis.</span><span class="sxs-lookup"><span data-stu-id="04e69-137">Infrastructure messages (transactions, peer channel, and security) are also logged at this level, except for Reliable Messaging messages.</span></span> <span data-ttu-id="04e69-138">Em mensagens transmitidas, somente os cabeçalhos são registrados em log.</span><span class="sxs-lookup"><span data-stu-id="04e69-138">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="04e69-139">Além disso, as mensagens seguras são descriptografadas nesse nível.</span><span class="sxs-lookup"><span data-stu-id="04e69-139">In addition, secure messages are logged decrypted at this level.</span></span>

### <a name="transport-level"></a><span data-ttu-id="04e69-140">Nível de transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-140">Transport Level</span></span>

<span data-ttu-id="04e69-141">As mensagens registradas nessa camada estão prontas para serem codificadas ou decodificadas para ou após o transporte na transmissão.</span><span class="sxs-lookup"><span data-stu-id="04e69-141">Messages logged at this layer are ready to be encoded or decoded for or after transportation on the wire.</span></span> <span data-ttu-id="04e69-142">Se os filtros tiverem sido definidos, somente as mensagens que corresponderem aos filtros serão registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-142">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="04e69-143">Caso contrário, todas as mensagens na camada de transporte serão registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-143">Otherwise, all messages at the transport layer are logged.</span></span> <span data-ttu-id="04e69-144">Todas as mensagens de infraestrutura são registradas nessa camada, incluindo mensagens de mensagens confiáveis.</span><span class="sxs-lookup"><span data-stu-id="04e69-144">All infrastructure messages are logged at this layer, including reliable messaging messages.</span></span> <span data-ttu-id="04e69-145">Em mensagens transmitidas, somente os cabeçalhos são registrados em log.</span><span class="sxs-lookup"><span data-stu-id="04e69-145">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="04e69-146">Além disso, as mensagens seguras são registradas como criptografadas nesse nível, exceto se um transporte seguro, como HTTPS, for usado.</span><span class="sxs-lookup"><span data-stu-id="04e69-146">In addition, secure messages are logged as encrypted at this level, except if a secure transport such as HTTPS is used.</span></span>

### <a name="malformed-level"></a><span data-ttu-id="04e69-147">Nível malformado</span><span class="sxs-lookup"><span data-stu-id="04e69-147">Malformed Level</span></span>

<span data-ttu-id="04e69-148">Mensagens malformadas são mensagens rejeitadas pela pilha do WCF em qualquer estágio do processamento.</span><span class="sxs-lookup"><span data-stu-id="04e69-148">Malformed messages are messages that are rejected by the WCF stack at any stage of processing.</span></span> <span data-ttu-id="04e69-149">As mensagens malformadas são registradas como estão: criptografadas se forem assim, com XML não adequado e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="04e69-149">Malformed messages are logged as-is: encrypted if they are so, with non-proper XML, and so on.</span></span> <span data-ttu-id="04e69-150">`maxSizeOfMessageToLog`definido o tamanho da mensagem a ser registrada como CDATA.</span><span class="sxs-lookup"><span data-stu-id="04e69-150">`maxSizeOfMessageToLog` defined the size of the message to be logged as CDATA.</span></span> <span data-ttu-id="04e69-151">Por padrão, `maxSizeOfMessageToLog` é igual a 256K.</span><span class="sxs-lookup"><span data-stu-id="04e69-151">By default, `maxSizeOfMessageToLog` is equal to 256K.</span></span> <span data-ttu-id="04e69-152">Para obter mais informações sobre esse atributo, consulte a seção outras opções.</span><span class="sxs-lookup"><span data-stu-id="04e69-152">For more information about this attribute, see the Other Options section.</span></span>

### <a name="other-options"></a><span data-ttu-id="04e69-153">Outras opções</span><span class="sxs-lookup"><span data-stu-id="04e69-153">Other Options</span></span>

<span data-ttu-id="04e69-154">Além dos níveis de log, o usuário pode especificar as seguintes opções:</span><span class="sxs-lookup"><span data-stu-id="04e69-154">In addition to the logging levels, the user can specify the following options:</span></span>

- <span data-ttu-id="04e69-155">Registrar mensagem inteira ( `logEntireMessage` atributo): esse valor especifica se a mensagem inteira (cabeçalho e corpo da mensagem) é registrada.</span><span class="sxs-lookup"><span data-stu-id="04e69-155">Log Entire Message (`logEntireMessage` attribute): This value specifies whether the entire message (message header and body) is logged.</span></span> <span data-ttu-id="04e69-156">O valor padrão é `false` , o que significa que apenas o cabeçalho é registrado em log.</span><span class="sxs-lookup"><span data-stu-id="04e69-156">The default value is `false`, meaning that only the header is logged.</span></span> <span data-ttu-id="04e69-157">Essa configuração afeta os níveis de log de mensagens de serviço e transporte.</span><span class="sxs-lookup"><span data-stu-id="04e69-157">This setting affects service and transport message logging levels..</span></span>

- <span data-ttu-id="04e69-158">Máximo de mensagens para log ( `maxMessagesToLog` atributo): esse valor especifica o número máximo de mensagens a serem registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-158">Max messages to log (`maxMessagesToLog` attribute): This value specifies the maximum number of messages to log.</span></span> <span data-ttu-id="04e69-159">Todas as mensagens (serviço, transporte e mensagens malformadas) são contadas em direção a essa cota.</span><span class="sxs-lookup"><span data-stu-id="04e69-159">All messages (service, transport, and malformed messages) are counted towards this quota.</span></span> <span data-ttu-id="04e69-160">Quando a cota é atingida, um rastreamento é emitido e nenhuma mensagem adicional é registrada.</span><span class="sxs-lookup"><span data-stu-id="04e69-160">When the quota is reached, a trace is emitted and no additional message is logged.</span></span> <span data-ttu-id="04e69-161">O valor padrão é 10000.</span><span class="sxs-lookup"><span data-stu-id="04e69-161">The default value is 10000.</span></span>

- <span data-ttu-id="04e69-162">Tamanho máximo da mensagem a ser registrada ( `maxSizeOfMessageToLog` atributo): esse valor especifica o tamanho máximo das mensagens para fazer logon em bytes.</span><span class="sxs-lookup"><span data-stu-id="04e69-162">Max size of message to log (`maxSizeOfMessageToLog` attribute): This value specifies the maximum size of messages to log in bytes.</span></span> <span data-ttu-id="04e69-163">Mensagens que excedem o limite de tamanho não são registradas e nenhuma outra atividade é executada para essa mensagem.</span><span class="sxs-lookup"><span data-stu-id="04e69-163">Messages that exceed the size limit are not logged, and no other activity is performed for that message.</span></span> <span data-ttu-id="04e69-164">Essa configuração afeta todos os níveis de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="04e69-164">This setting affects all trace levels.</span></span> <span data-ttu-id="04e69-165">Se o rastreamento de ServiceModel estiver ativado, um rastreamento de nível de aviso será emitido no primeiro ponto de log (ServiceModelSend \* ou TransportReceive) para notificar o usuário.</span><span class="sxs-lookup"><span data-stu-id="04e69-165">If ServiceModel tracing is on, a Warning level trace is emitted at the first logging point (ServiceModelSend\* or TransportReceive) to notify the user.</span></span> <span data-ttu-id="04e69-166">O valor padrão para as mensagens de nível de serviço e nível de transporte é 256K, enquanto o valor padrão para mensagens malformadas é de 4K.</span><span class="sxs-lookup"><span data-stu-id="04e69-166">The default value for service level and transport level messages is 256K, while the default value for malformed messages is 4K.</span></span>

  > [!CAUTION]
  > <span data-ttu-id="04e69-167">O tamanho da mensagem que é computada para comparação `maxSizeOfMessageToLog` é o tamanho da mensagem na memória antes da serialização.</span><span class="sxs-lookup"><span data-stu-id="04e69-167">The message size that is computed to compare against `maxSizeOfMessageToLog` is the message size in memory before serialization.</span></span> <span data-ttu-id="04e69-168">Esse tamanho pode diferir do tamanho real da cadeia de caracteres de mensagem que está sendo registrada e, em muitas ocasiões, maior do que o tamanho real.</span><span class="sxs-lookup"><span data-stu-id="04e69-168">This size can differ from the actual length of the message string that is being logged, and in many occasions is bigger than the actual size.</span></span> <span data-ttu-id="04e69-169">Como resultado, as mensagens podem não ser registradas em log.</span><span class="sxs-lookup"><span data-stu-id="04e69-169">As a result, messages may not be logged.</span></span> <span data-ttu-id="04e69-170">Você pode considerar esse fato especificando que o `maxSizeOfMessageToLog` atributo seja 10% maior do que o tamanho esperado da mensagem.</span><span class="sxs-lookup"><span data-stu-id="04e69-170">You can account for this fact by specifying the `maxSizeOfMessageToLog` attribute to be 10% larger than the expected message size.</span></span> <span data-ttu-id="04e69-171">Além disso, se as mensagens malformadas forem registradas, o espaço em disco real utilizado pelos logs de mensagens poderá ter até cinco vezes o tamanho do valor especificado por `maxSizeOfMessageToLog` .</span><span class="sxs-lookup"><span data-stu-id="04e69-171">In addition, if malformed messages are logged, the actual disk space utilized by the message logs can be up to 5 times the size of the value specified by `maxSizeOfMessageToLog`.</span></span>

<span data-ttu-id="04e69-172">Se nenhum ouvinte de rastreamento for definido no arquivo de configuração, nenhuma saída de log será gerada, independentemente do nível de log especificado.</span><span class="sxs-lookup"><span data-stu-id="04e69-172">If no trace listener is defined in the configuration file, no logging output is generated regardless of the specified logging level.</span></span>

<span data-ttu-id="04e69-173">As opções de log de mensagens, como os atributos descritos nesta seção, podem ser alteradas em tempo de execução usando Instrumentação de Gerenciamento do Windows (WMI).</span><span class="sxs-lookup"><span data-stu-id="04e69-173">Message logging options, such as the attributes described in this section, can be changed at runtime using Windows Management Instrumentation (WMI).</span></span> <span data-ttu-id="04e69-174">Isso pode ser feito acessando a instância [AppDomainInfo](./wmi/appdomaininfo.md) , que expõe essas propriedades booleanas: `LogMessagesAtServiceLevel` , `LogMessagesAtTransportLevel` e `LogMalformedMessages` .</span><span class="sxs-lookup"><span data-stu-id="04e69-174">This can be done by accessing the [AppDomainInfo](./wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, and `LogMalformedMessages`.</span></span> <span data-ttu-id="04e69-175">Portanto, se você configurar um ouvinte de rastreamento para o log de mensagens, mas definir essas opções como `false` em configuração, você poderá alterá-las posteriormente para `true` quando o aplicativo estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="04e69-175">Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running.</span></span> <span data-ttu-id="04e69-176">Isso efetivamente habilita o log de mensagens em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="04e69-176">This effectively enables message logging at runtime.</span></span> <span data-ttu-id="04e69-177">Da mesma forma, se você habilitar o log de mensagens em seu arquivo de configuração, poderá desabilitá-lo em tempo de execução usando o WMI.</span><span class="sxs-lookup"><span data-stu-id="04e69-177">Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.</span></span> <span data-ttu-id="04e69-178">Para obter mais informações, consulte [usando instrumentação de gerenciamento do Windows para diagnóstico](./wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="04e69-178">For more information, see [Using Windows Management Instrumentation for Diagnostics](./wmi/index.md).</span></span>

<span data-ttu-id="04e69-179">O `source` campo em um log de mensagens especifica em qual contexto a mensagem é registrada: ao enviar/receber uma mensagem de solicitação, para uma solicitação de solicitação-resposta ou de 1-Way, no modelo de serviço ou na camada de transporte ou no caso de uma mensagem malformada.</span><span class="sxs-lookup"><span data-stu-id="04e69-179">The `source` field in a message log specifies in which context the message is logged: when sending/receiving a request message, for a request-reply or 1-way request, at service model or transport layer, or in the case of a malformed message.</span></span>

<span data-ttu-id="04e69-180">Para mensagens malformadas, `source` é igual a `Malformed` .</span><span class="sxs-lookup"><span data-stu-id="04e69-180">For malformed messages, `source`  is equal to `Malformed`.</span></span> <span data-ttu-id="04e69-181">Caso contrário, a origem terá os valores a seguir com base no contexto.</span><span class="sxs-lookup"><span data-stu-id="04e69-181">Otherwise, source has the following values based on the context.</span></span>

<span data-ttu-id="04e69-182">Para solicitação/resposta</span><span class="sxs-lookup"><span data-stu-id="04e69-182">For Request/Reply</span></span>

||<span data-ttu-id="04e69-183">Enviar solicitação</span><span class="sxs-lookup"><span data-stu-id="04e69-183">Send Request</span></span>|<span data-ttu-id="04e69-184">Receber solicitação</span><span class="sxs-lookup"><span data-stu-id="04e69-184">Receive Request</span></span>|<span data-ttu-id="04e69-185">Enviar resposta</span><span class="sxs-lookup"><span data-stu-id="04e69-185">Send Reply</span></span>|<span data-ttu-id="04e69-186">Receber resposta</span><span class="sxs-lookup"><span data-stu-id="04e69-186">Receive Reply</span></span>|
|-|------------------|---------------------|----------------|-------------------|
|<span data-ttu-id="04e69-187">Camada do modelo de serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-187">Service Model layer</span></span>|<span data-ttu-id="04e69-188">Serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-188">Service</span></span><br /><br /> <span data-ttu-id="04e69-189">Nível</span><span class="sxs-lookup"><span data-stu-id="04e69-189">Level</span></span><br /><br /> <span data-ttu-id="04e69-190">Enviar</span><span class="sxs-lookup"><span data-stu-id="04e69-190">Send</span></span><br /><br /> <span data-ttu-id="04e69-191">Solicitação</span><span class="sxs-lookup"><span data-stu-id="04e69-191">Request</span></span>|<span data-ttu-id="04e69-192">Serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-192">Service</span></span><br /><br /> <span data-ttu-id="04e69-193">Nível</span><span class="sxs-lookup"><span data-stu-id="04e69-193">Level</span></span><br /><br /> <span data-ttu-id="04e69-194">Receber</span><span class="sxs-lookup"><span data-stu-id="04e69-194">Receive</span></span><br /><br /> <span data-ttu-id="04e69-195">Solicitação</span><span class="sxs-lookup"><span data-stu-id="04e69-195">Request</span></span>|<span data-ttu-id="04e69-196">Serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-196">Service</span></span><br /><br /> <span data-ttu-id="04e69-197">Nível</span><span class="sxs-lookup"><span data-stu-id="04e69-197">Level</span></span><br /><br /> <span data-ttu-id="04e69-198">Enviar</span><span class="sxs-lookup"><span data-stu-id="04e69-198">Send</span></span><br /><br /> <span data-ttu-id="04e69-199">Responder</span><span class="sxs-lookup"><span data-stu-id="04e69-199">Reply</span></span>|<span data-ttu-id="04e69-200">Serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-200">Service</span></span><br /><br /> <span data-ttu-id="04e69-201">Nível</span><span class="sxs-lookup"><span data-stu-id="04e69-201">Level</span></span><br /><br /> <span data-ttu-id="04e69-202">Receber</span><span class="sxs-lookup"><span data-stu-id="04e69-202">Receive</span></span><br /><br /> <span data-ttu-id="04e69-203">Responder</span><span class="sxs-lookup"><span data-stu-id="04e69-203">Reply</span></span>|
|<span data-ttu-id="04e69-204">Camada de transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-204">Transport layer</span></span>|<span data-ttu-id="04e69-205">Transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-205">Transport</span></span><br /><br /> <span data-ttu-id="04e69-206">Enviar</span><span class="sxs-lookup"><span data-stu-id="04e69-206">Send</span></span>|<span data-ttu-id="04e69-207">Transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-207">Transport</span></span><br /><br /> <span data-ttu-id="04e69-208">Receber</span><span class="sxs-lookup"><span data-stu-id="04e69-208">Receive</span></span>|<span data-ttu-id="04e69-209">Transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-209">Transport</span></span><br /><br /> <span data-ttu-id="04e69-210">Enviar</span><span class="sxs-lookup"><span data-stu-id="04e69-210">Send</span></span>|<span data-ttu-id="04e69-211">Transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-211">Transport</span></span><br /><br /> <span data-ttu-id="04e69-212">Receber</span><span class="sxs-lookup"><span data-stu-id="04e69-212">Receive</span></span>|

<span data-ttu-id="04e69-213">Para uma solicitação unidirecional</span><span class="sxs-lookup"><span data-stu-id="04e69-213">For One-way Request</span></span>

||<span data-ttu-id="04e69-214">Enviar solicitação</span><span class="sxs-lookup"><span data-stu-id="04e69-214">Send Request</span></span>|<span data-ttu-id="04e69-215">Receber solicitação</span><span class="sxs-lookup"><span data-stu-id="04e69-215">Receive Request</span></span>|
|-|------------------|---------------------|
|<span data-ttu-id="04e69-216">Camada do modelo de serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-216">Service Model layer</span></span>|<span data-ttu-id="04e69-217">Serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-217">Service</span></span><br /><br /> <span data-ttu-id="04e69-218">Nível</span><span class="sxs-lookup"><span data-stu-id="04e69-218">Level</span></span><br /><br /> <span data-ttu-id="04e69-219">Enviar</span><span class="sxs-lookup"><span data-stu-id="04e69-219">Send</span></span><br /><br /> <span data-ttu-id="04e69-220">Datagrama</span><span class="sxs-lookup"><span data-stu-id="04e69-220">Datagram</span></span>|<span data-ttu-id="04e69-221">Serviço</span><span class="sxs-lookup"><span data-stu-id="04e69-221">Service</span></span><br /><br /> <span data-ttu-id="04e69-222">Nível</span><span class="sxs-lookup"><span data-stu-id="04e69-222">Level</span></span><br /><br /> <span data-ttu-id="04e69-223">Receber</span><span class="sxs-lookup"><span data-stu-id="04e69-223">Receive</span></span><br /><br /> <span data-ttu-id="04e69-224">Datagrama</span><span class="sxs-lookup"><span data-stu-id="04e69-224">Datagram</span></span>|
|<span data-ttu-id="04e69-225">Camada de transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-225">Transport layer</span></span>|<span data-ttu-id="04e69-226">Transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-226">Transport</span></span><br /><br /> <span data-ttu-id="04e69-227">Enviar</span><span class="sxs-lookup"><span data-stu-id="04e69-227">Send</span></span>|<span data-ttu-id="04e69-228">Transporte</span><span class="sxs-lookup"><span data-stu-id="04e69-228">Transport</span></span><br /><br /> <span data-ttu-id="04e69-229">Receber</span><span class="sxs-lookup"><span data-stu-id="04e69-229">Receive</span></span>|

## <a name="message-filters"></a><span data-ttu-id="04e69-230">Filtros de mensagem</span><span class="sxs-lookup"><span data-stu-id="04e69-230">Message Filters</span></span>

<span data-ttu-id="04e69-231">Os filtros de mensagem são definidos no `messageLogging` elemento Configuration da `diagnostics` seção de configuração.</span><span class="sxs-lookup"><span data-stu-id="04e69-231">Message filters are defined in the `messageLogging` configuration element of the `diagnostics` configuration section.</span></span> <span data-ttu-id="04e69-232">Eles são aplicados no nível de serviço e transporte.</span><span class="sxs-lookup"><span data-stu-id="04e69-232">They are applied at the service and transport level.</span></span> <span data-ttu-id="04e69-233">Quando um ou mais filtros são definidos, somente as mensagens que correspondem a pelo menos um dos filtros são registradas.</span><span class="sxs-lookup"><span data-stu-id="04e69-233">When one or more filters are defined, only messages that match at least one of the filters are logged.</span></span> <span data-ttu-id="04e69-234">Se nenhum filtro for definido, todas as mensagens passarão.</span><span class="sxs-lookup"><span data-stu-id="04e69-234">If no filter is defined, all messages pass through.</span></span>

<span data-ttu-id="04e69-235">Os filtros dão suporte à sintaxe XPath completa e são aplicados na ordem em que aparecem no arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="04e69-235">Filters support the full XPath syntax and are applied in the order they appear in the configuration file.</span></span> <span data-ttu-id="04e69-236">Um filtro sintaticamente incorreto resulta em uma exceção de configuração.</span><span class="sxs-lookup"><span data-stu-id="04e69-236">A syntactically incorrect filter results in a configuration exception.</span></span>

<span data-ttu-id="04e69-237">Os filtros também fornecem um recurso de segurança usando o `nodeQuota` atributo, que limita o número máximo de nós no DOM XPath que pode ser examinado para corresponder ao filtro.</span><span class="sxs-lookup"><span data-stu-id="04e69-237">Filters also provide a safety feature using the `nodeQuota` attribute, which limits the maximum number of nodes in the XPath DOM that can be examined to match the filter.</span></span>

<span data-ttu-id="04e69-238">O exemplo a seguir mostra como configurar um filtro que registra somente as mensagens que têm uma seção de cabeçalho SOAP.</span><span class="sxs-lookup"><span data-stu-id="04e69-238">The following example shows how to configure a filter that records only messages that have a SOAP header section.</span></span>

```xml
<messageLogging logEntireMessage="true"
    logMalformedMessages="true"
    logMessagesAtServiceLevel="true"
    logMessagesAtTransportLevel="true"
    maxMessagesToLog="420">
    <filters>
        <add nodeQuota="10" xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
                 /soap:Envelope/soap:Header
        </add>
     </filters>
</messageLogging>
```

<span data-ttu-id="04e69-239">Os filtros não podem ser aplicados ao corpo de uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="04e69-239">Filters cannot be applied to the body of a message.</span></span> <span data-ttu-id="04e69-240">Os filtros que tentam manipular o corpo de uma mensagem são removidos da lista de filtros.</span><span class="sxs-lookup"><span data-stu-id="04e69-240">Filters that attempt to manipulate the body of a message are removed from the list of filters.</span></span> <span data-ttu-id="04e69-241">Um evento também é emitido, indicando isso.</span><span class="sxs-lookup"><span data-stu-id="04e69-241">An event is also emitted that indicates this.</span></span> <span data-ttu-id="04e69-242">Por exemplo, o filtro a seguir seria removido da tabela de filtros.</span><span class="sxs-lookup"><span data-stu-id="04e69-242">For example, the following filter would be removed from the filter table.</span></span>

```xml
<add xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">/s:Envelope/s:Body[contains(text(), "Hello")]</add>
```

## <a name="configuring-a-custom-listener"></a><span data-ttu-id="04e69-243">Configurando um ouvinte personalizado</span><span class="sxs-lookup"><span data-stu-id="04e69-243">Configuring a Custom Listener</span></span>

<span data-ttu-id="04e69-244">Você também pode configurar um ouvinte personalizado com opções adicionais.</span><span class="sxs-lookup"><span data-stu-id="04e69-244">You can also configure a custom listener with additional options.</span></span> <span data-ttu-id="04e69-245">Um ouvinte personalizado pode ser útil na filtragem de elementos de PII específicos do aplicativo de mensagens antes do registro em log.</span><span class="sxs-lookup"><span data-stu-id="04e69-245">A custom listener can be useful in filtering application-specific PII elements from messages before logging.</span></span> <span data-ttu-id="04e69-246">O exemplo a seguir demonstra uma configuração de ouvinte personalizada.</span><span class="sxs-lookup"><span data-stu-id="04e69-246">The following example demonstrates a custom listener configuration.</span></span>

```xml
<system.diagnostics>
   <sources>
     <source name="System.ServiceModel.MessageLogging">
           <listeners>
             <add name="MyListener"
                    type="YourCustomListener"
                    initializeData="c:\logs\messages.svclog"
                    maxDiskSpace="1000"/>
           </listeners>
     </source>
   </sources>
</system.diagnostics>
```

<span data-ttu-id="04e69-247">Você deve estar ciente de que o `type` atributo deve ser definido como um nome de assembly qualificado do tipo.</span><span class="sxs-lookup"><span data-stu-id="04e69-247">You should be aware that the `type` attribute should be set to a qualified assembly name of the type.</span></span>

## <a name="see-also"></a><span data-ttu-id="04e69-248">Veja também</span><span class="sxs-lookup"><span data-stu-id="04e69-248">See also</span></span>

- [\<messageLogging>](../../configure-apps/file-schema/wcf/messagelogging.md)
- [<span data-ttu-id="04e69-249">Registro em log de mensagens</span><span class="sxs-lookup"><span data-stu-id="04e69-249">Message Logging</span></span>](message-logging.md)
- [<span data-ttu-id="04e69-250">Configurações recomendadas para registro de rastreamento e mensagens</span><span class="sxs-lookup"><span data-stu-id="04e69-250">Recommended Settings for Tracing and Message Logging</span></span>](./tracing/recommended-settings-for-tracing-and-message-logging.md)
