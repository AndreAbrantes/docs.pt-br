---
title: Problemas de segurança de registro em log de mensagens
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
ms.openlocfilehash: b635591b7a3b07385ed48c6b1ea556139c6d77c5
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/27/2019
ms.locfileid: "70044262"
---
# <a name="security-concerns-for-message-logging"></a><span data-ttu-id="9e9b2-102">Problemas de segurança de registro em log de mensagens</span><span class="sxs-lookup"><span data-stu-id="9e9b2-102">Security Concerns for Message Logging</span></span>
<span data-ttu-id="9e9b2-103">Este tópico descreve como você pode proteger dados confidenciais de serem expostos em logs de mensagens, bem como eventos gerados pelo log de mensagens.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-103">This topic describes how you can protect sensitive data from being exposed in message logs, as well as events generated by message logging.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="9e9b2-104">Problemas de segurança</span><span class="sxs-lookup"><span data-stu-id="9e9b2-104">Security Concerns</span></span>  
  
### <a name="logging-sensitive-information"></a><span data-ttu-id="9e9b2-105">Registrando informações confidenciais</span><span class="sxs-lookup"><span data-stu-id="9e9b2-105">Logging Sensitive Information</span></span>  
 <span data-ttu-id="9e9b2-106">Windows Communication Foundation (WCF) não modifica nenhum dado em cabeçalhos e corpo específicos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-106">Windows Communication Foundation (WCF) does not modify any data in application-specific headers and body.</span></span> <span data-ttu-id="9e9b2-107">O WCF também não rastreia informações pessoais em cabeçalhos específicos do aplicativo ou dados de corpo.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-107">WCF also does not track personal information in application-specific headers or body data.</span></span>  
  
 <span data-ttu-id="9e9b2-108">Quando o log de mensagens está habilitado, as informações pessoais em cabeçalhos específicos do aplicativo, como uma cadeia de caracteres de consulta; e as informações de corpo, como um número de cartão de crédito, podem se tornar visíveis nos logs.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-108">When message logging is enabled, personal information in application-specific headers, such as, a query string; and body information, such as, a credit card number, can become visible in the logs.</span></span> <span data-ttu-id="9e9b2-109">O implantador de aplicativos é responsável por impor o controle de acesso nos arquivos de configuração e de log.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-109">The application deployer is responsible for enforcing access control on the configuration and log files.</span></span> <span data-ttu-id="9e9b2-110">Se você não quiser que esse tipo de informação fique visível, desabilite o registro em log ou filtre parte dos dados se quiser compartilhar os logs.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-110">If you do not want this kind of information to be visible, you should disable logging, or filter out part of the data if you want to share the logs.</span></span>  
  
 <span data-ttu-id="9e9b2-111">As dicas a seguir podem ajudá-lo a impedir que o conteúdo de um arquivo de log seja exposto de forma não intencional:</span><span class="sxs-lookup"><span data-stu-id="9e9b2-111">The following tips can help you to prevent the content of a log file from being exposed unintentionally:</span></span>  
  
- <span data-ttu-id="9e9b2-112">Verifique se os arquivos de log estão protegidos por listas de controle de acesso (ACL) tanto em cenários de host da Web quanto de hospedagem interna.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-112">Ensure that the log files are protected by Access Control Lists (ACL) both in Web-host and self-host scenarios.</span></span>  
  
- <span data-ttu-id="9e9b2-113">Escolha uma extensão de arquivo que não possa ser facilmente servida usando uma solicitação da Web.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-113">Choose a file extension that cannot be easily served using a Web request.</span></span> <span data-ttu-id="9e9b2-114">Por exemplo, a extensão de arquivo. xml não é uma opção segura.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-114">For example, the .xml file extension is not a safe choice.</span></span> <span data-ttu-id="9e9b2-115">Você pode verificar o guia de administração do Serviços de Informações da Internet (IIS) para ver uma lista de extensões que podem ser servidas.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-115">You can check the Internet Information Services (IIS) administration guide to see a list of extensions that can be served.</span></span>  
  
- <span data-ttu-id="9e9b2-116">Especifique um caminho absoluto para o local do arquivo de log, que deve estar fora do diretório público do Web host vroot para impedir que ele seja acessado por uma parte externa usando um navegador da Web.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-116">Specify an absolute path for the log file location, which should be outside of the Web host vroot public directory to prevent it from being accessed by an external party using a Web browser.</span></span>  
  
 <span data-ttu-id="9e9b2-117">Por padrão, as chaves e as informações de identificação pessoal (PII), como nome de usuário e senha, não são registradas em rastreamentos e mensagens registradas.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-117">By default, keys and personally identifiable information (PII) such as username and password are not logged in traces and logged messages.</span></span> <span data-ttu-id="9e9b2-118">Um administrador de máquina, no entanto, `enableLoggingKnownPII` pode usar o `machineSettings` atributo no elemento do arquivo Machine. config para permitir que os aplicativos em execução no computador registrem PII (informações de identificação pessoal) conhecidas.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-118">A machine administrator, however, can use the `enableLoggingKnownPII` attribute in the `machineSettings` element of the Machine.config file to permit applications running on the machine to log known personally identifiable information (PII).</span></span> <span data-ttu-id="9e9b2-119">A configuração a seguir demonstra como fazer isso:</span><span class="sxs-lookup"><span data-stu-id="9e9b2-119">The following configuration demonstrates how to do this:</span></span>  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>   
```  
  
 <span data-ttu-id="9e9b2-120">Um implantador de aplicativo pode usar `logKnownPii` o atributo no arquivo app. config ou Web. config para habilitar o log de PII da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="9e9b2-120">An application deployer can then use the `logKnownPii` attribute in either the App.config or Web.config file to enable PII logging as follows:</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="9e9b2-121">Somente quando as duas configurações `true` são o log de PII habilitado.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-121">Only when both settings are `true` is PII logging enabled.</span></span> <span data-ttu-id="9e9b2-122">A combinação de duas opções permite a flexibilidade de registrar PII conhecida para cada aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-122">The combination of two switches allows the flexibility to log known PII for each application.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="9e9b2-123">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] `true` Nos sinalizadores e`logKnownPii`também devem ser definidos como no arquivo Web. config ou no arquivo app. config para habilitar o log de PII, como mostrado no exemplo `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`a seguir. `logEntireMessage`</span><span class="sxs-lookup"><span data-stu-id="9e9b2-123">In [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] the `logEntireMessage` and `logKnownPii` flags must also be set to `true` in the Web.config file or the App.config file to enable PII logging, as show in the following example `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span></span>  
  
 <span data-ttu-id="9e9b2-124">Você deve estar ciente de que, se você especificar duas ou mais fontes personalizadas em um arquivo de configuração, somente os atributos da primeira fonte serão lidos.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-124">You should be aware that if you specify two or more custom sources in a configuration file, only the attributes of the first source are read.</span></span> <span data-ttu-id="9e9b2-125">Os outros são ignorados.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-125">The others are ignored.</span></span> <span data-ttu-id="9e9b2-126">Isso significa que, para o seguinte app. config, o arquivo, PII não é registrado para ambas as fontes, embora o log de PII esteja explicitamente habilitado para a segunda fonte.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-126">This means that, for the following App.config, file, PII is not logged for both sources even though PII logging is explicitly enabled for the second source.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"   
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="9e9b2-127">Se o `<machineSettings enableLoggingKnownPii="Boolean"/>` elemento existir fora do arquivo Machine. config, o sistema lançará <xref:System.Configuration.ConfigurationErrorsException>um.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-127">If the `<machineSettings enableLoggingKnownPii="Boolean"/>` element exists outside the Machine.config file, the system throws a <xref:System.Configuration.ConfigurationErrorsException>.</span></span>  
  
 <span data-ttu-id="9e9b2-128">As alterações entram em vigor somente quando o aplicativo é iniciado ou reiniciado.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-128">The changes are effective only when the application starts or restarts.</span></span> <span data-ttu-id="9e9b2-129">Um evento é registrado na inicialização quando ambos os atributos são definidos `true`como.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-129">An event is logged at startup when both attributes are set to `true`.</span></span> <span data-ttu-id="9e9b2-130">Um evento também será registrado se `logKnownPii` for definido como `true` , `enableLoggingKnownPii` mas `false`for.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-130">An event is also logged if `logKnownPii` is set to `true` but `enableLoggingKnownPii` is `false`.</span></span>  
  
 <span data-ttu-id="9e9b2-131">O administrador do computador e o implantador de aplicativos devem ter muito cuidado ao usar essas duas opções.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-131">The machine administrator and application deployer should exercise extreme caution when using these two switches.</span></span> <span data-ttu-id="9e9b2-132">Se o log de PII estiver habilitado, as chaves de segurança e PII serão registradas.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-132">If PII logging is enabled, security keys and PII are logged.</span></span> <span data-ttu-id="9e9b2-133">Se estiver desabilitado, os dados confidenciais e específicos do aplicativo ainda serão registrados em cabeçalhos e corpos de mensagens.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-133">If it is disabled, sensitive and application-specific data is still logged in message headers and bodies.</span></span> <span data-ttu-id="9e9b2-134">Para obter uma discussão mais detalhada sobre privacidade e proteger a PII de ser exposta, consulte [privacidade do usuário](https://go.microsoft.com/fwlink/?LinkID=94647).</span><span class="sxs-lookup"><span data-stu-id="9e9b2-134">For a more thorough discussion about privacy and protecting PII from being exposed, see [User Privacy](https://go.microsoft.com/fwlink/?LinkID=94647).</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="9e9b2-135">PII não está oculta em mensagens malformadas.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-135">PII is not hidden in malformed messages.</span></span> <span data-ttu-id="9e9b2-136">Essa mensagem é registrada como está sem qualquer modificação.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-136">Such messaged are logged as-is without any modification.</span></span> <span data-ttu-id="9e9b2-137">Os atributos mencionados anteriormente não têm nenhum efeito sobre isso.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-137">Attributes mentioned previously have no effect on this.</span></span>  
  
### <a name="custom-trace-listener"></a><span data-ttu-id="9e9b2-138">Ouvinte de rastreamento personalizado</span><span class="sxs-lookup"><span data-stu-id="9e9b2-138">Custom Trace Listener</span></span>  
 <span data-ttu-id="9e9b2-139">A adição de um ouvinte de rastreamento personalizado na origem do rastreamento de log de mensagens é um privilégio que deve ser restrito ao administrador.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-139">Adding a custom trace listener on the Message Logging trace source is a privilege that should be restricted to the administrator.</span></span> <span data-ttu-id="9e9b2-140">Isso ocorre porque os ouvintes personalizados mal-intencionados podem ser configurados para enviar mensagens remotamente, o que leva à divulgação de informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-140">This is because malicious custom listeners can be configured to send messages remotely, which leads to sensitive information disclosure.</span></span> <span data-ttu-id="9e9b2-141">Além disso, se você configurar um ouvinte personalizado para enviar mensagens na conexão, como, para um banco de dados remoto, deverá impor o controle de acesso apropriado nos logs de mensagens no computador remoto.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-141">In addition, if you configure a custom listener to send messages on the wire, such as, to a remote database, you should enforce proper access control on the message logs in the remote machine.</span></span>  
  
## <a name="events-triggered-by-message-logging"></a><span data-ttu-id="9e9b2-142">Eventos disparados pelo log de mensagens</span><span class="sxs-lookup"><span data-stu-id="9e9b2-142">Events Triggered by Message Logging</span></span>  
 <span data-ttu-id="9e9b2-143">O a seguir lista todos os eventos emitidos pelo log de mensagens.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-143">The following lists all the events emitted by message logging.</span></span>  
  
- <span data-ttu-id="9e9b2-144">Log de mensagens em: Esse evento é emitido quando o log de mensagens está habilitado na configuração ou por meio do WMI.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-144">Message logging on: This event is emitted when message logging is enabled in configuration, or through WMI.</span></span> <span data-ttu-id="9e9b2-145">O conteúdo do evento é "o log de mensagens foi ativado.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-145">The content of the event is "Message logging has been turned on.</span></span> <span data-ttu-id="9e9b2-146">As informações confidenciais podem ser registradas em texto não criptografado, mesmo que elas tenham sido criptografadas na conexão, por exemplo, corpos de mensagens. "</span><span class="sxs-lookup"><span data-stu-id="9e9b2-146">Sensitive information may be logged in clear text, even if they were encrypted on the wire, for example, message bodies."</span></span>  
  
- <span data-ttu-id="9e9b2-147">Registro em log de mensagem: Esse evento é emitido quando o log de mensagens é desabilitado por meio do WMI.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-147">Message logging off: This event is emitted when message logging is disabled through WMI.</span></span> <span data-ttu-id="9e9b2-148">O conteúdo do evento é "o registro de mensagem foi desativado".</span><span class="sxs-lookup"><span data-stu-id="9e9b2-148">The content of the event is "Message logging has been turned off."</span></span>  
  
- <span data-ttu-id="9e9b2-149">Registrar PII conhecido em: Esse evento é emitido quando o log de PII conhecido está habilitado.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-149">Log Known PII On: This event is emitted when logging of known PII is enabled.</span></span> <span data-ttu-id="9e9b2-150">Isso acontece quando o `enableLoggingKnownPii` atributo `machineSettings` no elemento do arquivo Machine. config é definido como `true`, e o `logKnownPii` atributo do `source` elemento no arquivo app. config ou Web. config é definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-150">This happens when the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `true`, and the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`.</span></span>  
  
- <span data-ttu-id="9e9b2-151">PII conhecida de log não permitido: Esse evento é emitido quando o log de PII conhecido não é permitido.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-151">Log Known PII Not Allowed: This event is emitted when logging of known PII is not allowed.</span></span> <span data-ttu-id="9e9b2-152">Isso acontece quando o `logKnownPii` atributo `source` do elemento no arquivo app. config ou Web. config é definido como `true`, mas o `enableLoggingKnownPii` atributo no `machineSettings` elemento do arquivo Machine. config é definido como `false`.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-152">This happens when the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`, but the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `false`.</span></span> <span data-ttu-id="9e9b2-153">Nenhuma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-153">No exception is thrown.</span></span>  
  
 <span data-ttu-id="9e9b2-154">Esses eventos podem ser exibidos na ferramenta de Visualizador de Eventos que vem com o Windows.</span><span class="sxs-lookup"><span data-stu-id="9e9b2-154">These events can be viewed in the Event Viewer tool that comes with Windows.</span></span> <span data-ttu-id="9e9b2-155">Para obter mais informações sobre isso, consulte [log de eventos](../../../../docs/framework/wcf/diagnostics/event-logging/index.md).</span><span class="sxs-lookup"><span data-stu-id="9e9b2-155">For more information on this, see [Event Logging](../../../../docs/framework/wcf/diagnostics/event-logging/index.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9e9b2-156">Consulte também</span><span class="sxs-lookup"><span data-stu-id="9e9b2-156">See also</span></span>

- [<span data-ttu-id="9e9b2-157">Registro de mensagens em log</span><span class="sxs-lookup"><span data-stu-id="9e9b2-157">Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/message-logging.md)
- [<span data-ttu-id="9e9b2-158">Questões de segurança e dicas úteis para rastreamento</span><span class="sxs-lookup"><span data-stu-id="9e9b2-158">Security Concerns and Useful Tips for Tracing</span></span>](../../../../docs/framework/wcf/diagnostics/tracing/security-concerns-and-useful-tips-for-tracing.md)
