---
title: Política de proteção estendida
ms.date: 03/30/2017
ms.assetid: e2616a10-317e-4c34-8023-0c015a80a82f
ms.openlocfilehash: 3a5b1c7f296c68d407f0217963dec56f53e9a08a
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79144716"
---
# <a name="extended-protection-policy"></a><span data-ttu-id="3a4d3-102">Política de proteção estendida</span><span class="sxs-lookup"><span data-stu-id="3a4d3-102">Extended Protection Policy</span></span>
<span data-ttu-id="3a4d3-103">Proteção estendida é uma iniciativa de segurança para proteger contra ataques de homem no meio (MITM).</span><span class="sxs-lookup"><span data-stu-id="3a4d3-103">Extended Protection is a security initiative for protecting against man-in-the-middle (MITM) attacks.</span></span> <span data-ttu-id="3a4d3-104">Um ataque MITM é uma ameaça à segurança na qual um MITM pega as credenciais de um cliente e as encaminha para um servidor.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-104">A MITM attack is a security threat in which a MITM takes a client’s credentials and forwards it to a server.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="3a4d3-105">Demonstra</span><span class="sxs-lookup"><span data-stu-id="3a4d3-105">Demonstrates</span></span>  
 <span data-ttu-id="3a4d3-106">Proteção estendida</span><span class="sxs-lookup"><span data-stu-id="3a4d3-106">Extended protection</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="3a4d3-107">Discussão</span><span class="sxs-lookup"><span data-stu-id="3a4d3-107">Discussion</span></span>  
 <span data-ttu-id="3a4d3-108">Quando os aplicativos autenticam usando Kerberos, Digest ou NTLM usando HTTPS, um canal TLS (Transport Level Security, segurança de nível de transporte) é estabelecido primeiro e, em seguida, a autenticação ocorre usando o canal seguro.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-108">When applications authenticate using Kerberos, Digest or NTLM using HTTPS, a Transport Level Security (TLS) channel is first established and then authentication takes place using the secure channel.</span></span> <span data-ttu-id="3a4d3-109">No entanto, não há vinculação entre a chave de sessão gerada pelo SSL e a chave de sessão gerada durante a autenticação.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-109">However, there is no binding between the session key generated by SSL and the session key generated during authentication.</span></span> <span data-ttu-id="3a4d3-110">Qualquer MITM pode se estabelecer entre o cliente e o servidor e começar a encaminhar as solicitações do cliente, mesmo quando o próprio canal de transporte é seguro, pois o servidor não tem como saber se o canal seguro foi estabelecido a partir do cliente ou um MITM.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-110">Any MITM can establish itself between the client and the server and start forwarding the requests from the client, even when the transport channel itself is secure, because the server has no way of knowing whether the secure channel has been established from the client or a MITM.</span></span> <span data-ttu-id="3a4d3-111">A solução neste cenário é vincular o canal TLS externo com o canal interno de autenticação, de forma que o servidor possa detectar se há um MITM.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-111">The solution in this scenario is to bind the outer TLS channel with the inner authentication channel such that the server can detect if there is a MITM.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3a4d3-112">Essa amostra só funciona quando hospedada no IIS e não pode funcionar no Cassini – Visual Studio Development Server porque a Cassini não suporta HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-112">This sample only works when hosted on IIS and cannot work on Cassini – Visual Studio Development Server because Cassini does not support HTTPS.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3a4d3-113">Este recurso está atualmente disponível apenas no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-113">This feature is currently only available on Windows 7.</span></span> <span data-ttu-id="3a4d3-114">As seguintes etapas são específicas do Windows 7.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-114">The following steps are specific to Windows 7.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="3a4d3-115">Para configurar, compilar, e executar o exemplo</span><span class="sxs-lookup"><span data-stu-id="3a4d3-115">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="3a4d3-116">Instale serviços de informações da Internet a partir do painel de **controle,** **adicionar/remover programas,** **recursos do Windows.**</span><span class="sxs-lookup"><span data-stu-id="3a4d3-116">Install Internet Information Services from **Control Panel**, **Add/Remove Programs**, **Windows Features**.</span></span>  
  
2. <span data-ttu-id="3a4d3-117">Instale **a autenticação do Windows** em recursos do **Windows,** **Serviços de Informação da Internet,** **Serviços Web mundiais,** **Segurança**e **Autenticação do Windows.**</span><span class="sxs-lookup"><span data-stu-id="3a4d3-117">Install **Windows Authentication** in **Windows Features**, **Internet Information Services**, **World Wide Web Services**, **Security**, and **Windows Authentication**.</span></span>  
  
3. <span data-ttu-id="3a4d3-118">Instale a **ativação HTTP da Windows Communication Foundation** no Windows **Features,** **Microsoft .NET Framework 3.5.1**e **Windows Communication Foundation HTTP Activation**.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-118">Install **Windows Communication Foundation HTTP Activation** in **Windows Features**, **Microsoft .NET Framework 3.5.1**, and **Windows Communication Foundation HTTP Activation**.</span></span>  
  
4. <span data-ttu-id="3a4d3-119">Essa amostra exige que o cliente estabeleça um canal seguro com o servidor, por isso requer a presença de um certificado de servidor que pode ser instalado no IIS (Internet Information Services, gerente de serviços de informação da Internet).</span><span class="sxs-lookup"><span data-stu-id="3a4d3-119">This sample requires the client to establish a secure channel with the server, so it requires the presence of a server certificate which can be installed from Internet Information Services (IIS) Manager.</span></span>  
  
    1. <span data-ttu-id="3a4d3-120">Abra o Gerenciador do IIS.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-120">Open IIS Manager.</span></span> <span data-ttu-id="3a4d3-121">Abra **certificados do servidor,** que aparece na guia **Exibição de recursos** quando o nó raiz (nome da máquina) for selecionado.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-121">Open **Server certificates**, which appears in the **Feature View** tab when the root node (machine name) is selected.</span></span>  
  
    2. <span data-ttu-id="3a4d3-122">Com o propósito de testar esta amostra, crie um certificado auto-assinado.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-122">For the purpose of testing this sample, create a self-signed certificate.</span></span> <span data-ttu-id="3a4d3-123">Se você não quiser que o Internet Explorer indiste sobre o certificado não ser seguro, instale o certificado na loja de autoridade Trusted Certificate Root.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-123">If you do not want Internet Explorer to prompt you about the certificate not being secure, install the certificate in the Trusted Certificate Root authority store.</span></span>  
  
5. <span data-ttu-id="3a4d3-124">Abra o painel **Ações** para o site padrão.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-124">Open the **Actions** pane for the default Web site.</span></span> <span data-ttu-id="3a4d3-125">Clique **em Editar site,** **vinculações.**</span><span class="sxs-lookup"><span data-stu-id="3a4d3-125">Click **Edit Site**, **Bindings**.</span></span> <span data-ttu-id="3a4d3-126">Adicione HTTPS como um tipo, se ainda não estiver presente, com a porta número 443.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-126">Add HTTPS as a type if not already present, with port number 443.</span></span> <span data-ttu-id="3a4d3-127">Atribuir o certificado SSL criado na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-127">Assign the SSL certificate created in the preceding step.</span></span>  
  
6. <span data-ttu-id="3a4d3-128">Construa o serviço.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-128">Build the service.</span></span> <span data-ttu-id="3a4d3-129">Isso cria um diretório virtual no IIS e copia os arquivos .dll, .svc e .config conforme necessário para que o serviço seja hospedado na Web.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-129">This creates a virtual directory in IIS, and copies the .dll, .svc and .config files as required for the service to be Web hosted.</span></span>  
  
7. <span data-ttu-id="3a4d3-130">Abra o Gerenciador do IIS.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-130">Open IIS Manager.</span></span> <span data-ttu-id="3a4d3-131">Clique com o botão direito do mouse no diretório virtual **(ExtendedProtection),** que foi criado na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-131">Right-click the virtual directory (**ExtendedProtection**), which was created in the preceding step.</span></span> <span data-ttu-id="3a4d3-132">Selecione **Converter para aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-132">Select **Convert to Application**.</span></span>  
  
8. <span data-ttu-id="3a4d3-133">Abra o módulo **de autenticação** no IIS Manager para este diretório virtual e habilite **a Autenticação do Windows**.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-133">Open the **Authentication** module in IIS Manager for this virtual directory and enable **Windows Authentication**.</span></span>  
  
9. <span data-ttu-id="3a4d3-134">Abra **configurações avançadas** na **autenticação do Windows** para este diretório virtual e defina-a como **Obrigatório**.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-134">Open **Advanced Settings** under **Windows Authentication** for this virtual directory and set it to **Required**.</span></span>  
  
10. <span data-ttu-id="3a4d3-135">Você pode testar o serviço acessando a URL HTTPS a partir de uma janela do navegador (Forneça um nome de domínio totalmente qualificado).</span><span class="sxs-lookup"><span data-stu-id="3a4d3-135">You can test the service by accessing the HTTPS URL from a browser window (Provide a fully-qualified domain name).</span></span> <span data-ttu-id="3a4d3-136">Se você quiser acessar esta URL a partir de uma máquina remota, certifique-se de que o firewall está aberto para todas as conexões HTTP e HTTPS recebidas.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-136">If you want to access this URL from a remote machine, make sure that the firewall is opened for all incoming HTTP and HTTPS connections.</span></span>  
  
11. <span data-ttu-id="3a4d3-137">Abra o arquivo de configuração do cliente e forneça um nome de `<<full_machine_name>>`domínio totalmente qualificado para o atributo de endereço cliente ou ponto final que substitui .</span><span class="sxs-lookup"><span data-stu-id="3a4d3-137">Open the client configuration file and provide a fully-qualified domain name for the client or endpoint address attribute that replaces `<<full_machine_name>>`.</span></span>  
  
12. <span data-ttu-id="3a4d3-138">Corra com o cliente.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-138">Run the client.</span></span> <span data-ttu-id="3a4d3-139">O cliente se comunica com o serviço, que estabelece um canal seguro e usa proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-139">The client communicates with the service, which establishes a secure channel and uses extended protection.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="3a4d3-140">Os exemplos podem já estar instalados no seu computador.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-140">The samples may already be installed on your machine.</span></span> <span data-ttu-id="3a4d3-141">Verifique o seguinte diretório (padrão) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-141">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="3a4d3-142">Se esse diretório não existir, vá para [a Windows Communication Foundation (WCF) e para o Windows Workflow Foundation (WF) Amostras para .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) para baixar todas as Amostras e amostras da [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Windows Communication Foundation (Windows Communication Foundation).</span><span class="sxs-lookup"><span data-stu-id="3a4d3-142">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="3a4d3-143">Este exemplo está localizado no seguinte diretório.</span><span class="sxs-lookup"><span data-stu-id="3a4d3-143">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\Security\ExtendedProtection`
