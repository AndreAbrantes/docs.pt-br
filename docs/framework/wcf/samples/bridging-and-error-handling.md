---
title: Tratamento de erro e ponte
ms.date: 03/30/2017
ms.assetid: 4ae87d1a-b615-4014-a494-a53f63ff0137
ms.openlocfilehash: 6afaddc75855b7e95ad708b2179cabb9aee35001
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/01/2018
ms.locfileid: "43389062"
---
# <a name="bridging-and-error-handling"></a><span data-ttu-id="50e60-102">Tratamento de erro e ponte</span><span class="sxs-lookup"><span data-stu-id="50e60-102">Bridging and Error Handling</span></span>
<span data-ttu-id="50e60-103">Este exemplo demonstra como o serviço de roteamento do Windows Communication Foundation (WCF) é usado para a ponte de comunicação entre um cliente e um serviço que usam ligações diferentes.</span><span class="sxs-lookup"><span data-stu-id="50e60-103">This sample demonstrates how the Windows Communication Foundation (WCF) routing service is used for bridging communication between a client and a service that use different bindings.</span></span> <span data-ttu-id="50e60-104">Este exemplo também mostra como usar um serviço de backup para cenários de failover.</span><span class="sxs-lookup"><span data-stu-id="50e60-104">This sample also shows how to use a back-up service for failover scenarios.</span></span> <span data-ttu-id="50e60-105">O serviço de roteamento é um componente do WCF que torna mais fácil incluir um roteador baseado em conteúdo em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="50e60-105">The routing service is a WCF component that makes it easy to include a content-based router in your application.</span></span> <span data-ttu-id="50e60-106">Este exemplo se adapta a amostragem de calculadora padrão do WCF para se comunicar usando o serviço de roteamento.</span><span class="sxs-lookup"><span data-stu-id="50e60-106">This sample adapts the standard WCF Calculator Sample to communicate using the routing service.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="50e60-107">Os exemplos podem mais ser instalados no seu computador.</span><span class="sxs-lookup"><span data-stu-id="50e60-107">The samples may already be installed on your computer.</span></span> <span data-ttu-id="50e60-108">Verifique o seguinte diretório (padrão) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="50e60-108">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="50e60-109">Se este diretório não existir, vá para [Windows Communication Foundation (WCF) e o Windows Workflow Foundation (WF) exemplos do .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) para baixar todos os Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemplos.</span><span class="sxs-lookup"><span data-stu-id="50e60-109">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="50e60-110">Este exemplo está localizado no seguinte diretório.</span><span class="sxs-lookup"><span data-stu-id="50e60-110">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\RoutingServices\ErrorHandlingAndBridging`  
  
## <a name="sample-details"></a><span data-ttu-id="50e60-111">Detalhes de exemplo</span><span class="sxs-lookup"><span data-stu-id="50e60-111">Sample Details</span></span>  
 <span data-ttu-id="50e60-112">Neste exemplo, o cliente de calculadora é configurado para enviar mensagens para um ponto de extremidade exposto pelo roteador.</span><span class="sxs-lookup"><span data-stu-id="50e60-112">In this sample, the Calculator client is configured to send messages to an endpoint exposed by the router.</span></span> <span data-ttu-id="50e60-113">O serviço de roteamento está configurado para aceitar todas as mensagens enviadas a ele e encaminhá-las a um ponto de extremidade que corresponde ao serviço de calculadora.</span><span class="sxs-lookup"><span data-stu-id="50e60-113">The routing service is configured to accept all messages sent to it and to forward them to an endpoint that corresponds to the Calculator service.</span></span> <span data-ttu-id="50e60-114">Os pontos a seguir descrevem a configuração do serviço da Calculadora primário, o serviço da Calculadora de backup e o cliente de Calculadora e como a comunicação entre o cliente e o serviço ocorre usando o serviço de roteamento:</span><span class="sxs-lookup"><span data-stu-id="50e60-114">The following points describe the configuration of the primary Calculator service, the back-up Calculator service, and the Calculator client and how the communication between the client and the service happens using the routing service:</span></span>  
  
-   <span data-ttu-id="50e60-115">O cliente de calculadora é configurado para usar BasicHttpBinding, enquanto o serviço da calculadora é configurado para usar a NetTcpBinding.</span><span class="sxs-lookup"><span data-stu-id="50e60-115">The Calculator client is configured to use BasicHttpBinding while the Calculator service is configured to use NetTcpBinding.</span></span> <span data-ttu-id="50e60-116">O serviço de roteamento converte automaticamente as mensagens conforme necessário antes de enviá-los para o serviço da Calculadora e também converte as respostas para que o cliente de calculadora possa acessá-los.</span><span class="sxs-lookup"><span data-stu-id="50e60-116">The routing service automatically converts the messages as necessary before sending them to the Calculator service and it also converts the responses so that the Calculator client can access them.</span></span>  
  
-   <span data-ttu-id="50e60-117">O serviço de roteamento sabe sobre os dois serviços de Calculadora: o serviço da Calculadora primário e o serviço de Calculadora de backup.</span><span class="sxs-lookup"><span data-stu-id="50e60-117">The routing service knows about two Calculator services: the primary Calculator service and the back-up Calculator service.</span></span> <span data-ttu-id="50e60-118">O serviço de roteamento primeiro tenta se comunicar com o principal ponto de extremidade de serviço de calculadora.</span><span class="sxs-lookup"><span data-stu-id="50e60-118">The routing service first attempts to communicate with the primary Calculator service endpoint.</span></span> <span data-ttu-id="50e60-119">Se essa tentativa falhar porque o ponto de extremidade que está sendo pressionada, o serviço de roteamento, em seguida, tenta se comunicar com o ponto de extremidade de serviço de Calculadora de backup.</span><span class="sxs-lookup"><span data-stu-id="50e60-119">If this attempt fails due to the endpoint being down, the routing service then tries to communicate with the back-up Calculator service endpoint.</span></span>  
  
 <span data-ttu-id="50e60-120">Assim, as mensagens enviadas do cliente são recebidas pelo roteador e são redirecionadas para o serviço da Calculadora real.</span><span class="sxs-lookup"><span data-stu-id="50e60-120">Thus messages sent from the client are received by the router and are rerouted to the actual Calculator service.</span></span> <span data-ttu-id="50e60-121">Se o ponto de extremidade de serviço de Calculadora estiver inativo, o serviço de roteamento encaminha a mensagem para o ponto de extremidade de serviço de Calculadora de backup.</span><span class="sxs-lookup"><span data-stu-id="50e60-121">If the Calculator service endpoint is down, the routing service routes the message to the back-up Calculator service endpoint.</span></span> <span data-ttu-id="50e60-122">Mensagens do serviço de Calculadora de backup são enviadas de volta para o roteador de serviço, que por sua vez passa de volta para o cliente de calculadora.</span><span class="sxs-lookup"><span data-stu-id="50e60-122">Messages from the back-up Calculator service are sent back to the service router, which in turn passes them back to the Calculator client.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="50e60-123">Uma lista de backup pode ter mais de um ponto de extremidade definido.</span><span class="sxs-lookup"><span data-stu-id="50e60-123">A back-up list can have more than one endpoint defined.</span></span> <span data-ttu-id="50e60-124">Nesse caso, se o ponto de extremidade de serviço de backup estiver inativo, o serviço de roteamento tenta conectar-se para o próximo ponto de extremidade de backup na lista até que ocorra uma conexão bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="50e60-124">In this case if the back-up service endpoint is down, the routing service attempts to connect to the next back-up endpoint in the list until a successful connection occurs.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="50e60-125">Para usar este exemplo</span><span class="sxs-lookup"><span data-stu-id="50e60-125">To use this sample</span></span>  
  
1.  <span data-ttu-id="50e60-126">Usando [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], abra RouterBridgingAndErrorHandling.sln.</span><span class="sxs-lookup"><span data-stu-id="50e60-126">Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open RouterBridgingAndErrorHandling.sln.</span></span>  
  
2.  <span data-ttu-id="50e60-127">Pressione F5 ou CTRL + SHIFT + B no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="50e60-127">Press F5 or CTRL+SHIFT+B in Visual Studio</span></span>  
  
    1.  <span data-ttu-id="50e60-128">Se você quiser iniciar automaticamente os projetos necessários quando você pressiona F5, clique com botão direito a solução, selecione **propriedades**e, nas **projeto de inicialização** nó sob **depropriedadescomuns**, selecione **vários projetos de inicialização**e defina todos os projetos para **iniciar**.</span><span class="sxs-lookup"><span data-stu-id="50e60-128">If you would like to auto-launch the necessary projects when you press F5, right-click the solution, select **Properties**, and in the **Startup Project** node under **Common Properties**, select **Multiple Startup Projects**, and set all projects to **Start**.</span></span>  
  
    2.  <span data-ttu-id="50e60-129">Se você compilar o projeto com CTRL + SHIFT + B, inicie os seguintes aplicativos:</span><span class="sxs-lookup"><span data-stu-id="50e60-129">If you build the project with CTRL+SHIFT+B, start the following applications:</span></span>  
  
        1.  <span data-ttu-id="50e60-130">Cliente de Calculadora (. / CalculatorClient/bin/client.exe)</span><span class="sxs-lookup"><span data-stu-id="50e60-130">Calculator client (./CalculatorClient/bin/client.exe)</span></span>  
  
        2.  <span data-ttu-id="50e60-131">Serviço da Calculadora (. / CalculatorService/bin/service.exe)</span><span class="sxs-lookup"><span data-stu-id="50e60-131">Calculator service (./CalculatorService/bin/service.exe)</span></span>  
  
        3.  <span data-ttu-id="50e60-132">Serviço de roteamento (. / RoutingService/bin/RoutingService.exe)</span><span class="sxs-lookup"><span data-stu-id="50e60-132">Routing Service (./RoutingService/bin/RoutingService.exe)</span></span>  
  
3.  <span data-ttu-id="50e60-133">No cliente de Calculadora, pressione ENTER para iniciar o cliente.</span><span class="sxs-lookup"><span data-stu-id="50e60-133">In the Calculator Client, press ENTER to start the client.</span></span>  
  
     <span data-ttu-id="50e60-134">Você deverá ver a seguinte saída:</span><span class="sxs-lookup"><span data-stu-id="50e60-134">You should see the following output:</span></span>  
  
    ```Output  
    Add(100,15.99) = 115.99  
    Subtract(145,76.54) = 68.46  
    Multiply(9,81.25) = 731.25  
    Divide(22,7) = 3.14285714285714  
    ```  
  
## <a name="configurable-via-code-or-appconfig"></a><span data-ttu-id="50e60-135">Configurável por meio de código ou App. config</span><span class="sxs-lookup"><span data-stu-id="50e60-135">Configurable Via Code or App.config</span></span>  
 <span data-ttu-id="50e60-136">O vem de exemplo configurado para usar um arquivo App. config para definir o comportamento do roteador.</span><span class="sxs-lookup"><span data-stu-id="50e60-136">The sample ships configured to use an App.config file to define the router’s behavior.</span></span> <span data-ttu-id="50e60-137">Você também pode alterar o nome do arquivo App. config para algo diferente para que ele não é reconhecido e remova a chamada de método para `ConfigureRouterViaCode()`.</span><span class="sxs-lookup"><span data-stu-id="50e60-137">You can also change the name of the App.config file to something else so that it is not recognized and uncomment the method call to `ConfigureRouterViaCode()`.</span></span> <span data-ttu-id="50e60-138">Qualquer um dos métodos resulta no mesmo comportamento do roteador.</span><span class="sxs-lookup"><span data-stu-id="50e60-138">Either method results in the same behavior from the router.</span></span>  
  
### <a name="scenario"></a><span data-ttu-id="50e60-139">Cenário</span><span class="sxs-lookup"><span data-stu-id="50e60-139">Scenario</span></span>  
 <span data-ttu-id="50e60-140">Este exemplo demonstra o roteador de serviço que atua como um manipulador de erro e ponte de protocolo.</span><span class="sxs-lookup"><span data-stu-id="50e60-140">This sample demonstrates the service router acting as a protocol bridge and error handler.</span></span> <span data-ttu-id="50e60-141">Nesse cenário, nenhuma roteamento baseado em conteúdo ocorre; o serviço de roteamento atua como um nó de proxy transparente configurado para passar mensagens diretamente para um conjunto predefinido de pontos de extremidade de destino.</span><span class="sxs-lookup"><span data-stu-id="50e60-141">In this scenario, no content-based routing occurs; the routing service acts as a transparent proxy node configured to pass messages directly to a preconfigured set of destination endpoints.</span></span> <span data-ttu-id="50e60-142">O serviço de roteamento também executa as etapas adicionais de forma transparente de tratamento de erros que ocorrem quando ele tenta enviar para os pontos de extremidade que ele está configurado para se comunicar com.</span><span class="sxs-lookup"><span data-stu-id="50e60-142">The routing service also performs the additional steps of transparently handling errors that occur when it tries to send to the endpoints that it is configured to communicate with.</span></span> <span data-ttu-id="50e60-143">Atuando como uma ponte de protocolo, o serviço de roteamento permite que o usuário defina um protocolo de comunicação externa e outro para a comunicação interna.</span><span class="sxs-lookup"><span data-stu-id="50e60-143">By acting as a protocol bridge, the routing service enables the user to define one protocol for external communication and another for internal communication.</span></span>  
  
### <a name="real-world-scenario"></a><span data-ttu-id="50e60-144">Cenário do mundo real</span><span class="sxs-lookup"><span data-stu-id="50e60-144">Real World Scenario</span></span>  
 <span data-ttu-id="50e60-145">A Contoso deseja fornecer um ponto de extremidade de serviço interoperável com o mundo, otimizando o desempenho internamente.</span><span class="sxs-lookup"><span data-stu-id="50e60-145">Contoso wants to provide an interoperable service endpoint to the world, while optimizing performance internally.</span></span> <span data-ttu-id="50e60-146">Assim, ele expõe seus serviços para o mundo por meio de um ponto de extremidade usando o BasicHttpBinding, enquanto usa internamente o serviço de roteamento para acabar com essa conexão ao ponto de extremidade usando NetTcpBinding, que usam seus serviços.</span><span class="sxs-lookup"><span data-stu-id="50e60-146">Thus it exposes its services to the world through an endpoint using the BasicHttpBinding, while internally using the routing service to bridge that connection to the endpoint using NetTcpBinding, which its services use.</span></span> <span data-ttu-id="50e60-147">Além disso, a Contoso deseja que sua oferta de serviço para ser tolerante a falhas de interrupções temporárias em qualquer uma de sua produção de serviços e, portanto, virtualiza vários pontos de extremidade por trás do serviço de roteador usando o de recursos para o failover automaticamente para o tratamento de erros fazer backup os pontos de extremidade quando necessário.</span><span class="sxs-lookup"><span data-stu-id="50e60-147">Furthermore, Contoso wants its service offering to be tolerant of temporary outages in any one of their production services and thus virtualizes multiple endpoints behind the router service using the ’s error handling capabilities to automatically failover to back-up endpoints when necessary.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="50e60-148">Consulte também</span><span class="sxs-lookup"><span data-stu-id="50e60-148">See Also</span></span>  
 [<span data-ttu-id="50e60-149">Hospedagem de AppFabric e persistência exemplos</span><span class="sxs-lookup"><span data-stu-id="50e60-149">AppFabric Hosting and Persistence Samples</span></span>](https://go.microsoft.com/fwlink/?LinkId=193961)
