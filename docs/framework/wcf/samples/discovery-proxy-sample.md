---
title: Exemplo de proxy de descoberta
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1dfa02df-15b1-4e97-9c8e-f5f2772711b0
caps.latest.revision: "14"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: f16cf2ffc9e03308ce3b8a5e967c29e624ffd1af
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/18/2017
---
# <a name="discovery-proxy-sample"></a><span data-ttu-id="bde1d-102">Exemplo de proxy de descoberta</span><span class="sxs-lookup"><span data-stu-id="bde1d-102">Discovery Proxy Sample</span></span>
<span data-ttu-id="bde1d-103">Este exemplo mostra como criar uma implementação de um proxy de descoberta para armazenar informações sobre os serviços existentes e como os clientes podem consultar para obter informações de proxy.</span><span class="sxs-lookup"><span data-stu-id="bde1d-103">This sample shows how to create an implementation of a Discovery proxy to store information about existing services and how clients can query that proxy for information.</span></span> <span data-ttu-id="bde1d-104">Este exemplo consiste em três projetos:</span><span class="sxs-lookup"><span data-stu-id="bde1d-104">This sample consists of three projects:</span></span>  
  
-   <span data-ttu-id="bde1d-105">**Serviço**: um simples [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] serviço de cálculo que é registrado com o proxy de descoberta.</span><span class="sxs-lookup"><span data-stu-id="bde1d-105">**Service**: A simple [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] calculator service that registers itself with the discovery proxy.</span></span>  
  
-   <span data-ttu-id="bde1d-106">**Proxy de descoberta**: A implementação de um serviço de proxy de descoberta.</span><span class="sxs-lookup"><span data-stu-id="bde1d-106">**Discovery Proxy**: The implementation of a discovery proxy service.</span></span>  
  
-   <span data-ttu-id="bde1d-107">**Cliente**: aplicativo de cliente do WCF de um que chama o proxy de descoberta para pesquisar para serviços.</span><span class="sxs-lookup"><span data-stu-id="bde1d-107">**Client**: A WCF client application that calls the discovery proxy to search for services.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="bde1d-108">Demonstra</span><span class="sxs-lookup"><span data-stu-id="bde1d-108">Demonstrates</span></span>  
 <span data-ttu-id="bde1d-109">Implementação de proxy de descoberta</span><span class="sxs-lookup"><span data-stu-id="bde1d-109">Discovery proxy implementation</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="bde1d-110">Os exemplos podem já estar instalados no seu computador.</span><span class="sxs-lookup"><span data-stu-id="bde1d-110">The samples may already be installed on your machine.</span></span> <span data-ttu-id="bde1d-111">Verifique o seguinte diretório (padrão) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="bde1d-111">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="bde1d-112">Se este diretório não existir, vá para [Windows Communication Foundation (WCF) e exemplos do Windows Workflow Foundation (WF) para o .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) para baixar todos os [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemplos.</span><span class="sxs-lookup"><span data-stu-id="bde1d-112">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="bde1d-113">Este exemplo está localizado no seguinte diretório.</span><span class="sxs-lookup"><span data-stu-id="bde1d-113">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Discovery\DiscoveryProxy`  
  
## <a name="discoveryproxy"></a><span data-ttu-id="bde1d-114">DiscoveryProxy</span><span class="sxs-lookup"><span data-stu-id="bde1d-114">DiscoveryProxy</span></span>  
 <span data-ttu-id="bde1d-115">No `Main` método do arquivo Program.cs, o exemplo mostra como um serviço do tipo <xref:System.ServiceModel.Discovery.DiscoveryProxy> está hospedado.</span><span class="sxs-lookup"><span data-stu-id="bde1d-115">In the `Main` method of the Program.cs file, the sample shows how a service of type <xref:System.ServiceModel.Discovery.DiscoveryProxy> is hosted.</span></span> <span data-ttu-id="bde1d-116">Ela expõe dois pontos de extremidade, um tipo <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> e outro tipo <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="bde1d-116">It exposes two endpoints, one of type <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> and another of type <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span></span> <span data-ttu-id="bde1d-117">Ambos os pontos de extremidade usam o TCP como um transporte.</span><span class="sxs-lookup"><span data-stu-id="bde1d-117">Both of the endpoints use TCP as a transport.</span></span> <span data-ttu-id="bde1d-118">O <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> está escutando no URI especificado pelo `probeEndpointAddress` parâmetro, isso é onde os clientes podem enviar mensagens de teste para consultar o proxy para seus dados.</span><span class="sxs-lookup"><span data-stu-id="bde1d-118">The <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> is listening at the URI specified by the `probeEndpointAddress` parameter, this is where clients can send probe messages to query the proxy for its data.</span></span> <span data-ttu-id="bde1d-119">O <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> está escutando no URI especificado pelo `announcementEndpointAddress` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="bde1d-119">The <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> is listening at the URI specified by the `announcementEndpointAddress` parameter.</span></span> <span data-ttu-id="bde1d-120">Isso é onde o proxy ouve para anúncios.</span><span class="sxs-lookup"><span data-stu-id="bde1d-120">This is where the proxy listens to for announcements.</span></span> <span data-ttu-id="bde1d-121">Quando um anúncio online é recebido, o proxy adiciona o serviço em seu cache e quando um comunicado offline é recebido remove o serviço do seu cache.</span><span class="sxs-lookup"><span data-stu-id="bde1d-121">When an online announcement is received, the proxy adds the service to its cache and when an offline announcement is received it removes the service from its cache.</span></span>  
  
 <span data-ttu-id="bde1d-122">O DiscoveryProxy.cs contém a implementação do <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span><span class="sxs-lookup"><span data-stu-id="bde1d-122">The DiscoveryProxy.cs contains the implementation of the <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span></span> <span data-ttu-id="bde1d-123">O Proxy deve herdar do <xref:System.Object> classe e requer uma implementação de <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="bde1d-123">The Proxy must inherit from the <xref:System.Object> class and requires an implementation of <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span></span> <span data-ttu-id="bde1d-124">Durante a instanciação, o Proxy cria um novo <xref:System.Collections.Generic.Dictionary%602>, que usa para armazenar elementos que ele conheça.</span><span class="sxs-lookup"><span data-stu-id="bde1d-124">At instantiation, the Proxy creates a new <xref:System.Collections.Generic.Dictionary%602>, which it uses to store elements it knows about.</span></span>  
  
 <span data-ttu-id="bde1d-125">O arquivo é dividido em duas regiões, métodos de Cache de Proxy e a implementação de Proxy de descoberta.</span><span class="sxs-lookup"><span data-stu-id="bde1d-125">The file is divided into two regions, Proxy Cache Methods and Discovery Proxy Implementation.</span></span> <span data-ttu-id="bde1d-126">A região de métodos de Cache de Proxy contém métodos usados para atualizar o <xref:System.Collections.Generic.Dictionary%602>, executar consultas em relação a <xref:System.Collections.Generic.Dictionary%602>e imprimir os dados de usuários.</span><span class="sxs-lookup"><span data-stu-id="bde1d-126">The Proxy Cache Methods region contains methods used to update the <xref:System.Collections.Generic.Dictionary%602>, perform queries against the <xref:System.Collections.Generic.Dictionary%602>, and print the data for users.</span></span> <span data-ttu-id="bde1d-127">A região de implementação de Proxy de descoberta contém métodos substituídos necessários para a funcionalidade de anúncio e investigação.</span><span class="sxs-lookup"><span data-stu-id="bde1d-127">The Discovery Proxy Implementation region contains the overridden methods required for the Announcement and Probe functionality.</span></span> <span data-ttu-id="bde1d-128">Eles definem as ações realizadas por um proxy depois de receber um anúncio Online, um anúncio Offline ou uma mensagem de teste.</span><span class="sxs-lookup"><span data-stu-id="bde1d-128">They define the actions taken by a proxy after receiving an Online Announcement, an Offline Announcement, or a Probe message.</span></span>  
  
## <a name="service"></a><span data-ttu-id="bde1d-129">Serviço</span><span class="sxs-lookup"><span data-stu-id="bde1d-129">Service</span></span>  
 <span data-ttu-id="bde1d-130">No arquivo Program.cs no projeto de serviço, o mesmo URI é usado para seu ponto de extremidade de anúncio como o proxy de descoberta.</span><span class="sxs-lookup"><span data-stu-id="bde1d-130">In the Program.cs file in the Service project, the same URI is used for its announcement endpoint as the discovery proxy.</span></span> <span data-ttu-id="bde1d-131">Isso ocorre porque o serviço usa o ponto de extremidade para enviar os anúncios, enquanto o proxy usa para recebê-los.</span><span class="sxs-lookup"><span data-stu-id="bde1d-131">This is because service uses the endpoint for sending the announcements, while the proxy uses it for receiving them.</span></span> <span data-ttu-id="bde1d-132">O serviço usa o <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> e adiciona um ponto de extremidade do anúncio a ele.</span><span class="sxs-lookup"><span data-stu-id="bde1d-132">The service uses the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> and adds an announcement endpoint to it.</span></span>  
  
## <a name="client"></a><span data-ttu-id="bde1d-133">Cliente</span><span class="sxs-lookup"><span data-stu-id="bde1d-133">Client</span></span>  
 <span data-ttu-id="bde1d-134">O projeto de cliente usa o mesmo URI para seu ponto de extremidade de teste como o Proxy.</span><span class="sxs-lookup"><span data-stu-id="bde1d-134">The Client project uses the same URI for its probe endpoint as the Proxy.</span></span> <span data-ttu-id="bde1d-135">Isso ocorre porque os testes nesse cenário também estão sendo unicast especificamente para o ponto de extremidade disponível no proxy.</span><span class="sxs-lookup"><span data-stu-id="bde1d-135">This is because the probes in this scenario are also being unicast specifically to the endpoint available on the proxy.</span></span> <span data-ttu-id="bde1d-136">O cliente se conecta a esse endereço conhecido e, em seguida, consulta o serviço.</span><span class="sxs-lookup"><span data-stu-id="bde1d-136">The Client connects to this well-known address and then queries it for the service.</span></span> <span data-ttu-id="bde1d-137">Depois de encontrar o serviço se conecta a ele.</span><span class="sxs-lookup"><span data-stu-id="bde1d-137">Once it has found the service it connects to it.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="bde1d-138">Para usar este exemplo</span><span class="sxs-lookup"><span data-stu-id="bde1d-138">To use this sample</span></span>  
  
1.  <span data-ttu-id="bde1d-139">Carregar a solução do projeto em [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] e compile o projeto.</span><span class="sxs-lookup"><span data-stu-id="bde1d-139">Load the project solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and build the project.</span></span>  
  
2.  <span data-ttu-id="bde1d-140">Primeiro, execute o aplicativo de Proxy de descoberta, gerado em \DiscoveryProxy\bin\debug [diretório base de solução].</span><span class="sxs-lookup"><span data-stu-id="bde1d-140">First run the Discovery Proxy application, generated in [solution base directory]\DiscoveryProxy\bin\debug.</span></span> <span data-ttu-id="bde1d-141">O Proxy de descoberta deve executar primeiro como pontos de extremidade TCP anúncio devem ser o serviço para enviar seus anúncios.</span><span class="sxs-lookup"><span data-stu-id="bde1d-141">The Discovery Proxy must run first because TCP announcement endpoints must be up for the service to send its announcements.</span></span>  
  
3.  <span data-ttu-id="bde1d-142">Em segundo lugar, execute o aplicativo de serviço gerado em \Service\bin\debug [diretório base de solução].</span><span class="sxs-lookup"><span data-stu-id="bde1d-142">Second, run the service application generated in [solution base directory]\Service\bin\debug.</span></span> <span data-ttu-id="bde1d-143">Na inicialização, o serviço envia um anúncio para o ponto de extremidade de lançamento do proxy de descoberta e está registrado no cache do proxy.</span><span class="sxs-lookup"><span data-stu-id="bde1d-143">At start-up, the service sends an announcement to the announcement endpoint of the discovery proxy and is registered in the proxy’s cache.</span></span>  
  
4.  <span data-ttu-id="bde1d-144">Em seguida, execute o aplicativo cliente, gerado em \Client\bin\debug [diretório base de solução].</span><span class="sxs-lookup"><span data-stu-id="bde1d-144">Next, run the client application, generated in [solution base directory]\Client\bin\debug.</span></span> <span data-ttu-id="bde1d-145">O cliente consulta o proxy, obtém o endereço do serviço e, em seguida, conecta-se ao serviço.</span><span class="sxs-lookup"><span data-stu-id="bde1d-145">The client queries the proxy, gets the service address and then connects to the service.</span></span>  
  
5.  <span data-ttu-id="bde1d-146">Por fim, encerre o cliente, serviço e, em seguida, o proxy.</span><span class="sxs-lookup"><span data-stu-id="bde1d-146">Lastly, terminate the client, service and then the proxy.</span></span> <span data-ttu-id="bde1d-147">O proxy deve estar executando para receber notificação offline do serviço.</span><span class="sxs-lookup"><span data-stu-id="bde1d-147">The proxy must be running for it to receive the service's offline announcement.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bde1d-148">Consulte também</span><span class="sxs-lookup"><span data-stu-id="bde1d-148">See Also</span></span>
