---
title: Vários pontos de extremidade em único ListenUri
ms.date: 03/30/2017
ms.assetid: 911ffad4-4d47-4430-b7c2-79192ce6bcbd
ms.openlocfilehash: 6852c673ef21c2b2d511b02d4cc146b22c4c7506
ms.sourcegitcommit: bce0586f0cccaae6d6cbd625d5a7b824d1d3de4b
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/02/2019
ms.locfileid: "58821017"
---
# <a name="multiple-endpoints-at-a-single-listenuri"></a><span data-ttu-id="cd59e-102">Vários pontos de extremidade em único ListenUri</span><span class="sxs-lookup"><span data-stu-id="cd59e-102">Multiple Endpoints at a Single ListenUri</span></span>
<span data-ttu-id="cd59e-103">Este exemplo demonstra um serviço que hospeda vários pontos de extremidade em um único `ListenUri`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-103">This sample demonstrates a service that hosts multiple endpoints at a single `ListenUri`.</span></span> <span data-ttu-id="cd59e-104">Este exemplo se baseia a [guia de Introdução](../../../../docs/framework/wcf/samples/getting-started-sample.md) que implementa um serviço de calculadora.</span><span class="sxs-lookup"><span data-stu-id="cd59e-104">This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="cd59e-105">As instruções de procedimento e compilação de configuração para este exemplo estão localizadas no final deste tópico.</span><span class="sxs-lookup"><span data-stu-id="cd59e-105">The setup procedure and build instructions for this sample are located at the end of this topic.</span></span>  
  
 <span data-ttu-id="cd59e-106">Conforme demonstrado a [vários pontos de extremidade](../../../../docs/framework/wcf/samples/multiple-endpoints.md) exemplo, um serviço pode hospedar vários pontos de extremidade, cada um com diferentes endereços e possivelmente também ligações diferentes.</span><span class="sxs-lookup"><span data-stu-id="cd59e-106">As demonstrated in the [Multiple Endpoints](../../../../docs/framework/wcf/samples/multiple-endpoints.md) sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings.</span></span> <span data-ttu-id="cd59e-107">Este exemplo mostra que é possível hospedar vários pontos de extremidade no mesmo endereço.</span><span class="sxs-lookup"><span data-stu-id="cd59e-107">This sample shows that it is possible to host multiple endpoints at the same address.</span></span> <span data-ttu-id="cd59e-108">Este exemplo também demonstra as diferenças entre os dois tipos de endereços que tem um ponto de extremidade de serviço: `EndpointAddress` e `ListenUri`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-108">This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: `EndpointAddress` and `ListenUri`.</span></span>  
  
 <span data-ttu-id="cd59e-109">O `EndpointAddress` é o endereço lógico de um serviço.</span><span class="sxs-lookup"><span data-stu-id="cd59e-109">The `EndpointAddress` is the logical address of a service.</span></span> <span data-ttu-id="cd59e-110">É o endereço de mensagens SOAP são endereçadas a.</span><span class="sxs-lookup"><span data-stu-id="cd59e-110">It is the address that SOAP messages are addressed to.</span></span> <span data-ttu-id="cd59e-111">O `ListenUri` é o endereço físico do serviço.</span><span class="sxs-lookup"><span data-stu-id="cd59e-111">The `ListenUri` is the physical address of the service.</span></span> <span data-ttu-id="cd59e-112">Ele tem as informações de porta e endereço em que o ponto de extremidade de serviço, na verdade, escuta de mensagens no computador atual.</span><span class="sxs-lookup"><span data-stu-id="cd59e-112">It has the port and address information where the service endpoint actually listens for messages on the current machine.</span></span> <span data-ttu-id="cd59e-113">Na maioria dos casos, não é necessário para esses endereços forem diferentes; Quando um `ListenUri` não for especificado explicitamente, o padrão é o URI do `EndpointAddress` do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="cd59e-113">In most cases, there is no need for these addresses to differ; when a `ListenUri` is not explicitly specified, it defaults to the URI of the `EndpointAddress` of the endpoint.</span></span> <span data-ttu-id="cd59e-114">Em alguns casos, é útil para diferenciá-los, como quando configurar um roteador, que pode aceitar mensagens endereçadas a vários serviços diferentes.</span><span class="sxs-lookup"><span data-stu-id="cd59e-114">In a few cases, it is useful to distinguish them, such as when configuring a router, which might accept messages addressed to a number of different services.</span></span>  
  
## <a name="service"></a><span data-ttu-id="cd59e-115">Serviço</span><span class="sxs-lookup"><span data-stu-id="cd59e-115">Service</span></span>  
 <span data-ttu-id="cd59e-116">O serviço neste exemplo tem dois contratos, `ICalculator` e `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-116">The service in this sample has two contracts, `ICalculator` and `IEcho`.</span></span> <span data-ttu-id="cd59e-117">Além do habitual `IMetadataExchange` ponto de extremidade, há três pontos de extremidade do aplicativo, conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="cd59e-117">In addition to the customary `IMetadataExchange` endpoint, there are three application endpoints, as shown in the following code.</span></span>  
  
```xml  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.ICalculator"   
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"   
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:OtherEcho"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"   
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
```  
  
 <span data-ttu-id="cd59e-118">Todos os três pontos de extremidade são hospedados no mesmo `ListenUri` e use o mesmo `binding` -pontos de extremidade ao mesmo `ListenUri` deve ter a mesma ligação, porque eles estão compartilhando uma pilha de canal único que escuta para mensagens nesse endereço físico a máquina.</span><span class="sxs-lookup"><span data-stu-id="cd59e-118">All three endpoints are hosted at the same `ListenUri` and use the same `binding` - endpoints at the same `ListenUri` must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine.</span></span> <span data-ttu-id="cd59e-119">O `address` de cada ponto de extremidade é um URN; embora normalmente endereços representam locais físicos, de fato o endereço pode ser qualquer tipo de URI, como o endereço é usado para correspondência e fins de filtragem, conforme demonstrado neste exemplo.</span><span class="sxs-lookup"><span data-stu-id="cd59e-119">The `address` of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample.</span></span>  
  
 <span data-ttu-id="cd59e-120">Como todos os três pontos de extremidade compartilham o mesmo `ListenUri`, quando uma mensagem chega lá, o Windows Communication Foundation (WCF) deve decidir qual ponto de extremidade de mensagem é destinada.</span><span class="sxs-lookup"><span data-stu-id="cd59e-120">Because all three endpoints share the same `ListenUri`, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for.</span></span> <span data-ttu-id="cd59e-121">Cada ponto de extremidade tem um filtro de mensagem é composto de duas partes: o filtro de endereço e o filtro de contrato.</span><span class="sxs-lookup"><span data-stu-id="cd59e-121">Each endpoint has a message filter that is comprised of two parts: the address filter and the contract filter.</span></span> <span data-ttu-id="cd59e-122">O filtro de endereço corresponde a `To` da mensagem SOAP para o endereço do ponto de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="cd59e-122">The address filter matches the `To` of the SOAP message to the address of the service endpoint.</span></span> <span data-ttu-id="cd59e-123">Por exemplo, somente mensagens endereçadas `To "Urn:OtherEcho"` são candidatos para o terceiro ponto de extremidade desse serviço.</span><span class="sxs-lookup"><span data-stu-id="cd59e-123">For example, only messages addressed `To "Urn:OtherEcho"` are candidates for the third endpoint of this service.</span></span> <span data-ttu-id="cd59e-124">O filtro de contrato corresponde as ações associadas com as operações de um determinado contrato.</span><span class="sxs-lookup"><span data-stu-id="cd59e-124">The contract filter matches the Actions associated with the operations of a particular contract.</span></span> <span data-ttu-id="cd59e-125">Por exemplo, mensagens com a ação de `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-125">For example, messages with the action of `IEcho`.</span></span> <span data-ttu-id="cd59e-126">`Echo` coincide com os filtros de contrato de segundo e terceiro pontos de extremidade desse serviço, porque ambos os hosts de pontos de extremidade a `IEcho` contrato.</span><span class="sxs-lookup"><span data-stu-id="cd59e-126">`Echo` matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the `IEcho` contract.</span></span>  
  
 <span data-ttu-id="cd59e-127">Portanto, a combinação de filtros de endereço e contrato torna possível rotear cada mensagem que chega a esse serviço `ListenUri` ao ponto de extremidade correto.</span><span class="sxs-lookup"><span data-stu-id="cd59e-127">Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's `ListenUri` to the correct endpoint.</span></span> <span data-ttu-id="cd59e-128">O terceiro ponto de extremidade é diferenciado dos outros dois, pois ele aceita mensagens enviadas para um endereço diferente de outros pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="cd59e-128">The third endpoint is differentiated from the other two because it accepts messages sent to a different address from the other endpoints.</span></span> <span data-ttu-id="cd59e-129">Os pontos de extremidade primeiros e segundo são diferenciados entre si com base em seus contratos (a ação da mensagem de entrada).</span><span class="sxs-lookup"><span data-stu-id="cd59e-129">The first and second endpoints are differentiated from each other based on their contracts (the Action of the incoming message).</span></span>  
  
## <a name="client"></a><span data-ttu-id="cd59e-130">Cliente</span><span class="sxs-lookup"><span data-stu-id="cd59e-130">Client</span></span>  
 <span data-ttu-id="cd59e-131">Assim como os pontos de extremidade no servidor tiverem dois endereços diferentes, os pontos de extremidade também tem dois endereços.</span><span class="sxs-lookup"><span data-stu-id="cd59e-131">Just as endpoints on the server have two different addresses, client endpoints also have two addresses.</span></span> <span data-ttu-id="cd59e-132">No servidor e cliente, o endereço lógico é chamado de `EndpointAddress`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-132">On both server and client, the logical address is called the `EndpointAddress`.</span></span> <span data-ttu-id="cd59e-133">Mas, enquanto o endereço físico é chamado de `ListenUri` no servidor, no cliente, o endereço físico é chamado de `Via`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-133">But whereas the physical address is called the `ListenUri` on the server, on the client, the physical address is called the `Via`.</span></span>  
  
 <span data-ttu-id="cd59e-134">Como no servidor, por padrão, esses dois endereços são os mesmos.</span><span class="sxs-lookup"><span data-stu-id="cd59e-134">As on the server, by default, these two addresses are the same.</span></span> <span data-ttu-id="cd59e-135">Para especificar uma `Via` no cliente que é diferente do endereço do ponto de extremidade, `ClientViaBehavior` é usado:</span><span class="sxs-lookup"><span data-stu-id="cd59e-135">To specify a `Via` on the client that is different from the endpoint's address, `ClientViaBehavior` is used:</span></span>  
  
```csharp  
Uri via = new Uri("http://localhost/ServiceModelSamples/service.svc");  
CalculatorClient calcClient = new CalculatorClient();  
calcClient.ChannelFactory.Endpoint.Behaviors.Add(  
        new ClientViaBehavior(via));  
```  
  
 <span data-ttu-id="cd59e-136">Como de costume, o endereço vem do arquivo de configuração de cliente, que foi gerado pelo Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="cd59e-136">As usual, the address comes from the client configuration file, which was generated by Svcutil.exe.</span></span> <span data-ttu-id="cd59e-137">O `Via` (que corresponde ao `ListenUri` do serviço) não aparece nos metadados do serviço e, portanto, essas informações devem ser comunicadas para a cliente fora de banda (assim como o endereço de metadados do serviço).</span><span class="sxs-lookup"><span data-stu-id="cd59e-137">The `Via` (which corresponds to the `ListenUri` of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address).</span></span>  
  
 <span data-ttu-id="cd59e-138">O cliente neste exemplo envia mensagens para cada um dos pontos de extremidade de aplicativo de três do servidor demonstrar que ela pode se comunicar com (e diferenciar) todos os três pontos de extremidade, mesmo que todos eles têm o mesmo `Via`.</span><span class="sxs-lookup"><span data-stu-id="cd59e-138">The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same `Via`.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="cd59e-139">Para configurar, compilar, e executar o exemplo</span><span class="sxs-lookup"><span data-stu-id="cd59e-139">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="cd59e-140">Certifique-se de que você tenha executado o [procedimento de configuração de uso único para os exemplos do Windows Communication Foundation](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).</span><span class="sxs-lookup"><span data-stu-id="cd59e-140">Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).</span></span>  
  
2.  <span data-ttu-id="cd59e-141">Para compilar a edição em C# ou Visual Basic .NET da solução, siga as instruções em [compilando os exemplos do Windows Communication Foundation](../../../../docs/framework/wcf/samples/building-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="cd59e-141">To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span></span>  
  
3.  <span data-ttu-id="cd59e-142">Para executar o exemplo em uma configuração ou entre computadores, siga as instruções em [executando os exemplos do Windows Communication Foundation](../../../../docs/framework/wcf/samples/running-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="cd59e-142">To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cd59e-143">Para várias máquinas, você deve substituir o localhost no arquivo Client.cs com o nome da máquina do serviço.</span><span class="sxs-lookup"><span data-stu-id="cd59e-143">For cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="cd59e-144">Os exemplos podem já estar instalados no seu computador.</span><span class="sxs-lookup"><span data-stu-id="cd59e-144">The samples may already be installed on your machine.</span></span> <span data-ttu-id="cd59e-145">Verifique o seguinte diretório (padrão) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="cd59e-145">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="cd59e-146">Se este diretório não existir, vá para [Windows Communication Foundation (WCF) e o Windows Workflow Foundation (WF) exemplos do .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) para baixar todos os Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemplos.</span><span class="sxs-lookup"><span data-stu-id="cd59e-146">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="cd59e-147">Este exemplo está localizado no seguinte diretório.</span><span class="sxs-lookup"><span data-stu-id="cd59e-147">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\MultipleEndpointsSingleUri`  
  
