---
title: Colocação e obtenção condicional
ms.date: 03/30/2017
ms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae
ms.openlocfilehash: f2d170da80de1186aa41b4821da52d58a0bb0e0e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33505724"
---
# <a name="conditional-get-and-put"></a><span data-ttu-id="1f3b7-102">Colocação e obtenção condicional</span><span class="sxs-lookup"><span data-stu-id="1f3b7-102">Conditional Get and Put</span></span>
<span data-ttu-id="1f3b7-103">Este exemplo demonstra como usar o novo recuperar condicional e APIs de atualização para o modelo de programação WCF REST.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-103">This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.</span></span> <span data-ttu-id="1f3b7-104">Como recuperar condicional e atualização são mais apropriadas para orientada a recursos e serviços REST, este exemplo estende o [serviço básico do recurso](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemplo.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-104">Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="1f3b7-105">Este exemplo se concentra na adição de suporte para recuperar condicional e atualize para o [serviço básico do recurso](../../../../docs/framework/wcf/samples/basic-resource-service.md) de exemplo usando as novas APIs introduzidas no [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1f3b7-105">This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="1f3b7-106">Demonstra</span><span class="sxs-lookup"><span data-stu-id="1f3b7-106">Demonstrates</span></span>  
 <span data-ttu-id="1f3b7-107">Atualização e recuperar condicional</span><span class="sxs-lookup"><span data-stu-id="1f3b7-107">Conditional Retrieve and Update</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="1f3b7-108">Discussão</span><span class="sxs-lookup"><span data-stu-id="1f3b7-108">Discussion</span></span>  
 <span data-ttu-id="1f3b7-109">Neste exemplo, o serviço de WCF expõe uma coleção de clientes em um recurso orientado e a maneira REST.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-109">The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.</span></span> <span data-ttu-id="1f3b7-110">Para obter uma descrição detalhada da implementação do serviço, consulte o [serviço básico do recurso](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemplo.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-110">For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span>  
  
 <span data-ttu-id="1f3b7-111">Este exemplo adiciona recuperar condicional e os recursos de atualização para o [serviço básico do recurso](../../../../docs/framework/wcf/samples/basic-resource-service.md) exemplo.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-111">This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="1f3b7-112">Condicional recuperar e atualizar use marcas de entidade HTTP e os cabeçalhos HTTP If-None-Match e If-Match para validar que os clientes têm ou não tem a entidade mais atual para um determinado recurso.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-112">Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.</span></span> <span data-ttu-id="1f3b7-113">No entanto, a implementação de código para analisar corretamente os cabeçalhos HTTP If-None-Match e If-Match pode ser tedioso e propenso a erros.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-113">However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.</span></span> <span data-ttu-id="1f3b7-114">Portanto, o <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> e <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> métodos foram adicionados para o <xref:System.ServiceModel.Web.IncomingWebRequestContext>, que pode ser acessado usando a instância atual do <xref:System.ServiceModel.Web.WebOperationContext>.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-114">Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>.</span></span> <span data-ttu-id="1f3b7-115">Além disso, o `SetETag` método foi adicionado para o <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, tornando mais fácil retornar as marcas de entidade válido.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-115">In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.</span></span>  
  
 <span data-ttu-id="1f3b7-116">O <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> método se destina a ser usada com operações [WebGet].</span><span class="sxs-lookup"><span data-stu-id="1f3b7-116">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations.</span></span> <span data-ttu-id="1f3b7-117">Leva a tag de entidade atual para o recurso especificado como o `entityTag` parâmetro, que pode ser um `string`, `int`, `long` ou `Guid`.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-117">It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`.</span></span> <span data-ttu-id="1f3b7-118">O <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> método verifica a tag de entidade com o cabeçalho HTTP If-None-Match da solicitação.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-118">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request.</span></span> <span data-ttu-id="1f3b7-119">Se a marca de entidade estiver presente no cabeçalho HTTP If-None-Match, em seguida, um <xref:System.ServiceModel.Web.WebFaultException> com um status de código de não modificado (304) é lançado; caso contrário, o método retorna.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-119">If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns.</span></span> <span data-ttu-id="1f3b7-120">O mecanismo de recuperar condicional permite que o cliente para informar ao servidor que tem essa entidade e para enviar apenas a entidade atual, se o cliente não tiver.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-120">The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.</span></span> <span data-ttu-id="1f3b7-121">Exemplo de uso do <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> método pode ser visto no `GetCustomer` e `GetCustomers` operações do serviço.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-121">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service.</span></span> <span data-ttu-id="1f3b7-122">É importante observar que chama a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> não pode retornar.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-122">It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return.</span></span> <span data-ttu-id="1f3b7-123">Os desenvolvedores devem implementar a operação para que a solicitação já é conhecida por ser bem-sucedida antes da chamada para <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> é executada, como se a chamada para <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> foi não está presente, o serviço envia uma resposta com um código de status bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-123">Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.</span></span>  
  
 <span data-ttu-id="1f3b7-124">O <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> método é semelhante de <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> método.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-124">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method.</span></span> <span data-ttu-id="1f3b7-125">Também usa a marca de entidade atual para o recurso especificado.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-125">It also takes the current entity tag for the given resource.</span></span> <span data-ttu-id="1f3b7-126">No entanto, destina-se a ser usada com operações [WebInvoke] no qual o método é definido como "PUT" ou "Excluir".</span><span class="sxs-lookup"><span data-stu-id="1f3b7-126">However, it is intended to be used with [WebInvoke] operations in which the method is set to "PUT" or "DELETE".</span></span> <span data-ttu-id="1f3b7-127">O <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> método verifica a tag de entidade com o cabeçalho HTTP If-Match da solicitação.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-127">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request.</span></span> <span data-ttu-id="1f3b7-128">Se a marca de entidade não está presente no cabeçalho HTTP If-Match, em seguida, um <xref:System.ServiceModel.Web.WebFaultException> com um status de código de falha de pré-condição (412) é gerado.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-128">If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown.</span></span> <span data-ttu-id="1f3b7-129">O mecanismo de atualização condicional permite que o cliente para informar ao servidor que tem essa entidade para o recurso e para permitir que somente o cliente alterar o recurso. Se a entidade tiver é atual.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-129">The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.</span></span> <span data-ttu-id="1f3b7-130">Exemplo de uso do <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> método pode ser visto no `UpdateCustomer` e `DeleteCustomer` operações do serviço.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-130">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service.</span></span> <span data-ttu-id="1f3b7-131">Assim como ocorre com <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, é importante observar que chama a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> não pode retornar.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-131">Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return.</span></span> <span data-ttu-id="1f3b7-132">Os desenvolvedores devem implementar a operação, de modo que a solicitação já é conhecida por ser bem-sucedida antes da chamada para <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> é executada, como se a chamada para <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> não estava presente, o serviço deve responder com um código de status bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-132">Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.</span></span>  
  
 <span data-ttu-id="1f3b7-133">O exemplo consiste em um serviço auto-hospedado e um cliente que é executado dentro de um aplicativo de console.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-133">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="1f3b7-134">Como o aplicativo de console é executado, o cliente faz solicitações para o serviço e grava as informações pertinentes entre as respostas para a janela do console.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-134">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="1f3b7-135">Para executar a amostra</span><span class="sxs-lookup"><span data-stu-id="1f3b7-135">To run the sample</span></span>  
  
1.  <span data-ttu-id="1f3b7-136">Abra a solução para o exemplo condicional Get e Put.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-136">Open the solution for the Conditional Get and Put sample.</span></span> <span data-ttu-id="1f3b7-137">Ao iniciar [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], você deve executar como administrador para executar o exemplo com êxito.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-137">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully.</span></span> <span data-ttu-id="1f3b7-138">Fazer isso clicando com o [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] ícone e escolhendo **executar como administrador** no menu de contexto.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-138">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="1f3b7-139">Pressione CTRL + SHIFT + B para compilar a solução e, em seguida, pressione CTRL + F5 para executar o projeto de aplicativo de console.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-139">Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.</span></span> <span data-ttu-id="1f3b7-140">Se este projeto com depuração habilitada (pressionando F5, em vez de CTRL + F5), o depurador será interrompido quando uma exceção é lançada pela condicional obter e colocar a verificação.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-140">If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.</span></span> <span data-ttu-id="1f3b7-141">Quando isso acontece, pressione F5 para continuar a executar o exemplo.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-141">When this happens, press F5 to continue executing the sample.</span></span>  
  
3.  <span data-ttu-id="1f3b7-142">A janela do console aparecem areia fornece o URI do serviço em execução e o URI da página de ajuda HTML para o serviço em execução.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-142">The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
4.  <span data-ttu-id="1f3b7-143">Como o exemplo é executado, o cliente envia solicitações ao serviço e grava as respostas para a janela do console.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-143">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span>  
  
5.  <span data-ttu-id="1f3b7-144">Pressione qualquer tecla para encerrar o exemplo.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-144">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="1f3b7-145">Os exemplos podem já estar instalados no seu computador.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-145">The samples may already be installed on your machine.</span></span> <span data-ttu-id="1f3b7-146">Verifique o seguinte diretório (padrão) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-146">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="1f3b7-147">Se este diretório não existir, vá para [Windows Communication Foundation (WCF) e exemplos do Windows Workflow Foundation (WF) para o .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) para baixar todos os Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemplos.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-147">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="1f3b7-148">Este exemplo está localizado no seguinte diretório.</span><span class="sxs-lookup"><span data-stu-id="1f3b7-148">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\ConditionalGetAndPut`
