---
title: Contadores de desempenho e aplicativos lado a lado em processo
description: Examine os contadores de desempenho e os aplicativos lado a lado no processo no .NET. Use Perfmon.exe para diferenciar os contadores de desempenho em cada tempo de execução.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- performance counters
- performance counters,and in-process side-by-side applications
- performance,.NET Framework applications
- performance monitoring,counters
ms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436
ms.openlocfilehash: eb05d9f5f930420827c6b3d94ea0ed34f64464fd
ms.sourcegitcommit: c23d9666ec75b91741da43ee3d91c317d68c7327
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85803853"
---
# <a name="performance-counters-and-in-process-side-by-side-applications"></a><span data-ttu-id="cc289-104">Contadores de desempenho e aplicativos lado a lado em processo</span><span class="sxs-lookup"><span data-stu-id="cc289-104">Performance Counters and In-Process Side-By-Side Applications</span></span>
<span data-ttu-id="cc289-105">Usando o Monitor de Desempenho (Perfmon.exe), é possível diferenciar os contadores de desempenho por runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-105">Using the Performance Monitor (Perfmon.exe), it is possible to differentiate the performance counters on a per-runtime basis.</span></span> <span data-ttu-id="cc289-106">Este tópico descreve a alteração do Registro necessária para habilitar essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="cc289-106">This topic describes the registry change needed to enable this functionality.</span></span>  
  
## <a name="the-default-behavior"></a><span data-ttu-id="cc289-107">O comportamento padrão</span><span class="sxs-lookup"><span data-stu-id="cc289-107">The Default Behavior</span></span>  
 <span data-ttu-id="cc289-108">Por padrão, o Monitor de Desempenho exibe os contadores de desempenho classificados por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cc289-108">By default, the Performance Monitor displays performance counters on a per-application basis.</span></span> <span data-ttu-id="cc289-109">No entanto, há dois cenários em que isso torna-se um problema:</span><span class="sxs-lookup"><span data-stu-id="cc289-109">However, there are two scenarios in which this is problematic:</span></span>  
  
- <span data-ttu-id="cc289-110">Ao monitorar dois aplicativos que têm o mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="cc289-110">When you monitor two applications that have the same name.</span></span> <span data-ttu-id="cc289-111">Por exemplo, se ambos os aplicativos são nomeados myapp.exe, um é exibido como **myapp** e o outro como **myapp#1** na coluna **Instância**.</span><span class="sxs-lookup"><span data-stu-id="cc289-111">For example, if both applications are named myapp.exe, one will be displayed as **myapp** and the other as **myapp#1** in the **Instance** column.</span></span> <span data-ttu-id="cc289-112">Nesse caso, é difícil corresponder um contador de desempenho a um aplicativo específico.</span><span class="sxs-lookup"><span data-stu-id="cc289-112">In this case, it is difficult to match a performance counter to a particular application.</span></span> <span data-ttu-id="cc289-113">Não está claro se os dados coletados para **myapp#1** referem-se ao primeiro myapp.exe ou ao segundo.</span><span class="sxs-lookup"><span data-stu-id="cc289-113">It is not clear whether the data collected for **myapp#1** refers to the first myapp.exe or the second myapp.exe.</span></span>  
  
- <span data-ttu-id="cc289-114">Quando um aplicativo usa várias instâncias do Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-114">When an application uses multiple instances of the common language runtime.</span></span> <span data-ttu-id="cc289-115">O .NET Framework 4 dá suporte a cenários de hospedagem lado a lado no processo; ou seja, um único processo ou aplicativo pode carregar várias instâncias do Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-115">The .NET Framework 4 supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime.</span></span> <span data-ttu-id="cc289-116">Se um único aplicativo chamado myapp.exe carrega duas instâncias de runtime, por padrão, elas serão designadas na coluna **Instância** como **myapp** e **myapp#1**.</span><span class="sxs-lookup"><span data-stu-id="cc289-116">If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the **Instance** column as **myapp** and **myapp#1**.</span></span> <span data-ttu-id="cc289-117">Nesse caso, não está claro se **myapp** e **myapp#1** referem-se a dois aplicativos de mesmo nome ou ao mesmo aplicativo com dois runtimes.</span><span class="sxs-lookup"><span data-stu-id="cc289-117">In this case, it is not clear whether **myapp** and **myapp#1** refer to two applications with the same name, or to the same application with two runtimes.</span></span> <span data-ttu-id="cc289-118">Se vários aplicativos com o mesmo nome carregam vários runtimes, a ambiguidade é ainda maior.</span><span class="sxs-lookup"><span data-stu-id="cc289-118">If multiple applications with the same name load multiple runtimes, the ambiguity is even greater.</span></span>  
  
 <span data-ttu-id="cc289-119">Você pode definir uma chave do Registro para eliminar essa ambiguidade.</span><span class="sxs-lookup"><span data-stu-id="cc289-119">You can set a registry key to eliminate this ambiguity.</span></span> <span data-ttu-id="cc289-120">Para aplicativos desenvolvidos usando o .NET Framework 4, essa alteração de registro adiciona um identificador de processo seguido por um identificador de instância de tempo de execução para o nome do aplicativo na coluna **instância** .</span><span class="sxs-lookup"><span data-stu-id="cc289-120">For applications developed using the .NET Framework 4, this registry change adds a process identifier followed by a runtime instance identifier to the application name in the **Instance** column.</span></span> <span data-ttu-id="cc289-121">Em vez *de #1 de aplicativo ou* *aplicativo*, o aplicativo agora é identificado como *Application*_ `p` *ID* \_ `r` *runtimeId* na coluna de **instância** .</span><span class="sxs-lookup"><span data-stu-id="cc289-121">Instead of *application* or *application*#1, the application is now identified as *application*_`p`*processID*\_`r`*runtimeID* in the **Instance** column.</span></span> <span data-ttu-id="cc289-122">Se um aplicativo tiver sido desenvolvido usando uma versão anterior do Common Language Runtime, essa instância será representada como ProcessId do \* \_ aplicativo\*, `p` *processID* desde que o .NET Framework 4 esteja instalado.</span><span class="sxs-lookup"><span data-stu-id="cc289-122">If an application was developed using a previous version of the common language runtime, that instance is represented as *application\_*`p`*processID* provided that the .NET Framework 4 is installed.</span></span>  
  
## <a name="performance-counters-for-in-process-side-by-side-applications"></a><span data-ttu-id="cc289-123">Contadores de desempenho para aplicativos lado a lado em processo</span><span class="sxs-lookup"><span data-stu-id="cc289-123">Performance Counters for In-Process Side-by-Side Applications</span></span>  
 <span data-ttu-id="cc289-124">Para lidar com contadores de desempenho para várias versões do Common Language Runtime hospedadas em um único aplicativo, você deve alterar uma única configuração de chave do Registro, conforme mostrado na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="cc289-124">To handle performance counters for multiple common language runtime versions that are hosted in a single application, you must change a single registry key setting, as shown in the following table.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="cc289-125">Nome da chave</span><span class="sxs-lookup"><span data-stu-id="cc289-125">Key name</span></span>|<span data-ttu-id="cc289-126">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span><span class="sxs-lookup"><span data-stu-id="cc289-126">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span></span>|  
|<span data-ttu-id="cc289-127">Nome do valor</span><span class="sxs-lookup"><span data-stu-id="cc289-127">Value name</span></span>|<span data-ttu-id="cc289-128">ProcessNameFormat</span><span class="sxs-lookup"><span data-stu-id="cc289-128">ProcessNameFormat</span></span>|  
|<span data-ttu-id="cc289-129">Tipo de valor</span><span class="sxs-lookup"><span data-stu-id="cc289-129">Value type</span></span>|<span data-ttu-id="cc289-130">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="cc289-130">REG_DWORD</span></span>|  
|<span data-ttu-id="cc289-131">Valor</span><span class="sxs-lookup"><span data-stu-id="cc289-131">Value</span></span>|<span data-ttu-id="cc289-132">1 (0x00000001)</span><span class="sxs-lookup"><span data-stu-id="cc289-132">1 (0x00000001)</span></span>|  
  
 <span data-ttu-id="cc289-133">Um valor de 0 para `ProcessNameFormat` indica que o comportamento padrão está habilitado, ou seja, Perfmon.exe exibe os contadores de desempenho por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cc289-133">A value of 0 for `ProcessNameFormat` indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis.</span></span> <span data-ttu-id="cc289-134">Quando você define esse valor como 1, Perfmon.exe elimina a ambiguidade de várias versões de um aplicativo e fornece contadores de desempenho por runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-134">When you set this value to 1, Perfmon.exe disambiguates multiple versions of an application and provides performance counters on a per-runtime basis.</span></span> <span data-ttu-id="cc289-135">Qualquer outro valor para a configuração da chave do Registro `ProcessNameFormat` não tem suporte e é reservada para uso futuro.</span><span class="sxs-lookup"><span data-stu-id="cc289-135">Any other value for the `ProcessNameFormat` registry key setting is unsupported and reserved for future use.</span></span>  
  
 <span data-ttu-id="cc289-136">Depois de atualizar a configuração da chave do Registro `ProcessNameFormat`, você deve reiniciar Perfmon.exe ou outros consumidores de contadores de desempenho para que o novo recurso de nomeação de instância funcione corretamente.</span><span class="sxs-lookup"><span data-stu-id="cc289-136">After you update the `ProcessNameFormat` registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly.</span></span>  
  
 <span data-ttu-id="cc289-137">O exemplo a seguir mostra como alterar o valor de `ProcessNameFormat` programaticamente.</span><span class="sxs-lookup"><span data-stu-id="cc289-137">The following example shows how to change the `ProcessNameFormat` value programmatically.</span></span>  
  
 [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)]
 [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  
  
 <span data-ttu-id="cc289-138">Quando você fizer essa alteração no registro, Perfmon.exe exibirá os nomes dos aplicativos que visam o .NET Framework 4 como *Application*_ `p` *ID* \_ `r` *runtimeId*, em que *Application* é o nome do aplicativo, *ProcessId* é o identificador de processo do aplicativo e *runtimeId* é um identificador de Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-138">When you make this registry change, Perfmon.exe displays the names of applications that target the .NET Framework 4 as *application*_`p`*processID*\_`r`*runtimeID*, where *application* is the name of the application, *processID* is the application's process identifier, and *runtimeID* is a common language runtime identifier.</span></span> <span data-ttu-id="cc289-139">Por exemplo, se um aplicativo chamado myapp.exe carrega duas instâncias nomeadas do Common Language Runtime, Perfmon.exe pode identificar uma instância como myapp_p1416_r10 e a segunda como myapp_p3160_r10.</span><span class="sxs-lookup"><span data-stu-id="cc289-139">For example, if an application named myapp.exe loads two instances of the common language runtime, Perfmon.exe may identify one instance as myapp_p1416_r10 and the second as myapp_p3160_r10.</span></span> <span data-ttu-id="cc289-140">O identificador de runtime apenas retira a ambiguidade os runtimes dentro de um processo; ele não fornece nenhuma outra informação sobre o runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-140">The runtime identifier only disambiguates the runtimes within a process; it does not provide any other information about the runtime.</span></span> <span data-ttu-id="cc289-141">(Por exemplo, a ID de runtime não tem nenhuma relação com a versão ou o SKU do runtime.)</span><span class="sxs-lookup"><span data-stu-id="cc289-141">(For example, the runtime ID has no relation to the version or the SKU of the runtime.)</span></span>  
  
 <span data-ttu-id="cc289-142">Se o .NET Framework 4 estiver instalado, a alteração do registro também afetará os aplicativos que foram desenvolvidos usando versões anteriores do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cc289-142">If the .NET Framework 4 is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework.</span></span> <span data-ttu-id="cc289-143">Eles aparecem em Perfmon.exe como *application_* `p` *ProcessId*, em que *Application* é o nome do aplicativo e *ProcessId* é o identificador do processo.</span><span class="sxs-lookup"><span data-stu-id="cc289-143">These appear in Perfmon.exe as *application_*`p`*processID*, where *application* is the application name and *processID* is the process identifier.</span></span> <span data-ttu-id="cc289-144">Por exemplo, se os contadores de desempenho de dois aplicativos chamados myapp.exe são monitorados, um pode aparecer como myapp_p23900 e o outro como myapp_p24908.</span><span class="sxs-lookup"><span data-stu-id="cc289-144">For example, if the performance counters of two applications named myapp.exe are monitored, one might appear as myapp_p23900 and the other as myapp_p24908.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cc289-145">O identificador de processo elimina a ambiguidade da resolução de dois aplicativos com o mesmo nome que usam versões anteriores do runtime.</span><span class="sxs-lookup"><span data-stu-id="cc289-145">The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime.</span></span> <span data-ttu-id="cc289-146">Um identificador de tempo de execução não é necessário para versões anteriores, porque versões anteriores do Common Language Runtime não dão suporte a cenários lado a lado.</span><span class="sxs-lookup"><span data-stu-id="cc289-146">A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.</span></span>  
  
 <span data-ttu-id="cc289-147">Se o .NET Framework 4 não estiver presente ou tiver sido desinstalado, a definição da chave do registro não terá nenhum efeito.</span><span class="sxs-lookup"><span data-stu-id="cc289-147">If the .NET Framework 4 is not present or was uninstalled, setting the registry key has no effect.</span></span> <span data-ttu-id="cc289-148">Isso significa que dois aplicativos com o mesmo nome continuarão a aparecer no Perfmon.exe como *aplicativo* e *aplicativo#1* (por exemplo, como **myapp** e **myapp#1**).</span><span class="sxs-lookup"><span data-stu-id="cc289-148">This means that two applications with the same name will continue to appear in Perfmon.exe as *application* and *application#1* (for example, as **myapp** and **myapp#1**).</span></span>
