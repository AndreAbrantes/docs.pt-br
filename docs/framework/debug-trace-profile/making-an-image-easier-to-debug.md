---
title: Facilitando a depuração no .NET de uma imagem
description: Saiba como configurar uma imagem executável para depuração mais fácil usando o IDE muda e opções de linha de comando.
ms.date: 08/30/2018
helpviewer_keywords:
- images [.NET Framework], debugging
- executable image for debugging
- debugging [.NET Framework], executable images for
ms.assetid: 7d90ea7a-150f-4f97-98a7-f9c26541b9a3
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 5bab707afb059d4fcbd46a9ee54edead991be523
ms.sourcegitcommit: 0c48191d6d641ce88d7510e319cf38c0e35697d0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/05/2019
ms.locfileid: "57362001"
---
# <a name="making-an-image-easier-to-debug-in-net"></a><span data-ttu-id="ff3f1-103">Facilitando a depuração no .NET de uma imagem</span><span class="sxs-lookup"><span data-stu-id="ff3f1-103">Making an image easier to debug in .NET</span></span>

<span data-ttu-id="ff3f1-104">Ao compilar código não gerenciado, você pode configurar uma imagem executável para depuração, definindo opções de IDE ou opções de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-104">When compiling unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="ff3f1-105">Por exemplo, você pode usar a opção de linha de comando /**Zi** no Visual C++ para solicitar a ele que emita arquivos de símbolo de depuração (extensão de arquivo .pdb).</span><span class="sxs-lookup"><span data-stu-id="ff3f1-105">For example, you can use the /**Zi** command-line option in Visual C++ to ask it to emit debug symbol files (file extension .pdb).</span></span> <span data-ttu-id="ff3f1-106">De modo similar, a opção de linha de comando /**Od** informa ao compilador para desabilitar a otimização.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-106">Similarly, the /**Od** command-line option tells the compiler to disable optimization.</span></span> <span data-ttu-id="ff3f1-107">O código resultante é executado mais lentamente, mas é mais fácil de depurar, se isso for necessário.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-107">The resulting code runs more slowly, but it's easier to debug, should this be necessary.</span></span>

<span data-ttu-id="ff3f1-108">Quando a compilação do .NET Framework, código gerenciado, compiladores como Visual C++, Visual Basic e c# compilar seu programa de origem em Microsoft intermediate language (MSIL).</span><span class="sxs-lookup"><span data-stu-id="ff3f1-108">When compiling .NET Framework managed code, compilers such as Visual C++, Visual Basic, and C# compile their source program into Microsoft intermediate language (MSIL).</span></span> <span data-ttu-id="ff3f1-109">MSIL, em seguida, é compilado em JIT, logo antes da execução, código de máquina nativo.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-109">MSIL is then JIT-compiled, just before execution, into native machine code.</span></span> <span data-ttu-id="ff3f1-110">Assim como ocorre com código não gerenciado, você pode configurar uma imagem executável para depuração, definindo opções de IDE ou opções de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-110">As with unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="ff3f1-111">Você também pode configurar a compilação JIT para depuração da mesma forma.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-111">You can also configure the JIT compilation for debugging in much the same way.</span></span>

<span data-ttu-id="ff3f1-112">Essa configuração de JIT tem dois aspectos:</span><span class="sxs-lookup"><span data-stu-id="ff3f1-112">This JIT configuration has two aspects:</span></span>

- <span data-ttu-id="ff3f1-113">Você pode solicitar que o compilador JIT para gerar informações de acompanhamento.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-113">You can request the JIT compiler to generate tracking information.</span></span> <span data-ttu-id="ff3f1-114">Isso possibilita que o depurador faça a correspondência entre uma cadeia de MSIL com seu equivalente em código de máquina e que controle o local em que os argumentos de função e variáveis locais são armazenados.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-114">This makes it possible for the debugger to match up a chain of MSIL with its machine code counterpart, and to track where local variables and function arguments are stored.</span></span> <span data-ttu-id="ff3f1-115">Começando com o .NET Framework versão 2.0, o compilador JIT sempre gera informações de acompanhamento, portanto, não há nenhuma necessidade de solicitar a ele.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-115">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information, so there is no need to request it.</span></span>

- <span data-ttu-id="ff3f1-116">Você pode solicitar que o compilador JIT não Otimize o código de máquina resultante.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-116">You can request the JIT compiler to not optimize the resulting machine code.</span></span>

<span data-ttu-id="ff3f1-117">Normalmente, o compilador que gera o MSIL define essas opções do compilador JIT adequadamente, com base nas opções IDE ou opções de linha de comando que você especificar, por exemplo, /**Od**.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-117">Normally, the compiler that generates the MSIL sets these JIT compiler options appropriately, based upon the IDE switches or command-line options you specify, for example, /**Od**.</span></span>

<span data-ttu-id="ff3f1-118">Em alguns casos, talvez você queira alterar o comportamento do compilador JIT para que o código de máquina gerado por ele seja mais fácil de depurar.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-118">In some cases, you might want to change the behavior of the JIT compiler so that the machine code it generates is easier to debug.</span></span> <span data-ttu-id="ff3f1-119">Por exemplo, talvez você queira gerar informações de acompanhamento JIT de um build de varejo ou controlar a otimização.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-119">For example, you might want to generate JIT tracking information for a retail build or control optimization.</span></span> <span data-ttu-id="ff3f1-120">Você pode fazer isso com um arquivo de inicialização (.ini).</span><span class="sxs-lookup"><span data-stu-id="ff3f1-120">You can do so with an initialization (.ini) file.</span></span>

<span data-ttu-id="ff3f1-121">Por exemplo, se o assembly que você deseja depurar é chamado *MyApp.exe*, em seguida, você pode criar um arquivo de texto chamado *MyApp*, na mesma pasta do *MyApp.exe*, que contém Estas três linhas:</span><span class="sxs-lookup"><span data-stu-id="ff3f1-121">For example, if the assembly you want to debug is called *MyApp.exe*, then you can create a text file named *MyApp.ini*, in the same folder as *MyApp.exe*, which contains these three lines:</span></span>

```ini
[.NET Framework Debugging Control]
GenerateTrackingInfo=1
AllowOptimize=0
```

<span data-ttu-id="ff3f1-122">Você pode definir o valor de cada opção como 0 ou 1 e qualquer opção ausente assume 0 por padrão.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-122">You can set the value of each option to 0 or 1, and any absent option defaults to 0.</span></span> <span data-ttu-id="ff3f1-123">Configurar `GenerateTrackingInfo` como 1 e `AllowOptimize` como 0 proporciona a depuração mais fácil.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-123">Setting `GenerateTrackingInfo` to 1 and `AllowOptimize` to 0 provides the easiest debugging.</span></span>

<span data-ttu-id="ff3f1-124">Começando com o .NET Framework versão 2.0, o compilador JIT sempre gera informações de acompanhamento, independentemente do valor de `GenerateTrackingInfo`; no entanto, o `AllowOptimize` valor ainda tem um efeito.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-124">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information regardless of the value for `GenerateTrackingInfo`; however, the `AllowOptimize` value still has an effect.</span></span> <span data-ttu-id="ff3f1-125">Ao usar o [Ngen.exe (Gerador de Imagens Nativas)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) para pré-compilar a imagem nativa sem otimização, o arquivo .ini deve estar presente na pasta de destino com `AllowOptimize=0` quando Ngen.exe for executado.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-125">When using the [Ngen.exe (Native Image Generator)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) to precompile the native image without optimization, the .ini file must be present in the target folder with `AllowOptimize=0` when Ngen.exe executes.</span></span> <span data-ttu-id="ff3f1-126">Se você tiver pré-compilado um assembly sem otimização, você deve remover o código pré-compilado usando NGen.exe **/uninstall** opção antes de executar novamente o Ngen.exe para pré-compilar o código como otimizado.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-126">If you have precompiled an assembly without optimization, you must remove the precompiled code using NGen.exe **/uninstall** option before rerunning Ngen.exe to precompile the code as optimized.</span></span> <span data-ttu-id="ff3f1-127">Se o arquivo. ini não estiver presente na pasta, por padrão Ngen.exe pré-compilará o código como otimizado.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-127">If the .ini file isn't present in the folder, by default Ngen.exe precompiles the code as optimized.</span></span>

<span data-ttu-id="ff3f1-128">O <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controla as configurações de um assembly.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-128">The <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controls the settings for an assembly.</span></span> <span data-ttu-id="ff3f1-129">**DebuggableAttribute** inclui dois campos que controlam se o compilador JIT deve otimizar e/ou gerar informações de acompanhamento.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-129">**DebuggableAttribute** includes two fields that control whether the JIT compiler should optimize and/or generate tracking information.</span></span> <span data-ttu-id="ff3f1-130">Começando com o .NET Framework versão 2.0, o compilador JIT sempre gera informações de acompanhamento.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-130">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information.</span></span>

<span data-ttu-id="ff3f1-131">Para um build de varejo, os compiladores não definir qualquer **DebuggableAttribute**.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-131">For a retail build, compilers don't set any **DebuggableAttribute**.</span></span> <span data-ttu-id="ff3f1-132">Por padrão, o compilador JIT gera o melhor desempenho, mais difícil de depurar o código de máquina.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-132">By default, the JIT compiler generates the highest performance, hardest to debug machine code.</span></span> <span data-ttu-id="ff3f1-133">Habilitar o acompanhamento JIT reduz um pouco o desempenho, enquanto desabilitar a otimização reduz muito o desempenho.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-133">Enabling JIT tracking lowers performance a little, and disabling optimization lowers performance a lot.</span></span>

<span data-ttu-id="ff3f1-134">O **DebuggableAttribute** aplica-se a um assembly inteiro por vez e não a módulos individuais dentro do assembly.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-134">The **DebuggableAttribute** applies to a whole assembly at a time, not to individual modules within the assembly.</span></span> <span data-ttu-id="ff3f1-135">Ferramentas de desenvolvimento, portanto, deverão anexar atributos personalizados ao token de metadados de assembly se um assembly já tiver sido criado ou então anexá-los à classe chamada **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-135">Development tools must therefore attach custom attributes to the assembly metadata token, if an assembly has already been created, or to the class called **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span></span> <span data-ttu-id="ff3f1-136">A ferramenta ALink promoverá esses **DebuggableAttribute** atributos de cada módulo ao assembly que eles se tornam parte do.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-136">The ALink tool then promotes these **DebuggableAttribute** attributes from each module to the assembly they become a part of.</span></span> <span data-ttu-id="ff3f1-137">Se houver um conflito, a operação ALink falhará.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-137">If there's a conflict, the ALink operation fails.</span></span>

> [!NOTE]
> <span data-ttu-id="ff3f1-138">Na versão 1.0 do .NET Framework, o compilador do Microsoft Visual C++ adiciona o **DebuggableAttribute** quando as opções do compilador **/clr** e **/Zi** são especificadas.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-138">In version 1.0 of the .NET Framework, the Microsoft Visual C++ compiler adds the **DebuggableAttribute** when the **/clr** and **/Zi** compiler options are specified.</span></span> <span data-ttu-id="ff3f1-139">Na versão 1.1 do .NET Framework, você deverá adicionar o **DebuggableAttribute** manualmente no seu código ou usar o **/ASSEMBLYDEBUG** a opção de vinculador.</span><span class="sxs-lookup"><span data-stu-id="ff3f1-139">In version 1.1 of the .NET Framework, you must either add the **DebuggableAttribute** manually in your code or use the **/ASSEMBLYDEBUG** linker option.</span></span>

## <a name="see-also"></a><span data-ttu-id="ff3f1-140">Consulte também</span><span class="sxs-lookup"><span data-stu-id="ff3f1-140">See also</span></span>

- [<span data-ttu-id="ff3f1-141">Depuração, rastreamento e criação de perfil</span><span class="sxs-lookup"><span data-stu-id="ff3f1-141">Debugging, Tracing, and Profiling</span></span>](../../../docs/framework/debug-trace-profile/index.md)
- [<span data-ttu-id="ff3f1-142">Habilitando a depuração por anexação JIT</span><span class="sxs-lookup"><span data-stu-id="ff3f1-142">Enabling JIT-Attach Debugging</span></span>](../../../docs/framework/debug-trace-profile/enabling-jit-attach-debugging.md)
- <span data-ttu-id="ff3f1-143">[Habilitando a criação de perfil](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="ff3f1-143">[Enabling Profiling](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span></span>
