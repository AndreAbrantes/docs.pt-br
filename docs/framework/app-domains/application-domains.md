---
title: Domínios de aplicativo
ms.date: 03/30/2017
helpviewer_keywords:
- process boundaries for isolation
- application isolation
- application domains, about
- common language runtime, application domains
- application domains
- runtime, application domains
- isolation between applications
- code, verification process
- verification testing code
ms.assetid: 113a8bbf-6875-4a72-a49d-ca2d92e19cc8
ms.openlocfilehash: a5c9f4248e060d231941269f39cadbc7147ce27f
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/30/2019
ms.locfileid: "73119978"
---
# <a name="application-domains"></a><span data-ttu-id="adc7a-102">Domínios de aplicativo</span><span class="sxs-lookup"><span data-stu-id="adc7a-102">Application domains</span></span>

<span data-ttu-id="adc7a-103">Sistemas operacionais e ambientes em runtime normalmente fornecem alguma forma de isolamento entre aplicativos.</span><span class="sxs-lookup"><span data-stu-id="adc7a-103">Operating systems and runtime environments typically provide some form of isolation between applications.</span></span> <span data-ttu-id="adc7a-104">Por exemplo, o Windows usa processos para isolar aplicativos.</span><span class="sxs-lookup"><span data-stu-id="adc7a-104">For example, Windows uses processes to isolate applications.</span></span> <span data-ttu-id="adc7a-105">Esse isolamento é necessário para garantir que o código em execução em um aplicativo não possa afetar outros aplicativos não relacionados.</span><span class="sxs-lookup"><span data-stu-id="adc7a-105">This isolation is necessary to ensure that code running in one application cannot adversely affect other, unrelated applications.</span></span>  
  
 <span data-ttu-id="adc7a-106">Domínios de aplicativos oferecem um limite de isolamento para segurança, confiabilidade e controle de versão, além de descarregar assemblies.</span><span class="sxs-lookup"><span data-stu-id="adc7a-106">Application domains provide an isolation boundary for security, reliability, and versioning, and for unloading assemblies.</span></span> <span data-ttu-id="adc7a-107">Domínios de aplicativos normalmente são criados por hosts de tempo de execução, que são responsáveis pela inicialização do Common Language Runtime antes de um aplicativo ser executado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-107">Application domains are typically created by runtime hosts, which are responsible for bootstrapping the common language runtime before an application is run.</span></span>  
  
## <a name="the-benefits-of-isolating-applications"></a><span data-ttu-id="adc7a-108">Os benefícios do isolamento de aplicativos</span><span class="sxs-lookup"><span data-stu-id="adc7a-108">The benefits of isolating applications</span></span>

 <span data-ttu-id="adc7a-109">Historicamente, os limites de processo têm sido usados para isolar aplicativos em execução no mesmo computador.</span><span class="sxs-lookup"><span data-stu-id="adc7a-109">Historically, process boundaries have been used to isolate applications running on the same computer.</span></span> <span data-ttu-id="adc7a-110">Cada aplicativo é carregado em um processo separado, que isola o aplicativo de outros aplicativos em execução no mesmo computador.</span><span class="sxs-lookup"><span data-stu-id="adc7a-110">Each application is loaded into a separate process, which isolates the application from other applications running on the same computer.</span></span>  
  
 <span data-ttu-id="adc7a-111">Os aplicativos são isolados porque endereços de memória são relativos a processos; um ponteiro de memória passado de um processo para outro não pode ser usado de maneira significativa no processo de destino.</span><span class="sxs-lookup"><span data-stu-id="adc7a-111">The applications are isolated because memory addresses are process-relative; a memory pointer passed from one process to another cannot be used in any meaningful way in the target process.</span></span> <span data-ttu-id="adc7a-112">Além disso, você não pode fazer chamadas diretas entre dois processos.</span><span class="sxs-lookup"><span data-stu-id="adc7a-112">In addition, you cannot make direct calls between two processes.</span></span> <span data-ttu-id="adc7a-113">Em vez disso, você deve usar proxies, que fornecem um nível de indireção.</span><span class="sxs-lookup"><span data-stu-id="adc7a-113">Instead, you must use proxies, which provide a level of indirection.</span></span>  
  
 <span data-ttu-id="adc7a-114">O código gerenciado deve ser passado por meio de um processo de verificação antes de ser executado (a menos que o administrador tenha concedido permissão para ignorar a verificação).</span><span class="sxs-lookup"><span data-stu-id="adc7a-114">Managed code must be passed through a verification process before it can be run (unless the administrator has granted permission to skip the verification).</span></span> <span data-ttu-id="adc7a-115">O processo de verificação determina se o código pode tentar acessar endereços de memória inválidos ou realizar alguma outra ação que possa causar falha no processo no qual ele está sendo executado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-115">The verification process determines whether the code can attempt to access invalid memory addresses or perform some other action that could cause the process in which it is running to fail to operate properly.</span></span> <span data-ttu-id="adc7a-116">Diz-se que o código que passa pelo teste de verificação é chamado de fortemente tipado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-116">Code that passes the verification test is said to be type-safe.</span></span> <span data-ttu-id="adc7a-117">A capacidade de verificar o código como fortemente tipado permite que o Common Language Runtime forneça um ótimo nível de isolamento como o limite de processo, a um custo de desempenho muito menor.</span><span class="sxs-lookup"><span data-stu-id="adc7a-117">The ability to verify code as type-safe enables the common language runtime to provide as great a level of isolation as the process boundary, at a much lower performance cost.</span></span>  
  
 <span data-ttu-id="adc7a-118">Domínios de aplicativo oferecem uma unidade mais segura e versátil de processamento que o Common Language Runtime pode usar para fornecer isolamento entre aplicativos.</span><span class="sxs-lookup"><span data-stu-id="adc7a-118">Application domains provide a more secure and versatile unit of processing that the common language runtime can use to provide isolation between applications.</span></span> <span data-ttu-id="adc7a-119">Você pode executar vários domínios de aplicativo em um único processo com o mesmo nível de isolamento que existiria em processos separados, mas sem incorrer na sobrecarga adicional ao fazer chamadas cruzadas ou alternar processos.</span><span class="sxs-lookup"><span data-stu-id="adc7a-119">You can run several application domains in a single process with the same level of isolation that would exist in separate processes, but without incurring the additional overhead of making cross-process calls or switching between processes.</span></span> <span data-ttu-id="adc7a-120">A capacidade de executar vários aplicativos em um único processo aumenta muito a escalabilidade do servidor.</span><span class="sxs-lookup"><span data-stu-id="adc7a-120">The ability to run multiple applications within a single process dramatically increases server scalability.</span></span>  
  
 <span data-ttu-id="adc7a-121">Isolar aplicativos também é importante para a segurança do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-121">Isolating applications is also important for application security.</span></span> <span data-ttu-id="adc7a-122">Por exemplo, você pode executar controles de vários aplicativos Web em um único processo de navegador de tal forma que os controles não possam acessar dados e recursos uns dos outros.</span><span class="sxs-lookup"><span data-stu-id="adc7a-122">For example, you can run controls from several Web applications in a single browser process in such a way that the controls cannot access each other's data and resources.</span></span>  
  
 <span data-ttu-id="adc7a-123">O isolamento fornecido pelos domínios de aplicativo possui os seguintes benefícios:</span><span class="sxs-lookup"><span data-stu-id="adc7a-123">The isolation provided by application domains has the following benefits:</span></span>  
  
- <span data-ttu-id="adc7a-124">Falhas em um aplicativo não podem afetar outros aplicativos.</span><span class="sxs-lookup"><span data-stu-id="adc7a-124">Faults in one application cannot affect other applications.</span></span> <span data-ttu-id="adc7a-125">Como um código fortemente tipado não pode causar falhas de memória, usar domínios de aplicativo garante que o código em execução em um domínio não possa afetar outros aplicativos no processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-125">Because type-safe code cannot cause memory faults, using application domains ensures that code running in one domain cannot affect other applications in the process.</span></span>  
  
- <span data-ttu-id="adc7a-126">Aplicativos individuais podem ser interrompidos sem interromper o processo inteiro.</span><span class="sxs-lookup"><span data-stu-id="adc7a-126">Individual applications can be stopped without stopping the entire process.</span></span> <span data-ttu-id="adc7a-127">Usar domínios de aplicativo permite que você descarregue o código em execução em um único aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-127">Using application domains enables you to unload the code running in a single application.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="adc7a-128">Você não pode descarregar assemblies ou tipos individuais.</span><span class="sxs-lookup"><span data-stu-id="adc7a-128">You cannot unload individual assemblies or types.</span></span> <span data-ttu-id="adc7a-129">Apenas um domínio completo pode ser descarregado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-129">Only a complete domain can be unloaded.</span></span>  
  
- <span data-ttu-id="adc7a-130">O código em execução em um aplicativo não pode diretamente acessar o código ou os recursos de outro aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-130">Code running in one application cannot directly access code or resources from another application.</span></span> <span data-ttu-id="adc7a-131">O Common Language Runtime impõe esse isolamento, impedindo chamadas diretas entre objetos em domínios de aplicativo diferentes.</span><span class="sxs-lookup"><span data-stu-id="adc7a-131">The common language runtime enforces this isolation by preventing direct calls between objects in different application domains.</span></span> <span data-ttu-id="adc7a-132">Objetos que passam entre domínios são copiados ou acessados pelo proxy.</span><span class="sxs-lookup"><span data-stu-id="adc7a-132">Objects that pass between domains are either copied or accessed by proxy.</span></span> <span data-ttu-id="adc7a-133">Se o objeto for copiado, a chamada para o objeto será local.</span><span class="sxs-lookup"><span data-stu-id="adc7a-133">If the object is copied, the call to the object is local.</span></span> <span data-ttu-id="adc7a-134">Ou seja, tanto o chamador quanto o objeto referenciado estão no mesmo domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-134">That is, both the caller and the object being referenced are in the same application domain.</span></span> <span data-ttu-id="adc7a-135">Se o objeto for acessado por meio de um proxy, a chamada para o objeto será remota.</span><span class="sxs-lookup"><span data-stu-id="adc7a-135">If the object is accessed through a proxy, the call to the object is remote.</span></span> <span data-ttu-id="adc7a-136">Nesse caso, o chamador e o objeto referenciado estão em domínios diferentes.</span><span class="sxs-lookup"><span data-stu-id="adc7a-136">In this case, the caller and the object being referenced are in different application domains.</span></span> <span data-ttu-id="adc7a-137">Chamadas entre domínios usam a mesma infraestrutura de chamada remota entre dois processos ou entre dois computadores.</span><span class="sxs-lookup"><span data-stu-id="adc7a-137">Cross-domain calls use the same remote call infrastructure as calls between two processes or between two machines.</span></span> <span data-ttu-id="adc7a-138">Assim, os metadados para o objeto referenciado devem estar disponíveis para ambos os domínios de aplicativo para permitir que a chamada de método seja compilada corretamente por JIT.</span><span class="sxs-lookup"><span data-stu-id="adc7a-138">As such, the metadata for the object being referenced must be available to both application domains to allow the method call to be JIT-compiled properly.</span></span> <span data-ttu-id="adc7a-139">Se o domínio de chamada não tiver acesso aos metadados do objeto que está sendo chamado, a compilação poderá falhar com uma exceção do tipo <xref:System.IO.FileNotFoundException>.</span><span class="sxs-lookup"><span data-stu-id="adc7a-139">If the calling domain does not have access to the metadata for the object being called, the compilation might fail with an exception of type <xref:System.IO.FileNotFoundException>.</span></span> <span data-ttu-id="adc7a-140">Para obter mais informações, confira [Objetos remotos](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/72x4h507(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="adc7a-140">For more information, see [Remote Objects](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/72x4h507(v=vs.100)).</span></span> <span data-ttu-id="adc7a-141">O mecanismo para determinar como objetos podem ser acessados em domínios é determinado pelo objeto.</span><span class="sxs-lookup"><span data-stu-id="adc7a-141">The mechanism for determining how objects can be accessed across domains is determined by the object.</span></span> <span data-ttu-id="adc7a-142">Para obter mais informações, consulte <xref:System.MarshalByRefObject?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="adc7a-142">For more information, see <xref:System.MarshalByRefObject?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="adc7a-143">O escopo do comportamento do código é dado pelo aplicativo no qual ele é executado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-143">The behavior of code is scoped by the application in which it runs.</span></span> <span data-ttu-id="adc7a-144">Em outras palavras, o domínio do aplicativo fornece definições de configuração, como as políticas de versão do aplicativo, o local de qualquer assembly remoto acessado e informações sobre onde localizar assemblies carregados no domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-144">In other words, the application domain provides configuration settings such as application version policies, the location of any remote assemblies it accesses, and information about where to locate assemblies that are loaded into the domain.</span></span>  
  
- <span data-ttu-id="adc7a-145">Permissões concedidas ao código podem ser controladas pelo domínio do aplicativo no qual o código está sendo executado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-145">Permissions granted to code can be controlled by the application domain in which the code is running.</span></span>  
  
## <a name="application-domains-and-assemblies"></a><span data-ttu-id="adc7a-146">Domínios de aplicativo e assemblies</span><span class="sxs-lookup"><span data-stu-id="adc7a-146">Application domains and assemblies</span></span>

 <span data-ttu-id="adc7a-147">Esta seção descreve o relacionamento entre domínios do aplicativo e assemblies.</span><span class="sxs-lookup"><span data-stu-id="adc7a-147">This section describes the relationship between application domains and assemblies.</span></span> <span data-ttu-id="adc7a-148">Você deve carregar um assembly em um domínio de aplicativo para executar o código que ele contém.</span><span class="sxs-lookup"><span data-stu-id="adc7a-148">You must load an assembly into an application domain before you can execute the code it contains.</span></span> <span data-ttu-id="adc7a-149">Executar um aplicativo típico faz vários assemblies serem carregados em um domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-149">Running a typical application causes several assemblies to be loaded into an application domain.</span></span>  
  
 <span data-ttu-id="adc7a-150">A maneira como um assembly é carregado determina se o seu código compilado por JIT (just-in-time) pode ser compartilhado por vários domínios de aplicativo no processo e se o assembly pode ser descarregado do processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-150">The way an assembly is loaded determines whether its just-in-time (JIT) compiled code can be shared by multiple application domains in the process, and whether the assembly can be unloaded from the process.</span></span>  
  
- <span data-ttu-id="adc7a-151">Se um assembly for carregado em domínio neutro, todos os domínios de aplicativo que compartilharem o mesmo conjunto de concessões de segurança poderão compartilhar o mesmo código compilado por JIT, o que reduz a memória exigida pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-151">If an assembly is loaded domain-neutral, all application domains that share the same security grant set can share the same JIT-compiled code, which reduces the memory required by the application.</span></span> <span data-ttu-id="adc7a-152">No entanto, o assembly jamais pode ser descarregado do processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-152">However, the assembly can never be unloaded from the process.</span></span>  
  
- <span data-ttu-id="adc7a-153">Se um assembly não for carregado em domínio neutro, ele deverá ser compilado por JIT em cada domínio de aplicativo no qual ele for carregado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-153">If an assembly is not loaded domain-neutral, it must be JIT-compiled in every application domain in which it is loaded.</span></span> <span data-ttu-id="adc7a-154">No entanto, o assembly pode ser descarregado do processo descarregando-se todos os domínios de aplicativo em que ele está carregado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-154">However, the assembly can be unloaded from the process by unloading all the application domains in which it is loaded.</span></span>  
  
 <span data-ttu-id="adc7a-155">O host de runtime decidirá se é necessário carregar os assemblies como neutros com relação ao domínio quando ele carregar o runtime em um processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-155">The runtime host determines whether to load assemblies as domain-neutral when it loads the runtime into a process.</span></span> <span data-ttu-id="adc7a-156">Para aplicativos gerenciados, aplique o atributo <xref:System.LoaderOptimizationAttribute> ao método de ponto de entrada do processo e especifique um valor da enumeração <xref:System.LoaderOptimization> associada.</span><span class="sxs-lookup"><span data-stu-id="adc7a-156">For managed applications, apply the <xref:System.LoaderOptimizationAttribute> attribute to the entry-point method for the process, and specify a value from the associated <xref:System.LoaderOptimization> enumeration.</span></span> <span data-ttu-id="adc7a-157">Para aplicativos não gerenciados que hospedam o Common Language Runtime, especifique o sinalizador apropriado ao chamar o método [CorBindToRuntimeEx Function](../unmanaged-api/hosting/corbindtoruntimeex-function.md).</span><span class="sxs-lookup"><span data-stu-id="adc7a-157">For unmanaged applications that host the common language runtime, specify the appropriate flag when you call the [CorBindToRuntimeEx Function](../unmanaged-api/hosting/corbindtoruntimeex-function.md) method.</span></span>  
  
 <span data-ttu-id="adc7a-158">Existem três opções para carregar assemblies de domínio neutro:</span><span class="sxs-lookup"><span data-stu-id="adc7a-158">There are three options for loading domain-neutral assemblies:</span></span>  
  
- <span data-ttu-id="adc7a-159"><xref:System.LoaderOptimization.SingleDomain?displayProperty=nameWithType> não carrega assemblies como neutros em relação ao domínio, exceto Mscorlib, que é sempre carregado como neutro em relação ao domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-159"><xref:System.LoaderOptimization.SingleDomain?displayProperty=nameWithType> loads no assemblies as domain-neutral, except Mscorlib, which is always loaded domain-neutral.</span></span> <span data-ttu-id="adc7a-160">Essa configuração é chamada de domínio único, porque ela normalmente é usada quando o host está executando apenas um único aplicativo no processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-160">This setting is called single domain because it is commonly used when the host is running only a single application in the process.</span></span>

- <span data-ttu-id="adc7a-161"><xref:System.LoaderOptimization.MultiDomain?displayProperty=nameWithType> carrega todos os assemblies como neutros em relação ao domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-161"><xref:System.LoaderOptimization.MultiDomain?displayProperty=nameWithType> loads all assemblies as domain-neutral.</span></span> <span data-ttu-id="adc7a-162">Use essa configuração quando houver vários domínios de aplicativo no processo, todos executando o mesmo código.</span><span class="sxs-lookup"><span data-stu-id="adc7a-162">Use this setting when there are multiple application domains in the process, all of which run the same code.</span></span>

- <span data-ttu-id="adc7a-163"><xref:System.LoaderOptimization.MultiDomainHost?displayProperty=nameWithType> carrega assemblies de nome forte como neutros em relação ao domínio, se eles e todas as suas dependências foram instalados na cache de assembly global.</span><span class="sxs-lookup"><span data-stu-id="adc7a-163"><xref:System.LoaderOptimization.MultiDomainHost?displayProperty=nameWithType> loads strong-named assemblies as domain-neutral, if they and all their dependencies have been installed in the global assembly cache.</span></span> <span data-ttu-id="adc7a-164">Outros assemblies são carregados e compilados por JIT separadamente para cada domínio de aplicativo em que são carregados e, assim, podem ser descarregados do processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-164">Other assemblies are loaded and JIT-compiled separately for each application domain in which they are loaded, and thus can be unloaded from the process.</span></span> <span data-ttu-id="adc7a-165">Use essa configuração ao executar mais de um aplicativo no mesmo processo, ou se você tiver uma combinação de assemblies compartilhados por vários domínios de aplicativos e assemblies que precisam ser descarregados do processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-165">Use this setting when running more than one application in the same process, or if you have a mixture of assemblies that are shared by many application domains and assemblies that need to be unloaded from the process.</span></span>
  
 <span data-ttu-id="adc7a-166">Códigos compilados por JIT não podem ser compartilhados por assemblies carregados no contexto de carga, usando o método <xref:System.Reflection.Assembly.LoadFrom%2A> da classe <xref:System.Reflection.Assembly>, ou carregados com base em imagens usando sobrecargas do método <xref:System.Reflection.Assembly.Load%2A> que especificam matrizes de bytes.</span><span class="sxs-lookup"><span data-stu-id="adc7a-166">JIT-compiled code cannot be shared for assemblies loaded into the load-from context, using the <xref:System.Reflection.Assembly.LoadFrom%2A> method of the <xref:System.Reflection.Assembly> class, or loaded from images using overloads of the <xref:System.Reflection.Assembly.Load%2A> method that specify byte arrays.</span></span>  
  
 <span data-ttu-id="adc7a-167">Os assemblies que foram compilados para código nativo usando o [Ngen.exe (Gerador de Imagem Nativa)](../tools/ngen-exe-native-image-generator.md) poderão ser compartilhados entre domínios de aplicativo, se eles tiverem sido carregados como neutros em relação ao domínio na primeira vez em que eles forem carregados em um processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-167">Assemblies that have been compiled to native code by using the [Ngen.exe (Native Image Generator)](../tools/ngen-exe-native-image-generator.md) can be shared between application domains, if they are loaded domain-neutral the first time they are loaded into a process.</span></span>  
  
 <span data-ttu-id="adc7a-168">Códigos compilados por JIT para o assembly que contém o ponto de entrada do aplicativo só serão compartilhados se todas as suas dependências puderem ser compartilhadas.</span><span class="sxs-lookup"><span data-stu-id="adc7a-168">JIT-compiled code for the assembly that contains the application entry point is shared only if all its dependencies can be shared.</span></span>  
  
 <span data-ttu-id="adc7a-169">Um assembly neutro em relação ao domínio pode ser compilado por JIT mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="adc7a-169">A domain-neutral assembly can be JIT-compiled more than once.</span></span> <span data-ttu-id="adc7a-170">Por exemplo, quando os conjuntos de concessões de segurança de dois domínios de aplicativo forem diferentes, eles não poderão compartilhar o mesmo código compilado por JIT.</span><span class="sxs-lookup"><span data-stu-id="adc7a-170">For example, when the security grant sets of two application domains are different, they cannot share the same JIT-compiled code.</span></span> <span data-ttu-id="adc7a-171">No entanto, cada cópia do assembly compilado por JIT pode ser compartilhada com outros domínios de aplicativo que tenham o mesmo conjunto de concessões.</span><span class="sxs-lookup"><span data-stu-id="adc7a-171">However, each copy of the JIT-compiled assembly can be shared with other application domains that have the same grant set.</span></span>  
  
 <span data-ttu-id="adc7a-172">Ao decidir se deve carregar assemblies como neutros em relação ao domínio, você deve fazer uma escolha entre reduzir o uso de memória e outros fatores de desempenho.</span><span class="sxs-lookup"><span data-stu-id="adc7a-172">When you decide whether to load assemblies as domain-neutral, you must make a tradeoff between reducing memory use and other performance factors.</span></span>  
  
- <span data-ttu-id="adc7a-173">O acesso a dados e métodos estáticos é mais lento para assemblies neutros em relação ao domínio devido à necessidade de isolamento dos assemblies.</span><span class="sxs-lookup"><span data-stu-id="adc7a-173">Access to static data and methods is slower for domain-neutral assemblies because of the need to isolate assemblies.</span></span> <span data-ttu-id="adc7a-174">Cada domínio do aplicativo que acessa o assembly deve ter uma cópia separada dos dados estáticos, para evitar que referências a objetos em campos estáticos cruzem os limites do domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-174">Each application domain that accesses the assembly must have a separate copy of the static data, to prevent references to objects in static fields from crossing domain boundaries.</span></span> <span data-ttu-id="adc7a-175">Como resultado, o runtime contém a lógica adicional para direcionar um chamador para a cópia apropriada de dados estáticos ou método.</span><span class="sxs-lookup"><span data-stu-id="adc7a-175">As a result, the runtime contains additional logic to direct a caller to the appropriate copy of the static data or method.</span></span> <span data-ttu-id="adc7a-176">Essa lógica extra retarda a chamada.</span><span class="sxs-lookup"><span data-stu-id="adc7a-176">This extra logic slows down the call.</span></span>  
  
- <span data-ttu-id="adc7a-177">Todas as dependências de um assembly deverão estar localizadas e carregadas quando o assembly for carregado como neutro em relação ao domínio, porque uma dependência que não puder ser carregada como neutra em relação ao domínio impedirá que o assembly seja carregado como neutro em relação ao domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-177">All the dependencies of an assembly must be located and loaded when the assembly is loaded domain-neutral, because a dependency that cannot be loaded domain-neutral prevents the assembly from being loaded domain-neutral.</span></span>  
  
## <a name="application-domains-and-threads"></a><span data-ttu-id="adc7a-178">Domínios do aplicativo e threads</span><span class="sxs-lookup"><span data-stu-id="adc7a-178">Application domains and threads</span></span>

 <span data-ttu-id="adc7a-179">Um domínio de aplicativo forma um limite de isolamento para segurança, controle de versão, confiabilidade e descarregamento de código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-179">An application domain forms an isolation boundary for security, versioning, reliability, and unloading of managed code.</span></span> <span data-ttu-id="adc7a-180">Um thread é o constructo do sistema operacional usado pelo Common Language Runtime para executar código.</span><span class="sxs-lookup"><span data-stu-id="adc7a-180">A thread is the operating system construct used by the common language runtime to execute code.</span></span> <span data-ttu-id="adc7a-181">No tempo de execução, todos os códigos gerenciados são carregados em um domínio de aplicativo e são executados por um ou mais threads gerenciados.</span><span class="sxs-lookup"><span data-stu-id="adc7a-181">At run time, all managed code is loaded into an application domain and is run by one or more managed threads.</span></span>  
  
 <span data-ttu-id="adc7a-182">Não há uma correlação um-para-um entre domínios de aplicativo e threads.</span><span class="sxs-lookup"><span data-stu-id="adc7a-182">There is not a one-to-one correlation between application domains and threads.</span></span> <span data-ttu-id="adc7a-183">Vários threads podem ser executados em um único domínio de aplicativo a qualquer momento e um determinado thread não está confinado a um único domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-183">Several threads can execute in a single application domain at any given time, and a particular thread is not confined to a single application domain.</span></span> <span data-ttu-id="adc7a-184">Ou seja, threads são livres para atravessar limites de domínio de aplicativo; um novo thread não é criado para cada domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-184">That is, threads are free to cross application domain boundaries; a new thread is not created for each application domain.</span></span>  
  
 <span data-ttu-id="adc7a-185">A qualquer momento, cada thread é executado em um domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-185">At any given time, every thread executes in an application domain.</span></span> <span data-ttu-id="adc7a-186">Zero, um ou vários threads podem estar em execução em um determinado domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-186">Zero, one, or multiple threads might be executing in any given application domain.</span></span> <span data-ttu-id="adc7a-187">O runtime acompanha quais threads estão em execução em quais domínios do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-187">The runtime keeps track of which threads are running in which application domains.</span></span> <span data-ttu-id="adc7a-188">Você pode localizar o domínio no qual um thread está em execução a qualquer momento chamando o método <xref:System.Threading.Thread.GetDomain%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="adc7a-188">You can locate the domain in which a thread is executing at any time by calling the <xref:System.Threading.Thread.GetDomain%2A?displayProperty=nameWithType> method.</span></span>

### <a name="application-domains-and-cultures"></a><span data-ttu-id="adc7a-189">Domínios do aplicativo e culturas</span><span class="sxs-lookup"><span data-stu-id="adc7a-189">Application domains and cultures</span></span>

 <span data-ttu-id="adc7a-190">A cultura, que é representada por um objeto <xref:System.Globalization.CultureInfo>, está associada a threads.</span><span class="sxs-lookup"><span data-stu-id="adc7a-190">Culture, which is represented by a <xref:System.Globalization.CultureInfo> object, is associated with threads.</span></span> <span data-ttu-id="adc7a-191">Você pode obter a cultura associada ao thread em execução no momento usando a propriedade <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> e obter ou definir a cultura associada ao thread em execução no momento usando a propriedade <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="adc7a-191">You can get the culture that is associated with the currently executing thread by using the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> property, and you can get or set the culture that is associated with the currently executing thread by using the <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="adc7a-192">Se a cultura associada a um thread tiver sido definida explicitamente usando-se a propriedade <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType>, ela continuará sendo associada a esse thread quando ele cruzar os limites de domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-192">If the culture that is associated with a thread has been explicitly set by using the <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> property, it continues to be associated with that thread when the thread crosses application domain boundaries.</span></span> <span data-ttu-id="adc7a-193">Do contrário, a cultura associada ao thread em um dado momento é determinada pelo valor da propriedade <xref:System.Globalization.CultureInfo.DefaultThreadCurrentCulture%2A?displayProperty=nameWithType> no domínio do aplicativo no qual o thread está sendo executado:</span><span class="sxs-lookup"><span data-stu-id="adc7a-193">Otherwise, the culture that is associated with the thread at any given time is determined by the value of the <xref:System.Globalization.CultureInfo.DefaultThreadCurrentCulture%2A?displayProperty=nameWithType> property in the application domain in which the thread is executing:</span></span>  
  
- <span data-ttu-id="adc7a-194">Se o valor da propriedade não for `null`, a cultura retornada pela propriedade estará associada ao thread (e, assim, retornada pelas propriedades <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> e <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType>).</span><span class="sxs-lookup"><span data-stu-id="adc7a-194">If the value of the property is not `null`, the culture that is returned by the property is associated with the thread (and therefore returned by the <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> and <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> properties).</span></span>  
  
- <span data-ttu-id="adc7a-195">Se o valor da propriedade for `null`, a cultura do sistema atual estará associada ao thread.</span><span class="sxs-lookup"><span data-stu-id="adc7a-195">If the value of the property is `null`, the current system culture is associated with the thread.</span></span>  
  
## <a name="programming-with-application-domains"></a><span data-ttu-id="adc7a-196">Programação com domínios do aplicativo</span><span class="sxs-lookup"><span data-stu-id="adc7a-196">Programming with application domains</span></span>

 <span data-ttu-id="adc7a-197">Domínios de aplicativo costumam ser criados e manipulados programaticamente por hosts de runtime.</span><span class="sxs-lookup"><span data-stu-id="adc7a-197">Application domains are usually created and manipulated programmatically by runtime hosts.</span></span> <span data-ttu-id="adc7a-198">Entretanto, às vezes, um aplicativo também pode preferir trabalhar com domínios de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-198">However, sometimes an application program might also want to work with application domains.</span></span> <span data-ttu-id="adc7a-199">Por exemplo, um programa de aplicativo pode carregar um componente do aplicativo em um domínio para poder descarregar o domínio (e o componente) sem precisar interromper o aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="adc7a-199">For example, an application program could load an application component into a domain to be able to unload the domain (and the component) without having to stop the entire application.</span></span>  
  
 <span data-ttu-id="adc7a-200">O <xref:System.AppDomain> é a interface programática para domínios de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-200">The <xref:System.AppDomain> is the programmatic interface to application domains.</span></span> <span data-ttu-id="adc7a-201">Essa classe inclui métodos para criar e descarregar domínios, para criar instâncias de tipos em domínios e registrar várias notificações como o descarregamento de domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-201">This class includes methods to create and unload domains, to create instances of types in domains, and to register for various notifications such as application domain unloading.</span></span> <span data-ttu-id="adc7a-202">A tabela a seguir lista os métodos <xref:System.AppDomain> mais usados.</span><span class="sxs-lookup"><span data-stu-id="adc7a-202">The following table lists commonly used <xref:System.AppDomain> methods.</span></span>  
  
|<span data-ttu-id="adc7a-203">Método AppDomain</span><span class="sxs-lookup"><span data-stu-id="adc7a-203">AppDomain Method</span></span>|<span data-ttu-id="adc7a-204">Descrição</span><span class="sxs-lookup"><span data-stu-id="adc7a-204">Description</span></span>|  
|----------------------|-----------------|  
|<xref:System.AppDomain.CreateDomain%2A>|<span data-ttu-id="adc7a-205">Cria um novo domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-205">Creates a new application domain.</span></span> <span data-ttu-id="adc7a-206">É recomendável usar uma sobrecarga desse método que especifique um objeto <xref:System.AppDomainSetup>.</span><span class="sxs-lookup"><span data-stu-id="adc7a-206">It is recommended that you use an overload of this method that specifies an <xref:System.AppDomainSetup> object.</span></span> <span data-ttu-id="adc7a-207">Essa é a maneira preferencial para definir as propriedades de um novo domínio, como a base do aplicativo ou o diretório raiz do aplicativo; o local do arquivo de configuração do domínio e o caminho de pesquisa que o Common Language Runtime deve usar para carregar assemblies dentro do domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-207">This is the preferred way to set the properties of a new domain, such as the application base, or root directory for the application; the location of the configuration file for the domain; and the search path that the common language runtime is to use to load assemblies into the domain.</span></span>|  
|<span data-ttu-id="adc7a-208"><xref:System.AppDomain.ExecuteAssembly%2A> e <xref:System.AppDomain.ExecuteAssemblyByName%2A></span><span class="sxs-lookup"><span data-stu-id="adc7a-208"><xref:System.AppDomain.ExecuteAssembly%2A> and <xref:System.AppDomain.ExecuteAssemblyByName%2A></span></span>|<span data-ttu-id="adc7a-209">Executa um assembly no domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-209">Executes an assembly in the application domain.</span></span> <span data-ttu-id="adc7a-210">Como esse é um método de instância, ele pode ser usado para executar código em outro domínio de aplicativo para o qual você tenha uma referência.</span><span class="sxs-lookup"><span data-stu-id="adc7a-210">This is an instance method, so it can be used to execute code in another application domain to which you have a reference.</span></span>|  
|<xref:System.AppDomain.CreateInstanceAndUnwrap%2A>|<span data-ttu-id="adc7a-211">Cria uma instância de um tipo especificado no domínio de aplicativo e retorna um proxy.</span><span class="sxs-lookup"><span data-stu-id="adc7a-211">Creates an instance of a specified type in the application domain, and returns a proxy.</span></span> <span data-ttu-id="adc7a-212">Use esse método para evitar carregar o assembly contendo o tipo criado no assembly da chamada.</span><span class="sxs-lookup"><span data-stu-id="adc7a-212">Use this method to avoid loading the assembly containing the created type into the calling assembly.</span></span>|  
|<xref:System.AppDomain.Unload%2A>|<span data-ttu-id="adc7a-213">Executa um desligamento elegante do domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-213">Performs a graceful shutdown of the domain.</span></span> <span data-ttu-id="adc7a-214">O domínio do aplicativo não é descarregado até que todos os threads em execução no domínio tenham sido interrompidos ou não estejam mais no domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-214">The application domain is not unloaded until all threads running in the domain have either stopped or are no longer in the domain.</span></span>|  
  
> [!NOTE]
> <span data-ttu-id="adc7a-215">Como o Common Language Runtime não dá suporte à serialização de métodos globais, representantes não podem ser usados para executar métodos globais em outros domínios de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-215">The common language runtime does not support serialization of global methods, so delegates cannot be used to execute global methods in other application domains.</span></span>  
  
 <span data-ttu-id="adc7a-216">As interfaces não gerenciadas descritas na Especificação Hospedando Interfaces do Common Language Runtime também dão acesso a domínios de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-216">The unmanaged interfaces described in the common language runtime Hosting Interfaces Specification also provide access to application domains.</span></span> <span data-ttu-id="adc7a-217">Hosts de runtime podem usar interfaces do código não gerenciado para criar e obter acesso aos domínios de aplicativo dentro de um processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-217">Runtime hosts can use interfaces from unmanaged code to create and gain access to the application domains within a process.</span></span>  
  
## <a name="the-complus_loaderoptimization-environment-variable"></a><span data-ttu-id="adc7a-218">A variável de ambiente COMPLUS_LoaderOptimization</span><span class="sxs-lookup"><span data-stu-id="adc7a-218">The COMPLUS_LoaderOptimization environment variable</span></span>

 <span data-ttu-id="adc7a-219">Uma variável de ambiente que define a política padrão de otimização do carregador de um aplicativo executável.</span><span class="sxs-lookup"><span data-stu-id="adc7a-219">An environment variable that sets the default loader optimization policy of an executable application.</span></span>  
  
### <a name="syntax"></a><span data-ttu-id="adc7a-220">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="adc7a-220">Syntax</span></span>  
  
```env  
COMPLUS_LoaderOptimization = 1  
```  
  
### <a name="remarks"></a><span data-ttu-id="adc7a-221">Comentários</span><span class="sxs-lookup"><span data-stu-id="adc7a-221">Remarks</span></span>

 <span data-ttu-id="adc7a-222">Um aplicativo típico carrega vários assemblies em um domínio de aplicativo antes que o código que eles contêm possa ser executado.</span><span class="sxs-lookup"><span data-stu-id="adc7a-222">A typical application loads several assemblies into an application domain before the code they contain can be executed.</span></span>  
  
 <span data-ttu-id="adc7a-223">A maneira que o assembly é carregado determina se o seu código compilado por JIT (just-in-time) pode ser compartilhado por vários domínios de aplicativo no processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-223">The way the assembly is loaded determines whether its just-in-time (JIT) compiled code can be shared by multiple application domains in the process.</span></span>  
  
- <span data-ttu-id="adc7a-224">Se um assembly for carregado em domínio neutro, todos os domínios de aplicativo que compartilhem o mesmo conjunto de concessão de segurança poderão compartilhar o mesmo código compilado por JIT.</span><span class="sxs-lookup"><span data-stu-id="adc7a-224">If an assembly is loaded domain-neutral, all application domains that share the same security grant set can share the same JIT-compiled code.</span></span> <span data-ttu-id="adc7a-225">Isso reduz a memória exigida pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-225">This reduces the memory required by the application.</span></span>  
  
- <span data-ttu-id="adc7a-226">Se um assembly não for carregado em domínio neutro, ele deverá ser compilado por JIT em cada domínio de aplicativo em que for carregado e o carregador não deverá compartilhar recursos internos entre domínios de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-226">If an assembly is not loaded domain-neutral, it must be JIT-compiled in every application domain in which it is loaded and the loader must not share internal resources across application domains.</span></span>  
  
 <span data-ttu-id="adc7a-227">Quando definido como 1, o sinalizador de ambiente COMPLUS_LoaderOptimization força o host de runtime a carregar todos os assemblies de maneira de domínio não neutro, conhecido como SingleDomain.</span><span class="sxs-lookup"><span data-stu-id="adc7a-227">When set to 1, the COMPLUS_LoaderOptimization environment flag forces the runtime host to load all assemblies in non-domain-neutral way known as SingleDomain.</span></span> <span data-ttu-id="adc7a-228">SingleDomain não carrega assemblies como neutros em relação ao domínio, exceto Mscorlib, que é sempre carregado como neutro em relação ao domínio.</span><span class="sxs-lookup"><span data-stu-id="adc7a-228">SingleDomain loads no assemblies as domain-neutral, except Mscorlib, which is always loaded domain-neutral.</span></span> <span data-ttu-id="adc7a-229">Essa configuração é chamada de domínio único, porque ela normalmente é usada quando o host está executando apenas um único aplicativo no processo.</span><span class="sxs-lookup"><span data-stu-id="adc7a-229">This setting is called single domain because it is commonly used when the host is running only a single application in the process.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="adc7a-230">O sinalizador de ambiente COMPLUS_LoaderOptimization foi projetado para ser usado em cenários de diagnóstico e de teste.</span><span class="sxs-lookup"><span data-stu-id="adc7a-230">The COMPLUS_LoaderOptimization environment flag was designed to be used in diagnostic and test scenarios.</span></span> <span data-ttu-id="adc7a-231">Ter o sinalizador ativado pode causar uma grave lentidão e aumentar o uso de memória.</span><span class="sxs-lookup"><span data-stu-id="adc7a-231">Having the flag turned on can cause severe slow-down and increase in memory usage.</span></span>  
  
### <a name="code-example"></a><span data-ttu-id="adc7a-232">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="adc7a-232">Code example</span></span>

 <span data-ttu-id="adc7a-233">Para forçar todos os assemblies a não serem carregados como domínios neutros para o serviço IISADMIN, pode ser obtido acrescentando `COMPLUS_LoaderOptimization=1` ao valor de várias cadeia de caracteres de ambiente na chave HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\IISADMIN.</span><span class="sxs-lookup"><span data-stu-id="adc7a-233">To force all assemblies not to be loaded as domain-neutral for the IISADMIN service can be achieved by appending `COMPLUS_LoaderOptimization=1` to the Environment’s Multi-String Value in the HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\IISADMIN key.</span></span>  
  
```env  
Key = HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\IISADMIN  
Name = Environment  
Type = REG_MULTI_SZ  
Value (to append) = COMPLUS_LoaderOptimization=1  
```  
  
## <a name="see-also"></a><span data-ttu-id="adc7a-234">Consulte também</span><span class="sxs-lookup"><span data-stu-id="adc7a-234">See also</span></span>

- <xref:System.AppDomain?displayProperty=nameWithType>
- <xref:System.MarshalByRefObject?displayProperty=nameWithType>
- [<span data-ttu-id="adc7a-235">Programação com domínios do aplicativo e assemblies</span><span class="sxs-lookup"><span data-stu-id="adc7a-235">Programming with Application Domains and Assemblies</span></span>](index.md)
- [<span data-ttu-id="adc7a-236">Uso de domínios do aplicativo</span><span class="sxs-lookup"><span data-stu-id="adc7a-236">Using Application Domains</span></span>](use.md)
