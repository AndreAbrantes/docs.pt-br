---
title: Criando cópias de sombra de assemblies
ms.date: 03/30/2017
helpviewer_keywords:
- assemblies [.NET Framework], shadow copying
- application domains, shadow copying assemblies
- shadow copying assemblies
ms.assetid: de8b8759-fca7-4260-896b-5a4973157672
ms.openlocfilehash: 9fc8a4aeeeca40f71ed9114a9db40b9a56e5fe6b
ms.sourcegitcommit: 81ad1f09b93f3b3e6706a7f2e4ddf50ef229ea3d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/20/2019
ms.locfileid: "74204568"
---
# <a name="shadow-copying-assemblies"></a><span data-ttu-id="d32d1-102">Criando cópias de sombra de assemblies</span><span class="sxs-lookup"><span data-stu-id="d32d1-102">Shadow Copying Assemblies</span></span>

<span data-ttu-id="d32d1-103">A criação de cópias de sombra permite que os assemblies usados em um domínio de aplicativo sejam atualizados sem descarregar o domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d32d1-103">Shadow copying enables assemblies that are used in an application domain to be updated without unloading the application domain.</span></span> <span data-ttu-id="d32d1-104">Isso é particularmente útil para aplicativos que devem estar disponíveis continuamente, como sites do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d32d1-104">This is particularly useful for applications that must be available continuously, such as ASP.NET sites.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d32d1-105">Não há suporte para cópia de sombra em aplicativos da loja do Windows 8. x.</span><span class="sxs-lookup"><span data-stu-id="d32d1-105">Shadow copying is not supported in Windows 8.x Store apps.</span></span>

<span data-ttu-id="d32d1-106">O common language runtime bloqueia um arquivo do assembly quando o assembly é carregado para que o arquivo não possa ser atualizado até que o assembly seja descarregado.</span><span class="sxs-lookup"><span data-stu-id="d32d1-106">The common language runtime locks an assembly file when the assembly is loaded, so the file cannot be updated until the assembly is unloaded.</span></span> <span data-ttu-id="d32d1-107">A única maneira de descarregar um assembly de um domínio de aplicativo é descarregar o domínio de aplicativo. Portanto, em circunstâncias normais, um assembly não pode ser atualizado no disco até que todos os domínios de aplicativo que o estão usando sejam descarregados.</span><span class="sxs-lookup"><span data-stu-id="d32d1-107">The only way to unload an assembly from an application domain is by unloading the application domain, so under normal circumstances, an assembly cannot be updated on disk until all the application domains that are using it have been unloaded.</span></span>

<span data-ttu-id="d32d1-108">Quando um domínio de aplicativo é configurado para cópia de sombra de arquivos, os assemblies do caminho do aplicativo são copiados em outro local e carregados a partir desse local.</span><span class="sxs-lookup"><span data-stu-id="d32d1-108">When an application domain is configured to shadow copy files, assemblies from the application path are copied to another location and loaded from that location.</span></span> <span data-ttu-id="d32d1-109">A cópia é bloqueada, mas o arquivo do assembly original é desbloqueado e pode ser atualizado.</span><span class="sxs-lookup"><span data-stu-id="d32d1-109">The copy is locked, but the original assembly file is unlocked and can be updated.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d32d1-110">Os únicos assemblies dos quais é possível realizar uma cópia de sombra são aqueles armazenados no diretório do aplicativo ou em seus subdiretórios, especificados pelas propriedades <xref:System.AppDomainSetup.ApplicationBase%2A> e <xref:System.AppDomainSetup.PrivateBinPath%2A> quando o domínio de aplicativo é configurado.</span><span class="sxs-lookup"><span data-stu-id="d32d1-110">The only assemblies that can be shadow copied are those stored in the application directory or its subdirectories, specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties when the application domain is configured.</span></span> <span data-ttu-id="d32d1-111">Os assemblies armazenados no cache de assembly global não passam por cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="d32d1-111">Assemblies stored in the global assembly cache are not shadow copied.</span></span>

<span data-ttu-id="d32d1-112">Este artigo inclui as seções a seguir:</span><span class="sxs-lookup"><span data-stu-id="d32d1-112">This article contains the following sections:</span></span>

- <span data-ttu-id="d32d1-113">[Habilitar e usar cópias de sombra](#EnablingAndUsing) descreve o uso básico e as opções disponíveis para cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="d32d1-113">[Enabling and Using Shadow Copying](#EnablingAndUsing) describes the basic use and the options that are available for shadow copying.</span></span>

- <span data-ttu-id="d32d1-114">[Desempenho de inicialização](#StartupPerformance) descreve as alterações feitas na cópia de sombra no .NET Framework 4 para melhorar o desempenho de inicialização, e como reverter para o comportamento de versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="d32d1-114">[Startup Performance](#StartupPerformance) describes the changes that are made to shadow copying in the .NET Framework 4 to improve startup performance, and how to revert to the behavior of earlier versions.</span></span>

- <span data-ttu-id="d32d1-115">[Métodos obsoletos](#ObsoleteMethods) descreve as alterações feitas nas propriedades e nos métodos que controlam a cópia de sombra no .NET Framework 2.0.</span><span class="sxs-lookup"><span data-stu-id="d32d1-115">[Obsolete Methods](#ObsoleteMethods) describes the changes that were made to the properties and methods that control shadow copying in the .NET Framework 2.0.</span></span>

<a name="EnablingAndUsing"></a>

## <a name="enabling-and-using-shadow-copying"></a><span data-ttu-id="d32d1-116">Habilitando e Usando Cópias de Sombra</span><span class="sxs-lookup"><span data-stu-id="d32d1-116">Enabling and Using Shadow Copying</span></span>

<span data-ttu-id="d32d1-117">Você pode usar as propriedades da classe <xref:System.AppDomainSetup> da seguinte forma para configurar um domínio do aplicativo para a cópia de sombra:</span><span class="sxs-lookup"><span data-stu-id="d32d1-117">You can use the properties of the <xref:System.AppDomainSetup> class as follows to configure an application domain for shadow copying:</span></span>

- <span data-ttu-id="d32d1-118">Habilite a cópia de sombra definindo a propriedade <xref:System.AppDomainSetup.ShadowCopyFiles%2A> com o valor de cadeia de caracteres `"true"`.</span><span class="sxs-lookup"><span data-stu-id="d32d1-118">Enable shadow copying by setting the <xref:System.AppDomainSetup.ShadowCopyFiles%2A> property to the string value `"true"`.</span></span>

  <span data-ttu-id="d32d1-119">Por padrão, essa configuração faz com que todos os assemblies no caminho do aplicativo sejam copiados para um cache de download antes de serem carregados.</span><span class="sxs-lookup"><span data-stu-id="d32d1-119">By default, this setting causes all assemblies in the application path to be copied to a download cache before they are loaded.</span></span> <span data-ttu-id="d32d1-120">Esse é o mesmo cache mantido pelo common language runtime para armazenar os arquivos baixados de outros computadores, e o common language runtime exclui automaticamente os arquivos quando eles não são mais necessários.</span><span class="sxs-lookup"><span data-stu-id="d32d1-120">This is the same cache maintained by the common language runtime to store files downloaded from other computers, and the common language runtime automatically deletes the files when they are no longer needed.</span></span>

- <span data-ttu-id="d32d1-121">Opcionalmente, defina um local personalizado para os arquivos da cópia de sombra usando as propriedades <xref:System.AppDomainSetup.CachePath%2A> e <xref:System.AppDomainSetup.ApplicationName%2A>.</span><span class="sxs-lookup"><span data-stu-id="d32d1-121">Optionally set a custom location for shadow copied files by using the <xref:System.AppDomainSetup.CachePath%2A> property and the <xref:System.AppDomainSetup.ApplicationName%2A> property.</span></span>

  <span data-ttu-id="d32d1-122">O caminho base para o local é formado pela concatenação da propriedade <xref:System.AppDomainSetup.ApplicationName%2A> para a propriedade <xref:System.AppDomainSetup.CachePath%2A> como um subdiretório.</span><span class="sxs-lookup"><span data-stu-id="d32d1-122">The base path for the location is formed by concatenating the <xref:System.AppDomainSetup.ApplicationName%2A> property to the <xref:System.AppDomainSetup.CachePath%2A> property as a subdirectory.</span></span> <span data-ttu-id="d32d1-123">Assemblies passam por cópia de sombra para subpastas nesse caminho, e não para o caminho base em si.</span><span class="sxs-lookup"><span data-stu-id="d32d1-123">Assemblies are shadow copied to subdirectories of this path, not to the base path itself.</span></span>

  > [!NOTE]
  > <span data-ttu-id="d32d1-124">Se a propriedade <xref:System.AppDomainSetup.ApplicationName%2A> não for definida, a propriedade <xref:System.AppDomainSetup.CachePath%2A> será ignorada e o cache de download será usado.</span><span class="sxs-lookup"><span data-stu-id="d32d1-124">If the <xref:System.AppDomainSetup.ApplicationName%2A> property is not set, the <xref:System.AppDomainSetup.CachePath%2A> property is ignored and the download cache is used.</span></span> <span data-ttu-id="d32d1-125">Nenhuma exceção é lançada.</span><span class="sxs-lookup"><span data-stu-id="d32d1-125">No exception is thrown.</span></span>

  <span data-ttu-id="d32d1-126">Se especificar um local personalizado, você será responsável pela limpeza de diretórios e arquivos copiados quando eles não forem mais necessários.</span><span class="sxs-lookup"><span data-stu-id="d32d1-126">If you specify a custom location, you are responsible for cleaning up the directories and copied files when they are no longer needed.</span></span> <span data-ttu-id="d32d1-127">Eles não são excluídos automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d32d1-127">They are not deleted automatically.</span></span>

  <span data-ttu-id="d32d1-128">Há alguns motivos para você definir um local personalizado para arquivos de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="d32d1-128">There are a few reasons why you might want to set a custom location for shadow copied files.</span></span> <span data-ttu-id="d32d1-129">Talvez você queira definir um local personalizado para os arquivos de cópia de sombra se o aplicativo gerar uma grande quantidade de cópias.</span><span class="sxs-lookup"><span data-stu-id="d32d1-129">You might want to set a custom location for shadow copied files if your application generates a large number of copies.</span></span> <span data-ttu-id="d32d1-130">O cache de download tem um limite de tamanho, não de tempo de vida, portanto, é possível que o common language runtime tente excluir um arquivo que ainda está em uso.</span><span class="sxs-lookup"><span data-stu-id="d32d1-130">The download cache is limited by size, not by lifetime, so it is possible that the common language runtime will attempt to delete a file that is still in use.</span></span> <span data-ttu-id="d32d1-131">Outro motivo para definir um local personalizado é quando os usuários que estão executando seu aplicativo não tiverem acesso de gravação ao local do diretório usado pelo common language runtime para o cache de download.</span><span class="sxs-lookup"><span data-stu-id="d32d1-131">Another reason to set a custom location is when users running your application do not have write access to the directory location the common language runtime uses for the download cache.</span></span>

- <span data-ttu-id="d32d1-132">Opcionalmente, limite os assemblies dos quais é realizada a cópia de sombra usando a propriedade <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="d32d1-132">Optionally limit the assemblies that are shadow copied by using the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span>

  <span data-ttu-id="d32d1-133">Quando você habilita a cópia de sombra para um domínio do aplicativo, o padrão é copiar todos os assemblies no caminho do aplicativo — ou seja, nos diretórios especificados pelas propriedades <xref:System.AppDomainSetup.ApplicationBase%2A> e <xref:System.AppDomainSetup.PrivateBinPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="d32d1-133">When you enable shadow copying for an application domain, the default is to copy all assemblies in the application path — that is, in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties.</span></span> <span data-ttu-id="d32d1-134">Você pode limitar a cópia aos diretórios selecionados criando uma cadeia de caracteres que contém apenas os diretórios dos quais deseja realizar a cópia de sombra e atribuindo a cadeia de caracteres à propriedade <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="d32d1-134">You can limit the copying to selected directories by creating a string that contains only those directories you want to shadow copy, and assigning the string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span> <span data-ttu-id="d32d1-135">Separe os diretórios com ponto e vírgula.</span><span class="sxs-lookup"><span data-stu-id="d32d1-135">Separate the directories with semicolons.</span></span> <span data-ttu-id="d32d1-136">Os únicos assemblies dos quais são feitas cópias de sombra são aqueles nas pastas selecionadas.</span><span class="sxs-lookup"><span data-stu-id="d32d1-136">The only assemblies that are shadow copied are the ones in the selected directories.</span></span>

  > [!NOTE]
  > <span data-ttu-id="d32d1-137">Se você não atribuir uma cadeia de caracteres à propriedade <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> ou se definir essa propriedade como `null`, será feita a cópia de sombra de todos os assemblies nos diretórios especificados pelas propriedades <xref:System.AppDomainSetup.ApplicationBase%2A> e <xref:System.AppDomainSetup.PrivateBinPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="d32d1-137">If you don’t assign a string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property, or if you set this property to `null`, all assemblies in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties are shadow copied.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="d32d1-138">Os caminhos de diretório não devem conter ponto e vírgula, pois esse é o caractere delimitador.</span><span class="sxs-lookup"><span data-stu-id="d32d1-138">Directory paths must not contain semicolons, because the semicolon is the delimiter character.</span></span> <span data-ttu-id="d32d1-139">Não há nenhum caractere de escape para ponto e vírgula.</span><span class="sxs-lookup"><span data-stu-id="d32d1-139">There is no escape character for semicolons.</span></span>

<a name="StartupPerformance"></a>

## <a name="startup-performance"></a><span data-ttu-id="d32d1-140">Desempenho da Inicialização</span><span class="sxs-lookup"><span data-stu-id="d32d1-140">Startup Performance</span></span>

<span data-ttu-id="d32d1-141">Quando um domínio de aplicativo que usa a cópia de sombra for iniciado, haverá um atraso durante a cópia dos assemblies do diretório do aplicativo para o diretório de cópia de sombra, ou durante a verificação se eles já estão no local.</span><span class="sxs-lookup"><span data-stu-id="d32d1-141">When an application domain that uses shadow copying starts, there is a delay while assemblies in the application directory are copied to the shadow copy directory, or verified if they are already in that location.</span></span> <span data-ttu-id="d32d1-142">Antes do .NET Framework 4, todos os assemblies eram copiados para um diretório temporário.</span><span class="sxs-lookup"><span data-stu-id="d32d1-142">Before the .NET Framework 4, all assemblies were copied to a temporary directory.</span></span> <span data-ttu-id="d32d1-143">Cada assembly era aberto para verificar o nome do assembly, e o nome forte era validado.</span><span class="sxs-lookup"><span data-stu-id="d32d1-143">Each assembly was opened to verify the assembly name, and the strong name was validated.</span></span> <span data-ttu-id="d32d1-144">Cada assembly era analisado para ver se havia sido atualizado mais recentemente do que a cópia no diretório de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="d32d1-144">Each assembly was checked to see whether it had been updated more recently than the copy in the shadow copy directory.</span></span> <span data-ttu-id="d32d1-145">Nesse caso, ele foi copiado para o diretório de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="d32d1-145">If so, it was copied to the shadow copy directory.</span></span> <span data-ttu-id="d32d1-146">Por fim, as cópias temporárias eram descartadas.</span><span class="sxs-lookup"><span data-stu-id="d32d1-146">Finally, the temporary copies were discarded.</span></span>

<span data-ttu-id="d32d1-147">Do .NET Framework 4 em diante, o comportamento de inicialização padrão é comparar diretamente a data e hora do arquivo de cada assembly no diretório de aplicativo com a data e hora do arquivo da cópia no diretório de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="d32d1-147">Beginning with the .NET Framework 4, the default startup behavior is to directly compare the file date and time of each assembly in the application directory with the file date and time of the copy in the shadow copy directory.</span></span> <span data-ttu-id="d32d1-148">Se o assembly tiver sido atualizado, ele será copiado usando o mesmo procedimento das versões anteriores do .NET Framework; caso contrário, a cópia no diretório de cópia de sombra será carregada.</span><span class="sxs-lookup"><span data-stu-id="d32d1-148">If the assembly has been updated, it is copied by using the same procedure as in earlier versions of the .NET Framework; otherwise, the copy in the shadow copy directory is loaded.</span></span>

<span data-ttu-id="d32d1-149">A melhoria no desempenho resultante é maior para aplicativos nos quais os assemblies não são alterados com frequência, e as alterações normalmente ocorrem em um pequeno subconjunto dos assemblies.</span><span class="sxs-lookup"><span data-stu-id="d32d1-149">The resulting performance improvement is largest for applications in which assemblies do not change frequently and changes usually occur in a small subset of assemblies.</span></span> <span data-ttu-id="d32d1-150">Se a maioria dos assemblies em um aplicativo mudar com frequência, o novo comportamento padrão poderá causar uma regressão do desempenho.</span><span class="sxs-lookup"><span data-stu-id="d32d1-150">If a majority of assemblies in an application change frequently, the new default behavior might cause a performance regression.</span></span> <span data-ttu-id="d32d1-151">Você pode restaurar o comportamento de inicialização de versões anteriores do .NET Framework adicionando o [ \<elemento shadowCopyVerifyByTimestamp>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) ao arquivo de configuração, com `enabled="false"`.</span><span class="sxs-lookup"><span data-stu-id="d32d1-151">You can restore the startup behavior of previous versions of the .NET Framework by adding the [\<shadowCopyVerifyByTimestamp> element](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) to the configuration file, with `enabled="false"`.</span></span>

<a name="ObsoleteMethods"></a>

## <a name="obsolete-methods"></a><span data-ttu-id="d32d1-152">Métodos obsoletos</span><span class="sxs-lookup"><span data-stu-id="d32d1-152">Obsolete Methods</span></span>

<span data-ttu-id="d32d1-153">A classe <xref:System.AppDomain> tem vários métodos, como <xref:System.AppDomain.SetShadowCopyFiles%2A> e <xref:System.AppDomain.ClearShadowCopyPath%2A>, que podem ser usados para controlar a cópia de sombra em um domínio do aplicativo, mas eles foram marcados como obsoletos no .NET Framework versão 2.0.</span><span class="sxs-lookup"><span data-stu-id="d32d1-153">The <xref:System.AppDomain> class has several methods, such as <xref:System.AppDomain.SetShadowCopyFiles%2A> and <xref:System.AppDomain.ClearShadowCopyPath%2A>, that can be used to control shadow copying on an application domain, but these have been marked obsolete in the .NET Framework version 2.0.</span></span> <span data-ttu-id="d32d1-154">A maneira recomendada de configurar um domínio do aplicativo para a cópia de sombra é usar as propriedades da classe <xref:System.AppDomainSetup>.</span><span class="sxs-lookup"><span data-stu-id="d32d1-154">The recommended way to configure an application domain for shadow copying is to use the properties of the <xref:System.AppDomainSetup> class.</span></span>

## <a name="see-also"></a><span data-ttu-id="d32d1-155">Confira também</span><span class="sxs-lookup"><span data-stu-id="d32d1-155">See also</span></span>

- <xref:System.AppDomainSetup.ShadowCopyFiles%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.CachePath%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ApplicationName%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ShadowCopyDirectories%2A?displayProperty=nameWithType>
- [<span data-ttu-id="d32d1-156">\<Elemento de> shadowCopyVerifyByTimestamp</span><span class="sxs-lookup"><span data-stu-id="d32d1-156">\<shadowCopyVerifyByTimestamp> Element</span></span>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md)
