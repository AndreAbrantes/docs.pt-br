---
title: 'Como: Receber notificações de exceção de primeira tentativa'
description: Obtenha notificações de exceção de primeira chance no .NET por meio do evento FirstChanceException da classe AppDomain, antes que o CLR pesquise manipuladores de exceção.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- first-chance exception notifications
- exceptions, first chance notifications
ms.assetid: 66f002b8-a97d-4a6e-a503-2cec01689113
ms.openlocfilehash: e8b5ae5fb69c7befd329316aee11523f79d73fcd
ms.sourcegitcommit: 1c37a894c923bea021a3cc38ce7cba946357bbe1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/19/2020
ms.locfileid: "85104735"
---
# <a name="how-to-receive-first-chance-exception-notifications"></a><span data-ttu-id="97853-103">Como: Receber notificações de exceção de primeira tentativa</span><span class="sxs-lookup"><span data-stu-id="97853-103">How to: Receive First-Chance Exception Notifications</span></span>
<span data-ttu-id="97853-104">O evento <xref:System.AppDomain.FirstChanceException> da classe <xref:System.AppDomain> permite que você receba uma notificação de que uma exceção foi lançada, antes de o Common Language Runtime começar a procurar por manipuladores de exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-104">The <xref:System.AppDomain.FirstChanceException> event of the <xref:System.AppDomain> class lets you receive a notification that an exception has been thrown, before the common language runtime has begun searching for exception handlers.</span></span>

 <span data-ttu-id="97853-105">O evento é gerado no nível de domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="97853-105">The event is raised at the application domain level.</span></span> <span data-ttu-id="97853-106">Um thread de execução pode passar por vários domínios de aplicativo, assim, uma exceção não tratada em um domínio de aplicativo poderia ser tratada em outro domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="97853-106">A thread of execution can pass through multiple application domains, so an exception that is unhandled in one application domain could be handled in another application domain.</span></span> <span data-ttu-id="97853-107">A notificação ocorre em cada domínio de aplicativo que tenha adicionado um manipulador para o evento, até que um domínio de aplicativo lide com a exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-107">The notification occurs in each application domain that has added a handler for the event, until an application domain handles the exception.</span></span>

 <span data-ttu-id="97853-108">Os procedimentos e os exemplos neste artigo mostram como receber notificações de exceções de primeira tentativa em um programa simples que tem um domínio de aplicativo, e em um domínio de aplicativo que você criar.</span><span class="sxs-lookup"><span data-stu-id="97853-108">The procedures and examples in this article show how to receive first-chance exception notifications in a simple program that has one application domain, and in an application domain that you create.</span></span>

 <span data-ttu-id="97853-109">Para obter um exemplo mais complexo que abrange vários domínios de aplicativo, veja o exemplo para o evento <xref:System.AppDomain.FirstChanceException>.</span><span class="sxs-lookup"><span data-stu-id="97853-109">For a more complex example that spans several application domains, see the example for the <xref:System.AppDomain.FirstChanceException> event.</span></span>

## <a name="receiving-first-chance-exception-notifications-in-the-default-application-domain"></a><span data-ttu-id="97853-110">Receber notificações de exceção de primeira tentativa no Domínio do aplicativo padrão</span><span class="sxs-lookup"><span data-stu-id="97853-110">Receiving First-Chance Exception Notifications in the Default Application Domain</span></span>
 <span data-ttu-id="97853-111">No procedimento a seguir, o ponto de entrada para o aplicativo, o método `Main()`, é executado no domínio do aplicativo padrão.</span><span class="sxs-lookup"><span data-stu-id="97853-111">In the following procedure, the entry point for the application, the `Main()` method, runs in the default application domain.</span></span>

#### <a name="to-demonstrate-first-chance-exception-notifications-in-the-default-application-domain"></a><span data-ttu-id="97853-112">Para demonstrar notificações de exceção de primeira tentativa no domínio do aplicativo padrão</span><span class="sxs-lookup"><span data-stu-id="97853-112">To demonstrate first-chance exception notifications in the default application domain</span></span>

1. <span data-ttu-id="97853-113">Defina um manipulador de eventos para o evento <xref:System.AppDomain.FirstChanceException> usando uma função lambda e anexe-o ao evento.</span><span class="sxs-lookup"><span data-stu-id="97853-113">Define an event handler for the <xref:System.AppDomain.FirstChanceException> event, using a lambda function, and attach it to the event.</span></span> <span data-ttu-id="97853-114">Neste exemplo, o manipulador de eventos imprime o nome do domínio do aplicativo no qual o evento foi tratado e a propriedade <xref:System.Exception.Message%2A> da exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-114">In this example, the event handler prints the name of the application domain where the event was handled and the exception's <xref:System.Exception.Message%2A> property.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#2)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#2)]

2. <span data-ttu-id="97853-115">Gere uma exceção e capture-a.</span><span class="sxs-lookup"><span data-stu-id="97853-115">Throw an exception and catch it.</span></span> <span data-ttu-id="97853-116">Antes de o runtime localizar o manipulador de exceção, o evento <xref:System.AppDomain.FirstChanceException> é gerado e exibe uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="97853-116">Before the runtime locates the exception handler, the <xref:System.AppDomain.FirstChanceException> event is raised and displays a message.</span></span> <span data-ttu-id="97853-117">Essa mensagem é seguida pela mensagem exibida pelo manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-117">This message is followed by the message that is displayed by the exception handler.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#3)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#3)]

3. <span data-ttu-id="97853-118">Gere uma exceção, mas não a capture.</span><span class="sxs-lookup"><span data-stu-id="97853-118">Throw an exception, but do not catch it.</span></span> <span data-ttu-id="97853-119">Antes de o runtime procurar o manipulador de exceção, o evento <xref:System.AppDomain.FirstChanceException> é gerado e exibe uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="97853-119">Before the runtime looks for an exception handler, the <xref:System.AppDomain.FirstChanceException> event is raised and displays a message.</span></span> <span data-ttu-id="97853-120">Não há um manipulador de exceções, portanto, o aplicativo será encerrado.</span><span class="sxs-lookup"><span data-stu-id="97853-120">There is no exception handler, so the application terminates.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#4)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#4)]

     <span data-ttu-id="97853-121">O código que é mostrado nas três primeiras etapas deste procedimento forma um aplicativo de console completo.</span><span class="sxs-lookup"><span data-stu-id="97853-121">The code that is shown in the first three steps of this procedure forms a complete console application.</span></span> <span data-ttu-id="97853-122">A saída do aplicativo varia, dependendo do nome do arquivo .exe, pois o nome do domínio do aplicativo padrão é formado pelo nome e pela extensão do arquivo .exe.</span><span class="sxs-lookup"><span data-stu-id="97853-122">The output from the application varies, depending on the name of the .exe file, because the name of the default application domain consists of the name and extension of the .exe file.</span></span> <span data-ttu-id="97853-123">Veja o seguinte para a saída de exemplo.</span><span class="sxs-lookup"><span data-stu-id="97853-123">See the following for sample output.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#5)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#5)]

## <a name="receiving-first-chance-exception-notifications-in-another-application-domain"></a><span data-ttu-id="97853-124">Receber notificações de exceção de primeira tentativa em outro Domínio do aplicativo</span><span class="sxs-lookup"><span data-stu-id="97853-124">Receiving First-Chance Exception Notifications in Another Application Domain</span></span>
 <span data-ttu-id="97853-125">Se seu programa contiver mais de um domínio de aplicativo, escolha quais domínios de aplicativo recebem notificações.</span><span class="sxs-lookup"><span data-stu-id="97853-125">If your program contains more than one application domain, you can choose which application domains receive notifications.</span></span>

#### <a name="to-receive-first-chance-exception-notifications-in-an-application-domain-that-you-create"></a><span data-ttu-id="97853-126">Para receber notificações de exceção de primeira tentativa em outro Domínio do aplicativo criado por você</span><span class="sxs-lookup"><span data-stu-id="97853-126">To receive first-chance exception notifications in an application domain that you create</span></span>

1. <span data-ttu-id="97853-127">Defina um manipulador de eventos para o evento <xref:System.AppDomain.FirstChanceException>.</span><span class="sxs-lookup"><span data-stu-id="97853-127">Define an event handler for the <xref:System.AppDomain.FirstChanceException> event.</span></span> <span data-ttu-id="97853-128">Este exemplo usa um método `static` (método `Shared` no Visual Basic) que imprime o nome do domínio do aplicativo no qual o evento foi tratado e a propriedade <xref:System.Exception.Message%2A> da exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-128">This example uses a `static` method (`Shared` method in Visual Basic) that prints the name of the application domain where the event was handled and the exception's <xref:System.Exception.Message%2A> property.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#3)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#3)]

2. <span data-ttu-id="97853-129">Crie um domínio do aplicativo e adicione o manipulador de eventos ao evento <xref:System.AppDomain.FirstChanceException> para esse domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="97853-129">Create an application domain and add the event handler to the <xref:System.AppDomain.FirstChanceException> event for that application domain.</span></span> <span data-ttu-id="97853-130">Neste exemplo, o domínio de aplicativo é chamado `AD1`.</span><span class="sxs-lookup"><span data-stu-id="97853-130">In this example, the application domain is named `AD1`.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#2)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#2)]

     <span data-ttu-id="97853-131">Você pode manipular esse evento no domínio do aplicativo padrão da mesma maneira.</span><span class="sxs-lookup"><span data-stu-id="97853-131">You can handle this event in the default application domain in the same way.</span></span> <span data-ttu-id="97853-132">Use a propriedade <xref:System.AppDomain.CurrentDomain%2A?displayProperty=nameWithType>`static` (`Shared` no Visual Basic) no `Main()` para obter uma referência para o domínio do aplicativo padrão.</span><span class="sxs-lookup"><span data-stu-id="97853-132">Use the `static` (`Shared` in Visual Basic) <xref:System.AppDomain.CurrentDomain%2A?displayProperty=nameWithType> property in `Main()` to get a reference to the default application domain.</span></span>

#### <a name="to-demonstrate-first-chance-exception-notifications-in-the-application-domain"></a><span data-ttu-id="97853-133">Para demonstrar notificações de exceção de primeira tentativa no domínio do aplicativo</span><span class="sxs-lookup"><span data-stu-id="97853-133">To demonstrate first-chance exception notifications in the application domain</span></span>

1. <span data-ttu-id="97853-134">Crie um objeto `Worker` no domínio do aplicativo que você criou no procedimento anterior.</span><span class="sxs-lookup"><span data-stu-id="97853-134">Create a `Worker` object in the application domain that you created in the previous procedure.</span></span> <span data-ttu-id="97853-135">A classe `Worker` deve ser pública e deve derivar de <xref:System.MarshalByRefObject>, conforme mostra o exemplo completo no final deste artigo.</span><span class="sxs-lookup"><span data-stu-id="97853-135">The `Worker` class must be public, and must derive from <xref:System.MarshalByRefObject>, as shown in the complete example at the end of this article.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#4)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#4)]

2. <span data-ttu-id="97853-136">Chame um método do objeto `Worker` que gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-136">Call a method of the `Worker` object that throws an exception.</span></span> <span data-ttu-id="97853-137">Nesse exemplo, o método `Thrower` é chamado duas vezes.</span><span class="sxs-lookup"><span data-stu-id="97853-137">In this example, the `Thrower` method is called twice.</span></span> <span data-ttu-id="97853-138">Na primeira vez, o argumento do método é `true`, que faz com que o método capture sua própria exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-138">The first time, the method argument is `true`, which causes the method to catch its own exception.</span></span> <span data-ttu-id="97853-139">Na segunda vez, o argumento é `false`, e o método `Main()` captura a exceção no domínio de aplicativo padrão.</span><span class="sxs-lookup"><span data-stu-id="97853-139">The second time, the argument is `false`, and the `Main()` method catches the exception in the default application domain.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#6)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#6)]

3. <span data-ttu-id="97853-140">Coloque o código no método `Thrower` para controlar se o método lida com sua própria exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-140">Place code in the `Thrower` method to control whether the method handles its own exception.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#5)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#5)]

## <a name="example"></a><span data-ttu-id="97853-141">Exemplo</span><span class="sxs-lookup"><span data-stu-id="97853-141">Example</span></span>
 <span data-ttu-id="97853-142">O exemplo a seguir cria um domínio do aplicativo chamado `AD1` e adiciona o manipulador de eventos ao evento <xref:System.AppDomain.FirstChanceException> do domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="97853-142">The following example creates an application domain named `AD1` and adds an event handler to the application domain's <xref:System.AppDomain.FirstChanceException> event.</span></span> <span data-ttu-id="97853-143">O exemplo cria uma instância da classe `Worker` no domínio do aplicativo e chama um método chamado `Thrower`, que gera uma <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="97853-143">The example creates an instance of the `Worker` class in the application domain, and calls a method named `Thrower` that throws an <xref:System.ArgumentException>.</span></span> <span data-ttu-id="97853-144">Dependendo do valor do argumento, o método captura a exceção ou não consegue lidar com ela.</span><span class="sxs-lookup"><span data-stu-id="97853-144">Depending on the value of its argument, the method either catches the exception or fails to handle it.</span></span>

 <span data-ttu-id="97853-145">Cada vez que o método `Thrower` gera uma exceção no `AD1`, o evento <xref:System.AppDomain.FirstChanceException> é gerado no `AD1` e o manipulador de eventos exibe uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="97853-145">Each time the `Thrower` method throws an exception in `AD1`, the <xref:System.AppDomain.FirstChanceException> event is raised in `AD1`, and the event handler displays a message.</span></span> <span data-ttu-id="97853-146">Em seguida, o runtime procura um manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-146">The runtime then looks for an exception handler.</span></span> <span data-ttu-id="97853-147">No primeiro caso, o manipulador de exceção é encontrado em `AD1`.</span><span class="sxs-lookup"><span data-stu-id="97853-147">In the first case, the exception handler is found in `AD1`.</span></span> <span data-ttu-id="97853-148">No segundo caso, a exceção é tratada no `AD1` e, em vez disso, é capturada no domínio do aplicativo padrão.</span><span class="sxs-lookup"><span data-stu-id="97853-148">In the second case, the exception is unhandled in `AD1`, and instead is caught in the default application domain.</span></span>

> [!NOTE]
> <span data-ttu-id="97853-149">O nome do domínio do aplicativo padrão é igual ao nome do executável.</span><span class="sxs-lookup"><span data-stu-id="97853-149">The name of the default application domain is the same as the name of the executable.</span></span>

 <span data-ttu-id="97853-150">Se você adicionar um manipulador ao evento <xref:System.AppDomain.FirstChanceException> para o domínio do aplicativo padrão, o evento será disparado e tratado antes de o domínio de aplicativo padrão lidar com a exceção.</span><span class="sxs-lookup"><span data-stu-id="97853-150">If you add a handler for the <xref:System.AppDomain.FirstChanceException> event to the default application domain, the event is raised and handled before the default application domain handles the exception.</span></span> <span data-ttu-id="97853-151">Para ver isso, adicione o código C# `AppDomain.CurrentDomain.FirstChanceException += FirstChanceException;` (no Visual Basic, `AddHandler AppDomain.CurrentDomain.FirstChanceException, FirstChanceException`) no início de `Main()`.</span><span class="sxs-lookup"><span data-stu-id="97853-151">To see this, add the C# code `AppDomain.CurrentDomain.FirstChanceException += FirstChanceException;` (in Visual Basic, `AddHandler AppDomain.CurrentDomain.FirstChanceException, FirstChanceException`) at the beginning of `Main()`.</span></span>

 [!code-csharp[System.AppDomain.FirstChanceException_howto#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#1)]
 [!code-vb[System.AppDomain.FirstChanceException_howto#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#1)]

## <a name="see-also"></a><span data-ttu-id="97853-152">Confira também</span><span class="sxs-lookup"><span data-stu-id="97853-152">See also</span></span>

- <xref:System.AppDomain.FirstChanceException>
