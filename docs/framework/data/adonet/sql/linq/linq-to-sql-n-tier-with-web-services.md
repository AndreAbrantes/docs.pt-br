---
title: LINQ to SQL de n camadas com serviços da Web
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 7b13a0cd77925423a12c093b1b5ac9b63ad7e019
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "62033522"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a><span data-ttu-id="9d528-102">LINQ to SQL de n camadas com serviços da Web</span><span class="sxs-lookup"><span data-stu-id="9d528-102">LINQ to SQL N-Tier with Web Services</span></span>
[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="9d528-103">é projetado principalmente para uso na camada intermediária em uma camada de acesso de dados flexível (DAL) como um serviço Web.</span><span class="sxs-lookup"><span data-stu-id="9d528-103">is designed especially for use on the middle tier in a loosely-coupled data access layer (DAL) such as a Web service.</span></span> <span data-ttu-id="9d528-104">Se a camada de apresentação é uma página da Web ASP.NET, então você usa o controle de servidor Web de <xref:System.Web.UI.WebControls.LinqDataSource> para gerenciar a transferência de dados entre a interface do usuário e [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] na camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="9d528-104">If the presentation tier is an ASP.NET Web page, then you use the <xref:System.Web.UI.WebControls.LinqDataSource> Web server control to manage the data transfer between the user interface and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] on the middle-tier.</span></span> <span data-ttu-id="9d528-105">Se a camada de apresentação não é uma página ASP.NET, então a camada intermediária e a camada de apresentação devem fazer qualquer trabalho adicional para gerenciar serialização e desserialização de dados.</span><span class="sxs-lookup"><span data-stu-id="9d528-105">If the presentation tier is not an ASP.NET page, then both the middle-tier and the presentation tier must do some additional work to manage the serialization and deserialization of data.</span></span>  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a><span data-ttu-id="9d528-106">Foundation LINQ to SQL na camada intermediária</span><span class="sxs-lookup"><span data-stu-id="9d528-106">Setting up LINQ to SQL on the Middle Tier</span></span>  
 <span data-ttu-id="9d528-107">Em um serviço Web ou em um aplicativo de n camadas, a camada intermediária contém o contexto de dados e classes de entidade.</span><span class="sxs-lookup"><span data-stu-id="9d528-107">In a Web service or n-tier application, the middle tier contains the data context and the entity classes.</span></span> <span data-ttu-id="9d528-108">Você pode criar essas classes manualmente, ou usando SQLMetal.exe ou [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)] como descrito em outro lugar na documentação.</span><span class="sxs-lookup"><span data-stu-id="9d528-108">You can create these classes manually, or by using either SQLMetal.exe or the [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)] as described elsewhere in the documentation.</span></span> <span data-ttu-id="9d528-109">Em tempo de design, você tem a opção fazer as classes de entidade serializável.</span><span class="sxs-lookup"><span data-stu-id="9d528-109">At design time, you have the option to make the entity classes serializable.</span></span> <span data-ttu-id="9d528-110">Para obter mais informações, confira [Como: Tornar entidades serializáveis](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md).</span><span class="sxs-lookup"><span data-stu-id="9d528-110">For more information, see [How to: Make Entities Serializable](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md).</span></span> <span data-ttu-id="9d528-111">Outra opção é criar um conjunto separado de classes que encapsulam os dados a ser serializados, e em projetos nesses tipos serializados quando você retorna dados nas consultas de [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9d528-111">Another option is to create a separate set of classes that encapsulate the data to be serialized, and then project into those serializable types when you return data in your [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] queries.</span></span>  
  
 <span data-ttu-id="9d528-112">Você então define a interface com métodos que os clientes chamarão para recuperar, inserir e atualizar dados.</span><span class="sxs-lookup"><span data-stu-id="9d528-112">You then define the interface with the methods that the clients will call to retrieve, insert and update data.</span></span> <span data-ttu-id="9d528-113">Os métodos de interface envolvem as consultas de [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9d528-113">The interface methods wrap your [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] queries.</span></span> <span data-ttu-id="9d528-114">Você pode usar qualquer tipo de mecanismo de serialização para manipular chamadas remotos do método e serialização de dados.</span><span class="sxs-lookup"><span data-stu-id="9d528-114">You can use any kind of serialization mechanism to handle the remote method calls and the serialization of data.</span></span> <span data-ttu-id="9d528-115">O único requisito é que se você tiver relações cíclicas ou bidirecionais no seu modelo de objeto, tal como aquela entre clientes e pedidos no modelo de objeto padrão do Northwind, então você deve usar um serializador que ofereça.</span><span class="sxs-lookup"><span data-stu-id="9d528-115">The only requirement is that if you have cyclic or bi-directional relationships in your object model, such as that between Customers and Orders in the standard Northwind object model, then you must use a serializer that supports it.</span></span> <span data-ttu-id="9d528-116">O Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> dá suporte a relações de bi-direcional, mas o XmlSerializer que é usado com os serviços não WCF Web não faz isso.</span><span class="sxs-lookup"><span data-stu-id="9d528-116">The Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> supports bi-directional relationships but the XmlSerializer that is used with non-WCF Web services does not.</span></span> <span data-ttu-id="9d528-117">Se você optar por usar o XmlSerializer, em seguida, certifique-se de que seu modelo de objeto não tem nenhuma relação cíclica.</span><span class="sxs-lookup"><span data-stu-id="9d528-117">If you select to use the XmlSerializer, then you must make sure that your object model has no cyclic relationships.</span></span>  
  
 <span data-ttu-id="9d528-118">Para obter mais informações sobre o Windows Communication Foundation, consulte [serviços do Windows Communication Foundation e WCF Data Services no Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="9d528-118">For more information about Windows Communication Foundation, see [Windows Communication Foundation Services and WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span></span>  
  
 <span data-ttu-id="9d528-119">Implemente suas regras comerciais ou outra lógica específica de domínio usando as classes e métodos parciais em <xref:System.Data.Linq.DataContext> e classes de entidade para ligar em eventos em tempo de execução de [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9d528-119">Implement your business rules or other domain-specific logic by using the partial classes and methods on the <xref:System.Data.Linq.DataContext> and entity classes to hook into [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] runtime events.</span></span> <span data-ttu-id="9d528-120">Para obter mais informações, consulte [implementando lógica de negócios de N camadas](../../../../../../docs/framework/data/adonet/sql/linq/implementing-business-logic-linq-to-sql.md).</span><span class="sxs-lookup"><span data-stu-id="9d528-120">For more information, see [Implementing N-Tier Business Logic](../../../../../../docs/framework/data/adonet/sql/linq/implementing-business-logic-linq-to-sql.md).</span></span>  
  
## <a name="defining-the-serializable-types"></a><span data-ttu-id="9d528-121">Definindo tipos Serializable</span><span class="sxs-lookup"><span data-stu-id="9d528-121">Defining the Serializable Types</span></span>  
 <span data-ttu-id="9d528-122">O cliente ou a camada de apresentação devem ter definições de tipo para as classes que será recebendo de camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="9d528-122">The client or presentation tier must have type definitions for the classes that it will be receiving from the middle tier.</span></span> <span data-ttu-id="9d528-123">Esses tipos podem ser a entidade classificam-se, ou classes especiais que envolvem apenas determinados campos de entidade classe remoting.</span><span class="sxs-lookup"><span data-stu-id="9d528-123">Those types may be the entity classes themselves, or special classes that wrap only certain fields from the entity classes for remoting.</span></span> <span data-ttu-id="9d528-124">Em qualquer caso, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] é completamente indiferente sobre como a camada de apresentação obtém essas definições de tipo.</span><span class="sxs-lookup"><span data-stu-id="9d528-124">In any case, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] is completely unconcerned about how the presentation tier acquires those type definitions.</span></span> <span data-ttu-id="9d528-125">Por exemplo, a camada de apresentação pode usar WCF para gerar automaticamente os tipos, ou pode ter uma cópia de uma DLL em que esses tipos são definidos, ou pode apenas definir suas próprias versões de tipos.</span><span class="sxs-lookup"><span data-stu-id="9d528-125">For example, the presentation tier could use WCF to generate the types automatically, or it could have a copy of a DLL in which those types are defined, or it could just define its own versions of the types.</span></span>  
  
## <a name="retrieving-and-inserting-data"></a><span data-ttu-id="9d528-126">Recuperando e inserindo dados</span><span class="sxs-lookup"><span data-stu-id="9d528-126">Retrieving and Inserting Data</span></span>  
 <span data-ttu-id="9d528-127">A camada intermediária define uma interface que especifica como a camada de apresentação acessa os dados.</span><span class="sxs-lookup"><span data-stu-id="9d528-127">The middle tier defines an interface that specifies how the presentation tier accesses the data.</span></span> <span data-ttu-id="9d528-128">Por exemplo `GetProductByID(int productID)`, ou `GetCustomers()`.</span><span class="sxs-lookup"><span data-stu-id="9d528-128">For example `GetProductByID(int productID)`, or `GetCustomers()`.</span></span> <span data-ttu-id="9d528-129">Na camada intermediária, o corpo do método normalmente cria uma nova instância de <xref:System.Data.Linq.DataContext>, executa uma consulta em uma ou mais da tabela.</span><span class="sxs-lookup"><span data-stu-id="9d528-129">On the middle tier, the method body typically creates a new instance of the <xref:System.Data.Linq.DataContext>, executes a query against one or more of its table.</span></span> <span data-ttu-id="9d528-130">A camada intermediária então retorna o resultado como <xref:System.Collections.Generic.IEnumerable%601>, onde `T` é uma classe de entidade ou outro tipo que é usado para serialização.</span><span class="sxs-lookup"><span data-stu-id="9d528-130">The middle tier then returns the result as an <xref:System.Collections.Generic.IEnumerable%601>, where `T` is either an entity class or another type that is used for serialization.</span></span> <span data-ttu-id="9d528-131">A camada de apresentação nunca envia ou recebe variáveis de consulta diretamente ou da camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="9d528-131">The presentation tier never sends or receives query variables directly to or from the middle tier.</span></span> <span data-ttu-id="9d528-132">Os dois valores de troca de camadas, objetos, e coleções de dados concretos.</span><span class="sxs-lookup"><span data-stu-id="9d528-132">The two tiers exchange values, objects, and collections of concrete data.</span></span> <span data-ttu-id="9d528-133">Depois que recebeu uma coleção, a camada de apresentação pode usar [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] a objetos para ver se necessário.</span><span class="sxs-lookup"><span data-stu-id="9d528-133">After it has received a collection, the presentation tier can use [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects to query it if necessary.</span></span>  
  
 <span data-ttu-id="9d528-134">Para inserir dados, a camada de apresentação pode criar um novo objeto e enviá-lo para a camada intermediária, ou pode fazer com que a camada intermediária criar o objeto com base nos valores que fornece.</span><span class="sxs-lookup"><span data-stu-id="9d528-134">When inserting data, the presentation tier can construct a new object and send it to the middle tier, or it can have the middle tier construct the object based on values that it provides.</span></span> <span data-ttu-id="9d528-135">Em geral, recuperar e inserir dados em aplicativos n-tier não difere do processo muito 2 em aplicativos de camada.</span><span class="sxs-lookup"><span data-stu-id="9d528-135">In general, retrieving and inserting data in n-tier applications does not differ much from the process in 2-tier applications.</span></span> <span data-ttu-id="9d528-136">Para obter mais informações, consulte [consulta o banco de dados](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md) e [tomada e enviando alterações de dados](../../../../../../docs/framework/data/adonet/sql/linq/making-and-submitting-data-changes.md).</span><span class="sxs-lookup"><span data-stu-id="9d528-136">For more information, see [Querying the Database](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md) and [Making and Submitting Data Changes](../../../../../../docs/framework/data/adonet/sql/linq/making-and-submitting-data-changes.md).</span></span>  
  
## <a name="tracking-changes-for-updates-and-deletes"></a><span data-ttu-id="9d528-137">Controlar alterações para atualizações e exclusões</span><span class="sxs-lookup"><span data-stu-id="9d528-137">Tracking Changes for Updates and Deletes</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="9d528-138">suporta concorrência otimista com base nos carimbos de data/hora (também chamados RowVersions) e valores originais.</span><span class="sxs-lookup"><span data-stu-id="9d528-138">supports optimistic concurrency based on timestamps (also named RowVersions) and on original values.</span></span> <span data-ttu-id="9d528-139">Se as tabelas de base de dados têm carimbos de data/hora, então atualizações e exclusões exigem vez trabalho adicional na camada intermediária na camada de apresentação.</span><span class="sxs-lookup"><span data-stu-id="9d528-139">If the database tables have timestamps, then updates and deletions require little extra work on either the middle-tier or presentation tier.</span></span> <span data-ttu-id="9d528-140">Entretanto, se você deve usar valores originais para verificação de simultaneidade otimista, então a camada de apresentação é responsável para controlar os valores e enviá-los novamente quando fazer atualizações.</span><span class="sxs-lookup"><span data-stu-id="9d528-140">However, if you must use original values for optimistic concurrency checks, then the presentation tier is responsible for tracking those values and sending them back when it makes updates.</span></span> <span data-ttu-id="9d528-141">Isso ocorre porque as alterações que foram feitas às entidades na camada de apresentação não são controladas na camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="9d528-141">This is because changes that were made to entities on the presentation tier are not tracked on the middle tier.</span></span> <span data-ttu-id="9d528-142">De fato, a recuperação original de uma entidade, e a atualização feita a eventual ele normalmente são executadas por duas instâncias separadas de <xref:System.Data.Linq.DataContext>completamente.</span><span class="sxs-lookup"><span data-stu-id="9d528-142">In fact, the original retrieval of an entity, and the eventual update made to it are typically performed by two completely separate instances of the <xref:System.Data.Linq.DataContext>.</span></span>  
  
 <span data-ttu-id="9d528-143">Maior o número de alterações que a camada de apresentação isso, ele fica mais complexa para controlar as alterações e para empacotar-las de volta para a camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="9d528-143">The greater the number of changes that the presentation tier makes, the more complex it becomes to track those changes and package them back to the middle tier.</span></span> <span data-ttu-id="9d528-144">A implementação de um mecanismo para alterações de comunicação é completamente até o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9d528-144">The implementation of a mechanism for communicating changes is completely up to the application.</span></span> <span data-ttu-id="9d528-145">O único requisito é que [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] deve ser fornecido os valores originais que são necessários para verificação de simultaneidade otimista.</span><span class="sxs-lookup"><span data-stu-id="9d528-145">The only requirement is that [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] must be given those original values that are required for optimistic concurrency checks.</span></span>  
  
 <span data-ttu-id="9d528-146">Para obter mais informações, consulte [recuperação de dados e operações de CUD em aplicativos de N camadas (LINQ to SQL)](../../../../../../docs/framework/data/adonet/sql/linq/data-retrieval-and-cud-operations-in-n-tier-applications.md).</span><span class="sxs-lookup"><span data-stu-id="9d528-146">For more information, see [Data Retrieval and CUD Operations in N-Tier Applications (LINQ to SQL)](../../../../../../docs/framework/data/adonet/sql/linq/data-retrieval-and-cud-operations-in-n-tier-applications.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9d528-147">Consulte também</span><span class="sxs-lookup"><span data-stu-id="9d528-147">See also</span></span>

- [<span data-ttu-id="9d528-148">Aplicativos de N camadas e remotos com o LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="9d528-148">N-Tier and Remote Applications with LINQ to SQL</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/n-tier-and-remote-applications-with-linq-to-sql.md)
- <span data-ttu-id="9d528-149">[Visão geral do controle de servidor Web LinqDataSource](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="9d528-149">[LinqDataSource Web Server Control Overview](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))</span></span>
