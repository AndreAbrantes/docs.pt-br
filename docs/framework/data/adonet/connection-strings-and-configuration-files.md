---
title: "Cadeias de conexão e arquivos de configuração"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 37df2641-661e-407a-a3fb-7bf9540f01e8
caps.latest.revision: "4"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: dotnet
ms.openlocfilehash: 87406da2c591f9f3a8f47adb2029bf1e239cc64e
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="connection-strings-and-configuration-files"></a><span data-ttu-id="de1a8-102">Cadeias de conexão e arquivos de configuração</span><span class="sxs-lookup"><span data-stu-id="de1a8-102">Connection Strings and Configuration Files</span></span>
<span data-ttu-id="de1a8-103">Inserir cadeias de conexão no código do seu aplicativo pode resultar em vulnerabilidades de segurança e problemas de manutenção.</span><span class="sxs-lookup"><span data-stu-id="de1a8-103">Embedding connection strings in your application's code can lead to security vulnerabilities and maintenance problems.</span></span> <span data-ttu-id="de1a8-104">Cadeias de caracteres de conexão não criptografada compiladas em código-fonte do aplicativo podem ser exibidas usando o [Ildasm.exe (IL Disassembler)](../../../../docs/framework/tools/ildasm-exe-il-disassembler.md) ferramenta.</span><span class="sxs-lookup"><span data-stu-id="de1a8-104">Unencrypted connection strings compiled into an application's source code can be viewed using the [Ildasm.exe (IL Disassembler)](../../../../docs/framework/tools/ildasm-exe-il-disassembler.md) tool.</span></span> <span data-ttu-id="de1a8-105">Além disso, se a cadeia de conexão for alterada, seu aplicativo deverá ser recompilado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-105">Moreover, if the connection string ever changes, your application must be recompiled.</span></span> <span data-ttu-id="de1a8-106">Por esses motivos, recomendamos armazenar cadeias de conexão em um arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-106">For these reasons, we recommend storing connection strings in an application configuration file.</span></span>  
  
## <a name="working-with-application-configuration-files"></a><span data-ttu-id="de1a8-107">Trabalhando com arquivos de configuração de aplicativo</span><span class="sxs-lookup"><span data-stu-id="de1a8-107">Working with Application Configuration Files</span></span>  
 <span data-ttu-id="de1a8-108">Os arquivos de configuração do aplicativo contêm as configurações que são específicas para um determinado aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-108">Application configuration files contain settings that are specific to a particular application.</span></span> <span data-ttu-id="de1a8-109">Por exemplo, um aplicativo ASP.NET pode ter um ou mais **Web. config** arquivos e um aplicativo do Windows podem ter um opcional **App. config** arquivo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-109">For example, an ASP.NET application can have one or more **web.config** files, and a Windows application can have an optional **app.config** file.</span></span> <span data-ttu-id="de1a8-110">Os arquivos de configuração compartilham elementos comuns, embora o nome e o local de um arquivo de configuração variem dependendo do host do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-110">Configuration files share common elements, although the name and location of a configuration file vary depending on the application's host.</span></span>  
  
### <a name="the-connectionstrings-section"></a><span data-ttu-id="de1a8-111">A seção de connectionStrings</span><span class="sxs-lookup"><span data-stu-id="de1a8-111">The connectionStrings Section</span></span>  
 <span data-ttu-id="de1a8-112">Cadeias de caracteres de Conexão podem ser armazenadas como pares chave/valor no **connectionStrings** seção o **configuração** elemento de um arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-112">Connection strings can be stored as key/value pairs in the **connectionStrings** section of the **configuration** element of an application configuration file.</span></span> <span data-ttu-id="de1a8-113">Elementos filho incluem **adicionar**, **limpar**, e **remover**.</span><span class="sxs-lookup"><span data-stu-id="de1a8-113">Child elements include **add**, **clear**, and **remove**.</span></span>  
  
 <span data-ttu-id="de1a8-114">O fragmento de arquivo de configuração a seguir demonstra o esquema e a sintaxe para armazenar uma cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="de1a8-114">The following configuration file fragment demonstrates the schema and syntax for storing a connection string.</span></span> <span data-ttu-id="de1a8-115">O **nome** atributo é um nome que você fornecer para identificar exclusivamente uma cadeia de caracteres de conexão para que ele possa ser recuperado em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="de1a8-115">The **name** attribute is a name that you provide to uniquely identify a connection string so that it can be retrieved at run time.</span></span> <span data-ttu-id="de1a8-116">O **providerName** é o nome invariável do provedor de dados do .NET Framework, que é registrado no arquivo Machine. config.</span><span class="sxs-lookup"><span data-stu-id="de1a8-116">The **providerName** is the invariant name of the .NET Framework data provider, which is registered in the machine.config file.</span></span>  
  
```xml  
<?xml version='1.0' encoding='utf-8'?>  
  <configuration>  
    <connectionStrings>  
      <clear />  
      <add name="Name"   
       providerName="System.Data.ProviderName"   
       connectionString="Valid Connection String;" />  
    </connectionStrings>  
  </configuration>  
```  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-117">Você pode salvar parte de uma cadeia de conexão em um arquivo de configuração e usar a classe <xref:System.Data.Common.DbConnectionStringBuilder> para concluí-la em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="de1a8-117">You can save part of a connection string in a configuration file and use the <xref:System.Data.Common.DbConnectionStringBuilder> class to complete it at run time.</span></span> <span data-ttu-id="de1a8-118">Isso é útil em situações onde você não conhece os elementos da cadeia de conexão com antecedência, ou quando não quer salvar informações confidenciais em um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="de1a8-118">This is useful in scenarios where you do not know elements of the connection string ahead of time, or when you do not want to save sensitive information in a configuration file.</span></span> <span data-ttu-id="de1a8-119">Para obter mais informações, consulte [construtores de cadeia de Conexão](../../../../docs/framework/data/adonet/connection-string-builders.md).</span><span class="sxs-lookup"><span data-stu-id="de1a8-119">For more information, see [Connection String Builders](../../../../docs/framework/data/adonet/connection-string-builders.md).</span></span>  
  
### <a name="using-external-configuration-files"></a><span data-ttu-id="de1a8-120">Utilizando arquivos de configuração externos</span><span class="sxs-lookup"><span data-stu-id="de1a8-120">Using External Configuration Files</span></span>  
 <span data-ttu-id="de1a8-121">Os arquivos de configuração externos são arquivos separados que contêm um fragmento de um arquivo de configuração que consiste em uma única seção.</span><span class="sxs-lookup"><span data-stu-id="de1a8-121">External configuration files are separate files that contain a fragment of a configuration file consisting of a single section.</span></span> <span data-ttu-id="de1a8-122">O arquivo de configuração externo é, em seguida, referenciado pelo arquivo de configuração principal.</span><span class="sxs-lookup"><span data-stu-id="de1a8-122">The external configuration file is then referenced by the main configuration file.</span></span> <span data-ttu-id="de1a8-123">Armazenar o **connectionStrings** seção em um arquivo fisicamente separado é útil em situações em que as cadeias de caracteres de conexão podem ser editadas depois que o aplicativo é implantado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-123">Storing the **connectionStrings** section in a physically separate file is useful in situations where connection strings may be edited after the application is deployed.</span></span> <span data-ttu-id="de1a8-124">Por exemplo, o comportamento padrão do ASP.NET é reiniciar o domínio de um aplicativo quando os arquivos de configuração são modificados, o que resulta em perda de informações de estado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-124">For example, the standard ASP.NET behavior is to restart an application domain when configuration files are modified, which results in state information being lost.</span></span> <span data-ttu-id="de1a8-125">No entanto, modificar um arquivo de configuração externo não causa uma reinicialização do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-125">However, modifying an external configuration file does not cause an application restart.</span></span> <span data-ttu-id="de1a8-126">Os arquivos de configuração externos não estão limitados ao ASP.NET; eles também podem ser usados por aplicativos do Windows.</span><span class="sxs-lookup"><span data-stu-id="de1a8-126">External configuration files are not limited to ASP.NET; they can also be used by Windows applications.</span></span> <span data-ttu-id="de1a8-127">Além disso, a segurança de acesso a arquivos e as permissões podem ser usadas para restringir o acesso a arquivos de configuração externos.</span><span class="sxs-lookup"><span data-stu-id="de1a8-127">In addition, file access security and permissions can be used to restrict access to external configuration files.</span></span> <span data-ttu-id="de1a8-128">Trabalhar com arquivos de configuração externos em tempo de execução é transparente e não exige nenhuma codificação especial.</span><span class="sxs-lookup"><span data-stu-id="de1a8-128">Working with external configuration files at run time is transparent, and requires no special coding.</span></span>  
  
 <span data-ttu-id="de1a8-129">Para armazenar cadeias de caracteres de conexão no arquivo de configuração externo, crie um arquivo separado que contém apenas o **connectionStrings** seção.</span><span class="sxs-lookup"><span data-stu-id="de1a8-129">To store connection strings in an external configuration file, create a separate file that contains only the **connectionStrings** section.</span></span> <span data-ttu-id="de1a8-130">Não inclui elementos, seções ou atributos adicionais.</span><span class="sxs-lookup"><span data-stu-id="de1a8-130">Do not include any additional elements, sections, or attributes.</span></span> <span data-ttu-id="de1a8-131">Este exemplo mostra a sintaxe para um arquivo de configuração externo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-131">This example shows the syntax for an external configuration file.</span></span>  
  
```xml  
<connectionStrings>  
  <add name="Name"   
   providerName="System.Data.ProviderName"   
   connectionString="Valid Connection String;" />  
</connectionStrings>  
```  
  
 <span data-ttu-id="de1a8-132">No arquivo de configuração do aplicativo principal, você deve usar o **configSource** atributo para especificar o nome totalmente qualificado e o local do arquivo externo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-132">In the main application configuration file, you use the **configSource** attribute to specify the fully qualified name and location of the external file.</span></span> <span data-ttu-id="de1a8-133">Este exemplo refere-se a um arquivo de configuração externo chamado `connections.config`.</span><span class="sxs-lookup"><span data-stu-id="de1a8-133">This example refers to an external configuration file named `connections.config`.</span></span>  
  
```xml  
<?xml version='1.0' encoding='utf-8'?>  
<configuration>  
    <connectionStrings configSource="connections.config"/>  
</configuration>  
```  
  
## <a name="retrieving-connection-strings-at-run-time"></a><span data-ttu-id="de1a8-134">Recuperando cadeias de conexão em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="de1a8-134">Retrieving Connection Strings at Run Time</span></span>  
 <span data-ttu-id="de1a8-135">O .NET Framework 2.0 introduziu novas classes no namespace <xref:System.Configuration> para simplificar a recuperação de cadeias de conexão de arquivos de configuração em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="de1a8-135">The .NET Framework 2.0 introduced new classes in the <xref:System.Configuration> namespace to simplify retrieving connection strings from configuration files at run time.</span></span> <span data-ttu-id="de1a8-136">Você pode programaticamente recuperar uma cadeia de conexão por nome ou nome do provedor.</span><span class="sxs-lookup"><span data-stu-id="de1a8-136">You can programmatically retrieve a connection string by name or by provider name.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-137">O **Machine. config** arquivo também contém um **connectionStrings** seção, que contém as cadeias de conexão usadas pelo Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="de1a8-137">The **machine.config** file also contains a **connectionStrings** section, which contains connection strings used by Visual Studio.</span></span> <span data-ttu-id="de1a8-138">Ao recuperar cadeias de caracteres de conexão por nome do provedor do **App. config** arquivo em um aplicativo do Windows, as cadeias de conexão **Machine. config** obter carregado primeiro e, em seguida, as entradas de **App. config**. Adicionando **limpar** imediatamente após o **connectionStrings** elemento remove herdadas todas as referências a estrutura de dados na memória, para que apenas as cadeias de caracteres de conexão definidas no local **App. config** arquivo são considerados.</span><span class="sxs-lookup"><span data-stu-id="de1a8-138">When retrieving connection strings by provider name from the **app.config** file in a Windows application, the connection strings in **machine.config** get loaded first, and then the entries from **app.config**. Adding **clear** immediately after the **connectionStrings** element removes all inherited references from the data structure in memory, so that only the connection strings defined in the local **app.config** file are considered.</span></span>  
  
### <a name="working-with-the-configuration-classes"></a><span data-ttu-id="de1a8-139">Trabalhando com as classes de configuração</span><span class="sxs-lookup"><span data-stu-id="de1a8-139">Working with the Configuration Classes</span></span>  
 <span data-ttu-id="de1a8-140">A partir do .NET Framework 2.0, <xref:System.Configuration.ConfigurationManager> é usado ao trabalhar com arquivos de configuração no computador local, substituindo o <xref:System.Configuration.ConfigurationSettings> obsoleto.</span><span class="sxs-lookup"><span data-stu-id="de1a8-140">Starting with the .NET Framework 2.0, <xref:System.Configuration.ConfigurationManager> is used when working with configuration files on the local computer, replacing the deprecated <xref:System.Configuration.ConfigurationSettings>.</span></span> <span data-ttu-id="de1a8-141"><xref:System.Web.Configuration.WebConfigurationManager> é usado para trabalhar com arquivos de configuração do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="de1a8-141"><xref:System.Web.Configuration.WebConfigurationManager> is used to work with ASP.NET configuration files.</span></span> <span data-ttu-id="de1a8-142">Ele foi projetado para trabalhar com arquivos de configuração em um servidor Web e permite o acesso programático a seções do arquivo de configuração como **System. Web**.</span><span class="sxs-lookup"><span data-stu-id="de1a8-142">It is designed to work with configuration files on a Web server, and allows programmatic access to configuration file sections such as **system.web**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-143">Acessar arquivos de configuração em tempo de execução exige a concessão de permissões para o chamador; as permissões necessárias dependem do tipo de aplicativo, do arquivo de configuração e do local.</span><span class="sxs-lookup"><span data-stu-id="de1a8-143">Accessing configuration files at run time requires granting permissions to the caller; the required permissions depend on the type of application, configuration file, and location.</span></span> <span data-ttu-id="de1a8-144">Para obter mais informações, consulte [usando as Classes de configuração](http://msdn.microsoft.com/library/98d2b386-baf6-4a17-974b-76e3b4c87acc) e <xref:System.Web.Configuration.WebConfigurationManager> para aplicativos ASP.NET, e <xref:System.Configuration.ConfigurationManager> para aplicativos do Windows.</span><span class="sxs-lookup"><span data-stu-id="de1a8-144">For more information, see [Using the Configuration Classes](http://msdn.microsoft.com/library/98d2b386-baf6-4a17-974b-76e3b4c87acc) and <xref:System.Web.Configuration.WebConfigurationManager> for ASP.NET applications, and <xref:System.Configuration.ConfigurationManager> for Windows applications.</span></span>  
  
 <span data-ttu-id="de1a8-145">Você pode usar <xref:System.Configuration.ConnectionStringSettingsCollection> para recuperar cadeias de conexão de arquivos de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-145">You can use the <xref:System.Configuration.ConnectionStringSettingsCollection> to retrieve connection strings from application configuration files.</span></span> <span data-ttu-id="de1a8-146">Ele contém uma coleção de <xref:System.Configuration.ConnectionStringSettings> objetos, cada um deles representa uma única entrada no **connectionStrings** seção.</span><span class="sxs-lookup"><span data-stu-id="de1a8-146">It contains a collection of <xref:System.Configuration.ConnectionStringSettings> objects, each of which represents a single entry in the **connectionStrings** section.</span></span> <span data-ttu-id="de1a8-147">Suas propriedades mapeiam para atributos de cadeia de conexão, permitindo que você recupere uma cadeia de conexão especificando o nome ou o nome do provedor.</span><span class="sxs-lookup"><span data-stu-id="de1a8-147">Its properties map to connection string attributes, allowing you to retrieve a connection string by specifying the name or the provider name.</span></span>  
  
|<span data-ttu-id="de1a8-148">Propriedade</span><span class="sxs-lookup"><span data-stu-id="de1a8-148">Property</span></span>|<span data-ttu-id="de1a8-149">Descrição</span><span class="sxs-lookup"><span data-stu-id="de1a8-149">Description</span></span>|  
|--------------|-----------------|  
|<xref:System.Configuration.ConnectionStringSettings.Name%2A>|<span data-ttu-id="de1a8-150">O nome da cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="de1a8-150">The name of the connection string.</span></span> <span data-ttu-id="de1a8-151">Mapeia para o **nome** atributo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-151">Maps to the **name** attribute.</span></span>|  
|<xref:System.Configuration.ConnectionStringSettings.ProviderName%2A>|<span data-ttu-id="de1a8-152">O nome do provedor totalmente qualificado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-152">The fully qualified provider name.</span></span> <span data-ttu-id="de1a8-153">Mapeia para o **providerName** atributo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-153">Maps to the **providerName** attribute.</span></span>|  
|<xref:System.Configuration.ConnectionStringSettings.ConnectionString%2A>|<span data-ttu-id="de1a8-154">A cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="de1a8-154">The connection string.</span></span> <span data-ttu-id="de1a8-155">Mapeia para o **connectionString** atributo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-155">Maps to the **connectionString** attribute.</span></span>|  
  
### <a name="example-listing-all-connection-strings"></a><span data-ttu-id="de1a8-156">Exemplo: listando todas as cadeias de conexão</span><span class="sxs-lookup"><span data-stu-id="de1a8-156">Example: Listing All Connection Strings</span></span>  
 <span data-ttu-id="de1a8-157">Este exemplo itera por meio da coleção de `ConnectionStringSettings` e exibe as propriedades <xref:System.Configuration.ConnectionStringSettings.Name%2A>, <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A> e <xref:System.Configuration.ConnectionStringSettings.ConnectionString%2A> na janela do console.</span><span class="sxs-lookup"><span data-stu-id="de1a8-157">This example iterates through the `ConnectionStringSettings` collection and displays the <xref:System.Configuration.ConnectionStringSettings.Name%2A>, <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A>, and <xref:System.Configuration.ConnectionStringSettings.ConnectionString%2A> properties in the console window.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-158">System.Configuration.dll não está incluído em todos os tipos de projeto, e você talvez precise definir uma referência para ele para usar as classes de configuração.</span><span class="sxs-lookup"><span data-stu-id="de1a8-158">System.Configuration.dll is not included in all project types, and you may need to set a reference to it in order to use the configuration classes.</span></span> <span data-ttu-id="de1a8-159">O nome e o local de um arquivo de configuração do aplicativo específico variam pelo tipo de aplicativo e o processo de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="de1a8-159">The name and location of a particular application configuration file varies by the type of application and the hosting process.</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringSettings.RetrieveFromConfig#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfig/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringSettings.RetrieveFromConfig#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfig/VB/source.vb#1)]  
  
### <a name="example-retrieving-a-connection-string-by-name"></a><span data-ttu-id="de1a8-160">Exemplo: recuperando uma cadeia de conexão por nome</span><span class="sxs-lookup"><span data-stu-id="de1a8-160">Example: Retrieving a Connection String by Name</span></span>  
 <span data-ttu-id="de1a8-161">Este exemplo demonstra como recuperar uma cadeia de conexão de um arquivo de configuração especificando seu nome.</span><span class="sxs-lookup"><span data-stu-id="de1a8-161">This example demonstrates how to retrieve a connection string from a configuration file by specifying its name.</span></span> <span data-ttu-id="de1a8-162">O código cria um objeto <xref:System.Configuration.ConnectionStringSettings>, correspondendo o parâmetro de entrada fornecido com o nome de <xref:System.Configuration.ConfigurationManager.ConnectionStrings%2A>.</span><span class="sxs-lookup"><span data-stu-id="de1a8-162">The code creates a <xref:System.Configuration.ConnectionStringSettings> object, matching the supplied input parameter to the <xref:System.Configuration.ConfigurationManager.ConnectionStrings%2A> name.</span></span> <span data-ttu-id="de1a8-163">Se nenhum nome correspondente for localizado, a função retornará `null` (`Nothing` no Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="de1a8-163">If no matching name is found, the function returns `null` (`Nothing` in Visual Basic).</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringSettings.RetrieveFromConfigByName#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByName/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringSettings.RetrieveFromConfigByName#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByName/VB/source.vb#1)]  
  
### <a name="example-retrieving-a-connection-string-by-provider-name"></a><span data-ttu-id="de1a8-164">Exemplo: recuperando uma cadeia de conexão por nome de provedor</span><span class="sxs-lookup"><span data-stu-id="de1a8-164">Example: Retrieving a Connection String by Provider Name</span></span>  
 <span data-ttu-id="de1a8-165">Este exemplo demonstra como recuperar uma cadeia de caracteres de conexão, especificando o nome invariável do provedor no formato *System.Data.ProviderName*.</span><span class="sxs-lookup"><span data-stu-id="de1a8-165">This example demonstrates how to retrieve a connection string by specifying the provider-invariant name in the format *System.Data.ProviderName*.</span></span> <span data-ttu-id="de1a8-166">O código itera por meio do <xref:System.Configuration.ConnectionStringSettingsCollection> e retorna a cadeia de conexão para o primeiro <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A> encontrado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-166">The code iterates through the <xref:System.Configuration.ConnectionStringSettingsCollection> and returns the connection string for the first <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A> found.</span></span> <span data-ttu-id="de1a8-167">Se o nome do provedor não for localizado, a função retornará `null` (`Nothing` no Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="de1a8-167">If the provider name is not found, the function returns `null` (`Nothing` in Visual Basic).</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider/VB/source.vb#1)]  
  
## <a name="encrypting-configuration-file-sections-using-protected-configuration"></a><span data-ttu-id="de1a8-168">Criptografando seções do arquivo de configuração usando configuração protegida</span><span class="sxs-lookup"><span data-stu-id="de1a8-168">Encrypting Configuration File Sections Using Protected Configuration</span></span>  
 <span data-ttu-id="de1a8-169">O ASP.NET 2.0 introduziu um novo recurso chamado *configuração protegida*, que permite que você criptografe as informações confidenciais em um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="de1a8-169">ASP.NET 2.0 introduced a new feature, called *protected configuration*, that enables you to encrypt sensitive information in a configuration file.</span></span> <span data-ttu-id="de1a8-170">Embora tenha sido projetado principalmente para ASP.NET, a configuração protegida também pode ser usada para criptografar seções do arquivo de configuração em aplicativos do Windows.</span><span class="sxs-lookup"><span data-stu-id="de1a8-170">Although primarily designed for ASP.NET, protected configuration can also be used to encrypt configuration file sections in Windows applications.</span></span> <span data-ttu-id="de1a8-171">Para obter uma descrição detalhada dos recursos de configuração protegida, consulte [Criptografando informações de configuração usando configuração protegida](http://msdn.microsoft.com/library/51cdfe5b-9d82-458c-94ff-c551c4f38ed1).</span><span class="sxs-lookup"><span data-stu-id="de1a8-171">For a detailed description of the protected configuration capabilities, see [Encrypting Configuration Information Using Protected Configuration](http://msdn.microsoft.com/library/51cdfe5b-9d82-458c-94ff-c551c4f38ed1).</span></span>  
  
 <span data-ttu-id="de1a8-172">O arquivo de configuração a seguir fragmento mostra o **connectionStrings** seção depois que ele foi criptografado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-172">The following configuration file fragment shows the **connectionStrings** section after it has been encrypted.</span></span> <span data-ttu-id="de1a8-173">O **configProtectionProvider** Especifica o provedor de configuração protegida usado para criptografar e descriptografar as cadeias de caracteres de conexão.</span><span class="sxs-lookup"><span data-stu-id="de1a8-173">The **configProtectionProvider** specifies the protected configuration provider used to encrypt and decrypt the connection strings.</span></span> <span data-ttu-id="de1a8-174">O **EncryptedData** seção contém o texto cifrado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-174">The **EncryptedData** section contains the cipher text.</span></span>  
  
```xml  
<connectionStrings configProtectionProvider="DataProtectionConfigurationProvider">  
  <EncryptedData>  
    <CipherData>  
      <CipherValue>AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAH2... </CipherValue>  
    </CipherData>  
  </EncryptedData>  
</connectionStrings>  
```  
  
 <span data-ttu-id="de1a8-175">Quando a cadeia de caracteres de conexão criptografada é recuperada em tempo de execução, o .NET Framework usa o provedor especificado para descriptografar o **CipherValue** e disponibilizá-la para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-175">When the encrypted connection string is retrieved at run time, the .NET Framework uses the specified provider to decrypt the **CipherValue** and make it available to your application.</span></span> <span data-ttu-id="de1a8-176">Você não precisa escrever nenhum código adicional para gerenciar o processo descriptografia.</span><span class="sxs-lookup"><span data-stu-id="de1a8-176">You do not need to write any additional code to manage the decryption process.</span></span>  
  
### <a name="protected-configuration-providers"></a><span data-ttu-id="de1a8-177">Provedores de configuração protegida</span><span class="sxs-lookup"><span data-stu-id="de1a8-177">Protected Configuration Providers</span></span>  
 <span data-ttu-id="de1a8-178">Provedores de configuração protegida são registrados no **configProtectedData** seção o **Machine. config** de arquivo no computador local, conforme mostrado no fragmento a seguir, que mostra os dois provedores de configuração protegida fornecidos com o .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="de1a8-178">Protected configuration providers are registered in the **configProtectedData** section of the **machine.config** file on the local computer, as shown in the following fragment, which shows the two protected configuration providers supplied with the .NET Framework.</span></span> <span data-ttu-id="de1a8-179">Os valores mostrados aqui foram truncados para facilitar a leitura.</span><span class="sxs-lookup"><span data-stu-id="de1a8-179">The values shown here have been truncated for readability.</span></span>  
  
```xml  
<configProtectedData defaultProvider="RsaProtectedConfigurationProvider">  
  <providers>  
    <add name="RsaProtectedConfigurationProvider"   
      type="System.Configuration.RsaProtectedConfigurationProvider, ... />  
    <add name="DataProtectionConfigurationProvider"   
      type="System.Configuration.DpapiProtectedConfigurationProvider, ... />  
  </providers>  
</configProtectedData>  
```  
  
 Você pode configurar os provedores de configuração protegida adicionais ao adicioná-los para o **Machine. config** arquivo. Você também pode criar seu próprio provedor de configuração protegida por herança da classe base abstrata <xref:System.Configuration.ProtectedConfigurationProvider>. <span data-ttu-id="de1a8-182">A tabela a seguir descreve os dois arquivos de configuração incluídos no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="de1a8-182">The following table describes the two configuration files included with the .NET Framework.</span></span>  
  
|<span data-ttu-id="de1a8-183">Provider</span><span class="sxs-lookup"><span data-stu-id="de1a8-183">Provider</span></span>|<span data-ttu-id="de1a8-184">Descrição</span><span class="sxs-lookup"><span data-stu-id="de1a8-184">Description</span></span>|  
|--------------|-----------------|  
|<!--zz<xref:System.Configuration.RSAProtectedConfigurationProvider>-->`System.Configuration.RSAProtectedConfigurationProvider`|<span data-ttu-id="de1a8-185">Usa o algoritmo de criptografia RSA para criptografar e descriptografar dados.</span><span class="sxs-lookup"><span data-stu-id="de1a8-185">Uses the RSA encryption algorithm to encrypt and decrypt data.</span></span> <span data-ttu-id="de1a8-186">O algoritmo RSA pode ser usado para criptografia de chave pública e assinaturas digitais.</span><span class="sxs-lookup"><span data-stu-id="de1a8-186">The RSA algorithm can be used for both public key encryption and digital signatures.</span></span> <span data-ttu-id="de1a8-187">Também é conhecido como “chave pública” ou criptografia assimétrica porque emprega duas chaves diferentes.</span><span class="sxs-lookup"><span data-stu-id="de1a8-187">It is also known as "public key" or asymmetrical encryption because it employs two different keys.</span></span> <span data-ttu-id="de1a8-188">Você pode usar o [ferramenta de registro ASP.NET IIS (Aspnet_regiis.exe)](http://msdn.microsoft.com/library/6491c41e-e2b0-481f-9863-db3614d5f96b) para criptografar as seções de um arquivo Web. config e gerenciar as chaves de criptografia.</span><span class="sxs-lookup"><span data-stu-id="de1a8-188">You can use the [ASP.NET IIS Registration Tool (Aspnet_regiis.exe)](http://msdn.microsoft.com/library/6491c41e-e2b0-481f-9863-db3614d5f96b) to encrypt sections in a Web.config file and manage the encryption keys.</span></span> <span data-ttu-id="de1a8-189">O ASP.NET descriptografa o arquivo de configuração quando processa o arquivo.</span><span class="sxs-lookup"><span data-stu-id="de1a8-189">ASP.NET decrypts the configuration file when it processes the file.</span></span> <span data-ttu-id="de1a8-190">A identidade do aplicativo do ASP.NET deve ter acesso de leitura para a chave de criptografia que é usada para criptografar e descriptografar as seções criptografadas.</span><span class="sxs-lookup"><span data-stu-id="de1a8-190">The identity of the ASP.NET application must have read access to the encryption key that is used to encrypt and decrypt the encrypted sections.</span></span>|  
|<!--zz<xref:System.Configuration.DPAPIProtectedConfigurationProvider>-->`System.Configuration.DPAPIProtectedConfigurationProvider`|<span data-ttu-id="de1a8-191">Usa a API de Proteção aos Dados do Windows (DPAPI) para criptografar seções de configuração.</span><span class="sxs-lookup"><span data-stu-id="de1a8-191">Uses the Windows Data Protection API (DPAPI) to encrypt configuration sections.</span></span> <span data-ttu-id="de1a8-192">Usa os serviços de criptografia internos do Windows e pode ser configurado para proteção específica de computador ou da conta do usuário.</span><span class="sxs-lookup"><span data-stu-id="de1a8-192">It uses the Windows built-in cryptographic services and can be configured for either machine-specific or user-account-specific protection.</span></span> <span data-ttu-id="de1a8-193">A proteção específica do computador é útil para vários aplicativos no mesmo servidor que precisam compartilhar informações.</span><span class="sxs-lookup"><span data-stu-id="de1a8-193">Machine-specific protection is useful for multiple applications on the same server that need to share information.</span></span> <span data-ttu-id="de1a8-194">A proteção específica da conta do usuário pode ser usada com serviços que são executados com uma identidade de usuário específica, como um ambiente de hospedagem compartilhado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-194">User-account-specific protection can be used with services that run with a specific user identity, such as a shared hosting environment.</span></span> <span data-ttu-id="de1a8-195">Cada aplicativo é executado em uma identidade separada que restringe o acesso a recursos como arquivos e bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="de1a8-195">Each application runs under a separate identity which restricts access to resources such as files and databases.</span></span>|  
  
 <span data-ttu-id="de1a8-196">Os dois provedores oferecem criptografia de dados forte.</span><span class="sxs-lookup"><span data-stu-id="de1a8-196">Both providers offer strong encryption of data.</span></span> <span data-ttu-id="de1a8-197">Entretanto, se você estiver planejando usar o mesmo arquivo de configuração criptografado em vários servidores, como uma Web farm, apenas o `RsaProtectedConfigurationProvider` permite que você exporte as chaves de criptografia usadas para criptografar os dados e importá-los em outro servidor.</span><span class="sxs-lookup"><span data-stu-id="de1a8-197">However, if you are planning to use the same encrypted configuration file on multiple servers, such as a Web farm, only the `RsaProtectedConfigurationProvider` enables you to export the encryption keys used to encrypt the data and import them on another server.</span></span> <span data-ttu-id="de1a8-198">Para obter mais informações, consulte [importando e exportando Protected Configuration RSA Key Containers](http://msdn.microsoft.com/library/f3022b39-f17f-48c1-b067-025eab0ce8bc).</span><span class="sxs-lookup"><span data-stu-id="de1a8-198">For more information, see [Importing and Exporting Protected Configuration RSA Key Containers](http://msdn.microsoft.com/library/f3022b39-f17f-48c1-b067-025eab0ce8bc).</span></span>  
  
### <a name="using-the-configuration-classes"></a><span data-ttu-id="de1a8-199">Usando as classes de configuração</span><span class="sxs-lookup"><span data-stu-id="de1a8-199">Using the Configuration Classes</span></span>  
 <span data-ttu-id="de1a8-200">O namespace <xref:System.Configuration> fornece classes para trabalhar com parâmetros de configuração programaticamente.</span><span class="sxs-lookup"><span data-stu-id="de1a8-200">The <xref:System.Configuration> namespace provides classes to work with configuration settings programmatically.</span></span> <span data-ttu-id="de1a8-201">A classe <xref:System.Configuration.ConfigurationManager> fornece acesso a arquivos de computador, aplicativo e configuração do usuário.</span><span class="sxs-lookup"><span data-stu-id="de1a8-201">The <xref:System.Configuration.ConfigurationManager> class provides access to machine, application, and user configuration files.</span></span> <span data-ttu-id="de1a8-202">Se você estiver criando um aplicativo ASP.NET, você pode usar o <xref:System.Web.Configuration.WebConfigurationManager> classe, que fornece a mesma funcionalidade, enquanto também permitindo que você acesse as configurações que são exclusivas para aplicativos ASP.NET, como aqueles encontrados no  **\< System. Web >**.</span><span class="sxs-lookup"><span data-stu-id="de1a8-202">If you are creating an ASP.NET application, you can use the <xref:System.Web.Configuration.WebConfigurationManager> class, which provides the same functionality while also allowing you to access settings that are unique to ASP.NET applications, such as those found in **\<system.web>**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-203">O namespace <xref:System.Security.Cryptography> contém classes que oferecem opções adicionais para criptografar e descriptografar dados.</span><span class="sxs-lookup"><span data-stu-id="de1a8-203">The <xref:System.Security.Cryptography> namespace contains classes that provide additional options for encrypting and decrypting data.</span></span> <span data-ttu-id="de1a8-204">Use essas classes se você precisar de serviços de criptografia que não estão disponíveis usando a configuração protegida.</span><span class="sxs-lookup"><span data-stu-id="de1a8-204">Use these classes if you require cryptographic services that are not available using protected configuration.</span></span> <span data-ttu-id="de1a8-205">Algumas dessas classes são wrappers da Microsoft CryptoAPI não gerenciada, enquanto outras são implementações puramente gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="de1a8-205">Some of these classes are wrappers for the unmanaged Microsoft CryptoAPI, while others are purely managed implementations.</span></span> <span data-ttu-id="de1a8-206">Para obter mais informações, consulte [serviços criptográficos](http://msdn.microsoft.com/en-us/68a1e844-c63c-44af-9247-f6716eb23781).</span><span class="sxs-lookup"><span data-stu-id="de1a8-206">For more information, see [Cryptographic Services](http://msdn.microsoft.com/en-us/68a1e844-c63c-44af-9247-f6716eb23781).</span></span>  
  
### <a name="appconfig-example"></a><span data-ttu-id="de1a8-207">Exemplo de App.config</span><span class="sxs-lookup"><span data-stu-id="de1a8-207">App.config Example</span></span>  
 <span data-ttu-id="de1a8-208">Este exemplo demonstra como ativar a criptografia de **connectionStrings** seção um **App. config** arquivo para um aplicativo do Windows.</span><span class="sxs-lookup"><span data-stu-id="de1a8-208">This example demonstrates how to toggle encrypting the **connectionStrings** section in an **app.config** file for a Windows application.</span></span> <span data-ttu-id="de1a8-209">Nesse exemplo, o procedimento utiliza o nome do aplicativo como um argumento, por exemplo, “MyApplication.exe”.</span><span class="sxs-lookup"><span data-stu-id="de1a8-209">In this example, the procedure takes the name of the application as an argument, for example, "MyApplication.exe".</span></span> <span data-ttu-id="de1a8-210">O **App. config** arquivo, em seguida, será criptografado e copiado para a pasta que contém o executável com o nome de "MyApplication.exe.config".</span><span class="sxs-lookup"><span data-stu-id="de1a8-210">The **app.config** file will then be encrypted and copied to the folder that contains the executable under the name of "MyApplication.exe.config".</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-211">A cadeia de conexão somente pode ser descriptografada no computador no qual foi criptografada.</span><span class="sxs-lookup"><span data-stu-id="de1a8-211">The connection string can only be decrypted on the computer on which it was encrypted.</span></span>  
  
 <span data-ttu-id="de1a8-212">O código usa o <xref:System.Configuration.ConfigurationManager.OpenExeConfiguration%2A> método para abrir o **App. config** arquivo para edição e o <xref:System.Configuration.ConfigurationManager.GetSection%2A> método retorna o **connectionStrings** seção.</span><span class="sxs-lookup"><span data-stu-id="de1a8-212">The code uses the <xref:System.Configuration.ConfigurationManager.OpenExeConfiguration%2A> method to open the **app.config** file for editing, and the <xref:System.Configuration.ConfigurationManager.GetSection%2A> method returns the **connectionStrings** section.</span></span> <span data-ttu-id="de1a8-213">O código em seguida verifica a propriedade <xref:System.Configuration.SectionInformation.IsProtected%2A>, chamando <xref:System.Configuration.SectionInformation.ProtectSection%2A> para criptografar a seção se não estiver criptografada.</span><span class="sxs-lookup"><span data-stu-id="de1a8-213">The code then checks the <xref:System.Configuration.SectionInformation.IsProtected%2A> property, calling the <xref:System.Configuration.SectionInformation.ProtectSection%2A> to encrypt the section if it is not encrypted.</span></span> <span data-ttu-id="de1a8-214">O método <xref:System.Configuration.SectionInformation.UnprotectSection%2A> é chamado para descriptografar a seção.</span><span class="sxs-lookup"><span data-stu-id="de1a8-214">The <xref:System.Configuration.SectionInformation.UnprotectSection%2A> method is invoked to decrypt the section.</span></span> <span data-ttu-id="de1a8-215">O método <xref:System.Configuration.Configuration.Save%2A> conclui a operação e salva as alterações.</span><span class="sxs-lookup"><span data-stu-id="de1a8-215">The <xref:System.Configuration.Configuration.Save%2A> method completes the operation and saves the changes.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="de1a8-216">Você deve definir uma referência a `System.Configuration.dll` em seu projeto para que o código seja executado.</span><span class="sxs-lookup"><span data-stu-id="de1a8-216">You must set a reference to `System.Configuration.dll` in your project for the code to run.</span></span>  
  
 [!code-csharp[DataWorks ConnectionStrings.Encrypt#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStrings.Encrypt/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStrings.Encrypt#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStrings.Encrypt/VB/source.vb#1)]  
  
### <a name="webconfig-example"></a><span data-ttu-id="de1a8-217">Exemplo de Web.config</span><span class="sxs-lookup"><span data-stu-id="de1a8-217">Web.config Example</span></span>  
 <span data-ttu-id="de1a8-218">Esse exemplo usa o método <xref:System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration%2A> do `WebConfigurationManager`.</span><span class="sxs-lookup"><span data-stu-id="de1a8-218">This example uses the <xref:System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration%2A> method of the `WebConfigurationManager`.</span></span> <span data-ttu-id="de1a8-219">Observe que neste caso você pode fornecer o caminho relativo para o **Web. config** arquivo usando um til.</span><span class="sxs-lookup"><span data-stu-id="de1a8-219">Note that in this case you can supply the relative path to the **Web.config** file by using a tilde.</span></span> <span data-ttu-id="de1a8-220">O código exige uma referência à classe `System.Web.Configuration`.</span><span class="sxs-lookup"><span data-stu-id="de1a8-220">The code requires a reference to the `System.Web.Configuration` class.</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringsWeb.Encrypt#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringsWeb.Encrypt/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringsWeb.Encrypt#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringsWeb.Encrypt/VB/source.vb#1)]  
  
 <span data-ttu-id="de1a8-221">Para obter mais informações para proteger aplicativos ASP.NET, consulte [NIB: segurança ASP.NET](http://msdn.microsoft.com/en-us/04b37532-18d9-40b4-8e5f-ee09a70b311d) e [práticas de segurança do ASP.NET 2.0 em um relance](http://go.microsoft.com/fwlink/?LinkId=59997) no Centro de desenvolvedores do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="de1a8-221">For more information securing ASP.NET applications, see [NIB: ASP.NET Security](http://msdn.microsoft.com/en-us/04b37532-18d9-40b4-8e5f-ee09a70b311d) and [ASP.NET 2.0 Security Practices at a Glance](http://go.microsoft.com/fwlink/?LinkId=59997) on the ASP.NET Developer Center.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="de1a8-222">Consulte também</span><span class="sxs-lookup"><span data-stu-id="de1a8-222">See Also</span></span>  
 [<span data-ttu-id="de1a8-223">Construtores de cadeia de Conexão</span><span class="sxs-lookup"><span data-stu-id="de1a8-223">Connection String Builders</span></span>](../../../../docs/framework/data/adonet/connection-string-builders.md)  
 [<span data-ttu-id="de1a8-224">Protegendo informações de conexão</span><span class="sxs-lookup"><span data-stu-id="de1a8-224">Protecting Connection Information</span></span>](../../../../docs/framework/data/adonet/protecting-connection-information.md)  
 [<span data-ttu-id="de1a8-225">Usando as Classes de configuração</span><span class="sxs-lookup"><span data-stu-id="de1a8-225">Using the Configuration Classes</span></span>](http://msdn.microsoft.com/library/98d2b386-baf6-4a17-974b-76e3b4c87acc)  
 [<span data-ttu-id="de1a8-226">Configurando aplicativos</span><span class="sxs-lookup"><span data-stu-id="de1a8-226">Configuring Apps</span></span>](../../../../docs/framework/configure-apps/index.md)  
 [<span data-ttu-id="de1a8-227">Administração de Site da Web do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="de1a8-227">ASP.NET Web Site Administration</span></span>](http://msdn.microsoft.com/library/1298034b-5f7d-464d-abd1-ad9e6b3eeb7e)  
 <span data-ttu-id="de1a8-228">[ADO.NET Managed Providers and DataSet Developer Center](http://go.microsoft.com/fwlink/?LinkId=217917) (Central de desenvolvedores do DataSet e de provedores gerenciados do ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="de1a8-228">[ADO.NET Managed Providers and DataSet Developer Center](http://go.microsoft.com/fwlink/?LinkId=217917)</span></span>
