---
title: Transações distribuídas
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: f5ed99928534dc31832ac0baf1bb1bfa7e83ded2
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69956768"
---
# <a name="distributed-transactions"></a><span data-ttu-id="ec2aa-102">Transações distribuídas</span><span class="sxs-lookup"><span data-stu-id="ec2aa-102">Distributed Transactions</span></span>
<span data-ttu-id="ec2aa-103">Uma transação é um conjunto de tarefas relacionadas que é bem-sucedida (confirmação) ou falha (anulação) como uma unidade, entre outras coisas.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="ec2aa-104">Uma *transação distribuída* é uma transação que afeta vários recursos.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="ec2aa-105">Para que uma transação distribuída seja confirmada, todos os participantes devem garantir que qualquer alteração nos dados será permanente.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="ec2aa-106">As alterações devem persistir mesmo que haja falhas do sistema ou outros eventos imprevisíveis.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="ec2aa-107">Mesmo se um único participante não fizer essa garantia, a transação inteira falhará e todas as alterações aos dados dentro do escopo da transação serão revertidas.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="ec2aa-108">Uma exceção será gerada se você tentar confirmar ou reverter uma transação se um `DataReader` for iniciado enquanto a transação estiver ativa.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="ec2aa-109">Trabalhando com System.Transactions</span><span class="sxs-lookup"><span data-stu-id="ec2aa-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="ec2aa-110">No .NET Framework, as transações distribuídas são gerenciadas por meio da API no namespace <xref:System.Transactions>.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="ec2aa-111">A API <xref:System.Transactions> delegará a manipulação da transação distribuída para um monitor de transação como o Coordenador de transações distribuídas da Microsoft (DTC) quando vários gerentes de recurso persistentes estão envolvidos.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="ec2aa-112">Para obter mais informações, consulte [conceitos básicos de transação](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="ec2aa-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="ec2aa-113">O ADO.NET 2.0 introduziu o suporte para inscrição em uma transação distribuída usando o método `EnlistTransaction`, que inscreve uma conexão em uma instância <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="ec2aa-114">Em versões anteriores do ADO.NET, a inscrição explícita em transações distribuídas foi realizada usando o método `EnlistDistributedTransaction` de uma conexão para inscrever uma conexão em uma instância <xref:System.EnterpriseServices.ITransaction>, que não tem suporte para compatibilidade com versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="ec2aa-115">Para obter mais informações sobre as transações de serviços corporativos, consulte interoperabilidade [com os serviços corporativos e as transações com+](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="ec2aa-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="ec2aa-116">Ao usar uma transação <xref:System.Transactions> com o provedor do .NET Framework para SQL Server em um banco de dados do SQL Server, um <xref:System.Transactions.Transaction> leve será usado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="ec2aa-117">A transação pode então ser promovida a uma transação distribuída completa conforme o necessário.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="ec2aa-118">Para obter mais informações, consulte [integração de System. Transactions com o SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ec2aa-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="ec2aa-119">O número máximo de transações distribuídas no qual um banco de dados Oracle pode participar ao mesmo tempo é definido como 10 por padrão.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="ec2aa-120">Após a 10ª transação durante a conexão com um banco de dados Oracle, uma exceção é gerada.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="ec2aa-121">A Oracle não oferece suporte a `DDL` dentro de uma transação distribuída.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="ec2aa-122">Automaticamente inscrevendo em uma transação distribuída</span><span class="sxs-lookup"><span data-stu-id="ec2aa-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="ec2aa-123">A inscrição automática é a maneira padrão (e preferida) de integrar conexões ADO.NET com `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="ec2aa-124">Um objeto de conexão será inscrito automaticamente em uma transação distribuída existente se determinar que uma transação está ativa, o que `System.Transaction` , em termos, `Transaction.Current` significa que não é nulo.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="ec2aa-125">A inscrição automática de transação ocorre quando a conexão é aberta.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="ec2aa-126">Isso não ocorrerá depois disso, mesmo que um comando seja executado dentro de um escopo de transação.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="ec2aa-127">Você pode desativar a inscrição automática em transações existentes especificando `Enlist=false` como um parâmetro de cadeia de conexão para um <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType> ou `OLE DB Services=-7` como um parâmetro de cadeia de conexão para um <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="ec2aa-128">Para obter mais informações sobre Oracle e os parâmetros da cadeia de conexão ODBC, consulte <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> e <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="ec2aa-129">Inscrevendo manualmente em uma transação distribuída</span><span class="sxs-lookup"><span data-stu-id="ec2aa-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="ec2aa-130">Se a inscrição automática estiver desativada ou se você precisar inscrever uma transação que foi iniciada depois que a conexão foi aberta, você poderá inscrever-se em uma transação distribuída existente usando o método `EnlistTransaction` do objeto <xref:System.Data.Common.DbConnection> para o provedor com o qual você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="ec2aa-131">A inscrição em uma transação atribuída existente garante que, se a transação for confirmada ou revertida, as alterações feitas pelo código na fonte de dados também serão confirmadas ou revertidas.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="ec2aa-132">Inscrever-se em transações distribuídas é aplicável principalmente ao agrupar objetos de negócios.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="ec2aa-133">Se um objeto de negócios é agrupado com uma conexão aberta, a inscrição automática da transação ocorre somente quando essa conexão está aberta.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="ec2aa-134">Se várias transações são executadas usando o objeto comercial agrupado, a conexão aberta para esse objeto não se inscreverá automaticamente em transações iniciadas recentemente.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="ec2aa-135">Nesse caso, você pode desabilitar a inscrição automática de transação para a conexão e inscrever a conexão nas transações usando `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="ec2aa-136">`EnlistTransaction`usa um único argumento do tipo <xref:System.Transactions.Transaction> que é uma referência à transação existente.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="ec2aa-137">Após chamar o método `EnlistTransaction` da conexão, as modificações feitas na fonte de dados usando a conexão serão incluídas na transação.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="ec2aa-138">Passar um valor nulo cancela a inscrição da conexão de sua inscrição de transação distribuída atual.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="ec2aa-139">Observe que a conexão deve ser aberta antes de chamar `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="ec2aa-140">Assim que uma conexão é inscrita explicitamente em uma transação, ela não pode ter a inscrição cancelada nem ser inscrita em outra transação até a primeira transação terminar.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="ec2aa-141">`EnlistTransaction` gera uma exceção se a conexão já tiver começado uma transação usando o método <xref:System.Data.Common.DbConnection.BeginTransaction%2A> da conexão.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="ec2aa-142">No entanto, se a transação for uma transação local iniciada na fonte de dados (por exemplo, executando a instrução BEGIN TRANSACTION explicitamente usando uma <xref:System.Data.SqlClient.SqlCommand>), o `EnlistTransaction` reverterá a transação local e se inscreverá na transação distribuída existente conforme o solicitado.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="ec2aa-143">Você não receberá o aviso de que a transação local foi revertida e deverá gerenciar as transações locais não iniciadas usando <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="ec2aa-144">Se você estiver usando o provedor de dados .NET Framework para SQL Server (`SqlClient`) com SQL Server, uma tentativa de inscrição gerará uma exceção.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="ec2aa-145">Todos os outros casos permanecerão despercebidos.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="ec2aa-146">Transações passíveis de promoção no SQL Server</span><span class="sxs-lookup"><span data-stu-id="ec2aa-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="ec2aa-147">O SQL Server oferece suporte a transações passíveis de promoção nas quais uma transação leve local pode ser automaticamente promovida para uma transação distribuída somente se isso for necessário.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="ec2aa-148">Uma transação passível de promoção não chama a sobrecarga adicional de uma transação distribuída a menos que a sobrecarga adicional seja necessária.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="ec2aa-149">Para obter mais informações e um exemplo de código, consulte [integração de System. Transactions com o SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ec2aa-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="ec2aa-150">Configurando transações distribuídas</span><span class="sxs-lookup"><span data-stu-id="ec2aa-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="ec2aa-151">Você talvez precise habilitar o MS DTC na rede para usar transações distribuídas.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="ec2aa-152">Se tiver o Firewall do Windows habilitado, você deverá permitir que o serviço do MS DTC use a rede ou abra a porta do MS DTC.</span><span class="sxs-lookup"><span data-stu-id="ec2aa-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ec2aa-153">Consulte também</span><span class="sxs-lookup"><span data-stu-id="ec2aa-153">See also</span></span>

- [<span data-ttu-id="ec2aa-154">Transações e simultaneidade</span><span class="sxs-lookup"><span data-stu-id="ec2aa-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)
- [<span data-ttu-id="ec2aa-155">Integração de System.Transactions com o SQL Server</span><span class="sxs-lookup"><span data-stu-id="ec2aa-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)
- <span data-ttu-id="ec2aa-156">[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917) (Central de desenvolvedores do DataSet e de provedores gerenciados do ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="ec2aa-156">[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)</span></span>
