---
title: Rastreamento de dados no ADO.NET
ms.date: 03/30/2017
ms.assetid: a6a752a5-d2a9-4335-a382-b58690ccb79f
ms.openlocfilehash: e27f1f30ab8626b21421d6d4a7808f8ffef5c26f
ms.sourcegitcommit: 7f8eeef060ddeb2cabfa52843776faf652c5a1f5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/14/2019
ms.locfileid: "74088771"
---
# <a name="data-tracing-in-adonet"></a><span data-ttu-id="d7db8-102">Rastreamento de dados no ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d7db8-102">Data Tracing in ADO.NET</span></span>

<span data-ttu-id="d7db8-103">O ADO.NET apresenta a funcionalidade de rastreamento de dados interna com suporte dos provedores de dados .NET para SQL Server, Oracle, OLE DB e ODBC, bem como o ADO.NET <xref:System.Data.DataSet>e os protocolos de rede SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d7db8-103">ADO.NET features built-in data tracing functionality that is supported by the .NET data providers for SQL Server, Oracle, OLE DB and ODBC, as well as the ADO.NET <xref:System.Data.DataSet>, and the SQL Server network protocols.</span></span>

<span data-ttu-id="d7db8-104">O rastreamento de chamadas à API de acesso a dados pode ajudar a diagnosticar os seguintes problemas:</span><span class="sxs-lookup"><span data-stu-id="d7db8-104">Tracing data access API calls can help diagnose the following problems:</span></span>

- <span data-ttu-id="d7db8-105">Incompatibilidade de esquema entre o programa cliente e o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d7db8-105">Schema mismatch between client program and the database.</span></span>

- <span data-ttu-id="d7db8-106">Problemas de biblioteca de rede ou indisponibilidade de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d7db8-106">Database unavailability or network library problems.</span></span>

- <span data-ttu-id="d7db8-107">SQL incorreto se embutido em código ou gerado por um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d7db8-107">Incorrect SQL whether hard coded or generated by an application.</span></span>

- <span data-ttu-id="d7db8-108">Lógica de programação incorreta.</span><span class="sxs-lookup"><span data-stu-id="d7db8-108">Incorrect programming logic.</span></span>

- <span data-ttu-id="d7db8-109">Problemas resultantes da interação entre vários componentes do ADO.NET ou entre ADO.NET e seus próprios componentes.</span><span class="sxs-lookup"><span data-stu-id="d7db8-109">Issues resulting from the interaction between multiple ADO.NET components or between ADO.NET and your own components.</span></span>

<span data-ttu-id="d7db8-110">Para dar suporte a diferentes tecnologias de rastreamento, o rastreamento é extensível, portanto, um desenvolvedor pode rastrear um problema em qualquer nível da pilha de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="d7db8-110">To support different trace technologies, tracing is extensible, so a developer can trace a problem at any level of the application stack.</span></span> <span data-ttu-id="d7db8-111">Embora o rastreamento não seja um recurso ADO.NET, os provedores da Microsoft aproveitam as APIs generalizadas de rastreamento e instrumentação.</span><span class="sxs-lookup"><span data-stu-id="d7db8-111">Although tracing is not an ADO.NET-only feature, Microsoft providers take advantage of generalized tracing and instrumentation APIs.</span></span>

<span data-ttu-id="d7db8-112">Para obter mais informações sobre como configurar e configurar o rastreamento gerenciado no ADO.NET, consulte [rastreamento de acesso a dados](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="d7db8-112">For more information about setting and configuring managed tracing in ADO.NET, see [Tracing Data Access](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span></span>

## <a name="accessing-diagnostic-information-in-the-extended-events-log"></a><span data-ttu-id="d7db8-113">Acessando informações de diagnóstico no log de eventos estendidos</span><span class="sxs-lookup"><span data-stu-id="d7db8-113">Accessing Diagnostic Information in the Extended Events Log</span></span>

<span data-ttu-id="d7db8-114">No .NET Framework Provedor de Dados para SQL Server, o rastreamento de acesso a dados ([rastreamento de acesso a dados](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))) foi atualizado para facilitar a correlação de eventos de cliente com informações de diagnóstico, como falhas de conexão, do buffer de anéis de conectividade do servidor e das informações de desempenho do aplicativo no log de eventos estendidos.</span><span class="sxs-lookup"><span data-stu-id="d7db8-114">In the .NET Framework Data Provider for SQL Server, data access tracing ([Data Access Tracing](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))) has been updated to make it easier to correlate client events with diagnostic information, such as connection failures, from the server's connectivity ring buffer and application performance information in the extended events log.</span></span> <span data-ttu-id="d7db8-115">Para obter informações sobre como ler o log de eventos estendidos, consulte [exibir dados de sessão de evento](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span><span class="sxs-lookup"><span data-stu-id="d7db8-115">For information about reading the extended events log, see [View Event Session Data](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span></span>

<span data-ttu-id="d7db8-116">Para operações de conexão, o ADO.NET enviará uma ID de conexão de cliente.</span><span class="sxs-lookup"><span data-stu-id="d7db8-116">For connection operations, ADO.NET will send a client connection ID.</span></span> <span data-ttu-id="d7db8-117">Se a conexão falhar, você poderá acessar o buffer de anéis de conectividade ([solução de problemas de conectividade no SQL Server 2008 com o buffer de anéis de conectividade](https://go.microsoft.com/fwlink/?LinkId=207752)) e localizar o campo `ClientConnectionID` e obter informações de diagnóstico sobre a falha de conexão.</span><span class="sxs-lookup"><span data-stu-id="d7db8-117">If the connection fails, you can access the connectivity ring buffer ([Connectivity troubleshooting in SQL Server 2008 with the Connectivity Ring Buffer](https://go.microsoft.com/fwlink/?LinkId=207752)) and find the `ClientConnectionID` field and get diagnostic information about the connection failure.</span></span> <span data-ttu-id="d7db8-118">As IDs de conexão de cliente serão registradas no buffer de anéis somente se ocorrer um erro.</span><span class="sxs-lookup"><span data-stu-id="d7db8-118">Client connection IDs are logged in the ring buffer only if an error occurs.</span></span> <span data-ttu-id="d7db8-119">(Se uma conexão falhar antes de enviar o pacote de pré-logon, uma ID de conexão de cliente não será gerada.) A ID de conexão do cliente é um GUID de 16 bytes.</span><span class="sxs-lookup"><span data-stu-id="d7db8-119">(If a connection fails before sending the prelogin packet, a client connection ID will not be generated.) The client connection ID is a 16-byte GUID.</span></span> <span data-ttu-id="d7db8-120">Você também pode encontrar a ID de conexão do cliente na saída de destino de eventos estendidos, se a ação de `client_connection_id` for adicionada a eventos em uma sessão de eventos estendidos.</span><span class="sxs-lookup"><span data-stu-id="d7db8-120">You can also find the client connection ID in the extended events target output, if the `client_connection_id` action is added to events in an extended events session.</span></span> <span data-ttu-id="d7db8-121">Você pode habilitar o rastreamento de acesso a dados e executar novamente o comando de conexão e observar o campo `ClientConnectionID` no rastreamento de acesso a dados, se precisar de mais assistência de diagnóstico de driver de cliente.</span><span class="sxs-lookup"><span data-stu-id="d7db8-121">You can enable data access tracing and rerun the connection command and observe the `ClientConnectionID` field in the data access trace, if you need further client driver diagnostic assistance.</span></span>

<span data-ttu-id="d7db8-122">Você pode obter a ID de conexão do cliente programaticamente usando a propriedade `SqlConnection.ClientConnectionID`.</span><span class="sxs-lookup"><span data-stu-id="d7db8-122">You can get the client connection ID programmatically by using the `SqlConnection.ClientConnectionID` property.</span></span>

<span data-ttu-id="d7db8-123">O `ClientConnectionID` está disponível para um objeto <xref:System.Data.SqlClient.SqlConnection> que estabelece com êxito uma conexão.</span><span class="sxs-lookup"><span data-stu-id="d7db8-123">The `ClientConnectionID` is available for a <xref:System.Data.SqlClient.SqlConnection> object that successfully establishes  a connection.</span></span> <span data-ttu-id="d7db8-124">Se uma tentativa de conexão falhar, `ClientConnectionID` poderá estar disponível por meio de `SqlException.ToString`.</span><span class="sxs-lookup"><span data-stu-id="d7db8-124">If a connection attempt fails, `ClientConnectionID` may be available via `SqlException.ToString`.</span></span>

<span data-ttu-id="d7db8-125">O ADO.NET também envia uma ID de atividade específica do thread.</span><span class="sxs-lookup"><span data-stu-id="d7db8-125">ADO.NET also sends a thread-specific activity ID.</span></span> <span data-ttu-id="d7db8-126">A ID da atividade será capturada nas sessões de eventos estendidos se as sessões forem iniciadas com a opção TRACK_CAUSALITY habilitada.</span><span class="sxs-lookup"><span data-stu-id="d7db8-126">The activity ID is captured in the extended events sessions if the sessions are started with the TRACK_CAUSALITY option enabled.</span></span> <span data-ttu-id="d7db8-127">Para problemas de desempenho com uma conexão ativa, você pode obter a ID da atividade do rastreamento de acesso a dados do cliente (`ActivityID` campo) e, em seguida, localizar a ID da atividade na saída de eventos estendidos.</span><span class="sxs-lookup"><span data-stu-id="d7db8-127">For performance issues with an active connection, you can get the activity ID from the client's data access trace (`ActivityID` field) and then locate the activity ID in the extended events output.</span></span> <span data-ttu-id="d7db8-128">A ID da atividade em eventos estendidos é um GUID de 16 bytes (não o mesmo que o GUID da ID de conexão do cliente) acrescentado com um número de sequência de quatro bytes.</span><span class="sxs-lookup"><span data-stu-id="d7db8-128">The activity ID in extended events is a 16-byte GUID (not the same as the GUID for the client connection ID) appended with a four-byte sequence number.</span></span> <span data-ttu-id="d7db8-129">O número de sequência representa a ordem de uma solicitação dentro de um thread e indica a ordenação relativa de instruções de lote e RPC para o thread.</span><span class="sxs-lookup"><span data-stu-id="d7db8-129">The sequence number represents the order of a request within a thread and indicates the relative ordering of batch and RPC statements for the thread.</span></span> <span data-ttu-id="d7db8-130">O `ActivityID`, no momento, é enviado opcionalmente para instruções de lote SQL e solicitações RPC quando o rastreamento de acesso a dados está habilitado e o bit 18 na palavra de configuração de rastreamento de acesso a dados é ativado.</span><span class="sxs-lookup"><span data-stu-id="d7db8-130">The `ActivityID` is currently optionally sent for SQL batch statements and RPC requests when data access tracing is enabled on and the 18th bit in the data access tracing configuration word is turned ON.</span></span>

<span data-ttu-id="d7db8-131">Veja a seguir um exemplo que usa o Transact-SQL para iniciar uma sessão de eventos estendidos que será armazenada em um buffer de anéis e registrará a ID de atividade enviada de um cliente em operações RPC e em lote.</span><span class="sxs-lookup"><span data-stu-id="d7db8-131">The following is a sample that uses Transact-SQL to start an extended events session that will be stored in a ring buffer and will record the activity ID sent from a client on RPC and batch operations.</span></span>

```sql
create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)
```

## <a name="see-also"></a><span data-ttu-id="d7db8-132">Consulte também</span><span class="sxs-lookup"><span data-stu-id="d7db8-132">See also</span></span>

- [<span data-ttu-id="d7db8-133">Rastreamento de rede no .NET Framework</span><span class="sxs-lookup"><span data-stu-id="d7db8-133">Network Tracing in the .NET Framework</span></span>](../../network-programming/network-tracing.md)
- [<span data-ttu-id="d7db8-134">Rastreando e instrumentando aplicativos</span><span class="sxs-lookup"><span data-stu-id="d7db8-134">Tracing and Instrumenting Applications</span></span>](../../debug-trace-profile/tracing-and-instrumenting-applications.md)
- <span data-ttu-id="d7db8-135">[ADO.NET Overview](ado-net-overview.md) (Visão geral do ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="d7db8-135">[ADO.NET Overview](ado-net-overview.md)</span></span>
