---
title: Operações de serviço (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- service operations [WCF Data Services]
- WCF Data Services, service operations
ms.assetid: 583a690a-e60f-4990-8991-d6efce069d76
ms.openlocfilehash: b63c6d8f3a5a949299a925a321ca8f01c67b1d8f
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59211966"
---
# <a name="service-operations-wcf-data-services"></a><span data-ttu-id="ae258-102">Operações de serviço (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="ae258-102">Service Operations (WCF Data Services)</span></span>
[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] <span data-ttu-id="ae258-103">permite que você defina operações de serviço em um serviço de dados para expor métodos no servidor.</span><span class="sxs-lookup"><span data-stu-id="ae258-103">enables you to define service operations on a data service to expose methods on the server.</span></span> <span data-ttu-id="ae258-104">Como outros recursos do serviço de dados, as operações de serviço são endereçadas por URIs.</span><span class="sxs-lookup"><span data-stu-id="ae258-104">Like other data service resources, service operations are addressed by URIs.</span></span> <span data-ttu-id="ae258-105">As operações de serviço permitem que você exponha a lógica de negócio em um serviço de dados, como implementar a lógica de validação, aplicar a segurança baseada em função, ou expor recursos de consulta especializada.</span><span class="sxs-lookup"><span data-stu-id="ae258-105">Service operations enable you to expose business logic in a data service, such as to implement validation logic, to apply role-based security, or to expose specialized querying capabilities.</span></span> <span data-ttu-id="ae258-106">Operações de serviço são métodos adicionados à classe de serviço de dados que deriva de <xref:System.Data.Services.DataService%601>.</span><span class="sxs-lookup"><span data-stu-id="ae258-106">Service operations are methods added to the data service class that derives from <xref:System.Data.Services.DataService%601>.</span></span> <span data-ttu-id="ae258-107">Como todos os outros recursos de serviço do dados, você pode fornecer parâmetros para o método de operação de serviço.</span><span class="sxs-lookup"><span data-stu-id="ae258-107">Like all other data service resources, you can supply parameters to the service operation method.</span></span> <span data-ttu-id="ae258-108">Por exemplo, o seguinte URI da operação de serviço (com base nas [quickstart](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md) serviço de dados) passa o valor `London` para o `city` parâmetro:</span><span class="sxs-lookup"><span data-stu-id="ae258-108">For example, the following service operation URI (based on the [quickstart](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md) data service) passes the value `London` to the `city` parameter:</span></span>  
  
```  
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'  
```  
  
 <span data-ttu-id="ae258-109">A definição para esta operação de serviço é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="ae258-109">The definition for this service operation is as follows:</span></span>  
  
 [!code-csharp[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#serviceoperationdef)]
 [!code-vb[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#serviceoperationdef)]  
  
 <span data-ttu-id="ae258-110">Você pode usar o <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> do <xref:System.Data.Services.DataService%601> para acessar diretamente a fonte de dados que o serviço de dados está usando.</span><span class="sxs-lookup"><span data-stu-id="ae258-110">You can use the <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> of the <xref:System.Data.Services.DataService%601> to directly access the data source that the data service is using.</span></span> <span data-ttu-id="ae258-111">Para obter mais informações, confira [Como: Definir uma operação de serviço](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ae258-111">For more information, see [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md).</span></span>  
  
 <span data-ttu-id="ae258-112">Para obter informações sobre como chamar uma operação de serviço de um aplicativo de cliente do .NET Framework, consulte [chamar operações de serviço](../../../../docs/framework/data/wcf/calling-service-operations-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ae258-112">For information on how to call a service operation from a .NET Framework client application, see [Calling Service Operations](../../../../docs/framework/data/wcf/calling-service-operations-wcf-data-services.md).</span></span>  
  
## <a name="service-operation-requirements"></a><span data-ttu-id="ae258-113">Requisitos da operação de serviço</span><span class="sxs-lookup"><span data-stu-id="ae258-113">Service Operation Requirements</span></span>  
 <span data-ttu-id="ae258-114">Os seguintes requisitos aplicam-se ao definir operações de serviço no serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="ae258-114">The following requirements apply when defining service operations on the data service.</span></span> <span data-ttu-id="ae258-115">Se um método não atender a esses requisitos, ele não será exposto como uma operação de serviço para o serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="ae258-115">If a method does not meet these requirements, it will not be exposed as a service operation for the data service.</span></span>  
  
-   <span data-ttu-id="ae258-116">A operação deve ser um método público de instância que é um membro da classe do serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="ae258-116">The operation must be a public instance method that is a member of the data service class.</span></span>  
  
-   <span data-ttu-id="ae258-117">O método da operação só pode aceitar parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="ae258-117">The operation method may only accept input parameters.</span></span> <span data-ttu-id="ae258-118">Os dados enviados no corpo da mensagem não podem ser acessados pelo serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="ae258-118">Data sent in the message body cannot be accessed by the data service.</span></span>  
  
-   <span data-ttu-id="ae258-119">Se os parâmetros forem definidos, o tipo de cada parâmetro deverá ser um tipo primitivo.</span><span class="sxs-lookup"><span data-stu-id="ae258-119">If parameters are defined, the type of each parameter must be a primitive type.</span></span> <span data-ttu-id="ae258-120">Todos os dados de um tipo não primitivo devem ser serializados e passados em um parâmetro de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="ae258-120">Any data of a non-primitive type must be serialized and passed into a string parameter.</span></span>  
  
-   <span data-ttu-id="ae258-121">O método deve retornar um destes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="ae258-121">The method must return one of the following:</span></span>  
  
    -   `void` <span data-ttu-id="ae258-122">(`Nothing` no Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="ae258-122">(`Nothing` in Visual Basic)</span></span>  
  
    -   <xref:System.Collections.Generic.IEnumerable%601>  
  
    -   <xref:System.Linq.IQueryable%601>  
  
    -   <span data-ttu-id="ae258-123">Um tipo de entidade no modelo de dados que o serviço de dados expõe.</span><span class="sxs-lookup"><span data-stu-id="ae258-123">An entity type in the data model that the data service exposes.</span></span>  
  
    -   <span data-ttu-id="ae258-124">Uma classe primitiva como inteiro ou cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="ae258-124">A primitive class such as integer or string.</span></span>  
  
-   <span data-ttu-id="ae258-125">Para dar suporte a opções de consulta como classificação, paginação e filtragem, os métodos da operação de serviço deverão retornar <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="ae258-125">In order to support query options such as sorting, paging, and filtering, service operation methods should return <xref:System.Linq.IQueryable%601>.</span></span> <span data-ttu-id="ae258-126">As solicitações a operações de serviço que incluem opções de consulta são rejeitadas para as operações que somente retornam <xref:System.Collections.Generic.IEnumerable%601>.</span><span class="sxs-lookup"><span data-stu-id="ae258-126">Requests to service operations that include query options are rejected for operations that only return <xref:System.Collections.Generic.IEnumerable%601>.</span></span>  
  
-   <span data-ttu-id="ae258-127">Para dar suporte ao acesso a entidades relacionadas usando propriedades de navegação, a operação de serviço deverá retornar <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="ae258-127">In order to support accessing related entities by using navigation properties, the service operation must return <xref:System.Linq.IQueryable%601>.</span></span>  
  
-   <span data-ttu-id="ae258-128">O método deve ser anotado com o atributo `[WebGet]` ou `[WebInvoke]`.</span><span class="sxs-lookup"><span data-stu-id="ae258-128">The method must be annotated with the `[WebGet]` or `[WebInvoke]` attribute.</span></span>  
  
    -   `[WebGet]` <span data-ttu-id="ae258-129">permite que o método a ser invocado por meio de uma solicitação GET.</span><span class="sxs-lookup"><span data-stu-id="ae258-129">enables the method to be invoked by using a GET request.</span></span>  
  
    -   `[WebInvoke(Method = "POST")]` <span data-ttu-id="ae258-130">permite que o método a ser invocado por meio de uma solicitação POST.</span><span class="sxs-lookup"><span data-stu-id="ae258-130">enables the method to be invoked by using a POST request.</span></span> <span data-ttu-id="ae258-131">Outros métodos <xref:System.ServiceModel.Web.WebInvokeAttribute> não têm suporte.</span><span class="sxs-lookup"><span data-stu-id="ae258-131">Other <xref:System.ServiceModel.Web.WebInvokeAttribute> methods are not supported.</span></span>  
  
-   <span data-ttu-id="ae258-132">Uma operação de serviço pode ser anotada com o <xref:System.Data.Services.SingleResultAttribute> que especifica que o valor de retorno do método é uma única entidade em vez de uma coleção de entidades.</span><span class="sxs-lookup"><span data-stu-id="ae258-132">A service operation may be annotated with the <xref:System.Data.Services.SingleResultAttribute> that specifies that the return value from the method is a single entity rather than a collection of entities.</span></span> <span data-ttu-id="ae258-133">Essa distinção determina a serialização resultante da resposta e a maneira na qual as passagens de propriedades de navegação adicionais são representadas no URI.</span><span class="sxs-lookup"><span data-stu-id="ae258-133">This distinction dictates the resulting serialization of the response and the manner in which additional navigation property traversals are represented in the URI.</span></span> <span data-ttu-id="ae258-134">Por exemplo, ao usar a serialização AtomPub, uma única instância do tipo de recurso é representada como um elemento de entrada e um conjunto de instâncias como um elemento de feed.</span><span class="sxs-lookup"><span data-stu-id="ae258-134">For example, when using AtomPub serialization, a single resource type instance is represented as an entry element and a set of instances as a feed element.</span></span>  
  
## <a name="addressing-service-operations"></a><span data-ttu-id="ae258-135">Resolvendo operações de serviço</span><span class="sxs-lookup"><span data-stu-id="ae258-135">Addressing Service Operations</span></span>  
 <span data-ttu-id="ae258-136">Você pode resolver operações de serviço colocando o nome do método no primeiro segmento de caminho de um URI.</span><span class="sxs-lookup"><span data-stu-id="ae258-136">You can address service operations by placing the name of the method in the first path segment of a URI.</span></span> <span data-ttu-id="ae258-137">Como exemplo, o seguinte URI acessa uma operação `GetOrdersByState` que retorna uma coleção <xref:System.Linq.IQueryable%601> de objetos `Orders`.</span><span class="sxs-lookup"><span data-stu-id="ae258-137">As an example, the following URI accesses a `GetOrdersByState` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects.</span></span>  
  
```  
http://localhost:12345/Northwind.svc/GetOrdersByState?state='CA'&includeItems=true  
```  
  
 <span data-ttu-id="ae258-138">Ao chamar uma operação de serviço, os parâmetros serão fornecidos como opções de consulta.</span><span class="sxs-lookup"><span data-stu-id="ae258-138">When calling a service operation, parameters are supplied as query options.</span></span> <span data-ttu-id="ae258-139">A operação de serviço anterior aceita um parâmetro `state` de cadeia de caracteres e um parâmetro booliano `includeItems` que indica se deve incluir os objetos `Order_Detail` relacionados na resposta.</span><span class="sxs-lookup"><span data-stu-id="ae258-139">The previous service operation accepts both a string parameter `state` and a Boolean parameter `includeItems` that indicates whether to include related `Order_Detail` objects in the response.</span></span>  
  
 <span data-ttu-id="ae258-140">Os seguintes tipos de retorno são válidos para uma operação de serviço:</span><span class="sxs-lookup"><span data-stu-id="ae258-140">The following are valid return types for a service operation:</span></span>  
  
|<span data-ttu-id="ae258-141">Tipos de retorno válidos</span><span class="sxs-lookup"><span data-stu-id="ae258-141">Valid Return Types</span></span>|<span data-ttu-id="ae258-142">Regras de URI</span><span class="sxs-lookup"><span data-stu-id="ae258-142">URI Rules</span></span>|  
|------------------------|---------------|  
|`void` <span data-ttu-id="ae258-143">(`Nothing` no Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="ae258-143">(`Nothing` in Visual Basic)</span></span><br /><br /> <span data-ttu-id="ae258-144">- ou -</span><span class="sxs-lookup"><span data-stu-id="ae258-144">-or-</span></span><br /><br /> <span data-ttu-id="ae258-145">Tipos de entidade</span><span class="sxs-lookup"><span data-stu-id="ae258-145">Entity types</span></span><br /><br /> <span data-ttu-id="ae258-146">- ou -</span><span class="sxs-lookup"><span data-stu-id="ae258-146">-or-</span></span><br /><br /> <span data-ttu-id="ae258-147">Tipos primitivos</span><span class="sxs-lookup"><span data-stu-id="ae258-147">Primitive types</span></span>|<span data-ttu-id="ae258-148">O URI deve ser um único segmento de caminho que é o nome da operação de serviço.</span><span class="sxs-lookup"><span data-stu-id="ae258-148">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="ae258-149">As opções de consulta não são permitidas.</span><span class="sxs-lookup"><span data-stu-id="ae258-149">Query options are not allowed.</span></span>|  
|<xref:System.Collections.Generic.IEnumerable%601>|<span data-ttu-id="ae258-150">O URI deve ser um único segmento de caminho que é o nome da operação de serviço.</span><span class="sxs-lookup"><span data-stu-id="ae258-150">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="ae258-151">Como o tipo do resultado não é um tipo <xref:System.Linq.IQueryable%601>, as opções de consulta não são permitidas.</span><span class="sxs-lookup"><span data-stu-id="ae258-151">Because the result type is not an <xref:System.Linq.IQueryable%601> type, query options are not allowed.</span></span>|  
|<xref:System.Linq.IQueryable%601>|<span data-ttu-id="ae258-152">Os segmentos do caminho de consulta além do caminho que é o nome da operação de serviço são permitidos.</span><span class="sxs-lookup"><span data-stu-id="ae258-152">Query path segments in addition to the path that is the name of the service operation are allowed.</span></span> <span data-ttu-id="ae258-153">As opções de consulta também são permitidas.</span><span class="sxs-lookup"><span data-stu-id="ae258-153">Query options are also allowed.</span></span>|  
  
 <span data-ttu-id="ae258-154">Os segmentos de caminho ou as opções de consulta adicionais podem ser adicionados ao URI dependendo do tipo de retorno da operação de serviço.</span><span class="sxs-lookup"><span data-stu-id="ae258-154">Additional path segments or query options may be added to the URI depending on the return type of the service operation.</span></span> <span data-ttu-id="ae258-155">Por exemplo, o seguinte URI acessa uma operação `GetOrdersByCity` que retorna uma coleção <xref:System.Linq.IQueryable%601> de objetos `Orders`, ordenada por `RequiredDate` em ordem decrescente, juntamente com os objetos `Order_Details` relacionados:</span><span class="sxs-lookup"><span data-stu-id="ae258-155">For example, the following URI accesses a `GetOrdersByCity` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects, ordered by `RequiredDate` in descending order, along with the related `Order_Details` objects:</span></span>  
  
```  
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'&$expand=Order_Details&$orderby=RequiredDate desc  
```  
  
## <a name="service-operations-access-control"></a><span data-ttu-id="ae258-156">Controle de acesso a operações de serviço</span><span class="sxs-lookup"><span data-stu-id="ae258-156">Service Operations Access Control</span></span>  
 <span data-ttu-id="ae258-157">A visibilidade do serviço de operações de serviço é controlada pelo método <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> na classe <xref:System.Data.Services.IDataServiceConfiguration> da mesma forma que a visibilidade do conjunto de entidades é controlada usando o método <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A>.</span><span class="sxs-lookup"><span data-stu-id="ae258-157">Service-wide visibility of service operations is controlled by the <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> method on the <xref:System.Data.Services.IDataServiceConfiguration> class in much the same way that entity set visibility is controlled by using the <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> method.</span></span> <span data-ttu-id="ae258-158">Por exemplo, a seguinte linha de código na definição do serviço de dados permite o acesso à operação de serviço `CustomersByCity`.</span><span class="sxs-lookup"><span data-stu-id="ae258-158">For example, the following line of code in the data service definition enables access to the `CustomersByCity` service operation.</span></span>  
  
 [!code-csharp[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#serviceoperationconfig)]
 [!code-vb[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#serviceoperationconfig)]  
  
> [!NOTE]
>  <span data-ttu-id="ae258-159">Se uma operação de serviço tiver um tipo de retorno que foi oculto pelo acesso de restrição nos conjuntos de entidades subjacentes, a operação de serviço não estará disponível para aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="ae258-159">If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.</span></span>  
  
 <span data-ttu-id="ae258-160">Para obter mais informações, confira [Como: Definir uma operação de serviço](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ae258-160">For more information, see [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md).</span></span>  
  
## <a name="raising-exceptions"></a><span data-ttu-id="ae258-161">Gerando exceções</span><span class="sxs-lookup"><span data-stu-id="ae258-161">Raising Exceptions</span></span>  
 <span data-ttu-id="ae258-162">Recomendamos que você use a classe <xref:System.Data.Services.DataServiceException> sempre que gerar uma exceção na execução do serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="ae258-162">We recommend that you use the <xref:System.Data.Services.DataServiceException> class whenever you raise an exception in the data service execution.</span></span> <span data-ttu-id="ae258-163">Isso ocorre porque o tempo de execução do serviço de dados sabe como mapear corretamente as propriedades desse objeto de exceção para a mensagem de resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="ae258-163">This is because the data service runtime knows how to map properties of this exception object correctly to the HTTP response message.</span></span> <span data-ttu-id="ae258-164">Quando você gera um <xref:System.Data.Services.DataServiceException> em uma operação de serviço, a exceção retornada é empacotada em um <xref:System.Reflection.TargetInvocationException>.</span><span class="sxs-lookup"><span data-stu-id="ae258-164">When you raise a <xref:System.Data.Services.DataServiceException> in a service operation, the returned exception is wrapped in a <xref:System.Reflection.TargetInvocationException>.</span></span> <span data-ttu-id="ae258-165">Para retornar o <xref:System.Data.Services.DataServiceException> base sem o <xref:System.Reflection.TargetInvocationException> incluído, você deverá substituir o método <xref:System.Data.Services.DataService%601.HandleException%2A> no <xref:System.Data.Services.DataService%601>, extrair o <xref:System.Data.Services.DataServiceException> de <xref:System.Reflection.TargetInvocationException> e retorná-lo como o erro de nível superior, como no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="ae258-165">To return the base <xref:System.Data.Services.DataServiceException> without the enclosing <xref:System.Reflection.TargetInvocationException>, you must override the <xref:System.Data.Services.DataService%601.HandleException%2A> method in the <xref:System.Data.Services.DataService%601>, extract the <xref:System.Data.Services.DataServiceException> from the <xref:System.Reflection.TargetInvocationException>, and return it as the top-level error, as in the following example:</span></span>  
  
 [!code-csharp[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#handleexceptions)]
 [!code-vb[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#handleexceptions)]  
  
## <a name="see-also"></a><span data-ttu-id="ae258-166">Consulte também</span><span class="sxs-lookup"><span data-stu-id="ae258-166">See also</span></span>

- [<span data-ttu-id="ae258-167">Interceptadores</span><span class="sxs-lookup"><span data-stu-id="ae258-167">Interceptors</span></span>](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)
