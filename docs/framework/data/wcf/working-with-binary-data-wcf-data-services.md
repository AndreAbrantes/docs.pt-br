---
title: Trabalhando com dados binários (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, binary data
- WCF Data Services, streams
ms.assetid: aeccc45c-d5c5-4671-ad63-a492ac8043ac
ms.openlocfilehash: 82a773623c1941320aa155dd5bd937d318c1238a
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59170320"
---
# <a name="working-with-binary-data-wcf-data-services"></a><span data-ttu-id="db77f-102">Trabalhando com dados binários (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="db77f-102">Working with Binary Data (WCF Data Services)</span></span>
<span data-ttu-id="db77f-103">O [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] biblioteca de cliente permite que você recupere e atualize dados binários de um [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] feed em uma das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="db77f-103">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library enables you to retrieve and update binary data from an [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] feed in one of the following ways:</span></span>  
  
-   <span data-ttu-id="db77f-104">Como uma propriedade de tipo primitivo de uma entidade.</span><span class="sxs-lookup"><span data-stu-id="db77f-104">As a primitive type property of an entity.</span></span> <span data-ttu-id="db77f-105">Esse é o método recomendado para trabalhar com objetos de dados binários pequenos que podem ser facilmente carregados na memória.</span><span class="sxs-lookup"><span data-stu-id="db77f-105">This is the recommended method for working with small binary data objects that can be easily loaded into memory.</span></span> <span data-ttu-id="db77f-106">Nesse caso, a propriedade binária é uma propriedade de entidade exposta pelo modelo de dados, e o serviço de dados serializa os dados binários como XML com codificação binária de Base 64 na mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="db77f-106">In this case, the binary property is an entity property exposed by the data model, and the data service serializes the binary data as base-64 binary encoded XML in the response message.</span></span>  
  
-   <span data-ttu-id="db77f-107">Como um fluxo de recursos binários separado.</span><span class="sxs-lookup"><span data-stu-id="db77f-107">As a separate binary resource stream.</span></span> <span data-ttu-id="db77f-108">Esse é o método recomendado para acessar e alterar dados BLOB (objeto binário grande) que podem representar uma fotografia, um vídeo ou qualquer outro tipo de dados codificados binários.</span><span class="sxs-lookup"><span data-stu-id="db77f-108">This is the recommended method for accessing and changing binary large object (BLOB) data that may represent a photo, video, or any other type of binary encoded data.</span></span>  
  
 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] <span data-ttu-id="db77f-109">implementa o streaming de dados binários usando HTTP, conforme definido no [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="db77f-109">implements the streaming of binary data by using HTTP as defined in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].</span></span> <span data-ttu-id="db77f-110">Nesse mecanismo, dados binários são tratados como um recurso de mídia que é separado do mas relacionados a uma entidade, que é chamada de uma entrada de link de mídia.</span><span class="sxs-lookup"><span data-stu-id="db77f-110">In this mechanism, binary data is treated as a media resource that is separate from but related to an entity, which is called a media link entry.</span></span> <span data-ttu-id="db77f-111">Para obter mais informações, consulte [provedor de Streaming](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="db77f-111">For more information, see [Streaming Provider](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md).</span></span>  
  
> [!TIP]
>  <span data-ttu-id="db77f-112">Para obter um exemplo passo a passo de como criar um aplicativo de cliente do Windows Presentation Foundation (WPF) que baixa os arquivos de imagem binária de um [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] serviço que armazena fotos, consulte a postagem [dados dos serviços de Streaming provedor série partes 2: Acessando um Stream de recurso de mídia do cliente](https://go.microsoft.com/fwlink/?LinkId=201637).</span><span class="sxs-lookup"><span data-stu-id="db77f-112">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://go.microsoft.com/fwlink/?LinkId=201637).</span></span> <span data-ttu-id="db77f-113">Para baixar o código de exemplo para o serviço de dados de fotos de fluxo em destaque na postagem do blog, consulte o [exemplo de serviço de dados de fotos de Streaming](https://go.microsoft.com/fwlink/?LinkId=198988) na Galeria de códigos do MSDN.</span><span class="sxs-lookup"><span data-stu-id="db77f-113">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://go.microsoft.com/fwlink/?LinkId=198988) in MSDN Code Gallery.</span></span>  
  
## <a name="entity-metadata"></a><span data-ttu-id="db77f-114">Metadados de entidade</span><span class="sxs-lookup"><span data-stu-id="db77f-114">Entity Metadata</span></span>  
 <span data-ttu-id="db77f-115">Uma entidade que tenha um fluxo de recursos de mídia relacionado é indicada nos metadados do serviço de dados pelo atributo `HasStream` aplicado a um tipo de entidade que é a entrada do link da mídia.</span><span class="sxs-lookup"><span data-stu-id="db77f-115">An entity that has a related media resource stream is indicated in the data service metadata by the `HasStream` attribute applied to an entity type that is the media link entry.</span></span> <span data-ttu-id="db77f-116">No exemplo a seguir, o `PhotoInfo` entidade é uma entrada de link de mídia que tem um recurso de mídia relacionado, indicado pelo `HasStream` atributo.</span><span class="sxs-lookup"><span data-stu-id="db77f-116">In the following example, the `PhotoInfo` entity is a media link entry that has a related media resource, indicated by the `HasStream` attribute.</span></span>  
  
 [!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria photo streaming service/xml/photodata.edmx#hasstream)]  
  
 <span data-ttu-id="db77f-117">Os outros exemplos deste tópico mostram como acessar e alterar o fluxo de recursos de mídia.</span><span class="sxs-lookup"><span data-stu-id="db77f-117">The remaining examples in this topic show how to access and change the media resource stream.</span></span> <span data-ttu-id="db77f-118">Para obter um exemplo completo de como consumir um fluxo de recursos de mídia em um aplicativo de cliente do .NET Framework usando o [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] biblioteca de cliente, consulte a postagem [acessando um Stream de recurso de mídia do cliente](https://go.microsoft.com/fwlink/?LinkID=201637).</span><span class="sxs-lookup"><span data-stu-id="db77f-118">For a complete example of how to consume a media resource stream in a .NET Framework client application by using the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library, see the post [Accessing a Media Resource Stream from the Client](https://go.microsoft.com/fwlink/?LinkID=201637).</span></span>  
  
## <a name="accessing-the-binary-resource-stream"></a><span data-ttu-id="db77f-119">Acessando o fluxo de recursos binários</span><span class="sxs-lookup"><span data-stu-id="db77f-119">Accessing the Binary Resource Stream</span></span>  
 <span data-ttu-id="db77f-120">A biblioteca de cliente do [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] fornece métodos para acessar fluxos de recursos binários de um serviço de dados baseado no [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="db77f-120">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library provides methods for accessing binary resource streams from an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]-based data service.</span></span> <span data-ttu-id="db77f-121">Ao baixar um recurso de mídia, você pode usar o URI do recurso de mídia ou obter um fluxo binário que contém os dados próprios do recurso de mídia.</span><span class="sxs-lookup"><span data-stu-id="db77f-121">When downloading a media resource, you can either use the URI of the media resource or you can get a binary stream that contains the media resource data itself.</span></span> <span data-ttu-id="db77f-122">Você também pode carregar dados dos recursos de mídia como um fluxo binário.</span><span class="sxs-lookup"><span data-stu-id="db77f-122">You can also upload media resource data as a binary stream.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="db77f-123">Para obter um exemplo passo a passo de como criar um aplicativo de cliente do Windows Presentation Foundation (WPF) que baixa os arquivos de imagem binária de um [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] serviço que armazena fotos, consulte a postagem [dados dos serviços de Streaming provedor série partes 2: Acessando um Stream de recurso de mídia do cliente](https://go.microsoft.com/fwlink/?LinkId=201637).</span><span class="sxs-lookup"><span data-stu-id="db77f-123">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://go.microsoft.com/fwlink/?LinkId=201637).</span></span> <span data-ttu-id="db77f-124">Para baixar o código de exemplo para o serviço de dados de fotos de fluxo em destaque na postagem do blog, consulte o [exemplo de serviço de dados de fotos de Streaming](https://go.microsoft.com/fwlink/?LinkId=198988) na Galeria de códigos do MSDN.</span><span class="sxs-lookup"><span data-stu-id="db77f-124">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://go.microsoft.com/fwlink/?LinkId=198988) in MSDN Code Gallery.</span></span>  
  
### <a name="getting-the-uri-of-the-binary-stream"></a><span data-ttu-id="db77f-125">Obtendo o URI do fluxo binário</span><span class="sxs-lookup"><span data-stu-id="db77f-125">Getting the URI of the Binary Stream</span></span>  
 <span data-ttu-id="db77f-126">Para recuperar determinados tipos de recursos de mídia, como imagens e outros arquivos de mídia, geralmente é mais fácil usar o URI do recurso de mídia em seu aplicativo do que manipular o próprio fluxo de dados binários.</span><span class="sxs-lookup"><span data-stu-id="db77f-126">When retrieving certain types of media resources, such as images and other media files, it is often easier to use the URI of the media resource in your application than handling the binary data stream itself.</span></span> <span data-ttu-id="db77f-127">Para obter o URI de um fluxo de recursos associado a uma determinada entrada de link de mídia, você deve chamar o método <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> na instância de <xref:System.Data.Services.Client.DataServiceContext> que está controlando a entidade.</span><span class="sxs-lookup"><span data-stu-id="db77f-127">To get the URI of a resource stream associated with a give media link entry, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="db77f-128">O exemplo a seguir mostra como chamar o método <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> para obter o URI de um fluxo de recursos de mídia que é usado para criar uma nova imagem no cliente:</span><span class="sxs-lookup"><span data-stu-id="db77f-128">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method to get the URI of a media resource stream that is used to create a new image on the client:</span></span>  
  
 [!code-csharp[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria photo streaming client/cs/photowindow.xaml.cs#getreadstreamuri)]
 [!code-vb[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria photo streaming client/vb/photowindow.xaml.vb#getreadstreamuri)]  
  
### <a name="downloading-the-binary-resource-stream"></a><span data-ttu-id="db77f-129">Baixando o fluxo de recursos binários</span><span class="sxs-lookup"><span data-stu-id="db77f-129">Downloading the Binary Resource Stream</span></span>  
 <span data-ttu-id="db77f-130">Para recuperar um fluxo de recursos binários, você deve chamar o método <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> na instância de <xref:System.Data.Services.Client.DataServiceContext> que está controlando a entrada de link de mídia.</span><span class="sxs-lookup"><span data-stu-id="db77f-130">When retrieving a binary resource stream, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the media link entry.</span></span> <span data-ttu-id="db77f-131">Esse método envia uma solicitação ao serviço de dados que retorna um objeto <xref:System.Data.Services.Client.DataServiceStreamResponse>, que tem uma referência ao fluxo que contém o recurso.</span><span class="sxs-lookup"><span data-stu-id="db77f-131">This method sends a request to the data service that returns a <xref:System.Data.Services.Client.DataServiceStreamResponse> object, which has a reference to the stream that contains the resource.</span></span> <span data-ttu-id="db77f-132">Use esse método quando o aplicativo exigir o recurso binário como um <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="db77f-132">Use this method when your application requires the binary resource as a <xref:System.IO.Stream>.</span></span> <span data-ttu-id="db77f-133">O exemplo a seguir mostra como chamar o método <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> para recuperar um fluxo que é usado para criar uma nova imagem no cliente:</span><span class="sxs-lookup"><span data-stu-id="db77f-133">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method to retrieve a stream that is used to create a new image on the client:</span></span>  
  
 [!code-csharp[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria streaming client/cs/customerphotowindow.xaml.cs#getreadstreamclient)]
 [!code-vb[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria streaming client/vb/customerphotowindow.xaml.vb#getreadstreamclient)]  
  
> [!NOTE]
>  <span data-ttu-id="db77f-134">O cabeçalho do comprimento do conteúdo na mensagem de resposta que contém o vapor binário não é definido pelo serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="db77f-134">The Content-Length header in the response message that contains the binary steam is not set by the data service.</span></span> <span data-ttu-id="db77f-135">Esse valor pode não refletir o comprimento real do fluxo de dados binários.</span><span class="sxs-lookup"><span data-stu-id="db77f-135">This value may not reflect the actual length of the binary data stream.</span></span>  
  
### <a name="uploading-a-media-resource-as-a-stream"></a><span data-ttu-id="db77f-136">Carregando um recurso de mídia como um fluxo</span><span class="sxs-lookup"><span data-stu-id="db77f-136">Uploading a Media Resource as a Stream</span></span>  
 <span data-ttu-id="db77f-137">Para inserir ou atualizar um recurso de mídia, chame o método <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> na instância de <xref:System.Data.Services.Client.DataServiceContext> que está controlando a entidade.</span><span class="sxs-lookup"><span data-stu-id="db77f-137">To insert or update a media resource, call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="db77f-138">Esse método envia uma solicitação para o serviço de dados que contém a leitura dos recursos de mídia do fluxo fornecido.</span><span class="sxs-lookup"><span data-stu-id="db77f-138">This method sends a request to the data service that contains the media resource read from the supplied stream.</span></span> <span data-ttu-id="db77f-139">O exemplo a seguir mostra como chamar o método <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> para enviar uma imagem ao serviço de dados:</span><span class="sxs-lookup"><span data-stu-id="db77f-139">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to send an image to the data service:</span></span>  
  
 [!code-csharp[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria photo streaming client/cs/photodetailswindow.xaml.cs#setsavestream)]
 [!code-vb[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria photo streaming client/vb/photodetailswindow.xaml.vb#setsavestream)]  
  
 <span data-ttu-id="db77f-140">Neste exemplo, o método <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> é chamado fornecendo um valor de `true` para o parâmetro `closeStream`.</span><span class="sxs-lookup"><span data-stu-id="db77f-140">In this example, the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method is called by supplying a value of `true` for the `closeStream` parameter.</span></span> <span data-ttu-id="db77f-141">Isso garante que o <xref:System.Data.Services.Client.DataServiceContext> feche o fluxo depois que os dados binários forem carregados no serviço de dados.</span><span class="sxs-lookup"><span data-stu-id="db77f-141">This guarantees that the <xref:System.Data.Services.Client.DataServiceContext> closes the stream after the binary data is uploaded to the data service.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="db77f-142">Quando você chama o <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, o fluxo não é enviado ao serviço de dados até que <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> seja chamado.</span><span class="sxs-lookup"><span data-stu-id="db77f-142">When you call <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, the stream is not sent to the data service until <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="db77f-143">Consulte também</span><span class="sxs-lookup"><span data-stu-id="db77f-143">See also</span></span>

- [<span data-ttu-id="db77f-144">Biblioteca de cliente do WCF Data Services</span><span class="sxs-lookup"><span data-stu-id="db77f-144">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
- [<span data-ttu-id="db77f-145">Associar dados a controles</span><span class="sxs-lookup"><span data-stu-id="db77f-145">Binding Data to Controls</span></span>](../../../../docs/framework/data/wcf/binding-data-to-controls-wcf-data-services.md)
