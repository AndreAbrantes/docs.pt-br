---
title: Escalonamento de gerenciamento de transações
ms.date: 03/30/2017
ms.assetid: 1e96331e-31b6-4272-bbbd-29ed1e110460
ms.openlocfilehash: 1e40244e1f6b5ffd7b52584a5da121d1203f8376
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64630565"
---
# <a name="transaction-management-escalation"></a><span data-ttu-id="8e044-102">Escalonamento de gerenciamento de transações</span><span class="sxs-lookup"><span data-stu-id="8e044-102">Transaction Management Escalation</span></span>
<span data-ttu-id="8e044-103">Windows hospeda um conjunto de serviços e módulos que constituem uma transação manager.</span><span class="sxs-lookup"><span data-stu-id="8e044-103">Windows hosts a set of services and modules that together constitute a transaction manager.</span></span> <span data-ttu-id="8e044-104">Escalonamento de gerenciamento de transações descreve o processo de migração de uma transação de um dos componentes do Gerenciador de transações para outro.</span><span class="sxs-lookup"><span data-stu-id="8e044-104">Transaction management escalation describes the process of migrating a transaction from one of the transaction manager's components to another.</span></span>  
  
 <span data-ttu-id="8e044-105"><xref:System.Transactions> inclui um componente de Gerenciador de transações que coordena uma transação envolvendo no máximo, um único recurso durável ou vários recursos voláteis.</span><span class="sxs-lookup"><span data-stu-id="8e044-105"><xref:System.Transactions> includes a transaction manager component that coordinates a transaction involving at most, a single durable resource or multiple volatile resources.</span></span> <span data-ttu-id="8e044-106">Como o Gerenciador de transações usa apenas chamadas de domínio intra-aplicativo, ele gera o melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="8e044-106">Because the transaction manager uses only intra-application domain calls, it yields the best performance.</span></span> <span data-ttu-id="8e044-107">Os desenvolvedores não precisam interagir diretamente com o Gerenciador de transações.</span><span class="sxs-lookup"><span data-stu-id="8e044-107">Developers need not interact with the transaction manager directly.</span></span> <span data-ttu-id="8e044-108">Em vez disso, uma infra-estrutura comum que define o comportamento comum, interfaces e classes auxiliares é fornecida pelo <xref:System.Transactions> namespace.</span><span class="sxs-lookup"><span data-stu-id="8e044-108">Instead, a common infrastructure that defines interfaces, common behavior, and helper classes is provided by the <xref:System.Transactions> namespace.</span></span>  
  
 <span data-ttu-id="8e044-109">Quando você deseja fornecer a transação a um objeto em outro domínio de aplicativo (incluindo entre limites de processo e da máquinas) no mesmo computador, o <xref:System.Transactions> infra-estrutura aumenta automaticamente a transação a ser gerenciado pelo Microsoft Coordenador de transações distribuídas (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="8e044-109">When you want to provide the transaction to an object in another application domain (including across process and machine boundaries) on the same computer, the <xref:System.Transactions> infrastructure automatically escalates the transaction to be managed by the Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="8e044-110">O escalonamento também ocorrerá se você inscrever outro gerenciador de recursos duráveis.</span><span class="sxs-lookup"><span data-stu-id="8e044-110">The escalation also occurs if you enlist another durable resource manager.</span></span> <span data-ttu-id="8e044-111">Quando escalonado, a transação permanecerá gerenciada em seu estado com privilégios elevados até sua conclusão.</span><span class="sxs-lookup"><span data-stu-id="8e044-111">When escalated, the transaction remains managed in its elevated state until its completion.</span></span>  
  
 <span data-ttu-id="8e044-112">Entre os <xref:System.Transactions> transação e transação MSDTC, existe um tipo de intermediário da transação que é disponibilizado por meio de inscrição de fase única (PSPE) podem ser promovidas.</span><span class="sxs-lookup"><span data-stu-id="8e044-112">Between the <xref:System.Transactions> transaction and MSDTC transaction, there is an intermediary type of transaction that is made available through the Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="8e044-113">PSPE é outro mecanismo importante em <xref:System.Transactions> para otimizar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="8e044-113">PSPE is another important mechanism in <xref:System.Transactions> for performance optimization.</span></span> <span data-ttu-id="8e044-114">Ele permite que um recurso durável remoto localizado em um domínio de aplicativo diferente, o processo ou o computador participe de um <xref:System.Transactions> transação sem fazer com que ele ser escalonado para uma transação MSDTC.</span><span class="sxs-lookup"><span data-stu-id="8e044-114">It allows a remote durable resource, located in a different application domain, process or computer, to participate in a <xref:System.Transactions> transaction without causing it to be escalated to an MSDTC transaction.</span></span> <span data-ttu-id="8e044-115">Para obter mais informações sobre PSPE, consulte [inscrever-se a recursos como participantes em uma transação](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="8e044-115">For more information about PSPE, see [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md).</span></span>  
  
## <a name="how-escalation-is-initiated"></a><span data-ttu-id="8e044-116">Como o escalonamento de bloqueios é iniciado</span><span class="sxs-lookup"><span data-stu-id="8e044-116">How Escalation is Initiated</span></span>  
 <span data-ttu-id="8e044-117">Escalonamento de bloqueios de transação reduz o desempenho porque o MSDTC reside em um processo separado e escalonar uma transação ao MSDTC resulta em mensagens sendo enviadas em processo.</span><span class="sxs-lookup"><span data-stu-id="8e044-117">Transaction escalation reduces performance because the MSDTC resides in a separate process, and escalating a transaction to the MSDTC results in messages being sent across process.</span></span> <span data-ttu-id="8e044-118">Para melhorar o desempenho, você deve atrasar ou evitar o escalonamento para MSDTC; Portanto, você precisa saber como e quando o escalonamento é iniciado.</span><span class="sxs-lookup"><span data-stu-id="8e044-118">To improve performance, you should delay or avoid escalation to MSDTC; thus, you need to know how and when the escalation is initiated.</span></span>  
  
 <span data-ttu-id="8e044-119">Como o <xref:System.Transactions> infra-estrutura trata recursos voláteis e no máximo uma durável de recurso que dá suporte a notificações de fase única, a transação permanece na propriedade do <xref:System.Transactions> infra-estrutura.</span><span class="sxs-lookup"><span data-stu-id="8e044-119">As long as the <xref:System.Transactions> infrastructure handles volatile resources and at most one durable resource that supports single-phase notifications, the transaction remains in the ownership of the <xref:System.Transactions> infrastructure.</span></span> <span data-ttu-id="8e044-120">O Gerenciador de transações avails em si, apenas a esses recursos que ao vivo no mesmo domínio do aplicativo e para o qual o log (gravar o resultado da transação no disco) não é necessário.</span><span class="sxs-lookup"><span data-stu-id="8e044-120">The transaction manager avails itself only to those resources that live in the same application domain and for which logging (writing the transaction outcome to disk) is not required.</span></span> <span data-ttu-id="8e044-121">Um escalonamento resulta no <xref:System.Transactions> infra-estrutura, transferindo a propriedade da transação ao MSDTC acontece quando:</span><span class="sxs-lookup"><span data-stu-id="8e044-121">An escalation that results in the <xref:System.Transactions> infrastructure transferring the ownership of the transaction to MSDTC happens when:</span></span>  
  
- <span data-ttu-id="8e044-122">Pelo menos um recurso durável que não dá suporte a notificações de fase única é inscrita na transação.</span><span class="sxs-lookup"><span data-stu-id="8e044-122">At least one durable resource that does not support single-phase notifications is enlisted in the transaction.</span></span>  
  
- <span data-ttu-id="8e044-123">Pelo menos dois recursos duráveis que oferecem suporte a notificações de fase única estão inscritos na transação.</span><span class="sxs-lookup"><span data-stu-id="8e044-123">At least two durable resources that support single-phase notifications are enlisted in the transaction.</span></span> <span data-ttu-id="8e044-124">Por exemplo, a inscrição de uma única conexão com [!INCLUDE[sqprsqlong](../../../../includes/sqprsqlong-md.md)] não faz com que uma transação seja promovido.</span><span class="sxs-lookup"><span data-stu-id="8e044-124">For example, enlisting a single connection with [!INCLUDE[sqprsqlong](../../../../includes/sqprsqlong-md.md)] does not cause a transaction to be promoted.</span></span> <span data-ttu-id="8e044-125">No entanto, sempre que você abrir uma segunda conexão com um [!INCLUDE[sqprsqlong](../../../../includes/sqprsqlong-md.md)] banco de dados fazendo com que o banco de dados para se inscrever, o <xref:System.Transactions> infra-estrutura detecta que ele é o segundo recurso durável na transação e escala para uma transação MSDTC.</span><span class="sxs-lookup"><span data-stu-id="8e044-125">However, whenever you open a second connection to a [!INCLUDE[sqprsqlong](../../../../includes/sqprsqlong-md.md)] database causing the database to enlist, the <xref:System.Transactions> infrastructure detects that it is the second durable resource in the transaction, and escalates it to an MSDTC transaction.</span></span>  
  
- <span data-ttu-id="8e044-126">Uma solicitação de "empacotar" a transação para um domínio de aplicativo diferente ou outro processo é chamada.</span><span class="sxs-lookup"><span data-stu-id="8e044-126">A request to "marshal" the transaction to a different application domain or different process is invoked.</span></span> <span data-ttu-id="8e044-127">Por exemplo, a serialização do objeto de transação em um limite de domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8e044-127">For example, the serialization of the transaction object across an application domain boundary.</span></span> <span data-ttu-id="8e044-128">O objeto de transação é empacotado por valor, que significa que qualquer tentativa de passá-lo em um limite de domínio de aplicativo (e até mesmo no mesmo processo) resulta na serialização do objeto de transação.</span><span class="sxs-lookup"><span data-stu-id="8e044-128">The transaction object is marshaled-by-value, meaning that any attempt to pass it across an application domain boundary (even in the same process) results in serialization of the transaction object.</span></span> <span data-ttu-id="8e044-129">Você pode passar os objetos de transação, fazendo uma chamada em um método remoto que usa um <xref:System.Transactions.Transaction> como um parâmetro ou você pode tentar acessar um componente remoto transacional é atendido.</span><span class="sxs-lookup"><span data-stu-id="8e044-129">You can pass the transaction objects by making a call on a remote method that takes a <xref:System.Transactions.Transaction> as a parameter or you can try to access a remote transactional-serviced component.</span></span> <span data-ttu-id="8e044-130">Isso serializa o objeto de transação e resulta em um escalonamento, como quando uma transação é serializada em um domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8e044-130">This serializes the transaction object and results in an escalation, as when a transaction is serialized across an application domain.</span></span> <span data-ttu-id="8e044-131">Ele é distribuído e o Gerenciador de transações local não é mais adequado.</span><span class="sxs-lookup"><span data-stu-id="8e044-131">It is being distributed and the local transaction manager is no longer adequate.</span></span>  
  
 <span data-ttu-id="8e044-132">A tabela a seguir lista todas as exceções possíveis que podem ser geradas durante a expansão.</span><span class="sxs-lookup"><span data-stu-id="8e044-132">The following table lists all the possible exceptions that can be thrown during escalation.</span></span>  
  
|<span data-ttu-id="8e044-133">Tipo de exceção</span><span class="sxs-lookup"><span data-stu-id="8e044-133">Exception type</span></span>|<span data-ttu-id="8e044-134">Condição</span><span class="sxs-lookup"><span data-stu-id="8e044-134">Condition</span></span>|  
|--------------------|---------------|  
|<xref:System.InvalidOperationException>|<span data-ttu-id="8e044-135">Uma tentativa para escalonar uma transação com o nível de isolamento igual a <xref:System.Transactions.IsolationLevel.Snapshot>.</span><span class="sxs-lookup"><span data-stu-id="8e044-135">An attempt to escalate a transaction with isolation level equal to <xref:System.Transactions.IsolationLevel.Snapshot>.</span></span>|  
|<xref:System.Transactions.TransactionAbortedException>|<span data-ttu-id="8e044-136">O Gerenciador de transações está inativo.</span><span class="sxs-lookup"><span data-stu-id="8e044-136">The transaction manager is down.</span></span>|  
|<xref:System.Transactions.TransactionException>|<span data-ttu-id="8e044-137">O escalonamento de bloqueios falha e o aplicativo será anulado.</span><span class="sxs-lookup"><span data-stu-id="8e044-137">The escalation fails and the application is aborted.</span></span>|
