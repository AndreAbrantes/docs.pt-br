---
title: "Inscrição de recursos como participantes em uma transação"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 786a12c2-d530-49f4-9c59-5c973e15a11d
caps.latest.revision: "3"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 270b3755901e3c5bc95352b5f3d07a338e73a90e
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="enlisting-resources-as-participants-in-a-transaction"></a><span data-ttu-id="2200c-102">Inscrição de recursos como participantes em uma transação</span><span class="sxs-lookup"><span data-stu-id="2200c-102">Enlisting Resources as Participants in a Transaction</span></span>
<span data-ttu-id="2200c-103">Cada recurso que participa de uma transação é gerenciado por um Gerenciador de recursos, as ações são coordenadas por um Gerenciador de transações.</span><span class="sxs-lookup"><span data-stu-id="2200c-103">Each resource participating in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="2200c-104">A coordenação é feita por meio de notificações para assinantes que tem se inscrito em uma transação por meio do Gerenciador de transações.</span><span class="sxs-lookup"><span data-stu-id="2200c-104">The coordination is done through notifications given to subscribers who have enlisted in a transaction through the transaction manager.</span></span>  
  
 <span data-ttu-id="2200c-105">Este tópico aborda como um recurso (ou vários recursos) podem ser inscrita em uma transação, bem como os diferentes tipos de inscrição.</span><span class="sxs-lookup"><span data-stu-id="2200c-105">This topic covers how a resource (or multiple resources) can be enlisted in a transaction, as well as the different types of enlistment.</span></span> <span data-ttu-id="2200c-106">O [confirmar uma transação de fase única e de várias fases](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) tópico aborda como confirmação de transação pode ser coordenada entre recursos.</span><span class="sxs-lookup"><span data-stu-id="2200c-106">The [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) topic covers how transaction commitment can be coordinated among enlisted resources.</span></span>  
  
## <a name="enlisting-resources-in-a-transaction"></a><span data-ttu-id="2200c-107">Recursos de inscrição em uma transação</span><span class="sxs-lookup"><span data-stu-id="2200c-107">Enlisting Resources in a Transaction</span></span>  
 <span data-ttu-id="2200c-108">Em ordem para um recurso para participar de uma transação, ele deve se inscrever na transação.</span><span class="sxs-lookup"><span data-stu-id="2200c-108">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="2200c-109">O <xref:System.Transactions.Transaction> classe define um conjunto de métodos cujos nomes começam com **Enlist** que fornecem essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="2200c-109">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="2200c-110">Os diferentes **Enlist** métodos correspondem a diferentes tipos de inscrição que pode ter um Gerenciador de recursos.</span><span class="sxs-lookup"><span data-stu-id="2200c-110">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="2200c-111">Especificamente, você usa o <xref:System.Transactions.Transaction.EnlistVolatile%2A> métodos para recursos voláteis e o <xref:System.Transactions.Transaction.EnlistDurable%2A> método Recursos duráveis.</span><span class="sxs-lookup"><span data-stu-id="2200c-111">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="2200c-112">A durabilidade (ou o inverso a volatilidade) de um recurso Gerenciador refere-se ao Gerenciador de recursos oferece suporte a recuperação de falhas.</span><span class="sxs-lookup"><span data-stu-id="2200c-112">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="2200c-113">Se um Gerenciador de recursos oferece suporte à recuperação de falha, ele persiste os dados para o armazenamento durável durante da Fase1 (preparar), de modo que, se o Gerenciador de recursos de ficar inativo, ele pode novamente se inscrever na transação após a recuperação e executar as ações apropriadas com base em notificações recebidas de TM.</span><span class="sxs-lookup"><span data-stu-id="2200c-113">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the TM.</span></span> <span data-ttu-id="2200c-114">Em geral, os gerenciadores de recursos voláteis gerenciar recursos voláteis, como uma estrutura de dados na memória (por exemplo, na memória transacionado-hashtable) e gerenciadores de recursos duráveis gerenciar recursos em um repositório de backup mais persistente (por exemplo, um banco de dados cujo armazenamento de backup em disco).</span><span class="sxs-lookup"><span data-stu-id="2200c-114">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>  
  
 <span data-ttu-id="2200c-115">Para simplificar, depois de decidir se deseja usar o <xref:System.Transactions.Transaction.EnlistDurable%2A> ou <xref:System.Transactions.Transaction.EnlistVolatile%2A> método com base no suporte a durabilidade do recurso, você deve inscrever o recurso para participar de dois a fase de confirmação (2PC), Implementando o <xref:System.Transactions.IEnlistmentNotification> interface para seu Gerenciador de recursos.</span><span class="sxs-lookup"><span data-stu-id="2200c-115">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="2200c-116">Para obter mais informações sobre 2PC, consulte [confirmar uma transação de fase única e de várias fases](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="2200c-116">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>  
  
 <span data-ttu-id="2200c-117">Um único participante pode se inscrever para mais de um desses protocolos chamando <xref:System.Transactions.Transaction.EnlistDurable%2A> e <xref:System.Transactions.Transaction.EnlistVolatile%2A> várias vezes.</span><span class="sxs-lookup"><span data-stu-id="2200c-117">A single participant can enlist for more than one of these protocols by calling <xref:System.Transactions.Transaction.EnlistDurable%2A> and <xref:System.Transactions.Transaction.EnlistVolatile%2A> multiple times.</span></span>  
  
### <a name="durable-enlistment"></a><span data-ttu-id="2200c-118">Distribuição durável</span><span class="sxs-lookup"><span data-stu-id="2200c-118">Durable Enlistment</span></span>  
 <span data-ttu-id="2200c-119">O <xref:System.Transactions.Transaction.EnlistDurable%2A> métodos são usados para inscrever um Gerenciador de recursos de participação na transação como um recurso durável.</span><span class="sxs-lookup"><span data-stu-id="2200c-119">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods are used to enlist a resource manager for participation in the transaction as a durable resource.</span></span>  <span data-ttu-id="2200c-120">Espera-se que se um Gerenciador de recursos durável é interrompido no meio de uma transação, ele pode realizar recuperação depois que ele é colocado online pelo reenlisting (usando o <xref:System.Transactions.TransactionManager.Reenlist%2A> método) em todas as transações em que ele foi um participante e não concluiu a fase 2 e chamar <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> depois que ele termine o processamento de recuperação.</span><span class="sxs-lookup"><span data-stu-id="2200c-120">It is expected that if a durable resource manager is brought down in the middle of a transaction, it can perform recovery once it is brought back online by reenlisting (using the <xref:System.Transactions.TransactionManager.Reenlist%2A> method) in all transactions in which it was a participant and did not complete phase 2, and call <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> once it finishes recovery processing.</span></span> <span data-ttu-id="2200c-121">Para obter mais informações sobre a recuperação, consulte [executar recuperação](../../../../docs/framework/data/transactions/performing-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="2200c-121">For more information on recovery, see [Performing Recovery](../../../../docs/framework/data/transactions/performing-recovery.md).</span></span>  
  
 <span data-ttu-id="2200c-122">O <xref:System.Transactions.Transaction.EnlistDurable%2A> métodos usam um <xref:System.Guid> objeto como seu primeiro parâmetro.</span><span class="sxs-lookup"><span data-stu-id="2200c-122">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods all take a <xref:System.Guid> object as their first parameter.</span></span> <span data-ttu-id="2200c-123">O <xref:System.Guid> é usado pelo Gerenciador de transações para associar uma distribuição durável com um Gerenciador de recursos específico.</span><span class="sxs-lookup"><span data-stu-id="2200c-123">The <xref:System.Guid> is used by the transaction manager to associate a durable enlistment with a particular resource manager.</span></span> <span data-ttu-id="2200c-124">Como tal, é imperativo que um Gerenciador de recursos consistentemente usa o mesmo <xref:System.Guid> para identificar em si mesmo entre diferentes gerentes de recursos após a reinicialização, caso contrário, a recuperação poderá falhar.</span><span class="sxs-lookup"><span data-stu-id="2200c-124">As such, it is imperative that a resource manager consistently uses the same <xref:System.Guid> to identify itself even across different resource managers upon restarting, otherwise the recovery can fail.</span></span>  
  
 <span data-ttu-id="2200c-125">O segundo parâmetro do <xref:System.Transactions.Transaction.EnlistDurable%2A> método é uma referência ao objeto que implementa o Gerenciador de recursos para receber notificações de transação.</span><span class="sxs-lookup"><span data-stu-id="2200c-125">The second parameter of the <xref:System.Transactions.Transaction.EnlistDurable%2A> method is a reference to the object that the resource manager implements to receive transaction notifications.</span></span> <span data-ttu-id="2200c-126">A sobrecarga que é usar informa o Gerenciador de transações se seu Gerenciador de recursos oferece suporte a otimização de confirmação de fase única (SPC).</span><span class="sxs-lookup"><span data-stu-id="2200c-126">The overload you use informs the transaction manager whether your resource manager supports the Single Phase Commit (SPC) optimization.</span></span> <span data-ttu-id="2200c-127">Na maioria das vezes você implementaria o <xref:System.Transactions.IEnlistmentNotification> interface para fazer parte de protocolo 2PC (2PC).</span><span class="sxs-lookup"><span data-stu-id="2200c-127">Most of the time you would implement the <xref:System.Transactions.IEnlistmentNotification> interface to take part in Two-Phase Commit (2PC).</span></span> <span data-ttu-id="2200c-128">No entanto, se você deseja otimizar o processo de confirmação, você pode considerar a implementação de <xref:System.Transactions.ISinglePhaseNotification> interface para SPC.</span><span class="sxs-lookup"><span data-stu-id="2200c-128">However, if you want to optimize the commit process, you can consider implementing the <xref:System.Transactions.ISinglePhaseNotification> interface for SPC.</span></span> <span data-ttu-id="2200c-129">Para obter mais informações sobre SPC, consulte [confirmar uma transação de fase única e de várias fases](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) e [otimização usando única fase de confirmação e notificação de fase única passível de promoção](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="2200c-129">For more information on SPC, see [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) and [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>  
  
 <span data-ttu-id="2200c-130">O terceiro parâmetro é um <xref:System.Transactions.EnlistmentOptions> enumeração, cujo valor pode ser <xref:System.Transactions.EnlistmentOptions.None> ou <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span><span class="sxs-lookup"><span data-stu-id="2200c-130">The third parameter is an <xref:System.Transactions.EnlistmentOptions> enumeration, whose value can be either <xref:System.Transactions.EnlistmentOptions.None> or <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span></span> <span data-ttu-id="2200c-131">Se o valor for definido como <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, a inscrição pode inscrever gerenciadores de recursos adicionais depois de receber a notificação de preparação do Gerenciador de transações.</span><span class="sxs-lookup"><span data-stu-id="2200c-131">If the value is set to <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, the enlistment may enlist additional resource managers upon receiving the Prepare notification from the transaction manager.</span></span> <span data-ttu-id="2200c-132">No entanto, você deve estar ciente de que esse tipo de inscrição não está qualificado para a otimização de confirmação de fase única.</span><span class="sxs-lookup"><span data-stu-id="2200c-132">However, you should be aware that this type of enlistment is not eligible for the Single Phase Commit optimization.</span></span>  
  
### <a name="volatile-enlistment"></a><span data-ttu-id="2200c-133">Inscrição volátil</span><span class="sxs-lookup"><span data-stu-id="2200c-133">Volatile Enlistment</span></span>  
 <span data-ttu-id="2200c-134">Participantes do gerenciamento de recursos voláteis, como um cache deve inscrever usando o <xref:System.Transactions.Transaction.EnlistVolatile%2A> métodos.</span><span class="sxs-lookup"><span data-stu-id="2200c-134">Participants managing volatile resources such as a cache should enlist using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods.</span></span> <span data-ttu-id="2200c-135">Esses objetos não poderá obter o resultado de uma transação ou recuperar o estado de qualquer transação que participam após uma falha do sistema.</span><span class="sxs-lookup"><span data-stu-id="2200c-135">Such objects might not be able to obtain the outcome of a transaction or recover the state of any transaction they participate in after a system failure.</span></span>  
  
 <span data-ttu-id="2200c-136">Conforme mencionado anteriormente, um Gerenciador de recursos se tornaria uma inscrição volátil se gerencia na memória e recursos voláteis.</span><span class="sxs-lookup"><span data-stu-id="2200c-136">As stated previously, a resource manager would make a volatile enlistment if it manages an in-memory, volatile resource.</span></span> <span data-ttu-id="2200c-137">Um dos benefícios do uso de <xref:System.Transactions.Transaction.EnlistVolatile%2A> é que ele não forçar um escalonamento desnecessário da transação.</span><span class="sxs-lookup"><span data-stu-id="2200c-137">One of the benefits of using <xref:System.Transactions.Transaction.EnlistVolatile%2A> is that it does not force an unnecessary escalation of the transaction.</span></span> <span data-ttu-id="2200c-138">Para obter mais informações sobre o escalonamento de bloqueios de transação, consulte [escalonamento de bloqueios de gerenciamento de transação](../../../../docs/framework/data/transactions/transaction-management-escalation.md) tópico.</span><span class="sxs-lookup"><span data-stu-id="2200c-138">For more information on transaction escalation, see [Transaction Management Escalation](../../../../docs/framework/data/transactions/transaction-management-escalation.md) topic.</span></span> <span data-ttu-id="2200c-139">Inscrevendo volatilely implica a diferença em como a inscrição é manipulada pelo Gerenciador de transações, bem como o esperado do Gerenciador de recursos pelo Gerenciador de transações.</span><span class="sxs-lookup"><span data-stu-id="2200c-139">Enlisting volatilely implies both a difference in how the enlistment is handled by the transaction manager, as well as what is expected of the resource manager by the transaction manager.</span></span> <span data-ttu-id="2200c-140">Isso ocorre porque um Gerenciador de recursos volátil não executar a recuperação.</span><span class="sxs-lookup"><span data-stu-id="2200c-140">This is because a volatile resource manager does not perform recovery.</span></span> <span data-ttu-id="2200c-141">O <xref:System.Transactions.Transaction.EnlistVolatile%2A> métodos não têm um <xref:System.Guid> parâmetro, porque um Gerenciador de recursos volátil não realiza recuperação e não chama o <xref:System.Transactions.TransactionManager.Reenlist%2A> método que precisa de um <xref:System.Guid>.</span><span class="sxs-lookup"><span data-stu-id="2200c-141">The <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods do not take a <xref:System.Guid> parameter, because a volatile resource manager does not perform recovery and would not call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method which needs a <xref:System.Guid>.</span></span>  
  
 <span data-ttu-id="2200c-142">Assim como acontece com inscrições duráveis, independentemente do método sobrecarga que você pode usar para se inscrever indica para o Gerenciador de transações se seu Gerenciador de recursos oferece suporte a otimização de confirmação de fase única.</span><span class="sxs-lookup"><span data-stu-id="2200c-142">As with durable enlistments, whichever overload method you use to enlist denotes to the transaction manager whether your resource manager supports the Single Phase Commit optimization.</span></span> <span data-ttu-id="2200c-143">Como um Gerenciador de recursos volátil não pode realizar a recuperação, nenhuma informação de recuperação é criada para uma inscrição volátil durante a fase de preparação.</span><span class="sxs-lookup"><span data-stu-id="2200c-143">Since a volatile resource manager cannot perform recovery, no recovery information is written for a volatile enlistment during the Prepare phase.</span></span> <span data-ttu-id="2200c-144">Portanto, chamar o <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> método resulta em um <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="2200c-144">Therefore, calling the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> method results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="2200c-145">O exemplo a seguir mostra como se inscrever tal objeto como um participante em uma transação usando o <xref:System.Transactions.Transaction.EnlistVolatile%2A> método.</span><span class="sxs-lookup"><span data-stu-id="2200c-145">The following example shows how to enlist such an object as a participant in a transaction using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> method.</span></span>  
  
 [!code-csharp[Tx_Enlist#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_enlist/cs/enlist.cs#1)]
 [!code-vb[Tx_Enlist#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_enlist/vb/enlist.vb#1)]  
  
### <a name="optimizing-performance"></a><span data-ttu-id="2200c-146">Otimizando o desempenho</span><span class="sxs-lookup"><span data-stu-id="2200c-146">Optimizing Performance</span></span>  
 <span data-ttu-id="2200c-147">O <xref:System.Transactions.Transaction> classe também fornece o <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> método para inscrever um podem ser promovidas única fase de inscrição (PSPE).</span><span class="sxs-lookup"><span data-stu-id="2200c-147">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="2200c-148">Isso permite que um recurso durável manager (RM) para hospedar e "proprietário" de uma transação que posteriormente pode ser escalonada para ser gerenciado pelo MSDTC se necessário.</span><span class="sxs-lookup"><span data-stu-id="2200c-148">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="2200c-149">Para obter mais informações sobre isso, consulte [otimização usando única fase de confirmação e notificação de fase única passível de promoção](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="2200c-149">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2200c-150">Consulte também</span><span class="sxs-lookup"><span data-stu-id="2200c-150">See Also</span></span>  
 [<span data-ttu-id="2200c-151">Otimização usando confirmação de fase única e notificação de fase única promovível</span><span class="sxs-lookup"><span data-stu-id="2200c-151">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md)  
 [<span data-ttu-id="2200c-152">Confirmar uma transação de fase única e de várias fases</span><span class="sxs-lookup"><span data-stu-id="2200c-152">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md)
