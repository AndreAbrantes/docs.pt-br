---
title: Medindo o aprimoramento da inicialização com o .NET Nativo
ms.date: 03/30/2017
ms.assetid: c4d25b24-9c1a-4b3e-9705-97ba0d6c0289
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 74011a4c70cc8f7da3973698a43b1e97cffb9f9b
ms.sourcegitcommit: 33c8d6f7342a4bb2c577842b7f075b0e20a2fa40
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/12/2019
ms.locfileid: "70927075"
---
# <a name="measuring-startup-improvement-with-net-native"></a><span data-ttu-id="1c117-102">Medindo o aprimoramento da inicialização com o .NET Nativo</span><span class="sxs-lookup"><span data-stu-id="1c117-102">Measuring Startup Improvement with .NET Native</span></span>
<span data-ttu-id="1c117-103">.NET Native melhora significativamente o tempo de inicialização dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="1c117-103">.NET Native significantly improves the launch time of apps.</span></span> <span data-ttu-id="1c117-104">Esse aprimoramento é particularmente perceptível em dispositivos portáteis, de baixa energia e com aplicativos complexos.</span><span class="sxs-lookup"><span data-stu-id="1c117-104">This improvement is particularly noticeable on portable, low-powered devices and with complex apps.</span></span> <span data-ttu-id="1c117-105">Este tópico ajuda você a começar a trabalhar com a instrumentação básica necessária para medir essa melhoria de inicialização.</span><span class="sxs-lookup"><span data-stu-id="1c117-105">This topic helps you get started with the basic instrumentation needed to measure this startup improvement.</span></span>  
  
 <span data-ttu-id="1c117-106">Para facilitar a investigações de desempenho, o .NET Framework e o Windows usam uma estrutura de evento chamada ETW (Rastreamento de Eventos para Windows) que permite que seu aplicativo notifique as ferramentas quando eventos ocorrerem.</span><span class="sxs-lookup"><span data-stu-id="1c117-106">To facilitate performance investigations, the .NET Framework and Windows use an event framework called Event Tracing for Windows (ETW) that allows your app to notify tooling when events happen.</span></span> <span data-ttu-id="1c117-107">Em seguida, você pode usar uma ferramenta chamada PerfView para exibir e analisar eventos de ETW facilmente.</span><span class="sxs-lookup"><span data-stu-id="1c117-107">You can then use a tool called PerfView to easily view and analyze of ETW events.</span></span> <span data-ttu-id="1c117-108">Este tópico explica como:</span><span class="sxs-lookup"><span data-stu-id="1c117-108">This topic explains how to:</span></span>  
  
- <span data-ttu-id="1c117-109">Usar a classe <xref:System.Diagnostics.Tracing.EventSource> para emitir eventos.</span><span class="sxs-lookup"><span data-stu-id="1c117-109">Use the <xref:System.Diagnostics.Tracing.EventSource> class to emit events.</span></span>  
  
- <span data-ttu-id="1c117-110">Usar o PerfView para coletar tais eventos.</span><span class="sxs-lookup"><span data-stu-id="1c117-110">Use PerfView to gather those events.</span></span>  
  
- <span data-ttu-id="1c117-111">Usar o PerfView para coletar tais eventos.</span><span class="sxs-lookup"><span data-stu-id="1c117-111">Use PerfView to display those events.</span></span>  
  
## <a name="using-eventsource-to-emit-events"></a><span data-ttu-id="1c117-112">Usando o EventSource para emitir eventos</span><span class="sxs-lookup"><span data-stu-id="1c117-112">Using EventSource to emit events</span></span>  
 <span data-ttu-id="1c117-113">O <xref:System.Diagnostics.Tracing.EventSource> fornece uma classe base da qual criar um provedor de eventos personalizado.</span><span class="sxs-lookup"><span data-stu-id="1c117-113"><xref:System.Diagnostics.Tracing.EventSource> provides a base class from which to create a custom event provider.</span></span> <span data-ttu-id="1c117-114">Em geral, você pode criar uma subclasse de <xref:System.Diagnostics.Tracing.EventSource> e os métodos `Write*` com seus próprios métodos de evento.</span><span class="sxs-lookup"><span data-stu-id="1c117-114">Generally, you create a subclass of <xref:System.Diagnostics.Tracing.EventSource> and wrap the `Write*` methods with your own event methods.</span></span> <span data-ttu-id="1c117-115">Um padrão singleton geralmente é usado para cada <xref:System.Diagnostics.Tracing.EventSource>.</span><span class="sxs-lookup"><span data-stu-id="1c117-115">A singleton pattern is generally used for each <xref:System.Diagnostics.Tracing.EventSource>.</span></span>  
  
 <span data-ttu-id="1c117-116">Por exemplo, a classe no exemplo a seguir pode ser usada para medir duas características de desempenho:</span><span class="sxs-lookup"><span data-stu-id="1c117-116">For example, the class in the following example can be used to measure two performance characteristics:</span></span>  
  
- <span data-ttu-id="1c117-117">O tempo até que o construtor de classe `App` foi chamado.</span><span class="sxs-lookup"><span data-stu-id="1c117-117">The time until the `App` class constructor was called.</span></span>  
  
- <span data-ttu-id="1c117-118">O tempo até que o construtor `MainPage` foi chamado.</span><span class="sxs-lookup"><span data-stu-id="1c117-118">The time until the `MainPage` constructor was called.</span></span>  
  
 [!code-csharp[ProjectN_ETW#1](../../../samples/snippets/csharp/VS_Snippets_CLR/projectn_etw/cs/etw1.cs#1)]  
  
 <span data-ttu-id="1c117-119">Há algumas coisas a serem observadas aqui.</span><span class="sxs-lookup"><span data-stu-id="1c117-119">There are a few things to notice here.</span></span> <span data-ttu-id="1c117-120">Primeiro, um singleton é criado em `AppEventSource.Log`.</span><span class="sxs-lookup"><span data-stu-id="1c117-120">First, a singleton is created in `AppEventSource.Log`.</span></span> <span data-ttu-id="1c117-121">Essa instância será usada para todos os logs.</span><span class="sxs-lookup"><span data-stu-id="1c117-121">That instance will be used for all logging.</span></span> <span data-ttu-id="1c117-122">Em segundo lugar, cada método de evento possui um <xref:System.Diagnostics.Tracing.EventAttribute>.</span><span class="sxs-lookup"><span data-stu-id="1c117-122">Second, each event method has an <xref:System.Diagnostics.Tracing.EventAttribute>.</span></span> <span data-ttu-id="1c117-123">Isso ajuda as ferramentas associarem o índice do método <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> com o método que foi chamado em `AppEventSource`.</span><span class="sxs-lookup"><span data-stu-id="1c117-123">This helps tooling associate the index of the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method with the method that was called on `AppEventSource`.</span></span>  
  
 <span data-ttu-id="1c117-124">Observe que esses eventos são puramente ilustrativos.</span><span class="sxs-lookup"><span data-stu-id="1c117-124">Note that these events are purely illustrative.</span></span> <span data-ttu-id="1c117-125">A maioria dos códigos de aplicativo serão executado após esses eventos.</span><span class="sxs-lookup"><span data-stu-id="1c117-125">Most app code will run after these events.</span></span> <span data-ttu-id="1c117-126">Você deve compreender quais eventos no código correspondem às interações do usuário, os medem melhoram os parâmetros de comparação.</span><span class="sxs-lookup"><span data-stu-id="1c117-126">You should understand which events in code correspond to user interactions, measure those, and improve those benchmarks.</span></span> <span data-ttu-id="1c117-127">Além disso, os próprios eventos registram somente uma única instância no tempo.</span><span class="sxs-lookup"><span data-stu-id="1c117-127">Also, the events themselves log only a single instance in time.</span></span> <span data-ttu-id="1c117-128">Muitas vezes é útil ter eventos de início e interrupção emparelhados para cada operação.</span><span class="sxs-lookup"><span data-stu-id="1c117-128">It’s often useful to have paired start and stop events for every operation.</span></span> <span data-ttu-id="1c117-129">Quando examinar a inicialização do aplicativo, o evento de inicialização é geralmente o evento de "Processo/Iniciar" que o sistema operacional emite.</span><span class="sxs-lookup"><span data-stu-id="1c117-129">When examining app startup, the start event is generally the "Process/Start" event that the operating system emits.</span></span>  
  
 <span data-ttu-id="1c117-130">Por exemplo, suponha que você está criando um leitor de RSS.</span><span class="sxs-lookup"><span data-stu-id="1c117-130">For example, suppose you are creating an RSS reader.</span></span> <span data-ttu-id="1c117-131">Alguns locais interessantes para registrar um evento são:</span><span class="sxs-lookup"><span data-stu-id="1c117-131">A few interesting locations to log an event are:</span></span>  
  
- <span data-ttu-id="1c117-132">Quando a página principal é processada pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="1c117-132">When the main page is first rendered.</span></span>  
  
- <span data-ttu-id="1c117-133">Quando os textos de RSS antigos são desserializados do armazenamento local.</span><span class="sxs-lookup"><span data-stu-id="1c117-133">When old RSS stories are deserialized from local storage.</span></span>  
  
- <span data-ttu-id="1c117-134">Quando seu aplicativo começa a sincronização de novos textos.</span><span class="sxs-lookup"><span data-stu-id="1c117-134">When your app begins syncing new stories.</span></span>  
  
- <span data-ttu-id="1c117-135">Quando seu aplicativo concluir a sincronização dos textos novos.</span><span class="sxs-lookup"><span data-stu-id="1c117-135">When your app has finished syncing new stories.</span></span>  
  
 <span data-ttu-id="1c117-136">Instrumentação de um aplicativo é simples: Basta chamar o método apropriado na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="1c117-136">Instrumenting an app is straightforward: Just call the appropriate method on the derived class.</span></span> <span data-ttu-id="1c117-137">Usando o `AppEventSource` do exemplo anterior, você pode instrumentar um aplicativo da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="1c117-137">Using `AppEventSource` from the previous example, you can instrument an app as follows:</span></span>  
  
 [!code-csharp[ProjectN_ETW#2](../../../samples/snippets/csharp/VS_Snippets_CLR/projectn_etw/cs/etw2.cs#2)]  
  
 <span data-ttu-id="1c117-138">Quando o aplicativo for instrumentado, você estará pronto para coletar os eventos.</span><span class="sxs-lookup"><span data-stu-id="1c117-138">When the app is instrumented, you’re ready to gather events.</span></span>  
  
## <a name="gathering-events-with-perfview"></a><span data-ttu-id="1c117-139">Eventos de coleta com PerfView</span><span class="sxs-lookup"><span data-stu-id="1c117-139">Gathering events with PerfView</span></span>  
 <span data-ttu-id="1c117-140">O PerfView usa eventos ETW para ajudar você a executar todos os tipos de investigações de desempenho no seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1c117-140">PerfView uses ETW events to help you do all sorts of performance investigations on your app.</span></span> <span data-ttu-id="1c117-141">Ele também inclui uma configuração de GUI que permite ativar ou desativar os diferentes tipos de registro.</span><span class="sxs-lookup"><span data-stu-id="1c117-141">It also includes a configuration GUI that lets you turn logging for different types of events on or off.</span></span> <span data-ttu-id="1c117-142">O PerfView é uma ferramenta gratuita e pode ser baixado do [Centro de Download da Microsoft](https://www.microsoft.com/download/details.aspx?id=28567).</span><span class="sxs-lookup"><span data-stu-id="1c117-142">PerfView is a free tool and can be downloaded from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=28567).</span></span> <span data-ttu-id="1c117-143">Para obter mais informações, assista aos [vídeos de tutorial do PerfView](https://channel9.msdn.com/Series/PerfView-Tutorial).</span><span class="sxs-lookup"><span data-stu-id="1c117-143">For more information, watch the [PerfView tutorial videos](https://channel9.msdn.com/Series/PerfView-Tutorial).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1c117-144">O PerfView não pode ser usado para coletar os eventos nos sistemas ARM.</span><span class="sxs-lookup"><span data-stu-id="1c117-144">PerfView cannot be used to collect events on ARM systems.</span></span> <span data-ttu-id="1c117-145">Para coletar os eventos nos sistemas ARM, use o Windows Performance Recorder (WPR).</span><span class="sxs-lookup"><span data-stu-id="1c117-145">To collect events on ARM systems, use Windows Performance Recorder (WPR).</span></span> <span data-ttu-id="1c117-146">Para obter mais informações, consulte a [postagem no blog de Vance Morrison](https://blogs.msdn.microsoft.com/vancem/2012/12/19/collecting-etwperfview-data-on-an-windows-rt-winrt-arm-surface-device/).</span><span class="sxs-lookup"><span data-stu-id="1c117-146">For more information, see [Vance Morrison's blog post](https://blogs.msdn.microsoft.com/vancem/2012/12/19/collecting-etwperfview-data-on-an-windows-rt-winrt-arm-surface-device/).</span></span>  
  
 <span data-ttu-id="1c117-147">Você também pode invocar o PerfView da linha de comando.</span><span class="sxs-lookup"><span data-stu-id="1c117-147">You can also invoke PerfView from the command line.</span></span> <span data-ttu-id="1c117-148">Para registrar somente os eventos do provedor, abra a janela do Prompt de comandos e digite o comando:</span><span class="sxs-lookup"><span data-stu-id="1c117-148">To log only the events from your provider, open the Command Prompt window and enter the command:</span></span>  
  
```console
perfview -KernelEvents:Process -OnlyProviders:*MyCompany-MyApp collect outputFile   
```  
  
 <span data-ttu-id="1c117-149">em que:</span><span class="sxs-lookup"><span data-stu-id="1c117-149">where:</span></span>  
  
 `-KernelEvents:Process`  
 <span data-ttu-id="1c117-150">Indica que você deseja saber quando o processo é iniciado e é interrompido.</span><span class="sxs-lookup"><span data-stu-id="1c117-150">Indicates that you want to know when the process starts and stops.</span></span> <span data-ttu-id="1c117-151">É necessário que o evento de início/processo para seu aplicativo para pode ser subtraído de outros tempos de eventos.</span><span class="sxs-lookup"><span data-stu-id="1c117-151">You need the Process/Start event for your app so it can be subtracted from other event times.</span></span>  
  
 `-OnlyProviders:*MyCompany-MyApp`  
 <span data-ttu-id="1c117-152">Desativa todos os outros provedores que o PerfView ativa por padrão e ativa o provedor MyCompany-MyApp.</span><span class="sxs-lookup"><span data-stu-id="1c117-152">Turns off other providers that PerfView turns on by default, and turns on the MyCompany-MyApp provider.</span></span>  <span data-ttu-id="1c117-153">(O asterisco indica que é um <xref:System.Diagnostics.Tracing.EventSource>.)</span><span class="sxs-lookup"><span data-stu-id="1c117-153">(The asterisk indicates that it is an <xref:System.Diagnostics.Tracing.EventSource>.)</span></span>  
  
 `collect outputFile`  
 <span data-ttu-id="1c117-154">Indica que você deseja iniciar a coleta e salvar os dados para outputFile.etl.zip.</span><span class="sxs-lookup"><span data-stu-id="1c117-154">Indicates that you want to start collection and save the data to outputFile.etl.zip.</span></span>  
  
 <span data-ttu-id="1c117-155">Execute o aplicativo após iniciar o PerfView.</span><span class="sxs-lookup"><span data-stu-id="1c117-155">Run your app after starting PerfView.</span></span> <span data-ttu-id="1c117-156">Há algumas coisas a lembrar quando ao executar seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="1c117-156">There are a few things to remember when running your app:</span></span>  
  
- <span data-ttu-id="1c117-157">Use uma compilação de versão, não uma compilação de depuração.</span><span class="sxs-lookup"><span data-stu-id="1c117-157">Use a release build, not a debug build.</span></span> <span data-ttu-id="1c117-158">Compilações de depuração normalmente contêm códigos de verificação e manuseio de erros extras que pode fazer com que o aplicativo seja executado mais lentamente do que o esperado.</span><span class="sxs-lookup"><span data-stu-id="1c117-158">Debug builds often contain extra error checking and error handling code that can cause your app to run slower than expected.</span></span>  
  
- <span data-ttu-id="1c117-159">Executar seu aplicativo com o depurador anexado afetará o desempenho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1c117-159">Running your app with a debugger attached affects the performance of your app.</span></span>  
  
- <span data-ttu-id="1c117-160">O Windows usa várias estratégias de caching em cache para agilizar os tempos de inicialização do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1c117-160">Windows uses multiple caching strategies to speed up app launch times.</span></span> <span data-ttu-id="1c117-161">Se seu aplicativo estiver armazenado em cache na memória e não precisar ser carregado do disco, ele será iniciado mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="1c117-161">If your app is currently cached in memory and doesn't have to be loaded from disk, it will start faster.</span></span> <span data-ttu-id="1c117-162">Para garantir a consistência, inicie e feche seu aplicativo algumas vezes antes de medi-lo.</span><span class="sxs-lookup"><span data-stu-id="1c117-162">To ensure consistency, start and close your app a few times before measuring it.</span></span>  
  
 <span data-ttu-id="1c117-163">Ao executar o aplicativo para que o PerfView possa coletar eventos emitidos, escolha o botão **Parar Coleta**.</span><span class="sxs-lookup"><span data-stu-id="1c117-163">When you’ve run your app so that PerfView can collect emitted events, choose the **Stop Collection** button.</span></span> <span data-ttu-id="1c117-164">Em geral, você deve interromper a coleta antes de fechar o aplicativo para que não ocorram eventos estranhos.</span><span class="sxs-lookup"><span data-stu-id="1c117-164">Generally, you should stop collection before closing your app so you don’t get extraneous events.</span></span> <span data-ttu-id="1c117-165">No entanto, se você medir o desempenho de desligamento ou suspensão, é recomendável continuar a coleta.</span><span class="sxs-lookup"><span data-stu-id="1c117-165">However, if you’re measuring shutdown or suspension performance, you’ll want to continue collection.</span></span>  
  
## <a name="displaying-the-events"></a><span data-ttu-id="1c117-166">Exibir os eventos</span><span class="sxs-lookup"><span data-stu-id="1c117-166">Displaying the events</span></span>  
 <span data-ttu-id="1c117-167">Para exibir os eventos que já foram coletados, use o PerfView para abrir o arquivo .etl ou .etl.zip criado e escolha **Eventos**.</span><span class="sxs-lookup"><span data-stu-id="1c117-167">To view the events that have already been collected, use PerfView to open the .etl or .etl.zip file you created and choose **Events**.</span></span> <span data-ttu-id="1c117-168">O ETW irá coletar informações sobre um grande número de eventos, incluindo eventos de outros processos.</span><span class="sxs-lookup"><span data-stu-id="1c117-168">ETW will have collected information about a large number of events, including events from other processes.</span></span> <span data-ttu-id="1c117-169">Para restringir sua investigação, preencha as seguintes caixas de texto no modo de exibição de eventos:</span><span class="sxs-lookup"><span data-stu-id="1c117-169">To focus your investigation, complete the following text boxes in the events view:</span></span>  
  
- <span data-ttu-id="1c117-170">Na caixa **Filtro do Processo**, especifique o nome do aplicativo (sem ".exe").</span><span class="sxs-lookup"><span data-stu-id="1c117-170">In the **Process Filter** box, specify your app name (without ".exe").</span></span>  
  
- <span data-ttu-id="1c117-171">Na caixa **Filtro de Tipos de Evento**, especifique `Process/Start | MyCompany-MyApp`.</span><span class="sxs-lookup"><span data-stu-id="1c117-171">In the **Event Types Filter** box, specify `Process/Start | MyCompany-MyApp`.</span></span> <span data-ttu-id="1c117-172">Isso define um filtro para eventos de MyApp-MyCompany e o evento Windows Kernel/Processo/Início.</span><span class="sxs-lookup"><span data-stu-id="1c117-172">This sets a filter for events from MyCompany-MyApp and the Windows Kernel/Process/Start event.</span></span>  
  
 <span data-ttu-id="1c117-173">Selecione todos os eventos listados no painel à esquerda (Ctrl-A) e pressione a tecla **Enter**.</span><span class="sxs-lookup"><span data-stu-id="1c117-173">Select all the events listed in the left pane (Ctrl-A) and choose the **Enter** key.</span></span> <span data-ttu-id="1c117-174">Agora, você poderá ver as marcações de tempo de cada evento.</span><span class="sxs-lookup"><span data-stu-id="1c117-174">Now, you should be able to see the timestamps from each event.</span></span> <span data-ttu-id="1c117-175">Essas marcações de tempo são relativas ao início do rastreamento, portanto você precisa subtrair o horário de cada evento da hora de início do processo para identificar o tempo decorrido desde a inicialização.</span><span class="sxs-lookup"><span data-stu-id="1c117-175">These timestamps are relative to the start of the trace, so you have to subtract the time of each event from the start time of the process to identify the elapsed time since startup.</span></span> <span data-ttu-id="1c117-176">Se você usar Ctrl+Clique para selecionar duas marcações de tempo, verá que a diferença entre eles é exibida na barra de status na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="1c117-176">If you use Ctrl+Click to select two timestamps, you'll see the difference between them displayed in the status bar at the bottom of the page.</span></span> <span data-ttu-id="1c117-177">Isso facilita ver o tempo decorrido entre dois eventos em exibição (incluindo o início do processo).</span><span class="sxs-lookup"><span data-stu-id="1c117-177">This makes it easy to see the elapsed time between any two events in the display (including process start).</span></span> <span data-ttu-id="1c117-178">Você pode abrir o menu de atalho para o modo de exibição e selecionar diversas opções úteis, como exportar para arquivos CSV ou abrir o Microsoft Excel para salvar ou processar os dados.</span><span class="sxs-lookup"><span data-stu-id="1c117-178">You can open the shortcut menu for the view and select from a number of useful options, like exporting to CSV files or opening Microsoft Excel to save or process the data.</span></span>  
  
 <span data-ttu-id="1c117-179">Ao repetir o procedimento para seu aplicativo original e a versão que você criou usando a cadeia de ferramentas .NET Native, você pode comparar a diferença no desempenho.</span><span class="sxs-lookup"><span data-stu-id="1c117-179">By repeating the procedure for both your original app and the version you built by using the .NET Native tool chain, you can compare the difference in performance.</span></span>   <span data-ttu-id="1c117-180">.NET Native aplicativos geralmente são iniciados mais rapidamente do que os aplicativos nativos do non-.NET.</span><span class="sxs-lookup"><span data-stu-id="1c117-180">.NET Native apps generally start faster than non-.NET Native apps.</span></span> <span data-ttu-id="1c117-181">Se você estiver interessado em se aprofundar-se, o PerfView também pode identificar as partes do código que estão levando mais tempo.</span><span class="sxs-lookup"><span data-stu-id="1c117-181">If you’re interested in digging deeper, PerfView can also identify the parts of your code that are taking the most time.</span></span> <span data-ttu-id="1c117-182">Para obter mais informações, assista aos [tutoriais do PerfView](https://channel9.msdn.com/Series/PerfView-Tutorial) ou leia a [entrada no blog de Vance Morrison](https://blogs.msdn.microsoft.com/vancem/2011/12/28/publication-of-the-perfview-performance-analysis-tool/).</span><span class="sxs-lookup"><span data-stu-id="1c117-182">For more information, watch the [PerfView tutorials](https://channel9.msdn.com/Series/PerfView-Tutorial) or read [Vance Morrison’s blog entry](https://blogs.msdn.microsoft.com/vancem/2011/12/28/publication-of-the-perfview-performance-analysis-tool/).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1c117-183">Consulte também</span><span class="sxs-lookup"><span data-stu-id="1c117-183">See also</span></span>

- <xref:System.Diagnostics.Tracing.EventSource>
