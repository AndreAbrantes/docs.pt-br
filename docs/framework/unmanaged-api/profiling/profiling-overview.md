---
title: "Visão geral da criação de perfil"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: reference
helpviewer_keywords:
- managed code, profiling API support
- unmanaged code, combining with managed code in profiling
- notification threads [.NET Framework profiling]
- unmanaged code, profiling
- profiling API [.NET Framework], and COM
- profiling API [.NET Framework], unmanaged code profiling
- profilers, writing
- profiling API [.NET Framework], call stacks
- code profilers, writing
- profiling API [.NET Framework], security considerations
- profiling API [.NET Framework], managed code support
- common language runtime, profiling
- profiling API [.NET Framework], notification threads
- call stacks [.NET Framework profiling]
- profiling API [.NET Framework], stack depth
- common language runtime, writing a profiler
- profiling API [.NET Framework], information retrieval interfaces
- shadow stacks [.NET Framework profiling]
- COM, using in the profiling API
- stack snapshots [.NET Framework profiling]
- profiling API [.NET Framework], supported features
- profiling API [.NET Framework], overview
- security, profiling API considerations
- stack depth [.NET Framework profiling]
ms.assetid: 864c2344-71dc-46f9-96b2-ed59fb6427a8
caps.latest.revision: "27"
author: mairaw
ms.author: mairaw
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 84688ed80d0cb1b802290176400eb45998052a34
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="profiling-overview"></a><span data-ttu-id="eb6f4-102">Visão geral da criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-102">Profiling Overview</span></span>
<a name="top"></a><span data-ttu-id="eb6f4-103">Um criador de perfil é uma ferramenta que monitora a execução de outro aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-103">A profiler is a tool that monitors the execution of another application.</span></span> <span data-ttu-id="eb6f4-104">Um criador de perfil de tempo de execução (CLR) de linguagem comum é uma biblioteca de vínculo dinâmico (DLL) que consiste em funções que recebem mensagens e enviam mensagens para o CLR usando a API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-104">A common language runtime (CLR) profiler is a dynamic link library (DLL) that consists of functions that receive messages from, and send messages to, the CLR by using the profiling API.</span></span> <span data-ttu-id="eb6f4-105">O criador de perfil DLL é carregado pelo CLR em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-105">The profiler DLL is loaded by the CLR at run time.</span></span>  
  
 <span data-ttu-id="eb6f4-106">Ferramentas de criação de perfil tradicionais se concentram em avaliar a execução do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-106">Traditional profiling tools focus on measuring the execution of the application.</span></span> <span data-ttu-id="eb6f4-107">Ou seja, eles medem o tempo gasto em cada função ou o uso de memória do aplicativo ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-107">That is, they measure the time that is spent in each function or the memory usage of the application over time.</span></span> <span data-ttu-id="eb6f4-108">A API de criação de perfil tem como alvo uma classe mais ampla de ferramentas de diagnóstico como utilitários de cobertura de código e até mesmo avançados recursos de depuração.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-108">The profiling API targets a broader class of diagnostic tools such as code-coverage utilities and even advanced debugging aids.</span></span> <span data-ttu-id="eb6f4-109">Esses usos são todos os diagnóstico por natureza.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-109">These uses are all diagnostic in nature.</span></span> <span data-ttu-id="eb6f4-110">A API de criação de perfil não mede apenas também monitora a execução de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-110">The profiling API not only measures but also monitors the execution of an application.</span></span> <span data-ttu-id="eb6f4-111">Por esse motivo, a API de criação de perfil nunca deve ser usada pelo próprio aplicativo, e a execução do aplicativo não deve depender (ou ser afetado por) o criador de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-111">For this reason, the profiling API should never be used by the application itself, and the application’s execution should not depend on (or be affected by) the profiler.</span></span>  
  
 <span data-ttu-id="eb6f4-112">Um aplicativo de CLR de criação de perfil requer suporte maior que a criação de perfil convencionalmente compilado código de máquina.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-112">Profiling a CLR application requires more support than profiling conventionally compiled machine code.</span></span> <span data-ttu-id="eb6f4-113">Isso ocorre porque o CLR apresenta conceitos, como domínios de aplicativo, coleta de lixo, gerenciados manipulação de exceção, compilação just-in-time (JIT) do código (convertendo Microsoft intermediate language ou MSIL, o código para código de máquina nativo) e semelhante recursos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-113">This is because the CLR introduces concepts such as application domains, garbage collection, managed exception handling, just-in-time (JIT) compilation of code (converting Microsoft intermediate language, or MSIL, code into native machine code), and similar features.</span></span> <span data-ttu-id="eb6f4-114">Convencionais mecanismos de criação de perfil não podem identificar ou fornecer informações úteis sobre esses recursos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-114">Conventional profiling mechanisms cannot identify or provide useful information about these features.</span></span> <span data-ttu-id="eb6f4-115">A API de criação de perfil fornece essas informações ausentes com eficiência, com efeito mínimo sobre o desempenho do CLR e o aplicativo perfilado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-115">The profiling API provides this missing information efficiently, with minimal effect on the performance of the CLR and the profiled application.</span></span>  
  
 <span data-ttu-id="eb6f4-116">Compilação JIT em tempo de execução fornece boas oportunidades para criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-116">JIT compilation at run time provides good opportunities for profiling.</span></span> <span data-ttu-id="eb6f4-117">A API de criação de perfil permite que um criador de perfil alterar o fluxo de código MSIL na memória para uma rotina antes de ser compilado por JIT.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-117">The profiling API enables a profiler to change the in-memory MSIL code stream for a routine before it is JIT-compiled.</span></span> <span data-ttu-id="eb6f4-118">Dessa maneira, o criador de perfil pode adicionar dinamicamente o código de instrumentação para rotinas específicas que precisam de mais investigação.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-118">In this manner, the profiler can dynamically add instrumentation code to particular routines that need deeper investigation.</span></span> <span data-ttu-id="eb6f4-119">Embora essa abordagem seja possível em cenários convencionais, é muito mais fácil de implementar para o CLR usando a API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-119">Although this approach is possible in conventional scenarios, it is much easier to implement for the CLR by using the profiling API.</span></span>  
  
 <span data-ttu-id="eb6f4-120">Esta visão geral é composta pelas seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="eb6f4-120">This overview consists of the following sections:</span></span>  
  
-   [<span data-ttu-id="eb6f4-121">A API de criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-121">The Profiling API</span></span>](#profiling_api)  
  
-   [<span data-ttu-id="eb6f4-122">Recursos com suporte</span><span class="sxs-lookup"><span data-stu-id="eb6f4-122">Supported Features</span></span>](#support)  
  
-   [<span data-ttu-id="eb6f4-123">Threads de notificação</span><span class="sxs-lookup"><span data-stu-id="eb6f4-123">Notification Threads</span></span>](#notification_threads)  
  
-   [<span data-ttu-id="eb6f4-124">Segurança</span><span class="sxs-lookup"><span data-stu-id="eb6f4-124">Security</span></span>](#security)  
  
-   [<span data-ttu-id="eb6f4-125">Combinando gerenciada e código em um criador de perfil de código não gerenciado</span><span class="sxs-lookup"><span data-stu-id="eb6f4-125">Combining Managed and Unmanaged Code in a Code Profiler</span></span>](#combining_managed_unmanaged)  
  
-   [<span data-ttu-id="eb6f4-126">Criação de perfil de código não gerenciado</span><span class="sxs-lookup"><span data-stu-id="eb6f4-126">Profiling Unmanaged Code</span></span>](#unmanaged)  
  
-   [<span data-ttu-id="eb6f4-127">Usando COM</span><span class="sxs-lookup"><span data-stu-id="eb6f4-127">Using COM</span></span>](#com)  
  
-   [<span data-ttu-id="eb6f4-128">Pilhas de chamadas</span><span class="sxs-lookup"><span data-stu-id="eb6f4-128">Call stacks</span></span>](#call_stacks)  
  
-   [<span data-ttu-id="eb6f4-129">Retornos de chamada e a profundidade da pilha</span><span class="sxs-lookup"><span data-stu-id="eb6f4-129">Callbacks and Stack Depth</span></span>](#callbacks)  
  
-   [<span data-ttu-id="eb6f4-130">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="eb6f4-130">Related Topics</span></span>](#related_topics)  
  
<a name="profiling_api"></a>   
## <a name="the-profiling-api"></a><span data-ttu-id="eb6f4-131">A API de criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-131">The Profiling API</span></span>  
 <span data-ttu-id="eb6f4-132">Normalmente, a API de criação de perfil é usada para gravar um *criador de perfil de código*, que é um programa que monitora a execução de um aplicativo gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-132">Typically, the profiling API is used to write a *code profiler*, which is a program that monitors the execution of a managed application.</span></span>  
  
 <span data-ttu-id="eb6f4-133">A API de criação de perfil é usada por um criador de perfil DLL, que é carregado no mesmo processo que o aplicativo cujo perfil está sendo criado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-133">The profiling API is used by a profiler DLL, which is loaded into the same process as the application that is being profiled.</span></span> <span data-ttu-id="eb6f4-134">O criador de perfil DLL implementa uma interface de retorno de chamada ([ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) no .NET Framework versão 1.0 e 1.1, [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) na versão 2.0 e posteriores).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-134">The profiler DLL implements a callback interface ([ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) in the .NET Framework version 1.0 and 1.1, [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) in version 2.0 and later).</span></span> <span data-ttu-id="eb6f4-135">O CLR chama os métodos de interface para notificar o criador de perfil de eventos do processo com perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-135">The CLR calls the methods in that interface to notify the profiler of events in the profiled process.</span></span> <span data-ttu-id="eb6f4-136">O criador de perfil pode chamar Voltar no tempo de execução, usando os métodos no [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) e [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md) interfaces para obter informações sobre o estado do aplicativo perfilado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-136">The profiler can call back into the runtime by using the methods in the [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) and [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md) interfaces to obtain information about the state of the profiled application.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="eb6f4-137">Somente a parte da coleta de dados da solução de criador de perfil deve estar em execução no mesmo processo que o aplicativo perfilado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-137">Only the data-gathering part of the profiler solution should be running in the same process as the profiled application.</span></span> <span data-ttu-id="eb6f4-138">Todos os usuário interface e análise de dados deve ser executado em um processo separado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-138">All user interface and data analysis should be performed in a separate process.</span></span>  
  
 <span data-ttu-id="eb6f4-139">A ilustração a seguir mostra como o criador de perfil DLL interage com o aplicativo cujo perfil está sendo criado e o CLR.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-139">The following illustration shows how the profiler DLL interacts with the application that is being profiled and the CLR.</span></span>  
  
 <span data-ttu-id="eb6f4-140">![Arquitetura de criação de perfil](../../../../docs/framework/unmanaged-api/profiling/media/profilingarch.png "ProfilingArch")</span><span class="sxs-lookup"><span data-stu-id="eb6f4-140">![Profiling Architecture](../../../../docs/framework/unmanaged-api/profiling/media/profilingarch.png "ProfilingArch")</span></span>  
<span data-ttu-id="eb6f4-141">Arquitetura de criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-141">Profiling architecture</span></span>  
  
### <a name="the-notification-interfaces"></a><span data-ttu-id="eb6f4-142">As Interfaces de notificação</span><span class="sxs-lookup"><span data-stu-id="eb6f4-142">The Notification Interfaces</span></span>  
 <span data-ttu-id="eb6f4-143">[ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) e [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) podem ser consideradas como interfaces de notificação.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-143">[ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) and [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) can be considered notification interfaces.</span></span> <span data-ttu-id="eb6f4-144">Essas interfaces consistem em métodos como [ClassLoadStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadstarted-method.md), [ClassLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadfinished-method.md), e [JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-144">These interfaces consist of methods such as [ClassLoadStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadstarted-method.md), [ClassLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadfinished-method.md), and [JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md).</span></span> <span data-ttu-id="eb6f4-145">Cada vez que o CLR carrega ou descarrega uma classe, compila uma função, e assim por diante, ele chama o método correspondente do criador de perfil `ICorProfilerCallback` ou `ICorProfilerCallback2` interface.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-145">Each time the CLR loads or unloads a class, compiles a function, and so on, it calls the corresponding method in the profiler's `ICorProfilerCallback` or `ICorProfilerCallback2` interface.</span></span>  
  
 <span data-ttu-id="eb6f4-146">Por exemplo, um criador de perfil pode medir o desempenho de código por meio de duas funções de notificação: [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) e [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-146">For example, a profiler could measure code performance through two notification functions: [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) and [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md).</span></span> <span data-ttu-id="eb6f4-147">Ele apenas os carimbos de hora cada notificação, acumula os resultados e gera uma lista que indica quais funções consumiram mais tempo da CPU ou do relógio durante a execução do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-147">It just time-stamps each notification, accumulates results, and outputs a list that indicates which functions consumed the most CPU or wall-clock time during the execution of the application.</span></span>  
  
### <a name="the-information-retrieval-interfaces"></a><span data-ttu-id="eb6f4-148">As Interfaces de recuperação de informações</span><span class="sxs-lookup"><span data-stu-id="eb6f4-148">The Information Retrieval Interfaces</span></span>  
 <span data-ttu-id="eb6f4-149">As outras interfaces principais envolvidas na criação de perfil são [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) e [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-149">The other main interfaces involved in profiling are [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) and [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md).</span></span> <span data-ttu-id="eb6f4-150">O criador de perfil chama essas interfaces conforme necessário para obter mais informações para ajudar a sua análise.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-150">The profiler calls these interfaces as required to obtain more information to help its analysis.</span></span> <span data-ttu-id="eb6f4-151">Por exemplo, sempre que o CLR chama o [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) função, ele fornece um identificador de função.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-151">For example, whenever the CLR calls the [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) function, it supplies a function identifier.</span></span> <span data-ttu-id="eb6f4-152">O criador de perfil pode obter mais informações sobre essa função chamando o [ICorProfilerInfo2::GetFunctionInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md) método para descobrir a classe do pai da função, seu nome e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-152">The profiler can get more information about that function by calling the [ICorProfilerInfo2::GetFunctionInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md) method to discover the function's parent class, its name, and so on.</span></span>  
  
 [<span data-ttu-id="eb6f4-153">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-153">Back to top</span></span>](#top)  
  
<a name="support"></a>   
## <a name="supported-features"></a><span data-ttu-id="eb6f4-154">Recursos compatíveis</span><span class="sxs-lookup"><span data-stu-id="eb6f4-154">Supported Features</span></span>  
 <span data-ttu-id="eb6f4-155">A API de criação de perfil fornece informações sobre uma variedade de eventos e ações que ocorrem no common language runtime.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-155">The profiling API provides information about a variety of events and actions that occur in the common language runtime.</span></span> <span data-ttu-id="eb6f4-156">Você pode usar essas informações para monitorar o funcionamento interno de processos e analisar o desempenho do seu aplicativo do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-156">You can use this information to monitor the inner workings of processes and to analyze the performance of your .NET Framework application.</span></span>  
  
 <span data-ttu-id="eb6f4-157">A API de criação de perfil recupera informações sobre as ações e os eventos que ocorrem no CLR a seguir:</span><span class="sxs-lookup"><span data-stu-id="eb6f4-157">The profiling API retrieves information about the following actions and events that occur in the CLR:</span></span>  
  
-   <span data-ttu-id="eb6f4-158">Eventos de inicialização e desligamento do CLR.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-158">CLR startup and shutdown events.</span></span>  
  
-   <span data-ttu-id="eb6f4-159">Domínio criação e desligamento eventos de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-159">Application domain creation and shutdown events.</span></span>  
  
-   <span data-ttu-id="eb6f4-160">Assembly Carregando e descarregando eventos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-160">Assembly loading and unloading events.</span></span>  
  
-   <span data-ttu-id="eb6f4-161">Módulo de carregamento e descarregamento de eventos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-161">Module loading and unloading events.</span></span>  
  
-   <span data-ttu-id="eb6f4-162">COM vtable criação e destruição de eventos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-162">COM vtable creation and destruction events.</span></span>  
  
-   <span data-ttu-id="eb6f4-163">Just-in-time (JIT) compilação e eventos de densidade de código.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-163">Just-in-time (JIT) compilation and code-pitching events.</span></span>  
  
-   <span data-ttu-id="eb6f4-164">Eventos de carregamento e descarregamento de classe.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-164">Class loading and unloading events.</span></span>  
  
-   <span data-ttu-id="eb6f4-165">Eventos de criação e destruição de threads.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-165">Thread creation and destruction events.</span></span>  
  
-   <span data-ttu-id="eb6f4-166">Eventos de entrada e saída da função.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-166">Function entry and exit events.</span></span>  
  
-   <span data-ttu-id="eb6f4-167">Exceções.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-167">Exceptions.</span></span>  
  
-   <span data-ttu-id="eb6f4-168">Faz a transição entre a execução de código gerenciado e não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-168">Transitions between managed and unmanaged code execution.</span></span>  
  
-   <span data-ttu-id="eb6f4-169">Faz a transição entre contextos diferentes de tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-169">Transitions between different runtime contexts.</span></span>  
  
-   <span data-ttu-id="eb6f4-170">Informações sobre a suspensão do tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-170">Information about runtime suspensions.</span></span>  
  
-   <span data-ttu-id="eb6f4-171">Informações sobre a atividade de coleta de tempo de execução memória heap e lixo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-171">Information about the runtime memory heap and garbage collection activity.</span></span>  
  
 <span data-ttu-id="eb6f4-172">A API de criação de perfil pode ser chamada em qualquer linguagem compatível COM o com (não gerenciado).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-172">The profiling API can be called from any (non-managed) COM-compatible language.</span></span>  
  
 <span data-ttu-id="eb6f4-173">A API é eficiente em relação ao consumo de CPU e memória.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-173">The API is efficient with regard to CPU and memory consumption.</span></span> <span data-ttu-id="eb6f4-174">Criação de perfil não envolve alterações para o aplicativo perfilado significativas de causar resultados incorretos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-174">Profiling does not involve changes to the profiled application that are significant enough to cause misleading results.</span></span>  
  
 <span data-ttu-id="eb6f4-175">A API de criação de perfil é útil para criadores de perfil de amostragem e não de amostragem.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-175">The profiling API is useful to both sampling and non-sampling profilers.</span></span> <span data-ttu-id="eb6f4-176">Um *criador de perfil de amostragem* inspeciona o perfil em tiques do relógio regular, digamos, a distância de 5 milissegundos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-176">A *sampling profiler* inspects the profile at regular clock ticks, say, at 5 milliseconds apart.</span></span> <span data-ttu-id="eb6f4-177">Um *criador de perfil de amostragem não* é informado de um evento de maneira síncrona com o thread que faz com que o evento.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-177">A *non-sampling profiler* is informed of an event synchronously with the thread that causes the event.</span></span>  
  
### <a name="unsupported-functionality"></a><span data-ttu-id="eb6f4-178">Funcionalidade sem suporte</span><span class="sxs-lookup"><span data-stu-id="eb6f4-178">Unsupported Functionality</span></span>  
 <span data-ttu-id="eb6f4-179">A API de criação de perfil não oferece suporte a seguinte funcionalidade:</span><span class="sxs-lookup"><span data-stu-id="eb6f4-179">The profiling API does not support the following functionality:</span></span>  
  
-   <span data-ttu-id="eb6f4-180">Código não gerenciado, que deve ser o perfil criado usando métodos convencionais do Win32.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-180">Unmanaged code, which must be profiled using conventional Win32 methods.</span></span> <span data-ttu-id="eb6f4-181">No entanto, o criador de perfil CLR inclui eventos de transição para determinar os limites entre código gerenciado e não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-181">However, the CLR profiler includes transition events to determine the boundaries between managed and unmanaged code.</span></span>  
  
-   <span data-ttu-id="eb6f4-182">Modificando automaticamente aplicativos que modificam o seu próprio código para fins como programação orientada a aspectos.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-182">Self-modifying applications that modify their own code for purposes such as aspect-oriented programming.</span></span>  
  
-   <span data-ttu-id="eb6f4-183">Verificação de limites, porque a API de criação de perfil não fornecer essas informações.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-183">Bounds checking, because the profiling API does not provide this information.</span></span> <span data-ttu-id="eb6f4-184">O CLR fornece suporte intrínseco para verificação de todo o código gerenciado de limites.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-184">The CLR provides intrinsic support for bounds checking of all managed code.</span></span>  
  
-   <span data-ttu-id="eb6f4-185">Remoto de criação de perfil, que não é suportado pelos seguintes motivos:</span><span class="sxs-lookup"><span data-stu-id="eb6f4-185">Remote profiling, which is not supported for the following reasons:</span></span>  
  
    -   <span data-ttu-id="eb6f4-186">Criação de perfil remota estende o tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-186">Remote profiling extends execution time.</span></span> <span data-ttu-id="eb6f4-187">Quando você usa as interfaces de criação de perfil, você deve minimizar o tempo de execução para que os resultados de criação de perfil não serão indevidamente afetada.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-187">When you use the profiling interfaces, you must minimize execution time so that profiling results will not be unduly affected.</span></span> <span data-ttu-id="eb6f4-188">Isso é especialmente verdadeiro quando o desempenho de execução está sendo monitorado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-188">This is especially true when execution performance is being monitored.</span></span> <span data-ttu-id="eb6f4-189">No entanto, a criação de perfil remota não é uma limitação quando as interfaces de criação de perfil são usadas para monitorar o uso de memória ou para obter informações de tempo de execução sobre quadros de pilha, objetos e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-189">However, remote profiling is not a limitation when the profiling interfaces are used to monitor memory usage or to obtain run-time information about stack frames, objects, and so on.</span></span>  
  
    -   <span data-ttu-id="eb6f4-190">O criador de perfil de código do CLR deve registrar uma ou mais interfaces de retorno de chamada com o tempo de execução no computador local em que o aplicativo perfilado está em execução.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-190">The CLR code profiler must register one or more callback interfaces with the runtime on the local computer on which the profiled application is running.</span></span> <span data-ttu-id="eb6f4-191">Isso limita a capacidade de criar um criador de perfil de código remota.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-191">This limits the ability to create a remote code profiler.</span></span>  
  
-   <span data-ttu-id="eb6f4-192">Criação de perfil em ambientes de produção com requisitos de alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-192">Profiling in production environments with high-availability requirements.</span></span> <span data-ttu-id="eb6f4-193">A API de criação de perfil foi criada para dar suporte a diagnóstico de tempo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-193">The profiling API was created to support development-time diagnostics.</span></span> <span data-ttu-id="eb6f4-194">Ele não passou por testes rigorosos necessários para dar suporte a ambientes de produção.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-194">It has not undergone the rigorous testing required to support production environments.</span></span>  
  
 [<span data-ttu-id="eb6f4-195">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-195">Back to top</span></span>](#top)  
  
<a name="notification_threads"></a>   
## <a name="notification-threads"></a><span data-ttu-id="eb6f4-196">Threads de notificação</span><span class="sxs-lookup"><span data-stu-id="eb6f4-196">Notification Threads</span></span>  
 <span data-ttu-id="eb6f4-197">Na maioria dos casos, o thread que gera um evento também executa as notificações.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-197">In most cases, the thread that generates an event also executes notifications.</span></span> <span data-ttu-id="eb6f4-198">Essas notificações (por exemplo, [FunctionEnter](../../../../docs/framework/unmanaged-api/profiling/functionenter-function.md) e [FunctionLeave](../../../../docs/framework/unmanaged-api/profiling/functionleave-function.md)) não é necessário fornecer o explícita `ThreadID`.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-198">Such notifications (for example, [FunctionEnter](../../../../docs/framework/unmanaged-api/profiling/functionenter-function.md) and [FunctionLeave](../../../../docs/framework/unmanaged-api/profiling/functionleave-function.md)) do not need to supply the explicit `ThreadID`.</span></span> <span data-ttu-id="eb6f4-199">Além disso, o criador de perfil pode decidir usar armazenamento de thread local para armazenar e atualizar seus blocos de análise, em vez de indexação os blocos de análise de armazenamento global, com base no `ThreadID` do thread afetado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-199">Also, the profiler might decide to use thread-local storage to store and update its analysis blocks instead of indexing the analysis blocks in global storage, based on the `ThreadID` of the affected thread.</span></span>  
  
 <span data-ttu-id="eb6f4-200">Observe que esses retornos de chamada não são serializados.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-200">Note that these callbacks are not serialized.</span></span> <span data-ttu-id="eb6f4-201">Os usuários devem proteger seu código com a criação de estruturas de dados do thread-safe e bloqueando o código de criador de perfil, onde for necessário para impedir o acesso simultâneo de vários threads.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-201">Users must protect their code by creating thread-safe data structures and by locking the profiler code where necessary to prevent parallel access from multiple threads.</span></span> <span data-ttu-id="eb6f4-202">Portanto, em certos casos, você pode receber uma sequência comum de retornos de chamada.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-202">Therefore, in certain cases you can receive an unusual sequence of callbacks.</span></span> <span data-ttu-id="eb6f4-203">Por exemplo, suponha que um aplicativo gerenciado é reproduzir dois threads que estão executando o código idêntico.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-203">For example, assume that a managed application is spawning two threads that are executing identical code.</span></span> <span data-ttu-id="eb6f4-204">Nesse caso, é possível receber um [: Jitcompilationstarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md) evento para alguma função de um thread e um `FunctionEnter` retorno de chamada do thread antes de receber o [ Jitcompilationfinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationfinished-method.md) retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-204">In this case, it is possible to receive a [ICorProfilerCallback::JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md) event for some function from one thread and a `FunctionEnter` callback from the other thread before receiving the [ICorProfilerCallback::JITCompilationFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationfinished-method.md) callback.</span></span> <span data-ttu-id="eb6f4-205">Nesse caso, o usuário receberá uma `FunctionEnter` retorno de chamada para uma função que pode não ter sido totalmente just-in-time (JIT) compilado ainda.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-205">In this case, the user will receive a `FunctionEnter` callback for a function that may not have been fully just-in-time (JIT) compiled yet.</span></span>  
  
 [<span data-ttu-id="eb6f4-206">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-206">Back to top</span></span>](#top)  
  
<a name="security"></a>   
## <a name="security"></a><span data-ttu-id="eb6f4-207">Segurança</span><span class="sxs-lookup"><span data-stu-id="eb6f4-207">Security</span></span>  
 <span data-ttu-id="eb6f4-208">Um criador de perfil DLL é uma DLL não gerenciada que é executado como parte do mecanismo de execução do common language runtime.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-208">A profiler DLL is an unmanaged DLL that runs as part of the common language runtime execution engine.</span></span> <span data-ttu-id="eb6f4-209">Como resultado, o código no criador de perfil de que dll não está sujeita às restrições gerenciados segurança de acesso ao código.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-209">As a result, the code in the profiler DLL is not subject to the restrictions of managed code access security.</span></span> <span data-ttu-id="eb6f4-210">As únicas limitações no criador de perfil DLL são aquelas impostas pelo sistema operacional no usuário que está executando o aplicativo perfilado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-210">The only limitations on the profiler DLL are those imposed by the operating system on the user who is running the profiled application.</span></span>  
  
 <span data-ttu-id="eb6f4-211">Os autores do criador de perfil devem tomar precauções apropriadas para evitar problemas de segurança.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-211">Profiler authors should take appropriate precautions to avoid security-related issues.</span></span> <span data-ttu-id="eb6f4-212">Por exemplo, durante a instalação, um criador de perfil DLL deve ser adicionado a uma lista de controle de acesso (ACL) para que um usuário mal-intencionado não é possível modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-212">For example, during installation, a profiler DLL should be added to an access control list (ACL) so that a malicious user cannot modify it.</span></span>  
  
 [<span data-ttu-id="eb6f4-213">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-213">Back to top</span></span>](#top)  
  
<a name="combining_managed_unmanaged"></a>   
## <a name="combining-managed-and-unmanaged-code-in-a-code-profiler"></a><span data-ttu-id="eb6f4-214">Combinando gerenciada e código em um criador de perfil de código não gerenciado</span><span class="sxs-lookup"><span data-stu-id="eb6f4-214">Combining Managed and Unmanaged Code in a Code Profiler</span></span>  
 <span data-ttu-id="eb6f4-215">Um criador de perfil escrito incorretamente pode causar referências circulares a mesmo, resultando em um comportamento imprevisível.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-215">An incorrectly written profiler can cause circular references to itself, resulting in unpredictable behavior.</span></span>  
  
 <span data-ttu-id="eb6f4-216">Crie a impressão de que você pode escrever um criador de perfil que contém os componentes gerenciados e não gerenciados que chamam uns aos outros por meio de chamadas de interoperabilidade ou indiretas COM uma revisão do CLR API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-216">A review of the CLR profiling API may create the impression that you can write a profiler that contains managed and unmanaged components that call each other through COM interop or indirect calls.</span></span>  
  
 <span data-ttu-id="eb6f4-217">Embora seja possível a partir de uma perspectiva de design, a API de criação de perfil não oferece suporte a componentes gerenciados.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-217">Although this is possible from a design perspective, the profiling API does not support managed components.</span></span> <span data-ttu-id="eb6f4-218">Um criador de perfil CLR deve ser completamente não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-218">A CLR profiler must be completely unmanaged.</span></span> <span data-ttu-id="eb6f4-219">Tenta combinar código gerenciado e um criador de perfil CLR pode causar violações de acesso, a falha de programa ou deadlocks.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-219">Attempts to combine managed and unmanaged code in a CLR profiler may cause access violations, program failure, or deadlocks.</span></span> <span data-ttu-id="eb6f4-220">Os componentes gerenciados do criador de perfil serão acionado eventos seus componentes não gerenciados, que chamam subsequentemente os componentes gerenciados novamente, resultando em referências circulares.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-220">The managed components of the profiler will fire events back to their unmanaged components, which would subsequently call the managed components again, resulting in circular references.</span></span>  
  
 <span data-ttu-id="eb6f4-221">É o único local onde um criador de perfil CLR pode chamar código gerenciado com segurança no corpo Microsoft intermediate language (MSIL) de um método.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-221">The only location where a CLR profiler can call managed code safely is in the Microsoft intermediate language (MSIL) body of a method.</span></span> <span data-ttu-id="eb6f4-222">A prática recomendada para modificar o corpo do MSIL é usar os métodos de recompilação de JIT no [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interface.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-222">The recommended practice for modifying the MSIL body is to use the  JIT recompilation methods in the [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interface.</span></span>  
  
 <span data-ttu-id="eb6f4-223">Também é possível usar os métodos de instrumentação anteriores para modificar MSIL.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-223">It is also possible to use the older instrumentation methods to modify MSIL.</span></span> <span data-ttu-id="eb6f4-224">Antes que a compilação just-in-time (JIT) de uma função é concluída, o criador de perfil pode inserir chamadas gerenciadas no corpo de um método e, em seguida, a compilação JIT MSIL ele (consulte o [Getilfunctionbody](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-getilfunctionbody-method.md) método).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-224">Before the just-in-time (JIT) compilation of a function is completed, the profiler can insert managed calls in the MSIL body of a method and then JIT-compile it (see the [ICorProfilerInfo::GetILFunctionBody](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-getilfunctionbody-method.md) method).</span></span> <span data-ttu-id="eb6f4-225">Essa técnica pode ser usada com êxito para seletiva instrumentação de código gerenciado ou para reunir dados de desempenho e estatísticas sobre o JIT.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-225">This technique can successfully be used for selective instrumentation of managed code, or to gather statistics and performance data about the JIT.</span></span>  
  
 <span data-ttu-id="eb6f4-226">Como alternativa, um criador de perfil de código pode inserir ganchos nativo no corpo da MSIL de cada função gerenciada que chamam o código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-226">Alternatively, a code profiler can insert native hooks in the MSIL body of every managed function that calls into unmanaged code.</span></span> <span data-ttu-id="eb6f4-227">Essa técnica pode ser usada para a instrumentação e a cobertura.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-227">This technique can be used for instrumentation and coverage.</span></span> <span data-ttu-id="eb6f4-228">Por exemplo, um criador de perfil de código foi possível inserir ganchos de instrumentação após cada bloco MSIL para garantir que o bloco foi executado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-228">For example, a code profiler could insert instrumentation hooks after every MSIL block to ensure that the block has been executed.</span></span> <span data-ttu-id="eb6f4-229">A modificação do corpo de um método MSIL é uma operação muito perfeita, e há muitos fatores que devem ser levadas em consideração.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-229">The modification of the MSIL body of a method is a very delicate operation, and there are many factors that should be taken into consideration.</span></span>  
  
 [<span data-ttu-id="eb6f4-230">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-230">Back to top</span></span>](#top)  
  
<a name="unmanaged"></a>   
## <a name="profiling-unmanaged-code"></a><span data-ttu-id="eb6f4-231">Criação de perfil de código não gerenciado</span><span class="sxs-lookup"><span data-stu-id="eb6f4-231">Profiling Unmanaged Code</span></span>  
 <span data-ttu-id="eb6f4-232">O common language runtime (CLR) API de criação de perfil fornece suporte mínimo de criação de perfil de código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-232">The common language runtime (CLR) profiling API provides minimal support for profiling unmanaged code.</span></span> <span data-ttu-id="eb6f4-233">É fornecida a seguinte funcionalidade:</span><span class="sxs-lookup"><span data-stu-id="eb6f4-233">The following functionality is provided:</span></span>  
  
-   <span data-ttu-id="eb6f4-234">Enumeração de cadeias de pilha.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-234">Enumeration of stack chains.</span></span> <span data-ttu-id="eb6f4-235">Esse recurso permite que um criador de perfil de código determinar o limite entre código gerenciado e o código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-235">This feature enables a code profiler to determine the boundary between managed code and unmanaged code.</span></span>  
  
-   <span data-ttu-id="eb6f4-236">Determinar se uma cadeia de pilha corresponde ao código gerenciado ou código nativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-236">Determination whether a stack chain corresponds to managed code or native code.</span></span>  
  
 <span data-ttu-id="eb6f4-237">Nas versões do .NET Framework 1.0 e 1.1, esses métodos estão disponíveis por meio do subconjunto no processo do CLR depuração da API.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-237">In the .NET Framework versions 1.0 and 1.1, these methods are available through the in-process subset of the CLR debugging API.</span></span> <span data-ttu-id="eb6f4-238">Elas são definidas no arquivo CorDebug.idl.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-238">They are defined in the CorDebug.idl file.</span></span>  
  
 <span data-ttu-id="eb6f4-239">No .NET Framework 2.0 e posterior, você pode usar o [Icorprofilerinfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) método para essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-239">In the .NET Framework 2.0 and later, you can use the [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) method for this functionality.</span></span>  
  
 [<span data-ttu-id="eb6f4-240">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-240">Back to top</span></span>](#top)  
  
<a name="com"></a>   
## <a name="using-com"></a><span data-ttu-id="eb6f4-241">Usando COM</span><span class="sxs-lookup"><span data-stu-id="eb6f4-241">Using COM</span></span>  
 <span data-ttu-id="eb6f4-242">Embora as interfaces de criação de perfil são definidas como interfaces COM, o common language runtime (CLR) não realmente inicializar COM para usar essas interfaces.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-242">Although the profiling interfaces are defined as COM interfaces, the common language runtime (CLR) does not actually initialize COM to use these interfaces.</span></span> <span data-ttu-id="eb6f4-243">A razão é evitar ter que definir o modelo de threading, usando o [CoInitialize](http://msdn.microsoft.com/library/windows/desktop/ms678543\(v=vs.85\).aspx) função antes do aplicativo gerenciado tenha tido a oportunidade de especificar o modelo de threading desejado.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-243">The reason is to avoid having to set the threading model by using the [CoInitialize](http://msdn.microsoft.com/library/windows/desktop/ms678543\(v=vs.85\).aspx) function before the managed application has had a chance to specify its desired threading model.</span></span> <span data-ttu-id="eb6f4-244">Da mesma forma, o criador de perfil em si não deve chamar `CoInitialize`, pois ele pode escolher um modelo de threading é incompatível com o aplicativo que está sendo analisado e pode causar falha no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-244">Similarly, the profiler itself should not call `CoInitialize`, because it may pick a threading model that is incompatible with the application being profiled and may cause the application to fail.</span></span>  
  
 [<span data-ttu-id="eb6f4-245">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-245">Back to top</span></span>](#top)  
  
<a name="call_stacks"></a>   
## <a name="call-stacks"></a><span data-ttu-id="eb6f4-246">Pilhas de chamadas</span><span class="sxs-lookup"><span data-stu-id="eb6f4-246">Call Stacks</span></span>  
 <span data-ttu-id="eb6f4-247">A API de criação de perfil fornece duas maneiras de obter as pilhas de chamadas: um método de instantâneo de pilha, que permite a coleta esparsa de pilhas de chamadas, e um método de pilha de sombra, que controla a pilha de chamadas em todos os instantes.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-247">The profiling API provides two ways to obtain call stacks: a stack snapshot method, which enables sparse gathering of call stacks, and a shadow stack method, which tracks the call stack at every instant.</span></span>  
  
### <a name="stack-snapshot"></a><span data-ttu-id="eb6f4-248">Instantâneo da pilha</span><span class="sxs-lookup"><span data-stu-id="eb6f4-248">Stack Snapshot</span></span>  
 <span data-ttu-id="eb6f4-249">Um instantâneo da pilha é um rastreamento da pilha de um thread em um momento no tempo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-249">A stack snapshot is a trace of the stack of a thread at an instant in time.</span></span> <span data-ttu-id="eb6f4-250">A API de criação de perfil dá suporte a rastreamento de funções gerenciadas na pilha, mas deixa o rastreamento de funções não gerenciadas para o movimentador de pilha do profiler.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-250">The profiling API supports the tracing of managed functions on the stack, but it leaves the tracing of unmanaged functions to the profiler's own stack walker.</span></span>  
  
 <span data-ttu-id="eb6f4-251">Para obter mais informações sobre como programar o criador de perfil para movimentar pilhas gerenciadas, consulte o [Icorprofilerinfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) método neste conjunto de documentação, e [movimentação de pilhas do criador de perfil do .NET Framework 2.0: Noções básicas e além](http://go.microsoft.com/fwlink/?LinkId=73638).</span><span class="sxs-lookup"><span data-stu-id="eb6f4-251">For more information about how to program the profiler to walk managed stacks, see the [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) method in this documentation set, and [Profiler Stack Walking in the .NET Framework 2.0: Basics and Beyond](http://go.microsoft.com/fwlink/?LinkId=73638).</span></span>
  
### <a name="shadow-stack"></a><span data-ttu-id="eb6f4-252">Pilha de sombra</span><span class="sxs-lookup"><span data-stu-id="eb6f4-252">Shadow Stack</span></span>  
 <span data-ttu-id="eb6f4-253">Usando o método de instantâneo com muita frequência pode criar rapidamente um problema de desempenho.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-253">Using the snapshot method too frequently can quickly create a performance issue.</span></span> <span data-ttu-id="eb6f4-254">Se você quiser fazer rastreamentos de pilha com frequência, em vez disso, o criador de perfil deve criar uma pilha de sombra usando o [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md), [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md), [FunctionTailcall2](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md), e [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) retornos de chamada de exceção.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-254">If you want to take stack traces frequently, your profiler should instead build a shadow stack by using the [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md), [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md), [FunctionTailcall2](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md), and [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) exception callbacks.</span></span> <span data-ttu-id="eb6f4-255">A pilha de sombra é sempre atual e rapidamente pode ser copiada para o armazenamento, sempre que um instantâneo da pilha é necessária.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-255">The shadow stack is always current and can quickly be copied to storage whenever a stack snapshot is needed.</span></span>  
  
 <span data-ttu-id="eb6f4-256">Uma pilha de sombra pode obter informações sobre instanciações genéricas, valores de retorno e argumentos de função.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-256">A shadow stack may obtain function arguments, return values, and information about generic instantiations.</span></span> <span data-ttu-id="eb6f4-257">Essas informações estão disponíveis apenas por meio da pilha de sombra e podem ser obtidas quando o controle é entregue para uma função.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-257">This information is available only through the shadow stack and may be obtained when control is handed to a function.</span></span> <span data-ttu-id="eb6f4-258">No entanto, essas informações podem não estar disponíveis durante a execução da função.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-258">However, this information may not be available later during the run of the function.</span></span>  
  
 [<span data-ttu-id="eb6f4-259">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-259">Back to top</span></span>](#top)  
  
<a name="callbacks"></a>   
## <a name="callbacks-and-stack-depth"></a><span data-ttu-id="eb6f4-260">Retornos de chamada e a profundidade da pilha</span><span class="sxs-lookup"><span data-stu-id="eb6f4-260">Callbacks and Stack Depth</span></span>  
 <span data-ttu-id="eb6f4-261">Retornos de chamada do criador de perfil podem ser emitidos em circunstâncias muito restritas a pilha e um estouro de pilha em um retorno de chamada do criador de perfil levará a uma saída de processo imediato.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-261">Profiler callbacks may be issued in very stack-constrained circumstances, and a stack overflow in a profiler callback will lead to an immediate process exit.</span></span> <span data-ttu-id="eb6f4-262">Um criador de perfil deve verificar se a ser usada como a pilha pequeno quanto possível em resposta a retornos de chamada.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-262">A profiler should make sure to use as little stack as possible in response to callbacks.</span></span> <span data-ttu-id="eb6f4-263">Se o criador de perfil se destina para uso em processos que são robustos em estouro de pilha, o criador de perfil em si também deve evitar estouro de pilha de disparo.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-263">If the profiler is intended for use against processes that are robust against stack overflow, the profiler itself should also avoid triggering stack overflow.</span></span>  
  
 [<span data-ttu-id="eb6f4-264">Voltar ao início</span><span class="sxs-lookup"><span data-stu-id="eb6f4-264">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="eb6f4-265">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="eb6f4-265">Related Topics</span></span>  
  
|<span data-ttu-id="eb6f4-266">Título</span><span class="sxs-lookup"><span data-stu-id="eb6f4-266">Title</span></span>|<span data-ttu-id="eb6f4-267">Descrição</span><span class="sxs-lookup"><span data-stu-id="eb6f4-267">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="eb6f4-268">Configurando um ambiente de criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-268">Setting Up a Profiling Environment</span></span>](../../../../docs/framework/unmanaged-api/profiling/setting-up-a-profiling-environment.md)|<span data-ttu-id="eb6f4-269">Explica como inicializar um criador de perfil, defina as notificações de eventos e criar o perfil de um serviço do Windows.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-269">Explains how to initialize a profiler, set event notifications, and profile a Windows Service.</span></span>|  
|[<span data-ttu-id="eb6f4-270">Interfaces de criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-270">Profiling Interfaces</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)|<span data-ttu-id="eb6f4-271">Descreve as interfaces não gerenciadas que usa a API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-271">Describes the unmanaged interfaces that the profiling API uses.</span></span>|  
|[<span data-ttu-id="eb6f4-272">Criando perfil de funções estáticas globais</span><span class="sxs-lookup"><span data-stu-id="eb6f4-272">Profiling Global Static Functions</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)|<span data-ttu-id="eb6f4-273">Descreve as funções estáticas globais não gerenciadas que usa a API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-273">Describes the unmanaged global static functions that the profiling API uses.</span></span>|  
|[<span data-ttu-id="eb6f4-274">Criando perfil de enumerações</span><span class="sxs-lookup"><span data-stu-id="eb6f4-274">Profiling Enumerations</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-enumerations.md)|<span data-ttu-id="eb6f4-275">Descreve as enumerações não gerenciadas que usa a API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-275">Describes the unmanaged enumerations that the profiling API uses.</span></span>|  
|[<span data-ttu-id="eb6f4-276">Estruturas de criação de perfil</span><span class="sxs-lookup"><span data-stu-id="eb6f4-276">Profiling Structures</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-structures.md)|<span data-ttu-id="eb6f4-277">Descreve as estruturas não gerenciadas que usa a API de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="eb6f4-277">Describes the unmanaged structures that the profiling API uses.</span></span>|
