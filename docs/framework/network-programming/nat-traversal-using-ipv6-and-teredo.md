---
title: Passagem de NAT usando IPv6 e Teredo
ms.date: 03/30/2017
ms.assetid: 568cd245-3300-49ef-a995-d81bf845d961
ms.openlocfilehash: f617dc8912091576727b90da1e9efb9ebd5f9bda
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59170750"
---
# <a name="nat-traversal-using-ipv6-and-teredo"></a><span data-ttu-id="d3270-102">Passagem de NAT usando IPv6 e Teredo</span><span class="sxs-lookup"><span data-stu-id="d3270-102">NAT Traversal using IPv6 and Teredo</span></span>
<span data-ttu-id="d3270-103">Foram feitas melhorias que dão suporte para a passagem de NAT (conversão de endereços de rede).</span><span class="sxs-lookup"><span data-stu-id="d3270-103">Enhancements were made that provide support for Network Address Translation (NAT) traversal.</span></span> <span data-ttu-id="d3270-104">Essas alterações são projetadas para uso com o IPv6 e Teredo, mas elas também são aplicáveis a outras tecnologias de túnel IP.</span><span class="sxs-lookup"><span data-stu-id="d3270-104">These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies.</span></span> <span data-ttu-id="d3270-105">Essas melhorias afetam as classes no <xref:System.Net> e nos namespaces relacionados.</span><span class="sxs-lookup"><span data-stu-id="d3270-105">These enhancements affect classes in the <xref:System.Net> and related namespaces.</span></span>  
  
 <span data-ttu-id="d3270-106">Essas alterações podem afetar os aplicativos cliente e aplicativos para servidores que planejam usar tecnologias de túnel IP.</span><span class="sxs-lookup"><span data-stu-id="d3270-106">These changes can affect client and server applications that plan to use IP tunneling technologies.</span></span>  
  
 <span data-ttu-id="d3270-107">As alterações para dar suporte à passagem NAT estão disponíveis somente para aplicativos que usam o .NET Framework versão 4.</span><span class="sxs-lookup"><span data-stu-id="d3270-107">The changes to support NAT traversal are available only for applications using .NET Framework version 4.</span></span> <span data-ttu-id="d3270-108">Esses recursos não estão disponíveis em versões anteriores do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d3270-108">These features are not available on earlier versions of the .NET Framework.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="d3270-109">Visão geral</span><span class="sxs-lookup"><span data-stu-id="d3270-109">Overview</span></span>  
 <span data-ttu-id="d3270-110">O protocolo IP versão 4 (IPv4) definiu um endereço IPv4 como tendo 32 bits de comprimento.</span><span class="sxs-lookup"><span data-stu-id="d3270-110">The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long.</span></span> <span data-ttu-id="d3270-111">Como resultado, o IPv4 dá suporte a aproximadamente 4 bilhões endereços IP exclusivos (2^32).</span><span class="sxs-lookup"><span data-stu-id="d3270-111">As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32).</span></span> <span data-ttu-id="d3270-112">Conforme o número de computadores e dispositivos de rede na Internet se expandiu na década de 1990, os limites do espaço de endereço IPv4 tornou-se aparente.</span><span class="sxs-lookup"><span data-stu-id="d3270-112">As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.</span></span>  
  
 <span data-ttu-id="d3270-113">Uma das várias técnicas usadas para estender o tempo de vida do IPv4 foi implantar o NAT para permitir que um único endereço IP público exclusivo representasse um grande número de endereços IP privados (Intranet privada).</span><span class="sxs-lookup"><span data-stu-id="d3270-113">One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet).</span></span> <span data-ttu-id="d3270-114">Os endereços IP privados subjacentes ao dispositivo NAT compartilham um único endereço IPv4 público.</span><span class="sxs-lookup"><span data-stu-id="d3270-114">The private IP addresses behind the NAT device share the single public IPv4 address.</span></span> <span data-ttu-id="d3270-115">O dispositivo NAT pode ser um dispositivo de hardware dedicado (um ponto de acesso sem fio e roteador de baixo custo, por exemplo) ou um computador que executa um serviço para fornecer NAT.</span><span class="sxs-lookup"><span data-stu-id="d3270-115">The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT.</span></span> <span data-ttu-id="d3270-116">Um dispositivo ou serviço para esse endereço IP público converte os pacotes de rede IP entre a Internet pública e a Intranet privada.</span><span class="sxs-lookup"><span data-stu-id="d3270-116">A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.</span></span>  
  
 <span data-ttu-id="d3270-117">Esse esquema funciona bem para aplicativos de cliente em execução na Intranet privada que enviam solicitações para outros endereços IP (geralmente servidores) na Internet.</span><span class="sxs-lookup"><span data-stu-id="d3270-117">This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet.</span></span> <span data-ttu-id="d3270-118">O dispositivo NAT ou servidor pode manter um mapeamento de solicitações de cliente de modo que quando uma resposta é retornada, ele sabe para que local enviar a resposta.</span><span class="sxs-lookup"><span data-stu-id="d3270-118">The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response.</span></span> <span data-ttu-id="d3270-119">Mas esse esquema apresenta problemas para aplicativos executados em uma Intranet privada subjacente ao dispositivo NAT que deseja fornecer serviços, escutar em busca de pacotes e responder.</span><span class="sxs-lookup"><span data-stu-id="d3270-119">But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond.</span></span> <span data-ttu-id="d3270-120">Isso é especialmente o caso para aplicativos de ponto a ponto.</span><span class="sxs-lookup"><span data-stu-id="d3270-120">This is particularly the case for peer-to-peer applications.</span></span>  
  
 <span data-ttu-id="d3270-121">O protocolo IPv6 definiu um endereço IPv4 como tendo 128 bits de comprimento.</span><span class="sxs-lookup"><span data-stu-id="d3270-121">The IPv6 protocol defined an IPv4 address as 128 bits long.</span></span> <span data-ttu-id="d3270-122">Como resultado, o IPv6 dá suporte a um espaço de endereço IP muito grande de 3,2 x 10^38 endereços exclusivos (2^128).</span><span class="sxs-lookup"><span data-stu-id="d3270-122">As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128).</span></span> <span data-ttu-id="d3270-123">Com um espaço de endereço desse tamanho, é possível que cada dispositivo conectado à Internet receba um endereço exclusivo.</span><span class="sxs-lookup"><span data-stu-id="d3270-123">With an address space of this size, it is possible for every device connected to the Internet to be given a unique address.</span></span> <span data-ttu-id="d3270-124">No entanto, há problemas.</span><span class="sxs-lookup"><span data-stu-id="d3270-124">But there are problems.</span></span> <span data-ttu-id="d3270-125">Grande parte do mundo ainda está usando somente IPv4.</span><span class="sxs-lookup"><span data-stu-id="d3270-125">Much of the world is still using only IPv4.</span></span> <span data-ttu-id="d3270-126">Em particular, muitos dos roteadores e pontos de acesso sem fio usados por residências, organizações e empresas de pequeno porte não dão suporte a IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3270-126">In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6.</span></span> <span data-ttu-id="d3270-127">Além disso, alguns provedores de serviços de Internet que atendem esses clientes não dão suporte ou não configuraram o suporte a IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3270-127">Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.</span></span>  
  
 <span data-ttu-id="d3270-128">Várias tecnologias de transição para IPv6 foram desenvolvidas para realização de túnel de endereços IPv6 em um pacote IPv4.</span><span class="sxs-lookup"><span data-stu-id="d3270-128">Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet.</span></span> <span data-ttu-id="d3270-129">Essas tecnologias incluem túneis 6to4, ISATAP e Teredo que fornecem a atribuição de endereço e túnel automático host a host para unicast de tráfego IPv6 quando os hosts IPv6 devem fazer a passagem por redes IP4 para alcançar outras redes IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3270-129">These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks.</span></span> <span data-ttu-id="d3270-130">Os pacotes IPv6 são enviados em túnel como pacotes IPv4.</span><span class="sxs-lookup"><span data-stu-id="d3270-130">IPv6 packets are sent tunneled as IPv4 packets.</span></span> <span data-ttu-id="d3270-131">Várias técnicas de túnel estão sendo usadas que permitir a passagem de NAT para endereços IPv6 por meio de um dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="d3270-131">Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.</span></span>  
  
 <span data-ttu-id="d3270-132">Teredo é uma das tecnologias de transição para IPv6 que oferece conectividade IPv6 em redes IPv4.</span><span class="sxs-lookup"><span data-stu-id="d3270-132">Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks.</span></span> <span data-ttu-id="d3270-133">Teredo está documentado em RFC 4380 publicado pela IETF (Internet Engineering Task Force).</span><span class="sxs-lookup"><span data-stu-id="d3270-133">Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF).</span></span> <span data-ttu-id="d3270-134">O Windows XP SP2 e posteriores dão suporte a um adaptador virtual Teredo que pode fornecer um endereço IPv6 público no intervalo 2001:0::/32.</span><span class="sxs-lookup"><span data-stu-id="d3270-134">Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32.</span></span> <span data-ttu-id="d3270-135">Esse endereço IPv6 pode ser usado para escutar conexões de entrada da Internet e pode ser fornecido aos clientes habilitados para IPv6 que desejam se conectar ao serviço de escuta.</span><span class="sxs-lookup"><span data-stu-id="d3270-135">This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service.</span></span> <span data-ttu-id="d3270-136">Isso libera um aplicativo da preocupação sobre como endereçar um computador subjacente a um dispositivo NAT, já que o aplicativo pode se conectar a ele apenas usando seu endereço IPv6 Teredo.</span><span class="sxs-lookup"><span data-stu-id="d3270-136">This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.</span></span>  
  
## <a name="enhancements-to-support-nat-traversal-and-teredo"></a><span data-ttu-id="d3270-137">Melhorias para suporte a passagem NAT e Teredo</span><span class="sxs-lookup"><span data-stu-id="d3270-137">Enhancements to Support NAT Traversal and Teredo</span></span>  
 <span data-ttu-id="d3270-138">Descreve as melhorias adicionadas aos namespaces <xref:System.Net>, <xref:System.Net.NetworkInformation> e <xref:System.Net.Sockets> para dar suporte à passagem NAT usando o IPv6 e o Teredo.</span><span class="sxs-lookup"><span data-stu-id="d3270-138">Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo.</span></span>  
  
 <span data-ttu-id="d3270-139">Vários métodos foram adicionados à classe <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> para obter a lista de endereços IP unicast no host.</span><span class="sxs-lookup"><span data-stu-id="d3270-139">Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host.</span></span> <span data-ttu-id="d3270-140">O método <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> começa uma solicitação assíncrona para recuperar a tabela de endereços IP unicast estáveis no computador local.</span><span class="sxs-lookup"><span data-stu-id="d3270-140">The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="d3270-141">O método <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> envia uma solicitação assíncrona pendente para recuperar a tabela de endereços IP unicast estáveis no computador local.</span><span class="sxs-lookup"><span data-stu-id="d3270-141">The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="d3270-142">O método <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> é uma solicitação síncrona para recuperar a tabela de endereços IP unicast estáveis no computador local, aguardando até que a tabela de endereços se estabilize se necessário.</span><span class="sxs-lookup"><span data-stu-id="d3270-142">The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.</span></span>  
  
 <span data-ttu-id="d3270-143">A propriedade <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> pode ser usada para determinar se um <xref:System.Net.IPAddress> é um endereço Teredo IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3270-143">The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address.</span></span>  
  
 <span data-ttu-id="d3270-144">Usar esses novos métodos de classe <xref:System.Net.NetworkInformation.IPGlobalProperties> em combinação com a propriedade <xref:System.Net.IPAddress.IsIPv6Teredo%2A> permite que um aplicativo localize facilmente o endereço Teredo.</span><span class="sxs-lookup"><span data-stu-id="d3270-144">Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address.</span></span> <span data-ttu-id="d3270-145">Um aplicativo normalmente só precisará saber o endereço Teredo local se ele estiver se comunicando essas informações para aplicativos remotos.</span><span class="sxs-lookup"><span data-stu-id="d3270-145">An application normally only needs to know the local Teredo address if it is communicating this information to remote applications.</span></span> <span data-ttu-id="d3270-146">Por exemplo, um aplicativo ponto a ponto pode enviar todos os seus endereços IPv6 em um servidor de emparelhamento que pode, em seguida, encaminhá-las a outros pares para permitir a comunicação direta.</span><span class="sxs-lookup"><span data-stu-id="d3270-146">For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.</span></span>  
  
 <span data-ttu-id="d3270-147">Um aplicativo normalmente deve definir seu serviço de escuta para escutar em <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> em vez de no endereço Teredo local.</span><span class="sxs-lookup"><span data-stu-id="d3270-147">An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address.</span></span> <span data-ttu-id="d3270-148">Portanto, se um par ou cliente remoto tem uma rota IPv6 direta para o host do serviço de escuta, o cliente ou par pode se conectar diretamente usando IPv6 e não precisa usar o Teredo para fazer túnel de pacotes.</span><span class="sxs-lookup"><span data-stu-id="d3270-148">So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.</span></span>  
  
 <span data-ttu-id="d3270-149">Para aplicativos de TCP, a classe <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> tem um método <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> para habilitar a passagem NAT.</span><span class="sxs-lookup"><span data-stu-id="d3270-149">For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal.</span></span> <span data-ttu-id="d3270-150">Para aplicativos de UDP, a classe <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> tem um método <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> para habilitar a passagem NAT.</span><span class="sxs-lookup"><span data-stu-id="d3270-150">For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal.</span></span>  
  
 <span data-ttu-id="d3270-151">Para aplicativos que usam o <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> e classes relacionadas, os métodos <xref:System.Net.Sockets.Socket.GetSocketOption%2A> e <xref:System.Net.Sockets.Socket.SetSocketOption%2A> podem ser usados com a opção de soquete <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> para consultar, habilitar ou desabilitar a passagem NAT.</span><span class="sxs-lookup"><span data-stu-id="d3270-151">For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d3270-152">Consulte também</span><span class="sxs-lookup"><span data-stu-id="d3270-152">See also</span></span>

- <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=nameWithType>
- <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=nameWithType>
