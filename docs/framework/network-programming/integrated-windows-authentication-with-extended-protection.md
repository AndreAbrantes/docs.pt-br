---
title: "Autenticação Integrada do Windows com proteção estendida"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- VB
- CSharp
- C++
- jsharp
ms.assetid: 81731998-d5e7-49e4-ad38-c8e6d01689d0
caps.latest.revision: 13
author: mcleblanc
ms.author: markl
manager: markl
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: d5e4c5984054ab54e0a6f33c2e1e17b89ca366f6
ms.contentlocale: pt-br
ms.lasthandoff: 08/21/2017

---
# <a name="integrated-windows-authentication-with-extended-protection"></a><span data-ttu-id="46d62-102">Autenticação Integrada do Windows com proteção estendida</span><span class="sxs-lookup"><span data-stu-id="46d62-102">Integrated Windows Authentication with Extended Protection</span></span>
<span data-ttu-id="46d62-103">Foram feitas melhorias que afetam a maneira como a autenticação integrada do Windows é controlada por <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream> e por classes relacionadas no <xref:System.Net> e por namespaces relacionados.</span><span class="sxs-lookup"><span data-stu-id="46d62-103">Enhancements were made that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream>, and related classes in the <xref:System.Net> and related namespaces.</span></span> <span data-ttu-id="46d62-104">Foi adicionado suporte à proteção estendida a fim de aprimorar a segurança.</span><span class="sxs-lookup"><span data-stu-id="46d62-104">Support was added for extended protection to enhance security.</span></span>  
  
 <span data-ttu-id="46d62-105">Essas alterações podem afetar os aplicativos que usam essas classes para fazer solicitações da Web e receber respostas em que a autenticação integrada do Windows é usada.</span><span class="sxs-lookup"><span data-stu-id="46d62-105">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication is used.</span></span> <span data-ttu-id="46d62-106">Essa alteração também pode afetar os servidores Web e aplicativos cliente configurados para usar a autenticação integrada do Windows.</span><span class="sxs-lookup"><span data-stu-id="46d62-106">This change can also impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="46d62-107">Essas alterações também podem afetar os aplicativos que usam essas classes para fazer outros tipos de solicitações e receber respostas em que a autenticação integrada do Windows é usada.</span><span class="sxs-lookup"><span data-stu-id="46d62-107">These changes can also affect applications that use these classes to make other types of requests and receive responses where integrated Windows authentication is used.</span></span>  
  
 <span data-ttu-id="46d62-108">As alterações para dar suporte à proteção estendida estão disponíveis somente para aplicativos no Windows 7 e Windows Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="46d62-108">The changes to support extended protection are available only for applications on Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="46d62-109">Os recursos de proteção estendida não estão disponíveis em versões anteriores do Windows.</span><span class="sxs-lookup"><span data-stu-id="46d62-109">The extended protection features are not available on earlier versions of Windows.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="46d62-110">Visão Geral</span><span class="sxs-lookup"><span data-stu-id="46d62-110">Overview</span></span>  
 <span data-ttu-id="46d62-111">O design da autenticação integrada do Windows permite que algumas respostas de desafio de credencial sejam universais, o que significa que elas podem ser reutilizadas ou encaminhadas.</span><span class="sxs-lookup"><span data-stu-id="46d62-111">The design of integrated Windows authentication allows for some credential challenge responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="46d62-112">As respostas de desafio devem ser construídas no mínimo com informações específicas do destino e preferencialmente também com algumas informações específicas de canal.</span><span class="sxs-lookup"><span data-stu-id="46d62-112">The challenge responses should be constructed at a minimum with target specific information and preferably also with some channel specific information.</span></span> <span data-ttu-id="46d62-113">Os serviços, em seguida, podem fornecer proteção estendida para assegurar que as respostas de desafio de credencial contenham informações específicas do serviço, tal como um SPN (nome da entidade de serviço).</span><span class="sxs-lookup"><span data-stu-id="46d62-113">Services can then provide extended protection to ensure that credential challenge responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="46d62-114">Com essas informações nas trocas de credenciais, os serviços são capazes de proteger melhor contra o uso mal intencionado de respostas de desafio de credencial que podem ter sido usadas incorretamente.</span><span class="sxs-lookup"><span data-stu-id="46d62-114">With this information in the credential exchanges, services are able to better protect against malicious use of credential challenge responses that might have been improperly used.</span></span>  
  
 <span data-ttu-id="46d62-115">O design de proteção estendida é uma melhoria projetada para minimizar ataques de retransmissão de autenticação de protocolos de autenticação.</span><span class="sxs-lookup"><span data-stu-id="46d62-115">The extended protection design is an enhancement to authentication protocols designed to mitigate authentication relay attacks.</span></span> <span data-ttu-id="46d62-116">Ele gira em torno do conceito de informações de associação de serviço/canal.</span><span class="sxs-lookup"><span data-stu-id="46d62-116">It revolves around the concept of channel and service binding information.</span></span>  
  
 <span data-ttu-id="46d62-117">Os objetivos gerais são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="46d62-117">The overall objectives are the following:</span></span>  
  
1.  <span data-ttu-id="46d62-118">Se o cliente é atualizado para dar suporte a proteção estendida, os aplicativos devem fornecer informações de associação de serviço e de associação de canal para todos os protocolos de autenticação com suporte.</span><span class="sxs-lookup"><span data-stu-id="46d62-118">If the client is updated to support the extended protection, applications should supply a channel binding and service binding information to all supported authentication protocols.</span></span> <span data-ttu-id="46d62-119">Informações de associação de canal só podem ser fornecidas quando há um canal (TLS) ao qual se associar.</span><span class="sxs-lookup"><span data-stu-id="46d62-119">Channel binding information can only be supplied when there is a channel (TLS) to bind to.</span></span> <span data-ttu-id="46d62-120">Informações de associação de serviço sempre devem ser fornecidas.</span><span class="sxs-lookup"><span data-stu-id="46d62-120">Service binding information should always be supplied.</span></span>  
  
2.  <span data-ttu-id="46d62-121">Servidores atualizados que estão configurados corretamente poderão verificar as e informações de associação de serviço e de associação de canal quando elas estiverem presentes no token de autenticação de cliente e rejeitar a tentativa de autenticação se as associações de canal não corresponderem.</span><span class="sxs-lookup"><span data-stu-id="46d62-121">Updated servers which are properly configured may verify the channel and service binding information when it is present in the client authentication token and reject the authentication attempt if the channel bindings do not match.</span></span> <span data-ttu-id="46d62-122">Dependendo do cenário de implantação, os servidores podem verificar a associação de canal, a associação de serviço ou ambas.</span><span class="sxs-lookup"><span data-stu-id="46d62-122">Depending on the deployment scenario, servers may verify channel binding, service binding or both.</span></span>  
  
3.  <span data-ttu-id="46d62-123">Servidores atualizados têm a capacidade de aceitar ou rejeitar solicitações de cliente de nível inferior que não contêm as informações de associação de canal com base em política.</span><span class="sxs-lookup"><span data-stu-id="46d62-123">Updated servers have the ability to accept or reject down-level client requests that do not contain the channel binding information based on policy.</span></span>  
  
 <span data-ttu-id="46d62-124">Informações usadas pela proteção estendida consistem em uma ou ambas as duas partes a seguir:</span><span class="sxs-lookup"><span data-stu-id="46d62-124">Information used by extended protection consists of one or both of the following two parts:</span></span>  
  
1.  <span data-ttu-id="46d62-125">Um token de associação de canal ou CBT.</span><span class="sxs-lookup"><span data-stu-id="46d62-125">A Channel Binding Token or CBT.</span></span>  
  
2.  <span data-ttu-id="46d62-126">Informações de associação de serviço na forma de um nome da entidade de serviço ou SPN.</span><span class="sxs-lookup"><span data-stu-id="46d62-126">Service Binding information in the form of a Service Principal Name or SPN.</span></span>  
  
 <span data-ttu-id="46d62-127">Informações de associação de serviço são uma indicação da intenção do cliente para autenticar para um ponto de extremidade de serviço específico.</span><span class="sxs-lookup"><span data-stu-id="46d62-127">Service Binding information is an indication of a client’s intent to authenticate to a particular service endpoint.</span></span> <span data-ttu-id="46d62-128">Elas são comunicadas de cliente para servidor com as seguintes propriedades:</span><span class="sxs-lookup"><span data-stu-id="46d62-128">It is communicated from client to server with the following properties:</span></span>  
  
-   <span data-ttu-id="46d62-129">O valor de SPN deve estar disponível para o servidor que executa a autenticação de cliente em forma de texto não criptografado.</span><span class="sxs-lookup"><span data-stu-id="46d62-129">The SPN value must be available to the server performing client authentication in clear text form.</span></span>  
  
-   <span data-ttu-id="46d62-130">O valor do SPN é público.</span><span class="sxs-lookup"><span data-stu-id="46d62-130">The value of the SPN is public.</span></span>  
  
-   <span data-ttu-id="46d62-131">O SPN deve ser protegido criptograficamente em trânsito, de modo que um ataque man-in-the-middle não possa inserir, remover nem modificar seu valor.</span><span class="sxs-lookup"><span data-stu-id="46d62-131">The SPN must be cryptographically protected in transit such that a man-in-the-middle attack cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="46d62-132">Um CBT é uma propriedade de externa do canal de segurança (como TLS) usada para ligá-lo (associá-lo) a uma conversa em um canal interno autenticado pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-132">A CBT is a property of the outer secure channel (such as TLS) used to tie (bind) it to a conversation over an inner, client-authenticated channel.</span></span> <span data-ttu-id="46d62-133">O CBT deve ter as seguintes propriedades (também definidas pela RFC 5056 da IETF):</span><span class="sxs-lookup"><span data-stu-id="46d62-133">The CBT must have the following properties (also defined by IETF RFC 5056):</span></span>  
  
-   <span data-ttu-id="46d62-134">Quando um canal externo existe, o valor do CBT deve ser uma propriedade que identifica o canal externo ou o ponto de extremidade do servidor, no qual se chega independentemente por ambos o lado do cliente e o lado do servidor de uma conversa.</span><span class="sxs-lookup"><span data-stu-id="46d62-134">When an outer channel exists, the value of the CBT must be a property identifying either the outer channel or the server endpoint, independently arrived at by both client and server sides of a conversation.</span></span>  
  
-   <span data-ttu-id="46d62-135">O valor do CBT enviado pelo cliente não deve ser algo que um invasor pode influenciar.</span><span class="sxs-lookup"><span data-stu-id="46d62-135">Value of the CBT sent by the client must not be something an attacker can influence.</span></span>  
  
-   <span data-ttu-id="46d62-136">Não há garantias sobre sigilo do valor de CBT.</span><span class="sxs-lookup"><span data-stu-id="46d62-136">No guarantees are made about secrecy of the CBT value.</span></span> <span data-ttu-id="46d62-137">Isso não significa no entanto que o valor da associação de serviço, bem como informações de associação de canal, sempre possam ser examinadas por qualquer outro que não o servidor que executa a autenticação, já que o protocolo portando o CBT pode estar criptografando-o.</span><span class="sxs-lookup"><span data-stu-id="46d62-137">This does not however mean that the value of the service binding as well as channel binding information can always be examined by any other but the server performing authentication, as the protocol carrying the CBT may be encrypting it.</span></span>  
  
-   <span data-ttu-id="46d62-138">O CBT deve ter sua integridade protegida criptograficamente em trânsito, de modo que um invasor não possa inserir, remover nem modificar seu valor.</span><span class="sxs-lookup"><span data-stu-id="46d62-138">The CBT must be cryptographically integrity protected in transit such that an attacker cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="46d62-139">A associação de canal é realizada pelo cliente transferindo o SPN e o CBT para o servidor de maneira inviolável.</span><span class="sxs-lookup"><span data-stu-id="46d62-139">Channel binding is accomplished by the client transferring the SPN and the CBT to the server in a tamperproof fashion.</span></span> <span data-ttu-id="46d62-140">O servidor valida as informações de associação de canal de acordo com sua política e rejeita tentativas de autenticação cujo destino pretendido ele não acredita ter sido ele mesmo.</span><span class="sxs-lookup"><span data-stu-id="46d62-140">The server validates the channel binding information in accordance with its policy and rejects authentication attempts for which it does not believe itself to have been the intended target.</span></span> <span data-ttu-id="46d62-141">Desse modo, os dois canais tornam-se criptograficamente associados juntos.</span><span class="sxs-lookup"><span data-stu-id="46d62-141">This way, the two channels become cryptographically bound together.</span></span>  
  
 <span data-ttu-id="46d62-142">Para preservar a compatibilidade com os clientes e aplicativos existentes, um servidor pode ser configurado para permitir tentativas de autenticação por clientes que ainda não dão suporte à proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-142">To preserve compatibility with existing clients and applications, a server may be configured to allow authentication attempts by clients that do not yet support extended protection.</span></span> <span data-ttu-id="46d62-143">Isso é chamado de uma configuração "parcialmente protegida", em contraste com uma configuração "totalmente protegida".</span><span class="sxs-lookup"><span data-stu-id="46d62-143">This is referred to as a "partially hardened" configuration, in contrast to a "fully hardened" configuration.</span></span>  
  
 <span data-ttu-id="46d62-144">Vários componentes nos namespaces <xref:System.Net> e <xref:System.Net.Security> executam a autenticação integrada do Windows em nome de um aplicativo de chamada.</span><span class="sxs-lookup"><span data-stu-id="46d62-144">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="46d62-145">Esta seção descreve as alterações nos componentes do System.Net para adicionar a proteção estendida no uso que eles fazem da autenticação integrada do Windows.</span><span class="sxs-lookup"><span data-stu-id="46d62-145">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="46d62-146">A proteção estendida tem suporte atualmente no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="46d62-146">Extended protection is currently supported on Windows 7.</span></span> <span data-ttu-id="46d62-147">Um mecanismo é fornecido para que um aplicativo possa determinar se o sistema operacional dá suporte à proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-147">A mechanism is provided so an application can determine if the operating system supports extended protection.</span></span>  
  
## <a name="changes-to-support-extended-protection"></a><span data-ttu-id="46d62-148">Alterações para dar suporte à proteção estendida</span><span class="sxs-lookup"><span data-stu-id="46d62-148">Changes to Support Extended Protection</span></span>  
 <span data-ttu-id="46d62-149">O processo de autenticação usado com autenticação integrada do Windows, dependendo do protocolo de autenticação usado, geralmente inclui um desafio emitido pelo computador de destino e enviado de volta para o computador cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-149">The authentication process used with integrated Windows authentication, depending on the authentication protocol used, often includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="46d62-150">A proteção estendida adiciona novos recursos para esse processo de autenticação</span><span class="sxs-lookup"><span data-stu-id="46d62-150">Extended protection adds new features to this authentication process</span></span>  
  
 <span data-ttu-id="46d62-151">O namespace <xref:System.Security.Authentication.ExtendedProtection> dá suporte à autenticação usando proteção estendida para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="46d62-151">The <xref:System.Security.Authentication.ExtendedProtection> namespace provides support for authentication using extended protection for applications.</span></span> <span data-ttu-id="46d62-152">A classe <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> nesse namespace representa uma associação de canal.</span><span class="sxs-lookup"><span data-stu-id="46d62-152">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> class in this namespace represents a channel binding.</span></span> <span data-ttu-id="46d62-153">A classe <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> nesse namespace representa a política de proteção estendida usada pelo servidor para validar as conexões de entrada do cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-153">The <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class in this namespace represents the extended protection policy used by the server to validate incoming client connections.</span></span> <span data-ttu-id="46d62-154">Outros membros de classe são usados com proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-154">Other class members are used with extended protection.</span></span>  
  
 <span data-ttu-id="46d62-155">Para aplicativos para servidores, essas classes incluem o seguinte:</span><span class="sxs-lookup"><span data-stu-id="46d62-155">For server applications, these classes include the following:</span></span>  
  
 <span data-ttu-id="46d62-156">Um <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> que tem os seguintes elementos:</span><span class="sxs-lookup"><span data-stu-id="46d62-156">A <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> that has the following elements:</span></span>  
  
-   <span data-ttu-id="46d62-157">Uma propriedade <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> que indica se o sistema operacional dá suporte à autenticação integrada do Windows com proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-157">An <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> property that indicates whether the operating system supports integrated windows authentication with extended protection.</span></span>  
  
-   <span data-ttu-id="46d62-158">Um valor <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> que indica quando a política de proteção estendida deve ser imposta.</span><span class="sxs-lookup"><span data-stu-id="46d62-158">A <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> value that indicates when the extended protection policy should be enforced.</span></span>  
  
-   <span data-ttu-id="46d62-159">Um valor <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> que indica o cenário de implantação.</span><span class="sxs-lookup"><span data-stu-id="46d62-159">A <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> value that indicates the deployment scenario.</span></span> <span data-ttu-id="46d62-160">Isso influencia o modo como a proteção estendida é verificada.</span><span class="sxs-lookup"><span data-stu-id="46d62-160">This influences how extended protection is checked.</span></span>  
  
-   <span data-ttu-id="46d62-161">Um <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> opcional que contém a lista de SPN personalizada que é usada para fazer a correspondência com o SPN fornecido pelo cliente como o destino pretendido da autenticação.</span><span class="sxs-lookup"><span data-stu-id="46d62-161">An optional <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> that contains the custom SPN list that is used to match against the SPN provided by the client as the intended target of the authentication.</span></span>  
  
-   <span data-ttu-id="46d62-162">Um <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> opcional que contém uma associação de canal personalizada a ser usada para validação.</span><span class="sxs-lookup"><span data-stu-id="46d62-162">An optional <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> that contains a custom channel binding to use for validation.</span></span> <span data-ttu-id="46d62-163">Esse cenário não é um caso comum</span><span class="sxs-lookup"><span data-stu-id="46d62-163">This scenario is not a common case</span></span>  
  
 <span data-ttu-id="46d62-164">O namespace <xref:System.Security.Authentication.ExtendedProtection.Configuration> dá suporte à configuração da autenticação usando proteção estendida para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="46d62-164">The <xref:System.Security.Authentication.ExtendedProtection.Configuration> namespace provides support for configuration of authentication using extended protection for applications.</span></span>  
  
 <span data-ttu-id="46d62-165">Um número de alterações de recursos foram feitas para dar suporte à proteção estendida no namespace <xref:System.Net> existente.</span><span class="sxs-lookup"><span data-stu-id="46d62-165">A number of feature changes were made to support extended protection in the existing <xref:System.Net> namespace.</span></span> <span data-ttu-id="46d62-166">Essas alterações incluem o seguinte:</span><span class="sxs-lookup"><span data-stu-id="46d62-166">These changes include the following:</span></span>  
  
-   <span data-ttu-id="46d62-167">Uma nova classe <xref:System.Net.TransportContext> adicionada ao namespace <xref:System.Net> que representa um contexto de transporte.</span><span class="sxs-lookup"><span data-stu-id="46d62-167">A new <xref:System.Net.TransportContext> class added to the <xref:System.Net> namespace that represents a transport context.</span></span>  
  
-   <span data-ttu-id="46d62-168">Novos métodos de sobrecarga <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> e <xref:System.Net.HttpWebRequest.GetRequestStream%2A> na classe <xref:System.Net.HttpWebRequest> que permitem recuperar o <xref:System.Net.TransportContext> para dar suporte à proteção estendida para aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-168">New <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> and <xref:System.Net.HttpWebRequest.GetRequestStream%2A> overload methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> to support extended protection for client applications.</span></span>  
  
-   <span data-ttu-id="46d62-169">Adições para as classes <xref:System.Net.HttpListener> e <xref:System.Net.HttpListenerRequest> para dar suporte a aplicativos para servidores.</span><span class="sxs-lookup"><span data-stu-id="46d62-169">Additions to the <xref:System.Net.HttpListener> and <xref:System.Net.HttpListenerRequest> classes to support server applications.</span></span>  
  
 <span data-ttu-id="46d62-170">Foi feita uma alteração de recurso para dar suporte à proteção estendida para aplicativos cliente SMTP existentes no namespace <xref:System.Net.Mail>:</span><span class="sxs-lookup"><span data-stu-id="46d62-170">A feature change was made to support extended protection for SMTP client applications in the existing <xref:System.Net.Mail> namespace:</span></span>  
  
-   <span data-ttu-id="46d62-171">Uma propriedade <xref:System.Net.Mail.SmtpClient.TargetName%2A> na classe <xref:System.Net.Mail.SmtpClient> que representa o SPN a ser usado para autenticação ao usar proteção estendida para aplicativos cliente SMTP.</span><span class="sxs-lookup"><span data-stu-id="46d62-171">A <xref:System.Net.Mail.SmtpClient.TargetName%2A> property in the <xref:System.Net.Mail.SmtpClient> class that represents the SPN to use for authentication when using extended protection for SMTP client applications.</span></span>  
  
 <span data-ttu-id="46d62-172">Um número de alterações de recursos foram feitas para dar suporte à proteção estendida no namespace <xref:System.Net.Security> existente.</span><span class="sxs-lookup"><span data-stu-id="46d62-172">A number of feature changes were made to support extended protection in the existing <xref:System.Net.Security> namespace.</span></span> <span data-ttu-id="46d62-173">Essas alterações incluem o seguinte:</span><span class="sxs-lookup"><span data-stu-id="46d62-173">These changes include the following:</span></span>  
  
-   <span data-ttu-id="46d62-174">Novos métodos de sobrecarga <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> e <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> na classe <xref:System.Net.Security.NegotiateStream> que permitem passar um CBT para dar suporte à proteção estendida para aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-174">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing a CBT to support extended protection for client applications.</span></span>  
  
-   <span data-ttu-id="46d62-175">Novos métodos de sobrecarga <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> e <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> na classe <xref:System.Net.Security.NegotiateStream> que permitem passar um <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> para dar suporte à proteção estendida para aplicativos para servidores.</span><span class="sxs-lookup"><span data-stu-id="46d62-175">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> to support extended protection for server applications.</span></span>  
  
-   <span data-ttu-id="46d62-176">Uma nova propriedade <xref:System.Net.Security.SslStream.TransportContext%2A> na classe <xref:System.Net.Security.SslStream> para dar suporte à proteção estendida para aplicativos cliente e aplicativos para servidores.</span><span class="sxs-lookup"><span data-stu-id="46d62-176">A new <xref:System.Net.Security.SslStream.TransportContext%2A> property in the <xref:System.Net.Security.SslStream> class to support extended protection for client and server applications.</span></span>  
  
 <span data-ttu-id="46d62-177">Uma propriedade <xref:System.Net.Configuration.SmtpNetworkElement> foi adicionada para dar suporte à configuração da proteção estendida para clientes SMTP no namespace <xref:System.Net.Security>.</span><span class="sxs-lookup"><span data-stu-id="46d62-177">A <xref:System.Net.Configuration.SmtpNetworkElement> property was added to support configuration of extended protection for SMTP clients in the <xref:System.Net.Security> namespace.</span></span>  
  
## <a name="extended-protection-for-client-applications"></a><span data-ttu-id="46d62-178">Proteção estendida para aplicativos cliente</span><span class="sxs-lookup"><span data-stu-id="46d62-178">Extended Protection for Client Applications</span></span>  
 <span data-ttu-id="46d62-179">O suporte à proteção estendida para a maioria dos aplicativos cliente ocorre automaticamente.</span><span class="sxs-lookup"><span data-stu-id="46d62-179">Extended protection support for most client applications happens automatically.</span></span> <span data-ttu-id="46d62-180">As classes <xref:System.Net.HttpWebRequest> e <xref:System.Net.Mail.SmtpClient> dão suporte à proteção estendida sempre que a versão subjacente do Windows dá suporte à proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-180">The <xref:System.Net.HttpWebRequest> and <xref:System.Net.Mail.SmtpClient> classes support extended protection whenever the underlying version of Windows supports extended protection.</span></span> <span data-ttu-id="46d62-181">Uma instância de <xref:System.Net.HttpWebRequest> envia um SPN construído com base em <xref:System.Uri>.</span><span class="sxs-lookup"><span data-stu-id="46d62-181">An <xref:System.Net.HttpWebRequest> instance sends an SPN constructed from the <xref:System.Uri>.</span></span> <span data-ttu-id="46d62-182">Por padrão, uma instância de <xref:System.Net.Mail.SmtpClient> envia um SPN construído com base no nome do host do servidor de email SMTP.</span><span class="sxs-lookup"><span data-stu-id="46d62-182">By default, an <xref:System.Net.Mail.SmtpClient> instance sends an SPN constructed from the host name of the SMTP mail server.</span></span>  
  
 <span data-ttu-id="46d62-183">Para autenticação personalizada, os aplicativos cliente podem usar os métodos <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=fullName> ou <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=fullName> na classe <xref:System.Net.HttpWebRequest>, que permitem recuperar o <xref:System.Net.TransportContext> e o CBT usando o método <xref:System.Net.TransportContext.GetChannelBinding%2A>.</span><span class="sxs-lookup"><span data-stu-id="46d62-183">For custom authentication, client applications can use the <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=fullName> or <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=fullName> methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> and the CBT using the <xref:System.Net.TransportContext.GetChannelBinding%2A> method.</span></span>  
  
 <span data-ttu-id="46d62-184">O SPN a ser usado para autenticação integrada do Windows enviada por uma instância de <xref:System.Net.HttpWebRequest> para um determinado serviço pode ser substituída pela configuração da propriedade <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A>.</span><span class="sxs-lookup"><span data-stu-id="46d62-184">The SPN to use for integrated Windows authentication sent by an <xref:System.Net.HttpWebRequest> instance to a given service can be overridden by setting the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property.</span></span>  
  
 <span data-ttu-id="46d62-185">A propriedade <xref:System.Net.Mail.SmtpClient.TargetName%2A> pode ser usada para definir um SPN personalizado a ser usado para autenticação integrada do Windows para a conexão SMTP.</span><span class="sxs-lookup"><span data-stu-id="46d62-185">The <xref:System.Net.Mail.SmtpClient.TargetName%2A> property can be used to set a custom SPN to use for integrated Windows authentication for the SMTP connection.</span></span>  
  
## <a name="extended-protection-for-server-applications"></a><span data-ttu-id="46d62-186">Proteção estendida para aplicativos para servidores</span><span class="sxs-lookup"><span data-stu-id="46d62-186">Extended Protection for Server Applications</span></span>  
 <span data-ttu-id="46d62-187"><xref:System.Net.HttpListener> fornece automaticamente mecanismos para validar as associações de serviço ao executar a autenticação HTTP.</span><span class="sxs-lookup"><span data-stu-id="46d62-187"><xref:System.Net.HttpListener> automatically provides mechanisms for validating service bindings when performing HTTP authentication.</span></span>  
  
 <span data-ttu-id="46d62-188">O cenário mais seguro é habilitar a proteção estendida para prefixos HTTPS://.</span><span class="sxs-lookup"><span data-stu-id="46d62-188">The most secure scenario is to enable extended protection for HTTPS:// prefixes.</span></span> <span data-ttu-id="46d62-189">Nesse caso, defina <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=fullName> para um <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> com <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> definida para <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> ou <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> e <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> definida para <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>. Um valor de <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> coloca <xref:System.Net.HttpListener> no modo parcialmente elevado, enquanto <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponde ao modo totalmente elevado.</span><span class="sxs-lookup"><span data-stu-id="46d62-189">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=fullName> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="46d62-190">Nessa configuração, quando uma solicitação é feita ao servidor por meio de um canal seguro externo, o canal externo é consultado para uma associação de canal.</span><span class="sxs-lookup"><span data-stu-id="46d62-190">In this configuration when a request is made to the server through an outer secure channel, the outer channel is queried for a channel binding.</span></span> <span data-ttu-id="46d62-191">A associação de canal é passada para chamadas SSPI de autenticação, que validam que a associação de canal no blob de autenticação é correspondente.</span><span class="sxs-lookup"><span data-stu-id="46d62-191">This channel binding is passed to the authentication SSPI calls, which validate that the channel binding in the authentication blob matches.</span></span> <span data-ttu-id="46d62-192">Existem três desfechos possíveis:</span><span class="sxs-lookup"><span data-stu-id="46d62-192">There are three possible outcomes:</span></span>  
  
1.  <span data-ttu-id="46d62-193">O sistema operacional subjacente do servidor não dá suporte à proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-193">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="46d62-194">A solicitação não será exposta para o aplicativo e uma resposta de não autorizado (401) será retornada ao cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-194">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="46d62-195">Uma mensagem será registrada para a origem do rastreamento <xref:System.Net.HttpListener> especificando o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="46d62-195">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2.  <span data-ttu-id="46d62-196">A chamada SSPI falha indicando que o cliente especificou uma associação de canal que não correspondeu ao valor esperado recuperado do canal externo ou então indicando que o cliente falhou ao fornecer uma associação de canal quando a política de proteção estendida do servidor foi configurada para <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span><span class="sxs-lookup"><span data-stu-id="46d62-196">The SSPI call fails indicating that either the client specified a channel binding that did not match the expected value retrieved from the outer channel or the client failed to supply a channel binding when the extended protection policy on the server was configured for <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span></span> <span data-ttu-id="46d62-197">Em ambos os casos, a solicitação não será exposta para o aplicativo e uma resposta de não autorizado (401) será retornada ao cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-197">In both cases, the request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="46d62-198">Uma mensagem será registrada para a origem do rastreamento <xref:System.Net.HttpListener> especificando o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="46d62-198">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3.  <span data-ttu-id="46d62-199">O cliente especifica a associação de canal correta ou tem permissão para se conectar sem especificar uma associação de canal, já que a política de proteção estendida do servidor é configurada com <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported>. A solicitação é retornada ao aplicativo para processamento.</span><span class="sxs-lookup"><span data-stu-id="46d62-199">The client specifies the correct channel binding or is allowed to connect without specifying a channel binding since the extended protection policy on the server is configured with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> The request is returned to the application for processing.</span></span> <span data-ttu-id="46d62-200">Nenhuma verificação de nome de serviço é executada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="46d62-200">No service name check is performed automatically.</span></span> <span data-ttu-id="46d62-201">Um aplicativo pode optar por executar sua própria validação de nome de serviço usando a propriedade <xref:System.Net.HttpListenerRequest.ServiceName%2A>, mas sob essas circunstâncias, isso é redundante.</span><span class="sxs-lookup"><span data-stu-id="46d62-201">An application may choose to perform its own service name validation using the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property, but under these circumstances it is redundant.</span></span>  
  
 <span data-ttu-id="46d62-202">Se um aplicativo faz suas próprias chamadas SSPI para realizar a autenticação com base em blobs passados bidirecionalmente dentro do corpo de uma solicitação HTTP e deseja dar suporte a associação de canal, ele precisa recuperar a associação de canal esperada do canal seguro externo usando <xref:System.Net.HttpListener> para passá-la para a função [AcceptSecurityContext](http://go.microsoft.com/fwlink/?LinkId=147021) de Win32 nativo.</span><span class="sxs-lookup"><span data-stu-id="46d62-202">If an application makes its own SSPI calls to perform authentication based on blobs passed back and forth within the body of an HTTP request and wishes to support channel binding, it needs to retrieve the expected channel binding from the outer secure channel using <xref:System.Net.HttpListener> in order to pass it to native Win32 [AcceptSecurityContext](http://go.microsoft.com/fwlink/?LinkId=147021) function.</span></span> <span data-ttu-id="46d62-203">Para fazer isso, use a propriedade <xref:System.Net.HttpListenerRequest.TransportContext%2A> e chame o método <xref:System.Net.TransportContext.GetChannelBinding%2A> para recuperar o CBT.</span><span class="sxs-lookup"><span data-stu-id="46d62-203">To do this, use the <xref:System.Net.HttpListenerRequest.TransportContext%2A> property and call <xref:System.Net.TransportContext.GetChannelBinding%2A> method to retrieve the CBT.</span></span> <span data-ttu-id="46d62-204">Há suporte apenas para associações de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="46d62-204">Only endpoint bindings are supported.</span></span> <span data-ttu-id="46d62-205">Se qualquer coisa diferente de <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> for especificada, uma <xref:System.NotSupportedException> será gerada.</span><span class="sxs-lookup"><span data-stu-id="46d62-205">If anything other <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> is specified, a <xref:System.NotSupportedException> will be thrown.</span></span> <span data-ttu-id="46d62-206">Se o sistema operacional subjacente dá suporte à associação de canal, o método <xref:System.Net.TransportContext.GetChannelBinding%2A> retornará um <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> encapsulando um ponteiro para uma associação de canal adequada para ser passada para a função [AcceptSecurityContext](http://go.microsoft.com/fwlink/?LinkId=147021) como o membro pvBuffer de uma estrutura SecBuffer passada no parâmetro `pInput`.</span><span class="sxs-lookup"><span data-stu-id="46d62-206">If the underlying operating system supports channel binding, the <xref:System.Net.TransportContext.GetChannelBinding%2A> method will return a <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> wrapping a pointer to a channel binding suitable for passing to [AcceptSecurityContext](http://go.microsoft.com/fwlink/?LinkId=147021) function as the pvBuffer member of a SecBuffer structure passed in the `pInput` parameter.</span></span> <span data-ttu-id="46d62-207">A propriedade <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> contém o comprimento, em bytes, da associação de canal.</span><span class="sxs-lookup"><span data-stu-id="46d62-207">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> property contains the length, in bytes, of the channel binding.</span></span> <span data-ttu-id="46d62-208">Se o sistema operacional subjacente não dá suporte a associações de canal, a função retornará `null`.</span><span class="sxs-lookup"><span data-stu-id="46d62-208">If the underlying operating system does not support channel bindings, the function will return `null`.</span></span>  
  
 <span data-ttu-id="46d62-209">Outro cenário possível é habilitar a proteção estendida para prefixos HTTP:// quando proxies não são usados.</span><span class="sxs-lookup"><span data-stu-id="46d62-209">Another possible scenario is to enable extended protection for HTTP:// prefixes when proxies are not used.</span></span> <span data-ttu-id="46d62-210">Nesse caso, defina <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=fullName> para um <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> com <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> definida para <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> ou <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> e <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> definida para <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>. Um valor de <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> coloca <xref:System.Net.HttpListener> no modo parcialmente elevado, enquanto <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponde ao modo totalmente elevado.</span><span class="sxs-lookup"><span data-stu-id="46d62-210">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=fullName> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="46d62-211">Uma lista padrão de nomes de serviço permitidos é criada com base nos prefixos que foram registrados com o <xref:System.Net.HttpListener>.</span><span class="sxs-lookup"><span data-stu-id="46d62-211">A default list of allowed service names is created based on the prefixes which have been registered with the <xref:System.Net.HttpListener>.</span></span> <span data-ttu-id="46d62-212">Essa lista padrão pode ser examinada por meio da propriedade <xref:System.Net.HttpListener.DefaultServiceNames%2A>.</span><span class="sxs-lookup"><span data-stu-id="46d62-212">This default list can be examined through the <xref:System.Net.HttpListener.DefaultServiceNames%2A> property.</span></span> <span data-ttu-id="46d62-213">Se esta lista não é abrangente, um aplicativo pode especificar uma coleção de nomes de serviço personalizada no construtor para a classe <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>, que será usada em vez da lista de nomes de serviço padrão.</span><span class="sxs-lookup"><span data-stu-id="46d62-213">If this list is not comprehensive, an application can specify a custom service name collection in the constructor for the <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class which will be used instead of the default service name list.</span></span>  
  
 <span data-ttu-id="46d62-214">Nessa configuração, quando uma solicitação é feita ao servidor sem um canal externo seguro, a autenticação continua normalmente sem uma verificação de associação de canal.</span><span class="sxs-lookup"><span data-stu-id="46d62-214">In this configuration, when a request is made to the server without an outer secure channel authentication proceeds normally without a channel binding check.</span></span> <span data-ttu-id="46d62-215">Se a autenticação for bem-sucedida, o contexto será consultado para o nome do serviço que o cliente forneceu e validado mediante a lista de nomes de serviço aceitáveis.</span><span class="sxs-lookup"><span data-stu-id="46d62-215">If the authentication succeeds, the context is queried for the service name that the client provided and validated against the list of acceptable service names.</span></span> <span data-ttu-id="46d62-216">Existem quatro desfechos possíveis:</span><span class="sxs-lookup"><span data-stu-id="46d62-216">There are four possible outcomes:</span></span>  
  
1.  <span data-ttu-id="46d62-217">O sistema operacional subjacente do servidor não dá suporte à proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-217">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="46d62-218">A solicitação não será exposta para o aplicativo e uma resposta de não autorizado (401) será retornada ao cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-218">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="46d62-219">Uma mensagem será registrada para a origem do rastreamento <xref:System.Net.HttpListener> especificando o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="46d62-219">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2.  <span data-ttu-id="46d62-220">O sistema operacional subjacente do cliente não dá suporte à proteção estendida.</span><span class="sxs-lookup"><span data-stu-id="46d62-220">The client’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="46d62-221">Na configuração <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported>, a tentativa de autenticação será bem-sucedida e a solicitação será retornada para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="46d62-221">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> configuration, the authentication attempt will succeed and the request will be returned to the application.</span></span> <span data-ttu-id="46d62-222">Na configuração <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, a tentativa de autenticação falhará.</span><span class="sxs-lookup"><span data-stu-id="46d62-222">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> configuration, the authentication attempt will fail.</span></span> <span data-ttu-id="46d62-223">A solicitação não será exposta para o aplicativo e uma resposta de não autorizado (401) será retornada ao cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-223">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="46d62-224">Uma mensagem será registrada para a origem do rastreamento <xref:System.Net.HttpListener> especificando o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="46d62-224">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3.  <span data-ttu-id="46d62-225">O sistema operacional subjacente do cliente dá suporte à proteção estendida, mas o aplicativo não especificou uma associação de serviço.</span><span class="sxs-lookup"><span data-stu-id="46d62-225">The client’s underlying operating system supports extended protection, but the application did not specify a service binding.</span></span> <span data-ttu-id="46d62-226">A solicitação não será exposta para o aplicativo e uma resposta de não autorizado (401) será retornada ao cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-226">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="46d62-227">Uma mensagem será registrada para a origem do rastreamento <xref:System.Net.HttpListener> especificando o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="46d62-227">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
4.  <span data-ttu-id="46d62-228">O cliente especificou uma associação de serviço.</span><span class="sxs-lookup"><span data-stu-id="46d62-228">The client specified a service binding.</span></span> <span data-ttu-id="46d62-229">A associação de serviço é comparada com a lista de associações de serviço permitidas.</span><span class="sxs-lookup"><span data-stu-id="46d62-229">The service binding is compared to the list of allowed service bindings.</span></span> <span data-ttu-id="46d62-230">Se ela for correspondente, a solicitação será retornada ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="46d62-230">If it matches, the request is returned to the application.</span></span> <span data-ttu-id="46d62-231">Caso contrário, a solicitação não será exposta para o aplicativo e uma resposta de não autorizado (401) será retornada automaticamente ao cliente.</span><span class="sxs-lookup"><span data-stu-id="46d62-231">Otherwise, the request will not be exposed to the application, and an unauthorized (401) response will be automatically returned to the client.</span></span> <span data-ttu-id="46d62-232">Uma mensagem será registrada para a origem do rastreamento <xref:System.Net.HttpListener> especificando o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="46d62-232">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
 <span data-ttu-id="46d62-233">Se essa abordagem simples usando uma lista de nomes de serviço aceitáveis com permissão for insuficiente, um aplicativo poderá fornecer sua própria validação de nome de serviço consultando a propriedade <xref:System.Net.HttpListenerRequest.ServiceName%2A>.</span><span class="sxs-lookup"><span data-stu-id="46d62-233">If this simple approach using an allowed list of acceptable service names is insufficient, an application may provide its own service name validation by querying the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property.</span></span> <span data-ttu-id="46d62-234">Nos casos 1 e 2 acima, a propriedade retornará `null`.</span><span class="sxs-lookup"><span data-stu-id="46d62-234">In cases 1 and 2 above, the property will return `null`.</span></span> <span data-ttu-id="46d62-235">No caso 3, ela retornará uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="46d62-235">In case 3, it will return an empty string.</span></span> <span data-ttu-id="46d62-236">No caso 4, o nome do serviço especificado pelo cliente será retornado.</span><span class="sxs-lookup"><span data-stu-id="46d62-236">In case 4, the service name specified by the client will be returned.</span></span>  
  
 <span data-ttu-id="46d62-237">Esses recursos de proteção estendida também podem ser usados por aplicativos para servidores para autenticação com outros tipos de solicitações e quando proxies confiáveis são usados.</span><span class="sxs-lookup"><span data-stu-id="46d62-237">These extended protection features can also be used by server applications for authentication with other types of requests and when trusted proxies are used.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="46d62-238">Consulte também</span><span class="sxs-lookup"><span data-stu-id="46d62-238">See Also</span></span>  
 <xref:System.Security.Authentication.ExtendedProtection>   
 <xref:System.Security.Authentication.ExtendedProtection.Configuration>

