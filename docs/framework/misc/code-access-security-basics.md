---
title: Noções básicas da segurança de acesso do código
description: 'Aprenda noções básicas de segurança de acesso ao código para aplicativos destinados ao CLR: código de tipo seguro, sintaxe imperativa e declarativa, bibliotecas de classes seguras e código Transparent.'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- security [.NET Framework], code access security
ms.assetid: 4eaa6535-d9fe-41a1-91d8-b437cfc16921
ms.openlocfilehash: 9d1f2e35c79ca32595711316885991717c4c1696
ms.sourcegitcommit: 97ce5363efa88179dd76e09de0103a500ca9b659
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/13/2020
ms.locfileid: "86281740"
---
# <a name="code-access-security-basics"></a><span data-ttu-id="a8eb0-103">Noções básicas da segurança de acesso do código</span><span class="sxs-lookup"><span data-stu-id="a8eb0-103">Code Access Security Basics</span></span>

[!INCLUDE[net_security_note](../../../includes/net-security-note-md.md)]

<span data-ttu-id="a8eb0-104">Todos os aplicativos que se destinam à Common Language Runtime (ou seja, todos os aplicativos gerenciados) devem interagir com o sistema de segurança do tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-104">Every application that targets the common language runtime (that is, every managed application) must interact with the runtime's security system.</span></span> <span data-ttu-id="a8eb0-105">Quando um aplicativo gerenciado é carregado, seu host o concede automaticamente a ele um conjunto de permissões.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-105">When a managed application is loaded, its host automatically grants it a set of permissions.</span></span> <span data-ttu-id="a8eb0-106">Essas permissões são determinadas pelas configurações de segurança local do host ou pela área restrita em que o aplicativo está.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-106">These permissions are determined by the host's local security settings or by the sandbox the application is in.</span></span> <span data-ttu-id="a8eb0-107">Dependendo dessas permissões, o aplicativo é executado corretamente ou gera uma exceção de segurança.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-107">Depending on these permissions, the application either runs properly or generates a security exception.</span></span>

<span data-ttu-id="a8eb0-108">O host padrão para aplicativos de área de trabalho permite que o código seja executado em confiança total.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-108">The default host for desktop applications allows code to run in full trust.</span></span> <span data-ttu-id="a8eb0-109">Portanto, se o seu aplicativo for direcionado para a área de trabalho, ele terá um conjunto de permissões irrestrito.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-109">Therefore, if your application targets the desktop, it has an unrestricted permission set.</span></span> <span data-ttu-id="a8eb0-110">Outros hosts ou áreas restritas fornecem um conjunto de permissões limitado para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-110">Other hosts or sandboxes provide a limited permission set for applications.</span></span> <span data-ttu-id="a8eb0-111">Como o conjunto de permissões pode ser alterado de host para host, você deve projetar seu aplicativo para usar apenas as permissões que o host de destino permite.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-111">Because the permission set can change from host to host, you must design your application to use only the permissions that your target host allows.</span></span>

<span data-ttu-id="a8eb0-112">Você deve estar familiarizado com os seguintes conceitos de segurança de acesso ao código para escrever aplicativos efetivos direcionados ao Common Language Runtime:</span><span class="sxs-lookup"><span data-stu-id="a8eb0-112">You must be familiar with the following code access security concepts in order to write effective applications that target the common language runtime:</span></span>

- <span data-ttu-id="a8eb0-113">**Código de tipo seguro**: o código de tipo seguro é o código que acessa tipos somente de maneiras bem definidas e permitidas.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-113">**Type-safe code**: Type-safe code is code that accesses types only in well-defined, allowable ways.</span></span> <span data-ttu-id="a8eb0-114">Por exemplo, considerando uma referência de objeto válida, o código de tipo seguro pode acessar a memória em deslocamentos fixos que correspondem aos membros reais do campo.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-114">For example, given a valid object reference, type-safe code can access memory at fixed offsets that correspond to actual field members.</span></span> <span data-ttu-id="a8eb0-115">Se o código acessar a memória em deslocamentos arbitrários fora do intervalo de memória que pertence aos campos expostos publicamente do objeto, ele não será de tipo seguro.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-115">If the code accesses memory at arbitrary offsets outside the range of memory that belongs to that object's publicly exposed fields, it is not type-safe.</span></span> <span data-ttu-id="a8eb0-116">Para permitir que o código se beneficie da segurança de acesso ao código, você deve usar um compilador que gera um código de tipo seguro com verificação.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-116">To enable code to benefit from code access security, you must use a compiler that generates verifiably type-safe code.</span></span> <span data-ttu-id="a8eb0-117">Para obter mais informações, consulte a seção [escrevendo código com segurança de tipo verificável](#typesafe_code) mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-117">For more information, see the [Writing Verifiably Type-Safe Code](#typesafe_code) section later in this topic.</span></span>

- <span data-ttu-id="a8eb0-118">**Sintaxe imperativa e declarativa**: o código que tem como alvo o Common Language Runtime pode interagir com o sistema de segurança solicitando permissões, exigindo que os chamadores tenham permissões especificadas e substituindo determinadas configurações de segurança (dadas privilégios suficientes).</span><span class="sxs-lookup"><span data-stu-id="a8eb0-118">**Imperative and declarative syntax**: Code that targets the common language runtime can interact with the security system by requesting permissions, demanding that callers have specified permissions, and overriding certain security settings (given enough privileges).</span></span> <span data-ttu-id="a8eb0-119">Você usa duas formas de sintaxe para interagir de forma programática com o .NET Framework sistema de segurança: sintaxe declarativa e sintaxe imperativa.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-119">You use two forms of syntax to programmatically interact with the .NET Framework security system: declarative syntax and imperative syntax.</span></span> <span data-ttu-id="a8eb0-120">Chamadas declarativas são executadas usando atributos; as chamadas imperativas são executadas usando novas instâncias de classes dentro de seu código.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-120">Declarative calls are performed using attributes; imperative calls are performed using new instances of classes within your code.</span></span> <span data-ttu-id="a8eb0-121">Algumas chamadas podem ser executadas apenas imperativamente, outras podem ser executadas apenas de forma declarativa e algumas chamadas podem ser executadas de qualquer maneira.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-121">Some calls can be performed only imperatively, others can be performed only declaratively, and some calls can be performed in either manner.</span></span>

- <span data-ttu-id="a8eb0-122">**Bibliotecas de classes seguras**: uma biblioteca de classes segura usa as demandas de segurança para garantir que os chamadores da biblioteca tenham permissão para acessar os recursos que a biblioteca expõe.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-122">**Secure class libraries**: A secure class library uses security demands to ensure that the library's callers have permission to access the resources that the library exposes.</span></span> <span data-ttu-id="a8eb0-123">Por exemplo, uma biblioteca de classes segura pode ter um método para criar arquivos que exigem que seus chamadores tenham permissões para criar arquivos.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-123">For example, a secure class library might have a method for creating files that would demand that its callers have permissions to create files.</span></span> <span data-ttu-id="a8eb0-124">O .NET Framework consiste em bibliotecas de classes seguras.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-124">The .NET Framework consists of secure class libraries.</span></span> <span data-ttu-id="a8eb0-125">Você deve estar ciente das permissões necessárias para acessar qualquer biblioteca que seu código usa.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-125">You should be aware of the permissions required to access any library that your code uses.</span></span> <span data-ttu-id="a8eb0-126">Para obter mais informações, consulte a seção [usando bibliotecas de classes seguras](#secure_library) mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-126">For more information, see the [Using Secure Class Libraries](#secure_library) section later in this topic.</span></span>

- <span data-ttu-id="a8eb0-127">**Código Transparent**: começando com o .NET Framework 4, além de identificar permissões específicas, você também deve determinar se o seu código deve ser executado como de segurança transparente.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-127">**Transparent code**: Starting with the .NET Framework 4, in addition to identifying specific permissions, you must also determine whether your code should run as security-transparent.</span></span> <span data-ttu-id="a8eb0-128">O código de segurança transparente não pode chamar tipos ou membros que são identificados como segurança crítica.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-128">Security-transparent code cannot call types or members that are identified as security-critical.</span></span> <span data-ttu-id="a8eb0-129">Essa regra se aplica a aplicativos de confiança total, bem como a aplicativos parcialmente confiáveis.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-129">This rule applies to full-trust applications as well as partially trusted applications.</span></span> <span data-ttu-id="a8eb0-130">Para obter mais informações, consulte [código de segurança transparente](security-transparent-code.md).</span><span class="sxs-lookup"><span data-stu-id="a8eb0-130">For more information, see [Security-Transparent Code](security-transparent-code.md).</span></span>

<a name="typesafe_code"></a>

## <a name="writing-verifiably-type-safe-code"></a><span data-ttu-id="a8eb0-131">Escrevendo um código fortemente tipado verificável</span><span class="sxs-lookup"><span data-stu-id="a8eb0-131">Writing Verifiably Type-Safe Code</span></span>

<span data-ttu-id="a8eb0-132">A compilação JIT (just-in-time) executa um processo de verificação que examina o código e tenta determinar se o código é de tipo seguro.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-132">Just-in-time (JIT) compilation performs a verification process that examines code and tries to determine whether the code is type-safe.</span></span> <span data-ttu-id="a8eb0-133">O código que é comprovado durante a verificação para ser digitado com segurança é chamado de *código de tipo seguro verificável*.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-133">Code that is proven during verification to be type-safe is called *verifiably type-safe code*.</span></span> <span data-ttu-id="a8eb0-134">O código pode ser de tipo seguro, mas pode não ser verificável com segurança devido às limitações do processo de verificação ou do compilador.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-134">Code can be type-safe, yet might not be verifiably type-safe because of the limitations of the verification process or of the compiler.</span></span> <span data-ttu-id="a8eb0-135">Nem todas as linguagens são de tipo seguro, e alguns compiladores de linguagem, como Microsoft Visual C++, não podem gerar código gerenciado com segurança de tipo verificável.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-135">Not all languages are type-safe, and some language compilers, such as Microsoft Visual C++, cannot generate verifiably type-safe managed code.</span></span> <span data-ttu-id="a8eb0-136">Para determinar se o compilador de linguagem que você usa gera um código com segurança de tipo verificável, consulte a documentação do compilador.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-136">To determine whether the language compiler you use generates verifiably type-safe code, consult the compiler's documentation.</span></span> <span data-ttu-id="a8eb0-137">Se você usar um compilador de linguagem que gera código de tipo seguro, apenas quando você evita determinadas construções de linguagem, convém usar a [ferramenta PEVerify](../tools/peverify-exe-peverify-tool.md) para determinar se o seu código é verificamente seguro.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-137">If you use a language compiler that generates verifiably type-safe code only when you avoid certain language constructs, you might want to use the [PEVerify tool](../tools/peverify-exe-peverify-tool.md) to determine whether your code is verifiably type-safe.</span></span>

<span data-ttu-id="a8eb0-138">O código que não é verificável de tipo seguro pode tentar executar se a política de segurança permitir que o código ignore a verificação.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-138">Code that is not verifiably type-safe can attempt to execute if security policy allows the code to bypass verification.</span></span> <span data-ttu-id="a8eb0-139">No entanto, como a segurança de tipo é uma parte essencial do mecanismo do tempo de execução para isolar assemblies, a segurança não poderá ser imposta de forma confiável se o código violar as regras de segurança de tipo.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-139">However, because type safety is an essential part of the runtime's mechanism for isolating assemblies, security cannot be reliably enforced if code violates the rules of type safety.</span></span> <span data-ttu-id="a8eb0-140">Por padrão, o código que não é de tipo seguro pode ser executado somente se for originado do computador local.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-140">By default, code that is not type-safe is allowed to run only if it originates from the local computer.</span></span> <span data-ttu-id="a8eb0-141">Portanto, o código móvel deve ser de tipo seguro.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-141">Therefore, mobile code should be type-safe.</span></span>

<a name="secure_library"></a>

## <a name="using-secure-class-libraries"></a><span data-ttu-id="a8eb0-142">Usando bibliotecas de classes seguras</span><span class="sxs-lookup"><span data-stu-id="a8eb0-142">Using Secure Class Libraries</span></span>

<span data-ttu-id="a8eb0-143">Se seu código solicitar e receber as permissões exigidas pela biblioteca de classes, ele terá permissão para acessar a biblioteca e os recursos expostos pela biblioteca serão protegidos contra o acesso não autorizado.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-143">If your code requests and is granted the permissions required by the class library, it will be allowed to access the library and the resources that the library exposes will be protected from unauthorized access.</span></span> <span data-ttu-id="a8eb0-144">Se o seu código não tiver as permissões apropriadas, ele não terá permissão para acessar a biblioteca de classes e o código mal-intencionado não poderá usar seu código para acessar indiretamente os recursos protegidos.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-144">If your code does not have the appropriate permissions, it will not be allowed to access the class library, and malicious code will not be able to use your code to indirectly access protected resources.</span></span> <span data-ttu-id="a8eb0-145">Outro código que chama seu código também deve ter permissão para acessar a biblioteca.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-145">Other code that calls your code must also have permission to access the library.</span></span> <span data-ttu-id="a8eb0-146">Caso contrário, seu código também será impedido de ser executado.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-146">If it does not, your code will be restricted from running as well.</span></span>

<span data-ttu-id="a8eb0-147">A segurança de acesso ao código não elimina a possibilidade de erro humano em escrever código.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-147">Code access security does not eliminate the possibility of human error in writing code.</span></span> <span data-ttu-id="a8eb0-148">No entanto, se seu aplicativo usar bibliotecas de classes seguras para acessar recursos protegidos, o risco de segurança para o código do aplicativo será reduzido, pois as bibliotecas de classes são rigorosamente fiscalizadas para possíveis problemas de segurança.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-148">However, if your application uses secure class libraries to access protected resources, the security risk for application code is decreased, because class libraries are closely scrutinized for potential security problems.</span></span>

## <a name="declarative-security"></a><span data-ttu-id="a8eb0-149">Segurança declarativa</span><span class="sxs-lookup"><span data-stu-id="a8eb0-149">Declarative Security</span></span>

<span data-ttu-id="a8eb0-150">A sintaxe de segurança declarativa usa [atributos](../../standard/attributes/index.md) para posicionar informações de segurança nos [metadados](../../standard/metadata-and-self-describing-components.md) do seu código.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-150">Declarative security syntax uses [attributes](../../standard/attributes/index.md) to place security information into the [metadata](../../standard/metadata-and-self-describing-components.md) of your code.</span></span> <span data-ttu-id="a8eb0-151">Os atributos podem ser colocados no nível de assembly, classe ou membro, para indicar o tipo de solicitação, demanda ou substituição que você deseja usar.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-151">Attributes can be placed at the assembly, class, or member level, to indicate the type of request, demand, or override you want to use.</span></span> <span data-ttu-id="a8eb0-152">As solicitações são usadas em aplicativos direcionados à Common Language Runtime para informar o sistema de segurança de tempo de execução sobre as permissões que seu aplicativo precisa ou não deseja.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-152">Requests are used in applications that target the common language runtime to inform the runtime security system about the permissions that your application needs or does not want.</span></span> <span data-ttu-id="a8eb0-153">As demandas e substituições são usadas em bibliotecas para ajudar a proteger recursos de chamadores ou para substituir o comportamento de segurança padrão.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-153">Demands and overrides are used in libraries to help protect resources from callers or to override default security behavior.</span></span>

> [!NOTE]
> <span data-ttu-id="a8eb0-154">No .NET Framework 4, houve alterações importantes na .NET Framework modelo e terminologia de segurança.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-154">In the .NET Framework 4, there have been important changes to the .NET Framework security model and terminology.</span></span> <span data-ttu-id="a8eb0-155">Para obter mais informações sobre essas alterações, consulte [Security Changes](https://docs.microsoft.com/previous-versions/dotnet/framework/security/security-changes).</span><span class="sxs-lookup"><span data-stu-id="a8eb0-155">For more information about these changes, see [Security Changes](https://docs.microsoft.com/previous-versions/dotnet/framework/security/security-changes).</span></span>

<span data-ttu-id="a8eb0-156">Para usar chamadas de segurança declarativas, você deve inicializar os dados de estado do objeto de permissão para que ele represente a forma específica de permissão necessária.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-156">In order to use declarative security calls, you must initialize the state data of the permission object so that it represents the particular form of permission you need.</span></span> <span data-ttu-id="a8eb0-157">Cada permissão interna tem um atributo que é passado <xref:System.Security.Permissions.SecurityAction> como uma enumeração para descrever o tipo de operação de segurança que você deseja executar.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-157">Every built-in permission has an attribute that is passed a <xref:System.Security.Permissions.SecurityAction> enumeration to describe the type of security operation you want to perform.</span></span> <span data-ttu-id="a8eb0-158">No entanto, as permissões também aceitam seus próprios parâmetros que são exclusivos para eles.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-158">However, permissions also accept their own parameters that are exclusive to them.</span></span>

<span data-ttu-id="a8eb0-159">O fragmento de código a seguir mostra a sintaxe declarativa para solicitar que os chamadores de seu código tenham uma permissão personalizada chamada `MyPermission` .</span><span class="sxs-lookup"><span data-stu-id="a8eb0-159">The following code fragment shows declarative syntax for requesting that your code's callers have a custom permission called `MyPermission`.</span></span> <span data-ttu-id="a8eb0-160">Essa permissão é uma permissão personalizada hipotética e não existe no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-160">This permission is a hypothetical custom permission and does not exist in the .NET Framework.</span></span> <span data-ttu-id="a8eb0-161">Neste exemplo, a chamada declarativa é colocada diretamente antes da definição de classe, especificando que essa permissão seja aplicada ao nível de classe.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-161">In this example, the declarative call is placed directly before the class definition, specifying that this permission be applied to the class level.</span></span> <span data-ttu-id="a8eb0-162">O atributo é passado uma estrutura **SecurityAction. redemand** para especificar que os chamadores devem ter essa permissão para serem executados.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-162">The attribute is passed a **SecurityAction.Demand** structure to specify that callers must have this permission in order to run.</span></span>

```vb
<MyPermission(SecurityAction.Demand, Unrestricted = True)> Public Class MyClass1

   Public Sub New()
      'The constructor is protected by the security call.
   End Sub

   Public Sub MyMethod()
      'This method is protected by the security call.
   End Sub

   Public Sub YourMethod()
      'This method is protected by the security call.
   End Sub
End Class
```

```csharp
[MyPermission(SecurityAction.Demand, Unrestricted = true)]
public class MyClass
{
   public MyClass()
   {
      //The constructor is protected by the security call.
   }

   public void MyMethod()
   {
      //This method is protected by the security call.
   }

   public void YourMethod()
   {
      //This method is protected by the security call.
   }
}
```

## <a name="imperative-security"></a><span data-ttu-id="a8eb0-163">Segurança obrigatória</span><span class="sxs-lookup"><span data-stu-id="a8eb0-163">Imperative Security</span></span>

<span data-ttu-id="a8eb0-164">A sintaxe de segurança imperativa emite uma chamada de segurança criando uma nova instância do objeto de permissão que você deseja invocar.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-164">Imperative security syntax issues a security call by creating a new instance of the permission object you want to invoke.</span></span> <span data-ttu-id="a8eb0-165">Você pode usar a sintaxe imperativa para executar demandas e substituições, mas não solicitações.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-165">You can use imperative syntax to perform demands and overrides, but not requests.</span></span>

<span data-ttu-id="a8eb0-166">Antes de fazer a chamada de segurança, você deve inicializar os dados de estado do objeto de permissão para que ele represente a forma específica da permissão necessária.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-166">Before you make the security call, you must initialize the state data of the permission object so that it represents the particular form of the permission you need.</span></span> <span data-ttu-id="a8eb0-167">Por exemplo, ao criar um <xref:System.Security.Permissions.FileIOPermission> objeto, você pode usar o construtor para inicializar o objeto **FileIOPermission** para que ele represente o acesso irrestrito a todos os arquivos ou nenhum acesso aos arquivos.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-167">For example, when creating a <xref:System.Security.Permissions.FileIOPermission> object, you can use the constructor to initialize the **FileIOPermission** object so that it represents either unrestricted access to all files or no access to files.</span></span> <span data-ttu-id="a8eb0-168">Ou, você pode usar um objeto **FileIOPermission** diferente, passando parâmetros que indicam o tipo de acesso que você deseja que o objeto represente (ou seja, leitura, acréscimo ou gravação) e quais arquivos você deseja que o objeto proteja.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-168">Or, you can use a different **FileIOPermission** object, passing parameters that indicate the type of access you want the object to represent (that is, read, append, or write) and what files you want the object to protect.</span></span>

<span data-ttu-id="a8eb0-169">Além de usar a sintaxe de segurança imperativa para invocar um único objeto de segurança, você pode usá-lo para inicializar um grupo de permissões em um conjunto de permissões.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-169">In addition to using imperative security syntax to invoke a single security object, you can use it to initialize a group of permissions in a permission set.</span></span> <span data-ttu-id="a8eb0-170">Por exemplo, essa técnica é a única maneira de executar chamadas [Assert](using-the-assert-method.md) de forma confiável em várias permissões em um método.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-170">For example, this technique is the only way to reliably perform [assert](using-the-assert-method.md) calls on multiple permissions in one method.</span></span> <span data-ttu-id="a8eb0-171">Use as <xref:System.Security.PermissionSet> <xref:System.Security.NamedPermissionSet> classes e para criar um grupo de permissões e, em seguida, chame o método apropriado para invocar a chamada de segurança desejada.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-171">Use the <xref:System.Security.PermissionSet> and <xref:System.Security.NamedPermissionSet> classes to create a group of permissions and then call the appropriate method to invoke the desired security call.</span></span>

<span data-ttu-id="a8eb0-172">Você pode usar a sintaxe imperativa para executar demandas e substituições, mas não solicitações.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-172">You can use imperative syntax to perform demands and overrides, but not requests.</span></span> <span data-ttu-id="a8eb0-173">Você pode usar a sintaxe imperativa para demandas e substituições em vez de sintaxe declarativa quando as informações necessárias para inicializar o estado de permissão se tornarem conhecidas somente no tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-173">You might use imperative syntax for demands and overrides instead of declarative syntax when information that you need in order to initialize the permission state becomes known only at run time.</span></span> <span data-ttu-id="a8eb0-174">Por exemplo, se você quiser garantir que os chamadores tenham permissão para ler um determinado arquivo, mas não souber o nome desse arquivo até o tempo de execução, use uma demanda imperativa.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-174">For example, if you want to ensure that callers have permission to read a certain file, but you do not know the name of that file until run time, use an imperative demand.</span></span> <span data-ttu-id="a8eb0-175">Você também pode optar por usar verificações imperativas em vez de verificações declarativas quando precisar determinar em tempo de execução se uma condição mantiver e, com base no resultado do teste, fazer uma demanda de segurança (ou não).</span><span class="sxs-lookup"><span data-stu-id="a8eb0-175">You might also choose to use imperative checks instead of declarative checks when you need to determine at run time whether a condition holds and, based on the result of the test, make a security demand (or not).</span></span>

<span data-ttu-id="a8eb0-176">O fragmento de código a seguir mostra a sintaxe imperativa para solicitar que os chamadores de seu código tenham uma permissão personalizada chamada `MyPermission` .</span><span class="sxs-lookup"><span data-stu-id="a8eb0-176">The following code fragment shows imperative syntax for requesting that your code's callers have a custom permission called `MyPermission`.</span></span> <span data-ttu-id="a8eb0-177">Essa permissão é uma permissão personalizada hipotética e não existe no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-177">This permission is a hypothetical custom permission and does not exist in the .NET Framework.</span></span> <span data-ttu-id="a8eb0-178">Uma nova instância do `MyPermission` é criada no `MyMethod` , protegendo apenas esse método com a chamada de segurança.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-178">A new instance of `MyPermission` is created in `MyMethod`, guarding only this method with the security call.</span></span>

```vb
Public Class MyClass1

   Public Sub New()

   End Sub

   Public Sub MyMethod()
      'MyPermission is demanded using imperative syntax.
      Dim Perm As New MyPermission()
      Perm.Demand()
      'This method is protected by the security call.
   End Sub

   Public Sub YourMethod()
      'YourMethod 'This method is not protected by the security call.
   End Sub
End Class
```

```csharp
public class MyClass {
   public MyClass(){

   }

   public void MyMethod() {
       //MyPermission is demanded using imperative syntax.
       MyPermission Perm = new MyPermission();
       Perm.Demand();
       //This method is protected by the security call.
   }

   public void YourMethod() {
       //This method is not protected by the security call.
   }
}
```

## <a name="using-managed-wrapper-classes"></a><span data-ttu-id="a8eb0-179">Usando classes de wrapper gerenciadas</span><span class="sxs-lookup"><span data-stu-id="a8eb0-179">Using Managed Wrapper Classes</span></span>

<span data-ttu-id="a8eb0-180">A maioria dos aplicativos e componentes (exceto bibliotecas seguras) não deve chamar diretamente o código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-180">Most applications and components (except secure libraries) should not directly call unmanaged code.</span></span> <span data-ttu-id="a8eb0-181">Há várias razões para isso.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-181">There are several reasons for this.</span></span> <span data-ttu-id="a8eb0-182">Se o código chamar o código não gerenciado diretamente, ele não poderá ser executado em muitas circunstâncias porque o código deve receber um alto nível de confiança para chamar o código nativo.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-182">If code calls unmanaged code directly, it will not be allowed to run in many circumstances because code must be granted a high level of trust to call native code.</span></span> <span data-ttu-id="a8eb0-183">Se a política for modificada para permitir que tal aplicativo seja executado, ele poderá reduzir significativamente a segurança do sistema, deixando o aplicativo livre para executar praticamente qualquer operação.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-183">If policy is modified to allow such an application to run, it can significantly weaken the security of the system, leaving the application free to perform almost any operation.</span></span>

<span data-ttu-id="a8eb0-184">Além disso, o código que tem permissão para acessar o código não gerenciado pode, provavelmente, executar quase qualquer operação chamando uma API não gerenciada.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-184">Additionally, code that has permission to access unmanaged code can probably perform almost any operation by calling into an unmanaged API.</span></span> <span data-ttu-id="a8eb0-185">Por exemplo, o código que tem permissão para chamar código não gerenciado não precisa <xref:System.Security.Permissions.FileIOPermission> acessar um arquivo; ele pode simplesmente chamar uma API de arquivo não gerenciado (Win32) diretamente, ignorando a API de arquivo gerenciado que requer **FileIOPermission**.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-185">For example, code that has permission to call unmanaged code does not need <xref:System.Security.Permissions.FileIOPermission> to access a file; it can just call an unmanaged (Win32) file API directly, bypassing the managed file API that requires **FileIOPermission**.</span></span> <span data-ttu-id="a8eb0-186">Se o código gerenciado tiver permissão para chamar o código não gerenciado e chamar diretamente o código não gerenciado, o sistema de segurança não poderá impor restrições de segurança de forma confiável, já que o tempo de execução não pode impor essas restrições em código não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-186">If managed code has permission to call into unmanaged code and does call directly into unmanaged code, the security system will be unable to reliably enforce security restrictions, since the runtime cannot enforce such restrictions on unmanaged code.</span></span>

<span data-ttu-id="a8eb0-187">Se você quiser que seu aplicativo execute uma operação que requer o acesso a código não gerenciado, ele deve fazer isso por meio de uma classe gerenciada confiável que encapsula a funcionalidade necessária (se tal classe existir).</span><span class="sxs-lookup"><span data-stu-id="a8eb0-187">If you want your application to perform an operation that requires accessing unmanaged code, it should do so through a trusted managed class that wraps the required functionality (if such a class exists).</span></span> <span data-ttu-id="a8eb0-188">Não crie uma classe wrapper por conta própria se já existir uma em uma biblioteca de classes segura.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-188">Do not create a wrapper class yourself if one already exists in a secure class library.</span></span> <span data-ttu-id="a8eb0-189">A classe wrapper, que deve receber um alto grau de confiança para ter permissão para fazer a chamada em código não gerenciado, é responsável por exigir que seus chamadores tenham as permissões apropriadas.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-189">The wrapper class, which must be granted a high degree of trust to be allowed to make the call into unmanaged code, is responsible for demanding that its callers have the appropriate permissions.</span></span> <span data-ttu-id="a8eb0-190">Se você usar a classe wrapper, seu código só precisará solicitar e receber as permissões exigidas pela classe wrapper.</span><span class="sxs-lookup"><span data-stu-id="a8eb0-190">If you use the wrapper class, your code only needs to request and be granted the permissions that the wrapper class demands.</span></span>

## <a name="see-also"></a><span data-ttu-id="a8eb0-191">Confira também</span><span class="sxs-lookup"><span data-stu-id="a8eb0-191">See also</span></span>

- <xref:System.Security.PermissionSet>
- <xref:System.Security.Permissions.FileIOPermission>
- <xref:System.Security.NamedPermissionSet>
- <xref:System.Security.Permissions.SecurityAction>
- [<span data-ttu-id="a8eb0-192">Declarar</span><span class="sxs-lookup"><span data-stu-id="a8eb0-192">Assert</span></span>](using-the-assert-method.md)
- [<span data-ttu-id="a8eb0-193">Segurança de acesso do código</span><span class="sxs-lookup"><span data-stu-id="a8eb0-193">Code Access Security</span></span>](code-access-security.md)
- [<span data-ttu-id="a8eb0-194">Noções básicas da segurança de acesso do código</span><span class="sxs-lookup"><span data-stu-id="a8eb0-194">Code Access Security Basics</span></span>](code-access-security-basics.md)
- [<span data-ttu-id="a8eb0-195">Atributos</span><span class="sxs-lookup"><span data-stu-id="a8eb0-195">Attributes</span></span>](../../standard/attributes/index.md)
- [<span data-ttu-id="a8eb0-196">Metadados e componentes autodescritivos</span><span class="sxs-lookup"><span data-stu-id="a8eb0-196">Metadata and Self-Describing Components</span></span>](../../standard/metadata-and-self-describing-components.md)
