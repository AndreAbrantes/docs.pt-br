---
title: Problemas de segurança na emissão de reflexão
ms.date: 03/30/2017
helpviewer_keywords:
- partially trusted code
- emitting dynamic assemblies, security
- reflection emit, security
- reflection emit, partial trust scenarios
- partial trust,emitting dynamic methods
- anonymously hosted dynamic methods [.NET Framework]
- emitting dynamic assemblies,partial trust scenarios
- dynamic assemblies, security
ms.assetid: 0f8bf8fa-b993-478f-87ab-1a1a7976d298
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: b6adbe4e5c82d5f886fcffd5ab272a337c377395
ms.sourcegitcommit: c7a7e1468bf0fa7f7065de951d60dfc8d5ba89f5
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/14/2019
ms.locfileid: "65586119"
---
# <a name="security-issues-in-reflection-emit"></a><span data-ttu-id="6eae8-102">Problemas de segurança na emissão de reflexão</span><span class="sxs-lookup"><span data-stu-id="6eae8-102">Security Issues in Reflection Emit</span></span>
<span data-ttu-id="6eae8-103">O .NET Framework fornece três maneiras de emitir a MSIL (Microsoft Intermediate Language), cada uma com seus próprios problemas de segurança:</span><span class="sxs-lookup"><span data-stu-id="6eae8-103">The .NET Framework provides three ways to emit Microsoft intermediate language (MSIL), each with its own security issues:</span></span>  
  
- [<span data-ttu-id="6eae8-104">Assemblies dinâmicos</span><span class="sxs-lookup"><span data-stu-id="6eae8-104">Dynamic assemblies</span></span>](#Dynamic_Assemblies)  
  
- [<span data-ttu-id="6eae8-105">Métodos dinâmicos hospedados anonimamente</span><span class="sxs-lookup"><span data-stu-id="6eae8-105">Anonymously hosted dynamic methods</span></span>](#Anonymously_Hosted_Dynamic_Methods)  
  
- [<span data-ttu-id="6eae8-106">Métodos dinâmicos associados a assemblies existentes</span><span class="sxs-lookup"><span data-stu-id="6eae8-106">Dynamic methods associated with existing assemblies</span></span>](#Dynamic_Methods_Associated_with_Existing_Assemblies)  
  
 <span data-ttu-id="6eae8-107">Independentemente do modo como você gerar código dinâmico, a execução do código gerado requer que todas as permissões necessárias para os tipos e métodos que o código gerado usa.</span><span class="sxs-lookup"><span data-stu-id="6eae8-107">Regardless of the way you generate dynamic code, executing the generated code requires all the permissions that are required by the types and methods the generated code uses.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-108">As permissões que são necessárias para refletir o código e emitir o código foram alteradas com versões posteriores do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6eae8-108">The permissions that are required for reflecting on code and emitting code have changed with succeeding releases of the .NET Framework.</span></span> <span data-ttu-id="6eae8-109">Consulte [Informações de versão](#Version_Information) posteriormente neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6eae8-109">See [Version Information](#Version_Information), later in this topic.</span></span>  
  
<a name="Dynamic_Assemblies"></a>   
## <a name="dynamic-assemblies"></a><span data-ttu-id="6eae8-110">Assemblies Dinâmicos</span><span class="sxs-lookup"><span data-stu-id="6eae8-110">Dynamic Assemblies</span></span>  
 <span data-ttu-id="6eae8-111">Os assemblies dinâmicos são criados usando as sobrecargas do método <xref:System.AppDomain.DefineDynamicAssembly%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-111">Dynamic assemblies are created by using overloads of the <xref:System.AppDomain.DefineDynamicAssembly%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="6eae8-112">A maioria das sobrecargas desse método foi preterida no [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] devido à eliminação da política de segurança de todo o computador.</span><span class="sxs-lookup"><span data-stu-id="6eae8-112">Most overloads of this method are deprecated in the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], because of the elimination of machine-wide security policy.</span></span> <span data-ttu-id="6eae8-113">(Consulte [Alterações de segurança](../../../docs/framework/security/security-changes.md).) As sobrecargas restantes podem ser executadas por qualquer código, independentemente do nível de confiança.</span><span class="sxs-lookup"><span data-stu-id="6eae8-113">(See [Security Changes](../../../docs/framework/security/security-changes.md).) The remaining overloads can be executed by any code, regardless of trust level.</span></span> <span data-ttu-id="6eae8-114">Essas sobrecargas se enquadram em dois grupos: aquelas que especificam uma lista de atributos a ser aplicada ao assembly dinâmico quando ele é criado e aquelas que não.</span><span class="sxs-lookup"><span data-stu-id="6eae8-114">These overloads fall into two groups: those that specify a list of attributes to apply to the dynamic assembly when it is created, and those that do not.</span></span> <span data-ttu-id="6eae8-115">Se você não especificar o modelo de transparência do assembly, aplicando o atributo <xref:System.Security.SecurityRulesAttribute> quando criá-lo, o modelo de transparência será herdado do assembly emissor.</span><span class="sxs-lookup"><span data-stu-id="6eae8-115">If you do not specify the transparency model for the assembly, by applying the <xref:System.Security.SecurityRulesAttribute> attribute when you create it, the transparency model is inherited from the emitting assembly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-116">Os atributos aplicados ao assembly dinâmico após ele ser criado, usando o método <xref:System.Reflection.Emit.AssemblyBuilder.SetCustomAttribute%2A>, não entram em vigor até que o assembly tenha sido salvo no disco e carregado na memória novamente.</span><span class="sxs-lookup"><span data-stu-id="6eae8-116">Attributes that you apply to the dynamic assembly after it is created, by using the <xref:System.Reflection.Emit.AssemblyBuilder.SetCustomAttribute%2A> method, do not take effect until the assembly has been saved to disk and loaded into memory again.</span></span>  
  
 <span data-ttu-id="6eae8-117">O código em um assembly dinâmico pode acessar membros e tipos visíveis em outros assemblies.</span><span class="sxs-lookup"><span data-stu-id="6eae8-117">Code in a dynamic assembly can access visible types and members in other assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-118">Os assemblies dinâmicos não usam os sinalizadores <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> e <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> que permitem que os métodos dinâmicos acessem tipos e membros não públicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-118">Dynamic assemblies do not use the <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> and <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flags that allow dynamic methods to access nonpublic types and members.</span></span>  
  
 <span data-ttu-id="6eae8-119">Os assemblies dinâmicos transitórios são criados na memória e nunca salvos no disco, portanto, eles não exigem nenhuma permissão de acesso ao arquivo.</span><span class="sxs-lookup"><span data-stu-id="6eae8-119">Transient dynamic assemblies are created in memory and never saved to disk, so they require no file access permissions.</span></span> <span data-ttu-id="6eae8-120">Salvar um assembly dinâmico em disco requer <xref:System.Security.Permissions.FileIOPermission> com os sinalizadores adequados.</span><span class="sxs-lookup"><span data-stu-id="6eae8-120">Saving a dynamic assembly to disk requires <xref:System.Security.Permissions.FileIOPermission> with the appropriate flags.</span></span>  
  
### <a name="generating-dynamic-assemblies-from-partially-trusted-code"></a><span data-ttu-id="6eae8-121">Gerando assemblies dinâmicos do código parcialmente confiável</span><span class="sxs-lookup"><span data-stu-id="6eae8-121">Generating Dynamic Assemblies from Partially Trusted Code</span></span>  
 <span data-ttu-id="6eae8-122">Considere as condições em que um assembly com permissões de Internet pode gerar um assembly dinâmico transitório e executar seu código:</span><span class="sxs-lookup"><span data-stu-id="6eae8-122">Consider the conditions in which an assembly with Internet permissions can generate a transient dynamic assembly and execute its code:</span></span>  
  
- <span data-ttu-id="6eae8-123">O assembly dinâmico usa apenas tipos e membros públicos de outros assemblies.</span><span class="sxs-lookup"><span data-stu-id="6eae8-123">The dynamic assembly uses only public types and members of other assemblies.</span></span>  
  
- <span data-ttu-id="6eae8-124">As permissões exigidas por esses tipos e membros são incluídas no conjunto de concessão do assembly parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6eae8-124">The permissions demanded by those types and members are included in the grant set of the partially trusted assembly.</span></span>  
  
- <span data-ttu-id="6eae8-125">O assembly não é salvo no disco.</span><span class="sxs-lookup"><span data-stu-id="6eae8-125">The assembly is not saved to disk.</span></span>  
  
- <span data-ttu-id="6eae8-126">Os símbolos de depuração não são gerados.</span><span class="sxs-lookup"><span data-stu-id="6eae8-126">Debug symbols are not generated.</span></span> <span data-ttu-id="6eae8-127">(Os conjuntos de permissões `Internet` e `LocalIntranet` não incluem as permissões necessárias.)</span><span class="sxs-lookup"><span data-stu-id="6eae8-127">(`Internet` and `LocalIntranet` permission sets do not include the necessary permissions.)</span></span>  
  
<a name="Anonymously_Hosted_Dynamic_Methods"></a>   
## <a name="anonymously-hosted-dynamic-methods"></a><span data-ttu-id="6eae8-128">Métodos Dinâmicos Hospedados Anonimamente</span><span class="sxs-lookup"><span data-stu-id="6eae8-128">Anonymously Hosted Dynamic Methods</span></span>  
 <span data-ttu-id="6eae8-129">Os métodos dinâmicos hospedados anonimamente são criados usando os dois construtores <xref:System.Reflection.Emit.DynamicMethod> que não especificam um módulo ou tipo associado, <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%29> e <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-129">Anonymously hosted dynamic methods are created by using the two <xref:System.Reflection.Emit.DynamicMethod> constructors that do not specify an associated type or module, <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%29> and <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29>.</span></span> <span data-ttu-id="6eae8-130">Esses construtores colocam os métodos dinâmicos em um assembly transparente de segurança totalmente confiável fornecido pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="6eae8-130">These constructors place the dynamic methods in a system-provided, fully trusted, security-transparent assembly.</span></span> <span data-ttu-id="6eae8-131">Não é necessária nenhuma permissão para usar esses construtores ou para emitir o código para os métodos dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-131">No permissions are required to use these constructors or to emit code for the dynamic methods.</span></span>  
  
 <span data-ttu-id="6eae8-132">Em vez disso, quando um método dinâmico hospedado anonimamente é criado, a pilha de chamadas é capturada.</span><span class="sxs-lookup"><span data-stu-id="6eae8-132">Instead, when an anonymously hosted dynamic method is created, the call stack is captured.</span></span> <span data-ttu-id="6eae8-133">Quando o método é construído, as demandas de segurança são feitas em relação à pilha de chamadas capturada.</span><span class="sxs-lookup"><span data-stu-id="6eae8-133">When the method is constructed, security demands are made against the captured call stack.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-134">Conceitualmente, as demandas são feitas durante a construção do método.</span><span class="sxs-lookup"><span data-stu-id="6eae8-134">Conceptually, demands are made during the construction of the method.</span></span> <span data-ttu-id="6eae8-135">Ou seja, as demandas podem ser feitas conforme cada instrução MSIL é emitida.</span><span class="sxs-lookup"><span data-stu-id="6eae8-135">That is, demands could be made as each MSIL instruction is emitted.</span></span> <span data-ttu-id="6eae8-136">Na implementação atual, todas as solicitações são feitas quando o método <xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A?displayProperty=nameWithType> é chamado ou quando o compilador JIT (Just-In-Time) é invocado, se o método for invocado sem chamar <xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-136">In the current implementation, all demands are made when the <xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A?displayProperty=nameWithType> method is called or when the just-in-time (JIT) compiler is invoked, if the method is invoked without calling <xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A>.</span></span>  
  
 <span data-ttu-id="6eae8-137">Se o domínio do aplicativo permitir isso, os métodos dinâmicos hospedados anonimamente poderão ignorar as verificações de visibilidade JIT, sujeitos à seguinte restrição: Os tipos e membros não públicos acessados por um método dinâmico hospedado anonimamente precisam ser em assemblies cujos conjuntos de concessões sejam iguais ao conjunto de concessões da pilha de chamadas de emissão ou sejam subconjuntos dele.</span><span class="sxs-lookup"><span data-stu-id="6eae8-137">If the application domain permits it, anonymously hosted dynamic methods can skip JIT visibility checks, subject to the following restriction: The nonpublic types and members accessed by an anonymously hosted dynamic method must be in assemblies whose grant sets are equal to, or subsets of, the grant set of the emitting call stack.</span></span> <span data-ttu-id="6eae8-138">Essa capacidade restrita de ignorar as verificações de visibilidade JIT é habilitada se o domínio do aplicativo concede <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-138">This restricted ability to skip JIT visibility checks is enabled if the application domain grants <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag.</span></span>  
  
- <span data-ttu-id="6eae8-139">Se o método usar apenas membros e tipos públicos, não serão necessárias permissões durante a construção.</span><span class="sxs-lookup"><span data-stu-id="6eae8-139">If your method uses only public types and members, no permissions are required during construction.</span></span>  
  
- <span data-ttu-id="6eae8-140">Se você especificar que as verificações de visibilidade JIT devem ser ignoradas, a solicitação feita quando o método é construído incluirá <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> e o conjunto de concessões do assembly que contém o membro não público sendo acessado.</span><span class="sxs-lookup"><span data-stu-id="6eae8-140">If you specify that JIT visibility checks should be skipped, the demand that is made when the method is constructed includes <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag and the grant set of the assembly that contains the nonpublic member that is being accessed.</span></span>  
  
 <span data-ttu-id="6eae8-141">Como o conjunto de concessões do membro não público é considerado, o código parcialmente confiável que recebeu <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> não pode elevar seus privilégios executando membros não públicos de assemblies confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6eae8-141">Because the grant set of the nonpublic member is taken into consideration, partially trusted code that has been granted <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> cannot elevate its privileges by executing nonpublic members of trusted assemblies.</span></span>  
  
 <span data-ttu-id="6eae8-142">Como com qualquer outro código emitido, executar o método dinâmico requer as permissões que são exigidas pelos métodos que o método dinâmico usa.</span><span class="sxs-lookup"><span data-stu-id="6eae8-142">As with any other emitted code, executing the dynamic method requires whatever permissions are demanded by the methods the dynamic method uses.</span></span>  
  
 <span data-ttu-id="6eae8-143">O assembly do sistema que hospeda métodos dinâmicos hospedados anonimamente usa o modelo de transparência <xref:System.Security.SecurityRuleSet.Level1?displayProperty=nameWithType>, que é o modelo de transparência que era usado no .NET Framework antes do [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6eae8-143">The system assembly that hosts anonymously-hosted dynamic methods uses the <xref:System.Security.SecurityRuleSet.Level1?displayProperty=nameWithType> transparency model, which is the transparency model that was used in the .NET Framework before the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].</span></span>  
  
 <span data-ttu-id="6eae8-144">Para obter mais informações, consulte a classe <xref:System.Reflection.Emit.DynamicMethod>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-144">For more information, see the <xref:System.Reflection.Emit.DynamicMethod> class.</span></span>  
  
### <a name="generating-anonymously-hosted-dynamic-methods-from-partially-trusted-code"></a><span data-ttu-id="6eae8-145">Gerando métodos dinâmicos hospedados anonimamente do código parcialmente confiável</span><span class="sxs-lookup"><span data-stu-id="6eae8-145">Generating Anonymously Hosted Dynamic Methods from Partially Trusted Code</span></span>  
 <span data-ttu-id="6eae8-146">Considere as condições em que um assembly com permissões de Internet pode gerar um assembly dinâmico hospedado anonimamente e executá-lo:</span><span class="sxs-lookup"><span data-stu-id="6eae8-146">Consider the conditions in which an assembly with Internet permissions can generate an anonymously hosted dynamic method and execute it:</span></span>  
  
- <span data-ttu-id="6eae8-147">O método dinâmico usa apenas tipos e membros públicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-147">The dynamic method uses only public types and members.</span></span> <span data-ttu-id="6eae8-148">Se o seu conjunto de concessões inclui <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType>, ele pode usar membros e tipos não públicos de qualquer assembly cujo conjunto de concessões seja igual ao, ou um subconjunto do, conjunto de concessões do assembly emissor.</span><span class="sxs-lookup"><span data-stu-id="6eae8-148">If its grant set includes <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType>, it can use nonpublic types and members of any assembly whose grant set is equal to, or a subset of, the grant set of the emitting assembly.</span></span>  
  
- <span data-ttu-id="6eae8-149">As permissões exigidas por todos os tipos e membros usados pelo método dinâmico são incluídas no conjunto de concessões do assembly parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6eae8-149">The permissions that are required by all the types and members used by the dynamic method are included in the grant set of the partially trusted assembly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-150">Os métodos dinâmicos não têm suporte para símbolos de depuração.</span><span class="sxs-lookup"><span data-stu-id="6eae8-150">Dynamic methods do not support debug symbols.</span></span>  
  
<a name="Dynamic_Methods_Associated_with_Existing_Assemblies"></a>   
## <a name="dynamic-methods-associated-with-existing-assemblies"></a><span data-ttu-id="6eae8-151">Métodos Dinâmicos Associados a Assemblies Existentes</span><span class="sxs-lookup"><span data-stu-id="6eae8-151">Dynamic Methods Associated with Existing Assemblies</span></span>  
 <span data-ttu-id="6eae8-152">Para associar um método dinâmico a um tipo ou um módulo em um assembly existente, use qualquer um dos construtores <xref:System.Reflection.Emit.DynamicMethod> que especificam o módulo ou tipo associado.</span><span class="sxs-lookup"><span data-stu-id="6eae8-152">To associate a dynamic method with a type or module in an existing assembly, use any of the <xref:System.Reflection.Emit.DynamicMethod> constructors that specify the associated type or module.</span></span> <span data-ttu-id="6eae8-153">As permissões necessárias para chamar esses construtores variam, pois associar um método dinâmico a um módulo ou tipo existente fornece ao método dinâmico o acesso aos membros e tipos não públicos:</span><span class="sxs-lookup"><span data-stu-id="6eae8-153">The permissions that are required to call these constructors vary, because associating a dynamic method with an existing type or module gives the dynamic method access to nonpublic types and members:</span></span>  
  
- <span data-ttu-id="6eae8-154">Um método dinâmico associado um tipo tem acesso a todos os membros desse tipo, mesmo membros privados e a todos os tipos e membros internos no assembly que contém o tipo associado.</span><span class="sxs-lookup"><span data-stu-id="6eae8-154">A dynamic method that is associated with a type has access to all members of that type, even private members, and to all internal types and members in the assembly that contains the associated type.</span></span>  
  
- <span data-ttu-id="6eae8-155">Um método dinâmico que está associado um módulo tem acesso a todos os tipos e membros `internal` (`Friend` no Visual Basic, `assembly` nos metadados do Common Language Runtime) no módulo.</span><span class="sxs-lookup"><span data-stu-id="6eae8-155">A dynamic method that is associated with a module has access to all the `internal` types and members (`Friend` in Visual Basic, `assembly` in common language runtime metadata) in the module.</span></span>  
  
 <span data-ttu-id="6eae8-156">Além disso, você pode usar um construtor que especifica a capacidade de ignorar as verificações de visibilidade do compilador JIT.</span><span class="sxs-lookup"><span data-stu-id="6eae8-156">In addition, you can use a constructor that specifies the ability to skip the visibility checks of the JIT compiler.</span></span> <span data-ttu-id="6eae8-157">Fazer isso concede ao seu método dinâmico o acesso a todos os tipos e membros em todos os assemblies, independentemente do nível de acesso.</span><span class="sxs-lookup"><span data-stu-id="6eae8-157">Doing so gives your dynamic method access to all types and members in all assemblies, regardless of access level.</span></span>  
  
 <span data-ttu-id="6eae8-158">As permissões exigidas pelo construtor dependem de quanto acesso você decide conceder ao seu método dinâmico:</span><span class="sxs-lookup"><span data-stu-id="6eae8-158">The permissions demanded by the constructor depend on how much access you decide to give your dynamic method:</span></span>  
  
- <span data-ttu-id="6eae8-159">Se o método usar apenas membros e tipos públicos e você associá-lo ao seu próprio tipo ou módulo, não será necessária nenhuma permissão.</span><span class="sxs-lookup"><span data-stu-id="6eae8-159">If your method uses only public types and members, and you associate it with your own type or your own module, no permissions are required.</span></span>  
  
- <span data-ttu-id="6eae8-160">Se você especificar que as verificações de visibilidade JIT devem ser ignoradas, o construtor exigirá <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-160">If you specify that JIT visibility checks should be skipped, the constructor demands <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> flag.</span></span>  
  
- <span data-ttu-id="6eae8-161">Se você associar o método dinâmico a outro tipo, mesmo outro tipo em seu próprio assembly, o construtor exigirá <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> e <xref:System.Security.Permissions.SecurityPermission> com o sinalizador <xref:System.Security.Permissions.SecurityPermissionFlag.ControlEvidence?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-161">If you associate the dynamic method with another type, even another type in your own assembly, the constructor demands <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> flag and <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.ControlEvidence?displayProperty=nameWithType> flag.</span></span>  
  
- <span data-ttu-id="6eae8-162">Se você associar o método dinâmico a um tipo ou um módulo em outro assembly, o construtor exigirá duas coisas: <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> e o conjunto de concessões do assembly que contém o outro módulo.</span><span class="sxs-lookup"><span data-stu-id="6eae8-162">If you associate the dynamic method with a type or module in another assembly, the constructor demands two things: <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag, and the grant set of the assembly that contains the other module.</span></span> <span data-ttu-id="6eae8-163">Ou seja, a pilha de chamadas deve incluir todas as permissões no conjunto de concessões do módulo de destino, além de <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-163">That is, your call stack must include all the permissions in the grant set of the target module, plus <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType>.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="6eae8-164">Para compatibilidade com versões anteriores, se a exigência do conjunto de concessões com <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> falhar, o construtor exigirá <xref:System.Security.Permissions.SecurityPermission> com o sinalizador <xref:System.Security.Permissions.SecurityPermissionFlag.ControlEvidence?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-164">For backward compatibility, if the demand for the target grant set plus <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> fails, the constructor demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.ControlEvidence?displayProperty=nameWithType> flag.</span></span>  
  
 <span data-ttu-id="6eae8-165">Embora os itens nessa lista estejam descritos em termos do conjunto de concessões do assembly emissor, lembre-se de que as exigências são feitas em relação à pilha de chamadas completa, incluindo o limite de domínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6eae8-165">Although the items in this list are described in terms of the grant set of the emitting assembly, remember that the demands are made against the full call stack, including the application domain boundary.</span></span>  
  
 <span data-ttu-id="6eae8-166">Para obter mais informações, consulte a classe <xref:System.Reflection.Emit.DynamicMethod>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-166">For more information, see the <xref:System.Reflection.Emit.DynamicMethod> class.</span></span>  
  
### <a name="generating-dynamic-methods-from-partially-trusted-code"></a><span data-ttu-id="6eae8-167">Gerando métodos dinâmicos do código parcialmente confiável</span><span class="sxs-lookup"><span data-stu-id="6eae8-167">Generating Dynamic Methods from Partially Trusted Code</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-168">A maneira recomendada para gerar métodos dinâmicos do código parcialmente confiável é usar [métodos dinâmicos hospedados anonimamente](#Anonymously_Hosted_Dynamic_Methods).</span><span class="sxs-lookup"><span data-stu-id="6eae8-168">The recommended way to generate dynamic methods from partially trusted code is to use [anonymously hosted dynamic methods](#Anonymously_Hosted_Dynamic_Methods).</span></span>  
  
 <span data-ttu-id="6eae8-169">Considere as condições em que um assembly com permissões de Internet pode gerar um método dinâmico e executá-lo:</span><span class="sxs-lookup"><span data-stu-id="6eae8-169">Consider the conditions in which an assembly with Internet permissions can generate a dynamic method and execute it:</span></span>  
  
- <span data-ttu-id="6eae8-170">O método dinâmico é associado ao módulo ou tipo que o emite ou seu conjunto de concessões inclui <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> e ele é associado a um módulo em um assembly cujo conjunto de concessões é igual ao ou um subconjunto do, conjunto de concessões do assembly emissor.</span><span class="sxs-lookup"><span data-stu-id="6eae8-170">Either the dynamic method is associated with the module or type that emits it, or its grant set includes <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> and it is associated with a module in an assembly whose grant set is equal to, or a subset of, the grant set of the emitting assembly.</span></span>  
  
- <span data-ttu-id="6eae8-171">O método dinâmico usa apenas tipos e membros públicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-171">The dynamic method uses only public types and members.</span></span> <span data-ttu-id="6eae8-172">Se seu conjunto de concessões incluir <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> e estiver associado a um módulo em um assembly cujo conjunto de concessões é igual ao ou um subconjunto do, conjunto de concessões do assembly emissor, ele poderá usar tipos e membros marcados com `internal` (`Friend` no Visual Basic, `assembly` nos metadados do Common Language Runtime) no módulo associado.</span><span class="sxs-lookup"><span data-stu-id="6eae8-172">If its grant set includes <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> and it is associated with a module in an assembly whose grant set is equal to, or a subset of, the grant set of the emitting assembly, it can use types and members marked `internal` (`Friend` in Visual Basic, `assembly` in common language runtime metadata) in the associated module.</span></span>  
  
- <span data-ttu-id="6eae8-173">As permissões exigidas por todos os tipos e membros usados pelo método dinâmico são incluídas no conjunto de concessões do assembly parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6eae8-173">The permissions demanded by all the types and members used by the dynamic method are included in the grant set of the partially trusted assembly.</span></span>  
  
- <span data-ttu-id="6eae8-174">O método dinâmico não ignora as verificações de visibilidade JIT.</span><span class="sxs-lookup"><span data-stu-id="6eae8-174">The dynamic method does not skip JIT visibility checks.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-175">Os métodos dinâmicos não têm suporte para símbolos de depuração.</span><span class="sxs-lookup"><span data-stu-id="6eae8-175">Dynamic methods do not support debug symbols.</span></span>  
  
<a name="Version_Information"></a>   
## <a name="version-information"></a><span data-ttu-id="6eae8-176">Informações de versão</span><span class="sxs-lookup"><span data-stu-id="6eae8-176">Version Information</span></span>  
 <span data-ttu-id="6eae8-177">Desde o [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], a política de segurança de todo computador é eliminada e a transparência de segurança se torna o mecanismo de imposição padrão.</span><span class="sxs-lookup"><span data-stu-id="6eae8-177">Starting with the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], machine-wide security policy is eliminated and security transparency becomes the default enforcement mechanism.</span></span> <span data-ttu-id="6eae8-178">Consulte [Alterações de segurança](../../../docs/framework/security/security-changes.md).</span><span class="sxs-lookup"><span data-stu-id="6eae8-178">See [Security Changes](../../../docs/framework/security/security-changes.md).</span></span>  
  
 <span data-ttu-id="6eae8-179">Desde o [!INCLUDE[net_v20SP1_long](../../../includes/net-v20sp1-long-md.md)], <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> não é mais necessário ao emitir métodos dinâmicos e assemblies dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-179">Starting with the [!INCLUDE[net_v20SP1_long](../../../includes/net-v20sp1-long-md.md)], <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flag is no longer required when emitting dynamic assemblies and dynamic methods.</span></span> <span data-ttu-id="6eae8-180">Esse sinalizador é exigido em todas as versões anteriores do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6eae8-180">This flag is required in all earlier versions of the .NET Framework.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6eae8-181"><xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> é incluído por padrão nos conjuntos de permissões denominados `FullTrust` e `LocalIntranet`, mas não no conjunto de permissões `Internet`.</span><span class="sxs-lookup"><span data-stu-id="6eae8-181"><xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flag is included by default in the `FullTrust` and `LocalIntranet` named permission sets, but not in the `Internet` permission set.</span></span> <span data-ttu-id="6eae8-182">Portanto, em versões anteriores do .NET Framework, uma biblioteca poderá ser usada com permissões de Internet somente se ela executar um <xref:System.Security.PermissionSet.Assert%2A> para <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-182">Therefore, in earlier versions of the .NET Framework, a library can be used with Internet permissions only if it executes an <xref:System.Security.PermissionSet.Assert%2A> for <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span></span> <span data-ttu-id="6eae8-183">Tais bibliotecas exigem uma análise atenta da segurança, pois erros de código poderiam resultar em falhas de segurança.</span><span class="sxs-lookup"><span data-stu-id="6eae8-183">Such libraries require careful security review because coding errors could result in security holes.</span></span> <span data-ttu-id="6eae8-184">O [!INCLUDE[net_v20SP1_short](../../../includes/net-v20sp1-short-md.md)] permite que o código seja emitido em cenários de confiança parcial sem emitir qualquer demanda de segurança, pois a geração de código não é uma operação inerentemente privilegiada.</span><span class="sxs-lookup"><span data-stu-id="6eae8-184">The [!INCLUDE[net_v20SP1_short](../../../includes/net-v20sp1-short-md.md)] allows code to be emitted in partial trust scenarios without issuing any security demands, because generating code is not inherently a privileged operation.</span></span> <span data-ttu-id="6eae8-185">Ou seja, o código gerado não tem mais permissões que o assembly que o emite.</span><span class="sxs-lookup"><span data-stu-id="6eae8-185">That is, the generated code has no more permissions than the assembly that emits it.</span></span> <span data-ttu-id="6eae8-186">Isso permite que as bibliotecas que emitem código tenham a segurança transparente e remove a necessidade de declarar <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, o que simplifica a tarefa de escrever uma biblioteca de segurança.</span><span class="sxs-lookup"><span data-stu-id="6eae8-186">This allows libraries that emit code to be security transparent and removes the need to assert <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, which simplifies the task of writing a secure library.</span></span>  
  
 <span data-ttu-id="6eae8-187">Além disso, o [!INCLUDE[net_v20SP1_short](../../../includes/net-v20sp1-short-md.md)] introduz o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> para acessar membros e tipos não públicos de métodos dinâmicos parcialmente confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6eae8-187">In addition, the [!INCLUDE[net_v20SP1_short](../../../includes/net-v20sp1-short-md.md)] introduces the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag for accessing nonpublic types and members from partially trusted dynamic methods.</span></span> <span data-ttu-id="6eae8-188">Versões anteriores do .NET Framework exigem o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> para os métodos dinâmicos que acessam os membros e tipos não públicos. Essa é uma permissão que não deve ser concedida nunca ao código parcialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="6eae8-188">Earlier versions of the .NET Framework require the <xref:System.Security.Permissions.ReflectionPermissionFlag.MemberAccess?displayProperty=nameWithType> flag for dynamic methods that access nonpublic types and members; this is a permission that should never be granted to partially trusted code.</span></span>  
  
 <span data-ttu-id="6eae8-189">Por fim, o [!INCLUDE[net_v20SP1_short](../../../includes/net-v20sp1-short-md.md)] introduz os métodos hospedados anonimamente.</span><span class="sxs-lookup"><span data-stu-id="6eae8-189">Finally, the [!INCLUDE[net_v20SP1_short](../../../includes/net-v20sp1-short-md.md)] introduces anonymously hosted methods.</span></span>  
  
### <a name="obtaining-information-on-types-and-members"></a><span data-ttu-id="6eae8-190">Obtendo informações sobre tipos e membros</span><span class="sxs-lookup"><span data-stu-id="6eae8-190">Obtaining Information on Types and Members</span></span>  
 <span data-ttu-id="6eae8-191">Desde o [!INCLUDE[dnprdnlong](../../../includes/dnprdnlong-md.md)], não é necessária nenhuma permissão para obter informações sobre membros e tipos não públicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-191">Starting with the [!INCLUDE[dnprdnlong](../../../includes/dnprdnlong-md.md)], no permissions are required to obtain information about nonpublic types and members.</span></span> <span data-ttu-id="6eae8-192">A reflexão é usada para obter as informações necessárias para emitir métodos dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="6eae8-192">Reflection is used to obtain information needed to emit dynamic methods.</span></span> <span data-ttu-id="6eae8-193">Por exemplo, os objetos <xref:System.Reflection.MethodInfo> são usados para emitir chamadas de método.</span><span class="sxs-lookup"><span data-stu-id="6eae8-193">For example, <xref:System.Reflection.MethodInfo> objects are used to emit method calls.</span></span> <span data-ttu-id="6eae8-194">As versões anteriores do .NET Framework exigem <xref:System.Security.Permissions.ReflectionPermission> com o sinalizador <xref:System.Security.Permissions.ReflectionPermissionFlag.TypeInformation?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6eae8-194">Earlier versions of the .NET Framework require <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.TypeInformation?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="6eae8-195">Para obter mais informações, consulte [Security Considerations for Reflection](../../../docs/framework/reflection-and-codedom/security-considerations-for-reflection.md) (Considerações sobre segurança relacionadas à reflexão).</span><span class="sxs-lookup"><span data-stu-id="6eae8-195">For more information, see [Security Considerations for Reflection](../../../docs/framework/reflection-and-codedom/security-considerations-for-reflection.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6eae8-196">Consulte também</span><span class="sxs-lookup"><span data-stu-id="6eae8-196">See also</span></span>

- <span data-ttu-id="6eae8-197">[Security Considerations for Reflection](../../../docs/framework/reflection-and-codedom/security-considerations-for-reflection.md) (Considerações sobre segurança relacionadas à reflexão)</span><span class="sxs-lookup"><span data-stu-id="6eae8-197">[Security Considerations for Reflection](../../../docs/framework/reflection-and-codedom/security-considerations-for-reflection.md)</span></span>
- [<span data-ttu-id="6eae8-198">Emissão de métodos e assemblies dinâmicos</span><span class="sxs-lookup"><span data-stu-id="6eae8-198">Emitting Dynamic Methods and Assemblies</span></span>](../../../docs/framework/reflection-and-codedom/emitting-dynamic-methods-and-assemblies.md)
