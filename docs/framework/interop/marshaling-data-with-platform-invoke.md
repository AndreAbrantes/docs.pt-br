---
title: Marshaling de dados com invocação de plataforma
description: Realize marshaling de dados com a invocação de plataforma no .NET. Veja uma lista de tipos de dados usados em APIs do Windows e funções em estilo C e localize seus equivalentes de tipo gerenciado do .NET.
ms.date: 03/20/2019
dev_langs:
- cpp
helpviewer_keywords:
- platform invoke, marshaling data
- data marshaling, platform invoke
- marshaling, platform invoke
ms.assetid: dc5c76cf-7b12-406f-b79c-d1a023ec245d
ms.openlocfilehash: 27045790780c1eef9537bdf7e52deb579e2b467c
ms.sourcegitcommit: 3824ff187947572b274b9715b60c11269335c181
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/17/2020
ms.locfileid: "84904098"
---
# <a name="marshaling-data-with-platform-invoke"></a><span data-ttu-id="fa493-104">Marshaling de dados com invocação de plataforma</span><span class="sxs-lookup"><span data-stu-id="fa493-104">Marshaling Data with Platform Invoke</span></span>

<span data-ttu-id="fa493-105">Para chamar funções exportadas de uma biblioteca não gerenciada, um aplicativo do .NET Framework requer um protótipo de função em código gerenciado que representa a função não gerenciada.</span><span class="sxs-lookup"><span data-stu-id="fa493-105">To call functions exported from an unmanaged library, a .NET Framework application requires a function prototype in managed code that represents the unmanaged function.</span></span> <span data-ttu-id="fa493-106">Para criar um protótipo que habilita a invocação de plataforma a realizar marshaling de dados corretamente, você deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="fa493-106">To create a prototype that enables platform invoke to marshal data correctly, you must do the following:</span></span>

- <span data-ttu-id="fa493-107">Aplique o atributo <xref:System.Runtime.InteropServices.DllImportAttribute> à função estática ou método em código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="fa493-107">Apply the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute to the static function or method in managed code.</span></span>

- <span data-ttu-id="fa493-108">Substitua os tipos de dados gerenciados por tipos de dados não gerenciados.</span><span class="sxs-lookup"><span data-stu-id="fa493-108">Substitute managed data types for unmanaged data types.</span></span>

<span data-ttu-id="fa493-109">Você pode usar a documentação fornecida com uma função não gerenciada para construir um protótipo gerenciado equivalente, aplicando o atributo com os respectivos campos opcionais e substituindo os tipos de dados gerenciados por tipos não gerenciados.</span><span class="sxs-lookup"><span data-stu-id="fa493-109">You can use the documentation supplied with an unmanaged function to construct an equivalent managed prototype by applying the attribute with its optional fields and substituting managed data types for unmanaged types.</span></span> <span data-ttu-id="fa493-110">Para obter instruções sobre como aplicar o <xref:System.Runtime.InteropServices.DllImportAttribute>, confira [Consumindo funções de DLL não gerenciadas](consuming-unmanaged-dll-functions.md).</span><span class="sxs-lookup"><span data-stu-id="fa493-110">For instructions about how to apply the <xref:System.Runtime.InteropServices.DllImportAttribute>, see [Consuming Unmanaged DLL Functions](consuming-unmanaged-dll-functions.md).</span></span>

<span data-ttu-id="fa493-111">Esta seção fornece amostras que demonstram como criar protótipos de função gerenciada para passar argumentos para e receber valores retornados de funções exportadas por bibliotecas não gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="fa493-111">This section provides samples that demonstrate how to create managed function prototypes for passing arguments to and receiving return values from functions exported by unmanaged libraries.</span></span> <span data-ttu-id="fa493-112">As amostras também demonstram quando usar o atributo <xref:System.Runtime.InteropServices.MarshalAsAttribute> e a classe <xref:System.Runtime.InteropServices.Marshal> para realizar marshaling de dados explicitamente.</span><span class="sxs-lookup"><span data-stu-id="fa493-112">The samples also demonstrate when to use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute and the <xref:System.Runtime.InteropServices.Marshal> class to explicitly marshal data.</span></span>

## <a name="platform-invoke-data-types"></a><span data-ttu-id="fa493-113">Tipos de dados de invocação de plataforma</span><span class="sxs-lookup"><span data-stu-id="fa493-113">Platform invoke data types</span></span>

<span data-ttu-id="fa493-114">A tabela a seguir lista os tipos de dados usados nas APIs do Windows e nas funções de estilo C.</span><span class="sxs-lookup"><span data-stu-id="fa493-114">The following table lists data types used in the Windows APIs and C-style functions.</span></span> <span data-ttu-id="fa493-115">Muitas bibliotecas não gerenciadas contêm funções que passam esses tipos de dados como parâmetros e valores retornados.</span><span class="sxs-lookup"><span data-stu-id="fa493-115">Many unmanaged libraries contain functions that pass these data types as parameters and return values.</span></span> <span data-ttu-id="fa493-116">A terceira coluna lista a classe ou tipo de valor interno correspondente do .NET Framework que você usa em código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="fa493-116">The third column lists the corresponding .NET Framework built-in value type or class that you use in managed code.</span></span> <span data-ttu-id="fa493-117">Em alguns casos, você pode substituir um tipo do mesmo tamanho pelo tipo listado na tabela.</span><span class="sxs-lookup"><span data-stu-id="fa493-117">In some cases, you can substitute a type of the same size for the type listed in the table.</span></span>

|<span data-ttu-id="fa493-118">Tipo não gerenciado nas APIs do Windows</span><span class="sxs-lookup"><span data-stu-id="fa493-118">Unmanaged type in Windows APIs</span></span>|<span data-ttu-id="fa493-119">Tipo de linguagem C não gerenciado</span><span class="sxs-lookup"><span data-stu-id="fa493-119">Unmanaged C language type</span></span>|<span data-ttu-id="fa493-120">Tipo gerenciado</span><span class="sxs-lookup"><span data-stu-id="fa493-120">Managed type</span></span>|<span data-ttu-id="fa493-121">Description</span><span class="sxs-lookup"><span data-stu-id="fa493-121">Description</span></span>|
|--------------------------------|-------------------------------|------------------------|-----------------|
|`VOID`|`void`|<xref:System.Void?displayProperty=nameWithType>|<span data-ttu-id="fa493-122">Aplicado a uma função que não retorna um valor.</span><span class="sxs-lookup"><span data-stu-id="fa493-122">Applied to a function that does not return a value.</span></span>|
|`HANDLE`|`void *`|<span data-ttu-id="fa493-123"><xref:System.IntPtr?displayProperty=nameWithType> ou <xref:System.UIntPtr?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="fa493-123"><xref:System.IntPtr?displayProperty=nameWithType> or <xref:System.UIntPtr?displayProperty=nameWithType></span></span>|<span data-ttu-id="fa493-124">32 bits em Sistemas Operacionais Windows 32 bits, 64 bits em Sistemas Operacionais Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="fa493-124">32 bits on 32-bit Windows operating systems, 64 bits on 64-bit Windows operating systems.</span></span>|
|`BYTE`|`unsigned char`|<xref:System.Byte?displayProperty=nameWithType>|<span data-ttu-id="fa493-125">8 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-125">8 bits</span></span>|
|`SHORT`|`short`|<xref:System.Int16?displayProperty=nameWithType>|<span data-ttu-id="fa493-126">16 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-126">16 bits</span></span>|
|`WORD`|`unsigned short`|<xref:System.UInt16?displayProperty=nameWithType>|<span data-ttu-id="fa493-127">16 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-127">16 bits</span></span>|
|`INT`|`int`|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="fa493-128">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-128">32 bits</span></span>|
|`UINT`|`unsigned int`|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="fa493-129">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-129">32 bits</span></span>|
|`LONG`|`long`|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="fa493-130">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-130">32 bits</span></span>|
|`BOOL`|`long`|<span data-ttu-id="fa493-131"><xref:System.Boolean?displayProperty=nameWithType> ou <xref:System.Int32?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="fa493-131"><xref:System.Boolean?displayProperty=nameWithType> or <xref:System.Int32?displayProperty=nameWithType></span></span>|<span data-ttu-id="fa493-132">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-132">32 bits</span></span>|
|`DWORD`|`unsigned long`|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="fa493-133">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-133">32 bits</span></span>|
|`ULONG`|`unsigned long`|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="fa493-134">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-134">32 bits</span></span>|
|`CHAR`|`char`|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="fa493-135">Decore com ANSI.</span><span class="sxs-lookup"><span data-stu-id="fa493-135">Decorate with ANSI.</span></span>|
|`WCHAR`|`wchar_t`|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="fa493-136">Decore com Unicode.</span><span class="sxs-lookup"><span data-stu-id="fa493-136">Decorate with Unicode.</span></span>|
|`LPSTR`|`char *`|<span data-ttu-id="fa493-137"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="fa493-137"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="fa493-138">Decore com ANSI.</span><span class="sxs-lookup"><span data-stu-id="fa493-138">Decorate with ANSI.</span></span>|
|`LPCSTR`|`const char *`|<span data-ttu-id="fa493-139"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="fa493-139"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="fa493-140">Decore com ANSI.</span><span class="sxs-lookup"><span data-stu-id="fa493-140">Decorate with ANSI.</span></span>|
|`LPWSTR`|`wchar_t *`|<span data-ttu-id="fa493-141"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="fa493-141"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="fa493-142">Decore com Unicode.</span><span class="sxs-lookup"><span data-stu-id="fa493-142">Decorate with Unicode.</span></span>|
|`LPCWSTR`|`const wchar_t *`|<span data-ttu-id="fa493-143"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="fa493-143"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="fa493-144">Decore com Unicode.</span><span class="sxs-lookup"><span data-stu-id="fa493-144">Decorate with Unicode.</span></span>|
|`FLOAT`|`float`|<xref:System.Single?displayProperty=nameWithType>|<span data-ttu-id="fa493-145">32 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-145">32 bits</span></span>|
|`DOUBLE`|`double`|<xref:System.Double?displayProperty=nameWithType>|<span data-ttu-id="fa493-146">64 bits</span><span class="sxs-lookup"><span data-stu-id="fa493-146">64 bits</span></span>|

<span data-ttu-id="fa493-147">Para obter os tipos correspondentes em Visual Basic, C# e C++, confira a [Introdução à biblioteca de classes .NET Framework](../../standard/class-library-overview.md#system-namespace).</span><span class="sxs-lookup"><span data-stu-id="fa493-147">For corresponding types in Visual Basic, C#, and C++, see the [Introduction to the .NET Framework Class Library](../../standard/class-library-overview.md#system-namespace).</span></span>

## <a name="pinvokelibdll"></a><span data-ttu-id="fa493-148">PinvokeLib.dll</span><span class="sxs-lookup"><span data-stu-id="fa493-148">PinvokeLib.dll</span></span>

<span data-ttu-id="fa493-149">O código a seguir define as funções de biblioteca fornecidas por Pinvoke.dll.</span><span class="sxs-lookup"><span data-stu-id="fa493-149">The following code defines the library functions provided by Pinvoke.dll.</span></span> <span data-ttu-id="fa493-150">Muitos exemplos descritos nesta seção chamam essa biblioteca.</span><span class="sxs-lookup"><span data-stu-id="fa493-150">Many samples described in this section call this library.</span></span>

### <a name="example"></a><span data-ttu-id="fa493-151">Exemplo</span><span class="sxs-lookup"><span data-stu-id="fa493-151">Example</span></span>

[!code-cpp[PInvokeLib#1](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.cpp#1)]

[!code-cpp[PInvokeLib#2](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.h#2)]
