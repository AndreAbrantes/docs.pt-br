---
title: Realizando marshaling de interoperabilidade
description: Introdução ao marshaling de interoperabilidade, que governa o modo como os dados são passados em argumentos de método e valores de retorno entre memória gerenciada e não gerenciada durante chamadas.
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
ms.openlocfilehash: ca733d59abc4ca3d9d470b054ee9e34b5084ae38
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85618968"
---
# <a name="interop-marshaling"></a><span data-ttu-id="d8262-103">Realizando marshaling de interoperabilidade</span><span class="sxs-lookup"><span data-stu-id="d8262-103">Interop Marshaling</span></span>

<span data-ttu-id="d8262-104"> O marshaling de interoperabilidade controla como os dados são passados em argumentos de método e valores retornados entre memória gerenciada e não gerenciada e durante chamadas.</span><span class="sxs-lookup"><span data-stu-id="d8262-104">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="d8262-105">O marshaling de interoperabilidade é uma atividade de tempo de execução executada pelo serviço de marshaling do Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="d8262-105">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>

<span data-ttu-id="d8262-106">A maioria dos tipos de dados têm representações comuns tanto na memória gerenciada quanto na não gerenciada.</span><span class="sxs-lookup"><span data-stu-id="d8262-106">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="d8262-107">O marshaler de interoperabilidade manipula esses tipos para você.</span><span class="sxs-lookup"><span data-stu-id="d8262-107">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="d8262-108">Outros tipos podem ser ambíguos ou não representados em absoluto na memória gerenciada.</span><span class="sxs-lookup"><span data-stu-id="d8262-108">Other types can be ambiguous or not represented at all in managed memory.</span></span>

<span data-ttu-id="d8262-109">Um tipo ambíguo pode ter várias representações não gerenciadas que são mapeadas para um único tipo gerenciado ou ter informações de tipo ausentes, tais como o tamanho de uma matriz.</span><span class="sxs-lookup"><span data-stu-id="d8262-109">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="d8262-110">Para tipos ambíguos, o marshaler fornece uma representação padrão e representações alternativas em que existem várias representações.</span><span class="sxs-lookup"><span data-stu-id="d8262-110">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="d8262-111">Você pode fornecer instruções explícitas para o marshaler sobre como ele deve realizar marshaling de um tipo ambíguo.</span><span class="sxs-lookup"><span data-stu-id="d8262-111">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>

## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="d8262-112">Invocação de plataforma e modelos de interoperabilidade COM</span><span class="sxs-lookup"><span data-stu-id="d8262-112">Platform Invoke and COM Interop Models</span></span>

<span data-ttu-id="d8262-113">O common language runtime fornece dois mecanismos para interoperação com código não gerenciado:</span><span class="sxs-lookup"><span data-stu-id="d8262-113">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>

- <span data-ttu-id="d8262-114">Invocação de plataforma, que permite que o código gerenciado chame funções exportadas de uma biblioteca não gerenciada.</span><span class="sxs-lookup"><span data-stu-id="d8262-114">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>
- <span data-ttu-id="d8262-115">Interoperabilidade COM, que permite que o código gerenciado interaja com objetos COM (Component Object Model) por meio de interfaces.</span><span class="sxs-lookup"><span data-stu-id="d8262-115">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>

<span data-ttu-id="d8262-116">Tanto a invocação de plataforma quanto a interoperabilidade COM usam marshaling de interoperabilidade para mover com precisão os argumentos de método entre o chamador e o receptor e vice-versa, se necessário.</span><span class="sxs-lookup"><span data-stu-id="d8262-116">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="d8262-117">Conforme mostra a ilustração a seguir, uma chamada de método de invocação de plataforma flui do código gerenciado para código não gerenciado e nunca na direção contrária, exceto quando [funções de retorno de chamada](callback-functions.md) estão envolvidas.</span><span class="sxs-lookup"><span data-stu-id="d8262-117">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="d8262-118">Embora as chamadas de invocação de plataforma possam fluir somente de código gerenciado para código não gerenciado, os dados podem fluir em ambas as direções como parâmetros de entrada ou de saída.</span><span class="sxs-lookup"><span data-stu-id="d8262-118">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="d8262-119">As chamadas de método de interoperabilidade COM podem fluir em ambas as direções.</span><span class="sxs-lookup"><span data-stu-id="d8262-119">COM interop method calls can flow in either direction.</span></span>

<span data-ttu-id="d8262-120">![Invocação de plataforma](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Invocação de plataforma e fluxo de chamada de interoperabilidade COM")</span><span class="sxs-lookup"><span data-stu-id="d8262-120">![Platform invoke](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Platform invoke and COM interop call flow")</span></span>

<span data-ttu-id="d8262-121">No nível mais baixo, ambos os mecanismos usam o mesmo serviço de marshaling de interoperabilidade; no entanto, alguns tipos de dados têm suporte apenas pela interoperabilidade COM ou pela invocação de plataforma.</span><span class="sxs-lookup"><span data-stu-id="d8262-121">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="d8262-122">Para obter detalhes, consulte [Comportamento de marshaling padrão](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="d8262-122">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>

## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="d8262-123">Marshaling e apartments COM</span><span class="sxs-lookup"><span data-stu-id="d8262-123">Marshaling and COM Apartments</span></span>

<span data-ttu-id="d8262-124">O marshaler de interoperabilidade realiza marshaling de dados entre o heap do Common Language Runtime e o heap não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="d8262-124">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="d8262-125">O marshaling ocorre sempre que o chamador e o receptor não podem operar na mesma instância dos dados.</span><span class="sxs-lookup"><span data-stu-id="d8262-125">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="d8262-126">O marshaler de interoperabilidade torna possível que o chamador e o receptor pareçam estar funcionando nos mesmos dados, mesmo que eles tenham sua própria cópia dos dados.</span><span class="sxs-lookup"><span data-stu-id="d8262-126">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>

<span data-ttu-id="d8262-127">O COM também tem um marshaler que realiza marshaling de dados entre apartments COM ou processos COM diferentes.</span><span class="sxs-lookup"><span data-stu-id="d8262-127">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="d8262-128">Ao chamar entre código gerenciado e código não gerenciado dentro do mesmo apartment COM, o marshaler de interoperabilidade é o único marshaler envolvido.</span><span class="sxs-lookup"><span data-stu-id="d8262-128">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="d8262-129">Ao chamar entre código gerenciado e o código não gerenciado em um apartment COM diferente ou um processo diferente, tanto o marshaler de interoperabilidade quanto o marshaler COM estão envolvidos.</span><span class="sxs-lookup"><span data-stu-id="d8262-129">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>

### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="d8262-130">Clientes COM e servidores gerenciados</span><span class="sxs-lookup"><span data-stu-id="d8262-130">COM Clients and Managed Servers</span></span>

<span data-ttu-id="d8262-131">Um servidor gerenciado exportado com uma biblioteca de tipos registrada pelo [Regasm.exe (Ferramenta de Registro de Assembly)](../tools/regasm-exe-assembly-registration-tool.md) tem uma `ThreadingModel` entrada do Registro definida como `Both`.</span><span class="sxs-lookup"><span data-stu-id="d8262-131">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="d8262-132">Esse valor indica que o servidor pode ser ativado em um STA (Single-Threaded Apartment) ou um MTA (Multi-Threaded Apartment).</span><span class="sxs-lookup"><span data-stu-id="d8262-132">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="d8262-133">O objeto Server é criado no mesmo apartamento que seu chamador, conforme mostrado na tabela a seguir:</span><span class="sxs-lookup"><span data-stu-id="d8262-133">The server object is created in the same apartment as its caller, as shown in the following table:</span></span>

|<span data-ttu-id="d8262-134">Cliente COM</span><span class="sxs-lookup"><span data-stu-id="d8262-134">COM client</span></span>|<span data-ttu-id="d8262-135">.NET Server</span><span class="sxs-lookup"><span data-stu-id="d8262-135">.NET server</span></span>|<span data-ttu-id="d8262-136">Requisitos de marshaling</span><span class="sxs-lookup"><span data-stu-id="d8262-136">Marshaling requirements</span></span>|
|----------------|-----------------|-----------------------------|
|<span data-ttu-id="d8262-137">STA</span><span class="sxs-lookup"><span data-stu-id="d8262-137">STA</span></span>|<span data-ttu-id="d8262-138">`Both` se torna isso STA.</span><span class="sxs-lookup"><span data-stu-id="d8262-138">`Both` becomes STA.</span></span>|<span data-ttu-id="d8262-139">Marshaling no mesmo apartment.</span><span class="sxs-lookup"><span data-stu-id="d8262-139">Same-apartment marshaling.</span></span>|
|<span data-ttu-id="d8262-140">MTA</span><span class="sxs-lookup"><span data-stu-id="d8262-140">MTA</span></span>|<span data-ttu-id="d8262-141">`Both` se torna MTA.</span><span class="sxs-lookup"><span data-stu-id="d8262-141">`Both` becomes MTA.</span></span>|<span data-ttu-id="d8262-142">Marshaling no mesmo apartment.</span><span class="sxs-lookup"><span data-stu-id="d8262-142">Same-apartment marshaling.</span></span>|

<span data-ttu-id="d8262-143">Já que o cliente e o servidor estão no mesmo apartment, o serviço de marshaling de interoperabilidade manipula automaticamente todo o marshaling de dados.</span><span class="sxs-lookup"><span data-stu-id="d8262-143">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="d8262-144">A ilustração a seguir mostra o serviço de marshaling de interoperabilidade funcionando entre heaps gerenciados e não gerenciados dentro do mesmo apartment de estilo COM.</span><span class="sxs-lookup"><span data-stu-id="d8262-144">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>

<span data-ttu-id="d8262-145">![Marshaling de interoperabilidade entre heaps gerenciados e não gerenciados](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Processo de marshaling no mesmo apartment")</span><span class="sxs-lookup"><span data-stu-id="d8262-145">![Interop marshaling between managed and unmanaged heaps](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Same-apartment marshaling process")</span></span>

<span data-ttu-id="d8262-146">Se você planeja exportar um servidor gerenciado, lembre-se de que o cliente COM determina o apartment do servidor.</span><span class="sxs-lookup"><span data-stu-id="d8262-146">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="d8262-147">Um servidor gerenciado chamado por um cliente COM inicializado em um MTA deve assegurar acesso thread-safe.</span><span class="sxs-lookup"><span data-stu-id="d8262-147">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>

### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="d8262-148">Clientes gerenciados e servidores COM</span><span class="sxs-lookup"><span data-stu-id="d8262-148">Managed Clients and COM Servers</span></span>

<span data-ttu-id="d8262-149">A configuração padrão para apartments de cliente gerenciado é MTA; no entanto, o tipo de aplicativo do cliente .NET pode alterar a configuração padrão.</span><span class="sxs-lookup"><span data-stu-id="d8262-149">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="d8262-150">Por exemplo, a configuração de apartment de um cliente do Visual Basic é STA.</span><span class="sxs-lookup"><span data-stu-id="d8262-150">For example, a Visual Basic client apartment setting is STA.</span></span> <span data-ttu-id="d8262-151">Você pode usar uma das propriedades <xref:System.STAThreadAttribute?displayProperty=nameWithType>, <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> ou <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> para examinar e alterar a configuração de apartment de um cliente gerenciado.</span><span class="sxs-lookup"><span data-stu-id="d8262-151">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>

<span data-ttu-id="d8262-152">O autor do componente define a afinidade do thread de um servidor COM.</span><span class="sxs-lookup"><span data-stu-id="d8262-152">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="d8262-153">A tabela a seguir mostra as combinações de configurações de apartment de clientes .NET e servidores COM.</span><span class="sxs-lookup"><span data-stu-id="d8262-153">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="d8262-154">Ele também mostra os requisitos de marshaling resultantes para as combinações.</span><span class="sxs-lookup"><span data-stu-id="d8262-154">It also shows the resulting marshaling requirements for the combinations.</span></span>

|<span data-ttu-id="d8262-155">Cliente .NET</span><span class="sxs-lookup"><span data-stu-id="d8262-155">.NET client</span></span>|<span data-ttu-id="d8262-156">Servidor COM</span><span class="sxs-lookup"><span data-stu-id="d8262-156">COM server</span></span>|<span data-ttu-id="d8262-157">Requisitos de marshaling</span><span class="sxs-lookup"><span data-stu-id="d8262-157">Marshaling requirements</span></span>|
|-----------------|----------------|-----------------------------|
|<span data-ttu-id="d8262-158">MTA (padrão)</span><span class="sxs-lookup"><span data-stu-id="d8262-158">MTA (default)</span></span>|<span data-ttu-id="d8262-159">MTA</span><span class="sxs-lookup"><span data-stu-id="d8262-159">MTA</span></span><br /><br /> <span data-ttu-id="d8262-160">STA</span><span class="sxs-lookup"><span data-stu-id="d8262-160">STA</span></span>|<span data-ttu-id="d8262-161">Marshaling de interoperabilidade.</span><span class="sxs-lookup"><span data-stu-id="d8262-161">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="d8262-162">Marshaling COM e de interoperabilidade.</span><span class="sxs-lookup"><span data-stu-id="d8262-162">Interop and COM marshaling.</span></span>|
|<span data-ttu-id="d8262-163">STA</span><span class="sxs-lookup"><span data-stu-id="d8262-163">STA</span></span>|<span data-ttu-id="d8262-164">MTA</span><span class="sxs-lookup"><span data-stu-id="d8262-164">MTA</span></span><br /><br /> <span data-ttu-id="d8262-165">STA</span><span class="sxs-lookup"><span data-stu-id="d8262-165">STA</span></span>|<span data-ttu-id="d8262-166">Marshaling COM e de interoperabilidade.</span><span class="sxs-lookup"><span data-stu-id="d8262-166">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="d8262-167">Marshaling de interoperabilidade.</span><span class="sxs-lookup"><span data-stu-id="d8262-167">Interop marshaling.</span></span>|

<span data-ttu-id="d8262-168">Quando um cliente gerenciado e servidor não gerenciado estão no mesmo apartment, o serviço de marshaling de interoperabilidade manipula todo o marshaling de dados.</span><span class="sxs-lookup"><span data-stu-id="d8262-168">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="d8262-169">No entanto, quando o cliente e servidor são inicializados em apartments diferentes, o marshaling de COM também é necessário.</span><span class="sxs-lookup"><span data-stu-id="d8262-169">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="d8262-170">A ilustração a seguir mostra os elementos de uma chamada entre apartamento:</span><span class="sxs-lookup"><span data-stu-id="d8262-170">The following illustration shows the elements of a cross-apartment call:</span></span>

<span data-ttu-id="d8262-171">![Marshaling COM](./media/interop-marshaling/single-process-across-multi-apartment.gif "Chamada entre apartments entre um cliente .NET e um objeto COM")</span><span class="sxs-lookup"><span data-stu-id="d8262-171">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "Cross-apartment call between a .NET client and COM object")</span></span>

<span data-ttu-id="d8262-172">Para realizar marshaling entre apartments, você pode fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d8262-172">For cross-apartment marshaling, you can do the following:</span></span>

- <span data-ttu-id="d8262-173">Aceite a sobrecarga de marshaling de apartment cruzada, que é perceptível somente quando há muitas chamadas entre dos limites.</span><span class="sxs-lookup"><span data-stu-id="d8262-173">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="d8262-174">Você deve registrar a biblioteca de tipos do componente COM para que chamadas cruzem o limite do apartment com êxito.</span><span class="sxs-lookup"><span data-stu-id="d8262-174">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>
- <span data-ttu-id="d8262-175">Altere o thread principal, definindo o thread de cliente para STA ou MTA.</span><span class="sxs-lookup"><span data-stu-id="d8262-175">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="d8262-176">Por exemplo, se o cliente C# chama muitos componentes COM STA, você pode evitar marshaling entre apartments definindo o thread principal para STA.</span><span class="sxs-lookup"><span data-stu-id="d8262-176">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d8262-177">Depois que o thread de um cliente C# for definido para STA, chamadas para componentes COM MTA exigirão marshaling entre apartments.</span><span class="sxs-lookup"><span data-stu-id="d8262-177">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>

<span data-ttu-id="d8262-178">Para obter instruções sobre como selecionar explicitamente um modelo de apartment, consulte [Threading gerenciado e não gerenciado](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="d8262-178">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>

## <a name="marshaling-remote-calls"></a><span data-ttu-id="d8262-179">Marshaling de chamadas remotas</span><span class="sxs-lookup"><span data-stu-id="d8262-179">Marshaling Remote Calls</span></span>

<span data-ttu-id="d8262-180">Assim como ocorre com marshaling entre apartments, o marshaling COM está envolvido em cada chamada entre código gerenciado e código não gerenciado e sempre que os objetos residem em processos separados.</span><span class="sxs-lookup"><span data-stu-id="d8262-180">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="d8262-181">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="d8262-181">For example:</span></span>

- <span data-ttu-id="d8262-182">Um cliente COM que invoca um servidor gerenciado em um host remoto usa COM distribuído (DCOM).</span><span class="sxs-lookup"><span data-stu-id="d8262-182">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>
- <span data-ttu-id="d8262-183">Um cliente gerenciado que chama um servidor COM em um host remoto usa DCOM.</span><span class="sxs-lookup"><span data-stu-id="d8262-183">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>

<span data-ttu-id="d8262-184">A ilustração a seguir mostra como o empacotamento de interoperabilidade e o marshaling COM fornecem canais de comunicação entre limites de host e processo:</span><span class="sxs-lookup"><span data-stu-id="d8262-184">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries:</span></span>

<span data-ttu-id="d8262-185">![Marshaling COM](./media/interop-marshaling/interop-and-com-marshaling.gif "Marshaling entre processos")</span><span class="sxs-lookup"><span data-stu-id="d8262-185">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "Cross-process marshaling")</span></span>

### <a name="preserving-identity"></a><span data-ttu-id="d8262-186">Preservação de identidade</span><span class="sxs-lookup"><span data-stu-id="d8262-186">Preserving Identity</span></span>

<span data-ttu-id="d8262-187">O Common Language Runtime preserva a identidade de referências gerenciadas e não gerenciados.</span><span class="sxs-lookup"><span data-stu-id="d8262-187">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="d8262-188">A ilustração a seguir mostra o fluxo de referências diretas não gerenciadas (linha superior) e referências diretas gerenciadas (linha inferior) entre limites de processo e de host.</span><span class="sxs-lookup"><span data-stu-id="d8262-188">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>

<span data-ttu-id="d8262-189">![Wrapper callable COM Callable Wrapper e Runtime](./media/interop-marshaling/interop-direct-ref-across-process.gif "Referência passando entre limites de processo e de host")</span><span class="sxs-lookup"><span data-stu-id="d8262-189">![COM callable wrapper and runtime callable wrapper](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference passing across process and host boundaries")</span></span>

<span data-ttu-id="d8262-190">Nessa ilustração:</span><span class="sxs-lookup"><span data-stu-id="d8262-190">In this illustration:</span></span>

- <span data-ttu-id="d8262-191">Um cliente não gerenciado obtém uma referência para um objeto COM de um objeto gerenciado que obtém essa referência de um host remoto.</span><span class="sxs-lookup"><span data-stu-id="d8262-191">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="d8262-192">O mecanismo de comunicação remota é DCOM.</span><span class="sxs-lookup"><span data-stu-id="d8262-192">The remoting mechanism is DCOM.</span></span>
- <span data-ttu-id="d8262-193">Um cliente gerenciado obtém uma referência para um objeto gerenciado de um objeto COM que obtém essa referência de um host remoto.</span><span class="sxs-lookup"><span data-stu-id="d8262-193">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="d8262-194">O mecanismo de comunicação remota é DCOM.</span><span class="sxs-lookup"><span data-stu-id="d8262-194">The remoting mechanism is DCOM.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d8262-195">A biblioteca de tipos exportada do servidor gerenciado deve ser registrada.</span><span class="sxs-lookup"><span data-stu-id="d8262-195">The exported type library of the managed server must be registered.</span></span>

<span data-ttu-id="d8262-196">O número de limites de processo entre o chamador e o receptor é irrelevante; a mesma referência direta ocorre para chamadas em processo e fora de processo.</span><span class="sxs-lookup"><span data-stu-id="d8262-196">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>

### <a name="managed-remoting"></a><span data-ttu-id="d8262-197">Comunicação remota gerenciada</span><span class="sxs-lookup"><span data-stu-id="d8262-197">Managed Remoting</span></span>

<span data-ttu-id="d8262-198">O runtime também fornece comunicação remota gerenciada, que pode ser usada para estabelecer um canal de comunicação entre os objetos gerenciados entre limites de processo e de host.</span><span class="sxs-lookup"><span data-stu-id="d8262-198">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="d8262-199">A comunicação remota gerenciada pode acomodar um firewall entre os componentes de comunicação, como mostra a ilustração a seguir:</span><span class="sxs-lookup"><span data-stu-id="d8262-199">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows:</span></span>

<span data-ttu-id="d8262-200">![SOAP ou TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Chamadas remotas através de firewalls usando SOAP ou a classe TcpChannel") Chamadas remotas entre firewalls usando SOAP ou a classe TcpChannel</span><span class="sxs-lookup"><span data-stu-id="d8262-200">![SOAP or TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Remote calls across firewalls using SOAP or the TcpChannel class") Remote calls across firewalls using SOAP or the TcpChannel class</span></span>

<span data-ttu-id="d8262-201">Algumas chamadas não gerenciadas podem ser canalizadas por SOAP, assim como as chamadas entre os componentes de serviço e o COM.</span><span class="sxs-lookup"><span data-stu-id="d8262-201">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d8262-202">Tópicos Relacionados</span><span class="sxs-lookup"><span data-stu-id="d8262-202">Related Topics</span></span>

|<span data-ttu-id="d8262-203">Title</span><span class="sxs-lookup"><span data-stu-id="d8262-203">Title</span></span>|<span data-ttu-id="d8262-204">Descrição</span><span class="sxs-lookup"><span data-stu-id="d8262-204">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="d8262-205">Comportamento de marshaling padrão</span><span class="sxs-lookup"><span data-stu-id="d8262-205">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="d8262-206">Descreve as regras que o serviço de marshaling de interoperabilidade usa para realizar marshaling de dados.</span><span class="sxs-lookup"><span data-stu-id="d8262-206">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|
|[<span data-ttu-id="d8262-207">Marshaling de dados com invocação de plataforma</span><span class="sxs-lookup"><span data-stu-id="d8262-207">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="d8262-208">Descreve como declarar parâmetros de método e passar argumentos para funções exportadas por bibliotecas não gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="d8262-208">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|
|[<span data-ttu-id="d8262-209">Realizando marshaling em dados com interoperabilidade COM</span><span class="sxs-lookup"><span data-stu-id="d8262-209">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="d8262-210">Descreve como personalizar os wrappers COM para alterar o comportamento de marshaling.</span><span class="sxs-lookup"><span data-stu-id="d8262-210">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|
|[<span data-ttu-id="d8262-211">Como: Migrar código DCOM gerenciado para o WCF</span><span class="sxs-lookup"><span data-stu-id="d8262-211">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="d8262-212">Descreve como migrar do DCOM para o WCF.</span><span class="sxs-lookup"><span data-stu-id="d8262-212">Describes how to migrate from DCOM to WCF.</span></span>|
|[<span data-ttu-id="d8262-213">Como: Mapear HRESULTs e exceções</span><span class="sxs-lookup"><span data-stu-id="d8262-213">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="d8262-214">Descreve como mapear exceções personalizadas para HRESULTs e fornece o mapeamento completo de cada HRESULT para a respectiva classe de exceção comparável no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d8262-214">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|
|<span data-ttu-id="d8262-215">[Interoperação usando tipos genéricos](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d8262-215">[Interoperating Using Generic Types](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="d8262-216">Descreve quais ações têm suporte ao usar tipos genéricos para interoperabilidade COM.</span><span class="sxs-lookup"><span data-stu-id="d8262-216">Describes which actions are supported when using generic types for COM interoperability.</span></span>|
|[<span data-ttu-id="d8262-217">Interoperação com código não gerenciado</span><span class="sxs-lookup"><span data-stu-id="d8262-217">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="d8262-218">Descreve os serviços de interoperabilidade fornecidos pelo Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="d8262-218">Describes interoperability services provided by the common language runtime.</span></span>|
|<span data-ttu-id="d8262-219">[Interoperabilidade COM avançada](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d8262-219">[Advanced COM Interoperability](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="d8262-220">Fornece links para obter mais informações sobre como incorporar componentes COM no aplicativo do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d8262-220">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|
|<span data-ttu-id="d8262-221">[Considerações sobre design para interoperação](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d8262-221">[Design Considerations for Interoperation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="d8262-222">Fornece dicas para escrever componentes COM integrados.</span><span class="sxs-lookup"><span data-stu-id="d8262-222">Provides tips for writing integrated COM components.</span></span>|

## <a name="reference"></a><span data-ttu-id="d8262-223">Referência</span><span class="sxs-lookup"><span data-stu-id="d8262-223">Reference</span></span>

<xref:System.Runtime.InteropServices?displayProperty=nameWithType>
