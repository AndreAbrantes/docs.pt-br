---
title: RCW (Runtime Callable Wrapper)
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- COM interop, COM wrappers
- RCW
- COM wrappers
- runtime callable wrappers
- interoperation with unmanaged code, COM wrappers
ms.assetid: 7e542583-1e31-4e10-b523-8cf2f29cb4a4
caps.latest.revision: "9"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 8fed5ff57a4674f9b7723b1b850e972316fa94fb
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/19/2018
---
# <a name="runtime-callable-wrapper"></a><span data-ttu-id="e5f30-102">RCW (Runtime Callable Wrapper)</span><span class="sxs-lookup"><span data-stu-id="e5f30-102">Runtime Callable Wrapper</span></span>
<span data-ttu-id="e5f30-103">O common language runtime expõe objetos COM através de um proxy chamado RCW (Runtime Callable Wrapper).</span><span class="sxs-lookup"><span data-stu-id="e5f30-103">The common language runtime exposes COM objects through a proxy called the runtime callable wrapper (RCW).</span></span> <span data-ttu-id="e5f30-104">Embora o RCW pareça ser um objeto comum para clientes .NET, a função principal dele é realizar marshaling de chamadas entre um cliente .NET e um objeto COM.</span><span class="sxs-lookup"><span data-stu-id="e5f30-104">Although the RCW appears to be an ordinary object to .NET clients, its primary function is to marshal calls between a .NET client and a COM object.</span></span>  
  
 <span data-ttu-id="e5f30-105">O tempo de execução cria exatamente um RCW para cada objeto COM, independentemente do número de referências que existem nesse objeto.</span><span class="sxs-lookup"><span data-stu-id="e5f30-105">The runtime creates exactly one RCW for each COM object, regardless of the number of references that exist on that object.</span></span> <span data-ttu-id="e5f30-106">O tempo de execução mantém um único RCW por processo para cada objeto.</span><span class="sxs-lookup"><span data-stu-id="e5f30-106">The runtime maintains a single RCW per process for each object.</span></span>  <span data-ttu-id="e5f30-107">Se você criar um RCW em um domínio de aplicativo ou apartment e, em seguida, passar uma referência a outro domínio de aplicativo ou apartment, um proxy para o primeiro objeto será usado.</span><span class="sxs-lookup"><span data-stu-id="e5f30-107">If you create an RCW in one application domain or apartment, and then pass a reference to another application domain or apartment, a proxy to the first object will be used.</span></span>  <span data-ttu-id="e5f30-108">Conforme mostra a ilustração a seguir, qualquer número de clientes pode conter uma referência a objetos COM que expõem interfaces INew e INewer.</span><span class="sxs-lookup"><span data-stu-id="e5f30-108">As the following illustration shows, any number of managed clients can hold a reference to the COM objects that expose INew and INewer interfaces.</span></span>  
  
 <span data-ttu-id="e5f30-109">![RCW](../../../docs/framework/interop/media/rcw.gif "rcw")</span><span class="sxs-lookup"><span data-stu-id="e5f30-109">![RCW](../../../docs/framework/interop/media/rcw.gif "rcw")</span></span>  
<span data-ttu-id="e5f30-110">Acessando objetos COM através do runtime callable wrapper</span><span class="sxs-lookup"><span data-stu-id="e5f30-110">Accessing COM objects through the runtime callable wrapper</span></span>  
  
 <span data-ttu-id="e5f30-111">Usando metadados derivados de uma biblioteca de tipos, o tempo de execução cria o objeto COM que está sendo chamado e um wrapper para esse objeto.</span><span class="sxs-lookup"><span data-stu-id="e5f30-111">Using metadata derived from a type library, the runtime creates both the COM object being called and a wrapper for that object.</span></span> <span data-ttu-id="e5f30-112">Cada RCW mantém um cache de ponteiros de interface no objeto COM que ele encapsula e, além disso, libera sua referência no objeto COM quando o RCW não é mais necessário.</span><span class="sxs-lookup"><span data-stu-id="e5f30-112">Each RCW maintains a cache of interface pointers on the COM object it wraps and releases its reference on the COM object when the RCW is no longer needed.</span></span> <span data-ttu-id="e5f30-113">O tempo de execução executa a coleta de lixo no RCW.</span><span class="sxs-lookup"><span data-stu-id="e5f30-113">The runtime performs garbage collection on the RCW.</span></span>  
  
 <span data-ttu-id="e5f30-114">Entre outras atividades, o RCW realiza marshaling de dados entre código gerenciado e não gerenciado, em nome do objeto encapsulado.</span><span class="sxs-lookup"><span data-stu-id="e5f30-114">Among other activities, the RCW marshals data between managed and unmanaged code, on behalf of the wrapped object.</span></span> <span data-ttu-id="e5f30-115">Especificamente, o RCW fornece marshaling para argumentos de método e valores retornados do método sempre que o cliente e o servidor têm representações diferentes dos dados transmitidos entre eles.</span><span class="sxs-lookup"><span data-stu-id="e5f30-115">Specifically, the RCW provides marshaling for method arguments and method return values whenever the client and server have different representations of the data passed between them.</span></span>  
  
 <span data-ttu-id="e5f30-116">O wrapper padrão impõe regras de marshaling internas.</span><span class="sxs-lookup"><span data-stu-id="e5f30-116">The standard wrapper enforces built-in marshaling rules.</span></span> <span data-ttu-id="e5f30-117">Por exemplo, quando um cliente .NET passa um tipo de cadeia de caracteres como parte de um argumento para um objeto não gerenciado, o wrapper converte a cadeia de caracteres em um tipo BSTR.</span><span class="sxs-lookup"><span data-stu-id="e5f30-117">For example, when a .NET client passes a String type as part of an argument to an unmanaged object, the wrapper converts the string to a BSTR type.</span></span> <span data-ttu-id="e5f30-118">Se o objeto COM retornar um BSTR ao chamador gerenciado, o chamador receberá uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="e5f30-118">Should the COM object return a BSTR to its managed caller, the caller receives a String.</span></span> <span data-ttu-id="e5f30-119">Tanto o cliente quanto o servidor enviam e recebem dados com os quais estão familiarizados.</span><span class="sxs-lookup"><span data-stu-id="e5f30-119">Both the client and the server send and receive data that is familiar to them.</span></span> <span data-ttu-id="e5f30-120">Outros tipos não exigem conversão.</span><span class="sxs-lookup"><span data-stu-id="e5f30-120">Other types require no conversion.</span></span> <span data-ttu-id="e5f30-121">Por exemplo, um wrapper padrão sempre passará um inteiro de 4 bytes entre código gerenciado e não gerenciado sem converter o tipo.</span><span class="sxs-lookup"><span data-stu-id="e5f30-121">For instance, a standard wrapper will always pass a 4-byte integer between managed and unmanaged code without converting the type.</span></span>  
  
## <a name="marshaling-selected-interfaces"></a><span data-ttu-id="e5f30-122">Marshaling de interfaces selecionadas</span><span class="sxs-lookup"><span data-stu-id="e5f30-122">Marshaling selected interfaces</span></span>  
 <span data-ttu-id="e5f30-123">A meta principal do [RCW](../../../docs/framework/interop/runtime-callable-wrapper.md) (Runtime Callable Wrapper) é ocultar as diferenças entre os modelos de programação gerenciado e não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="e5f30-123">The primary goal of the [runtime callable wrapper](../../../docs/framework/interop/runtime-callable-wrapper.md) (RCW) is to hide the differences between the managed and unmanaged programming models.</span></span> <span data-ttu-id="e5f30-124">Para criar uma transição suave, o RCW consome interfaces COM selecionadas sem expô-las ao cliente .NET, conforme mostrado na ilustração a seguir.</span><span class="sxs-lookup"><span data-stu-id="e5f30-124">To create a seamless transition, the RCW consumes selected COM interfaces without exposing them to the .NET client, as shown in the following illustration.</span></span>  
  
 <span data-ttu-id="e5f30-125">![RCW com interfaces](../../../docs/framework/interop/media/rcwwithinterfaces.gif "rcwwithinterfaces")</span><span class="sxs-lookup"><span data-stu-id="e5f30-125">![RCW With Interfaces](../../../docs/framework/interop/media/rcwwithinterfaces.gif "rcwwithinterfaces")</span></span>  
<span data-ttu-id="e5f30-126">Interfaces COM e o Runtime Callable Wrapper</span><span class="sxs-lookup"><span data-stu-id="e5f30-126">COM interfaces and the runtime callable wrapper</span></span>  
  
 <span data-ttu-id="e5f30-127">Quando criado como um objeto associado precocemente, o RCW é um tipo específico.</span><span class="sxs-lookup"><span data-stu-id="e5f30-127">When created as an early-bound object, the RCW is a specific type.</span></span> <span data-ttu-id="e5f30-128">Ele implementa as interfaces que o objeto COM implementa e expõe os métodos, propriedades e eventos das interfaces do objeto.</span><span class="sxs-lookup"><span data-stu-id="e5f30-128">It implements the interfaces that the COM object implements and exposes the methods, properties, and events from the object's interfaces.</span></span> <span data-ttu-id="e5f30-129">Na ilustração, o RCW expõe a interface INew mas consome as interfaces **IUnknown** e **IDispatch**.</span><span class="sxs-lookup"><span data-stu-id="e5f30-129">In the illustration, the RCW exposes the INew interface but consumes the **IUnknown** and **IDispatch** interfaces.</span></span> <span data-ttu-id="e5f30-130">Além disso, o RCW expõe todos os membros da interface INew para o cliente .NET.</span><span class="sxs-lookup"><span data-stu-id="e5f30-130">Further, the RCW exposes all members of the INew interface to the .NET client.</span></span>  
  
 <span data-ttu-id="e5f30-131">O RCW consome as interfaces listadas na tabela a seguir, as quais são expostas pelo objeto que ele encapsula.</span><span class="sxs-lookup"><span data-stu-id="e5f30-131">The RCW consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="e5f30-132">Interface</span><span class="sxs-lookup"><span data-stu-id="e5f30-132">Interface</span></span>|<span data-ttu-id="e5f30-133">Descrição</span><span class="sxs-lookup"><span data-stu-id="e5f30-133">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="e5f30-134">**IDispatch**</span><span class="sxs-lookup"><span data-stu-id="e5f30-134">**IDispatch**</span></span>|<span data-ttu-id="e5f30-135">Para associação tardia a objetos COM por meio de reflexão.</span><span class="sxs-lookup"><span data-stu-id="e5f30-135">For late binding to COM objects through reflection.</span></span>|  
|<span data-ttu-id="e5f30-136">**IErrorInfo**</span><span class="sxs-lookup"><span data-stu-id="e5f30-136">**IErrorInfo**</span></span>|<span data-ttu-id="e5f30-137">Fornece uma descrição textual do erro, sua origem, um arquivo de Ajuda, um contexto de Ajuda e o GUID da interface que definiu o erro (sempre **GUID_NULL** para classes do .NET).</span><span class="sxs-lookup"><span data-stu-id="e5f30-137">Provides a textual description of the error, its source, a Help file, Help context, and the GUID of the interface that defined the error (always **GUID_NULL** for .NET classes).</span></span>|  
|<span data-ttu-id="e5f30-138">**IProvideClassInfo**</span><span class="sxs-lookup"><span data-stu-id="e5f30-138">**IProvideClassInfo**</span></span>|<span data-ttu-id="e5f30-139">Se o objeto COM sendo empacotado implementa **IProvideClassInfo**, o RCW extrai as informações de tipo dessa interface para fornecer uma melhor identidade de tipo.</span><span class="sxs-lookup"><span data-stu-id="e5f30-139">If the COM object being wrapped implements **IProvideClassInfo**, the RCW extracts the type information from this interface to provide better type identity.</span></span>|  
|<span data-ttu-id="e5f30-140">**IUnknown**</span><span class="sxs-lookup"><span data-stu-id="e5f30-140">**IUnknown**</span></span>|<span data-ttu-id="e5f30-141">Para gerenciamento do tempo de vida, coerção de tipo e identidade de objeto:</span><span class="sxs-lookup"><span data-stu-id="e5f30-141">For object identity, type coercion, and lifetime management:</span></span><br /><br /> <span data-ttu-id="e5f30-142">– Identidade de objeto</span><span class="sxs-lookup"><span data-stu-id="e5f30-142">-   Object identity</span></span><br />     <span data-ttu-id="e5f30-143">O tempo de execução faz distinção entre os objetos COM, comparando o valor da interface **IUnknown** para cada objeto.</span><span class="sxs-lookup"><span data-stu-id="e5f30-143">The runtime distinguishes between COM objects by comparing the value of the **IUnknown** interface for each object.</span></span><br /><span data-ttu-id="e5f30-144">– Coerção de tipo</span><span class="sxs-lookup"><span data-stu-id="e5f30-144">-   Type coercion</span></span><br />     <span data-ttu-id="e5f30-145">O RCW reconhece a descoberta de tipo dinâmico executada pelo método **QueryInterface**.</span><span class="sxs-lookup"><span data-stu-id="e5f30-145">The RCW recognizes the dynamic type discovery performed by the **QueryInterface** method.</span></span><br /><span data-ttu-id="e5f30-146">– Gerenciamento do tempo de vida</span><span class="sxs-lookup"><span data-stu-id="e5f30-146">-   Lifetime management</span></span><br />     <span data-ttu-id="e5f30-147">Usando o **QueryInterface** método RCW obtém e mantém uma referência a um objeto não gerenciado até o tempo de execução executar a coleta de lixo no wrapper, que libera o objeto não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="e5f30-147">Using the **QueryInterface** method, the RCW gets and holds a reference to an unmanaged object until the runtime performs garbage collection on the wrapper, which releases the unmanaged object.</span></span>|  
  
 <span data-ttu-id="e5f30-148">O RCW, opcionalmente, consome as interfaces listadas na tabela a seguir, as quais são expostas pelo objeto que ele encapsula.</span><span class="sxs-lookup"><span data-stu-id="e5f30-148">The RCW optionally consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="e5f30-149">Interface</span><span class="sxs-lookup"><span data-stu-id="e5f30-149">Interface</span></span>|<span data-ttu-id="e5f30-150">Descrição</span><span class="sxs-lookup"><span data-stu-id="e5f30-150">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="e5f30-151">**IConnectionPoint** e **IConnectionPointContainer**</span><span class="sxs-lookup"><span data-stu-id="e5f30-151">**IConnectionPoint** and **IConnectionPointContainer**</span></span>|<span data-ttu-id="e5f30-152">O RCW converte objetos que expõem o estilo do evento de ponto de conexão para eventos com base em delegado.</span><span class="sxs-lookup"><span data-stu-id="e5f30-152">The RCW converts objects that expose the connection-point event style to delegate-based events.</span></span>|  
|<span data-ttu-id="e5f30-153">**IDispatchEx**</span><span class="sxs-lookup"><span data-stu-id="e5f30-153">**IDispatchEx**</span></span>|<span data-ttu-id="e5f30-154">Se a classe implementa **IDispatchEx**, o RCW implementa **IExpando**.</span><span class="sxs-lookup"><span data-stu-id="e5f30-154">If the class implements **IDispatchEx**, the RCW implements **IExpando**.</span></span> <span data-ttu-id="e5f30-155">A interface **IDispatchEx** é uma extensão da interface **IDispatch** que, ao contrário de **IDispatch**, permite a enumeração, adição, exclusão e chamada de membros que diferencia maiúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="e5f30-155">The **IDispatchEx** interface is an extension of the **IDispatch** interface that, unlike **IDispatch**, enables enumeration, addition, deletion, and case-sensitive calling of members.</span></span>|  
|<span data-ttu-id="e5f30-156">**IEnumVARIANT**</span><span class="sxs-lookup"><span data-stu-id="e5f30-156">**IEnumVARIANT**</span></span>|<span data-ttu-id="e5f30-157">Permite que os tipos COM que dão suporte a enumerações sejam tratados como coleções.</span><span class="sxs-lookup"><span data-stu-id="e5f30-157">Enables COM types that support enumerations to be treated as collections.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e5f30-158">Consulte também</span><span class="sxs-lookup"><span data-stu-id="e5f30-158">See Also</span></span>  
 [<span data-ttu-id="e5f30-159">Wrappers COM</span><span class="sxs-lookup"><span data-stu-id="e5f30-159">COM Wrappers</span></span>](../../../docs/framework/interop/com-wrappers.md)  
 [<span data-ttu-id="e5f30-160">Marshaling de Interfaces selecionadas</span><span class="sxs-lookup"><span data-stu-id="e5f30-160">Marshaling Selected Interfaces</span></span>](http://msdn.microsoft.com/library/fdb97fd0-f694-4832-bf15-a4e7cf413840)  
 [<span data-ttu-id="e5f30-161">COM Callable Wrapper</span><span class="sxs-lookup"><span data-stu-id="e5f30-161">COM Callable Wrapper</span></span>](../../../docs/framework/interop/com-callable-wrapper.md)  
 [<span data-ttu-id="e5f30-162">Resumo da conversão de bibliotecas de tipos em assemblies</span><span class="sxs-lookup"><span data-stu-id="e5f30-162">Type Library to Assembly Conversion Summary</span></span>](http://msdn.microsoft.com/library/bf3f90c5-4770-4ab8-895c-3ba1055cc958)  
 [<span data-ttu-id="e5f30-163">Importando uma biblioteca de tipos como um assembly</span><span class="sxs-lookup"><span data-stu-id="e5f30-163">Importing a Type Library as an Assembly</span></span>](../../../docs/framework/interop/importing-a-type-library-as-an-assembly.md)
