---
title: Programação em SQL Server e atributos de proteção de host
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
author: mairaw
ms.author: mairaw
ms.openlocfilehash: f1049187dabbea64599617bb4372ed50515a51e3
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59088713"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>Programação em SQL Server e atributos de proteção de host
A capacidade de carregar e executar um código gerenciado em um host do SQL Server exige que os requisitos do host referentes à segurança de acesso do código e à proteção de recursos do host sejam atendidos.  Os requisitos de segurança de acesso do código são especificados por um dos três conjuntos de permissões do SQL Server: SAFE, EXTERNAL-ACCESS ou UNSAFE. O código em execução nos conjuntos de permissões SAFE ou EXTERNAL-ACCESS devem evitar determinados tipos ou membros que têm o atributo <xref:System.Security.Permissions.HostProtectionAttribute> aplicado. O <xref:System.Security.Permissions.HostProtectionAttribute> não é uma permissão de segurança como uma garantia de confiabilidade, pois ele identifica constructos de código específicos, sejam tipos ou métodos, que o host pode não permitir.  O uso do <xref:System.Security.Permissions.HostProtectionAttribute> impõe um modelo de programação que ajuda a proteger a estabilidade do host.  
  
## <a name="host-protection-attributes"></a>Atributos de proteção do host  
 Os atributos de proteção do host identificam tipos ou membros que não se ajustam ao modelo de programação do host e representam os seguintes níveis cada vez maiores de ameaça à confiabilidade:  
  
-   Caso contrário, eles são benignos.  
  
-   Pode levar à desestabilização do código do usuário gerenciado pelo servidor.  
  
-   Pode levar à desestabilização do próprio processo do servidor.  
  
 O SQL Server não permite o uso de um tipo ou membro que tem um <xref:System.Security.Permissions.HostProtectionAttribute> que especifica um valor <xref:System.Security.Permissions.HostProtectionResource> igual a <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> ou <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. Isso impede que os assemblies chamem membros que permitem o compartilhamento do estado, executam a sincronização, podem causar uma perda de recursos após o término ou afetam a integridade do processo do SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Tipos e membros não permitidos  
 A tabela a seguir identifica os tipos e membros cujos valores <xref:System.Security.Permissions.HostProtectionResource> não são permitidos pelo SQL Server.  
  
|Namespace|Tipo ou membro|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> classe<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> classe<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.SystemEvents> classe<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> delegado<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> classe|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> method|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> classe<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> delegado<br /><br /> <xref:System.ComponentModel.ArrayConverter> classe<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> classe<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.AsyncOperation> classe<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> classe<br /><br /> <xref:System.ComponentModel.AttributeCollection> classe<br /><br /> <xref:System.ComponentModel.BackgroundWorker> classe<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> classe<br /><br /> <xref:System.ComponentModel.BindingList%601> classe<br /><br /> <xref:System.ComponentModel.BooleanConverter> classe<br /><br /> <xref:System.ComponentModel.ByteConverter> classe<br /><br /> <xref:System.ComponentModel.CancelEventArgs> classe<br /><br /> <xref:System.ComponentModel.CancelEventHandler> delegado<br /><br /> <xref:System.ComponentModel.CharConverter> classe<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> classe<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> delegado<br /><br /> <xref:System.ComponentModel.CollectionConverter> classe<br /><br /> <xref:System.ComponentModel.ComponentCollection> classe<br /><br /> <xref:System.ComponentModel.ComponentConverter> classe<br /><br /> <xref:System.ComponentModel.ComponentEditor> classe<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> classe<br /><br /> <xref:System.ComponentModel.Container> classe<br /><br /> <xref:System.ComponentModel.ContainerFilterService> classe<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> classe<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> classe<br /><br /> <xref:System.ComponentModel.DateTimeConverter> classe<br /><br /> <xref:System.ComponentModel.DecimalConverter> classe<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> classe<br /><br /> <xref:System.ComponentModel.Design.CommandID> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> classe<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> classe<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> classe<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> delegado<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> classe<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> classe<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> delegado<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> classe<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> classe<br /><br /> <xref:System.ComponentModel.DoubleConverter> classe<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> classe<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> delegado<br /><br /> <xref:System.ComponentModel.EnumConverter> classe<br /><br /> <xref:System.ComponentModel.EventDescriptor> classe<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> classe<br /><br /> <xref:System.ComponentModel.EventHandlerList> classe<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> classe<br /><br /> <xref:System.ComponentModel.HandledEventArgs> classe<br /><br /> <xref:System.ComponentModel.HandledEventHandler> delegado<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> classe<br /><br /> <xref:System.ComponentModel.Int16Converter> classe<br /><br /> <xref:System.ComponentModel.Int32Converter> classe<br /><br /> <xref:System.ComponentModel.Int64Converter> classe<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> classe<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> classe<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> method<br /><br /> <xref:System.ComponentModel.License> classe<br /><br /> <xref:System.ComponentModel.LicenseContext> classe<br /><br /> <xref:System.ComponentModel.LicenseException> classe<br /><br /> <xref:System.ComponentModel.LicenseManager> classe<br /><br /> <xref:System.ComponentModel.LicenseProvider> classe<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> classe<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.ListSortDescription> classe<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> classe<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> classe<br /><br /> <xref:System.ComponentModel.MemberDescriptor> classe<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> classe<br /><br /> <xref:System.ComponentModel.NestedContainer> classe<br /><br /> <xref:System.ComponentModel.NullableConverter> classe<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> classe<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> classe<br /><br /> <xref:System.ComponentModel.ReferenceConverter> classe<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> classe<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> delegado<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> classe<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> delegado<br /><br /> <xref:System.ComponentModel.SByteConverter> classe<br /><br /> <xref:System.ComponentModel.SingleConverter> classe<br /><br /> <xref:System.ComponentModel.StringConverter> classe<br /><br /> <xref:System.ComponentModel.SyntaxCheck> classe<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> classe<br /><br /> <xref:System.ComponentModel.TypeConverter> classe<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> classe<br /><br /> <xref:System.ComponentModel.TypeDescriptor> classe<br /><br /> <xref:System.ComponentModel.TypeListConverter> classe<br /><br /> <xref:System.ComponentModel.UInt16Converter> classe<br /><br /> <xref:System.ComponentModel.UInt32Converter> classe<br /><br /> <xref:System.ComponentModel.UInt64Converter> classe<br /><br /> <xref:System.ComponentModel.WarningException> classe<br /><br /> <xref:System.ComponentModel.Win32Exception> classe|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> propriedade<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> propriedade<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> propriedade<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> classe<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> classe<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> classe<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> classe<br /><br /> <xref:System.Diagnostics.PerformanceCounter> classe<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> classe<br /><br /> <xref:System.Diagnostics.Process> classe<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> classe<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> classe<br /><br /> <xref:System.Diagnostics.TraceListener> classe<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> classe<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> propriedade|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> method|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> classe<br /><br /> <xref:System.Reflection.Emit.EventBuilder> classe<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> classe<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> classe<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> classe<br /><br /> <xref:System.Reflection.Emit.MethodRental> classe<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> classe<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> classe<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> classe<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> classe|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> method|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> classe<br /><br /> <xref:System.Threading.EventWaitHandle> classe<br /><br /> <xref:System.Threading.ManualResetEvent> classe<br /><br /> <xref:System.Threading.Monitor> classe<br /><br /> <xref:System.Threading.Mutex> classe<br /><br /> <xref:System.Threading.ReaderWriterLock> classe<br /><br /> <xref:System.Threading.Semaphore> classe<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.ThreadPool> classe<br /><br /> <xref:System.Threading.Timer> classe|  
|`System.Timers`|<xref:System.Timers.Timer> classe|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> classe|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> propriedade|  
  
## <a name="sql-server-permission-sets"></a>Conjuntos de permissões do SQL Server  
 O SQL Server permite aos usuários especificar os requisitos de confiabilidade do código implantado em um banco de dados. Quando os assemblies são carregados no banco de dados, o autor do assembly pode especificar um dos três conjuntos de permissões para esse assembly: SAFE, EXTERNAL-ACCESS ou UNSAFE.  
  
|Conjunto de permissões|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Segurança de acesso do código|Somente execução|Execução + acesso a recursos externos|Irrestrito|  
|Restrições do modelo de programação|Sim|Sim|Sem restrições|  
|Requisito de capacidade de verificação|Sim|Sim|Não|  
|Capacidade de chamar um código nativo|Não|Não|Sim|  
  
 SAFE é o modo mais confiável e seguro com restrições associadas no que diz respeito ao modelo de programação permitido. O código SAFE tem recursos de alta confiabilidade e segurança. Os assemblies SAFE recebem permissões suficientes para serem executados, fazer cálculos e ter acesso ao banco de dados local. Os assemblies SAFE precisam ser fortemente tipados verificáveis e não têm permissão para chamar um código não gerenciado.  
  
 EXTERNAL-ACCESS fornece uma opção de segurança intermediária, permitindo que o código acesse recursos externos ao banco de dados, mas ainda tenha a confiabilidade e a segurança de SAFE.  
  
 UNSAFE é indicado para códigos altamente confiáveis que podem ser criados somente por administradores de banco de dados. Esses códigos confiáveis não têm nenhuma restrição de acesso do código e podem chamar um código não gerenciado (nativo).  
  
 O SQL Server usa a camada da política de segurança de acesso do código em nível de host para configurar uma política de host que concede um dos três conjuntos de permissões, com base no conjunto de permissões armazenado nos catálogos do SQL Server. O código gerenciado executado no banco de dados sempre obtém um desses conjuntos de permissões de acesso do código.  
  
## <a name="programming-model-restrictions"></a>Restrições do Modelo de Programação  
 O modelo de programação de código gerenciado no SQL Server exige funções, procedimentos e tipos que não exigem que o uso do estado seja mantido em várias invocações nem exigem o compartilhamento do estado entre várias sessões do usuário. Além disso, conforme descrito anteriormente, a presença do estado compartilhado pode causar exceções críticas que afetam a escalabilidade e a confiabilidade do aplicativo.  
  
 Com base nessas considerações, o SQL Server não permite o uso de variáveis estáticas e membros de dados estáticos. Para assemblies SAFE e EXTERNAL-ACCESS, o SQL Server examina os metadados do assembly em tempo CREATE ASSEMBLY e falha a criação desses assemblies se encontra o uso de variáveis e membros de dados estáticos.  
  
## <a name="see-also"></a>Consulte também

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
