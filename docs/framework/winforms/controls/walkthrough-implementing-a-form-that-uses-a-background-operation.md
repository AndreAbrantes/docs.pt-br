---
title: 'Passo a passo: Implementando um formulário que usa uma operação em segundo plano'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- threading [Windows Forms], forms
- BackgroundWorker component
- background tasks
- forms [Windows Forms], multithreading
- threading [Windows Forms], walkthroughs
- forms [Windows Forms], background operations
- threading [Windows Forms], background operations
- background operations
ms.assetid: 4691b796-9200-471a-89c3-ba4c7cc78c03
ms.openlocfilehash: 6399fb853162174895d892399fd3eb5226101515
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61792191"
---
# <a name="walkthrough-implementing-a-form-that-uses-a-background-operation"></a><span data-ttu-id="b827f-102">Passo a passo: Implementando um formulário que usa uma operação em segundo plano</span><span class="sxs-lookup"><span data-stu-id="b827f-102">Walkthrough: Implementing a Form That Uses a Background Operation</span></span>
<span data-ttu-id="b827f-103">Se você tiver uma operação que levará muito tempo para ser concluída, e não desejar sua interface do usuário (UI) para parar de responder ou "parada", você pode usar o <xref:System.ComponentModel.BackgroundWorker> classe para executar a operação em outro thread.</span><span class="sxs-lookup"><span data-stu-id="b827f-103">If you have an operation that will take a long time to complete, and you do not want your user interface (UI) to stop responding or "hang," you can use the <xref:System.ComponentModel.BackgroundWorker> class to execute the operation on another thread.</span></span>  
  
 <span data-ttu-id="b827f-104">Este passo a passo ilustra como usar o <xref:System.ComponentModel.BackgroundWorker> classe para executar cálculos demorados em "em"segundo plano, enquanto a interface do usuário permanece responsiva.</span><span class="sxs-lookup"><span data-stu-id="b827f-104">This walkthrough illustrates how to use the <xref:System.ComponentModel.BackgroundWorker> class to perform time-consuming computations "in the background," while the user interface remains responsive.</span></span>  <span data-ttu-id="b827f-105">Quando terminar, você terá um aplicativo que calcula números de Fibonacci de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="b827f-105">When you are through, you will have an application that computes Fibonacci numbers asynchronously.</span></span> <span data-ttu-id="b827f-106">Embora o cálculo de um número de Fibonacci grande possa levar um tempo considerável, o thread de interface do usuário principal não será interrompido por esse atraso e o formulário será responsivo durante o cálculo.</span><span class="sxs-lookup"><span data-stu-id="b827f-106">Even though computing a large Fibonacci number can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculation.</span></span>  
  
 <span data-ttu-id="b827f-107">As tarefas ilustradas neste passo a passo incluem:</span><span class="sxs-lookup"><span data-stu-id="b827f-107">Tasks illustrated in this walkthrough include:</span></span>  
  
- <span data-ttu-id="b827f-108">Criando um aplicativo baseado no Windows</span><span class="sxs-lookup"><span data-stu-id="b827f-108">Creating a Windows-based Application</span></span>  
  
- <span data-ttu-id="b827f-109">Criando um <xref:System.ComponentModel.BackgroundWorker> no seu formulário</span><span class="sxs-lookup"><span data-stu-id="b827f-109">Creating a <xref:System.ComponentModel.BackgroundWorker> in Your Form</span></span>  
  
- <span data-ttu-id="b827f-110">Adição de manipuladores de evento assíncrono</span><span class="sxs-lookup"><span data-stu-id="b827f-110">Adding Asynchronous Event Handlers</span></span>  
  
- <span data-ttu-id="b827f-111">Adicionando relatórios de progresso e suporte a cancelamento</span><span class="sxs-lookup"><span data-stu-id="b827f-111">Adding Progress Reporting and Support for Cancellation</span></span>  
  
 <span data-ttu-id="b827f-112">Para obter uma listagem completa do código usado neste exemplo, consulte [como: Implementar um formulário que usa uma operação em segundo plano](how-to-implement-a-form-that-uses-a-background-operation.md).</span><span class="sxs-lookup"><span data-stu-id="b827f-112">For a complete listing of the code used in this example, see [How to: Implement a Form That Uses a Background Operation](how-to-implement-a-form-that-uses-a-background-operation.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b827f-113">As caixas de diálogo e os comandos de menu que você vê podem ser diferentes dos descritos na Ajuda, dependendo da sua edição ou das configurações ativas.</span><span class="sxs-lookup"><span data-stu-id="b827f-113">The dialog boxes and menu commands you see might differ from those described in Help depending on your active settings or edition.</span></span> <span data-ttu-id="b827f-114">Para alterar as configurações, escolha **Importar e Exportar Configurações** no menu **Ferramentas**.</span><span class="sxs-lookup"><span data-stu-id="b827f-114">To change your settings, choose **Import and Export Settings** on the **Tools** menu.</span></span> <span data-ttu-id="b827f-115">Para obter mais informações, confira [Personalizar o IDE do Visual Studio](/visualstudio/ide/personalizing-the-visual-studio-ide).</span><span class="sxs-lookup"><span data-stu-id="b827f-115">For more information, see [Personalize the Visual Studio IDE](/visualstudio/ide/personalizing-the-visual-studio-ide).</span></span>  
  
## <a name="creating-the-project"></a><span data-ttu-id="b827f-116">Criando o Projeto</span><span class="sxs-lookup"><span data-stu-id="b827f-116">Creating the Project</span></span>  
 <span data-ttu-id="b827f-117">A primeira etapa é criar o projeto e configurar o formulário.</span><span class="sxs-lookup"><span data-stu-id="b827f-117">The first step is to create the project and to set up the form.</span></span>  
  
#### <a name="to-create-a-form-that-uses-a-background-operation"></a><span data-ttu-id="b827f-118">Como criar um formulário que usa uma operação em segundo plano</span><span class="sxs-lookup"><span data-stu-id="b827f-118">To create a form that uses a background operation</span></span>  
  
1. <span data-ttu-id="b827f-119">Crie um projeto de aplicativo baseado no Windows chamado `BackgroundWorkerExample` (**arquivo** > **New** > **projeto**  >  **Visual c#** ou **Visual Basic** > **área de trabalho clássica** > **aplicativo de formulários do Windows**).</span><span class="sxs-lookup"><span data-stu-id="b827f-119">Create a Windows-based application project called `BackgroundWorkerExample` (**File** > **New** > **Project** > **Visual C#** or **Visual Basic** > **Classic Desktop** > **Windows Forms Application**).</span></span>  
  
2. <span data-ttu-id="b827f-120">No **Gerenciador de Soluções**, clique com o botão direito do mouse em **Form1** e escolha **Renomear** no menu de atalho.</span><span class="sxs-lookup"><span data-stu-id="b827f-120">In **Solution Explorer**, right-click **Form1** and select **Rename** from the shortcut menu.</span></span> <span data-ttu-id="b827f-121">Altere o nome de arquivo para `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="b827f-121">Change the file name to `FibonacciCalculator`.</span></span> <span data-ttu-id="b827f-122">Clique no botão **Sim** quando solicitado se desejar renomear todas as referências ao elemento de código '`Form1`'.</span><span class="sxs-lookup"><span data-stu-id="b827f-122">Click the **Yes** button when you are asked if you want to rename all references to the code element '`Form1`'.</span></span>  
  
3. <span data-ttu-id="b827f-123">Arraste uma <xref:System.Windows.Forms.NumericUpDown> controlar do **caixa de ferramentas** para o formulário.</span><span class="sxs-lookup"><span data-stu-id="b827f-123">Drag a <xref:System.Windows.Forms.NumericUpDown> control from the **Toolbox** onto the form.</span></span> <span data-ttu-id="b827f-124">Definir a <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> propriedade para `1` e o <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> propriedade `91`.</span><span class="sxs-lookup"><span data-stu-id="b827f-124">Set the <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> property to `1` and the <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> property to `91`.</span></span>  
  
4. <span data-ttu-id="b827f-125">Adicione dois <xref:System.Windows.Forms.Button> controles ao formulário.</span><span class="sxs-lookup"><span data-stu-id="b827f-125">Add two <xref:System.Windows.Forms.Button> controls to the form.</span></span>  
  
5. <span data-ttu-id="b827f-126">Renomeie o primeiro <xref:System.Windows.Forms.Button> controle `startAsyncButton` e defina as <xref:System.Windows.Forms.Control.Text%2A> propriedade `Start Async`.</span><span class="sxs-lookup"><span data-stu-id="b827f-126">Rename the first <xref:System.Windows.Forms.Button> control `startAsyncButton` and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Start Async`.</span></span> <span data-ttu-id="b827f-127">Renomeie o segundo <xref:System.Windows.Forms.Button> controle `cancelAsyncButton`e defina as <xref:System.Windows.Forms.Control.Text%2A> propriedade `Cancel Async`.</span><span class="sxs-lookup"><span data-stu-id="b827f-127">Rename the second <xref:System.Windows.Forms.Button> control `cancelAsyncButton`, and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Cancel Async`.</span></span> <span data-ttu-id="b827f-128">Defina suas <xref:System.Windows.Forms.Control.Enabled%2A> propriedade para `false`.</span><span class="sxs-lookup"><span data-stu-id="b827f-128">Set its <xref:System.Windows.Forms.Control.Enabled%2A> property to `false`.</span></span>  
  
6. <span data-ttu-id="b827f-129">Criar um manipulador de eventos para ambos os <xref:System.Windows.Forms.Button> dos controles <xref:System.Windows.Forms.Control.Click> eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-129">Create an event handler for both of the <xref:System.Windows.Forms.Button> controls' <xref:System.Windows.Forms.Control.Click> events.</span></span> <span data-ttu-id="b827f-130">Para obter detalhes, confira [Como: Criar manipuladores de eventos usando o Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="b827f-130">For details, see [How to: Create Event Handlers Using the Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span></span>  
  
7. <span data-ttu-id="b827f-131">Arraste uma <xref:System.Windows.Forms.Label> controlar do **caixa de ferramentas** para o formulário e renomeie- `resultLabel`.</span><span class="sxs-lookup"><span data-stu-id="b827f-131">Drag a <xref:System.Windows.Forms.Label> control from the **Toolbox** onto the form and rename it `resultLabel`.</span></span>  
  
8. <span data-ttu-id="b827f-132">Arraste uma <xref:System.Windows.Forms.ProgressBar> controlar do **caixa de ferramentas** para o formulário.</span><span class="sxs-lookup"><span data-stu-id="b827f-132">Drag a <xref:System.Windows.Forms.ProgressBar> control from the **Toolbox** onto the form.</span></span>  
  
## <a name="creating-a-backgroundworker-in-your-form"></a><span data-ttu-id="b827f-133">Usando um BackgroundWorker no seu formulário</span><span class="sxs-lookup"><span data-stu-id="b827f-133">Creating a BackgroundWorker in Your Form</span></span>  
 <span data-ttu-id="b827f-134">Você pode criar o <xref:System.ComponentModel.BackgroundWorker> para sua operação assíncrona usando o **Windows** **Designer de formulários**.</span><span class="sxs-lookup"><span data-stu-id="b827f-134">You can create the <xref:System.ComponentModel.BackgroundWorker> for your asynchronous operation using the **Windows** **Forms Designer**.</span></span>  
  
#### <a name="to-create-a-backgroundworker-with-the-designer"></a><span data-ttu-id="b827f-135">Como criar um BackgroundWorker com o Designer</span><span class="sxs-lookup"><span data-stu-id="b827f-135">To create a BackgroundWorker with the Designer</span></span>  
  
- <span data-ttu-id="b827f-136">Dos **componentes** guia da **caixa de ferramentas**, arraste um <xref:System.ComponentModel.BackgroundWorker> para o formulário.</span><span class="sxs-lookup"><span data-stu-id="b827f-136">From the **Components** tab of the **Toolbox**, drag a <xref:System.ComponentModel.BackgroundWorker> onto the form.</span></span>  
  
## <a name="adding-asynchronous-event-handlers"></a><span data-ttu-id="b827f-137">Adição de manipuladores de evento assíncrono</span><span class="sxs-lookup"><span data-stu-id="b827f-137">Adding Asynchronous Event Handlers</span></span>  
 <span data-ttu-id="b827f-138">Agora você está pronto para adicionar manipuladores de eventos para o <xref:System.ComponentModel.BackgroundWorker> eventos assíncronos do componente.</span><span class="sxs-lookup"><span data-stu-id="b827f-138">You are now ready to add event handlers for the <xref:System.ComponentModel.BackgroundWorker> component's asynchronous events.</span></span> <span data-ttu-id="b827f-139">A operação demorada que será executada em segundo plano, que calcula os números de Fibonacci, é chamada por um desses manipuladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-139">The time-consuming operation that will run in the background, which computes Fibonacci numbers, is called by one of these event handlers.</span></span>  
  
#### <a name="to-implement-asynchronous-event-handlers"></a><span data-ttu-id="b827f-140">Como implementar manipuladores de evento assíncrono</span><span class="sxs-lookup"><span data-stu-id="b827f-140">To implement asynchronous event handlers</span></span>  
  
1. <span data-ttu-id="b827f-141">No **propriedades** janela, com o <xref:System.ComponentModel.BackgroundWorker> componente ainda selecionado, clique no **eventos** botão.</span><span class="sxs-lookup"><span data-stu-id="b827f-141">In the **Properties** window, with the <xref:System.ComponentModel.BackgroundWorker> component still selected, click the **Events** button.</span></span> <span data-ttu-id="b827f-142">Clique duas vezes o <xref:System.ComponentModel.BackgroundWorker.DoWork> e <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> eventos para criar manipuladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-142">Double-click the <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> events to create event handlers.</span></span> <span data-ttu-id="b827f-143">Para obter mais informações sobre como usar manipuladores de eventos, consulte [como: Criar manipuladores de eventos usando o Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="b827f-143">For more information about how to use event handlers, see [How to: Create Event Handlers Using the Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span></span>  
  
2. <span data-ttu-id="b827f-144">Crie um novo método, chamado `ComputeFibonacci`, no formulário.</span><span class="sxs-lookup"><span data-stu-id="b827f-144">Create a new method, called `ComputeFibonacci`, in your form.</span></span> <span data-ttu-id="b827f-145">Esse método faz o trabalho real e ele será executado em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="b827f-145">This method does the actual work, and it will run in the background.</span></span> <span data-ttu-id="b827f-146">Esse código demonstra a implementação recursiva do algoritmo de Fibonacci, que é notavelmente ineficiente, demorando mais tempo para concluir o cálculo de números maiores.</span><span class="sxs-lookup"><span data-stu-id="b827f-146">This code demonstrates the recursive implementation of the Fibonacci algorithm, which is notably inefficient, taking exponentially longer time to complete for larger numbers.</span></span> <span data-ttu-id="b827f-147">Ele é usado aqui para fins ilustrativos, para mostrar uma operação que pode introduzir longos atrasos em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b827f-147">It is used here for illustrative purposes, to show an operation that can introduce long delays in your application.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#10)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#10)]
     [!code-vb[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#10)]  
  
3. <span data-ttu-id="b827f-148">No <xref:System.ComponentModel.BackgroundWorker.DoWork> manipulador de eventos, adicione uma chamada para o `ComputeFibonacci` método.</span><span class="sxs-lookup"><span data-stu-id="b827f-148">In the <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler, add a call to the `ComputeFibonacci` method.</span></span> <span data-ttu-id="b827f-149">Leve o primeiro parâmetro `ComputeFibonacci` do <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> propriedade do <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b827f-149">Take the first parameter for `ComputeFibonacci` from the <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="b827f-150">O <xref:System.ComponentModel.BackgroundWorker> e <xref:System.ComponentModel.DoWorkEventArgs> parâmetros serão usados posteriormente para relatório de progresso e cancelamento de suporte.</span><span class="sxs-lookup"><span data-stu-id="b827f-150">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.ComponentModel.DoWorkEventArgs> parameters will be used later for progress reporting and cancellation support.</span></span> <span data-ttu-id="b827f-151">Atribua o valor de retorno `ComputeFibonacci` para o <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> propriedade do <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b827f-151">Assign the return value from `ComputeFibonacci` to the <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="b827f-152">Esse resultado estará disponível para o <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-152">This result will be available to the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="b827f-153">O <xref:System.ComponentModel.BackgroundWorker.DoWork> manipulador de eventos não faz referência a `backgroundWorker1` variável de instância diretamente, pois isso seria acoplar o manipulador de eventos para uma instância específica do <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="b827f-153">The <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler does not reference the `backgroundWorker1` instance variable directly, as this would couple this event handler to a specific instance of <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="b827f-154">Em vez disso, uma referência para o <xref:System.ComponentModel.BackgroundWorker> que gerou esse evento é recuperado do `sender` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="b827f-154">Instead, a reference to the <xref:System.ComponentModel.BackgroundWorker> that raised this event is recovered from the `sender` parameter.</span></span> <span data-ttu-id="b827f-155">Isso é importante quando o formulário hospeda mais de um <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="b827f-155">This is important when the form hosts more than one <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="b827f-156">Também é importante não manipular quaisquer objetos de interface do usuário no seu <xref:System.ComponentModel.BackgroundWorker.DoWork> manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-156">It is also important not to manipulate any user-interface objects in your <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler.</span></span> <span data-ttu-id="b827f-157">Em vez disso, se comunicar com a interface do usuário por meio de <xref:System.ComponentModel.BackgroundWorker> eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-157">Instead, communicate to the user interface through the <xref:System.ComponentModel.BackgroundWorker> events.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#5)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#5)]
     [!code-vb[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#5)]  
  
4. <span data-ttu-id="b827f-158">No `startAsyncButton` do controle <xref:System.Windows.Forms.Control.Click> manipulador de eventos, adicione o código que inicia a operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="b827f-158">In the `startAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that starts the asynchronous operation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#13)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#13)]
     [!code-vb[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#13)]  
  
5. <span data-ttu-id="b827f-159">No <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> manipulador de eventos, atribua o resultado do cálculo para o `resultLabel` controle.</span><span class="sxs-lookup"><span data-stu-id="b827f-159">In the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler, assign the result of the calculation to the `resultLabel` control.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#6)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#6)]
     [!code-vb[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#6)]  
  
## <a name="adding-progress-reporting-and-support-for-cancellation"></a><span data-ttu-id="b827f-160">Adicionando relatórios de progresso e suporte a cancelamento</span><span class="sxs-lookup"><span data-stu-id="b827f-160">Adding Progress Reporting and Support for Cancellation</span></span>  
 <span data-ttu-id="b827f-161">Para operações assíncronas que levarão um longo tempo, muitas vezes é desejável relatar o progresso ao usuário e permitir que o usuário cancele a operação.</span><span class="sxs-lookup"><span data-stu-id="b827f-161">For asynchronous operations that will take a long time, it is often desirable to report progress to the user and to allow the user to cancel the operation.</span></span> <span data-ttu-id="b827f-162">O <xref:System.ComponentModel.BackgroundWorker> classe fornece um evento que permite que você poste o progresso como sua receita de operação do plano de fundo.</span><span class="sxs-lookup"><span data-stu-id="b827f-162">The <xref:System.ComponentModel.BackgroundWorker> class provides an event that allows you to post progress as your background operation proceeds.</span></span> <span data-ttu-id="b827f-163">Ele também fornece um sinalizador que permite que seu código de trabalho detecte uma chamada para <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> e interrompa a mesmo.</span><span class="sxs-lookup"><span data-stu-id="b827f-163">It also provides a flag that allows your worker code to detect a call to <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> and interrupt itself.</span></span>  
  
#### <a name="to-implement-progress-reporting"></a><span data-ttu-id="b827f-164">Como implementar o relatório de progresso</span><span class="sxs-lookup"><span data-stu-id="b827f-164">To implement progress reporting</span></span>  
  
1. <span data-ttu-id="b827f-165">Na janela **Propriedades**, selecione `backgroundWorker1`.</span><span class="sxs-lookup"><span data-stu-id="b827f-165">In the **Properties**, window, select `backgroundWorker1`.</span></span> <span data-ttu-id="b827f-166">Defina as propriedades <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> e <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> como `true`.</span><span class="sxs-lookup"><span data-stu-id="b827f-166">Set the <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> and <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> properties to `true`.</span></span>  
  
2. <span data-ttu-id="b827f-167">Declare duas variáveis no formulário `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="b827f-167">Declare two variables in the `FibonacciCalculator` form.</span></span> <span data-ttu-id="b827f-168">Elas serão usadas para acompanhar o progresso.</span><span class="sxs-lookup"><span data-stu-id="b827f-168">These will be used to track progress.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#14)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#14)]
     [!code-vb[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#14)]  
  
3. <span data-ttu-id="b827f-169">Adicionar um manipulador de eventos para o <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> eventos.</span><span class="sxs-lookup"><span data-stu-id="b827f-169">Add an event handler for the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event.</span></span> <span data-ttu-id="b827f-170">No <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> manipulador de eventos, atualize o <xref:System.Windows.Forms.ProgressBar> com o <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> propriedade do <xref:System.ComponentModel.ProgressChangedEventArgs> parâmetro.</span><span class="sxs-lookup"><span data-stu-id="b827f-170">In the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event handler, update the <xref:System.Windows.Forms.ProgressBar> with the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> property of the <xref:System.ComponentModel.ProgressChangedEventArgs> parameter.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#7)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#7)]
     [!code-vb[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#7)]  
  
#### <a name="to-implement-support-for-cancellation"></a><span data-ttu-id="b827f-171">Como implementar o suporte ao cancelamento</span><span class="sxs-lookup"><span data-stu-id="b827f-171">To implement support for cancellation</span></span>  
  
1. <span data-ttu-id="b827f-172">No `cancelAsyncButton` do controle <xref:System.Windows.Forms.Control.Click> manipulador de eventos, adicione o código que cancela a operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="b827f-172">In the `cancelAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that cancels the asynchronous operation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#4)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#4)]
     [!code-vb[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#4)]  
  
2. <span data-ttu-id="b827f-173">Os fragmentos de código a seguir no relatório de método `ComputeFibonacci` progridem e dão suporte ao cancelamento.</span><span class="sxs-lookup"><span data-stu-id="b827f-173">The following code fragments in the `ComputeFibonacci` method report progress and support cancellation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#11)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#11)]
     [!code-vb[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#11)]  
    [!code-cpp[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#12)]
    [!code-csharp[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#12)]
    [!code-vb[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#12)]  
  
## <a name="checkpoint"></a><span data-ttu-id="b827f-174">Ponto de verificação</span><span class="sxs-lookup"><span data-stu-id="b827f-174">Checkpoint</span></span>  
 <span data-ttu-id="b827f-175">Neste ponto, você pode compilar e executar o aplicativo Calculadora Fibonacci.</span><span class="sxs-lookup"><span data-stu-id="b827f-175">At this point, you can compile and run the Fibonacci Calculator application.</span></span>  
  
#### <a name="to-test-your-project"></a><span data-ttu-id="b827f-176">Como testar o projeto</span><span class="sxs-lookup"><span data-stu-id="b827f-176">To test your project</span></span>  
  
- <span data-ttu-id="b827f-177">Pressione F5 para compilar e executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b827f-177">Press F5 to compile and run the application.</span></span>  
  
     <span data-ttu-id="b827f-178">Enquanto o cálculo é executado em segundo plano, você verá o <xref:System.Windows.Forms.ProgressBar> exibindo o progresso do cálculo até a conclusão.</span><span class="sxs-lookup"><span data-stu-id="b827f-178">While the calculation is running in the background, you will see the <xref:System.Windows.Forms.ProgressBar> displaying the progress of the calculation toward completion.</span></span> <span data-ttu-id="b827f-179">Você também pode cancelar a operação pendente.</span><span class="sxs-lookup"><span data-stu-id="b827f-179">You can also cancel the pending operation.</span></span>  
  
     <span data-ttu-id="b827f-180">Para números pequenos, o cálculo deve ser muito rápido, mas, para números maiores, você deve ver um atraso considerável.</span><span class="sxs-lookup"><span data-stu-id="b827f-180">For small numbers, the calculation should be very fast, but for larger numbers, you should see a noticeable delay.</span></span> <span data-ttu-id="b827f-181">Se inserir um valor de 30 ou mais, você deverá ver um atraso de alguns segundos, dependendo da velocidade do seu computador.</span><span class="sxs-lookup"><span data-stu-id="b827f-181">If you enter a value of 30 or greater, you should see a delay of several seconds, depending on the speed of your computer.</span></span> <span data-ttu-id="b827f-182">Para valores maiores que 40, poderá levar minutos ou horas para concluir o cálculo.</span><span class="sxs-lookup"><span data-stu-id="b827f-182">For values greater than 40, it may take minutes or hours to finish the calculation.</span></span> <span data-ttu-id="b827f-183">Enquanto a calculadora estiver ocupada calculando um número de Fibonacci grande, observe que você pode movimentar livremente o formulário, minimizar, maximizar e até mesmo descartá-lo.</span><span class="sxs-lookup"><span data-stu-id="b827f-183">While the calculator is busy computing a large Fibonacci number, notice that you can freely move the form around, minimize, maximize, and even dismiss it.</span></span> <span data-ttu-id="b827f-184">Isso ocorre porque o thread da interface do usuário principal não está aguardando concluir o cálculo.</span><span class="sxs-lookup"><span data-stu-id="b827f-184">This is because the main UI thread is not waiting for the calculation to finish.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="b827f-185">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b827f-185">Next Steps</span></span>  
 <span data-ttu-id="b827f-186">Agora que você implementou um formulário que usa um <xref:System.ComponentModel.BackgroundWorker> componente para executar um cálculo em segundo plano, você pode explorar outras possibilidades para operações assíncronas:</span><span class="sxs-lookup"><span data-stu-id="b827f-186">Now that you have implemented a form that uses a <xref:System.ComponentModel.BackgroundWorker> component to execute a computation in the background, you can explore other possibilities for asynchronous operations:</span></span>  
  
- <span data-ttu-id="b827f-187">Use várias <xref:System.ComponentModel.BackgroundWorker> objetos para várias operações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="b827f-187">Use multiple <xref:System.ComponentModel.BackgroundWorker> objects for several simultaneous operations.</span></span>  
  
- <span data-ttu-id="b827f-188">Para depurar seu aplicativo multi-threaded, consulte [como: Usar a janela Threads](/visualstudio/debugger/how-to-use-the-threads-window).</span><span class="sxs-lookup"><span data-stu-id="b827f-188">To debug your multithreaded application, see [How to: Use the Threads Window](/visualstudio/debugger/how-to-use-the-threads-window).</span></span>  
  
- <span data-ttu-id="b827f-189">Implemente seu próprio componente que dá suporte ao modelo de programação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="b827f-189">Implement your own component that supports the asynchronous programming model.</span></span> <span data-ttu-id="b827f-190">Para mais informações, consulte [Visão geral sobre o padrão assíncrono baseado em evento](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b827f-190">For more information, see [Event-based Asynchronous Pattern Overview](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="b827f-191">O uso de multithreading de qualquer tipo pode expor o computador a bugs muito sérios e complexos.</span><span class="sxs-lookup"><span data-stu-id="b827f-191">When using multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="b827f-192">Consulte as [Melhores práticas de threading gerenciado](../../../standard/threading/managed-threading-best-practices.md) antes de implementar qualquer solução que use multithreading.</span><span class="sxs-lookup"><span data-stu-id="b827f-192">Consult the [Managed Threading Best Practices](../../../standard/threading/managed-threading-best-practices.md) before implementing any solution that uses multithreading.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b827f-193">Consulte também</span><span class="sxs-lookup"><span data-stu-id="b827f-193">See also</span></span>

- <xref:System.ComponentModel.BackgroundWorker?displayProperty=nameWithType>
- [<span data-ttu-id="b827f-194">Threading gerenciado</span><span class="sxs-lookup"><span data-stu-id="b827f-194">Managed Threading</span></span>](../../../standard/threading/index.md)
- [<span data-ttu-id="b827f-195">Práticas recomendadas de threading gerenciado</span><span class="sxs-lookup"><span data-stu-id="b827f-195">Managed Threading Best Practices</span></span>](../../../standard/threading/managed-threading-best-practices.md)
- [<span data-ttu-id="b827f-196">Visão Geral do Padrão Assíncrono Baseado em Evento</span><span class="sxs-lookup"><span data-stu-id="b827f-196">Event-based Asynchronous Pattern Overview</span></span>](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)
- [<span data-ttu-id="b827f-197">Como: Implementar um formulário que usa uma operação em segundo plano</span><span class="sxs-lookup"><span data-stu-id="b827f-197">How to: Implement a Form That Uses a Background Operation</span></span>](how-to-implement-a-form-that-uses-a-background-operation.md)
- [<span data-ttu-id="b827f-198">Passo a passo: Executando uma operação em segundo plano</span><span class="sxs-lookup"><span data-stu-id="b827f-198">Walkthrough: Running an Operation in the Background</span></span>](walkthrough-running-an-operation-in-the-background.md)
- [<span data-ttu-id="b827f-199">Componente BackgroundWorker</span><span class="sxs-lookup"><span data-stu-id="b827f-199">BackgroundWorker Component</span></span>](backgroundworker-component.md)
