---
title: Arquitetura das configurações do aplicativo
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: dd527234b90e94b5883d15b336f5e5abc9709880
ms.sourcegitcommit: 160a88c8087b0e63606e6e35f9bd57fa5f69c168
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/09/2019
ms.locfileid: "57710674"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="8b879-102">Arquitetura das configurações do aplicativo</span><span class="sxs-lookup"><span data-stu-id="8b879-102">Application Settings Architecture</span></span>
<span data-ttu-id="8b879-103">Este tópico descreve como a arquitetura das configurações de aplicativo funciona e explora recursos avançados da arquitetura, como as configurações agrupadas e as chaves de configurações.</span><span class="sxs-lookup"><span data-stu-id="8b879-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>  
  
 <span data-ttu-id="8b879-104">A arquitetura das configurações de aplicativo dá suporte à configuração de configurações fortemente tipadas com escopo do aplicativo ou do usuário e a persistência das configurações entre as sessões do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8b879-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="8b879-105">A arquitetura oferece um mecanismo de persistência padrão para salvar as configurações e carregá-las do sistema de arquivos local.</span><span class="sxs-lookup"><span data-stu-id="8b879-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="8b879-106">A arquitetura também define interfaces para fornecer um mecanismo personalizado de persistência.</span><span class="sxs-lookup"><span data-stu-id="8b879-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>  
  
 <span data-ttu-id="8b879-107">As interfaces são fornecidas para permitir que componentes personalizados mantenham suas próprias configurações quando forem hospedados em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8b879-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="8b879-108">Ao usar chaves de configurações, os componentes podem manter separadas as configurações para várias instâncias do componente.</span><span class="sxs-lookup"><span data-stu-id="8b879-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>  
  
## <a name="defining-settings"></a><span data-ttu-id="8b879-109">configurando configurações</span><span class="sxs-lookup"><span data-stu-id="8b879-109">Defining Settings</span></span>  
 <span data-ttu-id="8b879-110">A arquitetura das configurações de aplicativo é usada tanto no [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] quanto nos Windows Forms e contém várias classes base que são compartilhadas entre os dois ambientes.</span><span class="sxs-lookup"><span data-stu-id="8b879-110">The application settings architecture is used within both [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="8b879-111">O mais importante é <xref:System.Configuration.SettingsBase>, que fornece acesso às configurações através de uma coleção e fornece métodos de baixo nível para carregar e salvar as configurações.</span><span class="sxs-lookup"><span data-stu-id="8b879-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="8b879-112">Cada ambiente implementa sua própria classe derivada de <xref:System.Configuration.SettingsBase> para fornecer a funcionalidade de configurações adicionais para esse ambiente.</span><span class="sxs-lookup"><span data-stu-id="8b879-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="8b879-113">Em um aplicativo baseado em Windows Forms, todas as configurações de aplicativo devem ser definidas em uma classe derivada de <xref:System.Configuration.ApplicationSettingsBase> classe, que adiciona a seguinte funcionalidade à classe base:</span><span class="sxs-lookup"><span data-stu-id="8b879-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>  
  
-   <span data-ttu-id="8b879-114">Operações de carregar e salvar de nível mais alto</span><span class="sxs-lookup"><span data-stu-id="8b879-114">Higher-level loading and saving operations</span></span>  
  
-   <span data-ttu-id="8b879-115">Suporte a configurações de escopo do usuário</span><span class="sxs-lookup"><span data-stu-id="8b879-115">Support for user-scoped settings</span></span>  
  
-   <span data-ttu-id="8b879-116">Reverter as configurações do usuário para os padrões predefinidos</span><span class="sxs-lookup"><span data-stu-id="8b879-116">Reverting a user's settings to the predefined defaults</span></span>  
  
-   <span data-ttu-id="8b879-117">Atualizar as configurações de uma versão anterior do aplicativo</span><span class="sxs-lookup"><span data-stu-id="8b879-117">Upgrading settings from a previous application version</span></span>  
  
-   <span data-ttu-id="8b879-118">Validar configurações, antes que sejam alteradas ou antes que sejam salvas</span><span class="sxs-lookup"><span data-stu-id="8b879-118">Validating settings, either before they are changed or before they are saved</span></span>  
  
 <span data-ttu-id="8b879-119">As configurações podem ser descritas usando um número de atributos definidos dentro de <xref:System.Configuration> namespace; elas são descritas nas [atributos de configurações do aplicativo](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="8b879-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="8b879-120">Quando você define uma configuração, você deverá aplicá-la com um <xref:System.Configuration.ApplicationScopedSettingAttribute> ou <xref:System.Configuration.UserScopedSettingAttribute>, que descreve se a configuração se aplica ao aplicativo inteiro ou apenas para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="8b879-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>  
  
 <span data-ttu-id="8b879-121">O exemplo de código a seguir define uma classe de configurações personalizadas com uma única configuração, `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="8b879-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>  
  
 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]  
  
## <a name="settings-persistence"></a><span data-ttu-id="8b879-122">Persistência das configurações</span><span class="sxs-lookup"><span data-stu-id="8b879-122">Settings Persistence</span></span>  
 <span data-ttu-id="8b879-123">O <xref:System.Configuration.ApplicationSettingsBase> classe não próprio persistir ou carregar configurações; este trabalho recai sobre o provedor de configurações, uma classe que deriva de <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="8b879-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="8b879-124">Se uma classe derivada de <xref:System.Configuration.ApplicationSettingsBase> não especifica um provedor de configurações por meio de <xref:System.Configuration.SettingsProviderAttribute>, em seguida, o provedor padrão, <xref:System.Configuration.LocalFileSettingsProvider>, é usado.</span><span class="sxs-lookup"><span data-stu-id="8b879-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>  
  
 <span data-ttu-id="8b879-125">O sistema de configuração, que foi originalmente lançado com o [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)], dá suporte ao fornecimento de dados de configuração estática do aplicativo por meio do arquivo machine.config do computador local ou em um arquivo `app.`exe.config que você implanta com seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8b879-125">The configuration system that was originally released with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="8b879-126">O <xref:System.Configuration.LocalFileSettingsProvider> classe expande esse suporte nativo das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="8b879-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>  
  
-   <span data-ttu-id="8b879-127">As configurações de escopo do aplicativo podem ser armazenadas nos arquivos machine.config ou `app.`exe.config.</span><span class="sxs-lookup"><span data-stu-id="8b879-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="8b879-128">O machine.config é sempre somente leitura, enquanto que o `app`.exe.config é restrito, por considerações de segurança, como somente leitura para a maioria dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="8b879-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>  
  
-   <span data-ttu-id="8b879-129">As configurações de escopo do usuário podem ser armazenadas em arquivos `app`.exe.config, caso em que são tratadas como padrões estáticos.</span><span class="sxs-lookup"><span data-stu-id="8b879-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>  
  
-   <span data-ttu-id="8b879-130">As configurações de escopo do usuário não padrão são armazenadas em um novo arquivo, *user*.config, em que *user* é o nome de usuário da pessoa que está executando o aplicativo no momento.</span><span class="sxs-lookup"><span data-stu-id="8b879-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="8b879-131">Você pode especificar um padrão para uma configuração de escopo do usuário com <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8b879-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="8b879-132">Como as configurações de escopo do usuário geralmente são alteradas durante a execução do aplicativo, o `user`.config é sempre de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="8b879-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>  
  
 <span data-ttu-id="8b879-133">Todos os três arquivos de configuração armazenam as configurações no formato XML.</span><span class="sxs-lookup"><span data-stu-id="8b879-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="8b879-134">O elemento XML de nível superior para configurações de escopo do aplicativo é `<appSettings>`, enquanto que o `<userSettings>` é usado para configurações de escopo do usuário.</span><span class="sxs-lookup"><span data-stu-id="8b879-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="8b879-135">Um arquivo `app`.exe.config que contém configurações de escopo do aplicativo e padrões para configurações de escopo do usuário teria esta aparência:</span><span class="sxs-lookup"><span data-stu-id="8b879-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>  
  
```xml  
<?xml version="1.0" encoding="utf-8" ?>  
<configuration>  
    <configSections>  
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />  
        </sectionGroup>  
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />  
        </sectionGroup>  
    </configSections>  
    <applicationSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="Cursor" serializeAs="String">  
                <value>Default</value>  
            </setting>  
            <setting name="DoubleBuffering" serializeAs="String">  
                <value>False</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </applicationSettings>  
    <userSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="FormTitle" serializeAs="String">  
                <value>Form1</value>  
            </setting>  
            <setting name="FormSize" serializeAs="String">  
                <value>595, 536</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </userSettings>  
</configuration>  
```  
  
 <span data-ttu-id="8b879-136">Para obter uma configuração dos elementos da seção de configurações de aplicativo de um arquivo de configuração, consulte [Esquema de configurações de aplicativo](../../configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="8b879-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>  
  
### <a name="settings-bindings"></a><span data-ttu-id="8b879-137">Associações de configurações</span><span class="sxs-lookup"><span data-stu-id="8b879-137">Settings Bindings</span></span>  
 <span data-ttu-id="8b879-138">As configurações de aplicativo usam a arquitetura de vinculação de dados dos Windows Forms para fornecer comunicação bidirecional das atualizações de configurações entre o objeto de configurações e os componentes.</span><span class="sxs-lookup"><span data-stu-id="8b879-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="8b879-139">Se você usar o Visual Studio para criar configurações de aplicativo e atribuí-las às propriedades do componente, essas associações serão geradas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="8b879-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>  
  
 <span data-ttu-id="8b879-140">Uma configuração de aplicativo só pode ser associado a um componente que dá suporte a <xref:System.Windows.Forms.IBindableComponent> interface.</span><span class="sxs-lookup"><span data-stu-id="8b879-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="8b879-141">Além disso, o componente deve implementar um evento de alteração para uma determinada propriedade associada ou notificar as configurações do aplicativo que a propriedade foi alterada por meio de <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span><span class="sxs-lookup"><span data-stu-id="8b879-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="8b879-142">Se o componente não implementar <xref:System.Windows.Forms.IBindableComponent> e você estiver associando através do Visual Studio, as propriedades associadas serão definidas na primeira vez, mas não serão atualizadas.</span><span class="sxs-lookup"><span data-stu-id="8b879-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="8b879-143">Se o componente implementa <xref:System.Windows.Forms.IBindableComponent> , mas as notificações de alteração não suporte à propriedade, a associação não será atualizado no arquivo de configurações quando a propriedade é alterada.</span><span class="sxs-lookup"><span data-stu-id="8b879-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>  
  
 <span data-ttu-id="8b879-144">Alguns componentes do Windows Forms, tal como <xref:System.Windows.Forms.ToolStripItem>, não dão suporte a associações de configurações.</span><span class="sxs-lookup"><span data-stu-id="8b879-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>  
  
### <a name="settings-serialization"></a><span data-ttu-id="8b879-145">Serialização de configurações</span><span class="sxs-lookup"><span data-stu-id="8b879-145">Settings Serialization</span></span>  
 <span data-ttu-id="8b879-146">Quando <xref:System.Configuration.LocalFileSettingsProvider> deve salvar as configurações em disco, ele executa as seguintes ações:</span><span class="sxs-lookup"><span data-stu-id="8b879-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>  
  
1.  <span data-ttu-id="8b879-147">Usa a reflexão para examinar todas as propriedades definidas no seu <xref:System.Configuration.ApplicationSettingsBase> derivado da classe, localizando aquelas que são aplicadas com um <xref:System.Configuration.ApplicationScopedSettingAttribute> ou <xref:System.Configuration.UserScopedSettingAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8b879-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>  
  
2.  <span data-ttu-id="8b879-148">Serializa a propriedade para o disco.</span><span class="sxs-lookup"><span data-stu-id="8b879-148">Serializes the property to disk.</span></span> <span data-ttu-id="8b879-149">Ela primeiro tenta chamar o <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> ou <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> sobre o tipo associado à <xref:System.ComponentModel.TypeConverter>.</span><span class="sxs-lookup"><span data-stu-id="8b879-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="8b879-150">Se isso não for bem-sucedido, ela usará a serialização de XML.</span><span class="sxs-lookup"><span data-stu-id="8b879-150">If this does not succeed, it uses XML serialization instead.</span></span>  
  
3.  <span data-ttu-id="8b879-151">Determina quais configurações vão em quais arquivos, com base no atributo da configuração.</span><span class="sxs-lookup"><span data-stu-id="8b879-151">Determines which settings go in which files, based on the setting's attribute.</span></span>  
  
 <span data-ttu-id="8b879-152">Se você implementar sua própria classe de configurações, você pode usar o <xref:System.Configuration.SettingsSerializeAsAttribute> para marcar uma configuração para a serialização binária ou personalizada usando o <xref:System.Configuration.SettingsSerializeAs> enumeração.</span><span class="sxs-lookup"><span data-stu-id="8b879-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="8b879-153">Para obter mais informações sobre como criar sua própria classe de configurações no código, consulte [como: Criar configurações de aplicativo](how-to-create-application-settings.md).</span><span class="sxs-lookup"><span data-stu-id="8b879-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>  
  
### <a name="settings-file-locations"></a><span data-ttu-id="8b879-154">Locais de arquivo de configurações</span><span class="sxs-lookup"><span data-stu-id="8b879-154">Settings File Locations</span></span>  
 <span data-ttu-id="8b879-155">O local dos arquivos `app`.exe.config e *user*.config serão diferentes com base em como o aplicativo é instalado.</span><span class="sxs-lookup"><span data-stu-id="8b879-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="8b879-156">Para um aplicativo baseado em Windows Forms copiado para o computador local, `app`. exe. config residirá no mesmo diretório que o diretório base do arquivo de executável principal do aplicativo, e *usuário*. config residirá no local especificado pelo <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> propriedade.</span><span class="sxs-lookup"><span data-stu-id="8b879-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="8b879-157">Para um aplicativo instalado por meio do [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], esses dois arquivos residirão no diretório de dados do [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], sob %InstallRoot%\Documents and Settings\\*nome de usuário*\Configurações Locais.</span><span class="sxs-lookup"><span data-stu-id="8b879-157">For an application installed by means of [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], both of these files will reside in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>  
  
 <span data-ttu-id="8b879-158">O local de armazenamento desses arquivos será um pouco diferente se um usuário tiver habilitado perfis móveis, que permite que um usuário defina diferentes configurações de aplicativo e do Windows quando estiver usando outros computadores em um domínio.</span><span class="sxs-lookup"><span data-stu-id="8b879-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="8b879-159">Nesse caso, os aplicativos [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] e aplicativos não [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] terão seus arquivos `app`.exe.config e *user*.config armazenados em %InstallRoot%\Documents and Settings\\*nome de usuário*\Dados de Aplicativos.</span><span class="sxs-lookup"><span data-stu-id="8b879-159">In that case, both [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications and non-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>  
  
 <span data-ttu-id="8b879-160">Para obter mais informações sobre como o recurso de configurações de aplicativo funciona com a nova tecnologia de implantação, consulte [ClickOnce e configurações de aplicativo](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="8b879-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="8b879-161">Para obter mais informações sobre o diretório de dados do [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], confira [Acessando dados locais e remotos em aplicativos ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="8b879-161">For more information about the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>  
  
## <a name="application-settings-and-security"></a><span data-ttu-id="8b879-162">Segurança e configurações de aplicativo</span><span class="sxs-lookup"><span data-stu-id="8b879-162">Application Settings and Security</span></span>  
 <span data-ttu-id="8b879-163">As configurações de aplicativo são projetadas para trabalhar em confiança parcial, um ambiente restrito que é o padrão para aplicativos dos Windows Forms hospedados na Internet ou intranet.</span><span class="sxs-lookup"><span data-stu-id="8b879-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="8b879-164">Não é necessária nenhuma permissão especial, além da confiança parcial, para usar as configurações de aplicativo com o provedor de configurações padrão.</span><span class="sxs-lookup"><span data-stu-id="8b879-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>  
  
 <span data-ttu-id="8b879-165">Quando as configurações de aplicativo são usadas em um aplicativo [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], o arquivo `user`.config é armazenado no diretório de dados do [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8b879-165">When application settings are used in a [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] application, the `user`.config file is stored in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] data directory.</span></span> <span data-ttu-id="8b879-166">O tamanho do arquivo `user`.config do aplicativo não pode exceder a cota do diretório de dados definida pelo [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8b879-166">The size of the application's `user`.config file cannot exceed the data directory quota set by [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span></span> <span data-ttu-id="8b879-167">Para obter mais informações, consulte [ClickOnce e as configurações de aplicativo](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="8b879-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>  
  
## <a name="custom-settings-providers"></a><span data-ttu-id="8b879-168">Provedores de configurações personalizadas</span><span class="sxs-lookup"><span data-stu-id="8b879-168">Custom Settings Providers</span></span>  
 <span data-ttu-id="8b879-169">Na arquitetura de configurações do aplicativo, há um acoplamento fraco entre as configurações de aplicativos classe wrapper, derivada de <xref:System.Configuration.ApplicationSettingsBase>, e o provedor de configurações associado ou provedores, derivados <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="8b879-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="8b879-170">Essa associação é definida apenas pelo <xref:System.Configuration.SettingsProviderAttribute> aplicado à classe wrapper ou suas propriedades individuais.</span><span class="sxs-lookup"><span data-stu-id="8b879-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="8b879-171">Se as configurações de um provedor não é explicitamente especificado, o provedor padrão, <xref:System.Configuration.LocalFileSettingsProvider>, é usado.</span><span class="sxs-lookup"><span data-stu-id="8b879-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="8b879-172">Como resultado, essa arquitetura dá suporte à criação e uso de provedores de configurações personalizados.</span><span class="sxs-lookup"><span data-stu-id="8b879-172">As a result, this architecture supports creating and using custom settings providers.</span></span>  
  
 <span data-ttu-id="8b879-173">Por exemplo, suponha que você queira desenvolver e usar o `SqlSettingsProvider`, um provedor que armazenará todos os dados de configurações em um banco de dados do Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8b879-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="8b879-174">Sua <xref:System.Configuration.SettingsProvider>-classe derivada deve receber essas informações no seu `Initialize` o método como um parâmetro de tipo <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="8b879-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="8b879-175">Em seguida, você poderia implementar o <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> método para recuperar as configurações de armazenamento de dados, e <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> para salvá-los.</span><span class="sxs-lookup"><span data-stu-id="8b879-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="8b879-176">O provedor pode usar o <xref:System.Configuration.SettingsPropertyCollection> fornecido para <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> para determinar o nome da propriedade, tipo e escopo, bem como quaisquer outros atributos de configurações definidos para essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="8b879-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>  
  
 <span data-ttu-id="8b879-177">Seu provedor precisará implementar uma propriedade e um método cujas implementações podem não ser óbvias.</span><span class="sxs-lookup"><span data-stu-id="8b879-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="8b879-178">O <xref:System.Configuration.SettingsProvider.ApplicationName%2A> é uma propriedade abstrata do <xref:System.Configuration.SettingsProvider>; você deve programá-lo para retornar o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8b879-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]  
  
 <span data-ttu-id="8b879-179">Sua classe derivada também deve implementar um método `Initialize` que não recebe argumentos e não retorna nenhum valor.</span><span class="sxs-lookup"><span data-stu-id="8b879-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="8b879-180">Esse método não é definido pelo <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="8b879-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>  
  
 <span data-ttu-id="8b879-181">Finalmente, você implementa <xref:System.Configuration.IApplicationSettingsProvider> no seu provedor para fornecer suporte para atualizar as configurações, revertendo as configurações para seus padrões e atualizar as configurações de uma versão do aplicativo para outro.</span><span class="sxs-lookup"><span data-stu-id="8b879-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>  
  
 <span data-ttu-id="8b879-182">Depois de ter implementado e compilado seu provedor, você precisa instruir a classe de configurações para usar este provedor em vez do padrão.</span><span class="sxs-lookup"><span data-stu-id="8b879-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="8b879-183">Você fazer isso por meio de <xref:System.Configuration.SettingsProviderAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8b879-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="8b879-184">Se aplicado a uma classe configurações inteira, o provedor é usado para cada configuração que define a classe; Se aplicado a configurações individuais, a arquitetura das configurações do aplicativo usa esse provedor para essas configurações somente e usa <xref:System.Configuration.LocalFileSettingsProvider> para o restante.</span><span class="sxs-lookup"><span data-stu-id="8b879-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="8b879-185">O exemplo de código a seguir mostra como instruir a classe de configurações para usar o provedor personalizado.</span><span class="sxs-lookup"><span data-stu-id="8b879-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]  
  
 <span data-ttu-id="8b879-186">Um provedor pode ser chamado simultaneamente de vários threads, mas ele sempre gravará no mesmo local de armazenamento. Portanto, a arquitetura das configurações de aplicativo somente instanciará uma única instância de sua classe de provedor.</span><span class="sxs-lookup"><span data-stu-id="8b879-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="8b879-187">Você deve garantir que seu provedor seja thread-safe e permita que apenas um thread por vez grave nos arquivos de configuração.</span><span class="sxs-lookup"><span data-stu-id="8b879-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>  
  
 <span data-ttu-id="8b879-188">Seu provedor não precisa dar suporte a todas as configurações de atributos definidos na <xref:System.Configuration?displayProperty=nameWithType> namespace, embora ele deva em um suporte mínimo <xref:System.Configuration.ApplicationScopedSettingAttribute> e <xref:System.Configuration.UserScopedSettingAttribute>e também deve dar suporte <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8b879-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="8b879-189">Para os atributos aos quais ele não oferece suporte, o provedor deve apenas falhar, sem notificação. Ele não deve lançar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="8b879-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="8b879-190">Se a classe de configurações usa uma combinação inválida de atributos, no entanto, como a aplicação <xref:System.Configuration.ApplicationScopedSettingAttribute> e <xref:System.Configuration.UserScopedSettingAttribute> à mesma configuração — seu provedor deve lançar uma exceção e interromper a operação.</span><span class="sxs-lookup"><span data-stu-id="8b879-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8b879-191">Consulte também</span><span class="sxs-lookup"><span data-stu-id="8b879-191">See also</span></span>
- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="8b879-192">Visão Geral das Configurações do Aplicativo</span><span class="sxs-lookup"><span data-stu-id="8b879-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="8b879-193">Configurações do Aplicativo para Controles Personalizados</span><span class="sxs-lookup"><span data-stu-id="8b879-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="8b879-194">O ClickOnce e as configurações de aplicativo</span><span class="sxs-lookup"><span data-stu-id="8b879-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="8b879-195">Esquema de configurações de aplicativo</span><span class="sxs-lookup"><span data-stu-id="8b879-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
