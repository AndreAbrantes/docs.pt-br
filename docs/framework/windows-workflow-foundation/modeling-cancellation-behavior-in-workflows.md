---
title: Modelando o comportamento cancelar em fluxos de trabalho
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
caps.latest.revision: 11
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: e455bf4d74f77c6cd87301dc9a21f56117777ecf
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/30/2018
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="4027c-102">Modelando o comportamento cancelar em fluxos de trabalho</span><span class="sxs-lookup"><span data-stu-id="4027c-102">Modeling Cancellation Behavior in Workflows</span></span>
<span data-ttu-id="4027c-103">As atividades podem ser canceladas em um fluxo de trabalho, por exemplo por uma atividade de <xref:System.Activities.Statements.Parallel> que cancela ramificações incompletos quando seu <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> avalia a `true`, ou fora de fluxo de trabalho, se o host chama <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="4027c-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="4027c-104">Para fornecer tratamento cancelar, os autores de fluxo de trabalho podem usar a atividade de <xref:System.Activities.Statements.CancellationScope> , a atividade de <xref:System.Activities.Statements.CompensableActivity> , ou crie as atividades personalizados que fornecem lógica cancelar.</span><span class="sxs-lookup"><span data-stu-id="4027c-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="4027c-105">Este tópico fornece uma visão geral de cancelamento em fluxos de trabalho.</span><span class="sxs-lookup"><span data-stu-id="4027c-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="4027c-106">Cancelar, compensação, e transações</span><span class="sxs-lookup"><span data-stu-id="4027c-106">Cancellation, Compensation, and Transactions</span></span>  
 <span data-ttu-id="4027c-107">As transações fornecem ao seu aplicativo a capacidade de nulo () para reverter as alterações executadas dentro de transação se qualquer erro ocorre durante qualquer parte do processo de transação.</span><span class="sxs-lookup"><span data-stu-id="4027c-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="4027c-108">No entanto, nem todo o trabalho que precise ser cancelado ou desfeito é apropriado para transações, como o trabalho longo ou o trabalho que não envolvem recursos transacionais.</span><span class="sxs-lookup"><span data-stu-id="4027c-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="4027c-109">A compensação fornece um modelo para desfazer o trabalho não transacional anteriormente concluído se houver uma falha subsequente no fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="4027c-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="4027c-110">Cancelamento fornece um modelo para autores de fluxo de trabalho e atividade do trabalho não transacional de forma que não foi concluído.</span><span class="sxs-lookup"><span data-stu-id="4027c-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="4027c-111">Se uma atividade não concluiu sua execução e será cancelada, sua lógica cancelar será chamada está disponível.</span><span class="sxs-lookup"><span data-stu-id="4027c-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4027c-112">Para obter mais informações sobre transações e compensação, consulte [transações](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) e [compensação](../../../docs/framework/windows-workflow-foundation/compensation.md).</span><span class="sxs-lookup"><span data-stu-id="4027c-112">For more information about transactions and compensation, see [Transactions](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) and [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="4027c-113">Usando CancellationScope</span><span class="sxs-lookup"><span data-stu-id="4027c-113">Using CancellationScope</span></span>  
 <span data-ttu-id="4027c-114">A atividade de <xref:System.Activities.Statements.CancellationScope> tem duas seções que podem conter atividades filhos: <xref:System.Activities.Statements.CancellationScope.Body%2A> e <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="4027c-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="4027c-115"><xref:System.Activities.Statements.CancellationScope.Body%2A> é onde as atividades que compõem a lógica de atividade são colocadas, e <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> é onde as atividades que fornecem lógica cancelar para atividades são colocadas.</span><span class="sxs-lookup"><span data-stu-id="4027c-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="4027c-116">Uma atividade pode ser cancelada somente se não tiver concluído.</span><span class="sxs-lookup"><span data-stu-id="4027c-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="4027c-117">No caso de atividade de <xref:System.Activities.Statements.CancellationScope> , o preenchimento refere-se a conclusão de atividades em <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span><span class="sxs-lookup"><span data-stu-id="4027c-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="4027c-118">Se uma solicitação cancelar é agendada e as atividades em <xref:System.Activities.Statements.CancellationScope.Body%2A> não tiverem terminado, então <xref:System.Activities.Statements.CancellationScope> será marcado como <xref:System.Activities.ActivityInstanceState.Canceled> e as atividades de <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> serão executadas.</span><span class="sxs-lookup"><span data-stu-id="4027c-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="4027c-119">Cancelando um fluxo de trabalho do host</span><span class="sxs-lookup"><span data-stu-id="4027c-119">Canceling a Workflow from the Host</span></span>  
 <span data-ttu-id="4027c-120">Um host pode cancelar um fluxo de trabalho chamando o método <xref:System.Activities.WorkflowApplication.Cancel%2A> de instância de <xref:System.Activities.WorkflowApplication> que está hospedando o fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="4027c-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="4027c-121">No exemplo a seguir um fluxo de trabalho é criado que tem <xref:System.Activities.Statements.CancellationScope>.</span><span class="sxs-lookup"><span data-stu-id="4027c-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="4027c-122">O fluxo de trabalho é chamado, e então o host uma chamada a <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="4027c-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="4027c-123">A execução do fluxo de trabalho é interrompida, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> de <xref:System.Activities.Statements.CancellationScope> é chamado, e então o fluxo de trabalho termina com um status de <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="4027c-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="4027c-124">Quando esse fluxo de trabalho é chamado, a seguinte saída é exibida no console.</span><span class="sxs-lookup"><span data-stu-id="4027c-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="4027c-125">**Iniciando o fluxo de trabalho.**</span><span class="sxs-lookup"><span data-stu-id="4027c-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="4027c-126">**CancellationHandler invocado.** </span><span class="sxs-lookup"><span data-stu-id="4027c-126">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="4027c-127">**Fluxo de trabalho b30ebb30-df46-4d90-a211-e31c38d8db3c cancelada.**</span><span class="sxs-lookup"><span data-stu-id="4027c-127">**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>    
> [!NOTE]
>  <span data-ttu-id="4027c-128">Quando uma atividade de <xref:System.Activities.Statements.CancellationScope> é cancelada e <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> é invocado, foi responsabilidade do autor de fluxo de trabalho determinar o progresso que a atividade cancelada feita antes que foi cancelado para fornecer a lógica apropriada cancelar.</span><span class="sxs-lookup"><span data-stu-id="4027c-128">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="4027c-129"><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> não fornece nenhuma informação sobre o andamento de atividade cancelada.</span><span class="sxs-lookup"><span data-stu-id="4027c-129">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="4027c-130">Um fluxo de trabalho também pode ser cancelado host se uma exceção não tratada borbulha anterior após a raiz de fluxo de trabalho e o manipulador de <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> retorna <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span><span class="sxs-lookup"><span data-stu-id="4027c-130">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="4027c-131">Nesse exemplo inicia o fluxo de trabalho e lançam em <xref:System.ApplicationException>.</span><span class="sxs-lookup"><span data-stu-id="4027c-131">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="4027c-132">Esta exceção é não tratados pelo fluxo de trabalho e então o manipulador de <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> é chamado.</span><span class="sxs-lookup"><span data-stu-id="4027c-132">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="4027c-133">O manipulador instrui o tempo de execução para cancelar o fluxo de trabalho, e <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> atividade estão atualmente em execução de <xref:System.Activities.Statements.CancellationScope> é chamado.</span><span class="sxs-lookup"><span data-stu-id="4027c-133">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="4027c-134">Quando esse fluxo de trabalho é chamado, a seguinte saída é exibida no console.</span><span class="sxs-lookup"><span data-stu-id="4027c-134">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="4027c-135">**Iniciando o fluxo de trabalho.**</span><span class="sxs-lookup"><span data-stu-id="4027c-135">**Starting the workflow.**</span></span>  
<span data-ttu-id="4027c-136">**OnUnhandledException em 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 do fluxo de trabalho** </span><span class="sxs-lookup"><span data-stu-id="4027c-136">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9** </span></span>  
<span data-ttu-id="4027c-137">**Foi lançada uma ApplicationException.** </span><span class="sxs-lookup"><span data-stu-id="4027c-137">**An ApplicationException was thrown.** </span></span>  
<span data-ttu-id="4027c-138">**CancellationHandler invocado.** </span><span class="sxs-lookup"><span data-stu-id="4027c-138">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="4027c-139">**Fluxo de trabalho 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 cancelada.**</span><span class="sxs-lookup"><span data-stu-id="4027c-139">**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>    
### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="4027c-140">Cancelando uma atividade de dentro de um fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="4027c-140">Canceling an Activity from Inside a Workflow</span></span>  
 <span data-ttu-id="4027c-141">Uma atividade também pode ser cancelada por seu pai.</span><span class="sxs-lookup"><span data-stu-id="4027c-141">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="4027c-142">Por exemplo, se uma atividade de <xref:System.Activities.Statements.Parallel> tem várias ramificações e que executa o <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> avalia a `true` suas ramificações incompletos serão canceladas em seguida.</span><span class="sxs-lookup"><span data-stu-id="4027c-142">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="4027c-143">Nesse exemplo uma atividade de <xref:System.Activities.Statements.Parallel> é criada que possui duas ramificações.</span><span class="sxs-lookup"><span data-stu-id="4027c-143">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="4027c-144">O <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> é definido como `true` portanto <xref:System.Activities.Statements.Parallel> concluir o que qualquer uma de suas ramificações terminar.</span><span class="sxs-lookup"><span data-stu-id="4027c-144">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="4027c-145">Nesta ramificação 2 do exemplo completo, e assim que a 1 é cancelado.</span><span class="sxs-lookup"><span data-stu-id="4027c-145">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="4027c-146">Quando esse fluxo de trabalho é chamado, a seguinte saída é exibida no console.</span><span class="sxs-lookup"><span data-stu-id="4027c-146">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="4027c-147">**Branch a partir de 1.**</span><span class="sxs-lookup"><span data-stu-id="4027c-147">**Branch 1 starting.**</span></span>  
<span data-ttu-id="4027c-148">**Ramificação 2 concluída.** </span><span class="sxs-lookup"><span data-stu-id="4027c-148">**Branch 2 complete.** </span></span>  
<span data-ttu-id="4027c-149">**Ramificação de 1 cancelada.** </span><span class="sxs-lookup"><span data-stu-id="4027c-149">**Branch 1 canceled.** </span></span>  
<span data-ttu-id="4027c-150">**E0685e24-18ef-4a47-acf3-5c638732f3be de fluxo de trabalho concluído.**</span><span class="sxs-lookup"><span data-stu-id="4027c-150">**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="4027c-151">As atividades também são canceladas se uma exceção borbulha anterior após a raiz da atividade mas tratadas em um nível mais alto no fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="4027c-151">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="4027c-152">Nesse exemplo, a principal lógica de fluxo de trabalho consiste em uma atividade de <xref:System.Activities.Statements.Sequence> .</span><span class="sxs-lookup"><span data-stu-id="4027c-152">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="4027c-153"><xref:System.Activities.Statements.Sequence> é especificado como <xref:System.Activities.Statements.CancellationScope.Body%2A> de uma atividade de <xref:System.Activities.Statements.CancellationScope> que está contida por uma atividade de <xref:System.Activities.Statements.TryCatch> .</span><span class="sxs-lookup"><span data-stu-id="4027c-153">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="4027c-154">Uma exceção é lançada do corpo de <xref:System.Activities.Statements.Sequence>, é tratada pela atividade pai de <xref:System.Activities.Statements.TryCatch> , e <xref:System.Activities.Statements.Sequence> é cancelado.</span><span class="sxs-lookup"><span data-stu-id="4027c-154">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="4027c-155">Quando esse fluxo de trabalho é chamado, a seguinte saída é exibida no console.</span><span class="sxs-lookup"><span data-stu-id="4027c-155">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="4027c-156">**Sequência inicial.**</span><span class="sxs-lookup"><span data-stu-id="4027c-156">**Sequence starting.**</span></span>  
<span data-ttu-id="4027c-157">**Sequência cancelada.** </span><span class="sxs-lookup"><span data-stu-id="4027c-157">**Sequence canceled.** </span></span>  
<span data-ttu-id="4027c-158">**Exceção capturada.** </span><span class="sxs-lookup"><span data-stu-id="4027c-158">**Exception caught.** </span></span>  
<span data-ttu-id="4027c-159">**E3c18939-121e-4c43-af1c-ba1ce977ce55 de fluxo de trabalho concluído.**</span><span class="sxs-lookup"><span data-stu-id="4027c-159">**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>   
### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="4027c-160">Gerar exceções de um CancellationHandler</span><span class="sxs-lookup"><span data-stu-id="4027c-160">Throwing Exceptions from a CancellationHandler</span></span>  
 <span data-ttu-id="4027c-161">Todas as exceções geradas de <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> de <xref:System.Activities.Statements.CancellationScope> são fatais ao fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="4027c-161">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="4027c-162">Se houver uma chance de exceções que escapam de <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use <xref:System.Activities.Statements.TryCatch> em <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> para capturar e tratar essas exceções.</span><span class="sxs-lookup"><span data-stu-id="4027c-162">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="4027c-163">Cancelar usando CompensableActivity</span><span class="sxs-lookup"><span data-stu-id="4027c-163">Cancellation using CompensableActivity</span></span>  
 <span data-ttu-id="4027c-164">Como a atividade de <xref:System.Activities.Statements.CancellationScope> , <xref:System.Activities.Statements.CompensableActivity> tem <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="4027c-164">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="4027c-165">Se <xref:System.Activities.Statements.CompensableActivity> é cancelado, todas as atividades em seu <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> são chamadas.</span><span class="sxs-lookup"><span data-stu-id="4027c-165">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="4027c-166">Isso pode ser útil para desfazer o trabalho compensável parcialmente concluído.</span><span class="sxs-lookup"><span data-stu-id="4027c-166">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="4027c-167">Para obter informações sobre como usar <xref:System.Activities.Statements.CompensableActivity> para compensação e cancelamento, consulte [compensação](../../../docs/framework/windows-workflow-foundation/compensation.md).</span><span class="sxs-lookup"><span data-stu-id="4027c-167">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="4027c-168">Cancelar usando atividades personalizados</span><span class="sxs-lookup"><span data-stu-id="4027c-168">Cancellation using Custom Activities</span></span>  
 <span data-ttu-id="4027c-169">Os autores de atividade personalizados podem implementar a lógica cancelar nas atividades personalizados em várias maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="4027c-169">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="4027c-170">As atividades personalizados que derivam de <xref:System.Activities.Activity> podem implementar a lógica de cancelamento colocando <xref:System.Activities.Statements.CancellationScope> ou outra atividade personalizado que contém a lógica cancelar no corpo da atividade.</span><span class="sxs-lookup"><span data-stu-id="4027c-170">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="4027c-171"><xref:System.Activities.AsyncCodeActivity> e as atividades <xref:System.Activities.NativeActivity> derivadas podem substituir o método respectivo de <xref:System.Activities.NativeActivity.Cancel%2A> e fornecer a lógica de cancelamento lá.</span><span class="sxs-lookup"><span data-stu-id="4027c-171"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="4027c-172"><xref:System.Activities.CodeActivity> derivado atividades não fornece nenhuma para o cancelamento como todo o trabalho é executado em uma única explosão de execução quando o tempo de execução chama o método de <xref:System.Activities.CodeActivity.Execute%2A> .</span><span class="sxs-lookup"><span data-stu-id="4027c-172"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="4027c-173">Se o método executar não foi chamado ainda e uma atividade com base <xref:System.Activities.CodeActivity> será cancelada, a atividade fecha com um status de <xref:System.Activities.ActivityInstanceState.Canceled> e o método de <xref:System.Activities.CodeActivity.Execute%2A> não é chamado.</span><span class="sxs-lookup"><span data-stu-id="4027c-173">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="4027c-174">Cancelar usando NativeActivity</span><span class="sxs-lookup"><span data-stu-id="4027c-174">Cancellation using NativeActivity</span></span>  
 <span data-ttu-id="4027c-175"><xref:System.Activities.NativeActivity> derivado atividades pode substituir o método de <xref:System.Activities.NativeActivity.Cancel%2A> para fornecer a lógica personalizada cancelar.</span><span class="sxs-lookup"><span data-stu-id="4027c-175"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="4027c-176">Se este método não é substituído, então a lógica padrão de cancelamento de fluxo de trabalho é aplicada.</span><span class="sxs-lookup"><span data-stu-id="4027c-176">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="4027c-177">Cancelamento de padrão é o processo que ocorre para um <xref:System.Activities.NativeActivity> não substitui o <xref:System.Activities.NativeActivity.Cancel%2A> método ou cujo <xref:System.Activities.NativeActivity.Cancel%2A> a base de chamadas de método <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> método.</span><span class="sxs-lookup"><span data-stu-id="4027c-177">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="4027c-178">Quando uma atividade é cancelada, o tempo de execução sinaliza a atividade para o botão e automaticamente trata determinada limpeza.</span><span class="sxs-lookup"><span data-stu-id="4027c-178">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="4027c-179">Se a atividade tem apenas indicadores pendentes, os indicadores serão removidos e a atividade será marcada como <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="4027c-179">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="4027c-180">Todas as atividades filhos excelentes de atividade cancelada serão canceladas por sua vez.</span><span class="sxs-lookup"><span data-stu-id="4027c-180">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="4027c-181">Qualquer tentativa de agendar atividades filho adicionais resultará na tentativa que está sendo ignorada e a atividade será marcada como <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="4027c-181">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="4027c-182">Se alguma atividade excelente filho termina em <xref:System.Activities.ActivityInstanceState.Canceled> ou estado de <xref:System.Activities.ActivityInstanceState.Faulted> , então a atividade será marcada como <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="4027c-182">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="4027c-183">Observe que uma solicitação de cancelamento pode ser ignorada.</span><span class="sxs-lookup"><span data-stu-id="4027c-183">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="4027c-184">Se uma atividade não tem nenhum indicadores pendentes ou executar atividades filhos e não agenda os itens de trabalho adicionais após o embandeiramento para cancelamento, se concluirá com êxito.</span><span class="sxs-lookup"><span data-stu-id="4027c-184">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="4027c-185">Este padrão cancelar basta para muitos cenários, mas se a lógica adicional cancelar é necessária, então as atividades internos de cancelamento ou as atividades personalizados podem ser usadas.</span><span class="sxs-lookup"><span data-stu-id="4027c-185">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="4027c-186">No exemplo a seguir, a substituição de <xref:System.Activities.NativeActivity.Cancel%2A> de uma atividade personalizada com base <xref:System.Activities.NativeActivity> de `ParallelForEach` é definida.</span><span class="sxs-lookup"><span data-stu-id="4027c-186">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="4027c-187">Quando a atividade é cancelada, alças desta substituição lógica cancelar para atividades.</span><span class="sxs-lookup"><span data-stu-id="4027c-187">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="4027c-188">Este exemplo é parte do [ParallelForEach não genéricos](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) exemplo.</span><span class="sxs-lookup"><span data-stu-id="4027c-188">This example is part of the [Non-Generic ParallelForEach](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="4027c-189"><xref:System.Activities.NativeActivity> derivado atividades pode determinar se o cancelar foi solicitado inspecionando a propriedade de <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> , e marcar-se como canceladas chamando o método <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> .</span><span class="sxs-lookup"><span data-stu-id="4027c-189"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="4027c-190">A chamada <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> não concluir imediatamente a atividade.</span><span class="sxs-lookup"><span data-stu-id="4027c-190">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="4027c-191">Como de costume, o tempo de execução se concluirá a atividade quando não tem não mais trabalho excelente, mas se <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> é chamado estado final será <xref:System.Activities.ActivityInstanceState.Canceled> em vez de <xref:System.Activities.ActivityInstanceState.Closed>.</span><span class="sxs-lookup"><span data-stu-id="4027c-191">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="4027c-192">Cancelar usando AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="4027c-192">Cancellation using AsyncCodeActivity</span></span>  
 <span data-ttu-id="4027c-193"><xref:System.Activities.AsyncCodeActivity> com atividades também pode fornecer a lógica personalizada cancelar substituindo o método de <xref:System.Activities.AsyncCodeActivity.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="4027c-193"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="4027c-194">Se este método não é substituído, então nenhuma tratamento cancelar é executada se a atividade é cancelada.</span><span class="sxs-lookup"><span data-stu-id="4027c-194">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="4027c-195">No exemplo a seguir, a substituição de <xref:System.Activities.AsyncCodeActivity.Cancel%2A> de uma atividade personalizada com base <xref:System.Activities.AsyncCodeActivity> de `ExecutePowerShell` é definida.</span><span class="sxs-lookup"><span data-stu-id="4027c-195">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="4027c-196">Quando a atividade é cancelada, executa o comportamento desejado cancelar.</span><span class="sxs-lookup"><span data-stu-id="4027c-196">When the activity is canceled, it performs the desired cancellation behavior.</span></span> <span data-ttu-id="4027c-197">Este exemplo é parte do [usando a atividade de InvokePowerShell](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) exemplo.</span><span class="sxs-lookup"><span data-stu-id="4027c-197">This example is part of the [Using the InvokePowerShell Activity](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) sample.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="4027c-198"><xref:System.Activities.AsyncCodeActivity> derivado atividades pode determinar se o cancelar foi solicitado inspecionando a propriedade de <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> , e marcar-se como canceladas chamando o método <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> .</span><span class="sxs-lookup"><span data-stu-id="4027c-198"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
