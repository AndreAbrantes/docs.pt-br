---
title: Consumir feeds de OData de um fluxo de trabalho
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: 7b9b55d92d81772ed1601ec246cfc2e8aa96c016
ms.sourcegitcommit: a1e35d4e94edab384a63406c0a5438306873031b
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/21/2018
ms.locfileid: "42754472"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="11859-102">Consumir feeds de OData de um fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="11859-102">Consuming OData Feeds from a Workflow</span></span>

<span data-ttu-id="11859-103">WCF Services Data é um componente de [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] que permite que você crie serviços que usam o protocolo aberto de dados (OData) para exibir e receber dados sobre a Web ou intranet usando a semântica de transferência representacional de estado (RESTO).</span><span class="sxs-lookup"><span data-stu-id="11859-103">WCF Data Services is a component of the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="11859-104">OData expõem dados como recursos que são endereçáveis por URIs.</span><span class="sxs-lookup"><span data-stu-id="11859-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="11859-105">Qualquer aplicativo pode interagir com um serviço de dados com base OData- se pode enviar uma solicitação HTTP e processar o avanço de OData que um serviço de dados retorna.</span><span class="sxs-lookup"><span data-stu-id="11859-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="11859-106">Além disso, Data WCF Services inclui bibliotecas de cliente que fornece uma experiência mais rica de programação quando você consome feeds de OData de aplicativos de [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="11859-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] applications.</span></span> <span data-ttu-id="11859-107">Este tópico fornece uma visão geral de consumir um avanço de OData em um fluxo de trabalho com e sem o uso das bibliotecas de cliente.</span><span class="sxs-lookup"><span data-stu-id="11859-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="11859-108">Usando o serviço de OData de exemplo Northwind</span><span class="sxs-lookup"><span data-stu-id="11859-108">Using the Sample Northwind OData Service</span></span>

<span data-ttu-id="11859-109">Os exemplos neste tópico usam o exemplo Northwind, serviço de dados localizado em [ http://services.odata.org/Northwind/Northwind.svc/ ](http://go.microsoft.com/fwlink/?LinkID=187426).</span><span class="sxs-lookup"><span data-stu-id="11859-109">The examples in this topic use the sample Northwind data service located at [http://services.odata.org/Northwind/Northwind.svc/](http://go.microsoft.com/fwlink/?LinkID=187426).</span></span> <span data-ttu-id="11859-110">Esse serviço é fornecido como parte do [OData SDK](http://go.microsoft.com/fwlink/?LinkID=185248) e fornece acesso somente leitura aos dados de exemplo Northwind.</span><span class="sxs-lookup"><span data-stu-id="11859-110">This service is provided as part of the [OData SDK](http://go.microsoft.com/fwlink/?LinkID=185248) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="11859-111">Se o acesso de gravação é desejado, ou se um WCF Data Service local for desejado, você pode seguir as etapas da [WCF Services Data Quickstart](http://go.microsoft.com/fwlink/?LinkID=131076) para criar um serviço OData local que fornece acesso ao banco de dados Northwind.</span><span class="sxs-lookup"><span data-stu-id="11859-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](http://go.microsoft.com/fwlink/?LinkID=131076) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="11859-112">Se você segue o quickstart, substitua o URI local para aquele fornecido no exemplo de código neste tópico.</span><span class="sxs-lookup"><span data-stu-id="11859-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="11859-113">Consumir um avanço de OData usando as bibliotecas de cliente</span><span class="sxs-lookup"><span data-stu-id="11859-113">Consuming an OData Feed Using the Client Libraries</span></span>

<span data-ttu-id="11859-114">Data WCF Services inclui as bibliotecas de cliente para permitir que consomem mais facilmente um avanço de OData de [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] e dos aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="11859-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] and client applications.</span></span> <span data-ttu-id="11859-115">Essas bibliotecas simplificam o envio e o recebimento de mensagens HTTP.</span><span class="sxs-lookup"><span data-stu-id="11859-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="11859-116">Elas também convertem a carga da mensagem em objetos CLR que representam dados de entidade.</span><span class="sxs-lookup"><span data-stu-id="11859-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="11859-117">As bibliotecas de cliente apresentam as duas classes principais <xref:System.Data.Services.Client.DataServiceContext> e <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="11859-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="11859-118">Essas classes permitem consultar um serviço de dados e, em seguida, trabalhar com os dados de entidade retornados como objetos CLR.</span><span class="sxs-lookup"><span data-stu-id="11859-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="11859-119">Esta seção aborda duas abordagens para criar as atividades que usam as bibliotecas de cliente.</span><span class="sxs-lookup"><span data-stu-id="11859-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="11859-120">Adicionando uma referência de serviço a WCF Services Data</span><span class="sxs-lookup"><span data-stu-id="11859-120">Adding a Service Reference to the WCF Data Service</span></span>

<span data-ttu-id="11859-121">Para gerar as bibliotecas de cliente Northwind, você pode usar o **adicionar referência de serviço** da caixa de diálogo [!INCLUDE[vs_current_long](../../../includes/vs-current-long-md.md)] para adicionar uma referência para o serviço Northwind OData.</span><span class="sxs-lookup"><span data-stu-id="11859-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in [!INCLUDE[vs_current_long](../../../includes/vs-current-long-md.md)] to add a reference to the Northwind OData service.</span></span>

<span data-ttu-id="11859-122">![Adicionar referência de serviço](../../../docs/framework/windows-workflow-foundation/media/addservicereferencetonorthwindodataservice.gif "AddServiceReferencetoNorthwindODataService")</span><span class="sxs-lookup"><span data-stu-id="11859-122">![Add Service Reference](../../../docs/framework/windows-workflow-foundation/media/addservicereferencetonorthwindodataservice.gif "AddServiceReferencetoNorthwindODataService")</span></span>

<span data-ttu-id="11859-123">Observe que não há nenhuma operação de serviço expostas pelo serviço e, na **Services** lista há itens que representam as entidades expostas pelo serviço de dados Northwind.</span><span class="sxs-lookup"><span data-stu-id="11859-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="11859-124">Quando a referência de serviço é adicionada, as classes serão geradas para essas entidades e podem ser usadas no código do cliente.</span><span class="sxs-lookup"><span data-stu-id="11859-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="11859-125">Os exemplos neste tópico usam essas classes e a classe de `NorthwindEntities` para executar consultas.</span><span class="sxs-lookup"><span data-stu-id="11859-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="11859-126">Para obter mais informações, consulte [gerando a biblioteca de cliente do serviço de dados (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkID=191611).</span><span class="sxs-lookup"><span data-stu-id="11859-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkID=191611).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="11859-127">Usando métodos assíncronos</span><span class="sxs-lookup"><span data-stu-id="11859-127">Using Asynchronous Methods</span></span>

<span data-ttu-id="11859-128">Para corrigir os problemas possíveis de latência que podem ocorrer ao acessar recursos sobre a Web, nós seja recomendável acessar WCF Services Data de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="11859-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="11859-129">As bibliotecas de cliente do WCF Data Services incluem métodos assíncronos para chamar consultas, e o Windows Workflow Foundation (WF) fornece o <xref:System.Activities.AsyncCodeActivity> classe para criar atividades assíncronas.</span><span class="sxs-lookup"><span data-stu-id="11859-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="11859-130"><xref:System.Activities.AsyncCodeActivity> derivado atividades pode ser escrito para tirar proveito de classes de [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] que possuem métodos assíncronos, ou o código a ser executado de forma assíncrona pode ser colocado em um método e ser chamado usando um representante.</span><span class="sxs-lookup"><span data-stu-id="11859-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="11859-131">Esta seção fornece dois exemplos de uma atividade derivada <xref:System.Activities.AsyncCodeActivity> ; um que usa os métodos assíncronos das bibliotecas de cliente de Data WCF Services e um que usa um representante.</span><span class="sxs-lookup"><span data-stu-id="11859-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="11859-132">Para obter mais informações, consulte [operações assíncronas (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkId=193396) e [criando atividades assíncronas](../../../docs/framework/windows-workflow-foundation/creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="11859-132">For more information, see [Asynchronous Operations (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkId=193396) and [Creating Asynchronous Activities](../../../docs/framework/windows-workflow-foundation/creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="11859-133">Usando métodos assíncronos de biblioteca de cliente</span><span class="sxs-lookup"><span data-stu-id="11859-133">Using Client Library Asynchronous Methods</span></span>

<span data-ttu-id="11859-134">A classe de <xref:System.Data.Services.Client.DataServiceQuery%601> fornece <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> e métodos de <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> para ver um serviço de OData de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="11859-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="11859-135">Esses métodos podem ser chamados de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e as substituições de <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> de uma classe derivada de <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="11859-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="11859-136">Quando o <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> substituição retorna, o fluxo de trabalho pode ir ocioso (mas não para persistir), e quando o trabalho assíncrono é concluído, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> é invocado pelo tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="11859-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="11859-137">No exemplo a seguir, uma atividade de `OrdersByCustomer` é definida que possui dois argumentos conectados.</span><span class="sxs-lookup"><span data-stu-id="11859-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="11859-138">O argumento de `CustomerId` representa o cliente que identifica qual as regras para retornar, e o argumento de `ServiceUri` representa o URI de serviço de OData a ser consultado.</span><span class="sxs-lookup"><span data-stu-id="11859-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="11859-139">Porque a atividade deriva de `AsyncCodeActivity<IEnumerable<Order>>` há também um argumento de saída de <xref:System.Activities.Activity%601.Result%2A> que é usado para retornar os resultados da consulta.</span><span class="sxs-lookup"><span data-stu-id="11859-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="11859-140">A substituição de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> cria uma consulta LINQ que selecionar todos os pedidos do cliente especificado.</span><span class="sxs-lookup"><span data-stu-id="11859-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="11859-141">Esta consulta é especificado como <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> de <xref:System.Activities.AsyncCodeActivityContext>passado, e o método de <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> de consulta é então chamado.</span><span class="sxs-lookup"><span data-stu-id="11859-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="11859-142">Observe que o retorno de chamada e indica que é passado em <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> de consulta são aqueles que são passados ao método de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de atividade.</span><span class="sxs-lookup"><span data-stu-id="11859-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="11859-143">Quando a consulta terminou de executar, o método de <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> da atividade é chamado.</span><span class="sxs-lookup"><span data-stu-id="11859-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="11859-144">A consulta é recuperada de <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, e o método de <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> de consulta é então chamado.</span><span class="sxs-lookup"><span data-stu-id="11859-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="11859-145">Esse método retorna <xref:System.Collections.Generic.IEnumerable%601> do tipo de entidade especificado; nesse caso `Order`.</span><span class="sxs-lookup"><span data-stu-id="11859-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="11859-146">Uma vez que `IEnumerable<Order>` é o tipo genérico do <xref:System.Activities.AsyncCodeActivity%601>, esse `IEnumerable` é definido como o <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> da atividade.</span><span class="sxs-lookup"><span data-stu-id="11859-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this `IEnumerable` is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="11859-147">No exemplo a seguir, a atividade de `OrdersByCustomer` recuperar uma lista de pedidos para o cliente especificado, e então uma atividade de <xref:System.Activities.Statements.ForEach%601> enumera os pedidos retornados e grava a data de cada pedido no console.</span><span class="sxs-lookup"><span data-stu-id="11859-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="11859-148">Quando esse fluxo de trabalho é chamado, os seguintes dados são gravados no console:</span><span class="sxs-lookup"><span data-stu-id="11859-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="11859-149">Se uma conexão com o servidor de OData não pode ser estabelecida, você receberá uma exceção similar à seguinte exceção:</span><span class="sxs-lookup"><span data-stu-id="11859-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="11859-150">Exceção sem tratamento: System.InvalidOperationException: Ocorreu um erro ao processar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="11859-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="11859-151">---> System.Net.WebException: Incapaz de se conectar ao servidor remoto --- System.Net.Sockets.SocketException: Uma tentativa> de conexão falhou porque a parte conectada não respondeu corretamente após um período de tempo, ou conexão estabelecida falhou porque o host conectado não respondeu.</span><span class="sxs-lookup"><span data-stu-id="11859-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="11859-152">Se qualquer processamento adicional dos dados retornados pela consulta é necessário, pode ser feito em uma substituição de <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> de atividade.</span><span class="sxs-lookup"><span data-stu-id="11859-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="11859-153">O <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> e o <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> são chamados usando o segmento de fluxo de trabalho, e qualquer código nessas alternativas não funciona de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="11859-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="11859-154">Se o processamento adicional é abrangente ou longo, ou os resultados da consulta são paginados, você deve considerar a abordagem discutido na seção a seguir, que usa um representante para executar a consulta e executar processamento adicional de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="11859-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="11859-155">Usando um representante</span><span class="sxs-lookup"><span data-stu-id="11859-155">Using a Delegate</span></span>

<span data-ttu-id="11859-156">Além de chamar o método assíncrona de uma classe de [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] , uma atividade baseadas em <xref:System.Activities.AsyncCodeActivity>também pode definir a lógica assíncrono em um de seus métodos.</span><span class="sxs-lookup"><span data-stu-id="11859-156">In addition to invoking the asynchronous method of a [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="11859-157">Este método é especificado usando um delegado em uma substituição de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de atividade.</span><span class="sxs-lookup"><span data-stu-id="11859-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="11859-158">Quando o método retorna, o tempo de execução chama a substituição de <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> de atividade.</span><span class="sxs-lookup"><span data-stu-id="11859-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="11859-159">Para chamar um serviço de OData de um fluxo de trabalho, esse método pode ser usado para ver o serviço e fornecer qualquer processamento adicional.</span><span class="sxs-lookup"><span data-stu-id="11859-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="11859-160">No exemplo a seguir, uma atividade de `ListCustomers` é definida.</span><span class="sxs-lookup"><span data-stu-id="11859-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="11859-161">Esta atividade consulta o serviço de dados de exemplo Northwind e retorna `List<Customer>` que contém todos os clientes na base de dados Northwind.</span><span class="sxs-lookup"><span data-stu-id="11859-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="11859-162">Assíncrono o trabalho é executado pelo método de `GetCustomers` .</span><span class="sxs-lookup"><span data-stu-id="11859-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="11859-163">Este método consulta o serviço para todos os clientes, e copiar em `List<Customer>`.</span><span class="sxs-lookup"><span data-stu-id="11859-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="11859-164">Então verifica para ver se os resultados são paginados.</span><span class="sxs-lookup"><span data-stu-id="11859-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="11859-165">Em caso afirmativo, consulte o serviço para a próxima página de resultados, adicioná-los à lista, e continua-o até que todos os dados do cliente sejam recuperados.</span><span class="sxs-lookup"><span data-stu-id="11859-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="11859-166">Para obter mais informações sobre a paginação no WCF Data Services, consulte.</span><span class="sxs-lookup"><span data-stu-id="11859-166">For more information about paging in WCF Data Services, see .</span></span> <span data-ttu-id="11859-167">[Como: carregar (WCF Data Services) de resultados paginados](http://go.microsoft.com/fwlink/?LinkId=193452).</span><span class="sxs-lookup"><span data-stu-id="11859-167">[How to: Load Paged Results (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkId=193452).</span></span>

<span data-ttu-id="11859-168">Depois que todos os clientes são adicionados, a lista será retornada.</span><span class="sxs-lookup"><span data-stu-id="11859-168">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="11859-169">O método de `GetCustomers` é especificado em uma substituição de <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de atividade.</span><span class="sxs-lookup"><span data-stu-id="11859-169">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="11859-170">Desde que o método possui um valor de retorno, `Func<string, List<Customer>>` é criado para especificar o método.</span><span class="sxs-lookup"><span data-stu-id="11859-170">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="11859-171">Se o método que executa o trabalho assíncrono não tem um valor de retorno, uma <xref:System.Action> é usado em vez de um <!--zz <xref:System.Func> --> `System.Func`.</span><span class="sxs-lookup"><span data-stu-id="11859-171">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <!--zz <xref:System.Func> --> `System.Func`.</span></span> <span data-ttu-id="11859-172">Para obter exemplos de criação de um exemplo assíncrona usando as duas abordagens, consulte [criando atividades assíncronas](../../../docs/framework/windows-workflow-foundation/creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="11859-172">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](../../../docs/framework/windows-workflow-foundation/creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="11859-173">Isso <!--zz <xref:System.Func> --> `System.Func` é atribuído para o <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>e, em seguida, `BeginInvoke` é chamado.</span><span class="sxs-lookup"><span data-stu-id="11859-173">This <!--zz <xref:System.Func> --> `System.Func` is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="11859-174">Desde que o método a ser chamado não tem acesso ao ambiente de atividade de argumentos, o valor do argumento de `ServiceUri` é passado como o primeiro parâmetro, juntamente com o retorno de chamada e indica que foram passados em <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="11859-174">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="11859-175">Quando `GetCustomers` retorna, o tempo de execução chama <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="11859-175">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="11859-176">O código em <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> recupera o representante de <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, chama `EndInvoke`, e retorna o resultado, que é a lista de clientes retornados pelo método de `GetCustomers` .</span><span class="sxs-lookup"><span data-stu-id="11859-176">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="11859-177">No exemplo a seguir, a atividade de `ListCustomers` recuperar uma lista de clientes, e então uma atividade de <xref:System.Activities.Statements.ForEach%601> enumera-os e escreve-ao nome do nome da empresa e de contatos de cada cliente no console.</span><span class="sxs-lookup"><span data-stu-id="11859-177">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="11859-178">Quando esse fluxo de trabalho é chamado, os seguintes dados são gravados no console.</span><span class="sxs-lookup"><span data-stu-id="11859-178">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="11859-179">Como esta consulta retorna vários clientes, somente a parte de saída é mostrada aqui.</span><span class="sxs-lookup"><span data-stu-id="11859-179">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="11859-180">Consumir um avanço de OData sem usar as bibliotecas de cliente</span><span class="sxs-lookup"><span data-stu-id="11859-180">Consuming an OData Feed Without Using the Client Libraries</span></span>

<span data-ttu-id="11859-181">OData expõem dados como recursos que são endereçáveis por URIs.</span><span class="sxs-lookup"><span data-stu-id="11859-181">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="11859-182">Quando você usa bibliotecas de cliente essas URIs são criados para você, mas você não tem que usar as bibliotecas de cliente.</span><span class="sxs-lookup"><span data-stu-id="11859-182">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="11859-183">Se desejado, serviços de OData podem ser acessados diretamente sem usar as bibliotecas de cliente.</span><span class="sxs-lookup"><span data-stu-id="11859-183">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="11859-184">Para não usar as bibliotecas de cliente o local do serviço e os dados desejados são especificados por um URI e os resultados são retornados em resposta a solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="11859-184">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="11859-185">Esses dados brutos podem ser processados ou manipulado na forma desejada.</span><span class="sxs-lookup"><span data-stu-id="11859-185">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="11859-186">Uma maneira para recuperar os resultados de uma consulta de OData é usando a classe de <xref:System.Net.WebClient> .</span><span class="sxs-lookup"><span data-stu-id="11859-186">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="11859-187">Nesse exemplo, o nome de contato para o cliente representado pela chave ALFKI é recuperado.</span><span class="sxs-lookup"><span data-stu-id="11859-187">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="11859-188">Quando esse código é executado, a saída a seguir são exibidas no console:</span><span class="sxs-lookup"><span data-stu-id="11859-188">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?> 
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="11859-189">Em um fluxo de trabalho, o código deste exemplo pode ser inserido na substituição de <xref:System.Activities.CodeActivity.Execute%2A> de uma atividade personalizado com base em <xref:System.Activities.CodeActivity>, mas a mesma funcionalidade também pode ser realizada usando a atividade de <xref:System.Activities.Expressions.InvokeMethod%601> .</span><span class="sxs-lookup"><span data-stu-id="11859-189">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="11859-190">A atividade de <xref:System.Activities.Expressions.InvokeMethod%601> permite que autores de fluxo de trabalho para chamar métodos estáticos e de instância de uma classe, e também tem uma opção chamar o método de forma assíncrona especificado.</span><span class="sxs-lookup"><span data-stu-id="11859-190">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="11859-191">No exemplo a seguir, uma atividade de <xref:System.Activities.Expressions.InvokeMethod%601> é configurada para chamar o método de <xref:System.Net.WebClient.DownloadString%2A> da classe de <xref:System.Net.WebClient> e retornar uma lista de clientes.</span><span class="sxs-lookup"><span data-stu-id="11859-191">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="11859-192"><xref:System.Activities.Expressions.InvokeMethod%601> pode chamar métodos estáticos e de instância de uma classe.</span><span class="sxs-lookup"><span data-stu-id="11859-192"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="11859-193">Desde que <xref:System.Net.WebClient.DownloadString%2A> é um método de instância da classe de <xref:System.Net.WebClient> , uma nova instância da classe <xref:System.Net.WebClient> é especificada para <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="11859-193">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="11859-194">`DownloadString` é especificado como <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, o URI que contém a consulta é especificado na coleção de <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> , e o valor de retorno é atribuído ao valor de <xref:System.Activities.Activity%601.Result%2A> .</span><span class="sxs-lookup"><span data-stu-id="11859-194">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="11859-195">O valor de <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> é definido como `true`, o que significa que a chamada ao método executará de forma assíncrona com relação ao fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="11859-195">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="11859-196">No exemplo a seguir, um fluxo de trabalho é construído que usa a atividade de <xref:System.Activities.Expressions.InvokeMethod%601> para ver o serviço de dados de exemplo Northwind para uma lista de pedidos para um cliente específico, e os dados retornados são gravados no console.</span><span class="sxs-lookup"><span data-stu-id="11859-196">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="11859-197">Quando esse fluxo de trabalho é chamado, a seguinte saída é exibida no console.</span><span class="sxs-lookup"><span data-stu-id="11859-197">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="11859-198">Como esta consulta retorna vários pedidos, somente a parte de saída é mostrada aqui.</span><span class="sxs-lookup"><span data-stu-id="11859-198">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="11859-199">Este exemplo fornece um método que os autores de aplicativo de fluxo de trabalho podem usar para receber os dados brutos retornados de um serviço de OData.</span><span class="sxs-lookup"><span data-stu-id="11859-199">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="11859-200">Para obter mais informações sobre como acessar WCF Services Data usando URIs, consulte [acessando recursos do serviço (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkId=193397) e [OData: convenções de URI](http://go.microsoft.com/fwlink/?LinkId=185564).</span><span class="sxs-lookup"><span data-stu-id="11859-200">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](http://go.microsoft.com/fwlink/?LinkId=193397) and [OData: URI Conventions](http://go.microsoft.com/fwlink/?LinkId=185564).</span></span>
