---
title: Participantes de persistência
ms.date: 03/30/2017
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
ms.openlocfilehash: a8392bd756d8315a72d9df131476414f8982cf03
ms.sourcegitcommit: 160a88c8087b0e63606e6e35f9bd57fa5f69c168
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/09/2019
ms.locfileid: "57723758"
---
# <a name="persistence-participants"></a><span data-ttu-id="fc98b-102">Participantes de persistência</span><span class="sxs-lookup"><span data-stu-id="fc98b-102">Persistence Participants</span></span>
<span data-ttu-id="fc98b-103">Um participante de persistência pode participar em uma operação de persistência (salvar) ou carregamento disparada por um aplicativo host.</span><span class="sxs-lookup"><span data-stu-id="fc98b-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="fc98b-104">O [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] vem com duas classes abstratas, **PersistenceParticipant** e **PersistenceIOParticipant**, que você pode usar para criar um participante de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="fc98b-105">Um participante de persistência deriva de uma dessas classes, implementa-se os métodos de interesse, e então adiciona uma instância da classe à coleção de <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> em <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span><span class="sxs-lookup"><span data-stu-id="fc98b-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="fc98b-106">O aplicativo host pode procurar essas extensões de fluxo de trabalho para manter uma instância de fluxo de trabalho e chama métodos apropriados nos participantes de persistência em momentos apropriadas.</span><span class="sxs-lookup"><span data-stu-id="fc98b-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="fc98b-107">A lista a seguir descreve as tarefas executadas pelo subsistema de persistência em diferentes estágios da operação persistir (salvar).</span><span class="sxs-lookup"><span data-stu-id="fc98b-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="fc98b-108">Os participantes de persistência são usados em terceira e quartas etapas.</span><span class="sxs-lookup"><span data-stu-id="fc98b-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="fc98b-109">Se o participante é um participante de e/s (um participante de persistência que também participa de operações de e/s), o participante é usado também na sexta fase.</span><span class="sxs-lookup"><span data-stu-id="fc98b-109">If the participant is an I/O participant (a persistence participant that also participates in I/O operations), the participant is also used in the sixth stage.</span></span>  
  
1.  <span data-ttu-id="fc98b-110">Obtém os valores internos, incluindo o estado de fluxo de trabalho, indexadores, variáveis mapeados, e carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="fc98b-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2.  <span data-ttu-id="fc98b-111">Coleta todos os participantes de persistência que foram adicionados à coleção de extensão associada com a instância de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc98b-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3.  <span data-ttu-id="fc98b-112">Chama o método de <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> implementado por todos os participantes de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4.  <span data-ttu-id="fc98b-113">Chama o método de <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> implementado por todos os participantes de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5.  <span data-ttu-id="fc98b-114">Persistir ou salvar o fluxo de trabalho no armazenamento de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-114">Persist or save the workflow into the persistence store.</span></span>  
  
6.  <span data-ttu-id="fc98b-115">Invoca o <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> método em todos os participantes de e/s de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence I/O participants.</span></span> <span data-ttu-id="fc98b-116">Se o participante não é um participante de e/s, essa tarefa é ignorada.</span><span class="sxs-lookup"><span data-stu-id="fc98b-116">If the participant is not an I/O participant, this task is skipped.</span></span> <span data-ttu-id="fc98b-117">Se o episódio de persistência é transacional, a transação é fornecida na propriedade de Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="fc98b-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7.  <span data-ttu-id="fc98b-118">Aguarda que todos os participantes de persistência terminem.</span><span class="sxs-lookup"><span data-stu-id="fc98b-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="fc98b-119">Se todos os participantes são bem-sucedidas em manter dados de instância, confirmações a transação.</span><span class="sxs-lookup"><span data-stu-id="fc98b-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="fc98b-120">Um participante de persistência deriva de **PersistenceParticipant** classe e pode implementar o **CollectValues** e **MapValues** métodos.</span><span class="sxs-lookup"><span data-stu-id="fc98b-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="fc98b-121">Um participante de e/s de persistência deriva de **PersistenceIOParticipant** classe e pode implementar o **BeginOnSave** método além de implementar o **CollectValues**e **MapValues** métodos.</span><span class="sxs-lookup"><span data-stu-id="fc98b-121">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="fc98b-122">Cada etapa é concluída antes que a fase seguir inicia.</span><span class="sxs-lookup"><span data-stu-id="fc98b-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="fc98b-123">Por exemplo, os valores são coletados dos **todos os** participantes de persistência no primeiro estágio.</span><span class="sxs-lookup"><span data-stu-id="fc98b-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="fc98b-124">Todos os valores coletados na primeira etapa são fornecidos na todos os participantes de persistência na segunda etapa mapeando.</span><span class="sxs-lookup"><span data-stu-id="fc98b-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="fc98b-125">Em todos os valores coletados e mapeados no primeiro e na segunda etapas são fornecidos para o provedor de persistência na terceira etapa, e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="fc98b-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="fc98b-126">A lista a seguir descreve as tarefas executadas pelo subsistema de persistência em diferentes estágios da operação de carregamento.</span><span class="sxs-lookup"><span data-stu-id="fc98b-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="fc98b-127">Os participantes de persistência são usados na quarta fase.</span><span class="sxs-lookup"><span data-stu-id="fc98b-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="fc98b-128">Os participantes de e/s de persistência (participantes de persistência que também participam em operações de e/s) também são usados na terceira etapa.</span><span class="sxs-lookup"><span data-stu-id="fc98b-128">The persistence I/O participants (persistence participants that also participate in I/O operations) are also used in the third stage.</span></span>  
  
1.  <span data-ttu-id="fc98b-129">Coleta todos os participantes de persistência que foram adicionados à coleção de extensão associada com a instância de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc98b-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2.  <span data-ttu-id="fc98b-130">Carrega o fluxo de trabalho do armazenamento de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-130">Loads the workflow from the persistence store.</span></span>  
  
3.  <span data-ttu-id="fc98b-131">Invoca o <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> em todos os participantes de e/s de persistência e aguarda todos os participantes de persistência concluir.</span><span class="sxs-lookup"><span data-stu-id="fc98b-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence I/O participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="fc98b-132">Se o episódio de persistência é transacional, a transação é fornecida em Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="fc98b-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4.  <span data-ttu-id="fc98b-133">Carrega a instância de fluxo de trabalho na memória com base nos dados recuperados do armazenamento de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5.  <span data-ttu-id="fc98b-134">Chama o <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> em cada participante de persistência.</span><span class="sxs-lookup"><span data-stu-id="fc98b-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="fc98b-135">Um participante de persistência deriva de **PersistenceParticipant** classe e pode implementar o **PublishValues** método.</span><span class="sxs-lookup"><span data-stu-id="fc98b-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="fc98b-136">Um participante de e/s de persistência deriva de **PersistenceIOParticipant** classe e pode implementar o **BeginOnLoad** método além de implementar o **PublishValues**método.</span><span class="sxs-lookup"><span data-stu-id="fc98b-136">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="fc98b-137">Ao carregar uma instância de fluxo de trabalho o provedor de persistência cria um bloqueio nessa instância.</span><span class="sxs-lookup"><span data-stu-id="fc98b-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="fc98b-138">Isso impede que a instância é carregada por mais de um host em um cenário com vários nós.</span><span class="sxs-lookup"><span data-stu-id="fc98b-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="fc98b-139">Se você tentar carregar uma instância de fluxo de trabalho que foi bloqueada, você verá uma exceção semelhante ao seguinte: A exceção "System.ServiceModel.Persistence.InstanceLockException: A operação solicitada não pôde ser concluída porque o bloqueio por exemplo ' 00000000-0000-0000-0000-000000000000' não foi possível adquirir ".</span><span class="sxs-lookup"><span data-stu-id="fc98b-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="fc98b-140">Esse erro é causado quando ocorre um destes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="fc98b-140">This error is caused when one of the following occurs:</span></span>  
  
-   <span data-ttu-id="fc98b-141">Em um cenário com vários nós a instância é carregada por outro host.</span><span class="sxs-lookup"><span data-stu-id="fc98b-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="fc98b-142">Há algumas maneiras diferentes para resolver esses tipos de conflitos: encaminhar o processamento para o nó que possui o bloqueio e a nova tentativa, ou forçar a carga que fará com que o outro host é possível de salvar seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc98b-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
-   <span data-ttu-id="fc98b-143">Em um cenário de único nó e no host falhou.</span><span class="sxs-lookup"><span data-stu-id="fc98b-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="fc98b-144">Quando o host inicia anterior novamente (um processo reciclar ou criando uma nova factory do provedor de persistência) o novo host tenta carregar uma instância que é bloqueada ainda pelo host antigo porque o bloqueio ainda não expirou.</span><span class="sxs-lookup"><span data-stu-id="fc98b-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
-   <span data-ttu-id="fc98b-145">Em um cenário de único nó e na instância em questão foi anuladas em algum ponto e uma nova instância do provedor de persistência é criada que tenha uma identificação diferente do host</span><span class="sxs-lookup"><span data-stu-id="fc98b-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="fc98b-146">O valor de tempo limite de bloqueio tem um valor padrão de 5 minutos, você pode especificar um valor de tempo limite diferente ao chamar <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span><span class="sxs-lookup"><span data-stu-id="fc98b-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="fc98b-147">Nesta seção</span><span class="sxs-lookup"><span data-stu-id="fc98b-147">In This Section</span></span>  
  
-   [<span data-ttu-id="fc98b-148">Como: Criar um participante personalizado de persistência</span><span class="sxs-lookup"><span data-stu-id="fc98b-148">How to: Create a Custom Persistence Participant</span></span>](how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="fc98b-149">Consulte também</span><span class="sxs-lookup"><span data-stu-id="fc98b-149">See also</span></span>
- [<span data-ttu-id="fc98b-150">Extensibilidade de repositório</span><span class="sxs-lookup"><span data-stu-id="fc98b-150">Store Extensibility</span></span>](store-extensibility.md)
