---
title: Criando fluxos de trabalho, atividades e expressões de design usando o código obrigatório
ms.date: 03/30/2017
ms.assetid: cefc9cfc-2882-4eb9-8c94-7a6da957f2b2
ms.openlocfilehash: ebc093bf8cd3e87bc04c20e93415aa1d2d2f7867
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2018
ms.locfileid: "33520468"
---
# <a name="authoring-workflows-activities-and-expressions-using-imperative-code"></a><span data-ttu-id="27e72-102">Criando fluxos de trabalho, atividades e expressões de design usando o código obrigatório</span><span class="sxs-lookup"><span data-stu-id="27e72-102">Authoring Workflows, Activities, and Expressions Using Imperative Code</span></span>
<span data-ttu-id="27e72-103">Uma definição de fluxo de trabalho é uma árvore de objetos de atividade configurados.</span><span class="sxs-lookup"><span data-stu-id="27e72-103">A workflow definition is a tree of configured activity objects.</span></span> <span data-ttu-id="27e72-104">Essa árvore de atividades pode ser definida de muitas maneiras, incluindo pela edição manual do XAML ou usando o Designer de Fluxo de Trabalho para gerar XAML.</span><span class="sxs-lookup"><span data-stu-id="27e72-104">This tree of activities can be defined many ways, including by hand-editing XAML or by using the Workflow Designer to produce XAML.</span></span> <span data-ttu-id="27e72-105">O uso de XAML, porém, não é um requisito.</span><span class="sxs-lookup"><span data-stu-id="27e72-105">Use of XAML, however, is not a requirement.</span></span> <span data-ttu-id="27e72-106">As definições de fluxo de trabalho também podem ser criadas programaticamente.</span><span class="sxs-lookup"><span data-stu-id="27e72-106">Workflow definitions can also be created programmatically.</span></span> <span data-ttu-id="27e72-107">Este tópico fornece uma visão geral de como criar definições, atividades e expressões de fluxo de trabalho usando código.</span><span class="sxs-lookup"><span data-stu-id="27e72-107">This topic provides an overview of creating workflow definitions, activities, and expressions by using code.</span></span> <span data-ttu-id="27e72-108">Para obter exemplos de como trabalhar com fluxos de trabalho XAML usando o código, consulte [serializando fluxos de trabalho e atividades para e do XAML](../../../docs/framework/windows-workflow-foundation/serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="27e72-108">For examples of working with XAML workflows using code, see [Serializing Workflows and Activities to and from XAML](../../../docs/framework/windows-workflow-foundation/serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
## <a name="creating-workflow-definitions"></a><span data-ttu-id="27e72-109">Criando definições de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="27e72-109">Creating Workflow Definitions</span></span>  
 <span data-ttu-id="27e72-110">Uma definição de fluxo de trabalho pode ser criada criando uma instância de um tipo de atividade e configurando as propriedades do objeto da atividade.</span><span class="sxs-lookup"><span data-stu-id="27e72-110">A workflow definition can be created by instantiating an instance of an activity type and configuring the activity object’s properties.</span></span> <span data-ttu-id="27e72-111">Para atividades que não contêm atividades filho, isso pode ser feito usando algumas linhas de código.</span><span class="sxs-lookup"><span data-stu-id="27e72-111">For activities that do not contain child activities, this can be accomplished using a few lines of code.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#47](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#47)]  
  
> [!NOTE]
>  <span data-ttu-id="27e72-112">Os exemplos deste tópico usam <xref:System.Activities.WorkflowInvoker> para executar fluxos de trabalho de exemplo.</span><span class="sxs-lookup"><span data-stu-id="27e72-112">The examples in this topic use <xref:System.Activities.WorkflowInvoker> to run the sample workflows.</span></span> <span data-ttu-id="27e72-113">Para obter mais informações sobre como chamar fluxos de trabalho, passando argumentos e as diferentes opções de hospedagem que estão disponíveis, consulte [usando WorkflowInvoker e WorkflowApplication](../../../docs/framework/windows-workflow-foundation/using-workflowinvoker-and-workflowapplication.md).</span><span class="sxs-lookup"><span data-stu-id="27e72-113">For more information about invoking workflows, passing arguments, and the different hosting choices that are available, see [Using WorkflowInvoker and WorkflowApplication](../../../docs/framework/windows-workflow-foundation/using-workflowinvoker-and-workflowapplication.md).</span></span>  
  
 <span data-ttu-id="27e72-114">Neste exemplo, um fluxo de trabalho que consiste em uma única atividade <xref:System.Activities.Statements.WriteLine> é criado.</span><span class="sxs-lookup"><span data-stu-id="27e72-114">In this example, a workflow that consists of a single <xref:System.Activities.Statements.WriteLine> activity is created.</span></span> <span data-ttu-id="27e72-115">O argumento <xref:System.Activities.Statements.WriteLine> da atividade <xref:System.Activities.Statements.WriteLine.Text%2A> está definido e o fluxo de trabalho é invocado.</span><span class="sxs-lookup"><span data-stu-id="27e72-115">The <xref:System.Activities.Statements.WriteLine> activity’s <xref:System.Activities.Statements.WriteLine.Text%2A> argument is set, and the workflow is invoked.</span></span> <span data-ttu-id="27e72-116">Se uma atividade contiver atividades filhos, o método de criação será semelhante.</span><span class="sxs-lookup"><span data-stu-id="27e72-116">If an activity contains child activities, the method of construction is similar.</span></span> <span data-ttu-id="27e72-117">O exemplo a seguir usa uma atividade <xref:System.Activities.Statements.Sequence> que contém duas atividades <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="27e72-117">The following example uses a <xref:System.Activities.Statements.Sequence> activity that contains two <xref:System.Activities.Statements.WriteLine> activities.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#48](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#48)]  
  
### <a name="using-object-initializers"></a><span data-ttu-id="27e72-118">Usando inicializadores de objeto</span><span class="sxs-lookup"><span data-stu-id="27e72-118">Using Object Initializers</span></span>  
 <span data-ttu-id="27e72-119">Os exemplos deste tópico usam sintaxe de inicialização de objeto.</span><span class="sxs-lookup"><span data-stu-id="27e72-119">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="27e72-120">A sintaxe de inicialização de objeto pode ser uma maneira útil de criar definições de fluxo de trabalho no código porque fornece uma exibição hierárquica das atividades no fluxo de trabalho e mostra a relação entre as atividades.</span><span class="sxs-lookup"><span data-stu-id="27e72-120">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="27e72-121">Não há nenhum requisito para usar a sintaxe de inicialização de objeto quando você cria fluxos de trabalho programaticamente.</span><span class="sxs-lookup"><span data-stu-id="27e72-121">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="27e72-122">O exemplo a seguir é funcionalmente equivalente ao exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="27e72-122">The following example is functionally equivalent to the previous example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#49](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#49)]  
  
 <span data-ttu-id="27e72-123">Para obter mais informações sobre os inicializadores de objeto, consulte [como: inicializar objetos sem chamar um construtor (c# Programming Guide)](http://go.microsoft.com/fwlink/?LinkId=161015) e [como: declarar um objeto usando um inicializador de objeto](http://go.microsoft.com/fwlink/?LinkId=161016).</span><span class="sxs-lookup"><span data-stu-id="27e72-123">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](http://go.microsoft.com/fwlink/?LinkId=161015) and [How to: Declare an Object by Using an Object Initializer](http://go.microsoft.com/fwlink/?LinkId=161016).</span></span>  
  
### <a name="working-with-variables-literal-values-and-expressions"></a><span data-ttu-id="27e72-124">Trabalhando com variáveis, valores literais e expressões</span><span class="sxs-lookup"><span data-stu-id="27e72-124">Working with Variables, Literal Values, and Expressions</span></span>  
 <span data-ttu-id="27e72-125">Ao criar uma definição de fluxo de trabalho usando código, saiba qual código é executado como parte da criação da definição de fluxo de trabalho e qual código é executado como parte da execução de uma instância desse fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-125">When creating a workflow definition using code, be aware of what code executes as part of the creation of the workflow definition and what code executes as part of the execution of an instance of that workflow.</span></span> <span data-ttu-id="27e72-126">Por exemplo, o seguinte fluxo de trabalho é destinado para gerar um número aleatório e gravá-lo no console.</span><span class="sxs-lookup"><span data-stu-id="27e72-126">For example, the following workflow is intended to generate a random number and write it to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#50](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#50)]  
  
 <span data-ttu-id="27e72-127">Quando esse código da definição de fluxo de trabalho é executado, a chamada para `Random.Next` é feita e o resultado é armazenado na definição do fluxo de trabalho como um valor literal.</span><span class="sxs-lookup"><span data-stu-id="27e72-127">When this workflow definition code is executed, the call to `Random.Next` is made and the result is stored in the workflow definition as a literal value.</span></span> <span data-ttu-id="27e72-128">Muitas instâncias desse fluxo de trabalho podem ser chamadas e todos exibiriam o mesmo número.</span><span class="sxs-lookup"><span data-stu-id="27e72-128">Many instances of this workflow can be invoked, and all would display the same number.</span></span> <span data-ttu-id="27e72-129">Para que a geração de números aleatórios ocorra durante a execução do fluxo de trabalho, deve ser usada uma expressão que é avaliada toda vez que o fluxo de trabalho é executado.</span><span class="sxs-lookup"><span data-stu-id="27e72-129">To have the random number generation occur during workflow execution, an expression must be used that is evaluated each time the workflow runs.</span></span> <span data-ttu-id="27e72-130">No exemplo a seguir, uma expressão do Visual Basic é usada com um <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span><span class="sxs-lookup"><span data-stu-id="27e72-130">In the following example, a Visual Basic expression is used with a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="27e72-131">A expressão no exemplo anterior também poderia ser implementada usando um <xref:Microsoft.CSharp.Activities.CSharpValue%601> e uma expressão C#.</span><span class="sxs-lookup"><span data-stu-id="27e72-131">The expression in the previous example could also be implemented using a <xref:Microsoft.CSharp.Activities.CSharpValue%601> and a C# expression.</span></span>  
  
```csharp  
new Assign<int>  
{  
    To = n,  
    Value = new CSharpValue<int>("new Random().Next(1, 101)")  
}  
```  
  
 <span data-ttu-id="27e72-132">As expressões C# devem ser compiladas antes que o fluxo de trabalho que as contém seja invocado.</span><span class="sxs-lookup"><span data-stu-id="27e72-132">C# expressions must be compiled before the workflow containing them is invoked.</span></span> <span data-ttu-id="27e72-133">Se as expressões c# não são compiladas, um <xref:System.NotSupportedException> é gerada quando o fluxo de trabalho é invocado com uma mensagem semelhante à seguinte: `Expression Activity type 'CSharpValue`1' requer compilação para executar.</span><span class="sxs-lookup"><span data-stu-id="27e72-133">If the C# expressions are not compiled, a <xref:System.NotSupportedException> is thrown when the workflow is invoked with a message similar to the following: `Expression Activity type 'CSharpValue`1' requires compilation in order to run.</span></span>  <span data-ttu-id="27e72-134">Certifique-se de que o fluxo de trabalho foi compilado.' na maioria dos cenários que envolvem fluxos de trabalho criados no Visual Studio c# expressões são compiladas automaticamente, mas em alguns cenários, como fluxos de trabalho de código, as expressões c# devem ser compiladas manualmente.</span><span class="sxs-lookup"><span data-stu-id="27e72-134">Please ensure that the workflow has been compiled.\` In most scenarios involving workflows created in Visual Studio the C# expressions are compiled automatically, but in some scenarios, such as code workflows, the C# expressions must be manually compiled.</span></span> <span data-ttu-id="27e72-135">Para obter um exemplo de como compilar expressões c#, consulte o [usando c# expressões em fluxos de trabalho de código](../../../docs/framework/windows-workflow-foundation/csharp-expressions.md#CodeWorkflows) seção o [expressões c#](../../../docs/framework/windows-workflow-foundation/csharp-expressions.md) tópico.</span><span class="sxs-lookup"><span data-stu-id="27e72-135">For an example of how to compile C# expressions, see the [Using C# expressions in code workflows](../../../docs/framework/windows-workflow-foundation/csharp-expressions.md#CodeWorkflows) section of the [C# Expressions](../../../docs/framework/windows-workflow-foundation/csharp-expressions.md) topic.</span></span>  
  
 <span data-ttu-id="27e72-136">Um <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> representa uma expressão na sintaxe do Visual Basic que pode ser usada como um valor r em uma expressão, e um <xref:Microsoft.CSharp.Activities.CSharpValue%601> representa uma expressão na sintaxe C# que pode ser usada como um valor r de uma expressão.</span><span class="sxs-lookup"><span data-stu-id="27e72-136">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> represents an expression in Visual Basic syntax that can be used as an r-value in an expression, and a <xref:Microsoft.CSharp.Activities.CSharpValue%601> represents an expression in C# syntax that can be used as an r-value in an expression.</span></span> <span data-ttu-id="27e72-137">Essas expressões são avaliadas cada vez que a atividade contentora é executada.</span><span class="sxs-lookup"><span data-stu-id="27e72-137">These expressions are evaluated each time the containing activity is executed.</span></span> <span data-ttu-id="27e72-138">O resultado da expressão é atribuído à variável de fluxo de trabalho `n`, e esses resultados são usados pela próxima atividade no fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-138">The result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="27e72-139">Para acessar o valor da `n` do fluxo de trabalho em tempo de execução, o <xref:System.Activities.ActivityContext> é necessário.</span><span class="sxs-lookup"><span data-stu-id="27e72-139">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="27e72-140">Isso pode ser acessado usando a seguinte expressão lambda.</span><span class="sxs-lookup"><span data-stu-id="27e72-140">This can be accessed by using the following lambda expression.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="27e72-141">Observe que esses dois códigos são exemplos que usam C# como a linguagem de programação, mas um usa um <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> e o outro usa um <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span><span class="sxs-lookup"><span data-stu-id="27e72-141">Note that both of these code are examples are using C# as the programming language, but one uses a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and one uses a <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span></span> <span data-ttu-id="27e72-142"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> e <xref:Microsoft.CSharp.Activities.CSharpValue%601> podem ser usados em projetos do Visual Basic e C#.</span><span class="sxs-lookup"><span data-stu-id="27e72-142"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and <xref:Microsoft.CSharp.Activities.CSharpValue%601> can be used in both Visual Basic and C# projects.</span></span> <span data-ttu-id="27e72-143">Por padrão, as expressões criadas no designer de fluxo de trabalho correspondem à linguagem do projeto de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="27e72-143">By default, expressions created in the workflow designer match the language of the hosting project.</span></span> <span data-ttu-id="27e72-144">Ao criar fluxos de trabalho no código, a linguagem desejada fica a critério do autor do fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-144">When creating workflows in code, the desired language is at the discretion of the workflow author.</span></span>  
  
 <span data-ttu-id="27e72-145">Nestes exemplos, o resultado da expressão é atribuído à variável `n` do fluxo de trabalho, e esses resultados são usados pela atividade a seguir no fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-145">In these examples the result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="27e72-146">Para acessar o valor da `n` do fluxo de trabalho em tempo de execução, o <xref:System.Activities.ActivityContext> é necessário.</span><span class="sxs-lookup"><span data-stu-id="27e72-146">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="27e72-147">Isso pode ser acessado usando a seguinte expressão lambda.</span><span class="sxs-lookup"><span data-stu-id="27e72-147">This can be accessed by using the following lambda expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#52](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#52)]  
  
 <span data-ttu-id="27e72-148">Para obter mais informações sobre expressões lambda, consulte [expressões Lambda (guia de programação c#)](http://go.microsoft.com/fwlink/?LinkID=152436) ou [expressões Lambda (Visual Basic)](http://go.microsoft.com/fwlink/?LinkID=152437).</span><span class="sxs-lookup"><span data-stu-id="27e72-148">For more information about lambda expressions, see [Lambda Expressions (C# Programming Guide)](http://go.microsoft.com/fwlink/?LinkID=152436) or [Lambda Expressions (Visual Basic)](http://go.microsoft.com/fwlink/?LinkID=152437).</span></span>  
  
 <span data-ttu-id="27e72-149">As expressões lambda não são serializáveis para o formato XAML.</span><span class="sxs-lookup"><span data-stu-id="27e72-149">Lambda expressions are not serializable to XAML format.</span></span> <span data-ttu-id="27e72-150">Se uma tentativa para serializar um fluxo de trabalho com expressões lambda for feita, um <xref:System.Activities.Expressions.LambdaSerializationException> será gerado com a seguinte mensagem: “Esse fluxo de trabalho contém as expressões lambda especificadas no código.</span><span class="sxs-lookup"><span data-stu-id="27e72-150">If an attempt to serialize a workflow with lambda expressions is made, a <xref:System.Activities.Expressions.LambdaSerializationException> is thrown with the following message: "This workflow contains lambda expressions specified in code.</span></span> <span data-ttu-id="27e72-151">Essas expressões não são XAML serializável.</span><span class="sxs-lookup"><span data-stu-id="27e72-151">These expressions are not XAML serializable.</span></span> <span data-ttu-id="27e72-152">Para tornar serializável a XAML de seu fluxo de trabalho, use VisualBasicValue/VisualBasicReference ou ExpressionServices.Convert(lambda).</span><span class="sxs-lookup"><span data-stu-id="27e72-152">In order to make your workflow XAML-serializable, either use VisualBasicValue/VisualBasicReference or ExpressionServices.Convert(lambda).</span></span> <span data-ttu-id="27e72-153">Isso fará as expressões lambda serem convertidas em atividades de expressão."</span><span class="sxs-lookup"><span data-stu-id="27e72-153">This will convert your lambda expressions into expression activities."</span></span> <span data-ttu-id="27e72-154">Para tornar essa expressão compatível com XAML, use <xref:System.Activities.Expressions.ExpressionServices> e <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="27e72-154">To make this expression compatible with XAML, use <xref:System.Activities.Expressions.ExpressionServices> and <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#53](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#53)]  
  
 <span data-ttu-id="27e72-155">Um <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> também poderia ser usado.</span><span class="sxs-lookup"><span data-stu-id="27e72-155">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> could also be used.</span></span> <span data-ttu-id="27e72-156">Observe que nenhuma expressão lambda é necessária ao usar uma expressão do Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="27e72-156">Note that no lambda expression is required when using a Visual Basic expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#54](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#54)]  
  
 <span data-ttu-id="27e72-157">Em tempo de execução, as expressões do Visual Basic são compiladas em expressões LINQ.</span><span class="sxs-lookup"><span data-stu-id="27e72-157">At run time, Visual Basic expressions are compiled into LINQ expressions.</span></span> <span data-ttu-id="27e72-158">Os dois exemplos anteriores são serializáveis para XAML, mas se o XAML serializado for destinado para ser exibido e editado no designer de fluxo de trabalho, use a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> para suas expressões.</span><span class="sxs-lookup"><span data-stu-id="27e72-158">Both of the previous examples are serializable to XAML, but if the serialized XAML is intended to be viewed and edited in the workflow designer, use <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> for your expressions.</span></span> <span data-ttu-id="27e72-159">Os fluxos de trabalho serializados que usam `ExpressionServices.Convert` podem ser abertos no designer, mas o valor da expressão ficará em branco.</span><span class="sxs-lookup"><span data-stu-id="27e72-159">Serialized workflows that use `ExpressionServices.Convert` can be opened in the designer, but the value of the expression will be blank.</span></span> <span data-ttu-id="27e72-160">Para obter mais informações sobre a serialização de fluxos de trabalho em XAML, consulte [serializando fluxos de trabalho e atividades para e do XAML](../../../docs/framework/windows-workflow-foundation/serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="27e72-160">For more information about serializing workflows to XAML, see [Serializing Workflows and Activities to and from XAML](../../../docs/framework/windows-workflow-foundation/serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
#### <a name="literal-expressions-and-reference-types"></a><span data-ttu-id="27e72-161">Expressões literais e tipos de referência</span><span class="sxs-lookup"><span data-stu-id="27e72-161">Literal Expressions and Reference Types</span></span>  
 <span data-ttu-id="27e72-162">As expressões literais são representadas nos fluxos de trabalho pela atividade <xref:System.Activities.Expressions.Literal%601>.</span><span class="sxs-lookup"><span data-stu-id="27e72-162">Literal expressions are represented in workflows by the <xref:System.Activities.Expressions.Literal%601> activity.</span></span> <span data-ttu-id="27e72-163">As seguintes atividades <xref:System.Activities.Statements.WriteLine> são funcionalmente equivalentes.</span><span class="sxs-lookup"><span data-stu-id="27e72-163">The following <xref:System.Activities.Statements.WriteLine> activities are functionally equivalent.</span></span>  
  
```csharp  
new WriteLine  
{  
    Text = "Hello World."  
},  
new WriteLine  
{  
    Text = new Literal<string>("Hello World.")  
}  
```  
  
 <span data-ttu-id="27e72-164">Não é válido inicializar uma expressão literal com qualquer tipo de referência exceto <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="27e72-164">It is invalid to initialize a literal expression with any reference type except <xref:System.String>.</span></span> <span data-ttu-id="27e72-165">No exemplo a seguir, a propriedade <xref:System.Activities.Statements.Assign> de uma atividade <xref:System.Activities.Statements.Assign.Value%2A> é inicializada com uma expressão literal usando `List<string>`.</span><span class="sxs-lookup"><span data-stu-id="27e72-165">In the following example, an <xref:System.Activities.Statements.Assign> activity's <xref:System.Activities.Statements.Assign.Value%2A> property is initialized with a literal expression using a `List<string>`.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new List<string>())  
},  
```  
  
 <span data-ttu-id="27e72-166">Quando o fluxo de trabalho que contém esta atividade é validado, o seguinte erro de validação será retornado: "O literal somente oferece suporte aos tipos de valor e ao tipo imutável System.String.</span><span class="sxs-lookup"><span data-stu-id="27e72-166">When the workflow containing this activity is validated, the following validation error is returned: "Literal only supports value types and the immutable type System.String.</span></span> <span data-ttu-id="27e72-167">O tipo System.Collections.Generic.List\`1[System.String] não pode ser usado como um literal."</span><span class="sxs-lookup"><span data-stu-id="27e72-167">The type System.Collections.Generic.List\`1[System.String] cannot be used as a literal."</span></span> <span data-ttu-id="27e72-168">Se o fluxo de trabalho for chamado, uma <xref:System.Activities.InvalidWorkflowException> será gerada que contém o texto do erro de validação.</span><span class="sxs-lookup"><span data-stu-id="27e72-168">If the workflow is invoked, an <xref:System.Activities.InvalidWorkflowException> is thrown that contains the text of the validation error.</span></span> <span data-ttu-id="27e72-169">Este é um erro de validação porque criar uma expressão literal com um tipo de referência não cria uma nova instância do tipo de referência para cada instância do fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-169">This is a validation error because creating a literal expression with a reference type does not create a new instance of the reference type for each instance of the workflow.</span></span> <span data-ttu-id="27e72-170">Para resolver isso, substitua a expressão literal por uma que cria e retorna uma nova instância do tipo de referência.</span><span class="sxs-lookup"><span data-stu-id="27e72-170">To resolve this, replace the literal expression with one that creates and returns a new instance of the reference type.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new VisualBasicValue<List<string>>("New List(Of String)"))  
},  
```  
  
 <span data-ttu-id="27e72-171">Para obter mais informações sobre expressões, consulte [expressões](../../../docs/framework/windows-workflow-foundation/expressions.md).</span><span class="sxs-lookup"><span data-stu-id="27e72-171">For more information about expressions, see [Expressions](../../../docs/framework/windows-workflow-foundation/expressions.md).</span></span>  
  
#### <a name="invoking-methods-on-objects-using-expressions-and-the-invokemethod-activity"></a><span data-ttu-id="27e72-172">Invocando métodos em objetos usando expressões e a atividade InvokeMethod</span><span class="sxs-lookup"><span data-stu-id="27e72-172">Invoking Methods on Objects using Expressions and the InvokeMethod Activity</span></span>  
 <span data-ttu-id="27e72-173">A atividade <xref:System.Activities.Expressions.InvokeMethod%601> pode ser usada para invocar métodos estáticos e de instância de classes no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="27e72-173">The <xref:System.Activities.Expressions.InvokeMethod%601> activity can be used to invoke static and instance methods of classes in the .NET Framework.</span></span> <span data-ttu-id="27e72-174">Em um exemplo anterior neste tópico, um número aleatório foi gerado usando a classe <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="27e72-174">In a previous example in this topic, a random number was generated using the <xref:System.Random> class.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="27e72-175">A atividade <xref:System.Activities.Expressions.InvokeMethod%601> também poderia ter sido usada para chamar o método <xref:System.Random.Next%2A> da classe <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="27e72-175">The <xref:System.Activities.Expressions.InvokeMethod%601> activity could also have been used to call the <xref:System.Random.Next%2A> method of the <xref:System.Random> class.</span></span>  
  
```csharp  
new InvokeMethod<int>  
{  
    TargetObject = new InArgument<Random>(new VisualBasicValue<Random>("New Random()")),  
    MethodName = "Next",  
    Parameters =   
    {  
        new InArgument<int>(1),  
        new InArgument<int>(101)  
    },  
    Result = n  
}  
```  
  
 <span data-ttu-id="27e72-176">Como <xref:System.Random.Next%2A> não é um método estático, uma instância da classe <xref:System.Random> é fornecida para a propriedade <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="27e72-176">Since <xref:System.Random.Next%2A> is not a static method, an instance of the <xref:System.Random> class is supplied for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A> property.</span></span> <span data-ttu-id="27e72-177">Neste exemplo, uma nova instância é criada usando uma expressão do Visual Basic, mas também poderia ter sido criada anteriormente e armazenada em uma variável do fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-177">In this example a new instance is created using a Visual Basic expression, but it could also have been created previously and stored in a workflow variable.</span></span> <span data-ttu-id="27e72-178">Neste exemplo, seria mais simples usar a atividade <xref:System.Activities.Statements.Assign%601> em vez da atividade <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="27e72-178">In this example, it would be simpler to use the <xref:System.Activities.Statements.Assign%601> activity instead of the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="27e72-179">Se a chamada do método chamado finalmente pelas atividades <xref:System.Activities.Statements.Assign%601> ou <xref:System.Activities.Expressions.InvokeMethod%601> for longa, o <xref:System.Activities.Expressions.InvokeMethod%601> terá uma vantagem porque tem uma propriedade <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A>.</span><span class="sxs-lookup"><span data-stu-id="27e72-179">If the method call ultimately invoked by either the <xref:System.Activities.Statements.Assign%601> or <xref:System.Activities.Expressions.InvokeMethod%601> activities is long running, <xref:System.Activities.Expressions.InvokeMethod%601> has an advantage since it has a <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> property.</span></span> <span data-ttu-id="27e72-180">Quando esta propriedade for definida como `true`, o método chamado será executado de forma assíncrona em relação ao fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="27e72-180">When this property is set to `true`, the invoked method will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="27e72-181">Se outras atividades estiverem em paralelo, elas não serão bloqueadas enquanto o método estiver em execução de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="27e72-181">If other activities are in parallel, they will not be blocked while the method is asynchronously executing.</span></span> <span data-ttu-id="27e72-182">Além disso, se o método a ser chamado não tiver nenhum valor de retorno, então <xref:System.Activities.Expressions.InvokeMethod%601> será o modo apropriado de chamar o método.</span><span class="sxs-lookup"><span data-stu-id="27e72-182">Also, if the method to be invoked has no return value, then <xref:System.Activities.Expressions.InvokeMethod%601> is the appropriate way to invoke the method.</span></span>  
  
## <a name="arguments-and-dynamic-activities"></a><span data-ttu-id="27e72-183">Argumentos e atividades dinâmicas</span><span class="sxs-lookup"><span data-stu-id="27e72-183">Arguments and Dynamic Activities</span></span>  
 <span data-ttu-id="27e72-184">Uma definição de fluxo de trabalho é criada no código montando atividades em uma árvore de atividade e configurando as propriedades e os argumentos.</span><span class="sxs-lookup"><span data-stu-id="27e72-184">A workflow definition is created in code by assembling activities into an activity tree and configuring any properties and arguments.</span></span> <span data-ttu-id="27e72-185">Os argumentos existentes podem ser associados, mas novos argumentos não podem ser adicionados às atividades.</span><span class="sxs-lookup"><span data-stu-id="27e72-185">Existing arguments can be bound, but new arguments cannot be added to activities.</span></span> <span data-ttu-id="27e72-186">Isso inclui os argumentos de fluxo de trabalho passados para a atividade raiz.</span><span class="sxs-lookup"><span data-stu-id="27e72-186">This includes workflow arguments passed to the root activity.</span></span> <span data-ttu-id="27e72-187">No código obrigatório, os argumentos de fluxo de trabalho são especificados como propriedades em um novo tipo CLR, e no XAML são declarados usando `x:Class` e `x:Member`.</span><span class="sxs-lookup"><span data-stu-id="27e72-187">In imperative code, workflow arguments are specified as properties on a new CLR type, and in XAML they are declared by using `x:Class` and `x:Member`.</span></span> <span data-ttu-id="27e72-188">Como não há um novo tipo CLR criado quando uma definição de fluxo de trabalho é criada como uma árvore de objetos de memória, os argumentos não poderão ser adicionados.</span><span class="sxs-lookup"><span data-stu-id="27e72-188">Because there is no new CLR type created when a workflow definition is created as a tree of in-memory objects, arguments cannot be added.</span></span> <span data-ttu-id="27e72-189">No entanto, os argumentos podem ser adicionados a um <xref:System.Activities.DynamicActivity>.</span><span class="sxs-lookup"><span data-stu-id="27e72-189">However, arguments can be added to a <xref:System.Activities.DynamicActivity>.</span></span> <span data-ttu-id="27e72-190">Neste exemplo, um <xref:System.Activities.DynamicActivity%601> é criado e usa dois argumentos inteiros, adiciona-os juntos e retorna o resultado.</span><span class="sxs-lookup"><span data-stu-id="27e72-190">In this example, a <xref:System.Activities.DynamicActivity%601> is created that takes two integer arguments, adds them together, and returns the result.</span></span> <span data-ttu-id="27e72-191">Um <xref:System.Activities.DynamicActivityProperty> é criado para cada argumento e o resultado da operação é atribuído ao argumento <xref:System.Activities.Activity%601.Result%2A> do <xref:System.Activities.DynamicActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="27e72-191">A <xref:System.Activities.DynamicActivityProperty> is created for each argument, and the result of the operation is assigned to the <xref:System.Activities.Activity%601.Result%2A> argument of the <xref:System.Activities.DynamicActivity%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#55](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#55)]  
  
 <span data-ttu-id="27e72-192">Para obter mais informações sobre atividades dinâmicas, consulte [criando uma atividade em tempo de execução](../../../docs/framework/windows-workflow-foundation/creating-an-activity-at-runtime-with-dynamicactivity.md).</span><span class="sxs-lookup"><span data-stu-id="27e72-192">For more information about dynamic activities, see [Creating an Activity at Runtime](../../../docs/framework/windows-workflow-foundation/creating-an-activity-at-runtime-with-dynamicactivity.md).</span></span>  
  
## <a name="compiled-activities"></a><span data-ttu-id="27e72-193">Atividades compiladas</span><span class="sxs-lookup"><span data-stu-id="27e72-193">Compiled Activities</span></span>  
 <span data-ttu-id="27e72-194">As atividades dinâmicas são uma forma de definir uma atividade que contém argumentos usando o código, mas as atividades também podem ser criadas em código e compiladas em tipos.</span><span class="sxs-lookup"><span data-stu-id="27e72-194">Dynamic activities are one way to define an activity that contains arguments using code, but activities can also be created in code and compiled into types.</span></span> <span data-ttu-id="27e72-195">As atividades simples podem ser criadas que derivam de <xref:System.Activities.CodeActivity> e as atividades assíncronas que derivam de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="27e72-195">Simple activities can be created that derive from <xref:System.Activities.CodeActivity>, and asynchronous activities that derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="27e72-196">Essas atividades podem ter argumentos, valores de retorno e definir sua lógica usando o código obrigatório.</span><span class="sxs-lookup"><span data-stu-id="27e72-196">These activities can have arguments, return values, and define their logic using imperative code.</span></span> <span data-ttu-id="27e72-197">Para obter exemplos de como criar esses tipos de atividades, consulte [classe de Base de CodeActivity](../../../docs/framework/windows-workflow-foundation/workflow-activity-authoring-using-the-codeactivity-class.md) e [criando atividades assíncronos](../../../docs/framework/windows-workflow-foundation/creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="27e72-197">For examples of creating these types of activities, see [CodeActivity Base Class](../../../docs/framework/windows-workflow-foundation/workflow-activity-authoring-using-the-codeactivity-class.md) and [Creating Asynchronous Activities](../../../docs/framework/windows-workflow-foundation/creating-asynchronous-activities-in-wf.md).</span></span>  
  
 <span data-ttu-id="27e72-198">As atividades que derivam de <xref:System.Activities.NativeActivity> podem definir sua lógica usando o código obrigatório e elas também podem conter as atividades filho que definem a lógica.</span><span class="sxs-lookup"><span data-stu-id="27e72-198">Activities that derive from <xref:System.Activities.NativeActivity> can define their logic using imperative code and they can also contain child activities that define the logic.</span></span> <span data-ttu-id="27e72-199">Elas também têm acesso completo aos recursos de tempo de execução como criar indicadores.</span><span class="sxs-lookup"><span data-stu-id="27e72-199">They also have full access to the features of the runtime such as creating bookmarks.</span></span> <span data-ttu-id="27e72-200">Para obter exemplos de criação de um <xref:System.Activities.NativeActivity>-com base em atividade, consulte [classe de Base de NativeActivity](../../../docs/framework/windows-workflow-foundation/nativeactivity-base-class.md), [como: criar uma atividade](../../../docs/framework/windows-workflow-foundation/how-to-create-an-activity.md)e o [composto personalizado usando a atividade nativo](../../../docs/framework/windows-workflow-foundation/samples/custom-composite-using-native-activity.md)exemplo.</span><span class="sxs-lookup"><span data-stu-id="27e72-200">For examples of creating a <xref:System.Activities.NativeActivity>-based activity, see [NativeActivity Base Class](../../../docs/framework/windows-workflow-foundation/nativeactivity-base-class.md), [How to: Create an Activity](../../../docs/framework/windows-workflow-foundation/how-to-create-an-activity.md), and the [Custom Composite using Native Activity](../../../docs/framework/windows-workflow-foundation/samples/custom-composite-using-native-activity.md) sample.</span></span>  
  
 <span data-ttu-id="27e72-201">As atividades que derivam do <xref:System.Activities.Activity> definem sua lógica somente por meio do uso de atividades filho.</span><span class="sxs-lookup"><span data-stu-id="27e72-201">Activities that derive from <xref:System.Activities.Activity> define their logic solely through the use of child activities.</span></span> <span data-ttu-id="27e72-202">Essas atividades normalmente são criadas usando o designer de fluxo de trabalho, mas também podem ser definidas usando código.</span><span class="sxs-lookup"><span data-stu-id="27e72-202">These activities are typically created by using the workflow designer, but can also be defined by using code.</span></span> <span data-ttu-id="27e72-203">No exemplo a seguir, uma atividade `Square` é definida que deriva de `Activity<int>`.</span><span class="sxs-lookup"><span data-stu-id="27e72-203">In the following example, a `Square` activity is defined that derives from `Activity<int>`.</span></span> <span data-ttu-id="27e72-204">A atividade `Square` tem único <xref:System.Activities.InArgument%601> chamado `Value` e define sua lógica especificando uma atividade <xref:System.Activities.Statements.Sequence> usando a propriedade <xref:System.Activities.Activity.Implementation%2A>.</span><span class="sxs-lookup"><span data-stu-id="27e72-204">The `Square` activity has a single <xref:System.Activities.InArgument%601> named `Value`, and defines its logic by specifying a <xref:System.Activities.Statements.Sequence> activity using the <xref:System.Activities.Activity.Implementation%2A> property.</span></span> <span data-ttu-id="27e72-205">A atividade <xref:System.Activities.Statements.Sequence> contém uma atividade <xref:System.Activities.Statements.WriteLine> e uma atividade <xref:System.Activities.Statements.Assign%601>.</span><span class="sxs-lookup"><span data-stu-id="27e72-205">The <xref:System.Activities.Statements.Sequence> activity contains a <xref:System.Activities.Statements.WriteLine> activity and an <xref:System.Activities.Statements.Assign%601> activity.</span></span> <span data-ttu-id="27e72-206">Juntas, essas três atividades implementam a lógica da atividade `Square`.</span><span class="sxs-lookup"><span data-stu-id="27e72-206">Together, these three activities implement the logic of the `Square` activity.</span></span>  
  
```csharp  
class Square : Activity<int>  
{  
    [RequiredArgument]  
    public InArgument<int> Value { get; set; }  
  
    public Square()  
    {  
        this.Implementation = () => new Sequence  
        {  
            Activities =  
            {  
                new WriteLine  
                {  
                    Text = new InArgument<string>((env) => "Squaring the value: " + this.Value.Get(env))  
                },  
                new Assign<int>  
                {  
                    To = new OutArgument<int>((env) => this.Result.Get(env)),  
                    Value = new InArgument<int>((env) => this.Value.Get(env) * this.Value.Get(env))  
                }  
            }  
        };  
    }  
}  
```  
  
 <span data-ttu-id="27e72-207">No exemplo a seguir, uma definição de fluxo de trabalho que consiste em uma única atividade `Square` é invocada usando <xref:System.Activities.WorkflowInvoker>.</span><span class="sxs-lookup"><span data-stu-id="27e72-207">In the following example, a workflow definition consisting of a single `Square` activity is invoked using <xref:System.Activities.WorkflowInvoker>.</span></span>  
  
```csharp  
Dictionary<string, object> inputs = new Dictionary<string, object> {{ "Value", 5}};  
int result = WorkflowInvoker.Invoke(new Square(), inputs);  
Console.WriteLine("Result: {0}", result);  
```  
  
 <span data-ttu-id="27e72-208">Quando o fluxo de trabalho é chamado, a seguinte saída é exibida no console:</span><span class="sxs-lookup"><span data-stu-id="27e72-208">When the workflow is invoked, the following output is displayed to the console:</span></span>  
  
 <span data-ttu-id="27e72-209">**Elevar o valor: 5**</span><span class="sxs-lookup"><span data-stu-id="27e72-209">**Squaring the value: 5**</span></span>  
<span data-ttu-id="27e72-210">**Resultado: 25**</span><span class="sxs-lookup"><span data-stu-id="27e72-210">**Result: 25**</span></span>
