---
title: Desempenho do Windows Workflow Foundation 4
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 5fec41baacca0f35618dd5bc409b88ac792ad125
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79182971"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="6a6e1-102">Desempenho do Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="6a6e1-102">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="6a6e1-103">O .NET Framework 4 inclui uma grande revisão da Windows Workflow Foundation (WF) com pesados investimentos em desempenho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-103">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="6a6e1-104">Esta nova revisão introduz mudanças significativas [!INCLUDE[wf1](../../../includes/wf1-md.md)] de design em relação às versões anteriores do que foi enviado como parte do .NET Framework 3.0 e .NET Framework 3.5.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-104">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="6a6e1-105">Foi re bem - principal do modelo, em runtime, e o trabalho feito com ferramentas de programação melhorar bastante o desempenho e a usabilidade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-105">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="6a6e1-106">Este tópico mostra as características de desempenho importantes dessas revisões e compara-as com essas de versão anterior.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-106">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="6a6e1-107">O desempenho componente de fluxo de trabalho individual disparou por pedidos de magnitude entre WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-107">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="6a6e1-108">Isso faz com que a lacuna entre os serviços de WCF (Windows Communication Foundation) codificados à mão e os serviços de fluxo de trabalho WCF seja bastante pequena.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-108">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="6a6e1-109">A latência de fluxo de trabalho foi reduzida significativamente em WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-109">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="6a6e1-110">O desempenho de persistência gerado por um fator de 2,5 - 3,0.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-110">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="6a6e1-111">Monitoramento da integridade por meio de acompanhamento de fluxo de trabalho tem significativamente menos sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-111">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="6a6e1-112">Essas são razões de migrar ou peso a adotar WF4 em seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-112">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="6a6e1-113">Terminologia</span><span class="sxs-lookup"><span data-stu-id="6a6e1-113">Terminology</span></span>

 <span data-ttu-id="6a6e1-114">A versão [!INCLUDE[wf1](../../../includes/wf1-md.md)] do .NET Framework 4 será referida como WF4 para o resto deste tópico.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-114">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="6a6e1-115">foi introduzido no .NET Framework 3.0 e teve algumas pequenas revisões através do Quadro .NET 3.5 SP1.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-115">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="6a6e1-116">A versão .NET Framework 3.5 da Workflow Foundation será referida como WF3 para o resto deste tópico.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-116">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="6a6e1-117">O WF3 é enviado no .NET Framework 4 lado a lado com o WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-117">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="6a6e1-118">Para obter mais informações sobre a migração de artefatos WF3 para WF4, consulte: [Guia de migração do Windows Workflow Foundation 4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-118">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="6a6e1-119">O Windows Communication Foundation (WCF) é o modelo de programação unificada da Microsoft para a construção de aplicativos orientados a serviços.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-119">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="6a6e1-120">Foi introduzido pela primeira vez como parte do .NET 3.0 juntamente com o WF3 e agora é um dos componentes-chave do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-120">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="6a6e1-121">Windows Server AppFabric é um conjunto de tecnologias integrados que tornam mais fácil criar, redimensionar e gerenciar Web e aplicativos compostos que executam no IIS.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-121">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="6a6e1-122">Fornece ferramentas para monitorar e gerenciar serviços e fluxos de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-122">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="6a6e1-123">Para obter mais informações, consulte [O Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-123">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="6a6e1-124">Metas</span><span class="sxs-lookup"><span data-stu-id="6a6e1-124">Goals</span></span>
 <span data-ttu-id="6a6e1-125">O objetivo deste tópico é mostrar as características de desempenho de WF4 com os dados medidas para diferentes cenários.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-125">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="6a6e1-126">Também fornece comparações detalhadas entre WF4 e WF3, e mostra o grandes aprimoramentos que foram feitas nessa nova revisão.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-126">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="6a6e1-127">Os cenários e os dados apresentados neste artigo determinam o custo subjacentes de diferentes aspectos de WF4 e de WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-127">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="6a6e1-128">Esses dados são úteis para entender as características de desempenho de WF4 e podem ser úteis em migrações de planejamento de WF3 a WF4 ou WF4 de uso durante o desenvolvimento de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-128">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="6a6e1-129">No entanto, cuidado deve ser recolhido as conclusões desenhadas de dados apresentados neste artigo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-129">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="6a6e1-130">O desempenho de um aplicativo de fluxo de trabalho composto é altamente dependente em como o fluxo de trabalho é implementado e como os diferentes componentes são integrados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-130">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="6a6e1-131">Se deve abranger cada aplicativo para determinar as características de desempenho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-131">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="6a6e1-132">Visão geral dos aprimoramentos de desempenho WF4</span><span class="sxs-lookup"><span data-stu-id="6a6e1-132">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="6a6e1-133">WF4 cuidadosamente foi criado e implementado com alto desempenho e escalabilidade que são descritas nas seções.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-133">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="6a6e1-134">Runtime de WF</span><span class="sxs-lookup"><span data-stu-id="6a6e1-134">WF Runtime</span></span>
 <span data-ttu-id="6a6e1-135">O núcleo de runtime de [!INCLUDE[wf1](../../../includes/wf1-md.md)] é um agendador assíncrono que resulta a execução das atividades em um fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-135">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="6a6e1-136">Fornece um ambiente performant, previsível de execução para atividades.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-136">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="6a6e1-137">O ambiente tem um contrato bem definido para execução, a seguir, a conclusão, cancelamento, as exceções, e um modelo de threads previsível.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-137">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="6a6e1-138">Em comparação com WF3, o runtime WF4 tem um agendador mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-138">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="6a6e1-139">Ele aproveita o mesmo pool de segmentos de I/O que é usado para WCF, que é muito eficiente na execução de itens de trabalho em lote.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-139">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="6a6e1-140">A fila de agendador interna de item de trabalho é otimizado para a maioria de padrões comuns de uso.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-140">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="6a6e1-141">O tempo de execução do WF4 também gerencia os estados de execução de forma muito leve com lógica mínima de sincronização e manipulação de eventos, enquanto o WF3 depende do registro e invocação de eventos de peso pesado para realizar sincronização complexa para transições de estado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-141">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="6a6e1-142">Armazenamento de dados e fluxo</span><span class="sxs-lookup"><span data-stu-id="6a6e1-142">Data Storage and Flow</span></span>
 <span data-ttu-id="6a6e1-143">Em WF3, os dados associados com uma atividade são modelados através das propriedades de dependência implementadas pelo tipo <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-143">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="6a6e1-144">O padrão de propriedade de dependência foi introduzido na Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-144">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="6a6e1-145">Normalmente, esse padrão é muito flexível dar suporte à associação fácil de dados e outros recursos de interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-145">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="6a6e1-146">No entanto, o padrão requer as propriedades ser definido como campos estáticos na definição de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-146">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="6a6e1-147">Sempre que o runtime de [!INCLUDE[wf1](../../../includes/wf1-md.md)] obtém ou define os valores de propriedade, envolve a lógica pesado- tornada mais pesada de consulta.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-147">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="6a6e1-148">Lógica clara do escopo de dados dos usos WF4 para melhorar bastante como os dados são tratados em um fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-148">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="6a6e1-149">Separa os dados armazenados em uma atividade dos dados que estão de fluxo através de limites de atividade usando dois conceitos distintos: variáveis e argumentos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-149">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="6a6e1-150">Usando um escopo hierárquico claro para variáveis e argumentos "In/Out/InOut", a complexidade de uso de dados para atividades é drasticamente reduzida e a vida útil dos dados também é automaticamente escopo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-150">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="6a6e1-151">As atividades tem uma assinatura bem definido descrita por seus argumentos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-151">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="6a6e1-152">Simplesmente inspecionando uma atividade você pode determinar que espera dados e receber dados que serão gerados por eles como resultado da execução.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-152">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="6a6e1-153">Nas atividades WF3 foram inicializados quando um fluxo de trabalho foi criado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-153">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="6a6e1-154">Em atividades de WF 4 são inicializados somente quando as atividades correspondentes estão executando.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-154">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="6a6e1-155">Isto permite um ciclo de vida mais simples de atividade sem executar operações inicializa/Uninitialize quando uma nova instância de fluxo de trabalho é criada, e assim obtido em mais eficiência</span><span class="sxs-lookup"><span data-stu-id="6a6e1-155">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="6a6e1-156">Fluxo de Controle</span><span class="sxs-lookup"><span data-stu-id="6a6e1-156">Control Flow</span></span>
 <span data-ttu-id="6a6e1-157">Assim como em qualquer linguagem de programação, [!INCLUDE[wf1](../../../includes/wf1-md.md)] fornece suporte para fluxos de controle para definições de fluxo de trabalho apresentando um conjunto de atividades de fluxo de controle para arranjar seqüencialmente, padrões loop, ramificar e outros.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-157">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="6a6e1-158">Em WF3, quando a mesma atividade precisa ser executada, novo <xref:System.Workflow.ComponentModel.ActivityExecutionContext> é criado e a atividade é clonada com uma lógica pesada de serialização e desserialização de baseada em <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-158">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="6a6e1-159">Geralmente o desempenho para fluxos de controle iterativos é muito mais lento do que executando uma sequência de atividades.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-159">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="6a6e1-160">WF4 manipula esse bem diferente.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-160">WF4 handles this quite differently.</span></span> <span data-ttu-id="6a6e1-161">Leva o modelo de atividade, cria um novo objeto de ActivityInstance, e adicioná-lo a fila de agendador.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-161">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="6a6e1-162">Todo esse processo envolve apenas criação de objetos explícitos e é muito leve.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-162">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="6a6e1-163">Programação assíncrona</span><span class="sxs-lookup"><span data-stu-id="6a6e1-163">Asynchronous Programming</span></span>
 <span data-ttu-id="6a6e1-164">Os aplicativos geralmente têm um melhor desempenho e escalabilidade com programação assíncrona para operações longas de bloqueio como E/S ou operações distribuídos de computação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-164">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="6a6e1-165">WF4 fornece suporte assíncrono por tipos de base <xref:System.Activities.AsyncCodeActivity>de atividade, <xref:System.Activities.AsyncCodeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-165">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="6a6e1-166">O runtime entende nativo que as atividades assíncronos e portanto podem automaticamente colocar a instância em uma zona sem persistir quando o trabalho assíncrono está excelente.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-166">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="6a6e1-167">As atividades personalizados podem derivar desses tipos para executar o trabalho assíncrona sem armazenar o segmento de agendador de fluxo de trabalho e bloquear quaisquer atividades que podem ser capaz executar paralelamente.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-167">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="6a6e1-168">Mensagens</span><span class="sxs-lookup"><span data-stu-id="6a6e1-168">Messaging</span></span>
 <span data-ttu-id="6a6e1-169">Inicialmente WF3 tinha muito suporte limitado de mensagem com as chamadas de eventos externos ou serviços da Web.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-169">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="6a6e1-170">No .NET 3.5, os fluxos de trabalho poderiam ser <xref:System.Workflow.Activities.SendActivity> implementados como clientes WCF ou expostos como serviços wcf através e <xref:System.Workflow.Activities.ReceiveActivity>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-170">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="6a6e1-171">No WF4, o conceito de programação de mensagens baseada em fluxo de trabalho foi ainda mais reforçado através da forte integração da lógica de mensagens WCF no WF.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-171">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="6a6e1-172">O pipeline unificado de processamento de mensagens fornecido no WCF no .NET 4 ajuda os serviços WF4 a ter um desempenho e escalabilidade significativamente melhores do que o WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-172">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="6a6e1-173">WF4 também fornece um meio de programação mais sofisticado de mensagem que pode modelar padrão complexos (MEPs) de Exchange de mensagem.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="6a6e1-174">Os desenvolvedores podem usar contratos de serviço tipados obter programação fácil ou contratos de serviço un- tipados obter melhor desempenho sem pagar custo de serialização.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-174">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="6a6e1-175">Suporte do lado do cliente de cachê do canal por meio da classe <xref:System.ServiceModel.Activities.SendMessageChannelCache> em desenvolvedores de ajuda WF4 criar aplicativos rápidos com esforço mínimo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-175">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="6a6e1-176">Para obter mais informações, consulte [Alterando os níveis de compartilhamento de cache para enviar atividades](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-176">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="6a6e1-177">Programação declarativa</span><span class="sxs-lookup"><span data-stu-id="6a6e1-177">Declarative Programming</span></span>
 <span data-ttu-id="6a6e1-178">WF4 fornece uma estrutura declarativamente limpa e de programação simples para modelar processos comerciais e serviços.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-178">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="6a6e1-179">O modelo de programação oferece suporte a composição totalmente declarativa de atividades, sem nenhum código ao lado de simplificando, bastante a criação de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-179">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="6a6e1-180">No .NET Framework 4, a estrutura de programação declarativa baseada em XAML foi unificada no sistema de montagem única.Xaml.dll para suportar tanto o WPF quanto o WF.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-180">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="6a6e1-181">Em WF4, XAML fornece uma experiência realmente declarativamente e permite-à definição inteira de fluxo de trabalho ser definida na marcação XML, referenciando atividades e digitar .NET de usar compilado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-181">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="6a6e1-182">Isso foi difícil de fazer em WF3 com formato de XOML sem quebrar o personalizado code-behind de lógica.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-182">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="6a6e1-183">A nova pilha XAML em .NET 4 tem um desempenho muito melhor em artefatos de fluxo de trabalho serializador/desserializador e torna a programação declarativa mais atraente e sólida.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-183">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="6a6e1-184">Designer de Fluxo de Trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-184">Workflow Designer</span></span>
 <span data-ttu-id="6a6e1-185">Suporte de programação completamente declarativo para WF4 aplicar explicitamente um mais altos requisitos para desempenho de tempo de design para grandes fluxos de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-185">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="6a6e1-186">O designer de fluxo de trabalho em WF4 tem a escalabilidade muito melhor para grandes fluxos de trabalho do que aquela para WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-186">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="6a6e1-187">Com suporte a virtualização de interface do usuário, o designer pode facilmente carregar um grande fluxo de trabalho 1000 atividades em alguns segundos, quando é quase impossível carregar um fluxo de trabalho algumas cem atividades com o designer WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-187">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="6a6e1-188">Comparações de desempenho de nível por componente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-188">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="6a6e1-189">Esta seção contém dados em comparações diretas entre atividades individuais em fluxos de trabalho WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-189">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="6a6e1-190">Os pontos chave como a persistência tem um impacto no desempenho mais profundo dos componentes individuais de atividade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-190">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="6a6e1-191">As melhorias de desempenho em componentes individuais em WF4 são importantes embora porque os componentes são agora rápidos o suficiente para ser comparados com a lógica mão- valor de orquestração.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-191">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="6a6e1-192">Um exemplo disso é abordado na próxima seção: "Cenário de Composição de Serviços".</span><span class="sxs-lookup"><span data-stu-id="6a6e1-192">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="6a6e1-193">Configuração do ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-193">Environment Setup</span></span>
 ![Configuração do ambiente para medição do desempenho do fluxo de trabalho](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="6a6e1-195">A figura anterior mostra a configuração de máquina usada para medidas de desempenho de nível por componente.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-195">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="6a6e1-196">Um único servidor e cinco clientes conectados sobre uma interface de rede Ethernet 1-Gbps.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-196">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="6a6e1-197">Para medidas fácil, o servidor é configurado para usar um único principal de um servidor dual de proc/principal executando Windows Server 2008 x.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-197">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="6a6e1-198">A utilização da CPU do sistema é mantida em quase 100%.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-198">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="6a6e1-199">Detalhes do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-199">Test Details</span></span>
 <span data-ttu-id="6a6e1-200">O WF3 <xref:System.Workflow.Activities.CodeActivity> é provável a atividade a mais simples que pode ser usada em um fluxo de trabalho WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-200">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="6a6e1-201">A atividade chama um método no code-behind que o programador de fluxo de trabalho pode colocar código em personalizado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-201">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="6a6e1-202">Em WF4, não há analógico direto ao WF3 <xref:System.Workflow.Activities.CodeActivity> que fornece a mesma funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-202">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="6a6e1-203">Observe que há uma classe base de <xref:System.Activities.CodeActivity> em WF4 que não está relacionado ao WF3 <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-203">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="6a6e1-204">Os autores de fluxo de trabalho são incentivados criar atividades personalizados e criar fluxos de trabalho XAML-only.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-204">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="6a6e1-205">Nos testes abaixo, uma atividade chamada `Comment` é usada no lugar de <xref:System.Workflow.Activities.CodeActivity> vazia em fluxos de trabalho WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-205">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="6a6e1-206">O código na atividade de `Comment` é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-206">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="6a6e1-207">Fluxo de trabalho vazio</span><span class="sxs-lookup"><span data-stu-id="6a6e1-207">Empty Workflow</span></span>
 <span data-ttu-id="6a6e1-208">Este teste usa um fluxo de trabalho da sequência sem atividades filhos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-208">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="6a6e1-209">Única atividade</span><span class="sxs-lookup"><span data-stu-id="6a6e1-209">Single Activity</span></span>
 <span data-ttu-id="6a6e1-210">O fluxo de trabalho é um fluxo de trabalho da sequência que contém uma atividade filho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-210">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="6a6e1-211">A atividade é <xref:System.Workflow.Activities.CodeActivity> sem código em casos WF3 e uma atividade de `Comment` em casos WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-211">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="6a6e1-212">Quando com 1000 iterações</span><span class="sxs-lookup"><span data-stu-id="6a6e1-212">While with 1000 Iterations</span></span>
 <span data-ttu-id="6a6e1-213">O fluxo de trabalho da sequência contém uma atividade de <xref:System.Activities.Statements.While> com uma atividade filho no loop que não executa qualquer trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-213">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="6a6e1-214">Replicator comparou a ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="6a6e1-214">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="6a6e1-215"><xref:System.Workflow.Activities.ReplicatorActivity> em WF3 tem modos de execução sequencial e paralela.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="6a6e1-216">No modo sequencial, o desempenho da atividade é semelhante a <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-216">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="6a6e1-217"><xref:System.Workflow.Activities.ReplicatorActivity> é mais útil para execução paralela.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-217">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="6a6e1-218">O WF4 analógico para essa é a atividade de <xref:System.Activities.Statements.ParallelForEach%601> .</span><span class="sxs-lookup"><span data-stu-id="6a6e1-218">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="6a6e1-219">O diagrama a seguir mostra os fluxos de trabalho usados para esse teste.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-219">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="6a6e1-220">O trabalho WF3 estão à esquerda e o trabalho WF4 estão à direita.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-220">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 ReplicatorActivity e WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="6a6e1-222">Fluxo de trabalho sequencial com cinco atividades</span><span class="sxs-lookup"><span data-stu-id="6a6e1-222">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="6a6e1-223">Este teste serve mostrar o efeito de ter várias atividades executa em ordem.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-223">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="6a6e1-224">Há cinco atividades na sequência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-224">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="6a6e1-225">Escopo de transação</span><span class="sxs-lookup"><span data-stu-id="6a6e1-225">Transaction Scope</span></span>
 <span data-ttu-id="6a6e1-226">O teste do escopo de transação diferem dos outros teste ligeiramente que uma nova instância de fluxo de trabalho não será criado para cada iteração.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-226">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="6a6e1-227">Em vez disso, o fluxo de trabalho seja estruturada com um loop de quando que contém uma atividade de <xref:System.Activities.Statements.TransactionScope> que contém uma única atividade que não faz nenhum trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-227">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="6a6e1-228">Cada um execução de um lote de 50 iterações através de loop de quando for contagem como uma única operação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-228">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="6a6e1-229">Compensação</span><span class="sxs-lookup"><span data-stu-id="6a6e1-229">Compensation</span></span>
 <span data-ttu-id="6a6e1-230">O fluxo de trabalho WF3 tem uma única atividade compensatable chamada `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-230">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="6a6e1-231">A atividade simplesmente implementa a interface de <xref:System.Workflow.ComponentModel.ICompensatableActivity> :</span><span class="sxs-lookup"><span data-stu-id="6a6e1-231">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="6a6e1-232">O manipulador de `WorkScope` falhas tem como alvo a atividade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-232">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="6a6e1-233">O fluxo de trabalho WF4 é igualmente simplista.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-233">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="6a6e1-234"><xref:System.Activities.Statements.CompensableActivity> tem um corpo e um manipulador de compensação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-234">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="6a6e1-235">Um explícito compensa é seguir na sequência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-235">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="6a6e1-236">A atividade de atividade de corpo e do manipulador de compensação é ambas são implementações:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-236">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="6a6e1-237">O diagrama a seguir mostra o fluxo de trabalho de compensação básica.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-237">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="6a6e1-238">O trabalho WF3 estão à esquerda e o trabalho WF4 estão à direita.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-238">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Fluxos de trabalho de compensação básica WF3 e WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="6a6e1-240">Resultados de testes de desempenho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-240">Performance Test Results</span></span>

 ![Tabela mostrando dados dos resultados dos testes de desempenho](./media/performance/performance-test-data.gif)

 ![Gráfico de colunas comparando dados de teste de desempenho WF3 e WF4](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="6a6e1-243">Todos os testes são medidos em por segundo de fluxos de trabalho com exceção de teste do escopo de transação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-243">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="6a6e1-244">Como pode ser deduzido anterior, o desempenho de runtime de [!INCLUDE[wf1](../../../includes/wf1-md.md)] melhor em qualquer linha, especialmente em áreas que eles exigem mais execuções da mesma atividade como quando o loop do.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-244">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="6a6e1-245">Cenário de composição de serviço</span><span class="sxs-lookup"><span data-stu-id="6a6e1-245">Service Composition Scenario</span></span>
 <span data-ttu-id="6a6e1-246">Como mostrado na seção anterior, "Comparações de desempenho em nível de componente", houve uma redução significativa na sobrecarga entre wf3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-246">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="6a6e1-247">Os serviços de fluxo de trabalho WCF agora podem quase corresponder ao desempenho [!INCLUDE[wf1](../../../includes/wf1-md.md)] dos serviços WCF codificados à mão, mas ainda têm todos os benefícios do tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-247">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="6a6e1-248">Este cenário de teste compara um serviço WCF com um serviço de fluxo de trabalho WCF no WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-248">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="6a6e1-249">Serviço de Store online</span><span class="sxs-lookup"><span data-stu-id="6a6e1-249">Online Store Service</span></span>
 <span data-ttu-id="6a6e1-250">Um dos pontos fortes do Windows Workflow Foundation é a capacidade de compor processos usando vários serviços.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-250">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="6a6e1-251">Para esse exemplo, há um serviço online de armazenamento que orquestre duas chamadas técnicos para comprar um pedido.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-251">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="6a6e1-252">A primeira etapa é validar o pedido usando um ordem que valida o serviço.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-252">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="6a6e1-253">A segunda etapa é preencher a ordem usando um serviço de depósito.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-253">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="6a6e1-254">Os dois serviços backend, a validação do serviço e o depósito os serviços de aplicativos, permanecem os mesmos para ambos os testes.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-254">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="6a6e1-255">A parte que muda é o serviço online de Store que executa a orquestração.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-255">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="6a6e1-256">Em um caso, o serviço é codificado à mão como um serviço WCF.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-256">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="6a6e1-257">Para o outro caso, o serviço é escrito como um serviço de fluxo de trabalho WCF no WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-257">For the other case, the service is written as a WCF workflow service in WF4.</span></span> <span data-ttu-id="6a6e1-258">os recursos específico de[!INCLUDE[wf1](../../../includes/wf1-md.md)]como o rastreamento e a persistência estão desativados para esse teste.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-258">[!INCLUDE[wf1](../../../includes/wf1-md.md)]-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="6a6e1-259">Ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-259">Environment</span></span>
![Configuração do ambiente para medição de desempenho](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="6a6e1-261">As solicitações de cliente são feitas para o serviço online de Store por HTTP vários computadores.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-261">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="6a6e1-262">Hosts únicos do computador todos os três serviços.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-262">A single computer hosts all three services.</span></span>  <span data-ttu-id="6a6e1-263">A camada de transporte entre o serviço online de Store e serviços backend é TCP ou HTTP.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-263">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="6a6e1-264">A medida das operações/é baseada em dependendo do número de chamadas concluídos de `PurchaseOrder` feitas para o serviço online de Store.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-264">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="6a6e1-265">Pool de canal é um novo recurso disponível em WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-265">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="6a6e1-266">Na parte WCF deste poolde canal de teste não é fornecida fora da caixa, portanto, uma implementação codificada à mão de uma técnica simples de pooling foi usada no Serviço de Loja Online.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-266">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="6a6e1-267">Desempenho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-267">Performance</span></span>
![Gráfico de colunas mostrando o desempenho do Serviço de Loja online](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="6a6e1-269">Conectando para backend os serviços TCP sem canal que agrupam-se, o serviço de [!INCLUDE[wf1](../../../includes/wf1-md.md)] tem um impacto 17,2% em produção.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-269">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="6a6e1-270">Com que o canal pool, a caneta é aproximadamente 23,8%.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-270">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="6a6e1-271">Para HTTP, o impacto é muito menos: 4,3% sem agrupamento e 8,1% com agrupamento.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-271">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="6a6e1-272">Também é importante observar que se agrupar do canal fornece muito pouco benefício ao usar HTTP.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-272">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="6a6e1-273">Embora haja sobrecarga do tempo de execução do WF4 em comparação com um serviço WCF codificado à mão neste teste, ele pode ser considerado um cenário pior.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-273">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="6a6e1-274">Os dois serviços backend neste teste torna muito pouco trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-274">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="6a6e1-275">Em um cenário de ponta a ponta real, esses serviços efetuariam um operações mais faces como chamadas de base de dados, fazendo o impacto de desempenho da camada de transporte menos importante.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-275">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="6a6e1-276">Isso mais os benefícios dos recursos disponíveis em WF4 faz a base de fluxo de trabalho uma alternativa viável para criar serviços de orquestração.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-276">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="6a6e1-277">Considerações sobre desempenho principal</span><span class="sxs-lookup"><span data-stu-id="6a6e1-277">Key Performance Considerations</span></span>
 <span data-ttu-id="6a6e1-278">As áreas de recurso nesta seção, com exceção de interoperabilidade, bastante alterados entre WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-278">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="6a6e1-279">Isso afeta o design de aplicativos de fluxo de trabalho assim como o desempenho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-279">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="6a6e1-280">Latência de ativação de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-280">Workflow Activation Latency</span></span>
 <span data-ttu-id="6a6e1-281">Em um aplicativo de serviço de fluxo de trabalho WCF, a latência para iniciar um novo fluxo de trabalho ou carregar um fluxo de trabalho existente é importante, pois pode ser bloqueada.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-281">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="6a6e1-282">Essa situação de teste mede um host de WF3 XOML contra um host de WF4 XAMLX em um cenário típico.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-282">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="6a6e1-283">Configuração do ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-283">Environment Setup</span></span>
 ![Configuração do ambiente para latência e testes de rendimento](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="6a6e1-285">Configuração de teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-285">Test Setup</span></span>
 <span data-ttu-id="6a6e1-286">No cenário, um computador cliente entra em contato com um serviço de fluxo de trabalho WCF usando correlação baseada em contexto.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-286">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="6a6e1-287">Correlação de contexto requer uma associação especial de contexto e usa um cabeçalho de contexto ou o cookie para relacionar mensagens ao fluxo de trabalho correto instância.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-287">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="6a6e1-288">Tem um benefício de desempenho que a identificação de correlação está localizada no cabeçalho de mensagem para que o corpo da mensagem não precisa ser analisado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-288">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="6a6e1-289">O serviço criará um novo fluxo de trabalho com a solicitação e enviará uma resposta imediata de modo que a medida de latência não inclua o tempo gasto executando o fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-289">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="6a6e1-290">O trabalho WF3 são XOML com a code-behind e o trabalho WF4 são totalmente XAML.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-290">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="6a6e1-291">Os aspectos de fluxo de trabalho WF4 como este:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-291">The WF4 workflow looks like this:</span></span>

 ![Fluxo de trabalho do escopo de correlação WF4](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="6a6e1-293">A atividade de <xref:System.ServiceModel.Activities.Receive> cria a instância de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-293">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="6a6e1-294">Um valor passado a mensagem é recebida ecoado na mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-294">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="6a6e1-295">Uma sequência após a resposta contém o resto de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-295">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="6a6e1-296">Em casos anterior, somente uma atividade do comentário é mostrada.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-296">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="6a6e1-297">O número de atividades de comentário é alterado para simular a complexidade de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-297">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="6a6e1-298">Uma atividade do comentário é equivalente a um WF3 <xref:System.Workflow.Activities.CodeActivity> que não executa qualquer trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-298">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="6a6e1-299">Para obter mais informações sobre a atividade de comentários, consulte a seção "Comparação de desempenho em nível de componente" no início deste artigo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-299">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="6a6e1-300">Resultados do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-300">Test Results</span></span>

 <span data-ttu-id="6a6e1-301">Latência fria e quente para serviços de fluxo de trabalho WCF:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-301">Cold and warm latency for WCF workflow services:</span></span>

 ![Gráfico de coluna mostrando latência fria e quente para serviços de fluxo de trabalho WCF usando WF3 e WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="6a6e1-303">No gráfico anterior, frio refere-se ao caso em <xref:System.ServiceModel.WorkflowServiceHost> que não existe um fluxo de trabalho dado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-303">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="6a6e1-304">Ou seja a latência fria é quando o fluxo de trabalho está sendo usado pela primeira vez e o XOML ou o XAML precisam ser compilados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-304">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="6a6e1-305">A latência morna é o tempo de criação de uma nova instância de fluxo de trabalho quando o tipo de fluxo de trabalho já foi criado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-305">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="6a6e1-306">A complexidade de fluxo de trabalho faz a diferença muito pequena em casos WF4 mas tem uma progressão linear em casos WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-306">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="6a6e1-307">Rendimento de correlação</span><span class="sxs-lookup"><span data-stu-id="6a6e1-307">Correlation Throughput</span></span>
 <span data-ttu-id="6a6e1-308">WF4 apresenta um novo recurso base de conteudo correlação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-308">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="6a6e1-309">WF3 de contexto fornecido com apenas correlação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-309">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="6a6e1-310">A correlação baseada em contexto só poderia ser feita sobre as vinculações específicas dos canais WCF.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-310">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="6a6e1-311">A identificação do fluxo de trabalho é inserida no cabeçalho de mensagem para usar essas associações.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-311">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="6a6e1-312">O tempo de execução do WF3 só poderia identificar um fluxo de trabalho pelo seu Id.  Com correlação baseada em conteúdo, o autor do fluxo de trabalho pode criar uma chave de correlação a partir de um pedaço relevante de dados, como um número de conta ou um ID do cliente.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-312">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="6a6e1-313">Correlação de contexto base tem uma vantagem de desempenho que a chave de correlação está localizada no cabeçalho de mensagem.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-313">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="6a6e1-314">A chave pode ser lido de mensagem sem de- serialização/mensagem- copiar.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-314">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="6a6e1-315">Em correlação conteudo base, a chave de correlação é armazenada no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-315">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="6a6e1-316">Uma expressão XPath é usada para localizar a chave.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-316">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="6a6e1-317">O custo desse processamento adicional depende do tamanho de mensagem, profundidade de chave no corpo, e o número de chaves.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-317">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="6a6e1-318">Este teste compara contexto e correlação conteudo base e também mostra degradação de desempenho ao usar várias chaves.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-318">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="6a6e1-319">Configuração do ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-319">Environment Setup</span></span>
![Configuração do ambiente para teste de desempenho do fluxo de trabalho](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="6a6e1-321">Configuração de teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-321">Test Setup</span></span>
<span data-ttu-id="6a6e1-322">![Teste de fluxo de trabalho de taxa de transferência de correlação](./media/performance/correlation-throughput-workflow.gif "Configuração do teste de fluxo de trabalho de throughput de correlação")</span><span class="sxs-lookup"><span data-stu-id="6a6e1-322">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="6a6e1-323">O fluxo de trabalho anterior é o mesmo usado na seção [Persistência.](#persistence)</span><span class="sxs-lookup"><span data-stu-id="6a6e1-323">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="6a6e1-324">Para os testes de correlação sem persistência, não há provedor de persistência instalado no tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-324">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="6a6e1-325">Correlação ocorre em dois locais: CreateOrder e CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-325">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="6a6e1-326">Resultados do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-326">Test Results</span></span>
<span data-ttu-id="6a6e1-327">![Rendimento de correlação](./media/performance/correlation-throughput-graph.gif "Gráfico de throughput de correlação")</span><span class="sxs-lookup"><span data-stu-id="6a6e1-327">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="6a6e1-328">Este gráfico a seguir mostra um decréscimo de desempenho como o número de chaves usadas em correlação conteudo base aumenta.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-328">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="6a6e1-329">A semelhança em curvas entre o TCP e o HTTP indica a sobrecarga associada com esses protocolos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-329">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="6a6e1-330">Correlação com persistência</span><span class="sxs-lookup"><span data-stu-id="6a6e1-330">Correlation with Persistence</span></span>
 <span data-ttu-id="6a6e1-331">Com um fluxo de trabalho persistente, pressão CPU de conteudo correlação desloca com base em runtime de fluxo de trabalho a base de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-331">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="6a6e1-332">Os procedimentos armazenados no provedor de persistência do SQL faça o trabalho de combinar as chaves para localizar o fluxo de trabalho apropriado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-332">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Gráfico de linhas mostrando resultados de correlação e persistência](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="6a6e1-334">Correlação de contexto base ainda é mais rápido que correlação conteudo base.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-334">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="6a6e1-335">No entanto, a diferença é pronunciada menos porque a persistência tem mais impacto no desempenho que correlação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-335">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="6a6e1-336">Produção complexa de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-336">Complex Workflow Throughput</span></span>
 <span data-ttu-id="6a6e1-337">A complexidade de um fluxo de trabalho não é medida somente pelo número de atividades.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-337">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="6a6e1-338">As atividades compostas podem conter muitos filhos e os filhos podem também ser atividades compostas.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-338">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="6a6e1-339">Como o número de níveis de aninhamento aumenta, o que faz o número de atividades que podem estar executando atualmente no estado e o número de variáveis que podem estar em estado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-339">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="6a6e1-340">Este teste compara a produção entre WF3 e WF4 ao executar fluxos de trabalho complexos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-340">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="6a6e1-341">Configuração de teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-341">Test Setup</span></span>
 <span data-ttu-id="6a6e1-342">Esses testes foram executados em um computador de maneira 2.66GHz 4 Intel Xeon X5355 @ com 4GB RAM executando Windows Server 2008 86.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-342">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="6a6e1-343">O código de teste é executado em um único processo com um segmento pelo núcleo para atingir o uso da CPU 100%.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-343">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="6a6e1-344">Fluxos de trabalho gerados para esse teste têm duas variáveis principais: profundidade e número de atividades em cada sequência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-344">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="6a6e1-345">Cada nível de profundidade incluir uma atividade paralela, quando loop, decisões, atribuições, e sequências.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-345">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="6a6e1-346">No designer WF4 representado abaixo, o fluxograma de nível superior é representado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-346">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="6a6e1-347">Cada atividade do fluxograma lembra o fluxograma principal.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-347">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="6a6e1-348">Pode ser útil pensar em um fractal para representar este fluxo de trabalho, onde a profundidade é limitada aos parâmetros de teste.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-348">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="6a6e1-349">O número de atividades em um teste dado é determinado por profundidade e o número de atividades pela sequência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-349">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="6a6e1-350">A equação seguir calcula o número de atividades no teste WF4:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-350">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Equação para calcular o número de atividades](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="6a6e1-352">A contagem de atividade de teste WF3 pode ser computado com uma equação ligeiramente diferente devido a uma sequência extra:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-352">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Equação para calcular o número de atividades WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="6a6e1-354">De onde está o tamanho e a são o número de atividades pela sequência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-354">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="6a6e1-355">A lógica por trás dessas equações é que a primeira constante, multiplicada por, é o número de sequências e a segunda constante é o número de atividades estático no nível atual.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-355">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="6a6e1-356">Há três atividades filhos do fluxograma em cada fluxograma.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-356">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="6a6e1-357">A nível inferior de profundidade, esses fluxogramas estão vazios mas a outros níveis são cópias do fluxograma principal.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-357">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="6a6e1-358">O número de atividades na definição de fluxo de trabalho de cada variação de teste é indicado na tabela a seguir:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-358">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Uma tabela que mostra o número de atividades utilizadas em cada teste](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="6a6e1-360">O número de atividades na definição de fluxo de trabalho aumenta com nitidez com cada nível de profundidade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-360">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="6a6e1-361">Mas somente um caminho pelo ponto de decisão é executado em uma determinada instância de fluxo de trabalho, portanto somente um subconjunto pequeno de atividades reais é executado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-361">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Fluxograma do complexo fluxo de trabalho de throughput](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="6a6e1-363">Um fluxo de trabalho equivalente foi criado para WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-363">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="6a6e1-364">O designer WF3 mostra o fluxo de trabalho inteiro na área de design em vez de aninhamento, portanto é muito grande exibir neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-364">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="6a6e1-365">Um snippet de fluxo de trabalho é mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-365">A snippet of the workflow is shown below.</span></span>

 ![Trecho do fluxograma do fluxo de trabalho WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="6a6e1-367">Para exercitar aninhamento em casos, extremos outro fluxo de trabalho que seja parte dos usos 100 deste teste tivesse sequências.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-367">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="6a6e1-368">Na sequência interno são único `Comment` ou <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-368">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Fluxograma de uma seqüência aninhada](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="6a6e1-370">O rastreamento e a persistência não são usados como parte deste teste.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-370">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="6a6e1-371">Resultados do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-371">Test Results</span></span>
 ![Gráfico de colunas mostrando resultados de desempenho de throughput](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="6a6e1-373">Mesmo com fluxos de trabalho complexos com muitos de profundida e um número alto de atividades, os resultados de desempenho são consistentes com outros números de produção mostradas anteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-373">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="6a6e1-374">A taxa de WF4 é pedidos de magnitude mais rapidamente e tem que ser comparadas em uma escala logarítmica.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-374">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="6a6e1-375">Memória</span><span class="sxs-lookup"><span data-stu-id="6a6e1-375">Memory</span></span>
 <span data-ttu-id="6a6e1-376">A sobrecarga de memória do Windows Workflow Foundation é medida em dois pontos chave: complexidade de fluxo de trabalho e número de definições de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-376">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="6a6e1-377">As medidas de memória foram executadas em uma estação de trabalho de 64 bits do Windows 7.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-377">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="6a6e1-378">Existem muitas maneiras de obter a medição do tamanho do conjunto de trabalho, como contadores de desempenho de monitoramento, pesquisa de ambiente.WorkingSet ou usar uma ferramenta como o VMMap disponível no [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-378">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="6a6e1-379">Uma combinação de métodos foi usada para obter e verificar os resultados de cada teste.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-379">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="6a6e1-380">Teste a complexidade de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-380">Workflow Complexity Test</span></span>
 <span data-ttu-id="6a6e1-381">O teste de complexidade de fluxo de trabalho mede a diferença de conjunto de trabalho baseado em complexidade de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-381">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="6a6e1-382">Além dos fluxos de trabalho complexo usados na seção anterior, as novas variações são adicionados para cobrir dois casos básicos: um único fluxo de trabalho de atividade e uma sequência com 1000 atividades.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-382">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="6a6e1-383">Para esses testes fluxos de trabalho são inicializados e executados para a conclusão em um único loop serial por um período de um minuto.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-383">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="6a6e1-384">Cada variação de teste é executada três vezes e os dados são gravados a média dessas três é executado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-384">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="6a6e1-385">Os dois novos teste básicos têm fluxos de trabalho que são como aqueles mostrados abaixo:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-385">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Fluxo de trabalho complexo para WF3 e WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="6a6e1-387">No fluxo de trabalho WF3 mostrado acima, as atividades vazios de <xref:System.Workflow.Activities.CodeActivity> são usadas.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-387">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="6a6e1-388">As atividades acima de `Comment` usos de fluxo de trabalho WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-388">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="6a6e1-389">A atividade de `Comment` foi descrito na seção comparações de desempenho de nível por componente anteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-389">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Gráfico de colunas mostrando o uso complexo da memória do fluxo de trabalho para fluxos de trabalho WF3 e WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="6a6e1-391">Uma das tendências claras observar no gráfico é que se aninhar relativamente tem impacto mínimo sobre o uso de memória em WF3 e em WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-391">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="6a6e1-392">O impacto o mais significativa de memória do número de atividades em um determinado fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-392">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="6a6e1-393">Dado os dados da sequência 1000, a sequência complexa 5 profundidade 5, e profundidade complexa 7 variações da sequência 1, é claro como o número de atividades inserir milhares, increase de uso de memória ficar mais visível.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-393">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="6a6e1-394">Em casos extremos sequência 1 (profundidade 7) onde há atividades de ~29K, WF4 estiver usando quase 79% menos memória que WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-394">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="6a6e1-395">Vários teste das definições de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-395">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="6a6e1-396">Medir a memória pela definição de fluxo de trabalho é dividido em dois diferentes teste devido às opções disponíveis para hospedar fluxos de trabalho em WF3 e em WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-396">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="6a6e1-397">Os testes são rodados de maneira diferente do teste de complexidade de fluxo de trabalho que um fluxo de trabalho já está citado como exemplo e executado somente uma vez por definição.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-397">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="6a6e1-398">Isso ocorre porque a definição de fluxo de trabalho e seu host permanecem em memória para o tempo de vida de Appdomain.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-398">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="6a6e1-399">A memória usado executando uma determinada instância de fluxo de trabalho deve ser removida durante a coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-399">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="6a6e1-400">A orientação de migração para WF4 contém informações mais detalhadas sobre as opções de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-400">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="6a6e1-401">Para obter mais informações, consulte [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-401">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="6a6e1-402">Criar várias definições de fluxo de trabalho para um teste de definição de fluxo de trabalho pode ser feita em várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-402">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="6a6e1-403">Por exemplo, um pode usar a geração de código para criar um conjunto de 1000 fluxos de trabalho que são idênticos exceto no nome e para salvar cada um desses fluxos de trabalho em arquivos separados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-403">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="6a6e1-404">Essa abordagem foi tirada para teste console- hospedado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-404">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="6a6e1-405">Em WF3, a classe de <xref:System.Workflow.Runtime.WorkflowRuntime> foi usada para executar as definições de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-405">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="6a6e1-406">WF4 pode usar <xref:System.Activities.WorkflowApplication> para criar uma instância única de fluxo de trabalho ou usar diretamente <xref:System.Activities.WorkflowInvoker> para executar a atividade como se fosse um chamada de método.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-406">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="6a6e1-407"><xref:System.Activities.WorkflowApplication> é um host de uma única instância de fluxo de trabalho e tem mais próximo uma paridade recurso a <xref:System.Workflow.Runtime.WorkflowRuntime> de modo que é usado neste teste.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-407"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="6a6e1-408">Para hospedar fluxos de trabalho no IIS é possível usar <xref:System.Web.Hosting.VirtualPathProvider> para criar um novo <xref:System.ServiceModel.WorkflowServiceHost> em vez de gerar todos os arquivos de XAMLX ou de XOML.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-408">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="6a6e1-409">O <xref:System.Web.Hosting.VirtualPathProvider> atende a solicitação recebida e responde com um "arquivo virtual" que pode ser carregado a partir de um banco de dados ou, neste caso, gerado em tempo real.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-409">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="6a6e1-410">Portanto é desnecessário criar arquivos 1000 físico.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-410">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="6a6e1-411">As definições de fluxo de trabalho usadas no teste de console foram fluxos de trabalho sequenciais simples com uma única atividade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-411">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="6a6e1-412">A única atividade foi <xref:System.Workflow.Activities.CodeActivity> vazio para as caixas WF3 e uma atividade de `Comment` para casos WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-412">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="6a6e1-413">Configuração dos casos hospedados usaram fluxos de trabalho que começam em receber uma mensagem e terminam em enviar uma resposta:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-413">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="6a6e1-414">A imagem a seguir mostra um fluxo de trabalho WF3 com ReceiveActivity e um fluxo de trabalho WF4 com padrão de solicitação/resposta:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-414">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Serviços de fluxo de trabalho em WF3 e WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="6a6e1-416">A tabela a seguir mostra o delta no conjunto de trabalho entre uma definição de fluxo de trabalho único e definições de 1001:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-416">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="6a6e1-417">Hospedando opções</span><span class="sxs-lookup"><span data-stu-id="6a6e1-417">Hosting Options</span></span>|<span data-ttu-id="6a6e1-418">Delta do conjunto de trabalho WF3</span><span class="sxs-lookup"><span data-stu-id="6a6e1-418">WF3 Working Set Delta</span></span>|<span data-ttu-id="6a6e1-419">Delta do conjunto de trabalho WF4</span><span class="sxs-lookup"><span data-stu-id="6a6e1-419">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="6a6e1-420">Fluxos de trabalho hospedados do aplicativo de console</span><span class="sxs-lookup"><span data-stu-id="6a6e1-420">Console Application Hosted Workflows</span></span>|<span data-ttu-id="6a6e1-421">18 MB</span><span class="sxs-lookup"><span data-stu-id="6a6e1-421">18 MB</span></span>|<span data-ttu-id="6a6e1-422">9 MB</span><span class="sxs-lookup"><span data-stu-id="6a6e1-422">9 MB</span></span>|
|<span data-ttu-id="6a6e1-423">O IIS hospedou serviços de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-423">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="6a6e1-424">446 MB</span><span class="sxs-lookup"><span data-stu-id="6a6e1-424">446 MB</span></span>|<span data-ttu-id="6a6e1-425">364 MB</span><span class="sxs-lookup"><span data-stu-id="6a6e1-425">364 MB</span></span>|

 <span data-ttu-id="6a6e1-426">Hospedar definições de fluxo de trabalho no IIS consome muito mais memória devido aos <xref:System.ServiceModel.WorkflowServiceHost>artefatos de serviço WCF detalhados e à lógica de processamento de mensagens associada ao host.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-426">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="6a6e1-427">Para o console que hospeda em WF3 fluxos de trabalho foram implementados no código em vez de XOML.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-427">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="6a6e1-428">Em WF4 a opção é usar XAML.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-428">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="6a6e1-429">O XAML livre é armazenado como um recurso inserido no assembly compilado e durante o runtime para fornecer a implementação de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-429">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="6a6e1-430">Há uma sobrecarga associada a este processo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-430">There is some overhead associated with this process.</span></span>  <span data-ttu-id="6a6e1-431">Para fazer uma comparação entre justa WF3 e WF4, os fluxos de trabalho codificados foram usados em vez de XAML.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-431">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="6a6e1-432">Um exemplo de um dos fluxos de trabalho WF4 é mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-432">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="6a6e1-433">Há muitos outros fatores que podem afetar o consumo de memória.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-433">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="6a6e1-434">Conselhos o mesmo para todos os programas gerenciados ainda se aplica.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-434">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="6a6e1-435">A configuração em ambientes hospedados, o objeto de <xref:System.ServiceModel.WorkflowServiceHost> criado para uma definição de fluxo de trabalho permanece na memória até que o pool de aplicativos é reciclado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-435">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="6a6e1-436">Isso deve ser mantido em mente ao escrever extensões.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-436">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="6a6e1-437">Além disso, é melhor evitar variáveis "globais" (variáveis escopo de todo o fluxo de trabalho) e limitar o escopo das variáveis sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-437">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="6a6e1-438">Serviços de runtime de fluxo de trabalho</span><span class="sxs-lookup"><span data-stu-id="6a6e1-438">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="6a6e1-439">Persistência</span><span class="sxs-lookup"><span data-stu-id="6a6e1-439">Persistence</span></span>
 <span data-ttu-id="6a6e1-440">WF3 e WF4 ambos são fornecidas com um provedor de persistência SQL.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-440">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="6a6e1-441">O provedor de persistência WF3 SQL é uma implementação simples que serialize a instância de fluxo de trabalho e o armazena em uma operação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-441">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="6a6e1-442">Por esse motivo, o desempenho desse provedor intensamente depende do tamanho de instância de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-442">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="6a6e1-443">Em WF3, o tamanho da instância pode aumentar por muitas razões, como é discutido anteriormente neste documento.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-443">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="6a6e1-444">Vários clientes escolha para não usar o provedor de persistência padrão de SQL como armazenar uma instância serializado em uma base de dados não fornece nenhuma visibilidade no estado de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-444">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="6a6e1-445">Para localizar um trabalho específicos sem conhecer a identificação de trabalho, uma teria que desserializar cada instância armazenado e examinar o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-445">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="6a6e1-446">Muitos desenvolvedores preferem escrever seus próprios provedores de persistência para superar essa obstáculo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-446">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="6a6e1-447">O provedor de persistência WF4 SQL tenta resolver alguns desses interesses.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-447">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="6a6e1-448">As tabelas de persistência expõe determinada informações como os indicadores ativos e as propriedades promotable.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-448">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="6a6e1-449">O novo recurso de conteudo baseado em WF4 correlação não deseja executar bem usando a abordagem de persistência WF3 SQL, que fez alterações na organização de instância persistentes de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-449">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="6a6e1-450">Isso torna o provedor de persistência mais complexos e coloca o esforço extra na base de dados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-450">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="6a6e1-451">Configuração do ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-451">Environment Setup</span></span>
![Configuração do ambiente para teste de desempenho do fluxo de trabalho](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="6a6e1-453">Configuração de teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-453">Test Setup</span></span>
 <span data-ttu-id="6a6e1-454">Mesmo com um conjunto aprimorado de recurso e uma melhor manipulação de concorrência, o provedor de persistência SQL em WF4 é mais rápido do que o provedor em WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-454">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="6a6e1-455">Para apresentar isso, dois fluxos de trabalho executando essencialmente as mesmas operações em WF3 e em WF4 são comparados abaixo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-455">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Fluxo de trabalho de persistência no WF3 à esquerda e WF4 à direita](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="6a6e1-457">Os dois fluxos de trabalho ambos são criados por uma mensagem recebida.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-457">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="6a6e1-458">Após enviar uma resposta inicial, o fluxo de trabalho é mantido.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-458">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="6a6e1-459">Em casos WF3, <xref:System.Workflow.ComponentModel.TransactionScopeActivity> vazia é usado para iniciar a persistência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-459">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="6a6e1-460">O mesmo poderia ser alcançado no WF3 marcando uma atividade como "persistir no close".</span><span class="sxs-lookup"><span data-stu-id="6a6e1-460">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="6a6e1-461">Uma segunda mensagem correlacionada completa o fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-461">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="6a6e1-462">Fluxos de trabalho são persistidos mas não descarregados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-462">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="6a6e1-463">Resultados do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-463">Test Results</span></span>
 ![Gráfico de coluna suscando a persistência do throughput](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="6a6e1-465">Quando o transporte entre o cliente e a camada intermediária é HTTP, a persistência em WF4 mostra uma melhoria de 2,6 vezes.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-465">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="6a6e1-466">O transporte TCP aumenta o fator a 3,0 vezes.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-466">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="6a6e1-467">Em todos os casos, a utilização da CPU na camada intermediária é 98% ou maior.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-467">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="6a6e1-468">A razão para a produção WF4 é maior realiza-se devido ao runtime mais rápido de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-468">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="6a6e1-469">O tamanho da instância é serializado baixo para ambos os casos e não é um elemento de contribuição principal nesta situação.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-469">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="6a6e1-470">WF3 e fluxos de trabalho WF4 neste teste usam uma atividade para indicar explicitamente quando a persistência deve ocorrer.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-470">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="6a6e1-471">Isso tem a vantagem de persistir o fluxo de trabalho sem descarregá-lo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-471">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="6a6e1-472">Em WF3, também é possível persistir usando o recurso de <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> , mas este descarrega a instância de fluxo de trabalho de memória.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-472">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="6a6e1-473">Se um desenvolvedor que usa WF3 deseja verificar se um fluxo de trabalho persiste em determinados pontos, tem que alterar a definição de fluxo de trabalho ou pagar o custo descarregar e recarregar a instância de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-473">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="6a6e1-474">Um novo recurso em WF4 possibilita persistir sem descarregar: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-474">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="6a6e1-475">Esse recurso permite que a instância de fluxo de trabalho está armazenado em ociosa mas é na memória até que o limite de <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> está localizado ou a execução é continuada.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-475">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="6a6e1-476">Observe que o provedor de persistência WF4 SQL executa mais trabalho na camada de base de dados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-476">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="6a6e1-477">O base de dados SQL pode se tornar um gargalo portanto é importante monitorar existem o uso da CPU e o disco.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-477">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="6a6e1-478">Certifique-se de incluir os seguintes contadores de desempenho de base de dados SQL quando aplicativos de fluxo de trabalho de teste de desempenho:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-478">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="6a6e1-479">PhysicalDisk\\%Disk Tempo de leitura</span><span class="sxs-lookup"><span data-stu-id="6a6e1-479">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="6a6e1-480">PhysicalDisk\\% Tempo de disco</span><span class="sxs-lookup"><span data-stu-id="6a6e1-480">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="6a6e1-481">PhysicalDisk\\% Tempo de gravação de disco</span><span class="sxs-lookup"><span data-stu-id="6a6e1-481">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="6a6e1-482">PhysicalDisk\\% Comprimento da fila do disco</span><span class="sxs-lookup"><span data-stu-id="6a6e1-482">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="6a6e1-483">PhysicalDisk\Avg. Comprimento da fila de leitura do disco</span><span class="sxs-lookup"><span data-stu-id="6a6e1-483">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="6a6e1-484">PhysicalDisk\Avg. Comprimento da fila de gravação do disco</span><span class="sxs-lookup"><span data-stu-id="6a6e1-484">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="6a6e1-485">PhysicalDisk \ comprimento atual da fila de disco</span><span class="sxs-lookup"><span data-stu-id="6a6e1-485">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="6a6e1-486">Informações\\do processador % tempo do processador</span><span class="sxs-lookup"><span data-stu-id="6a6e1-486">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="6a6e1-487">SQLServer: Travas \ tempo de espera trava de média (ms)</span><span class="sxs-lookup"><span data-stu-id="6a6e1-487">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="6a6e1-488">SQLServer: Travas \ espera por de trava/s</span><span class="sxs-lookup"><span data-stu-id="6a6e1-488">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="6a6e1-489">Acompanhamento</span><span class="sxs-lookup"><span data-stu-id="6a6e1-489">Tracking</span></span>
 <span data-ttu-id="6a6e1-490">O rastreamento de fluxo de trabalho pode ser usado para acompanhar o progresso de um fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-490">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="6a6e1-491">Informações que está incluída em eventos de rastreamento é determinada por um perfil de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-491">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="6a6e1-492">Mais complexo o perfil de rastreamento, mais caro o rastreamento fica.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-492">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="6a6e1-493">WF3 enviados com um serviço SQL- base de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-493">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="6a6e1-494">Esse serviço pode trabalhar nos modos processados em lotes e não processados em lotes.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-494">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="6a6e1-495">No modo não processado em lotes, controlando eventos são gravados diretamente a base de dados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-495">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="6a6e1-496">No modo processado em lotes, controlando eventos são coletados em lotes mesmo que o estado da instância de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-496">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="6a6e1-497">O modo processado em lotes tem um desempenho melhor para o intervalo o maior de projetos de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-497">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="6a6e1-498">No entanto, em lotes pode ter um impacto de desempenho negativo se o fluxo de trabalho executa muitos atividades sem persistir e as atividades são rastreadas.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-498">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="6a6e1-499">Isso geralmente aconteceria em loop e a melhor maneira para evitar esse cenário é criar grandes loop para conter um ponto de persistência.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-499">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="6a6e1-500">Introduzir um ponto de persistência em um loop pode afetar negativamente o desempenho também portanto é importante medir o custo de cada e vir anterior com um balanço.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-500">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="6a6e1-501">WF4 não é enviado com um serviço de rastreamento SQL.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-501">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="6a6e1-502">Gravar informações de rastreamento em um banco de dados SQL pode ser melhor tratado a partir de um servidor de aplicativos em vez de incorporado no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-502">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="6a6e1-503">Portanto o rastreamento SQL é tratado agora por AppFabric.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-503">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="6a6e1-504">O provedor pronto para uso de rastreamento em WF4 é baseado no rastreamento de evento para o Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-504">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="6a6e1-505">ETW é um kernel- nível, o sistema de evento de baixo latência compilado no Windows.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-505">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="6a6e1-506">Usa um modelo de provedor/consumidor que execute possível incorrer somente a caneta para o rastreamento de evento quando há realmente um consumidor.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-506">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="6a6e1-507">Além de eventos kernel como o processador, o disco, a memória, e o uso de rede, muitos aplicativos aproveitam ETW também.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-507">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="6a6e1-508">Os eventos de ETW são mais avançados de contadores de desempenho que os eventos podem ser personalizados para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-508">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="6a6e1-509">Um evento pode conter texto como uma identificação de fluxo de trabalho ou uma mensagem informativa.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-509">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="6a6e1-510">Além disso, os eventos são categorizados com máscaras de bits de modo que consumir um certo subconjunto de eventos menos tenha impacto de desempenho de tratar todos os eventos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-510">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="6a6e1-511">As vantagens de usar a abordagem ETW para controlar em vez do SQL incluem:</span><span class="sxs-lookup"><span data-stu-id="6a6e1-511">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="6a6e1-512">A coleção de eventos de rastreamento pode ser separada para outro processo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-512">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="6a6e1-513">Isso proporciona maior flexibilidade de como os eventos são gravados.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-513">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="6a6e1-514">Os eventos de rastreamento do ETW são facilmente combinados com os eventos WCF ETW ou outros provedores de ETW, como um SQL Server ou um provedor de kernel.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-514">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="6a6e1-515">Os autores de fluxo de trabalho não precisam modificar um fluxo de trabalho melhor para trabalhar com uma implementação específica de rastreamento, como o modo em lotes de serviço de rastreamento de WF3 SQL.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-515">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="6a6e1-516">Um administrador pode girar de acompanhar ou sem reciclar o processo host.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-516">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="6a6e1-517">Os benefícios de desempenho ao rastreamento de ETW vêm com um desvantagem.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-517">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="6a6e1-518">Os eventos de ETW podem ser perdidas se o sistema está sob a pressão intensa de recurso.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-518">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="6a6e1-519">O processamento de eventos não serve bloquear a execução do programa normal e portanto não se garante que todos os eventos de ETW serão passados para seus assinantes.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-519">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="6a6e1-520">Isso torna acompanhar de ETW grande para o monitoramento da integridade mas não para fazer auditoria em apropriado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-520">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="6a6e1-521">Quando WF4 não possui um provedor de rastreamento SQL, AppFabric faz.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-521">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="6a6e1-522">A abordagem de rastreamento SQL de AppFabric é assinar eventos de ETW com um serviço do Windows que processa em lotes os eventos e os escrevam a uma tabela SQL criada para inserções rápido possível.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-522">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="6a6e1-523">Um trabalho separados sai os dados da tabela e reformam-nos nas tabelas de relatório que podem ser exibidas no painel de AppFabric.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-523">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="6a6e1-524">Isso significa que um lote de eventos de rastreamento é tratado independente de fluxo de trabalho proveniente de e portanto não tenha que aguardar um ponto de persistência antes de ser gravado.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-524">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="6a6e1-525">Os eventos de ETW podem ser gravados com ferramentas como o logman ou o xperf.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-525">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="6a6e1-526">O arquivo de compacto ETL pode ser exibido com uma ferramenta como o xperfview ou ser convertido em um formato mais legível, como XML, com tracerpt.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-526">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="6a6e1-527">Em WF3, a única opção para obter eventos de rastreamento sem um base de dados SQL é criar um serviço personalizado de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-527">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="6a6e1-528">Para obter mais informações sobre o ETW, consulte [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Aplicativos do Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-528">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="6a6e1-529">Ativar o rastreamento de fluxo de trabalho irá afetar o desempenho em vários níveis.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-529">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="6a6e1-530">A marca de nível abaixo usar a ferramenta de logman para consumir eventos de rastreamento de ETW e para gravar-los a um arquivo de ETL.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-530">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="6a6e1-531">O custo de rastreamento SQL em AppFabric não está no escopo deste artigo.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-531">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="6a6e1-532">O perfil básico de rastreamento, também usado em AppFabric, é mostrada nessa marca de nível.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-532">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="6a6e1-533">Também estão incluídos o custo de acompanhar somente eventos de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-533">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="6a6e1-534">Esses eventos são úteis para solucionar problemas e determinar a taxa média do sistema.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-534">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="6a6e1-535">Configuração do ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-535">Environment Setup</span></span>
 ![Configuração do ambiente para teste de desempenho do fluxo de trabalho](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="6a6e1-537">Resultados do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-537">Test Results</span></span>

 ![Gráfico de colunas mostrando custos de rastreamento do fluxo de trabalho](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="6a6e1-539">Monitoramento da integridade tem um impacto de aproximadamente 3% em produção.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-539">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="6a6e1-540">Os custos de perfil básico são aproximadamente 8%.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-540">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="6a6e1-541">Interoperabilidade</span><span class="sxs-lookup"><span data-stu-id="6a6e1-541">Interop</span></span>
 <span data-ttu-id="6a6e1-542">WF4 é quase uma reescrita completo de [!INCLUDE[wf1](../../../includes/wf1-md.md)] e portanto fluxos de trabalho WF3 e as atividades não são diretamente compatíveis com WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-542">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="6a6e1-543">Muitos clientes que adotaram o Windows Workflow Foundation mais cedo terão definições internas ou de terceiros no fluxo de trabalho e atividades personalizadas para o WF3.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-543">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="6a6e1-544">Uma maneira de fazer a transição para WF4 é usar a atividade de Interoperabilidade, que pode executar as atividades WF3 de dentro de um fluxo de trabalho WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-544">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="6a6e1-545">É recomendável que a atividade de <xref:System.Activities.Statements.Interop> seja usada somente quando necessário.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-545">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="6a6e1-546">Para obter mais informações sobre a migração para o WF4, confira a [Orientação de Migração WF4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="6a6e1-546">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="6a6e1-547">Configuração do ambiente</span><span class="sxs-lookup"><span data-stu-id="6a6e1-547">Environment Setup</span></span>
 ![Configuração do ambiente para teste de desempenho do fluxo de trabalho](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="6a6e1-549">Resultados do teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-549">Test Results</span></span>

<span data-ttu-id="6a6e1-550">A tabela a seguir mostra os resultados da execução de um fluxo de trabalho contendo cinco atividades em uma seqüência em várias configurações.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-550">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="6a6e1-551">Teste</span><span class="sxs-lookup"><span data-stu-id="6a6e1-551">Test</span></span>|<span data-ttu-id="6a6e1-552">Produção (fluxos de trabalho/s)</span><span class="sxs-lookup"><span data-stu-id="6a6e1-552">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="6a6e1-553">Sequência WF3 em runtime WF3</span><span class="sxs-lookup"><span data-stu-id="6a6e1-553">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="6a6e1-554">1,576</span><span class="sxs-lookup"><span data-stu-id="6a6e1-554">1,576</span></span>|
|<span data-ttu-id="6a6e1-555">Sequência WF3 em runtime WF4 usando Interoperabilidade</span><span class="sxs-lookup"><span data-stu-id="6a6e1-555">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="6a6e1-556">2,745</span><span class="sxs-lookup"><span data-stu-id="6a6e1-556">2,745</span></span>|
|<span data-ttu-id="6a6e1-557">Sequência WF4</span><span class="sxs-lookup"><span data-stu-id="6a6e1-557">WF4 Sequence</span></span>|<span data-ttu-id="6a6e1-558">153,582</span><span class="sxs-lookup"><span data-stu-id="6a6e1-558">153,582</span></span>|

 <span data-ttu-id="6a6e1-559">Há um aumento notável de desempenho ao uso de Interoperabilidade sobre WF3 reto.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-559">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="6a6e1-560">No entanto, quando comparado com as atividades WF4, increase é irrisória.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-560">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="6a6e1-561">Resumo</span><span class="sxs-lookup"><span data-stu-id="6a6e1-561">Summary</span></span>
 <span data-ttu-id="6a6e1-562">Os sejam investimentos no desempenho para WF4 pagaram fora em muitas áreas cruciais.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-562">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="6a6e1-563">O desempenho componente de fluxo de trabalho individual é em alguns casos centenas de vezes em WF4 mais rápido comparado a WF3 devido a um runtime mais magro de [!INCLUDE[wf1](../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6a6e1-563">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="6a6e1-564">Números de latência é significativamente melhor também.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-564">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="6a6e1-565">Isso significa que a [!INCLUDE[wf1](../../../includes/wf1-md.md)] penalidade de desempenho para o uso em oposição aos [!INCLUDE[wf1](../../../includes/wf1-md.md)]serviços de orquestração WCF de codificação manual é muito pequena considerando os benefícios adicionais do uso .</span><span class="sxs-lookup"><span data-stu-id="6a6e1-565">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="6a6e1-566">O desempenho de persistência gerado por um fator de 2,5 - 3,0.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-566">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="6a6e1-567">Monitoramento da integridade por meio de fluxo de trabalho que acompanha agora tem a sobrecarga muito pequena.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-567">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="6a6e1-568">Um conjunto abrangente de guias de migração está disponível para aqueles que estão considerando mover de WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-568">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="6a6e1-569">Qualquer esta deve fazer o WF4 uma opção atrativas para escrever aplicativos complexos.</span><span class="sxs-lookup"><span data-stu-id="6a6e1-569">All of this should make WF4 an attractive option for writing complex applications.</span></span>
