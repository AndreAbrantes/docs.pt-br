---
title: Criando atividades assíncrono em WF
description: Saiba como criar atividades assíncronas personalizadas usando o AsyncCodeActivity, que permite que as atividades derivadas implementem a lógica de execução assíncrona.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: a03fbde1ff27084cc36dffc3a1912220d9bbca7e
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242078"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="ddbe6-103">Criando atividades assíncrono em WF</span><span class="sxs-lookup"><span data-stu-id="ddbe6-103">Creating Asynchronous Activities in WF</span></span>

<span data-ttu-id="ddbe6-104">fornece<xref:System.Activities.AsyncCodeActivity> autores de atividade de uma classe base para usar que permite atividades derivados para implementar a lógica assíncrona de execução.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="ddbe6-105">Isso é útil para as atividades personalizados que devem realizar o trabalho assíncrona sem armazenar o segmento de agendador de fluxo de trabalho e bloquear quaisquer atividades que podem ser capaz executar paralelamente.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="ddbe6-106">Este tópico fornece uma visão geral sobre como criar atividades assíncronos personalizados usando <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="ddbe6-107">Usando AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="ddbe6-107">Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="ddbe6-108">fornece<xref:System.Activities?displayProperty=nameWithType> autores personalizados de atividade com classes base diferentes para diferentes requisitos de criação da atividade.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="ddbe6-109">Cada um leva um semântico específico e fornece um autor de fluxo de trabalho (e o runtime da atividade) um contrato correspondente.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="ddbe6-110">Uma atividade com base <xref:System.Activities.AsyncCodeActivity> é uma atividade que executem o trabalho de forma assíncrona relativo ao segmento de agendador e o cujo a lógica de execução é expressa no código gerenciado.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="ddbe6-111">Como resultado de ir assíncrona, <xref:System.Activities.AsyncCodeActivity> pode induzir um ponto ocioso durante a execução.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="ddbe6-112">Devido a natureza temporária de trabalho assíncrona, <xref:System.Activities.AsyncCodeActivity> sempre cria um nenhum persistir o pacote para a duração de execução da atividade.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="ddbe6-113">Isso impede o runtime de fluxo de trabalho persistir a instância de fluxo de trabalho no meio de trabalho assíncrono, e também impede que a instância de fluxo de trabalho descarregar quando o código assíncrono executar.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="ddbe6-114">Métodos de AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="ddbe6-114">AsyncCodeActivity Methods</span></span>  

 <span data-ttu-id="ddbe6-115">As atividades que derivam de <xref:System.Activities.AsyncCodeActivity> podem criar a lógica assíncrona de execução substituindo o <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e métodos de <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> com o código personalizado.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="ddbe6-116">Quando chamados em runtime, esses métodos são passados <xref:System.Activities.AsyncCodeActivityContext>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="ddbe6-117"><xref:System.Activities.AsyncCodeActivityContext>permite que o autor da atividade forneça o estado compartilhado <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> na Propriedade do contexto <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> .</span><span class="sxs-lookup"><span data-stu-id="ddbe6-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="ddbe6-118">No exemplo a seguir, uma atividade de `GenerateRandom` gerencia um número aleatório de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="ddbe6-119">A atividade do exemplo anterior deriva de <xref:System.Activities.AsyncCodeActivity%601>, e tem-se `OutArgument<int>` alto chamado `Result`.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="ddbe6-120">O valor retornado pelo método de `GetRandom` é extraído e retornado pela sobrescrita do <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> , e esse valor é definido como o valor de `Result` .</span><span class="sxs-lookup"><span data-stu-id="ddbe6-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="ddbe6-121">As atividades assíncronas que não retornam um resultado devem derivar de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="ddbe6-122">No exemplo a seguir, uma atividade de `DisplayRandom` é definida que deriva de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="ddbe6-123">Esta atividade é como a atividade de `GetRandom` mas em vez de retornar um resultado exibe uma mensagem para o console.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="ddbe6-124">Observe que porque não há nenhum valor de retorno, `DisplayRandom` usa <xref:System.Action> em vez de <xref:System.Func%602> para chamar seu representante, e o representante não retorna nenhum valor.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="ddbe6-125"><xref:System.Activities.AsyncCodeActivity> também fornece uma substituição de <xref:System.Activities.AsyncCodeActivity.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="ddbe6-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="ddbe6-126">Quando o <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> substituições são necessárias, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> é opcional, e pode ser substituído para que a atividade pode limpar seu estado assíncrono excelente quando está sendo cancelada ou aborted.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="ddbe6-127">Se limpeza é possível e `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` é `true`, a atividade deve chamar <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="ddbe6-128">Todas as exceções geradas do método são fatais à instância do fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="ddbe6-129">Chamando métodos assíncronos em uma classe</span><span class="sxs-lookup"><span data-stu-id="ddbe6-129">Invoking Asynchronous Methods on a Class</span></span>  

 <span data-ttu-id="ddbe6-130">Muitas das classes no .NET Framework fornecem funcionalidade assíncrona, e essa funcionalidade pode ser invocada de forma assíncrona usando uma <xref:System.Activities.AsyncCodeActivity> atividade baseada.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="ddbe6-131">No exemplo a seguir, é criada uma atividade que cria de forma assíncrona um arquivo usando a <xref:System.IO.FileStream> classe.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="ddbe6-132">Compartilhando o estado entre o BeginExecute e métodos de EndExecute</span><span class="sxs-lookup"><span data-stu-id="ddbe6-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  

 <span data-ttu-id="ddbe6-133">No exemplo anterior, o objeto de <xref:System.IO.FileStream> que foi criado em <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> foi acessado em <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="ddbe6-134">Isso é possível porque a variável de `file` foi passado a propriedade de <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> no <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="ddbe6-135">Este é o método correto para compartilhar o estado entre o <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e o <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="ddbe6-136">Está incorreto usar um variável de membro na classe derivada`FileWriter` (neste caso) para compartilhar o estado entre o <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e o <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> porque o objeto de atividade pode ser referenciado por várias instâncias de atividade.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="ddbe6-137">Tentar usar um variável de membro para compartilhar o estado pode resultar em valores de um <xref:System.Activities.ActivityInstance> que substitui ou que consome valores de outro <xref:System.Activities.ActivityInstance>.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="ddbe6-138">Acessando valores de argumento</span><span class="sxs-lookup"><span data-stu-id="ddbe6-138">Accessing Argument Values</span></span>  

 <span data-ttu-id="ddbe6-139">O ambiente de <xref:System.Activities.AsyncCodeActivity> consiste nos argumentos definidos na atividade.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="ddbe6-140">Esses argumentos podem ser acessados a partir das <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> substituições usando o <xref:System.Activities.AsyncCodeActivityContext> parâmetro.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="ddbe6-141">Os argumentos não podem ser acessados no delegado, mas os valores de argumento ou todos os outros dados desejados podem ser passados para o representante que usa seus parâmetros.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="ddbe6-142">No exemplo a seguir, uma atividade de geração aleatória é definida que obtenha o limite superior inclusive de seu argumento de `Max` .</span><span class="sxs-lookup"><span data-stu-id="ddbe6-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="ddbe6-143">O valor do argumento é passado para o código assíncrona quando o representante é chamado.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="ddbe6-144">Ações de programação ou atividades filhos usando AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="ddbe6-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="ddbe6-145"><xref:System.Activities.AsyncCodeActivity> derivado atividades personalizados fornece um método para fazer o trabalho de forma assíncrona com relação ao segmento de fluxo de trabalho, mas não fornece a capacidade de agendar atividades filho ou ações.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="ddbe6-146">No entanto, o comportamento assíncrono pode ser inserido com programação de atividades filho através de composição.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="ddbe6-147">Uma atividade assíncrona pode ser criada, e redigir em com <xref:System.Activities.Activity> ou <xref:System.Activities.NativeActivity> derivado a atividade para fornecer o comportamento assíncrono e a programação de atividades filho ou de ações.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="ddbe6-148">Por exemplo, uma atividade pode ser criada que é derivado de <xref:System.Activities.Activity>, e tem como sua implementação <xref:System.Activities.Statements.Sequence> que contém a atividade assíncrono também as outras atividades que implementam a lógica de atividade.</span><span class="sxs-lookup"><span data-stu-id="ddbe6-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="ddbe6-149">Para obter mais exemplos de como compor atividades usando <xref:System.Activities.Activity> <xref:System.Activities.NativeActivity> o e o, consulte [como criar uma atividade](how-to-create-an-activity.md) e [Opções de criação de atividades](activity-authoring-options-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="ddbe6-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ddbe6-150">Confira também</span><span class="sxs-lookup"><span data-stu-id="ddbe6-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>
