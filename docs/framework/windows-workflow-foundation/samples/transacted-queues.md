---
title: Filas transacionadas
ms.date: 03/30/2017
ms.assetid: b1b011dd-5e0b-482c-9bb0-9d8727038f14
ms.openlocfilehash: db6a9686334eefb02b9360827a23ca8363127eb5
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/05/2018
ms.locfileid: "43785398"
---
# <a name="transacted-queues"></a><span data-ttu-id="e1fca-102">Filas transacionadas</span><span class="sxs-lookup"><span data-stu-id="e1fca-102">Transacted Queues</span></span>
<span data-ttu-id="e1fca-103">Este exemplo mostra como integrar filas e transações no Windows Workflow Foundation (WF) para criar serviços confiáveis e escalonáveis.</span><span class="sxs-lookup"><span data-stu-id="e1fca-103">This sample shows how to integrate queues and transactions in Windows Workflow Foundation (WF) to create reliable and scalable services.</span></span> <span data-ttu-id="e1fca-104">Um <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` é usado no fluxo de trabalho do cliente para enviar a mensagem para uma fila em uma transação usando o <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="e1fca-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>.</span></span> <span data-ttu-id="e1fca-105"><xref:System.ServiceModel.Activities.TransactedReceiveScope> é usado no servidor para receber mensagens de fila e para atualizar o estado de fluxo de trabalho na mesma transação.</span><span class="sxs-lookup"><span data-stu-id="e1fca-105">A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="e1fca-106">Demonstra</span><span class="sxs-lookup"><span data-stu-id="e1fca-106">Demonstrates</span></span>  
 <span data-ttu-id="e1fca-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, e correlação conteudo base.</span><span class="sxs-lookup"><span data-stu-id="e1fca-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="e1fca-108">Discussão</span><span class="sxs-lookup"><span data-stu-id="e1fca-108">Discussion</span></span>  
 <span data-ttu-id="e1fca-109">Para demonstrar os recursos abordados neste exemplo, um serviço do fluxo de trabalho `RewardsPoints` é criado, que mantém registro dos pontos ganhados e usados para uma conta determinada.</span><span class="sxs-lookup"><span data-stu-id="e1fca-109">To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account.</span></span> <span data-ttu-id="e1fca-110">O cliente usa <xref:System.Activities.WorkflowInvoker> para simular postar várias solicitações a fila.</span><span class="sxs-lookup"><span data-stu-id="e1fca-110">The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue.</span></span> <span data-ttu-id="e1fca-111">Para enviar uma mensagem à fila em uma transação, a atividade de <xref:System.ServiceModel.Activities.Send> pode ser colocado dentro de <xref:System.Activities.Statements.TransactionScope.Body%2A> de <xref:System.Activities.Statements.TransactionScope>.</span><span class="sxs-lookup"><span data-stu-id="e1fca-111">To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="e1fca-112">Nesse exemplo, o cliente é executado primeiro, seguido pelo servidor, para demonstrar como as mensagens na fila podem desacoplar o cliente e aplicativos de servidor.</span><span class="sxs-lookup"><span data-stu-id="e1fca-112">In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.</span></span>  
  
 <span data-ttu-id="e1fca-113">Uma vez que o cliente for concluída, o serviço é configurado e hospedado.</span><span class="sxs-lookup"><span data-stu-id="e1fca-113">Once the client completes, the service is configured and hosted.</span></span> <span data-ttu-id="e1fca-114">Portanto, abra começa a processar as mensagens que já foram colocadas na fila.</span><span class="sxs-lookup"><span data-stu-id="e1fca-114">As soon as it opens, it starts processing the messages that have already been placed in the queue.</span></span> <span data-ttu-id="e1fca-115">Cada mensagem é recebida e processadas na mesma transação do servidor.</span><span class="sxs-lookup"><span data-stu-id="e1fca-115">Each message is received and processed under the same server transaction.</span></span> <span data-ttu-id="e1fca-116">Nesse exemplo, a primeira mensagem é recebida uma solicitação de `CreateAccount` que cria a instância e inicializa correlação de conteúdo baseado no nome de conta passado como parte da mensagem de solicitação.</span><span class="sxs-lookup"><span data-stu-id="e1fca-116">In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message.</span></span> <span data-ttu-id="e1fca-117">Para modelar o tipo de serviço que você pode esperar no mundo real, as seguintes atividades de <xref:System.ServiceModel.Activities.TransactedReceiveScope> que processam `AddPoints` e mensagens de `UsePoints` é paralelamente ramificações colocados dentro de um loop de `while` de modo que possa processar essas mensagens repetidamente em qualquer ordem.</span><span class="sxs-lookup"><span data-stu-id="e1fca-117">To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order.</span></span>  
  
 <span data-ttu-id="e1fca-118"><xref:System.Activities.Statements.TransactionScope> e <xref:System.ServiceModel.Activities.TransactedReceiveScope> cada um possui um ponto implícito de persistência no final de seus escopos, o que usar essas atividades em [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combinou com as filas é uma maneira confiável de mover o fluxo de trabalho de um estado consistente a seguir, para garantir que as mensagens estivessem perdidas nunca.</span><span class="sxs-lookup"><span data-stu-id="e1fca-118"><xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="e1fca-119">Para configurar, compilar, e executar o exemplo</span><span class="sxs-lookup"><span data-stu-id="e1fca-119">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="e1fca-120">Instalar e configurar MSMQ.</span><span class="sxs-lookup"><span data-stu-id="e1fca-120">Install and configure MSMQ.</span></span> <span data-ttu-id="e1fca-121">Ver [instalando o serviço de enfileiramento](https://go.microsoft.com/fwlink/?LinkId=178526) para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="e1fca-121">See [Installing Message Queuing](https://go.microsoft.com/fwlink/?LinkId=178526) for details.</span></span>  
  
2.  <span data-ttu-id="e1fca-122">Certifique-se de que MSDTC está executando executando o comando a seguir na linha de comando.</span><span class="sxs-lookup"><span data-stu-id="e1fca-122">Ensure that MSDTC is running by executing the following command on a command line.</span></span> `net start msdtc`  
  
3.  <span data-ttu-id="e1fca-123">Compile o projeto e o executável, ou abra o projeto em [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] e selecione a opção de início do menu debug.</span><span class="sxs-lookup"><span data-stu-id="e1fca-123">Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu.</span></span> <span data-ttu-id="e1fca-124">Primeiro, a fila é criada, o cliente é executada e enviar mensagens a fila, e finalmente inicia o serviço e mensagens são processados.</span><span class="sxs-lookup"><span data-stu-id="e1fca-124">First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed.</span></span> <span data-ttu-id="e1fca-125">Para sair do programa, pressione ENTER.</span><span class="sxs-lookup"><span data-stu-id="e1fca-125">To exit the program, press ENTER.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="e1fca-126">Os exemplos podem já estar instalados no seu computador.</span><span class="sxs-lookup"><span data-stu-id="e1fca-126">The samples may already be installed on your machine.</span></span> <span data-ttu-id="e1fca-127">Verifique o seguinte diretório (padrão) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="e1fca-127">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="e1fca-128">Se este diretório não existir, vá para [Windows Communication Foundation (WCF) e o Windows Workflow Foundation (WF) exemplos do .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) para baixar todos os Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemplos.</span><span class="sxs-lookup"><span data-stu-id="e1fca-128">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="e1fca-129">Este exemplo está localizado no seguinte diretório.</span><span class="sxs-lookup"><span data-stu-id="e1fca-129">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\TransactedQueues`
