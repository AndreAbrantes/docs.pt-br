---
title: 'Como: consultar para instâncias não persistentes'
ms.date: 03/30/2017
ms.assetid: 294019b1-c1a7-4b81-a14f-b47c106cd723
ms.openlocfilehash: 87b29ce6a5858872929cea4408d0d7bcc1b378d1
ms.sourcegitcommit: 9b1ac36b6c80176fd4e20eb5bfcbd9d56c3264cf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/28/2019
ms.locfileid: "67425312"
---
# <a name="how-to-query-for-non-persisted-instances"></a><span data-ttu-id="ea487-102">Como: consultar para instâncias não persistentes</span><span class="sxs-lookup"><span data-stu-id="ea487-102">How to: Query for Non-persisted Instances</span></span>

<span data-ttu-id="ea487-103">Quando uma nova instância de um serviço é criada e o serviço tem o comportamento de Store de instância de fluxo de trabalho do SQL definido, o host serviço cria uma entrada inicial para essa instância do serviço no armazenamento de instância.</span><span class="sxs-lookup"><span data-stu-id="ea487-103">When a new instance of a service is created and the service has the SQL Workflow Instance Store behavior defined, the service host creates a initial entry for that service instance in the instance store.</span></span> <span data-ttu-id="ea487-104">Posteriormente quando a instância do serviço persiste pela primeira vez, o comportamento de Store de instância de fluxo de trabalho do SQL armazena o estado atual da instância juntamente com os dados adicionais que são necessários para ativação, a recuperação, e o controle.</span><span class="sxs-lookup"><span data-stu-id="ea487-104">Subsequently when the service instance persists for the first time, the SQL Workflow Instance Store behavior stores the current instance state together with additional data that is required for activation, recovery, and control.</span></span>

<span data-ttu-id="ea487-105">Se uma instância não é mantido depois que a entrada inicial para a instância é criada, a instância do serviço no estado não é mantido.</span><span class="sxs-lookup"><span data-stu-id="ea487-105">If an instance is not persisted after the initial entry for the instance is created, the service instance is said to be in the non-persisted state.</span></span> <span data-ttu-id="ea487-106">Todas as instâncias de serviço persistentes podem ser consultadas e controlado.</span><span class="sxs-lookup"><span data-stu-id="ea487-106">All the persisted service instances can be queried and controlled.</span></span> <span data-ttu-id="ea487-107">As instâncias são persistentes de serviço podem acessar não sejam consultadas ou controladas.</span><span class="sxs-lookup"><span data-stu-id="ea487-107">Non-persisted service instances can neither be queried nor controlled.</span></span> <span data-ttu-id="ea487-108">Se uma instância não é mantida suspendida por causa de uma exceção sem tratamento pode ser consultada mas não controlado.</span><span class="sxs-lookup"><span data-stu-id="ea487-108">If a non-persisted instance is suspended due to an unhandled exception it can be queried but not controlled.</span></span>

<span data-ttu-id="ea487-109">As instâncias duráveis de serviço que não são mantidas ainda permanece em um estado não mantido nas seguintes situações:</span><span class="sxs-lookup"><span data-stu-id="ea487-109">Durable service instances that are not yet persisted remain in a non-persisted state in the following scenarios:</span></span>

- <span data-ttu-id="ea487-110">O host serviço falha antes da instância mantidas pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="ea487-110">The service host crashes before the instance persisted for the first time.</span></span> <span data-ttu-id="ea487-111">A entrada inicial para a instância permanece no armazenamento de instância.</span><span class="sxs-lookup"><span data-stu-id="ea487-111">The initial entry for the instance remains in the instance store.</span></span> <span data-ttu-id="ea487-112">A instância é não recuperável.</span><span class="sxs-lookup"><span data-stu-id="ea487-112">The instance is not recoverable.</span></span> <span data-ttu-id="ea487-113">Se uma mensagem correlacionada chega, a instância ficará ativa novamente.</span><span class="sxs-lookup"><span data-stu-id="ea487-113">If a correlated message arrives, the instance becomes active again.</span></span>

- <span data-ttu-id="ea487-114">A instância apresentou uma exceção não tratada antes que persistiu pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="ea487-114">The instance experiences an unhandled exception before it persisted for the first time.</span></span> <span data-ttu-id="ea487-115">Os seguintes cenários ocorrem</span><span class="sxs-lookup"><span data-stu-id="ea487-115">The following scenarios arise</span></span>

  - <span data-ttu-id="ea487-116">Se o valor da **UnhandledExceptionAction** estiver definida como **abandonar**, as informações de implantação do serviço são escritas para o armazenamento de instância e a instância é descarregada da memória.</span><span class="sxs-lookup"><span data-stu-id="ea487-116">If the value of the **UnhandledExceptionAction** property is set to **Abandon**, the service deployment information is written to the instance store and the instance is unloaded from memory.</span></span> <span data-ttu-id="ea487-117">A instância permanece no estado não persistente na base de dados de persistência.</span><span class="sxs-lookup"><span data-stu-id="ea487-117">The instance remains in non-persisted state in the persistence database.</span></span>

  - <span data-ttu-id="ea487-118">Se o valor da **UnhandledExceptionAction** estiver definida como **AbandonAndSuspend**, as informações de implantação do serviço são gravadas no banco de dados de persistência e o estado da instância é definido como  **Suspenso**.</span><span class="sxs-lookup"><span data-stu-id="ea487-118">If the value of the **UnhandledExceptionAction** property is set to **AbandonAndSuspend**, the service deployment information is written to the persistence database and the instance state is set to **Suspended**.</span></span> <span data-ttu-id="ea487-119">A instância não pode ser continuada, cancelado, ou encerrado.</span><span class="sxs-lookup"><span data-stu-id="ea487-119">The instance cannot be resumed, canceled, or terminated.</span></span> <span data-ttu-id="ea487-120">O host serviço não pode carregar a instância porque a instância não persistiu ainda e, portanto a entrada de base de dados para a instância não concluída.</span><span class="sxs-lookup"><span data-stu-id="ea487-120">The service host cannot load the instance because the instance hasn't persisted yet and, hence the database entry for the instance is not complete.</span></span>

  - <span data-ttu-id="ea487-121">Se o valor da **UnhandledExceptionAction** estiver definida como **Cancelar** ou **Terminate**, as informações de implantação do serviço são gravadas para o armazenamento de instância e o estado da instância é definido como **concluído**.</span><span class="sxs-lookup"><span data-stu-id="ea487-121">If the value of the **UnhandledExceptionAction** property is set to **Cancel** or **Terminate**, the service deployment information is written to the instance store and the instance state is set to **Completed**.</span></span>

<span data-ttu-id="ea487-122">As seções a seguir fornecem consultas de exemplo para localizar ocorrências são mantidas na base de dados do SQL e para excluir essas instâncias de base de dados.</span><span class="sxs-lookup"><span data-stu-id="ea487-122">The following sections provide sample queries to find non-persisted instances in the SQL persistence database and to delete these instances from the database.</span></span>

## <a name="to-find-all-instances-not-persisted-yet"></a><span data-ttu-id="ea487-123">Para localizar todas as instâncias ainda não persistentes</span><span class="sxs-lookup"><span data-stu-id="ea487-123">To find all instances not persisted yet</span></span>

<span data-ttu-id="ea487-124">A seguinte consulta SQL retorna a hora de identificação e de criação para todas as instâncias que não são mantidas na base de dados de persistência ainda.</span><span class="sxs-lookup"><span data-stu-id="ea487-124">The following SQL query returns the ID and creation time for all instances that are not persisted in to the persistence database yet.</span></span>

```sql
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0;
```

## <a name="to-find-all-instances-not-persisted-yet-and-also-not-loaded"></a><span data-ttu-id="ea487-125">Para localizar todas as instâncias não persistentes ainda e também não carregadas</span><span class="sxs-lookup"><span data-stu-id="ea487-125">To find all instances not persisted yet and also not loaded</span></span>
 <span data-ttu-id="ea487-126">Os seguintes tempo de identificação e de criação de retornos de consulta SQL para todas as instâncias que não são mantidas e também não são carregadas.</span><span class="sxs-lookup"><span data-stu-id="ea487-126">The following SQL query returns ID and creation time for all instances that are not persisted and also are not loaded.</span></span>

```sql
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and CurrentMachine is NULL;
```

## <a name="to-find-all-suspended-instances-not-persisted-yet"></a><span data-ttu-id="ea487-127">Para localizar todas as instâncias suspensas ainda não persistentes</span><span class="sxs-lookup"><span data-stu-id="ea487-127">To find all suspended instances not persisted yet</span></span>

<span data-ttu-id="ea487-128">A seguinte consulta SQL retorna a identificação, o tempo de design, a razão de suspensão, e o nome da exceção de suspensão para todas as instâncias que não são mantidas e também em um estado suspenso.</span><span class="sxs-lookup"><span data-stu-id="ea487-128">The following SQL query returns ID, creation time, suspension reason, and suspension exception name for all instances that are not persisted and also in a suspended state.</span></span>

```sql
select InstanceId, CreationTime, SuspensionReason, SuspensionExceptionName from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and IsSuspended = 1;
```

## <a name="to-delete-non-persisted-instances-from-the-persistence-database"></a><span data-ttu-id="ea487-129">Para excluir não persistiu instâncias de base de dados de persistência</span><span class="sxs-lookup"><span data-stu-id="ea487-129">To delete non-persisted instances from the persistence database</span></span>

<span data-ttu-id="ea487-130">Você deve periodicamente verificar o armazenamento de instância para instâncias são persistentes e remover as instâncias da instância se você tiver certeza que a instância não receberá uma mensagem correlacionada.</span><span class="sxs-lookup"><span data-stu-id="ea487-130">You should periodically check the instance store for non-persisted instances and remove instances from the instance store if you are sure that the instance will not receive a correlated message.</span></span> <span data-ttu-id="ea487-131">Por exemplo, se a instância foi na base de dados por vários meses e você souber que o fluxo de trabalho normalmente tem um tempo de vida de alguns dias, seria seguro suponha que esta é uma instância não inicializado que falhasse.</span><span class="sxs-lookup"><span data-stu-id="ea487-131">For example, if the instance has been in the database for several months and you know that the workflow typically has a lifetime of a few days, it would be safe to assume that this is an uninitialized instance that had crashed.</span></span>

<span data-ttu-id="ea487-132">Geralmente, é seguro as instâncias não atributos que não são suspensas ou não são carregadas.</span><span class="sxs-lookup"><span data-stu-id="ea487-132">In general, it is safe to delete non-persisted instances that are not suspended or not loaded.</span></span> <span data-ttu-id="ea487-133">Você não deve excluir **todos os** as instâncias são persistentes porque esse conjunto de instância inclui instâncias que acabou de criar, mas não são mantidas ainda.</span><span class="sxs-lookup"><span data-stu-id="ea487-133">You should not delete **all** the non-persisted instances because this instance set includes instances that are just created but are not persisted yet.</span></span> <span data-ttu-id="ea487-134">Você deve apenas excluir as instâncias são persistentes que são deixadas sobre como o host serviço de fluxo de trabalho que tinha a instância carregada causou uma exceção ou a própria instância causou uma exceção.</span><span class="sxs-lookup"><span data-stu-id="ea487-134">You should only delete non-persisted instances that are left over because the workflow service host that had the instance loaded caused an exception or the instance itself caused an exception.</span></span>

> [!WARNING]
> <span data-ttu-id="ea487-135">Excluindo instâncias são persistentes da instância diminui o tamanho de armazenamento e pode melhorar o desempenho de operações de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="ea487-135">Deleting non-persisted instances from the instance store decreases the size of the store and may improve the performance of store operations.</span></span>
