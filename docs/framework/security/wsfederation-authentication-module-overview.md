---
title: "Visão geral do módulo de autenticação WSFederation"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
caps.latest.revision: "6"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload: dotnet
ms.openlocfilehash: b9e76cbfc0afc682f6a7cd0bc95c254d25f77954
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/22/2017
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="908d5-102">Visão geral do módulo de autenticação WSFederation</span><span class="sxs-lookup"><span data-stu-id="908d5-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="908d5-103">O Windows Identity Foundation (WIF) inclui suporte para autenticação federada em aplicativos do ASP.NET por meio do módulo de autenticação WS-Federated (WS-FAM).</span><span class="sxs-lookup"><span data-stu-id="908d5-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="908d5-104">Este tópico ajudará você a entender como a autenticação federada funciona e como usá-la.</span><span class="sxs-lookup"><span data-stu-id="908d5-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="908d5-105">Visão geral da autenticação federada</span><span class="sxs-lookup"><span data-stu-id="908d5-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="908d5-106">A autenticação federada permite um Serviço de Token de Segurança (STS) em um domínio de confiança para fornecer informações de autenticação para um STS em outro domínio de confiança quando há uma relação de confiança entre os dois domínios.</span><span class="sxs-lookup"><span data-stu-id="908d5-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="908d5-107">Um exemplo disso é mostrado na ilustração a seguir.</span><span class="sxs-lookup"><span data-stu-id="908d5-107">An example of this is shown in the following illustration.</span></span>  
  
 <span data-ttu-id="908d5-108">![Cenário de autenticação federada](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span><span class="sxs-lookup"><span data-stu-id="908d5-108">![Federation Authentication Scenario](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span></span>  
  
1.  <span data-ttu-id="908d5-109">Um cliente no domínio de confiança Fabrikam envia uma solicitação para um aplicativo de terceira parte confiável (RP) no domínio de confiança da Contoso.</span><span class="sxs-lookup"><span data-stu-id="908d5-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2.  <span data-ttu-id="908d5-110">O RP redireciona o cliente para um STS no domínio de confiança da Contoso.</span><span class="sxs-lookup"><span data-stu-id="908d5-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="908d5-111">Esse STS não tem conhecimento do cliente.</span><span class="sxs-lookup"><span data-stu-id="908d5-111">This STS has no knowledge of the client.</span></span>  
  
3.  <span data-ttu-id="908d5-112">O STS da Contoso redireciona o cliente para um STS no domínio de confiança da Fabrikam, com a qual o domínio de confiança da Contoso tem uma relação de confiança.</span><span class="sxs-lookup"><span data-stu-id="908d5-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4.  <span data-ttu-id="908d5-113">O STS da Fabrikam verifica a identidade do cliente e emite um token de segurança para o STS da Contoso.</span><span class="sxs-lookup"><span data-stu-id="908d5-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5.  <span data-ttu-id="908d5-114">O STS da Contoso usa o token da Fabrikam para criar seu próprio token que pode ser usado pelo RP e o envia para o RP.</span><span class="sxs-lookup"><span data-stu-id="908d5-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6.  <span data-ttu-id="908d5-115">O RP extrai declarações do cliente do token de segurança e toma uma decisão de autorização.</span><span class="sxs-lookup"><span data-stu-id="908d5-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="908d5-116">Uso do módulo de autenticação federada com o ASP.NET</span><span class="sxs-lookup"><span data-stu-id="908d5-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="908d5-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) é um módulo HTTP que permite adicionar a autenticação federada a um aplicativo [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="908d5-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="908d5-118">A autenticação federada permite que a autenticação lógica seja tratada pelo STS e permite que você se concentre em escrever a lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="908d5-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="908d5-119">Configure o WS-FAM para especificar o STS para o qual as solicitações não autenticadas deverão ser redirecionadas.</span><span class="sxs-lookup"><span data-stu-id="908d5-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="908d5-120">O WIF permite autenticar um usuário de duas maneiras:</span><span class="sxs-lookup"><span data-stu-id="908d5-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1.  <span data-ttu-id="908d5-121">Redirecionamento passivo: quando um usuário não autenticado tenta acessar um recurso protegido e você deseja simplesmente redirecioná-lo para um STS sem a necessidade de uma página de logon, essa é a abordagem correta.</span><span class="sxs-lookup"><span data-stu-id="908d5-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="908d5-122">O STS verifica a identidade do usuário e emite um token de segurança que contém as declarações apropriadas para esse usuário.</span><span class="sxs-lookup"><span data-stu-id="908d5-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="908d5-123">Essa opção exige que o WS-FAM seja adicionado ao pipeline dos módulos de HTTP.</span><span class="sxs-lookup"><span data-stu-id="908d5-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="908d5-124">Você pode usar a Ferramenta de Acesso e Identidade para o Visual Studio 2012 para modificar o arquivo de configuração do seu aplicativo para usar WS-FAM e federar com um STS.</span><span class="sxs-lookup"><span data-stu-id="908d5-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="908d5-125">Para saber mais, confira [Ferramenta de Identidade e Acesso para o Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span><span class="sxs-lookup"><span data-stu-id="908d5-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2.  <span data-ttu-id="908d5-126">Chame o método <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> ou o método <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> por meio do code-behind de uma página de entrada no aplicativo RP.</span><span class="sxs-lookup"><span data-stu-id="908d5-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="908d5-127">No redirecionamento passivo, toda a comunicação é realizada por meio de redirecionamento/resposta do cliente (normalmente um navegador).</span><span class="sxs-lookup"><span data-stu-id="908d5-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="908d5-128">Você pode adicionar o WS-FAM ao pipeline de HTTP do seu aplicativo, onde ele inspeciona se há solicitações de usuários não autenticados e redireciona os usuários para o STS que você especificar.</span><span class="sxs-lookup"><span data-stu-id="908d5-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="908d5-129">O WS-FAM também gera vários eventos que permitem personalizar sua funcionalidade em um aplicativo do [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="908d5-129">The WS-FAM also raises several events that let you customize its functionality in an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="908d5-130">Como funciona o WS-FAM</span><span class="sxs-lookup"><span data-stu-id="908d5-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="908d5-131">O WS-FAM é implementado na classe <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="908d5-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="908d5-132">Normalmente, você adiciona o WS-FAM ao pipeline de HTTP do seu aplicativo de RP [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="908d5-132">Typically, you add the WS-FAM to the HTTP pipeline of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP application.</span></span> <span data-ttu-id="908d5-133">Quando um usuário não autenticado tenta acessar um recurso protegido, o RP retorna uma resposta HTTP “401 autorização negada”.</span><span class="sxs-lookup"><span data-stu-id="908d5-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="908d5-134">O WS-FAM intercepta essa resposta em vez de permitir que o cliente o receba e, em seguida, ele redireciona o usuário para o STS especificado.</span><span class="sxs-lookup"><span data-stu-id="908d5-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="908d5-135">O STS emite um token de segurança, que o WS-FAM intercepta novamente.</span><span class="sxs-lookup"><span data-stu-id="908d5-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="908d5-136">O WS-FAM usa o token para criar uma instância de <xref:System.Security.Claims.ClaimsPrincipal> para o usuário autenticado, que permite que os mecanismos de autorização regulares do [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] funcionem.</span><span class="sxs-lookup"><span data-stu-id="908d5-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="908d5-137">Como o HTTP é sem monitoração de estado, precisamos de uma maneira de evitar repetir este processo sempre que o usuário tentar acessar outro recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="908d5-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="908d5-138">É nesse momento que entra o <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="908d5-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="908d5-139">Quando o STS emite um token de segurança para o usuário, <xref:System.IdentityModel.Services.SessionAuthenticationModule> também cria um token de segurança de sessão para o usuário e o coloca em um cookie.</span><span class="sxs-lookup"><span data-stu-id="908d5-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="908d5-140">Em solicitações posteriores, o <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepta esse cookie e o utiliza para reconstruir a <xref:System.Security.Claims.ClaimsPrincipal> do usuário.</span><span class="sxs-lookup"><span data-stu-id="908d5-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="908d5-141">O diagrama a seguir mostra o fluxo geral de informações no caso de redirecionamento passivo.</span><span class="sxs-lookup"><span data-stu-id="908d5-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="908d5-142">A solicitação é redirecionada automaticamente por meio do STS para estabelecer credenciais sem uma página de logon:</span><span class="sxs-lookup"><span data-stu-id="908d5-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 <span data-ttu-id="908d5-143">![Diagrama de timing para entrada com redirecionamento passivo](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span><span class="sxs-lookup"><span data-stu-id="908d5-143">![Timing diagram for sign&#45;in with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span></span>  
  
 <span data-ttu-id="908d5-144">O seguinte diagrama mostra mais detalhes sobre o que acontece quando o usuário se autentica no STS e seus tokens de segurança são processados pelo <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="908d5-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="908d5-145">![Timing para processamento do token com redirecionamento passivo](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="908d5-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="908d5-146">O seguinte diagrama mostra mais detalhes sobre o que acontece quando os tokens de segurança do usuário foram serializados para cookies e são interceptados pelo <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="908d5-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="908d5-147">![Diagrama de timing de SAM que mostra a entrada usando controles](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="908d5-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="908d5-148">Eventos</span><span class="sxs-lookup"><span data-stu-id="908d5-148">Events</span></span>  
 <span data-ttu-id="908d5-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule> e sua classe pai, <xref:System.IdentityModel.Services.HttpModuleBase>, acionam eventos em vários estágios de processamento de uma solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="908d5-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="908d5-150">Você pode manipular esses eventos no arquivo `global.asax` de seu aplicativo [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="908d5-150">You can handle these events in the `global.asax` file of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
-   <span data-ttu-id="908d5-151">A infraestrutura ASP.NET invoca o método <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> do módulo para inicializar o módulo.</span><span class="sxs-lookup"><span data-stu-id="908d5-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
-   <span data-ttu-id="908d5-152">O evento <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> é acionado quando a infraestrutura ASP.NET invoca o método <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> pela primeira vez em um dos módulos do aplicativo que são derivados de <xref:System.IdentityModel.Services.HttpModuleBase>.</span><span class="sxs-lookup"><span data-stu-id="908d5-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="908d5-153">Esse método acessa a propriedade <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> estática, que faz com que a configuração seja carregada do arquivo Web.config.</span><span class="sxs-lookup"><span data-stu-id="908d5-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="908d5-154">Esse evento é gerado apenas na primeira vez em que esta propriedade é acessada.</span><span class="sxs-lookup"><span data-stu-id="908d5-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="908d5-155">O objeto <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> que é inicializado por meio da configuração pode ser acessado por meio da propriedade <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> em um manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="908d5-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="908d5-156">Você pode usar esse evento para modificar a configuração antes que ela seja aplicada aos módulos.</span><span class="sxs-lookup"><span data-stu-id="908d5-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="908d5-157">Você pode adicionar um manipulador a este evento no método Application_Start:</span><span class="sxs-lookup"><span data-stu-id="908d5-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```  
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="908d5-158">Cada módulo substitui os métodos abstratos <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> e <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="908d5-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="908d5-159">O primeiro desses métodos adiciona manipuladores para eventos de pipeline do ASP.NET que são de interesse para o módulo.</span><span class="sxs-lookup"><span data-stu-id="908d5-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="908d5-160">Na maioria dos casos, a implementação padrão do módulo será suficiente.</span><span class="sxs-lookup"><span data-stu-id="908d5-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="908d5-161">O segundo desses métodos inicializa as propriedades do módulo por meio de sua propriedade <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="908d5-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="908d5-162">(Esta é uma cópia da configuração que foi carregada anteriormente.) Talvez seja necessário substituir esse segundo método se você desejar dar suporte à inicialização de novas propriedades por meio da configuração em classes que são derivadas de <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> ou <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="908d5-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="908d5-163">Nesses casos, você também precisará derivar dos objetos de configuração apropriados para dar suporte às propriedades de configuração adicionadas; por exemplo, de <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration> ou <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="908d5-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
-   <span data-ttu-id="908d5-164">O WS-FAM aciona o evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> quando ele intercepta um token de segurança emitido pelo STS.</span><span class="sxs-lookup"><span data-stu-id="908d5-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
-   <span data-ttu-id="908d5-165">O WS-FAM aciona o evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> depois que ele valida o token.</span><span class="sxs-lookup"><span data-stu-id="908d5-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
-   <span data-ttu-id="908d5-166">O <xref:System.IdentityModel.Services.SessionAuthenticationModule> aciona o evento <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> quando ele cria um token de segurança de sessão para o usuário.</span><span class="sxs-lookup"><span data-stu-id="908d5-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
-   <span data-ttu-id="908d5-167">O <xref:System.IdentityModel.Services.SessionAuthenticationModule> aciona o evento <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> quando ele intercepta solicitações posteriores com o cookie que contém o token de segurança de sessão.</span><span class="sxs-lookup"><span data-stu-id="908d5-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
-   <span data-ttu-id="908d5-168">Antes que o WS-FAM redirecione o usuário para o emissor, ele aciona o evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.</span><span class="sxs-lookup"><span data-stu-id="908d5-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="908d5-169">A solicitação de entrada da Web Services Federation está disponível por meio da propriedade <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> do <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passado no evento.</span><span class="sxs-lookup"><span data-stu-id="908d5-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="908d5-170">Você pode optar por modificar a solicitação antes de enviar isso para o emissor.</span><span class="sxs-lookup"><span data-stu-id="908d5-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
-   <span data-ttu-id="908d5-171">O WS-FAM aciona o evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> quando o cookie é gravado com êxito e o usuário é conectado.</span><span class="sxs-lookup"><span data-stu-id="908d5-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
-   <span data-ttu-id="908d5-172">O WS-FAM aciona o evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> uma vez por sessão, pois a sessão é fechada para cada usuário.</span><span class="sxs-lookup"><span data-stu-id="908d5-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="908d5-173">Ele não será gerado se a sessão for fechada no lado do cliente (por exemplo, excluindo o cookie de sessão).</span><span class="sxs-lookup"><span data-stu-id="908d5-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="908d5-174">Em um ambiente de SSO, o IP-STS pode solicitar que cada RP saia também.</span><span class="sxs-lookup"><span data-stu-id="908d5-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="908d5-175">Isso também acionará esse evento, com <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="908d5-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="908d5-176">Não use a propriedade <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> durante qualquer evento acionado por <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> ou <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="908d5-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="908d5-177">Isso ocorre porque <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> é definido após o processo de autenticação, enquanto os eventos são acionados durante o processo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="908d5-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="908d5-178">Configuração da autenticação federada</span><span class="sxs-lookup"><span data-stu-id="908d5-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="908d5-179">O WS-FAM e o SAM são configurados por meio do elemento [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md).</span><span class="sxs-lookup"><span data-stu-id="908d5-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="908d5-180">O elemento filho [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) configura os valores padrão para as propriedades do WS-FAM; por exemplo, a propriedade <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> e a propriedade <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A>.</span><span class="sxs-lookup"><span data-stu-id="908d5-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="908d5-181">(Esses valores podem ser alterados por solicitação, fornecendo manipuladores para alguns dos eventos do WS-FAM; por exemplo, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) O manipulador de cookie que é usado pelo SAM é configurado por meio do elemento filho [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="908d5-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="908d5-182">O WIF fornece um manipulador de cookie padrão implementado na classe <xref:System.IdentityModel.Services.ChunkedCookieHandler> que pode ter seu tamanho de parte definido por meio do elemento [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="908d5-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="908d5-183">O elemento `<federationConfiguration>` referencia um <xref:System.IdentityModel.Configuration.IdentityConfiguration>, que fornece a configuração de outros componentes do WIF usados no aplicativo, como o <xref:System.Security.Claims.ClaimsAuthenticationManager> e o <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="908d5-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="908d5-184">A configuração de identidade pode ser referenciada explicitamente especificando um elemento [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) nomeado no atributo `identityConfigurationName` do elemento `<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="908d5-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="908d5-185">Se a configuração de identidade não for referenciada explicitamente, a configuração de identidade padrão será usada.</span><span class="sxs-lookup"><span data-stu-id="908d5-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="908d5-186">O XML a seguir mostra uma configuração de um aplicativo de terceira parte confiável (RP) do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="908d5-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="908d5-187">As seções de configuração <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> e <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> são adicionadas sob o elemento `<configSections>`.</span><span class="sxs-lookup"><span data-stu-id="908d5-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="908d5-188">O SAM e o WS-FAM são adicionados aos módulos de HTTP sob o elemento `<system.webServer>`/`<modules>`.</span><span class="sxs-lookup"><span data-stu-id="908d5-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="908d5-189">Finalmente, os componentes do WIF estão configurados nos elementos `<system.identityModel>`/`<identityConfiguration>` e `<system.identityModel.services>`/`<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="908d5-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="908d5-190">Essa configuração especifica o manipulador de cookie em partes, como o manipulador de cookie padrão e não é um tipo de manipulador de cookie especificado no elemento `<cookieHandler>`.</span><span class="sxs-lookup"><span data-stu-id="908d5-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="908d5-191">No exemplo a seguir, o atributo `requireHttps` do elemento `<wsFederation>` e o atributo `requireSsl` do elemento `<cookieHandler>` são `false`.</span><span class="sxs-lookup"><span data-stu-id="908d5-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="908d5-192">Isso representa uma ameaça de segurança em potencial.</span><span class="sxs-lookup"><span data-stu-id="908d5-192">This presents a potential security threat.</span></span> <span data-ttu-id="908d5-193">Em produção, esses dois valores devem ser definidos como `true`.</span><span class="sxs-lookup"><span data-stu-id="908d5-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="908d5-194">Consulte também</span><span class="sxs-lookup"><span data-stu-id="908d5-194">See Also</span></span>  
 <xref:System.IdentityModel.Services.SessionAuthenticationModule>  
 <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>  
 [<span data-ttu-id="908d5-195">\<federationConfiguration></span><span class="sxs-lookup"><span data-stu-id="908d5-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)
