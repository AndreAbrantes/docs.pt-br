---
title: "Fluxos de trabalho assíncronos (F#)"
description: "Saiba mais sobre o suporte a programação F # idioma para executar cálculos de forma assíncrona, que executadas sem bloquear a execução de outro trabalho."
keywords: "visual f#, f#, programação funcional"
author: cartermp
ms.author: phcart
ms.date: 05/16/2016
ms.topic: language-reference
ms.prod: .net
ms.technology: devlang-fsharp
ms.devlang: fsharp
ms.assetid: ee2bb9bf-e04a-4fbe-bf58-46d07229e981
ms.openlocfilehash: e1cbdb452c8f77d97a0231a5ec75d752a98d2ed6
ms.sourcegitcommit: 655fd4f78741967f80c409cef98347fdcf77857d
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/28/2018
---
# <a name="asynchronous-workflows"></a><span data-ttu-id="8aaf2-104">Fluxos de trabalho assíncronos</span><span class="sxs-lookup"><span data-stu-id="8aaf2-104">Asynchronous Workflows</span></span>

> [!NOTE]
<span data-ttu-id="8aaf2-105">O link de referência da API levará você até o MSDN.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-105">The API reference link will take you to MSDN.</span></span>  <span data-ttu-id="8aaf2-106">A referência da API docs.microsoft.com não está completa.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-106">The docs.microsoft.com API reference is not complete.</span></span>

<span data-ttu-id="8aaf2-107">Este tópico descreve o suporte em F # para executar cálculos de forma assíncrona, ou seja, sem bloquear a execução de outro trabalho.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-107">This topic describes support in F# for performing computations asynchronously, that is, without blocking execution of other work.</span></span> <span data-ttu-id="8aaf2-108">Por exemplo, cálculos assíncronos podem ser usados para gravar aplicativos que têm interfaces de usuário continuem responsivos aos usuários como o aplicativo executa outras tarefas.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-108">For example, asynchronous computations can be used to write applications that have UIs that remain responsive to users as the application performs other work.</span></span>

## <a name="syntax"></a><span data-ttu-id="8aaf2-109">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="8aaf2-109">Syntax</span></span>

```fsharp
async { expression }
```

## <a name="remarks"></a><span data-ttu-id="8aaf2-110">Comentários</span><span class="sxs-lookup"><span data-stu-id="8aaf2-110">Remarks</span></span>

<span data-ttu-id="8aaf2-111">Na sintaxe anterior, a computação é representado por `expression` está configurado para executar de forma assíncrona, ou seja, sem bloquear o thread de computação atual quando operações de suspensão assíncrono, e/s e outras operações assíncronas são executadas.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-111">In the previous syntax, the computation represented by `expression` is set up to run asynchronously, that is, without blocking the current computation thread when asynchronous sleep operations, I/O, and other asynchronous operations are performed.</span></span> <span data-ttu-id="8aaf2-112">Computações assíncronas geralmente são iniciadas em um thread em segundo plano enquanto continua a execução no thread atual.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-112">Asynchronous computations are often started on a background thread while execution continues on the current thread.</span></span> <span data-ttu-id="8aaf2-113">O tipo da expressão é `Async<'T>`, onde `'T` é o tipo retornado pela expressão quando o `return` palavra-chave é usada.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-113">The type of the expression is `Async<'T>`, where `'T` is the type returned by the expression when the `return` keyword is used.</span></span> <span data-ttu-id="8aaf2-114">O código em uma expressão como essa é conhecido como um *bloco assíncrono*, ou *async bloco*.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-114">The code in such an expression is referred to as an *asynchronous block*, or *async block*.</span></span>

<span data-ttu-id="8aaf2-115">Há várias maneiras de programação de forma assíncrona e o [ `Async` ](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) classe fornece métodos que oferecem suporte a vários cenários.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-115">There are a variety of ways of programming asynchronously, and the [`Async`](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) class provides methods that support several scenarios.</span></span> <span data-ttu-id="8aaf2-116">A abordagem geral é criar `Async` objetos que representam a computação ou cálculos que você deseja executar de forma assíncrona e, em seguida, iniciar esses cálculos usando uma das funções de disparo.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-116">The general approach is to create `Async` objects that represent the computation or computations that you want to run asynchronously, and then start these computations by using one of the triggering functions.</span></span> <span data-ttu-id="8aaf2-117">As várias funções de disparo fornecem maneiras diferentes de executar computações assíncronas e que você usa depende se você deseja usar o thread atual, um thread em segundo plano ou um objeto de tarefa do .NET Framework, e se há continuação funções que devem ser executados quando o cálculo for concluído.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-117">The various triggering functions provide different ways of running asynchronous computations, and which one you use depends on whether you want to use the current thread, a background thread, or a .NET Framework task object, and whether there are continuation functions that should run when the computation finishes.</span></span> <span data-ttu-id="8aaf2-118">Por exemplo, para iniciar uma computação assíncrona no thread atual, você pode usar [ `Async.StartImmediate` ](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span><span class="sxs-lookup"><span data-stu-id="8aaf2-118">For example, to start an asynchronous computation on the current thread, you can use [`Async.StartImmediate`](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span></span> <span data-ttu-id="8aaf2-119">Quando você inicia uma computação assíncrona do thread da interface do usuário, você não bloqueia o loop de eventos principal que processa as ações do usuário, como pressionamentos de tecla e atividade do mouse, para que seu aplicativo permaneça responsivo.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-119">When you start an asynchronous computation from the UI thread, you do not block the main event loop that processes user actions such as keystrokes and mouse activity, so your application remains responsive.</span></span>

## <a name="asynchronous-binding-by-using-let"></a><span data-ttu-id="8aaf2-120">Vinculação assíncrona usando let!</span><span class="sxs-lookup"><span data-stu-id="8aaf2-120">Asynchronous Binding by Using let!</span></span>

<span data-ttu-id="8aaf2-121">Em um fluxo de trabalho assíncrono, algumas operações e as expressões são síncronas e alguns são mais cálculos que são projetados para retornar um resultado de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-121">In an asynchronous workflow, some expressions and operations are synchronous, and some are longer computations that are designed to return a result asynchronously.</span></span> <span data-ttu-id="8aaf2-122">Quando você chama um método de forma assíncrona, em vez de um comum `let` de associação, use `let!`.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-122">When you call a method asynchronously, instead of an ordinary `let` binding, you use `let!`.</span></span> <span data-ttu-id="8aaf2-123">O efeito de `let!` é habilitar a execução continue em outros cálculos ou threads conforme o cálculo está sendo executado.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-123">The effect of `let!` is to enable execution to continue on other computations or threads as the computation is being performed.</span></span> <span data-ttu-id="8aaf2-124">Após o lado direito do `let!` associação retorna, o restante do fluxo de trabalho assíncrono retoma a execução.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-124">After the right side of the `let!` binding returns, the rest of the asynchronous workflow resumes execution.</span></span>

<span data-ttu-id="8aaf2-125">O código a seguir mostra a diferença entre `let` e `let!`.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-125">The following code shows the difference between `let` and `let!`.</span></span> <span data-ttu-id="8aaf2-126">A linha de código que usa `let` cria apenas uma computação assíncrona como um objeto que possa ser executado posteriormente, usando, por exemplo, `Async.StartImmediate` ou [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span><span class="sxs-lookup"><span data-stu-id="8aaf2-126">The line of code that uses `let` just creates an asynchronous computation as an object that you can run later by using, for example, `Async.StartImmediate` or [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span></span> <span data-ttu-id="8aaf2-127">A linha de código que usa `let!` inicia o cálculo e, em seguida, o thread está suspenso até que o resultado estiver disponível, em que ponto a execução continua.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-127">The line of code that uses `let!` starts the computation, and then the thread is suspended until the result is available, at which point execution continues.</span></span>

```fsharp
// let just stores the result as an asynchronous operation.
let (result1 : Async<byte[]>) = stream.AsyncRead(bufferSize)
// let! completes the asynchronous operation and returns the data.
let! (result2 : byte[])  = stream.AsyncRead(bufferSize)
```

<span data-ttu-id="8aaf2-128">Além `let!`, você pode usar `use!` para realizar associações assíncronas.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-128">In addition to `let!`, you can use `use!` to perform asynchronous bindings.</span></span> <span data-ttu-id="8aaf2-129">A diferença entre `let!` e `use!` é o mesmo que a diferença entre `let` e `use`.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-129">The difference between `let!` and `use!` is the same as the difference between `let` and `use`.</span></span> <span data-ttu-id="8aaf2-130">Para `use!`, o objeto é descartado no fechamento do escopo atual.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-130">For `use!`, the object is disposed of at the close of the current scope.</span></span> <span data-ttu-id="8aaf2-131">Observe que na versão atual da linguagem F #, `use!` não permite que um valor a ser inicializada como null, embora `use` does.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-131">Note that in the current release of the F# language, `use!` does not allow a value to be initialized to null, even though `use` does.</span></span>

## <a name="asynchronous-primitives"></a><span data-ttu-id="8aaf2-132">Primitivos assíncronos</span><span class="sxs-lookup"><span data-stu-id="8aaf2-132">Asynchronous Primitives</span></span>

<span data-ttu-id="8aaf2-133">Um método que executa uma única tarefa assíncrona e retorna o resultado é chamado um *primitivo assíncrono*, e eles são projetados especificamente para uso com `let!`.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-133">A method that performs a single asynchronous task and returns the result is called an *asynchronous primitive*, and these are designed specifically for use with `let!`.</span></span> <span data-ttu-id="8aaf2-134">Vários primitivos assíncronos são definidos na biblioteca principal F #.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-134">Several asynchronous primitives are defined in the F# core library.</span></span> <span data-ttu-id="8aaf2-135">Dois desses métodos para aplicativos Web são definidas no módulo [ `Microsoft.FSharp.Control.WebExtensions` ](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [ `WebRequest.AsyncGetResponse` ](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) e [ `WebClient.AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span><span class="sxs-lookup"><span data-stu-id="8aaf2-135">Two such methods for Web applications are defined in the module [`Microsoft.FSharp.Control.WebExtensions`](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [`WebRequest.AsyncGetResponse`](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) and [`WebClient.AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span></span> <span data-ttu-id="8aaf2-136">Ambos os primitivos de download de dados de uma página da Web, uma determinada URL.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-136">Both primitives download data from a Web page, given a URL.</span></span> <span data-ttu-id="8aaf2-137">`AsyncGetResponse` produz um `System.Net.WebResponse` objeto, e `AsyncDownloadString` produz uma cadeia de caracteres que representa o HTML para uma página da Web.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-137">`AsyncGetResponse` produces a `System.Net.WebResponse` object, and `AsyncDownloadString` produces a string that represents the HTML for a Web page.</span></span>

<span data-ttu-id="8aaf2-138">Primitivos de vários para operações de e/s assíncronas estão incluídos no [ `Microsoft.FSharp.Control.CommonExtensions` ](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) módulo.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-138">Several primitives for asynchronous I/O operations are included in the [`Microsoft.FSharp.Control.CommonExtensions`](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) module.</span></span> <span data-ttu-id="8aaf2-139">Esses métodos de extensão do `System.IO.Stream` classe [ `Stream.AsyncRead` ](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) e [ `Stream.AsyncWrite` ](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span><span class="sxs-lookup"><span data-stu-id="8aaf2-139">These extension methods of the `System.IO.Stream` class are [`Stream.AsyncRead`](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) and [`Stream.AsyncWrite`](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span></span>

<span data-ttu-id="8aaf2-140">Primitivos assíncronos adicionais estão disponíveis no [F # PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span><span class="sxs-lookup"><span data-stu-id="8aaf2-140">Additional asynchronous primitives are available in the [F# PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span></span> <span data-ttu-id="8aaf2-141">Você também pode escrever seus próprios primitivos assíncronos definindo uma função cujo corpo completo é colocado em um bloco de assíncrona.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-141">You can also write your own asynchronous primitives by defining a function whose complete body is enclosed in an async block.</span></span>

<span data-ttu-id="8aaf2-142">Para usar métodos assíncronos no .NET Framework que são projetados para outros modelos assíncronos com F # modelo de programação assíncrona, você cria uma função que retorna um F # `Async` objeto.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-142">To use asynchronous methods in the .NET Framework that are designed for other asynchronous models with the F# asynchronous programming model, you create a function that returns an F# `Async` object.</span></span> <span data-ttu-id="8aaf2-143">A biblioteca F # tem funções que tornam isso mais fácil.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-143">The F# library has functions that make this easy to do.</span></span>

<span data-ttu-id="8aaf2-144">Um exemplo de como usar fluxos de trabalho assíncronos está incluído aqui. Há muitos outros na documentação para os métodos de [classe Async](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span><span class="sxs-lookup"><span data-stu-id="8aaf2-144">One example of using asynchronous workflows is included here; there are many others in the documentation for the methods of the [Async class](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span></span>

<span data-ttu-id="8aaf2-145">Este exemplo mostra como usar fluxos de trabalho assíncronos para executar cálculos em paralelo.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-145">This example shows how to use asynchronous workflows to perform computations in parallel.</span></span>

<span data-ttu-id="8aaf2-146">No exemplo de código seguinte, uma função `fetchAsync` obtém o texto HTML é retornado de uma solicitação da Web.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-146">In the following code example, a function `fetchAsync` gets the HTML text returned from a Web request.</span></span> <span data-ttu-id="8aaf2-147">O `fetchAsync` função contém um bloco assíncrono de código.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-147">The `fetchAsync` function contains an asynchronous block of code.</span></span> <span data-ttu-id="8aaf2-148">Quando uma associação é feita para o resultado de um primitivo assíncrono, nesse caso [ `AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), permitem!</span><span class="sxs-lookup"><span data-stu-id="8aaf2-148">When a binding is made to the result of an asynchronous primitive, in this case [`AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span></span> <span data-ttu-id="8aaf2-149">é usado em vez de permitem.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-149">is used instead of let.</span></span>

<span data-ttu-id="8aaf2-150">Use a função [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) para executar uma operação assíncrona e aguarde até que seu resultado.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-150">You use the function [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) to execute an asynchronous operation and wait for its result.</span></span> <span data-ttu-id="8aaf2-151">Por exemplo, você pode executar várias operações assíncronas em paralelo usando o [ `Async.Parallel` ](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) funcionam em conjunto com o `Async.RunSynchronously` função.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-151">As an example, you can execute multiple asynchronous operations in parallel by using the [`Async.Parallel`](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) function together with the `Async.RunSynchronously` function.</span></span> <span data-ttu-id="8aaf2-152">O `Async.Parallel` função usa uma lista da `Async` objetos, define o código de cada `Async` o objeto de tarefa para executar em paralelo e retorna um `Async` objeto que representa a computação paralela.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-152">The `Async.Parallel` function takes a list of the `Async` objects, sets up the code for each `Async` task object to run in parallel, and returns an `Async` object that represents the parallel computation.</span></span> <span data-ttu-id="8aaf2-153">Como uma única operação, você deve chamar `Async.RunSynchronously` para iniciar a execução.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-153">Just as for a single operation, you call `Async.RunSynchronously` to start the execution.</span></span>

<span data-ttu-id="8aaf2-154">O `runAll` função inicia três fluxos de trabalho assíncronos em paralelo e aguarda até que sejam concluídas.</span><span class="sxs-lookup"><span data-stu-id="8aaf2-154">The `runAll` function launches three asynchronous workflows in parallel and waits until they have all completed.</span></span>

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet8003.fs)]

## <a name="see-also"></a><span data-ttu-id="8aaf2-155">Consulte também</span><span class="sxs-lookup"><span data-stu-id="8aaf2-155">See Also</span></span>

[<span data-ttu-id="8aaf2-156">Referência da Linguagem F#</span><span class="sxs-lookup"><span data-stu-id="8aaf2-156">F# Language Reference</span></span>](index.md)

[<span data-ttu-id="8aaf2-157">Expressões de Computação</span><span class="sxs-lookup"><span data-stu-id="8aaf2-157">Computation Expressions</span></span>](computation-expressions.md)

[<span data-ttu-id="8aaf2-158">Classe Control. Async</span><span class="sxs-lookup"><span data-stu-id="8aaf2-158">Control.Async Class</span></span>](https://msdn.microsoft.com/visualfsharpdocs/conceptual/control.async-class-%5bfsharp%5d)
