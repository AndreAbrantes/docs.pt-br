---
ms.openlocfilehash: bd656478a55856e676853e57f3e7386ea0aa0211
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614300"
---
### <a name="currentculture-is-not-preserved-across-wpf-dispatcher-operations"></a><span data-ttu-id="4a7ef-101">CurrentCulture não é preservada entre operações do Dispatcher do WPF</span><span class="sxs-lookup"><span data-stu-id="4a7ef-101">CurrentCulture is not preserved across WPF Dispatcher operations</span></span>

#### <a name="details"></a><span data-ttu-id="4a7ef-102">Detalhes</span><span class="sxs-lookup"><span data-stu-id="4a7ef-102">Details</span></span>

<span data-ttu-id="4a7ef-103">A partir do .NET Framework 4.6, alterações em <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> ou <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> feitas em um <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> serão perdidas ao final dessa operação do dispatcher.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-103">Beginning in the .NET Framework 4.6, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made within a <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> will be lost at the end of that dispatcher operation.</span></span> <span data-ttu-id="4a7ef-104">Da mesma forma, alterações em <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> ou <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> feitas fora de uma operação de Dispatcher podem não ser refletidas quando a operação é executada. Em termos práticos, isso significa que alterações em <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> podem não fluir entre retornos de chamada de UI do WPF e outro código em um aplicativo do WPF. Isso ocorre devido a uma alteração em <xref:System.Threading.ExecutionContext?displayProperty=fullName> que faz com que <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> sejam armazenados no contexto de execução começando com aplicativos destinados ao .NET Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-104">Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made outside of a Dispatcher operation may not be reflected when that operation executes.Practically speaking, this means that <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> changes may not flow between WPF UI callbacks and other code in a WPF application.This is due to a change in <xref:System.Threading.ExecutionContext?displayProperty=fullName> that causes <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> to be stored in the execution context beginning with apps targeting the .NET Framework 4.6.</span></span> <span data-ttu-id="4a7ef-105">As operações de dispatcher do WPF armazenam o contexto de execução usado para começar a operação e restaurar o contexto anterior quando a operação é concluída.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-105">WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.</span></span> <span data-ttu-id="4a7ef-106">Como <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> agora fazem parte desse contexto, alterações nelas em uma operação de dispatcher não são persistidas fora da operação.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-106">Because <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="4a7ef-107">Sugestão</span><span class="sxs-lookup"><span data-stu-id="4a7ef-107">Suggestion</span></span>

<span data-ttu-id="4a7ef-108">Os aplicativos afetados por essa alteração poderão contornar esse problema ao armazenar o <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> ou <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> desejado em um campo e verificar em todos os corpos da operação de Dispatcher (incluindo manipuladores de retorno de chamada do evento de interface do usuário) se o <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> corretos foram definidos.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-108">Apps affected by this change may work around it by storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> in a field and checking in all Dispatcher operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are set.</span></span> <span data-ttu-id="4a7ef-109">Como alternativa, como a alteração de ExecutionContext subjacente a essa alteração do WPF afeta apenas aplicativos destinados ao .NET Framework 4.6 ou mais recente, essa interrupção poderá ser evitada destinando-os ao .NET Framework 4.5.2. Aplicativos destinados ao .NET Framework 4.6 ou posterior também podem contornar esse problema definindo a seguinte opção de compatibilidade:</span><span class="sxs-lookup"><span data-stu-id="4a7ef-109">Alternatively, because the ExecutionContext change underlying this WPF change only affects apps targeting the .NET Framework 4.6 or newer, this break can be avoided by targeting the .NET Framework 4.5.2.Apps that target .NET Framework 4.6 or later can also work around this by setting the following compatibility switch:</span></span>

<pre><code class="lang-csharp">AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre>

<span data-ttu-id="4a7ef-110">Esse problema foi corrigido pelo WPF no .NET Framework 4.6.2.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-110">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="4a7ef-111">Ele também foi corrigido no .NET Framework 4.6 e 4.6.1 por meio de [KB 3139549](https://support.microsoft.com/kb/3139549).</span><span class="sxs-lookup"><span data-stu-id="4a7ef-111">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="4a7ef-112">Os aplicativos direcionados ao .NET Framework 4.6 ou posterior terão o comportamento correto automaticamente nos aplicativos WPF – <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName>. Isso seria preservado entre as operações de Dispatcher.</span><span class="sxs-lookup"><span data-stu-id="4a7ef-112">Applications targeting .NET Framework 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName>) would be preserved across Dispatcher operations.</span></span>

| <span data-ttu-id="4a7ef-113">Name</span><span class="sxs-lookup"><span data-stu-id="4a7ef-113">Name</span></span>    | <span data-ttu-id="4a7ef-114">Valor</span><span class="sxs-lookup"><span data-stu-id="4a7ef-114">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="4a7ef-115">Escopo</span><span class="sxs-lookup"><span data-stu-id="4a7ef-115">Scope</span></span>   | <span data-ttu-id="4a7ef-116">Secundária</span><span class="sxs-lookup"><span data-stu-id="4a7ef-116">Minor</span></span>       |
| <span data-ttu-id="4a7ef-117">Versão</span><span class="sxs-lookup"><span data-stu-id="4a7ef-117">Version</span></span> | <span data-ttu-id="4a7ef-118">4.6</span><span class="sxs-lookup"><span data-stu-id="4a7ef-118">4.6</span></span>         |
| <span data-ttu-id="4a7ef-119">Type</span><span class="sxs-lookup"><span data-stu-id="4a7ef-119">Type</span></span>    | <span data-ttu-id="4a7ef-120">Redirecionando</span><span class="sxs-lookup"><span data-stu-id="4a7ef-120">Retargeting</span></span> |
